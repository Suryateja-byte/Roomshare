000001| SECTION: REPORT METADATA
000002| Title: Roomshare Search Page Full Detail Report
000003| Generated (local): 2026-01-13T16:07:09
000004| Scope: /search route UI, server components, client components, hooks, contexts, API routes, and search-specific libs.
000005| Coverage method: import graph traversal from /search entry points plus manual inclusion of search API routes.
000006| Encoding: Non-ASCII source characters are escaped (\uXXXX/\UXXXXXXXX) to preserve fidelity while keeping ASCII output.
000007| 
000008| SECTION: COVERAGE SUMMARY
000009| Entry points: 8
000010| Discovered source files: 92
000011| Unresolved internal imports: 0
000012| Note: Unresolved imports (if any) are listed after the inventory.
000013| 
000014| SECTION: FILE INVENTORY (FULL COVERAGE SET)
000015| FILE: src/app/actions/filter-suggestions.ts | LINES: 18 | ROLE: Auto-discovered dependency in search page graph.
000016| FILE: src/app/actions/saved-search.ts | LINES: 170 | ROLE: Auto-discovered dependency in search page graph.
000017| FILE: src/app/api/map-listings/route.ts | LINES: 106 | ROLE: Map listings API for client-side map data fetch.
000018| FILE: src/app/api/search-count/route.ts | LINES: 102 | ROLE: API endpoint for debounced filter count in search drawer.
000019| FILE: src/app/api/search/facets/route.ts | LINES: 471 | ROLE: Facet counts endpoint for search filters.
000020| FILE: src/app/api/search/v2/route.ts | LINES: 164 | ROLE: Unified search endpoint for list + map data.
000021| FILE: src/app/search/error.tsx | LINES: 65 | ROLE: Client error boundary for search results with retry and navigation.
000022| FILE: src/app/search/layout.tsx | LINES: 64 | ROLE: Persistent layout for /search with header, map, and provider wiring.
000023| FILE: src/app/search/loading.tsx | LINES: 5 | ROLE: Suspense loading state for search results list.
000024| FILE: src/app/search/page.tsx | LINES: 364 | ROLE: Server component for /search results list, rate limiting, and v2/v1 fetch flow.
000025| FILE: src/auth.ts | LINES: 159 | ROLE: Auto-discovered dependency in search page graph.
000026| FILE: src/components/CollapsedMobileSearch.tsx | LINES: 118 | ROLE: Auto-discovered dependency in search page graph.
000027| FILE: src/components/DynamicMap.tsx | LINES: 28 | ROLE: Auto-discovered dependency in search page graph.
000028| FILE: src/components/FavoriteButton.tsx | LINES: 86 | ROLE: Auto-discovered dependency in search page graph.
000029| FILE: src/components/LocationSearchInput.tsx | LINES: 472 | ROLE: Auto-discovered dependency in search page graph.
000030| FILE: src/components/LowResultsGuidance.tsx | LINES: 158 | ROLE: Auto-discovered dependency in search page graph.
000031| FILE: src/components/Map.tsx | LINES: 1404 | ROLE: Mapbox-based map rendering, clustering, and list/map sync.
000032| FILE: src/components/Pagination.tsx | LINES: 239 | ROLE: Auto-discovered dependency in search page graph.
000033| FILE: src/components/PersistentMapWrapper.tsx | LINES: 362 | ROLE: Lazy-loaded map wrapper with map data fetching and v2 context support.
000034| FILE: src/components/SaveSearchButton.tsx | LINES: 280 | ROLE: Save search modal and alert settings.
000035| FILE: src/components/SearchErrorBanner.tsx | LINES: 72 | ROLE: Auto-discovered dependency in search page graph.
000036| FILE: src/components/SearchForm.tsx | LINES: 1326 | ROLE: Search form UI, filters, and URL sync for the search experience.
000037| FILE: src/components/SearchHeaderWrapper.tsx | LINES: 57 | ROLE: Collapsible mobile header wrapper for SearchForm.
000038| FILE: src/components/SearchLayoutView.tsx | LINES: 297 | ROLE: Client split-view controller for list/map and mobile toggles.
000039| FILE: src/components/SortSelect.tsx | LINES: 90 | ROLE: Auto-discovered dependency in search page graph.
000040| FILE: src/components/ZeroResultsSuggestions.tsx | LINES: 234 | ROLE: Auto-discovered dependency in search page graph.
000041| FILE: src/components/filters/AppliedFilterChips.tsx | LINES: 105 | ROLE: Auto-discovered dependency in search page graph.
000042| FILE: src/components/filters/FilterChip.tsx | LINES: 123 | ROLE: Auto-discovered dependency in search page graph.
000043| FILE: src/components/filters/FilterChipWithImpact.tsx | LINES: 55 | ROLE: Auto-discovered dependency in search page graph.
000044| FILE: src/components/filters/FilterStickyFooter.tsx | LINES: 188 | ROLE: Auto-discovered dependency in search page graph.
000045| FILE: src/components/filters/PendingFiltersBanner.tsx | LINES: 61 | ROLE: Auto-discovered dependency in search page graph.
000046| FILE: src/components/filters/filter-chip-utils.ts | LINES: 267 | ROLE: Auto-discovered dependency in search page graph.
000047| FILE: src/components/listings/ListScrollBridge.tsx | LINES: 62 | ROLE: Auto-discovered dependency in search page graph.
000048| FILE: src/components/listings/ListingCard.tsx | LINES: 403 | ROLE: Auto-discovered dependency in search page graph.
000049| FILE: src/components/listings/ListingCardCarousel.tsx | LINES: 268 | ROLE: Auto-discovered dependency in search page graph.
000050| FILE: src/components/listings/NearMatchSeparator.tsx | LINES: 38 | ROLE: Auto-discovered dependency in search page graph.
000051| FILE: src/components/map/MapMovedBanner.tsx | LINES: 130 | ROLE: Auto-discovered dependency in search page graph.
000052| FILE: src/components/map/StackedListingPopup.tsx | LINES: 197 | ROLE: Auto-discovered dependency in search page graph.
000053| FILE: src/components/search/V2MapDataSetter.tsx | LINES: 38 | ROLE: Auto-discovered dependency in search page graph.
000054| FILE: src/components/skeletons/PageSkeleton.tsx | LINES: 526 | ROLE: Auto-discovered dependency in search page graph.
000055| FILE: src/components/skeletons/Skeleton.tsx | LINES: 158 | ROLE: Auto-discovered dependency in search page graph.
000056| FILE: src/components/ui/FocusTrap.tsx | LINES: 89 | ROLE: Auto-discovered dependency in search page graph.
000057| FILE: src/components/ui/button.tsx | LINES: 80 | ROLE: Auto-discovered dependency in search page graph.
000058| FILE: src/components/ui/checkbox.tsx | LINES: 30 | ROLE: Auto-discovered dependency in search page graph.
000059| FILE: src/components/ui/date-picker.tsx | LINES: 364 | ROLE: Auto-discovered dependency in search page graph.
000060| FILE: src/components/ui/input.tsx | LINES: 25 | ROLE: Auto-discovered dependency in search page graph.
000061| FILE: src/components/ui/select.tsx | LINES: 187 | ROLE: Auto-discovered dependency in search page graph.
000062| FILE: src/contexts/FilterStateContext.tsx | LINES: 118 | ROLE: Auto-discovered dependency in search page graph.
000063| FILE: src/contexts/ListingFocusContext.tsx | LINES: 168 | ROLE: Auto-discovered dependency in search page graph.
000064| FILE: src/contexts/MapBoundsContext.tsx | LINES: 247 | ROLE: Auto-discovered dependency in search page graph.
000065| FILE: src/contexts/MobileSearchContext.tsx | LINES: 101 | ROLE: Auto-discovered dependency in search page graph.
000066| FILE: src/contexts/SearchMapUIContext.tsx | LINES: 144 | ROLE: Auto-discovered dependency in search page graph.
000067| FILE: src/contexts/SearchTransitionContext.tsx | LINES: 114 | ROLE: Auto-discovered dependency in search page graph.
000068| FILE: src/contexts/SearchV2DataContext.tsx | LINES: 67 | ROLE: Auto-discovered dependency in search page graph.
000069| FILE: src/hooks/useBatchedFilters.ts | LINES: 215 | ROLE: Auto-discovered dependency in search page graph.
000070| FILE: src/hooks/useDebouncedFilterCount.ts | LINES: 327 | ROLE: Auto-discovered dependency in search page graph.
000071| FILE: src/hooks/useFilterImpactCount.ts | LINES: 237 | ROLE: Auto-discovered dependency in search page graph.
000072| FILE: src/hooks/useKeyboardShortcuts.ts | LINES: 196 | ROLE: Auto-discovered dependency in search page graph.
000073| FILE: src/hooks/useMapPreference.ts | LINES: 159 | ROLE: Auto-discovered dependency in search page graph.
000074| FILE: src/hooks/useRecentSearches.ts | LINES: 289 | ROLE: Auto-discovered dependency in search page graph.
000075| FILE: src/hooks/useScrollHeader.ts | LINES: 104 | ROLE: Auto-discovered dependency in search page graph.
000076| FILE: src/lib/data.ts | LINES: 2423 | ROLE: Auto-discovered dependency in search page graph.
000077| FILE: src/lib/env.ts | LINES: 243 | ROLE: Auto-discovered dependency in search page graph.
000078| FILE: src/lib/errors/data-errors.ts | LINES: 131 | ROLE: Auto-discovered dependency in search page graph.
000079| FILE: src/lib/errors/index.ts | LINES: 11 | ROLE: Auto-discovered dependency in search page graph.
000080| FILE: src/lib/languages.ts | LINES: 204 | ROLE: Auto-discovered dependency in search page graph.
000081| FILE: src/lib/locations/us-locations.ts | LINES: 1276 | ROLE: Auto-discovered dependency in search page graph.
000082| FILE: src/lib/logger.ts | LINES: 382 | ROLE: Auto-discovered dependency in search page graph.
000083| FILE: src/lib/mapbox-init.ts | LINES: 26 | ROLE: Auto-discovered dependency in search page graph.
000084| FILE: src/lib/maps/marker-utils.ts | LINES: 263 | ROLE: Auto-discovered dependency in search page graph.
000085| FILE: src/lib/near-matches.ts | LINES: 293 | ROLE: Auto-discovered dependency in search page graph.
000086| FILE: src/lib/prisma.ts | LINES: 99 | ROLE: Auto-discovered dependency in search page graph.
000087| FILE: src/lib/rate-limit-redis.ts | LINES: 348 | ROLE: Auto-discovered dependency in search page graph.
000088| FILE: src/lib/rate-limit.ts | LINES: 182 | ROLE: Auto-discovered dependency in search page graph.
000089| FILE: src/lib/request-context.ts | LINES: 122 | ROLE: Auto-discovered dependency in search page graph.
000090| FILE: src/lib/search-params.ts | LINES: 583 | ROLE: Auto-discovered dependency in search page graph.
000091| FILE: src/lib/search-utils.ts | LINES: 58 | ROLE: Auto-discovered dependency in search page graph.
000092| FILE: src/lib/search/cursor.ts | LINES: 288 | ROLE: Auto-discovered dependency in search page graph.
000093| FILE: src/lib/search/hash.ts | LINES: 133 | ROLE: Auto-discovered dependency in search page graph.
000094| FILE: src/lib/search/ranking/index.ts | LINES: 71 | ROLE: Auto-discovered dependency in search page graph.
000095| FILE: src/lib/search/ranking/rank.ts | LINES: 106 | ROLE: Auto-discovered dependency in search page graph.
000096| FILE: src/lib/search/ranking/score.ts | LINES: 259 | ROLE: Auto-discovered dependency in search page graph.
000097| FILE: src/lib/search/ranking/types.ts | LINES: 95 | ROLE: Auto-discovered dependency in search page graph.
000098| FILE: src/lib/search/search-doc-queries.ts | LINES: 1279 | ROLE: Auto-discovered dependency in search page graph.
000099| FILE: src/lib/search/search-v2-service.ts | LINES: 280 | ROLE: Auto-discovered dependency in search page graph.
000100| FILE: src/lib/search/transform.ts | LINES: 235 | ROLE: Auto-discovered dependency in search page graph.
000101| FILE: src/lib/search/types.ts | LINES: 119 | ROLE: Auto-discovered dependency in search page graph.
000102| FILE: src/lib/utils.ts | LINES: 52 | ROLE: Auto-discovered dependency in search page graph.
000103| FILE: src/lib/validation.ts | LINES: 90 | ROLE: Auto-discovered dependency in search page graph.
000104| FILE: src/lib/with-rate-limit-redis.ts | LINES: 117 | ROLE: Auto-discovered dependency in search page graph.
000105| FILE: src/lib/with-rate-limit.ts | LINES: 135 | ROLE: Auto-discovered dependency in search page graph.
000106| FILE: src/types/pagination.ts | LINES: 222 | ROLE: Auto-discovered dependency in search page graph.
000107| 
000108| SECTION: UNRESOLVED INTERNAL IMPORTS (IF ANY)
000109| UNRESOLVED: none
000110| 
000111| SECTION: ANNOTATED LISTING
000112| Each source line is followed by a note that tags its role.
000113| 
000114| FILE START: src/app/actions/filter-suggestions.ts
000115| FILE ROLE: Auto-discovered dependency in search page graph.
000116| src/app/actions/filter-suggestions.ts:1: "use server";
000117| NOTE: Implementation detail supporting search page behavior.
000118| src/app/actions/filter-suggestions.ts:2: 
000119| NOTE: Blank line for visual separation.
000120| src/app/actions/filter-suggestions.ts:3: import {
000121| NOTE: Imports dependency for this module.
000122| src/app/actions/filter-suggestions.ts:4:   analyzeFilterImpact,
000123| NOTE: Implementation detail supporting search page behavior.
000124| src/app/actions/filter-suggestions.ts:5:   type FilterParams,
000125| NOTE: Type declaration for search data contracts.
000126| src/app/actions/filter-suggestions.ts:6:   type FilterSuggestion,
000127| NOTE: Type declaration for search data contracts.
000128| src/app/actions/filter-suggestions.ts:7: } from "@/lib/data";
000129| NOTE: Implementation detail supporting search page behavior.
000130| src/app/actions/filter-suggestions.ts:8: 
000131| NOTE: Blank line for visual separation.
000132| src/app/actions/filter-suggestions.ts:9: /**
000133| NOTE: Block comment line describing behavior or context.
000134| src/app/actions/filter-suggestions.ts:10:  * Server action to lazily fetch filter suggestions
000135| NOTE: Block comment line describing behavior or context.
000136| src/app/actions/filter-suggestions.ts:11:  * Called on-demand when user clicks "Show suggestions" button
000137| NOTE: Block comment line describing behavior or context.
000138| src/app/actions/filter-suggestions.ts:12:  * Reduces DB load by not auto-computing on every zero-result render
000139| NOTE: Block comment line describing behavior or context.
000140| src/app/actions/filter-suggestions.ts:13:  */
000141| NOTE: Block comment line describing behavior or context.
000142| src/app/actions/filter-suggestions.ts:14: export async function getFilterSuggestions(
000143| NOTE: Implementation detail supporting search page behavior.
000144| src/app/actions/filter-suggestions.ts:15:   params: FilterParams,
000145| NOTE: Implementation detail supporting search page behavior.
000146| src/app/actions/filter-suggestions.ts:16: ): Promise<FilterSuggestion[]> {
000147| NOTE: Implementation detail supporting search page behavior.
000148| src/app/actions/filter-suggestions.ts:17:   return analyzeFilterImpact(params);
000149| NOTE: Return statement for component or helper output.
000150| src/app/actions/filter-suggestions.ts:18: }
000151| NOTE: Implementation detail supporting search page behavior.
000152| FILE END: src/app/actions/filter-suggestions.ts
000153| 
000154| FILE START: src/app/actions/saved-search.ts
000155| FILE ROLE: Auto-discovered dependency in search page graph.
000156| src/app/actions/saved-search.ts:1: "use server";
000157| NOTE: Implementation detail supporting search page behavior.
000158| src/app/actions/saved-search.ts:2: 
000159| NOTE: Blank line for visual separation.
000160| src/app/actions/saved-search.ts:3: import { prisma } from "@/lib/prisma";
000161| NOTE: Imports dependency for this module.
000162| src/app/actions/saved-search.ts:4: import { auth } from "@/auth";
000163| NOTE: Imports dependency for this module.
000164| src/app/actions/saved-search.ts:5: import { revalidatePath } from "next/cache";
000165| NOTE: Imports dependency for this module.
000166| src/app/actions/saved-search.ts:6: import type { SearchFilters } from "@/lib/search-utils";
000167| NOTE: Imports dependency for this module.
000168| src/app/actions/saved-search.ts:7: import { validateSearchFilters } from "@/lib/search-params";
000169| NOTE: Imports dependency for this module.
000170| src/app/actions/saved-search.ts:8: import type { Prisma } from "@prisma/client";
000171| NOTE: Imports dependency for this module.
000172| src/app/actions/saved-search.ts:9: import { logger } from "@/lib/logger";
000173| NOTE: Imports dependency for this module.
000174| src/app/actions/saved-search.ts:10: 
000175| NOTE: Blank line for visual separation.
000176| src/app/actions/saved-search.ts:11: type AlertFrequency = "INSTANT" | "DAILY" | "WEEKLY";
000177| NOTE: Type declaration for search data contracts.
000178| src/app/actions/saved-search.ts:12: 
000179| NOTE: Blank line for visual separation.
000180| src/app/actions/saved-search.ts:13: interface SaveSearchInput {
000181| NOTE: Type declaration for search data contracts.
000182| src/app/actions/saved-search.ts:14:   name: string;
000183| NOTE: Implementation detail supporting search page behavior.
000184| src/app/actions/saved-search.ts:15:   filters: SearchFilters;
000185| NOTE: Implementation detail supporting search page behavior.
000186| src/app/actions/saved-search.ts:16:   alertEnabled?: boolean;
000187| NOTE: Implementation detail supporting search page behavior.
000188| src/app/actions/saved-search.ts:17:   alertFrequency?: AlertFrequency;
000189| NOTE: Implementation detail supporting search page behavior.
000190| src/app/actions/saved-search.ts:18: }
000191| NOTE: Implementation detail supporting search page behavior.
000192| src/app/actions/saved-search.ts:19: 
000193| NOTE: Blank line for visual separation.
000194| src/app/actions/saved-search.ts:20: export async function saveSearch(input: SaveSearchInput) {
000195| NOTE: Implementation detail supporting search page behavior.
000196| src/app/actions/saved-search.ts:21:   const session = await auth();
000197| NOTE: Local declaration used by search logic or UI.
000198| src/app/actions/saved-search.ts:22:   if (!session?.user?.id) {
000199| NOTE: Conditional logic controlling rendering or flow.
000200| src/app/actions/saved-search.ts:23:     return { error: "Unauthorized" };
000201| NOTE: Return statement for component or helper output.
000202| src/app/actions/saved-search.ts:24:   }
000203| NOTE: Implementation detail supporting search page behavior.
000204| src/app/actions/saved-search.ts:25: 
000205| NOTE: Blank line for visual separation.
000206| src/app/actions/saved-search.ts:26:   try {
000207| NOTE: Implementation detail supporting search page behavior.
000208| src/app/actions/saved-search.ts:27:     // Check if user already has 10 saved searches (limit)
000209| NOTE: Line comment documents intent or constraints.
000210| src/app/actions/saved-search.ts:28:     const existingCount = await prisma.savedSearch.count({
000211| NOTE: Local declaration used by search logic or UI.
000212| src/app/actions/saved-search.ts:29:       where: { userId: session.user.id },
000213| NOTE: Implementation detail supporting search page behavior.
000214| src/app/actions/saved-search.ts:30:     });
000215| NOTE: Implementation detail supporting search page behavior.
000216| src/app/actions/saved-search.ts:31: 
000217| NOTE: Blank line for visual separation.
000218| src/app/actions/saved-search.ts:32:     if (existingCount >= 10) {
000219| NOTE: Conditional logic controlling rendering or flow.
000220| src/app/actions/saved-search.ts:33:       return {
000221| NOTE: Return statement for component or helper output.
000222| src/app/actions/saved-search.ts:34:         error:
000223| NOTE: Implementation detail supporting search page behavior.
000224| src/app/actions/saved-search.ts:35:           "You can only save up to 10 searches. Please delete some to save new ones.",
000225| NOTE: Implementation detail supporting search page behavior.
000226| src/app/actions/saved-search.ts:36:       };
000227| NOTE: Implementation detail supporting search page behavior.
000228| src/app/actions/saved-search.ts:37:     }
000229| NOTE: Implementation detail supporting search page behavior.
000230| src/app/actions/saved-search.ts:38: 
000231| NOTE: Blank line for visual separation.
000232| src/app/actions/saved-search.ts:39:     // Validate filters before storing (prevents malicious/malformed data)
000233| NOTE: Line comment documents intent or constraints.
000234| src/app/actions/saved-search.ts:40:     const validatedFilters = validateSearchFilters(input.filters);
000235| NOTE: Local declaration used by search logic or UI.
000236| src/app/actions/saved-search.ts:41: 
000237| NOTE: Blank line for visual separation.
000238| src/app/actions/saved-search.ts:42:     const savedSearch = await prisma.savedSearch.create({
000239| NOTE: Local declaration used by search logic or UI.
000240| src/app/actions/saved-search.ts:43:       data: {
000241| NOTE: Implementation detail supporting search page behavior.
000242| src/app/actions/saved-search.ts:44:         userId: session.user.id,
000243| NOTE: Implementation detail supporting search page behavior.
000244| src/app/actions/saved-search.ts:45:         name: input.name,
000245| NOTE: Implementation detail supporting search page behavior.
000246| src/app/actions/saved-search.ts:46:         query: validatedFilters.query,
000247| NOTE: Implementation detail supporting search page behavior.
000248| src/app/actions/saved-search.ts:47:         filters: validatedFilters as Prisma.InputJsonValue,
000249| NOTE: Implementation detail supporting search page behavior.
000250| src/app/actions/saved-search.ts:48:         alertEnabled: input.alertEnabled ?? true,
000251| NOTE: Implementation detail supporting search page behavior.
000252| src/app/actions/saved-search.ts:49:         alertFrequency: input.alertFrequency ?? "DAILY",
000253| NOTE: Implementation detail supporting search page behavior.
000254| src/app/actions/saved-search.ts:50:       },
000255| NOTE: Implementation detail supporting search page behavior.
000256| src/app/actions/saved-search.ts:51:     });
000257| NOTE: Implementation detail supporting search page behavior.
000258| src/app/actions/saved-search.ts:52: 
000259| NOTE: Blank line for visual separation.
000260| src/app/actions/saved-search.ts:53:     revalidatePath("/saved-searches");
000261| NOTE: Implementation detail supporting search page behavior.
000262| src/app/actions/saved-search.ts:54: 
000263| NOTE: Blank line for visual separation.
000264| src/app/actions/saved-search.ts:55:     return { success: true, searchId: savedSearch.id };
000265| NOTE: Return statement for component or helper output.
000266| src/app/actions/saved-search.ts:56:   } catch (error: unknown) {
000267| NOTE: Implementation detail supporting search page behavior.
000268| src/app/actions/saved-search.ts:57:     logger.sync.error("Failed to save search", {
000269| NOTE: Implementation detail supporting search page behavior.
000270| src/app/actions/saved-search.ts:58:       action: "saveSearch",
000271| NOTE: Implementation detail supporting search page behavior.
000272| src/app/actions/saved-search.ts:59:       searchName: input.name,
000273| NOTE: Implementation detail supporting search page behavior.
000274| src/app/actions/saved-search.ts:60:       error: error instanceof Error ? error.message : "Unknown error",
000275| NOTE: Implementation detail supporting search page behavior.
000276| src/app/actions/saved-search.ts:61:     });
000277| NOTE: Implementation detail supporting search page behavior.
000278| src/app/actions/saved-search.ts:62:     return { error: "Failed to save search" };
000279| NOTE: Return statement for component or helper output.
000280| src/app/actions/saved-search.ts:63:   }
000281| NOTE: Implementation detail supporting search page behavior.
000282| src/app/actions/saved-search.ts:64: }
000283| NOTE: Implementation detail supporting search page behavior.
000284| src/app/actions/saved-search.ts:65: 
000285| NOTE: Blank line for visual separation.
000286| src/app/actions/saved-search.ts:66: export async function getMySavedSearches() {
000287| NOTE: Implementation detail supporting search page behavior.
000288| src/app/actions/saved-search.ts:67:   const session = await auth();
000289| NOTE: Local declaration used by search logic or UI.
000290| src/app/actions/saved-search.ts:68:   if (!session?.user?.id) {
000291| NOTE: Conditional logic controlling rendering or flow.
000292| src/app/actions/saved-search.ts:69:     return [];
000293| NOTE: Return statement for component or helper output.
000294| src/app/actions/saved-search.ts:70:   }
000295| NOTE: Implementation detail supporting search page behavior.
000296| src/app/actions/saved-search.ts:71: 
000297| NOTE: Blank line for visual separation.
000298| src/app/actions/saved-search.ts:72:   try {
000299| NOTE: Implementation detail supporting search page behavior.
000300| src/app/actions/saved-search.ts:73:     const searches = await prisma.savedSearch.findMany({
000301| NOTE: Local declaration used by search logic or UI.
000302| src/app/actions/saved-search.ts:74:       where: { userId: session.user.id },
000303| NOTE: Implementation detail supporting search page behavior.
000304| src/app/actions/saved-search.ts:75:       orderBy: { createdAt: "desc" },
000305| NOTE: Implementation detail supporting search page behavior.
000306| src/app/actions/saved-search.ts:76:     });
000307| NOTE: Implementation detail supporting search page behavior.
000308| src/app/actions/saved-search.ts:77: 
000309| NOTE: Blank line for visual separation.
000310| src/app/actions/saved-search.ts:78:     return searches;
000311| NOTE: Return statement for component or helper output.
000312| src/app/actions/saved-search.ts:79:   } catch (error: unknown) {
000313| NOTE: Implementation detail supporting search page behavior.
000314| src/app/actions/saved-search.ts:80:     logger.sync.error("Failed to fetch saved searches", {
000315| NOTE: Implementation detail supporting search page behavior.
000316| src/app/actions/saved-search.ts:81:       action: "getMySavedSearches",
000317| NOTE: Implementation detail supporting search page behavior.
000318| src/app/actions/saved-search.ts:82:       error: error instanceof Error ? error.message : "Unknown error",
000319| NOTE: Implementation detail supporting search page behavior.
000320| src/app/actions/saved-search.ts:83:     });
000321| NOTE: Implementation detail supporting search page behavior.
000322| src/app/actions/saved-search.ts:84:     return [];
000323| NOTE: Return statement for component or helper output.
000324| src/app/actions/saved-search.ts:85:   }
000325| NOTE: Implementation detail supporting search page behavior.
000326| src/app/actions/saved-search.ts:86: }
000327| NOTE: Implementation detail supporting search page behavior.
000328| src/app/actions/saved-search.ts:87: 
000329| NOTE: Blank line for visual separation.
000330| src/app/actions/saved-search.ts:88: export async function deleteSavedSearch(searchId: string) {
000331| NOTE: Implementation detail supporting search page behavior.
000332| src/app/actions/saved-search.ts:89:   const session = await auth();
000333| NOTE: Local declaration used by search logic or UI.
000334| src/app/actions/saved-search.ts:90:   if (!session?.user?.id) {
000335| NOTE: Conditional logic controlling rendering or flow.
000336| src/app/actions/saved-search.ts:91:     return { error: "Unauthorized" };
000337| NOTE: Return statement for component or helper output.
000338| src/app/actions/saved-search.ts:92:   }
000339| NOTE: Implementation detail supporting search page behavior.
000340| src/app/actions/saved-search.ts:93: 
000341| NOTE: Blank line for visual separation.
000342| src/app/actions/saved-search.ts:94:   try {
000343| NOTE: Implementation detail supporting search page behavior.
000344| src/app/actions/saved-search.ts:95:     await prisma.savedSearch.delete({
000345| NOTE: Implementation detail supporting search page behavior.
000346| src/app/actions/saved-search.ts:96:       where: {
000347| NOTE: Implementation detail supporting search page behavior.
000348| src/app/actions/saved-search.ts:97:         id: searchId,
000349| NOTE: Implementation detail supporting search page behavior.
000350| src/app/actions/saved-search.ts:98:         userId: session.user.id,
000351| NOTE: Implementation detail supporting search page behavior.
000352| src/app/actions/saved-search.ts:99:       },
000353| NOTE: Implementation detail supporting search page behavior.
000354| src/app/actions/saved-search.ts:100:     });
000355| NOTE: Implementation detail supporting search page behavior.
000356| src/app/actions/saved-search.ts:101: 
000357| NOTE: Blank line for visual separation.
000358| src/app/actions/saved-search.ts:102:     revalidatePath("/saved-searches");
000359| NOTE: Implementation detail supporting search page behavior.
000360| src/app/actions/saved-search.ts:103: 
000361| NOTE: Blank line for visual separation.
000362| src/app/actions/saved-search.ts:104:     return { success: true };
000363| NOTE: Return statement for component or helper output.
000364| src/app/actions/saved-search.ts:105:   } catch (error: unknown) {
000365| NOTE: Implementation detail supporting search page behavior.
000366| src/app/actions/saved-search.ts:106:     logger.sync.error("Failed to delete saved search", {
000367| NOTE: Implementation detail supporting search page behavior.
000368| src/app/actions/saved-search.ts:107:       action: "deleteSavedSearch",
000369| NOTE: Implementation detail supporting search page behavior.
000370| src/app/actions/saved-search.ts:108:       searchId,
000371| NOTE: Implementation detail supporting search page behavior.
000372| src/app/actions/saved-search.ts:109:       error: error instanceof Error ? error.message : "Unknown error",
000373| NOTE: Implementation detail supporting search page behavior.
000374| src/app/actions/saved-search.ts:110:     });
000375| NOTE: Implementation detail supporting search page behavior.
000376| src/app/actions/saved-search.ts:111:     return { error: "Failed to delete saved search" };
000377| NOTE: Return statement for component or helper output.
000378| src/app/actions/saved-search.ts:112:   }
000379| NOTE: Implementation detail supporting search page behavior.
000380| src/app/actions/saved-search.ts:113: }
000381| NOTE: Implementation detail supporting search page behavior.
000382| src/app/actions/saved-search.ts:114: 
000383| NOTE: Blank line for visual separation.
000384| src/app/actions/saved-search.ts:115: export async function toggleSearchAlert(searchId: string, enabled: boolean) {
000385| NOTE: Implementation detail supporting search page behavior.
000386| src/app/actions/saved-search.ts:116:   const session = await auth();
000387| NOTE: Local declaration used by search logic or UI.
000388| src/app/actions/saved-search.ts:117:   if (!session?.user?.id) {
000389| NOTE: Conditional logic controlling rendering or flow.
000390| src/app/actions/saved-search.ts:118:     return { error: "Unauthorized" };
000391| NOTE: Return statement for component or helper output.
000392| src/app/actions/saved-search.ts:119:   }
000393| NOTE: Implementation detail supporting search page behavior.
000394| src/app/actions/saved-search.ts:120: 
000395| NOTE: Blank line for visual separation.
000396| src/app/actions/saved-search.ts:121:   try {
000397| NOTE: Implementation detail supporting search page behavior.
000398| src/app/actions/saved-search.ts:122:     await prisma.savedSearch.update({
000399| NOTE: Implementation detail supporting search page behavior.
000400| src/app/actions/saved-search.ts:123:       where: {
000401| NOTE: Implementation detail supporting search page behavior.
000402| src/app/actions/saved-search.ts:124:         id: searchId,
000403| NOTE: Implementation detail supporting search page behavior.
000404| src/app/actions/saved-search.ts:125:         userId: session.user.id,
000405| NOTE: Implementation detail supporting search page behavior.
000406| src/app/actions/saved-search.ts:126:       },
000407| NOTE: Implementation detail supporting search page behavior.
000408| src/app/actions/saved-search.ts:127:       data: { alertEnabled: enabled },
000409| NOTE: Implementation detail supporting search page behavior.
000410| src/app/actions/saved-search.ts:128:     });
000411| NOTE: Implementation detail supporting search page behavior.
000412| src/app/actions/saved-search.ts:129: 
000413| NOTE: Blank line for visual separation.
000414| src/app/actions/saved-search.ts:130:     revalidatePath("/saved-searches");
000415| NOTE: Implementation detail supporting search page behavior.
000416| src/app/actions/saved-search.ts:131: 
000417| NOTE: Blank line for visual separation.
000418| src/app/actions/saved-search.ts:132:     return { success: true };
000419| NOTE: Return statement for component or helper output.
000420| src/app/actions/saved-search.ts:133:   } catch (error: unknown) {
000421| NOTE: Implementation detail supporting search page behavior.
000422| src/app/actions/saved-search.ts:134:     logger.sync.error("Failed to toggle search alert", {
000423| NOTE: Implementation detail supporting search page behavior.
000424| src/app/actions/saved-search.ts:135:       action: "toggleSearchAlert",
000425| NOTE: Implementation detail supporting search page behavior.
000426| src/app/actions/saved-search.ts:136:       searchId,
000427| NOTE: Implementation detail supporting search page behavior.
000428| src/app/actions/saved-search.ts:137:       alertEnabled: enabled,
000429| NOTE: Implementation detail supporting search page behavior.
000430| src/app/actions/saved-search.ts:138:       error: error instanceof Error ? error.message : "Unknown error",
000431| NOTE: Implementation detail supporting search page behavior.
000432| src/app/actions/saved-search.ts:139:     });
000433| NOTE: Implementation detail supporting search page behavior.
000434| src/app/actions/saved-search.ts:140:     return { error: "Failed to update alert setting" };
000435| NOTE: Return statement for component or helper output.
000436| src/app/actions/saved-search.ts:141:   }
000437| NOTE: Implementation detail supporting search page behavior.
000438| src/app/actions/saved-search.ts:142: }
000439| NOTE: Implementation detail supporting search page behavior.
000440| src/app/actions/saved-search.ts:143: 
000441| NOTE: Blank line for visual separation.
000442| src/app/actions/saved-search.ts:144: export async function updateSavedSearchName(searchId: string, name: string) {
000443| NOTE: Implementation detail supporting search page behavior.
000444| src/app/actions/saved-search.ts:145:   const session = await auth();
000445| NOTE: Local declaration used by search logic or UI.
000446| src/app/actions/saved-search.ts:146:   if (!session?.user?.id) {
000447| NOTE: Conditional logic controlling rendering or flow.
000448| src/app/actions/saved-search.ts:147:     return { error: "Unauthorized" };
000449| NOTE: Return statement for component or helper output.
000450| src/app/actions/saved-search.ts:148:   }
000451| NOTE: Implementation detail supporting search page behavior.
000452| src/app/actions/saved-search.ts:149: 
000453| NOTE: Blank line for visual separation.
000454| src/app/actions/saved-search.ts:150:   try {
000455| NOTE: Implementation detail supporting search page behavior.
000456| src/app/actions/saved-search.ts:151:     await prisma.savedSearch.update({
000457| NOTE: Implementation detail supporting search page behavior.
000458| src/app/actions/saved-search.ts:152:       where: {
000459| NOTE: Implementation detail supporting search page behavior.
000460| src/app/actions/saved-search.ts:153:         id: searchId,
000461| NOTE: Implementation detail supporting search page behavior.
000462| src/app/actions/saved-search.ts:154:         userId: session.user.id,
000463| NOTE: Implementation detail supporting search page behavior.
000464| src/app/actions/saved-search.ts:155:       },
000465| NOTE: Implementation detail supporting search page behavior.
000466| src/app/actions/saved-search.ts:156:       data: { name },
000467| NOTE: Implementation detail supporting search page behavior.
000468| src/app/actions/saved-search.ts:157:     });
000469| NOTE: Implementation detail supporting search page behavior.
000470| src/app/actions/saved-search.ts:158: 
000471| NOTE: Blank line for visual separation.
000472| src/app/actions/saved-search.ts:159:     revalidatePath("/saved-searches");
000473| NOTE: Implementation detail supporting search page behavior.
000474| src/app/actions/saved-search.ts:160: 
000475| NOTE: Blank line for visual separation.
000476| src/app/actions/saved-search.ts:161:     return { success: true };
000477| NOTE: Return statement for component or helper output.
000478| src/app/actions/saved-search.ts:162:   } catch (error: unknown) {
000479| NOTE: Implementation detail supporting search page behavior.
000480| src/app/actions/saved-search.ts:163:     logger.sync.error("Failed to update saved search name", {
000481| NOTE: Implementation detail supporting search page behavior.
000482| src/app/actions/saved-search.ts:164:       action: "updateSavedSearchName",
000483| NOTE: Implementation detail supporting search page behavior.
000484| src/app/actions/saved-search.ts:165:       searchId,
000485| NOTE: Implementation detail supporting search page behavior.
000486| src/app/actions/saved-search.ts:166:       error: error instanceof Error ? error.message : "Unknown error",
000487| NOTE: Implementation detail supporting search page behavior.
000488| src/app/actions/saved-search.ts:167:     });
000489| NOTE: Implementation detail supporting search page behavior.
000490| src/app/actions/saved-search.ts:168:     return { error: "Failed to update search name" };
000491| NOTE: Return statement for component or helper output.
000492| src/app/actions/saved-search.ts:169:   }
000493| NOTE: Implementation detail supporting search page behavior.
000494| src/app/actions/saved-search.ts:170: }
000495| NOTE: Implementation detail supporting search page behavior.
000496| FILE END: src/app/actions/saved-search.ts
000497| 
000498| FILE START: src/app/api/map-listings/route.ts
000499| FILE ROLE: Map listings API for client-side map data fetch.
000500| src/app/api/map-listings/route.ts:1: /**
000501| NOTE: Block comment line describing behavior or context.
000502| src/app/api/map-listings/route.ts:2:  * GET /api/map-listings
000503| NOTE: Block comment line describing behavior or context.
000504| src/app/api/map-listings/route.ts:3:  *
000505| NOTE: Block comment line describing behavior or context.
000506| src/app/api/map-listings/route.ts:4:  * Fetch map listings based on bounds and filters.
000507| NOTE: Block comment line describing behavior or context.
000508| src/app/api/map-listings/route.ts:5:  * Used by the persistent map component in layout.tsx to fetch its own data.
000509| NOTE: Block comment line describing behavior or context.
000510| src/app/api/map-listings/route.ts:6:  */
000511| NOTE: Block comment line describing behavior or context.
000512| src/app/api/map-listings/route.ts:7: 
000513| NOTE: Blank line for visual separation.
000514| src/app/api/map-listings/route.ts:8: import { NextRequest, NextResponse } from "next/server";
000515| NOTE: Imports dependency for this module.
000516| src/app/api/map-listings/route.ts:9: import { getMapListings, MapListingData } from "@/lib/data";
000517| NOTE: Imports dependency for this module.
000518| src/app/api/map-listings/route.ts:10: import { withRateLimitRedis } from "@/lib/with-rate-limit-redis";
000519| NOTE: Imports dependency for this module.
000520| src/app/api/map-listings/route.ts:11: import { validateAndParseBounds } from "@/lib/validation";
000521| NOTE: Imports dependency for this module.
000522| src/app/api/map-listings/route.ts:12: import {
000523| NOTE: Imports dependency for this module.
000524| src/app/api/map-listings/route.ts:13:   createContextFromHeaders,
000525| NOTE: Implementation detail supporting search page behavior.
000526| src/app/api/map-listings/route.ts:14:   runWithRequestContext,
000527| NOTE: Implementation detail supporting search page behavior.
000528| src/app/api/map-listings/route.ts:15:   getRequestId,
000529| NOTE: Implementation detail supporting search page behavior.
000530| src/app/api/map-listings/route.ts:16: } from "@/lib/request-context";
000531| NOTE: Implementation detail supporting search page behavior.
000532| src/app/api/map-listings/route.ts:17: 
000533| NOTE: Blank line for visual separation.
000534| src/app/api/map-listings/route.ts:18: export async function GET(request: NextRequest) {
000535| NOTE: Implementation detail supporting search page behavior.
000536| src/app/api/map-listings/route.ts:19:   const context = createContextFromHeaders(request.headers);
000537| NOTE: Local declaration used by search logic or UI.
000538| src/app/api/map-listings/route.ts:20: 
000539| NOTE: Blank line for visual separation.
000540| src/app/api/map-listings/route.ts:21:   return runWithRequestContext(context, async () => {
000541| NOTE: Return statement for component or helper output.
000542| src/app/api/map-listings/route.ts:22:     const requestId = getRequestId();
000543| NOTE: Local declaration used by search logic or UI.
000544| src/app/api/map-listings/route.ts:23: 
000545| NOTE: Blank line for visual separation.
000546| src/app/api/map-listings/route.ts:24:     try {
000547| NOTE: Implementation detail supporting search page behavior.
000548| src/app/api/map-listings/route.ts:25:       // Rate limiting via Redis (fail-closed in production)
000549| NOTE: Line comment documents intent or constraints.
000550| src/app/api/map-listings/route.ts:26:       const rateLimitResponse = await withRateLimitRedis(request, {
000551| NOTE: Local declaration used by search logic or UI.
000552| src/app/api/map-listings/route.ts:27:         type: "map",
000553| NOTE: Implementation detail supporting search page behavior.
000554| src/app/api/map-listings/route.ts:28:       });
000555| NOTE: Implementation detail supporting search page behavior.
000556| src/app/api/map-listings/route.ts:29:       if (rateLimitResponse) return rateLimitResponse;
000557| NOTE: Conditional logic controlling rendering or flow.
000558| src/app/api/map-listings/route.ts:30: 
000559| NOTE: Blank line for visual separation.
000560| src/app/api/map-listings/route.ts:31:       const searchParams = request.nextUrl.searchParams;
000561| NOTE: Local declaration used by search logic or UI.
000562| src/app/api/map-listings/route.ts:32: 
000563| NOTE: Blank line for visual separation.
000564| src/app/api/map-listings/route.ts:33:       // Validate and parse bounds (required - prevents full-table scans)
000565| NOTE: Line comment documents intent or constraints.
000566| src/app/api/map-listings/route.ts:34:       const boundsResult = validateAndParseBounds(
000567| NOTE: Local declaration used by search logic or UI.
000568| src/app/api/map-listings/route.ts:35:         searchParams.get("minLng"),
000569| NOTE: Implementation detail supporting search page behavior.
000570| src/app/api/map-listings/route.ts:36:         searchParams.get("maxLng"),
000571| NOTE: Implementation detail supporting search page behavior.
000572| src/app/api/map-listings/route.ts:37:         searchParams.get("minLat"),
000573| NOTE: Implementation detail supporting search page behavior.
000574| src/app/api/map-listings/route.ts:38:         searchParams.get("maxLat"),
000575| NOTE: Implementation detail supporting search page behavior.
000576| src/app/api/map-listings/route.ts:39:       );
000577| NOTE: Implementation detail supporting search page behavior.
000578| src/app/api/map-listings/route.ts:40: 
000579| NOTE: Blank line for visual separation.
000580| src/app/api/map-listings/route.ts:41:       if (!boundsResult.valid) {
000581| NOTE: Conditional logic controlling rendering or flow.
000582| src/app/api/map-listings/route.ts:42:         return NextResponse.json(
000583| NOTE: Return statement for component or helper output.
000584| src/app/api/map-listings/route.ts:43:           { error: boundsResult.error },
000585| NOTE: Implementation detail supporting search page behavior.
000586| src/app/api/map-listings/route.ts:44:           {
000587| NOTE: Implementation detail supporting search page behavior.
000588| src/app/api/map-listings/route.ts:45:             status: 400,
000589| NOTE: Implementation detail supporting search page behavior.
000590| src/app/api/map-listings/route.ts:46:             headers: { "x-request-id": requestId },
000591| NOTE: Implementation detail supporting search page behavior.
000592| src/app/api/map-listings/route.ts:47:           },
000593| NOTE: Implementation detail supporting search page behavior.
000594| src/app/api/map-listings/route.ts:48:         );
000595| NOTE: Implementation detail supporting search page behavior.
000596| src/app/api/map-listings/route.ts:49:       }
000597| NOTE: Implementation detail supporting search page behavior.
000598| src/app/api/map-listings/route.ts:50: 
000599| NOTE: Blank line for visual separation.
000600| src/app/api/map-listings/route.ts:51:       const bounds = boundsResult.bounds;
000601| NOTE: Local declaration used by search logic or UI.
000602| src/app/api/map-listings/route.ts:52: 
000603| NOTE: Blank line for visual separation.
000604| src/app/api/map-listings/route.ts:53:       // Extract filters
000605| NOTE: Line comment documents intent or constraints.
000606| src/app/api/map-listings/route.ts:54:       const filterParams = {
000607| NOTE: Local declaration used by search logic or UI.
000608| src/app/api/map-listings/route.ts:55:         query: searchParams.get("q") || undefined,
000609| NOTE: Implementation detail supporting search page behavior.
000610| src/app/api/map-listings/route.ts:56:         minPrice: searchParams.get("minPrice")
000611| NOTE: Implementation detail supporting search page behavior.
000612| src/app/api/map-listings/route.ts:57:           ? parseInt(searchParams.get("minPrice")!)
000613| NOTE: Implementation detail supporting search page behavior.
000614| src/app/api/map-listings/route.ts:58:           : undefined,
000615| NOTE: Implementation detail supporting search page behavior.
000616| src/app/api/map-listings/route.ts:59:         maxPrice: searchParams.get("maxPrice")
000617| NOTE: Implementation detail supporting search page behavior.
000618| src/app/api/map-listings/route.ts:60:           ? parseInt(searchParams.get("maxPrice")!)
000619| NOTE: Implementation detail supporting search page behavior.
000620| src/app/api/map-listings/route.ts:61:           : undefined,
000621| NOTE: Implementation detail supporting search page behavior.
000622| src/app/api/map-listings/route.ts:62:         bounds,
000623| NOTE: Implementation detail supporting search page behavior.
000624| src/app/api/map-listings/route.ts:63:         amenities:
000625| NOTE: Implementation detail supporting search page behavior.
000626| src/app/api/map-listings/route.ts:64:           searchParams.get("amenities")?.split(",").filter(Boolean) ||
000627| NOTE: Implementation detail supporting search page behavior.
000628| src/app/api/map-listings/route.ts:65:           undefined,
000629| NOTE: Implementation detail supporting search page behavior.
000630| src/app/api/map-listings/route.ts:66:         languages:
000631| NOTE: Implementation detail supporting search page behavior.
000632| src/app/api/map-listings/route.ts:67:           searchParams.get("languages")?.split(",").filter(Boolean) ||
000633| NOTE: Implementation detail supporting search page behavior.
000634| src/app/api/map-listings/route.ts:68:           undefined,
000635| NOTE: Implementation detail supporting search page behavior.
000636| src/app/api/map-listings/route.ts:69:         houseRules:
000637| NOTE: Implementation detail supporting search page behavior.
000638| src/app/api/map-listings/route.ts:70:           searchParams.get("houseRules")?.split(",").filter(Boolean) ||
000639| NOTE: Implementation detail supporting search page behavior.
000640| src/app/api/map-listings/route.ts:71:           undefined,
000641| NOTE: Implementation detail supporting search page behavior.
000642| src/app/api/map-listings/route.ts:72:         moveInDate: searchParams.get("moveInDate") || undefined,
000643| NOTE: Implementation detail supporting search page behavior.
000644| src/app/api/map-listings/route.ts:73:         leaseDuration: searchParams.get("leaseDuration") || undefined,
000645| NOTE: Implementation detail supporting search page behavior.
000646| src/app/api/map-listings/route.ts:74:         roomType: searchParams.get("roomType") || undefined,
000647| NOTE: Implementation detail supporting search page behavior.
000648| src/app/api/map-listings/route.ts:75:       };
000649| NOTE: Implementation detail supporting search page behavior.
000650| src/app/api/map-listings/route.ts:76: 
000651| NOTE: Blank line for visual separation.
000652| src/app/api/map-listings/route.ts:77:       // Fetch listings using existing data function
000653| NOTE: Line comment documents intent or constraints.
000654| src/app/api/map-listings/route.ts:78:       const listings: MapListingData[] = await getMapListings(filterParams);
000655| NOTE: Local declaration used by search logic or UI.
000656| src/app/api/map-listings/route.ts:79: 
000657| NOTE: Blank line for visual separation.
000658| src/app/api/map-listings/route.ts:80:       return NextResponse.json(
000659| NOTE: Return statement for component or helper output.
000660| src/app/api/map-listings/route.ts:81:         { listings },
000661| NOTE: Implementation detail supporting search page behavior.
000662| src/app/api/map-listings/route.ts:82:         {
000663| NOTE: Implementation detail supporting search page behavior.
000664| src/app/api/map-listings/route.ts:83:           headers: {
000665| NOTE: Implementation detail supporting search page behavior.
000666| src/app/api/map-listings/route.ts:84:             // Fix #3: Use s-maxage for CDN caching (markers are NOT user-specific)
000667| NOTE: Line comment documents intent or constraints.
000668| src/app/api/map-listings/route.ts:85:             // s-maxage: CDN/edge cache duration (60s)
000669| NOTE: Line comment documents intent or constraints.
000670| src/app/api/map-listings/route.ts:86:             // max-age: browser cache duration (shorter to allow user refresh)
000671| NOTE: Line comment documents intent or constraints.
000672| src/app/api/map-listings/route.ts:87:             "Cache-Control":
000673| NOTE: Implementation detail supporting search page behavior.
000674| src/app/api/map-listings/route.ts:88:               "public, s-maxage=60, max-age=30, stale-while-revalidate=120",
000675| NOTE: Implementation detail supporting search page behavior.
000676| src/app/api/map-listings/route.ts:89:             "x-request-id": requestId,
000677| NOTE: Implementation detail supporting search page behavior.
000678| src/app/api/map-listings/route.ts:90:             // Vary by Accept-Encoding for proper CDN compression handling
000679| NOTE: Line comment documents intent or constraints.
000680| src/app/api/map-listings/route.ts:91:             Vary: "Accept-Encoding",
000681| NOTE: Implementation detail supporting search page behavior.
000682| src/app/api/map-listings/route.ts:92:           },
000683| NOTE: Implementation detail supporting search page behavior.
000684| src/app/api/map-listings/route.ts:93:         },
000685| NOTE: Implementation detail supporting search page behavior.
000686| src/app/api/map-listings/route.ts:94:       );
000687| NOTE: Implementation detail supporting search page behavior.
000688| src/app/api/map-listings/route.ts:95:     } catch (error) {
000689| NOTE: Implementation detail supporting search page behavior.
000690| src/app/api/map-listings/route.ts:96:       console.error("Map listings API error:", { error, requestId });
000691| NOTE: Implementation detail supporting search page behavior.
000692| src/app/api/map-listings/route.ts:97:       return NextResponse.json(
000693| NOTE: Return statement for component or helper output.
000694| src/app/api/map-listings/route.ts:98:         { error: "Failed to fetch map listings" },
000695| NOTE: Implementation detail supporting search page behavior.
000696| src/app/api/map-listings/route.ts:99:         {
000697| NOTE: Implementation detail supporting search page behavior.
000698| src/app/api/map-listings/route.ts:100:           status: 500,
000699| NOTE: Implementation detail supporting search page behavior.
000700| src/app/api/map-listings/route.ts:101:           headers: { "x-request-id": requestId },
000701| NOTE: Implementation detail supporting search page behavior.
000702| src/app/api/map-listings/route.ts:102:         },
000703| NOTE: Implementation detail supporting search page behavior.
000704| src/app/api/map-listings/route.ts:103:       );
000705| NOTE: Implementation detail supporting search page behavior.
000706| src/app/api/map-listings/route.ts:104:     }
000707| NOTE: Implementation detail supporting search page behavior.
000708| src/app/api/map-listings/route.ts:105:   });
000709| NOTE: Implementation detail supporting search page behavior.
000710| src/app/api/map-listings/route.ts:106: }
000711| NOTE: Implementation detail supporting search page behavior.
000712| FILE END: src/app/api/map-listings/route.ts
000713| 
000714| FILE START: src/app/api/search-count/route.ts
000715| FILE ROLE: API endpoint for debounced filter count in search drawer.
000716| src/app/api/search-count/route.ts:1: /**
000717| NOTE: Block comment line describing behavior or context.
000718| src/app/api/search-count/route.ts:2:  * Search Count API Endpoint
000719| NOTE: Block comment line describing behavior or context.
000720| src/app/api/search-count/route.ts:3:  *
000721| NOTE: Block comment line describing behavior or context.
000722| src/app/api/search-count/route.ts:4:  * Returns a count of listings matching the given filter parameters.
000723| NOTE: Block comment line describing behavior or context.
000724| src/app/api/search-count/route.ts:5:  * Used by the filter drawer to show "Show X listings" button preview.
000725| NOTE: Block comment line describing behavior or context.
000726| src/app/api/search-count/route.ts:6:  *
000727| NOTE: Block comment line describing behavior or context.
000728| src/app/api/search-count/route.ts:7:  * Returns:
000729| NOTE: Block comment line describing behavior or context.
000730| src/app/api/search-count/route.ts:8:  * - { count: number } when count is \u2264100
000731| NOTE: Block comment line describing behavior or context.
000732| src/app/api/search-count/route.ts:9:  * - { count: null } when count is >100 (indicates "100+")
000733| NOTE: Block comment line describing behavior or context.
000734| src/app/api/search-count/route.ts:10:  *
000735| NOTE: Block comment line describing behavior or context.
000736| src/app/api/search-count/route.ts:11:  * Uses the same parseSearchParams() logic as the main search
000737| NOTE: Block comment line describing behavior or context.
000738| src/app/api/search-count/route.ts:12:  * to ensure consistent filter interpretation.
000739| NOTE: Block comment line describing behavior or context.
000740| src/app/api/search-count/route.ts:13:  */
000741| NOTE: Block comment line describing behavior or context.
000742| src/app/api/search-count/route.ts:14: 
000743| NOTE: Blank line for visual separation.
000744| src/app/api/search-count/route.ts:15: import { NextRequest, NextResponse } from "next/server";
000745| NOTE: Imports dependency for this module.
000746| src/app/api/search-count/route.ts:16: import { withRateLimitRedis } from "@/lib/with-rate-limit-redis";
000747| NOTE: Imports dependency for this module.
000748| src/app/api/search-count/route.ts:17: import {
000749| NOTE: Imports dependency for this module.
000750| src/app/api/search-count/route.ts:18:   createContextFromHeaders,
000751| NOTE: Implementation detail supporting search page behavior.
000752| src/app/api/search-count/route.ts:19:   runWithRequestContext,
000753| NOTE: Implementation detail supporting search page behavior.
000754| src/app/api/search-count/route.ts:20:   getRequestId,
000755| NOTE: Implementation detail supporting search page behavior.
000756| src/app/api/search-count/route.ts:21: } from "@/lib/request-context";
000757| NOTE: Implementation detail supporting search page behavior.
000758| src/app/api/search-count/route.ts:22: import { parseSearchParams } from "@/lib/search-params";
000759| NOTE: Imports dependency for this module.
000760| src/app/api/search-count/route.ts:23: import { getLimitedCount } from "@/lib/data";
000761| NOTE: Imports dependency for this module.
000762| src/app/api/search-count/route.ts:24: import { logger } from "@/lib/logger";
000763| NOTE: Imports dependency for this module.
000764| src/app/api/search-count/route.ts:25: 
000765| NOTE: Blank line for visual separation.
000766| src/app/api/search-count/route.ts:26: // Disable static caching - counts must be fresh
000767| NOTE: Line comment documents intent or constraints.
000768| src/app/api/search-count/route.ts:27: export const dynamic = "force-dynamic";
000769| NOTE: Implementation detail supporting search page behavior.
000770| src/app/api/search-count/route.ts:28: 
000771| NOTE: Blank line for visual separation.
000772| src/app/api/search-count/route.ts:29: export async function GET(request: NextRequest) {
000773| NOTE: Implementation detail supporting search page behavior.
000774| src/app/api/search-count/route.ts:30:   const context = createContextFromHeaders(request.headers);
000775| NOTE: Local declaration used by search logic or UI.
000776| src/app/api/search-count/route.ts:31: 
000777| NOTE: Blank line for visual separation.
000778| src/app/api/search-count/route.ts:32:   return runWithRequestContext(context, async () => {
000779| NOTE: Return statement for component or helper output.
000780| src/app/api/search-count/route.ts:33:     const requestId = getRequestId();
000781| NOTE: Local declaration used by search logic or UI.
000782| src/app/api/search-count/route.ts:34: 
000783| NOTE: Blank line for visual separation.
000784| src/app/api/search-count/route.ts:35:     // Rate limiting - use a dedicated type for count requests
000785| NOTE: Line comment documents intent or constraints.
000786| src/app/api/search-count/route.ts:36:     const rateLimitResponse = await withRateLimitRedis(request, {
000787| NOTE: Local declaration used by search logic or UI.
000788| src/app/api/search-count/route.ts:37:       type: "search-count",
000789| NOTE: Implementation detail supporting search page behavior.
000790| src/app/api/search-count/route.ts:38:     });
000791| NOTE: Implementation detail supporting search page behavior.
000792| src/app/api/search-count/route.ts:39:     if (rateLimitResponse) {
000793| NOTE: Conditional logic controlling rendering or flow.
000794| src/app/api/search-count/route.ts:40:       return rateLimitResponse;
000795| NOTE: Return statement for component or helper output.
000796| src/app/api/search-count/route.ts:41:     }
000797| NOTE: Implementation detail supporting search page behavior.
000798| src/app/api/search-count/route.ts:42: 
000799| NOTE: Blank line for visual separation.
000800| src/app/api/search-count/route.ts:43:     try {
000801| NOTE: Implementation detail supporting search page behavior.
000802| src/app/api/search-count/route.ts:44:       // Parse URL search params using same logic as main search
000803| NOTE: Line comment documents intent or constraints.
000804| src/app/api/search-count/route.ts:45:       const { searchParams } = request.nextUrl;
000805| NOTE: Local declaration used by search logic or UI.
000806| src/app/api/search-count/route.ts:46:       const rawParams: Record<string, string | string[] | undefined> = {};
000807| NOTE: Local declaration used by search logic or UI.
000808| src/app/api/search-count/route.ts:47: 
000809| NOTE: Blank line for visual separation.
000810| src/app/api/search-count/route.ts:48:       // Convert URLSearchParams to raw params object
000811| NOTE: Line comment documents intent or constraints.
000812| src/app/api/search-count/route.ts:49:       searchParams.forEach((value, key) => {
000813| NOTE: Implementation detail supporting search page behavior.
000814| src/app/api/search-count/route.ts:50:         const existing = rawParams[key];
000815| NOTE: Local declaration used by search logic or UI.
000816| src/app/api/search-count/route.ts:51:         if (existing) {
000817| NOTE: Conditional logic controlling rendering or flow.
000818| src/app/api/search-count/route.ts:52:           // Handle multiple values for same key
000819| NOTE: Line comment documents intent or constraints.
000820| src/app/api/search-count/route.ts:53:           if (Array.isArray(existing)) {
000821| NOTE: Conditional logic controlling rendering or flow.
000822| src/app/api/search-count/route.ts:54:             existing.push(value);
000823| NOTE: Implementation detail supporting search page behavior.
000824| src/app/api/search-count/route.ts:55:           } else {
000825| NOTE: Implementation detail supporting search page behavior.
000826| src/app/api/search-count/route.ts:56:             rawParams[key] = [existing, value];
000827| NOTE: Implementation detail supporting search page behavior.
000828| src/app/api/search-count/route.ts:57:           }
000829| NOTE: Implementation detail supporting search page behavior.
000830| src/app/api/search-count/route.ts:58:         } else {
000831| NOTE: Implementation detail supporting search page behavior.
000832| src/app/api/search-count/route.ts:59:           rawParams[key] = value;
000833| NOTE: Implementation detail supporting search page behavior.
000834| src/app/api/search-count/route.ts:60:         }
000835| NOTE: Implementation detail supporting search page behavior.
000836| src/app/api/search-count/route.ts:61:       });
000837| NOTE: Implementation detail supporting search page behavior.
000838| src/app/api/search-count/route.ts:62: 
000839| NOTE: Blank line for visual separation.
000840| src/app/api/search-count/route.ts:63:       // Parse and validate using same logic as main search
000841| NOTE: Line comment documents intent or constraints.
000842| src/app/api/search-count/route.ts:64:       const { filterParams } = parseSearchParams(rawParams);
000843| NOTE: Local declaration used by search logic or UI.
000844| src/app/api/search-count/route.ts:65: 
000845| NOTE: Blank line for visual separation.
000846| src/app/api/search-count/route.ts:66:       // Get count using existing getLimitedCount function
000847| NOTE: Line comment documents intent or constraints.
000848| src/app/api/search-count/route.ts:67:       // Returns exact count if \u2264100, null if >100
000849| NOTE: Line comment documents intent or constraints.
000850| src/app/api/search-count/route.ts:68:       const count = await getLimitedCount(filterParams);
000851| NOTE: Local declaration used by search logic or UI.
000852| src/app/api/search-count/route.ts:69: 
000853| NOTE: Blank line for visual separation.
000854| src/app/api/search-count/route.ts:70:       logger.debug("Search count request", {
000855| NOTE: Implementation detail supporting search page behavior.
000856| src/app/api/search-count/route.ts:71:         requestId,
000857| NOTE: Implementation detail supporting search page behavior.
000858| src/app/api/search-count/route.ts:72:         count,
000859| NOTE: Implementation detail supporting search page behavior.
000860| src/app/api/search-count/route.ts:73:         hasFilters: Object.keys(filterParams).length > 0,
000861| NOTE: Implementation detail supporting search page behavior.
000862| src/app/api/search-count/route.ts:74:       });
000863| NOTE: Implementation detail supporting search page behavior.
000864| src/app/api/search-count/route.ts:75: 
000865| NOTE: Blank line for visual separation.
000866| src/app/api/search-count/route.ts:76:       return NextResponse.json(
000867| NOTE: Return statement for component or helper output.
000868| src/app/api/search-count/route.ts:77:         { count },
000869| NOTE: Implementation detail supporting search page behavior.
000870| src/app/api/search-count/route.ts:78:         {
000871| NOTE: Implementation detail supporting search page behavior.
000872| src/app/api/search-count/route.ts:79:           headers: {
000873| NOTE: Implementation detail supporting search page behavior.
000874| src/app/api/search-count/route.ts:80:             // No caching - client handles debouncing and in-memory caching
000875| NOTE: Line comment documents intent or constraints.
000876| src/app/api/search-count/route.ts:81:             "Cache-Control": "private, no-store",
000877| NOTE: Implementation detail supporting search page behavior.
000878| src/app/api/search-count/route.ts:82:           },
000879| NOTE: Implementation detail supporting search page behavior.
000880| src/app/api/search-count/route.ts:83:         },
000881| NOTE: Implementation detail supporting search page behavior.
000882| src/app/api/search-count/route.ts:84:       );
000883| NOTE: Implementation detail supporting search page behavior.
000884| src/app/api/search-count/route.ts:85:     } catch (error) {
000885| NOTE: Implementation detail supporting search page behavior.
000886| src/app/api/search-count/route.ts:86:       logger.error("Search count error", {
000887| NOTE: Implementation detail supporting search page behavior.
000888| src/app/api/search-count/route.ts:87:         requestId,
000889| NOTE: Implementation detail supporting search page behavior.
000890| src/app/api/search-count/route.ts:88:         error: error instanceof Error ? error.message : "Unknown error",
000891| NOTE: Implementation detail supporting search page behavior.
000892| src/app/api/search-count/route.ts:89:       });
000893| NOTE: Implementation detail supporting search page behavior.
000894| src/app/api/search-count/route.ts:90: 
000895| NOTE: Blank line for visual separation.
000896| src/app/api/search-count/route.ts:91:       return NextResponse.json(
000897| NOTE: Return statement for component or helper output.
000898| src/app/api/search-count/route.ts:92:         { error: "Failed to get count" },
000899| NOTE: Implementation detail supporting search page behavior.
000900| src/app/api/search-count/route.ts:93:         {
000901| NOTE: Implementation detail supporting search page behavior.
000902| src/app/api/search-count/route.ts:94:           status: 500,
000903| NOTE: Implementation detail supporting search page behavior.
000904| src/app/api/search-count/route.ts:95:           headers: {
000905| NOTE: Implementation detail supporting search page behavior.
000906| src/app/api/search-count/route.ts:96:             "Cache-Control": "private, no-store",
000907| NOTE: Implementation detail supporting search page behavior.
000908| src/app/api/search-count/route.ts:97:           },
000909| NOTE: Implementation detail supporting search page behavior.
000910| src/app/api/search-count/route.ts:98:         },
000911| NOTE: Implementation detail supporting search page behavior.
000912| src/app/api/search-count/route.ts:99:       );
000913| NOTE: Implementation detail supporting search page behavior.
000914| src/app/api/search-count/route.ts:100:     }
000915| NOTE: Implementation detail supporting search page behavior.
000916| src/app/api/search-count/route.ts:101:   });
000917| NOTE: Implementation detail supporting search page behavior.
000918| src/app/api/search-count/route.ts:102: }
000919| NOTE: Implementation detail supporting search page behavior.
000920| FILE END: src/app/api/search-count/route.ts
000921| 
000922| FILE START: src/app/api/search/facets/route.ts
000923| FILE ROLE: Facet counts endpoint for search filters.
000924| src/app/api/search/facets/route.ts:1: /**
000925| NOTE: Block comment line describing behavior or context.
000926| src/app/api/search/facets/route.ts:2:  * /api/search/facets - Return counts per filter option
000927| NOTE: Block comment line describing behavior or context.
000928| src/app/api/search/facets/route.ts:3:  *
000929| NOTE: Block comment line describing behavior or context.
000930| src/app/api/search/facets/route.ts:4:  * Returns facet counts for filter options based on current filter state:
000931| NOTE: Block comment line describing behavior or context.
000932| src/app/api/search/facets/route.ts:5:  * - amenities: { "Wifi": 45, "Parking": 23 }
000933| NOTE: Block comment line describing behavior or context.
000934| src/app/api/search/facets/route.ts:6:  * - houseRules: { "Pets allowed": 30 }
000935| NOTE: Block comment line describing behavior or context.
000936| src/app/api/search/facets/route.ts:7:  * - roomTypes: { "Private Room": 50, "Shared Room": 20 }
000937| NOTE: Block comment line describing behavior or context.
000938| src/app/api/search/facets/route.ts:8:  * - priceRanges: { min: 500, max: 3000, median: 1200 }
000939| NOTE: Block comment line describing behavior or context.
000940| src/app/api/search/facets/route.ts:9:  *
000941| NOTE: Block comment line describing behavior or context.
000942| src/app/api/search/facets/route.ts:10:  * Uses GROUP BY queries with LIMIT 100 to cap expensive aggregations.
000943| NOTE: Block comment line describing behavior or context.
000944| src/app/api/search/facets/route.ts:11:  * Cached with 30s TTL.
000945| NOTE: Block comment line describing behavior or context.
000946| src/app/api/search/facets/route.ts:12:  *
000947| NOTE: Block comment line describing behavior or context.
000948| src/app/api/search/facets/route.ts:13:  * Performance considerations:
000949| NOTE: Block comment line describing behavior or context.
000950| src/app/api/search/facets/route.ts:14:  * - Queries are run in parallel for efficiency
000951| NOTE: Block comment line describing behavior or context.
000952| src/app/api/search/facets/route.ts:15:  * - Results are cached to avoid redundant database calls
000953| NOTE: Block comment line describing behavior or context.
000954| src/app/api/search/facets/route.ts:16:  * - LIMIT 100 prevents expensive aggregations on large datasets
000955| NOTE: Block comment line describing behavior or context.
000956| src/app/api/search/facets/route.ts:17:  */
000957| NOTE: Block comment line describing behavior or context.
000958| src/app/api/search/facets/route.ts:18: 
000959| NOTE: Blank line for visual separation.
000960| src/app/api/search/facets/route.ts:19: import { NextRequest, NextResponse } from "next/server";
000961| NOTE: Imports dependency for this module.
000962| src/app/api/search/facets/route.ts:20: import { prisma } from "@/lib/prisma";
000963| NOTE: Imports dependency for this module.
000964| src/app/api/search/facets/route.ts:21: import { parseSearchParams } from "@/lib/search-params";
000965| NOTE: Imports dependency for this module.
000966| src/app/api/search/facets/route.ts:22: import { unstable_cache } from "next/cache";
000967| NOTE: Imports dependency for this module.
000968| src/app/api/search/facets/route.ts:23: import { withRateLimitRedis } from "@/lib/with-rate-limit-redis";
000969| NOTE: Imports dependency for this module.
000970| src/app/api/search/facets/route.ts:24: import {
000971| NOTE: Imports dependency for this module.
000972| src/app/api/search/facets/route.ts:25:   createContextFromHeaders,
000973| NOTE: Implementation detail supporting search page behavior.
000974| src/app/api/search/facets/route.ts:26:   runWithRequestContext,
000975| NOTE: Implementation detail supporting search page behavior.
000976| src/app/api/search/facets/route.ts:27: } from "@/lib/request-context";
000977| NOTE: Implementation detail supporting search page behavior.
000978| src/app/api/search/facets/route.ts:28: import {
000979| NOTE: Imports dependency for this module.
000980| src/app/api/search/facets/route.ts:29:   sanitizeSearchQuery,
000981| NOTE: Implementation detail supporting search page behavior.
000982| src/app/api/search/facets/route.ts:30:   isValidQuery,
000983| NOTE: Implementation detail supporting search page behavior.
000984| src/app/api/search/facets/route.ts:31:   crossesAntimeridian,
000985| NOTE: Implementation detail supporting search page behavior.
000986| src/app/api/search/facets/route.ts:32: } from "@/lib/data";
000987| NOTE: Implementation detail supporting search page behavior.
000988| src/app/api/search/facets/route.ts:33: 
000989| NOTE: Blank line for visual separation.
000990| src/app/api/search/facets/route.ts:34: // Cache TTL in seconds
000991| NOTE: Line comment documents intent or constraints.
000992| src/app/api/search/facets/route.ts:35: const CACHE_TTL = 30;
000993| NOTE: Local declaration used by search logic or UI.
000994| src/app/api/search/facets/route.ts:36: 
000995| NOTE: Blank line for visual separation.
000996| src/app/api/search/facets/route.ts:37: // Maximum results per facet to prevent expensive aggregations
000997| NOTE: Line comment documents intent or constraints.
000998| src/app/api/search/facets/route.ts:38: const MAX_FACET_RESULTS = 100;
000999| NOTE: Local declaration used by search logic or UI.
001000| src/app/api/search/facets/route.ts:39: 
001001| NOTE: Blank line for visual separation.
001002| src/app/api/search/facets/route.ts:40: /**
001003| NOTE: Block comment line describing behavior or context.
001004| src/app/api/search/facets/route.ts:41:  * Response shape for facets endpoint
001005| NOTE: Block comment line describing behavior or context.
001006| src/app/api/search/facets/route.ts:42:  */
001007| NOTE: Block comment line describing behavior or context.
001008| src/app/api/search/facets/route.ts:43: export interface FacetsResponse {
001009| NOTE: Implementation detail supporting search page behavior.
001010| src/app/api/search/facets/route.ts:44:   amenities: Record<string, number>;
001011| NOTE: Implementation detail supporting search page behavior.
001012| src/app/api/search/facets/route.ts:45:   houseRules: Record<string, number>;
001013| NOTE: Implementation detail supporting search page behavior.
001014| src/app/api/search/facets/route.ts:46:   roomTypes: Record<string, number>;
001015| NOTE: Implementation detail supporting search page behavior.
001016| src/app/api/search/facets/route.ts:47:   priceRanges: {
001017| NOTE: Implementation detail supporting search page behavior.
001018| src/app/api/search/facets/route.ts:48:     min: number | null;
001019| NOTE: Implementation detail supporting search page behavior.
001020| src/app/api/search/facets/route.ts:49:     max: number | null;
001021| NOTE: Implementation detail supporting search page behavior.
001022| src/app/api/search/facets/route.ts:50:     median: number | null;
001023| NOTE: Implementation detail supporting search page behavior.
001024| src/app/api/search/facets/route.ts:51:   };
001025| NOTE: Implementation detail supporting search page behavior.
001026| src/app/api/search/facets/route.ts:52: }
001027| NOTE: Implementation detail supporting search page behavior.
001028| src/app/api/search/facets/route.ts:53: 
001029| NOTE: Blank line for visual separation.
001030| src/app/api/search/facets/route.ts:54: /**
001031| NOTE: Block comment line describing behavior or context.
001032| src/app/api/search/facets/route.ts:55:  * Parse date string to Date object
001033| NOTE: Block comment line describing behavior or context.
001034| src/app/api/search/facets/route.ts:56:  */
001035| NOTE: Block comment line describing behavior or context.
001036| src/app/api/search/facets/route.ts:57: function parseDateOnly(value: string): Date {
001037| NOTE: Defines a helper or component function.
001038| src/app/api/search/facets/route.ts:58:   const [year, month, day] = value.split("-").map(Number);
001039| NOTE: Local declaration used by search logic or UI.
001040| src/app/api/search/facets/route.ts:59:   return new Date(year, month - 1, day);
001041| NOTE: Return statement for component or helper output.
001042| src/app/api/search/facets/route.ts:60: }
001043| NOTE: Implementation detail supporting search page behavior.
001044| src/app/api/search/facets/route.ts:61: 
001045| NOTE: Blank line for visual separation.
001046| src/app/api/search/facets/route.ts:62: /**
001047| NOTE: Block comment line describing behavior or context.
001048| src/app/api/search/facets/route.ts:63:  * Build base WHERE conditions for facet queries.
001049| NOTE: Block comment line describing behavior or context.
001050| src/app/api/search/facets/route.ts:64:  * Similar to buildSearchDocWhereConditions but excludes the filter
001051| NOTE: Block comment line describing behavior or context.
001052| src/app/api/search/facets/route.ts:65:  * we're aggregating to show all options.
001053| NOTE: Block comment line describing behavior or context.
001054| src/app/api/search/facets/route.ts:66:  */
001055| NOTE: Block comment line describing behavior or context.
001056| src/app/api/search/facets/route.ts:67: interface WhereBuilder {
001057| NOTE: Type declaration for search data contracts.
001058| src/app/api/search/facets/route.ts:68:   conditions: string[];
001059| NOTE: Implementation detail supporting search page behavior.
001060| src/app/api/search/facets/route.ts:69:   params: unknown[];
001061| NOTE: Implementation detail supporting search page behavior.
001062| src/app/api/search/facets/route.ts:70:   paramIndex: number;
001063| NOTE: Implementation detail supporting search page behavior.
001064| src/app/api/search/facets/route.ts:71: }
001065| NOTE: Implementation detail supporting search page behavior.
001066| src/app/api/search/facets/route.ts:72: 
001067| NOTE: Blank line for visual separation.
001068| src/app/api/search/facets/route.ts:73: function buildFacetWhereConditions(
001069| NOTE: Defines a helper or component function.
001070| src/app/api/search/facets/route.ts:74:   filterParams: {
001071| NOTE: Implementation detail supporting search page behavior.
001072| src/app/api/search/facets/route.ts:75:     query?: string;
001073| NOTE: Implementation detail supporting search page behavior.
001074| src/app/api/search/facets/route.ts:76:     minPrice?: number;
001075| NOTE: Implementation detail supporting search page behavior.
001076| src/app/api/search/facets/route.ts:77:     maxPrice?: number;
001077| NOTE: Implementation detail supporting search page behavior.
001078| src/app/api/search/facets/route.ts:78:     amenities?: string[];
001079| NOTE: Implementation detail supporting search page behavior.
001080| src/app/api/search/facets/route.ts:79:     moveInDate?: string;
001081| NOTE: Implementation detail supporting search page behavior.
001082| src/app/api/search/facets/route.ts:80:     leaseDuration?: string;
001083| NOTE: Implementation detail supporting search page behavior.
001084| src/app/api/search/facets/route.ts:81:     houseRules?: string[];
001085| NOTE: Implementation detail supporting search page behavior.
001086| src/app/api/search/facets/route.ts:82:     roomType?: string;
001087| NOTE: Implementation detail supporting search page behavior.
001088| src/app/api/search/facets/route.ts:83:     languages?: string[];
001089| NOTE: Implementation detail supporting search page behavior.
001090| src/app/api/search/facets/route.ts:84:     bounds?: { minLng: number; minLat: number; maxLng: number; maxLat: number };
001091| NOTE: Implementation detail supporting search page behavior.
001092| src/app/api/search/facets/route.ts:85:   },
001093| NOTE: Implementation detail supporting search page behavior.
001094| src/app/api/search/facets/route.ts:86:   excludeFilter?: "amenities" | "houseRules" | "roomType" | "price",
001095| NOTE: Implementation detail supporting search page behavior.
001096| src/app/api/search/facets/route.ts:87: ): WhereBuilder {
001097| NOTE: Implementation detail supporting search page behavior.
001098| src/app/api/search/facets/route.ts:88:   const {
001099| NOTE: Local declaration used by search logic or UI.
001100| src/app/api/search/facets/route.ts:89:     query,
001101| NOTE: Implementation detail supporting search page behavior.
001102| src/app/api/search/facets/route.ts:90:     minPrice,
001103| NOTE: Implementation detail supporting search page behavior.
001104| src/app/api/search/facets/route.ts:91:     maxPrice,
001105| NOTE: Implementation detail supporting search page behavior.
001106| src/app/api/search/facets/route.ts:92:     amenities,
001107| NOTE: Implementation detail supporting search page behavior.
001108| src/app/api/search/facets/route.ts:93:     moveInDate,
001109| NOTE: Implementation detail supporting search page behavior.
001110| src/app/api/search/facets/route.ts:94:     leaseDuration,
001111| NOTE: Implementation detail supporting search page behavior.
001112| src/app/api/search/facets/route.ts:95:     houseRules,
001113| NOTE: Implementation detail supporting search page behavior.
001114| src/app/api/search/facets/route.ts:96:     roomType,
001115| NOTE: Implementation detail supporting search page behavior.
001116| src/app/api/search/facets/route.ts:97:     languages,
001117| NOTE: Implementation detail supporting search page behavior.
001118| src/app/api/search/facets/route.ts:98:     bounds,
001119| NOTE: Implementation detail supporting search page behavior.
001120| src/app/api/search/facets/route.ts:99:   } = filterParams;
001121| NOTE: Implementation detail supporting search page behavior.
001122| src/app/api/search/facets/route.ts:100: 
001123| NOTE: Blank line for visual separation.
001124| src/app/api/search/facets/route.ts:101:   // Base conditions
001125| NOTE: Line comment documents intent or constraints.
001126| src/app/api/search/facets/route.ts:102:   const conditions: string[] = [
001127| NOTE: Local declaration used by search logic or UI.
001128| src/app/api/search/facets/route.ts:103:     "d.available_slots > 0",
001129| NOTE: Implementation detail supporting search page behavior.
001130| src/app/api/search/facets/route.ts:104:     "d.status = 'ACTIVE'",
001131| NOTE: Implementation detail supporting search page behavior.
001132| src/app/api/search/facets/route.ts:105:     "d.lat IS NOT NULL",
001133| NOTE: Implementation detail supporting search page behavior.
001134| src/app/api/search/facets/route.ts:106:     "d.lng IS NOT NULL",
001135| NOTE: Implementation detail supporting search page behavior.
001136| src/app/api/search/facets/route.ts:107:   ];
001137| NOTE: Implementation detail supporting search page behavior.
001138| src/app/api/search/facets/route.ts:108:   const params: unknown[] = [];
001139| NOTE: Local declaration used by search logic or UI.
001140| src/app/api/search/facets/route.ts:109:   let paramIndex = 1;
001141| NOTE: Local declaration used by search logic or UI.
001142| src/app/api/search/facets/route.ts:110: 
001143| NOTE: Blank line for visual separation.
001144| src/app/api/search/facets/route.ts:111:   // Geographic bounds filter
001145| NOTE: Line comment documents intent or constraints.
001146| src/app/api/search/facets/route.ts:112:   if (bounds) {
001147| NOTE: Conditional logic controlling rendering or flow.
001148| src/app/api/search/facets/route.ts:113:     if (crossesAntimeridian(bounds.minLng, bounds.maxLng)) {
001149| NOTE: Conditional logic controlling rendering or flow.
001150| src/app/api/search/facets/route.ts:114:       conditions.push(`(
001151| NOTE: Implementation detail supporting search page behavior.
001152| src/app/api/search/facets/route.ts:115:         d.location_geog && ST_MakeEnvelope($${paramIndex}, $${paramIndex + 1}, 180, $${paramIndex + 2}, 4326)::geography
001153| NOTE: Implementation detail supporting search page behavior.
001154| src/app/api/search/facets/route.ts:116:         OR d.location_geog && ST_MakeEnvelope(-180, $${paramIndex + 1}, $${paramIndex + 3}, $${paramIndex + 2}, 4326)::geography
001155| NOTE: Implementation detail supporting search page behavior.
001156| src/app/api/search/facets/route.ts:117:       )`);
001157| NOTE: Implementation detail supporting search page behavior.
001158| src/app/api/search/facets/route.ts:118:       params.push(bounds.minLng, bounds.minLat, bounds.maxLat, bounds.maxLng);
001159| NOTE: Implementation detail supporting search page behavior.
001160| src/app/api/search/facets/route.ts:119:       paramIndex += 4;
001161| NOTE: Implementation detail supporting search page behavior.
001162| src/app/api/search/facets/route.ts:120:     } else {
001163| NOTE: Implementation detail supporting search page behavior.
001164| src/app/api/search/facets/route.ts:121:       conditions.push(
001165| NOTE: Implementation detail supporting search page behavior.
001166| src/app/api/search/facets/route.ts:122:         `d.location_geog && ST_MakeEnvelope($${paramIndex}, $${paramIndex + 1}, $${paramIndex + 2}, $${paramIndex + 3}, 4326)::geography`,
001167| NOTE: Implementation detail supporting search page behavior.
001168| src/app/api/search/facets/route.ts:123:       );
001169| NOTE: Implementation detail supporting search page behavior.
001170| src/app/api/search/facets/route.ts:124:       params.push(bounds.minLng, bounds.minLat, bounds.maxLng, bounds.maxLat);
001171| NOTE: Implementation detail supporting search page behavior.
001172| src/app/api/search/facets/route.ts:125:       paramIndex += 4;
001173| NOTE: Implementation detail supporting search page behavior.
001174| src/app/api/search/facets/route.ts:126:     }
001175| NOTE: Implementation detail supporting search page behavior.
001176| src/app/api/search/facets/route.ts:127:   }
001177| NOTE: Implementation detail supporting search page behavior.
001178| src/app/api/search/facets/route.ts:128: 
001179| NOTE: Blank line for visual separation.
001180| src/app/api/search/facets/route.ts:129:   // Price range filter (exclude when aggregating price facet)
001181| NOTE: Line comment documents intent or constraints.
001182| src/app/api/search/facets/route.ts:130:   if (excludeFilter !== "price") {
001183| NOTE: Conditional logic controlling rendering or flow.
001184| src/app/api/search/facets/route.ts:131:     if (minPrice !== undefined && minPrice !== null) {
001185| NOTE: Conditional logic controlling rendering or flow.
001186| src/app/api/search/facets/route.ts:132:       conditions.push(`d.price >= $${paramIndex++}`);
001187| NOTE: Implementation detail supporting search page behavior.
001188| src/app/api/search/facets/route.ts:133:       params.push(minPrice);
001189| NOTE: Implementation detail supporting search page behavior.
001190| src/app/api/search/facets/route.ts:134:     }
001191| NOTE: Implementation detail supporting search page behavior.
001192| src/app/api/search/facets/route.ts:135:     if (maxPrice !== undefined && maxPrice !== null) {
001193| NOTE: Conditional logic controlling rendering or flow.
001194| src/app/api/search/facets/route.ts:136:       conditions.push(`d.price <= $${paramIndex++}`);
001195| NOTE: Implementation detail supporting search page behavior.
001196| src/app/api/search/facets/route.ts:137:       params.push(maxPrice);
001197| NOTE: Implementation detail supporting search page behavior.
001198| src/app/api/search/facets/route.ts:138:     }
001199| NOTE: Implementation detail supporting search page behavior.
001200| src/app/api/search/facets/route.ts:139:   }
001201| NOTE: Implementation detail supporting search page behavior.
001202| src/app/api/search/facets/route.ts:140: 
001203| NOTE: Blank line for visual separation.
001204| src/app/api/search/facets/route.ts:141:   // Text search filter
001205| NOTE: Line comment documents intent or constraints.
001206| src/app/api/search/facets/route.ts:142:   if (query && isValidQuery(query)) {
001207| NOTE: Conditional logic controlling rendering or flow.
001208| src/app/api/search/facets/route.ts:143:     const sanitizedQuery = sanitizeSearchQuery(query);
001209| NOTE: Local declaration used by search logic or UI.
001210| src/app/api/search/facets/route.ts:144:     if (sanitizedQuery) {
001211| NOTE: Conditional logic controlling rendering or flow.
001212| src/app/api/search/facets/route.ts:145:       const searchPattern = `%${sanitizedQuery}%`;
001213| NOTE: Local declaration used by search logic or UI.
001214| src/app/api/search/facets/route.ts:146:       conditions.push(`(
001215| NOTE: Implementation detail supporting search page behavior.
001216| src/app/api/search/facets/route.ts:147:         LOWER(d.title) LIKE LOWER($${paramIndex}) OR
001217| NOTE: Implementation detail supporting search page behavior.
001218| src/app/api/search/facets/route.ts:148:         LOWER(d.description) LIKE LOWER($${paramIndex}) OR
001219| NOTE: Implementation detail supporting search page behavior.
001220| src/app/api/search/facets/route.ts:149:         LOWER(d.city) LIKE LOWER($${paramIndex}) OR
001221| NOTE: Implementation detail supporting search page behavior.
001222| src/app/api/search/facets/route.ts:150:         LOWER(d.state) LIKE LOWER($${paramIndex})
001223| NOTE: Implementation detail supporting search page behavior.
001224| src/app/api/search/facets/route.ts:151:       )`);
001225| NOTE: Implementation detail supporting search page behavior.
001226| src/app/api/search/facets/route.ts:152:       params.push(searchPattern);
001227| NOTE: Implementation detail supporting search page behavior.
001228| src/app/api/search/facets/route.ts:153:       paramIndex++;
001229| NOTE: Implementation detail supporting search page behavior.
001230| src/app/api/search/facets/route.ts:154:     }
001231| NOTE: Implementation detail supporting search page behavior.
001232| src/app/api/search/facets/route.ts:155:   }
001233| NOTE: Implementation detail supporting search page behavior.
001234| src/app/api/search/facets/route.ts:156: 
001235| NOTE: Blank line for visual separation.
001236| src/app/api/search/facets/route.ts:157:   // Room type filter (exclude when aggregating roomType facet)
001237| NOTE: Line comment documents intent or constraints.
001238| src/app/api/search/facets/route.ts:158:   if (excludeFilter !== "roomType" && roomType) {
001239| NOTE: Conditional logic controlling rendering or flow.
001240| src/app/api/search/facets/route.ts:159:     conditions.push(`LOWER(d.room_type) = LOWER($${paramIndex++})`);
001241| NOTE: Implementation detail supporting search page behavior.
001242| src/app/api/search/facets/route.ts:160:     params.push(roomType);
001243| NOTE: Implementation detail supporting search page behavior.
001244| src/app/api/search/facets/route.ts:161:   }
001245| NOTE: Implementation detail supporting search page behavior.
001246| src/app/api/search/facets/route.ts:162: 
001247| NOTE: Blank line for visual separation.
001248| src/app/api/search/facets/route.ts:163:   // Lease duration filter
001249| NOTE: Line comment documents intent or constraints.
001250| src/app/api/search/facets/route.ts:164:   if (leaseDuration) {
001251| NOTE: Conditional logic controlling rendering or flow.
001252| src/app/api/search/facets/route.ts:165:     conditions.push(`LOWER(d.lease_duration) = LOWER($${paramIndex++})`);
001253| NOTE: Implementation detail supporting search page behavior.
001254| src/app/api/search/facets/route.ts:166:     params.push(leaseDuration);
001255| NOTE: Implementation detail supporting search page behavior.
001256| src/app/api/search/facets/route.ts:167:   }
001257| NOTE: Implementation detail supporting search page behavior.
001258| src/app/api/search/facets/route.ts:168: 
001259| NOTE: Blank line for visual separation.
001260| src/app/api/search/facets/route.ts:169:   // Move-in date filter
001261| NOTE: Line comment documents intent or constraints.
001262| src/app/api/search/facets/route.ts:170:   if (moveInDate) {
001263| NOTE: Conditional logic controlling rendering or flow.
001264| src/app/api/search/facets/route.ts:171:     conditions.push(
001265| NOTE: Implementation detail supporting search page behavior.
001266| src/app/api/search/facets/route.ts:172:       `(d.move_in_date IS NULL OR d.move_in_date <= $${paramIndex++})`,
001267| NOTE: Implementation detail supporting search page behavior.
001268| src/app/api/search/facets/route.ts:173:     );
001269| NOTE: Implementation detail supporting search page behavior.
001270| src/app/api/search/facets/route.ts:174:     params.push(parseDateOnly(moveInDate));
001271| NOTE: Implementation detail supporting search page behavior.
001272| src/app/api/search/facets/route.ts:175:   }
001273| NOTE: Implementation detail supporting search page behavior.
001274| src/app/api/search/facets/route.ts:176: 
001275| NOTE: Blank line for visual separation.
001276| src/app/api/search/facets/route.ts:177:   // Languages filter (OR logic)
001277| NOTE: Line comment documents intent or constraints.
001278| src/app/api/search/facets/route.ts:178:   if (languages?.length) {
001279| NOTE: Conditional logic controlling rendering or flow.
001280| src/app/api/search/facets/route.ts:179:     const normalized = languages
001281| NOTE: Local declaration used by search logic or UI.
001282| src/app/api/search/facets/route.ts:180:       .map((l) => l.trim().toLowerCase())
001283| NOTE: Implementation detail supporting search page behavior.
001284| src/app/api/search/facets/route.ts:181:       .filter(Boolean);
001285| NOTE: Implementation detail supporting search page behavior.
001286| src/app/api/search/facets/route.ts:182:     if (normalized.length > 0) {
001287| NOTE: Conditional logic controlling rendering or flow.
001288| src/app/api/search/facets/route.ts:183:       conditions.push(
001289| NOTE: Implementation detail supporting search page behavior.
001290| src/app/api/search/facets/route.ts:184:         `d.household_languages_lower && $${paramIndex++}::text[]`,
001291| NOTE: Implementation detail supporting search page behavior.
001292| src/app/api/search/facets/route.ts:185:       );
001293| NOTE: Implementation detail supporting search page behavior.
001294| src/app/api/search/facets/route.ts:186:       params.push(normalized);
001295| NOTE: Implementation detail supporting search page behavior.
001296| src/app/api/search/facets/route.ts:187:     }
001297| NOTE: Implementation detail supporting search page behavior.
001298| src/app/api/search/facets/route.ts:188:   }
001299| NOTE: Implementation detail supporting search page behavior.
001300| src/app/api/search/facets/route.ts:189: 
001301| NOTE: Blank line for visual separation.
001302| src/app/api/search/facets/route.ts:190:   // Amenities filter (AND logic) - exclude when aggregating amenities facet
001303| NOTE: Line comment documents intent or constraints.
001304| src/app/api/search/facets/route.ts:191:   if (excludeFilter !== "amenities" && amenities?.length) {
001305| NOTE: Conditional logic controlling rendering or flow.
001306| src/app/api/search/facets/route.ts:192:     const normalizedAmenities = amenities
001307| NOTE: Local declaration used by search logic or UI.
001308| src/app/api/search/facets/route.ts:193:       .map((a) => a.trim().toLowerCase())
001309| NOTE: Implementation detail supporting search page behavior.
001310| src/app/api/search/facets/route.ts:194:       .filter(Boolean);
001311| NOTE: Implementation detail supporting search page behavior.
001312| src/app/api/search/facets/route.ts:195:     if (normalizedAmenities.length > 0) {
001313| NOTE: Conditional logic controlling rendering or flow.
001314| src/app/api/search/facets/route.ts:196:       conditions.push(`NOT EXISTS (
001315| NOTE: Implementation detail supporting search page behavior.
001316| src/app/api/search/facets/route.ts:197:         SELECT 1 FROM unnest($${paramIndex++}::text[]) AS search_term
001317| NOTE: Implementation detail supporting search page behavior.
001318| src/app/api/search/facets/route.ts:198:         WHERE NOT EXISTS (
001319| NOTE: Implementation detail supporting search page behavior.
001320| src/app/api/search/facets/route.ts:199:           SELECT 1 FROM unnest(d.amenities_lower) AS la
001321| NOTE: Implementation detail supporting search page behavior.
001322| src/app/api/search/facets/route.ts:200:           WHERE la LIKE '%' || search_term || '%'
001323| NOTE: Implementation detail supporting search page behavior.
001324| src/app/api/search/facets/route.ts:201:         )
001325| NOTE: Implementation detail supporting search page behavior.
001326| src/app/api/search/facets/route.ts:202:       )`);
001327| NOTE: Implementation detail supporting search page behavior.
001328| src/app/api/search/facets/route.ts:203:       params.push(normalizedAmenities);
001329| NOTE: Implementation detail supporting search page behavior.
001330| src/app/api/search/facets/route.ts:204:     }
001331| NOTE: Implementation detail supporting search page behavior.
001332| src/app/api/search/facets/route.ts:205:   }
001333| NOTE: Implementation detail supporting search page behavior.
001334| src/app/api/search/facets/route.ts:206: 
001335| NOTE: Blank line for visual separation.
001336| src/app/api/search/facets/route.ts:207:   // House rules filter (AND logic) - exclude when aggregating houseRules facet
001337| NOTE: Line comment documents intent or constraints.
001338| src/app/api/search/facets/route.ts:208:   if (excludeFilter !== "houseRules" && houseRules?.length) {
001339| NOTE: Conditional logic controlling rendering or flow.
001340| src/app/api/search/facets/route.ts:209:     const normalizedRules = houseRules
001341| NOTE: Local declaration used by search logic or UI.
001342| src/app/api/search/facets/route.ts:210:       .map((r) => r.trim().toLowerCase())
001343| NOTE: Implementation detail supporting search page behavior.
001344| src/app/api/search/facets/route.ts:211:       .filter(Boolean);
001345| NOTE: Implementation detail supporting search page behavior.
001346| src/app/api/search/facets/route.ts:212:     if (normalizedRules.length > 0) {
001347| NOTE: Conditional logic controlling rendering or flow.
001348| src/app/api/search/facets/route.ts:213:       conditions.push(`d.house_rules_lower @> $${paramIndex++}::text[]`);
001349| NOTE: Implementation detail supporting search page behavior.
001350| src/app/api/search/facets/route.ts:214:       params.push(normalizedRules);
001351| NOTE: Implementation detail supporting search page behavior.
001352| src/app/api/search/facets/route.ts:215:     }
001353| NOTE: Implementation detail supporting search page behavior.
001354| src/app/api/search/facets/route.ts:216:   }
001355| NOTE: Implementation detail supporting search page behavior.
001356| src/app/api/search/facets/route.ts:217: 
001357| NOTE: Blank line for visual separation.
001358| src/app/api/search/facets/route.ts:218:   return { conditions, params, paramIndex };
001359| NOTE: Return statement for component or helper output.
001360| src/app/api/search/facets/route.ts:219: }
001361| NOTE: Implementation detail supporting search page behavior.
001362| src/app/api/search/facets/route.ts:220: 
001363| NOTE: Blank line for visual separation.
001364| src/app/api/search/facets/route.ts:221: /**
001365| NOTE: Block comment line describing behavior or context.
001366| src/app/api/search/facets/route.ts:222:  * Get amenities facet counts
001367| NOTE: Block comment line describing behavior or context.
001368| src/app/api/search/facets/route.ts:223:  */
001369| NOTE: Block comment line describing behavior or context.
001370| src/app/api/search/facets/route.ts:224: async function getAmenitiesFacet(
001371| NOTE: Implementation detail supporting search page behavior.
001372| src/app/api/search/facets/route.ts:225:   filterParams: Parameters<typeof buildFacetWhereConditions>[0],
001373| NOTE: Implementation detail supporting search page behavior.
001374| src/app/api/search/facets/route.ts:226: ): Promise<Record<string, number>> {
001375| NOTE: Implementation detail supporting search page behavior.
001376| src/app/api/search/facets/route.ts:227:   const { conditions, params, paramIndex } = buildFacetWhereConditions(
001377| NOTE: Local declaration used by search logic or UI.
001378| src/app/api/search/facets/route.ts:228:     filterParams,
001379| NOTE: Implementation detail supporting search page behavior.
001380| src/app/api/search/facets/route.ts:229:     "amenities",
001381| NOTE: Implementation detail supporting search page behavior.
001382| src/app/api/search/facets/route.ts:230:   );
001383| NOTE: Implementation detail supporting search page behavior.
001384| src/app/api/search/facets/route.ts:231:   const whereClause = conditions.join(" AND ");
001385| NOTE: Local declaration used by search logic or UI.
001386| src/app/api/search/facets/route.ts:232: 
001387| NOTE: Blank line for visual separation.
001388| src/app/api/search/facets/route.ts:233:   // Unnest amenities array and count occurrences
001389| NOTE: Line comment documents intent or constraints.
001390| src/app/api/search/facets/route.ts:234:   // Use original amenities array (not lowercase) for display
001391| NOTE: Line comment documents intent or constraints.
001392| src/app/api/search/facets/route.ts:235:   const query = `
001393| NOTE: Local declaration used by search logic or UI.
001394| src/app/api/search/facets/route.ts:236:     SELECT
001395| NOTE: Implementation detail supporting search page behavior.
001396| src/app/api/search/facets/route.ts:237:       amenity,
001397| NOTE: Implementation detail supporting search page behavior.
001398| src/app/api/search/facets/route.ts:238:       COUNT(DISTINCT d.id) as count
001399| NOTE: Implementation detail supporting search page behavior.
001400| src/app/api/search/facets/route.ts:239:     FROM listing_search_docs d,
001401| NOTE: Implementation detail supporting search page behavior.
001402| src/app/api/search/facets/route.ts:240:          unnest(d.amenities) AS amenity
001403| NOTE: Implementation detail supporting search page behavior.
001404| src/app/api/search/facets/route.ts:241:     WHERE ${whereClause}
001405| NOTE: Implementation detail supporting search page behavior.
001406| src/app/api/search/facets/route.ts:242:     GROUP BY amenity
001407| NOTE: Implementation detail supporting search page behavior.
001408| src/app/api/search/facets/route.ts:243:     ORDER BY count DESC
001409| NOTE: Implementation detail supporting search page behavior.
001410| src/app/api/search/facets/route.ts:244:     LIMIT $${paramIndex}
001411| NOTE: Implementation detail supporting search page behavior.
001412| src/app/api/search/facets/route.ts:245:   `;
001413| NOTE: Implementation detail supporting search page behavior.
001414| src/app/api/search/facets/route.ts:246: 
001415| NOTE: Blank line for visual separation.
001416| src/app/api/search/facets/route.ts:247:   const results = await prisma.$queryRawUnsafe<
001417| NOTE: Local declaration used by search logic or UI.
001418| src/app/api/search/facets/route.ts:248:     { amenity: string; count: bigint }[]
001419| NOTE: Implementation detail supporting search page behavior.
001420| src/app/api/search/facets/route.ts:249:   >(query, ...params, MAX_FACET_RESULTS);
001421| NOTE: Implementation detail supporting search page behavior.
001422| src/app/api/search/facets/route.ts:250: 
001423| NOTE: Blank line for visual separation.
001424| src/app/api/search/facets/route.ts:251:   const facets: Record<string, number> = {};
001425| NOTE: Local declaration used by search logic or UI.
001426| src/app/api/search/facets/route.ts:252:   for (const row of results) {
001427| NOTE: Implementation detail supporting search page behavior.
001428| src/app/api/search/facets/route.ts:253:     facets[row.amenity] = Number(row.count);
001429| NOTE: Implementation detail supporting search page behavior.
001430| src/app/api/search/facets/route.ts:254:   }
001431| NOTE: Implementation detail supporting search page behavior.
001432| src/app/api/search/facets/route.ts:255:   return facets;
001433| NOTE: Return statement for component or helper output.
001434| src/app/api/search/facets/route.ts:256: }
001435| NOTE: Implementation detail supporting search page behavior.
001436| src/app/api/search/facets/route.ts:257: 
001437| NOTE: Blank line for visual separation.
001438| src/app/api/search/facets/route.ts:258: /**
001439| NOTE: Block comment line describing behavior or context.
001440| src/app/api/search/facets/route.ts:259:  * Get house rules facet counts
001441| NOTE: Block comment line describing behavior or context.
001442| src/app/api/search/facets/route.ts:260:  */
001443| NOTE: Block comment line describing behavior or context.
001444| src/app/api/search/facets/route.ts:261: async function getHouseRulesFacet(
001445| NOTE: Implementation detail supporting search page behavior.
001446| src/app/api/search/facets/route.ts:262:   filterParams: Parameters<typeof buildFacetWhereConditions>[0],
001447| NOTE: Implementation detail supporting search page behavior.
001448| src/app/api/search/facets/route.ts:263: ): Promise<Record<string, number>> {
001449| NOTE: Implementation detail supporting search page behavior.
001450| src/app/api/search/facets/route.ts:264:   const { conditions, params, paramIndex } = buildFacetWhereConditions(
001451| NOTE: Local declaration used by search logic or UI.
001452| src/app/api/search/facets/route.ts:265:     filterParams,
001453| NOTE: Implementation detail supporting search page behavior.
001454| src/app/api/search/facets/route.ts:266:     "houseRules",
001455| NOTE: Implementation detail supporting search page behavior.
001456| src/app/api/search/facets/route.ts:267:   );
001457| NOTE: Implementation detail supporting search page behavior.
001458| src/app/api/search/facets/route.ts:268:   const whereClause = conditions.join(" AND ");
001459| NOTE: Local declaration used by search logic or UI.
001460| src/app/api/search/facets/route.ts:269: 
001461| NOTE: Blank line for visual separation.
001462| src/app/api/search/facets/route.ts:270:   // Unnest house_rules array and count occurrences
001463| NOTE: Line comment documents intent or constraints.
001464| src/app/api/search/facets/route.ts:271:   const query = `
001465| NOTE: Local declaration used by search logic or UI.
001466| src/app/api/search/facets/route.ts:272:     SELECT
001467| NOTE: Implementation detail supporting search page behavior.
001468| src/app/api/search/facets/route.ts:273:       rule,
001469| NOTE: Implementation detail supporting search page behavior.
001470| src/app/api/search/facets/route.ts:274:       COUNT(DISTINCT d.id) as count
001471| NOTE: Implementation detail supporting search page behavior.
001472| src/app/api/search/facets/route.ts:275:     FROM listing_search_docs d,
001473| NOTE: Implementation detail supporting search page behavior.
001474| src/app/api/search/facets/route.ts:276:          unnest(d.house_rules) AS rule
001475| NOTE: Implementation detail supporting search page behavior.
001476| src/app/api/search/facets/route.ts:277:     WHERE ${whereClause}
001477| NOTE: Implementation detail supporting search page behavior.
001478| src/app/api/search/facets/route.ts:278:     GROUP BY rule
001479| NOTE: Implementation detail supporting search page behavior.
001480| src/app/api/search/facets/route.ts:279:     ORDER BY count DESC
001481| NOTE: Implementation detail supporting search page behavior.
001482| src/app/api/search/facets/route.ts:280:     LIMIT $${paramIndex}
001483| NOTE: Implementation detail supporting search page behavior.
001484| src/app/api/search/facets/route.ts:281:   `;
001485| NOTE: Implementation detail supporting search page behavior.
001486| src/app/api/search/facets/route.ts:282: 
001487| NOTE: Blank line for visual separation.
001488| src/app/api/search/facets/route.ts:283:   const results = await prisma.$queryRawUnsafe<
001489| NOTE: Local declaration used by search logic or UI.
001490| src/app/api/search/facets/route.ts:284:     { rule: string; count: bigint }[]
001491| NOTE: Implementation detail supporting search page behavior.
001492| src/app/api/search/facets/route.ts:285:   >(query, ...params, MAX_FACET_RESULTS);
001493| NOTE: Implementation detail supporting search page behavior.
001494| src/app/api/search/facets/route.ts:286: 
001495| NOTE: Blank line for visual separation.
001496| src/app/api/search/facets/route.ts:287:   const facets: Record<string, number> = {};
001497| NOTE: Local declaration used by search logic or UI.
001498| src/app/api/search/facets/route.ts:288:   for (const row of results) {
001499| NOTE: Implementation detail supporting search page behavior.
001500| src/app/api/search/facets/route.ts:289:     facets[row.rule] = Number(row.count);
001501| NOTE: Implementation detail supporting search page behavior.
001502| src/app/api/search/facets/route.ts:290:   }
001503| NOTE: Implementation detail supporting search page behavior.
001504| src/app/api/search/facets/route.ts:291:   return facets;
001505| NOTE: Return statement for component or helper output.
001506| src/app/api/search/facets/route.ts:292: }
001507| NOTE: Implementation detail supporting search page behavior.
001508| src/app/api/search/facets/route.ts:293: 
001509| NOTE: Blank line for visual separation.
001510| src/app/api/search/facets/route.ts:294: /**
001511| NOTE: Block comment line describing behavior or context.
001512| src/app/api/search/facets/route.ts:295:  * Get room types facet counts
001513| NOTE: Block comment line describing behavior or context.
001514| src/app/api/search/facets/route.ts:296:  */
001515| NOTE: Block comment line describing behavior or context.
001516| src/app/api/search/facets/route.ts:297: async function getRoomTypesFacet(
001517| NOTE: Implementation detail supporting search page behavior.
001518| src/app/api/search/facets/route.ts:298:   filterParams: Parameters<typeof buildFacetWhereConditions>[0],
001519| NOTE: Implementation detail supporting search page behavior.
001520| src/app/api/search/facets/route.ts:299: ): Promise<Record<string, number>> {
001521| NOTE: Implementation detail supporting search page behavior.
001522| src/app/api/search/facets/route.ts:300:   const { conditions, params, paramIndex } = buildFacetWhereConditions(
001523| NOTE: Local declaration used by search logic or UI.
001524| src/app/api/search/facets/route.ts:301:     filterParams,
001525| NOTE: Implementation detail supporting search page behavior.
001526| src/app/api/search/facets/route.ts:302:     "roomType",
001527| NOTE: Implementation detail supporting search page behavior.
001528| src/app/api/search/facets/route.ts:303:   );
001529| NOTE: Implementation detail supporting search page behavior.
001530| src/app/api/search/facets/route.ts:304:   const whereClause = conditions.join(" AND ");
001531| NOTE: Local declaration used by search logic or UI.
001532| src/app/api/search/facets/route.ts:305: 
001533| NOTE: Blank line for visual separation.
001534| src/app/api/search/facets/route.ts:306:   // Simple GROUP BY on room_type column
001535| NOTE: Line comment documents intent or constraints.
001536| src/app/api/search/facets/route.ts:307:   const query = `
001537| NOTE: Local declaration used by search logic or UI.
001538| src/app/api/search/facets/route.ts:308:     SELECT
001539| NOTE: Implementation detail supporting search page behavior.
001540| src/app/api/search/facets/route.ts:309:       d.room_type as "roomType",
001541| NOTE: Implementation detail supporting search page behavior.
001542| src/app/api/search/facets/route.ts:310:       COUNT(*) as count
001543| NOTE: Implementation detail supporting search page behavior.
001544| src/app/api/search/facets/route.ts:311:     FROM listing_search_docs d
001545| NOTE: Implementation detail supporting search page behavior.
001546| src/app/api/search/facets/route.ts:312:     WHERE ${whereClause}
001547| NOTE: Implementation detail supporting search page behavior.
001548| src/app/api/search/facets/route.ts:313:       AND d.room_type IS NOT NULL
001549| NOTE: Implementation detail supporting search page behavior.
001550| src/app/api/search/facets/route.ts:314:     GROUP BY d.room_type
001551| NOTE: Implementation detail supporting search page behavior.
001552| src/app/api/search/facets/route.ts:315:     ORDER BY count DESC
001553| NOTE: Implementation detail supporting search page behavior.
001554| src/app/api/search/facets/route.ts:316:     LIMIT $${paramIndex}
001555| NOTE: Implementation detail supporting search page behavior.
001556| src/app/api/search/facets/route.ts:317:   `;
001557| NOTE: Implementation detail supporting search page behavior.
001558| src/app/api/search/facets/route.ts:318: 
001559| NOTE: Blank line for visual separation.
001560| src/app/api/search/facets/route.ts:319:   const results = await prisma.$queryRawUnsafe<
001561| NOTE: Local declaration used by search logic or UI.
001562| src/app/api/search/facets/route.ts:320:     { roomType: string; count: bigint }[]
001563| NOTE: Implementation detail supporting search page behavior.
001564| src/app/api/search/facets/route.ts:321:   >(query, ...params, MAX_FACET_RESULTS);
001565| NOTE: Implementation detail supporting search page behavior.
001566| src/app/api/search/facets/route.ts:322: 
001567| NOTE: Blank line for visual separation.
001568| src/app/api/search/facets/route.ts:323:   const facets: Record<string, number> = {};
001569| NOTE: Local declaration used by search logic or UI.
001570| src/app/api/search/facets/route.ts:324:   for (const row of results) {
001571| NOTE: Implementation detail supporting search page behavior.
001572| src/app/api/search/facets/route.ts:325:     facets[row.roomType] = Number(row.count);
001573| NOTE: Implementation detail supporting search page behavior.
001574| src/app/api/search/facets/route.ts:326:   }
001575| NOTE: Implementation detail supporting search page behavior.
001576| src/app/api/search/facets/route.ts:327:   return facets;
001577| NOTE: Return statement for component or helper output.
001578| src/app/api/search/facets/route.ts:328: }
001579| NOTE: Implementation detail supporting search page behavior.
001580| src/app/api/search/facets/route.ts:329: 
001581| NOTE: Blank line for visual separation.
001582| src/app/api/search/facets/route.ts:330: /**
001583| NOTE: Block comment line describing behavior or context.
001584| src/app/api/search/facets/route.ts:331:  * Get price range statistics
001585| NOTE: Block comment line describing behavior or context.
001586| src/app/api/search/facets/route.ts:332:  */
001587| NOTE: Block comment line describing behavior or context.
001588| src/app/api/search/facets/route.ts:333: async function getPriceRanges(
001589| NOTE: Implementation detail supporting search page behavior.
001590| src/app/api/search/facets/route.ts:334:   filterParams: Parameters<typeof buildFacetWhereConditions>[0],
001591| NOTE: Implementation detail supporting search page behavior.
001592| src/app/api/search/facets/route.ts:335: ): Promise<{ min: number | null; max: number | null; median: number | null }> {
001593| NOTE: Implementation detail supporting search page behavior.
001594| src/app/api/search/facets/route.ts:336:   const { conditions, params } = buildFacetWhereConditions(
001595| NOTE: Local declaration used by search logic or UI.
001596| src/app/api/search/facets/route.ts:337:     filterParams,
001597| NOTE: Implementation detail supporting search page behavior.
001598| src/app/api/search/facets/route.ts:338:     "price",
001599| NOTE: Implementation detail supporting search page behavior.
001600| src/app/api/search/facets/route.ts:339:   );
001601| NOTE: Implementation detail supporting search page behavior.
001602| src/app/api/search/facets/route.ts:340:   const whereClause = conditions.join(" AND ");
001603| NOTE: Local declaration used by search logic or UI.
001604| src/app/api/search/facets/route.ts:341: 
001605| NOTE: Blank line for visual separation.
001606| src/app/api/search/facets/route.ts:342:   // Get min, max, and median (50th percentile) for prices
001607| NOTE: Line comment documents intent or constraints.
001608| src/app/api/search/facets/route.ts:343:   const query = `
001609| NOTE: Local declaration used by search logic or UI.
001610| src/app/api/search/facets/route.ts:344:     SELECT
001611| NOTE: Implementation detail supporting search page behavior.
001612| src/app/api/search/facets/route.ts:345:       MIN(d.price) as min,
001613| NOTE: Implementation detail supporting search page behavior.
001614| src/app/api/search/facets/route.ts:346:       MAX(d.price) as max,
001615| NOTE: Implementation detail supporting search page behavior.
001616| src/app/api/search/facets/route.ts:347:       percentile_cont(0.5) WITHIN GROUP (ORDER BY d.price) as median
001617| NOTE: Implementation detail supporting search page behavior.
001618| src/app/api/search/facets/route.ts:348:     FROM listing_search_docs d
001619| NOTE: Implementation detail supporting search page behavior.
001620| src/app/api/search/facets/route.ts:349:     WHERE ${whereClause}
001621| NOTE: Implementation detail supporting search page behavior.
001622| src/app/api/search/facets/route.ts:350:       AND d.price IS NOT NULL
001623| NOTE: Implementation detail supporting search page behavior.
001624| src/app/api/search/facets/route.ts:351:   `;
001625| NOTE: Implementation detail supporting search page behavior.
001626| src/app/api/search/facets/route.ts:352: 
001627| NOTE: Blank line for visual separation.
001628| src/app/api/search/facets/route.ts:353:   const results = await prisma.$queryRawUnsafe<
001629| NOTE: Local declaration used by search logic or UI.
001630| src/app/api/search/facets/route.ts:354:     { min: number | null; max: number | null; median: number | null }[]
001631| NOTE: Implementation detail supporting search page behavior.
001632| src/app/api/search/facets/route.ts:355:   >(query, ...params);
001633| NOTE: Implementation detail supporting search page behavior.
001634| src/app/api/search/facets/route.ts:356: 
001635| NOTE: Blank line for visual separation.
001636| src/app/api/search/facets/route.ts:357:   const row = results[0];
001637| NOTE: Local declaration used by search logic or UI.
001638| src/app/api/search/facets/route.ts:358:   return {
001639| NOTE: Return statement for component or helper output.
001640| src/app/api/search/facets/route.ts:359:     min: row?.min !== null ? Number(row.min) : null,
001641| NOTE: Implementation detail supporting search page behavior.
001642| src/app/api/search/facets/route.ts:360:     max: row?.max !== null ? Number(row.max) : null,
001643| NOTE: Implementation detail supporting search page behavior.
001644| src/app/api/search/facets/route.ts:361:     median: row?.median !== null ? Number(row.median) : null,
001645| NOTE: Implementation detail supporting search page behavior.
001646| src/app/api/search/facets/route.ts:362:   };
001647| NOTE: Implementation detail supporting search page behavior.
001648| src/app/api/search/facets/route.ts:363: }
001649| NOTE: Implementation detail supporting search page behavior.
001650| src/app/api/search/facets/route.ts:364: 
001651| NOTE: Blank line for visual separation.
001652| src/app/api/search/facets/route.ts:365: /**
001653| NOTE: Block comment line describing behavior or context.
001654| src/app/api/search/facets/route.ts:366:  * Generate cache key for facets request
001655| NOTE: Block comment line describing behavior or context.
001656| src/app/api/search/facets/route.ts:367:  */
001657| NOTE: Block comment line describing behavior or context.
001658| src/app/api/search/facets/route.ts:368: function generateFacetsCacheKey(
001659| NOTE: Defines a helper or component function.
001660| src/app/api/search/facets/route.ts:369:   filterParams: Parameters<typeof buildFacetWhereConditions>[0],
001661| NOTE: Implementation detail supporting search page behavior.
001662| src/app/api/search/facets/route.ts:370: ): string {
001663| NOTE: Implementation detail supporting search page behavior.
001664| src/app/api/search/facets/route.ts:371:   const normalized = {
001665| NOTE: Local declaration used by search logic or UI.
001666| src/app/api/search/facets/route.ts:372:     q: filterParams.query?.toLowerCase().trim() || "",
001667| NOTE: Implementation detail supporting search page behavior.
001668| src/app/api/search/facets/route.ts:373:     minPrice: filterParams.minPrice ?? "",
001669| NOTE: Implementation detail supporting search page behavior.
001670| src/app/api/search/facets/route.ts:374:     maxPrice: filterParams.maxPrice ?? "",
001671| NOTE: Implementation detail supporting search page behavior.
001672| src/app/api/search/facets/route.ts:375:     amenities: [...(filterParams.amenities || [])].sort().join(","),
001673| NOTE: Implementation detail supporting search page behavior.
001674| src/app/api/search/facets/route.ts:376:     houseRules: [...(filterParams.houseRules || [])].sort().join(","),
001675| NOTE: Implementation detail supporting search page behavior.
001676| src/app/api/search/facets/route.ts:377:     languages: [...(filterParams.languages || [])].sort().join(","),
001677| NOTE: Implementation detail supporting search page behavior.
001678| src/app/api/search/facets/route.ts:378:     roomType: filterParams.roomType?.toLowerCase() || "",
001679| NOTE: Implementation detail supporting search page behavior.
001680| src/app/api/search/facets/route.ts:379:     leaseDuration: filterParams.leaseDuration?.toLowerCase() || "",
001681| NOTE: Implementation detail supporting search page behavior.
001682| src/app/api/search/facets/route.ts:380:     moveInDate: filterParams.moveInDate || "",
001683| NOTE: Implementation detail supporting search page behavior.
001684| src/app/api/search/facets/route.ts:381:     bounds: filterParams.bounds
001685| NOTE: Implementation detail supporting search page behavior.
001686| src/app/api/search/facets/route.ts:382:       ? `${filterParams.bounds.minLng.toFixed(4)},${filterParams.bounds.minLat.toFixed(4)},${filterParams.bounds.maxLng.toFixed(4)},${filterParams.bounds.maxLat.toFixed(4)}`
001687| NOTE: Implementation detail supporting search page behavior.
001688| src/app/api/search/facets/route.ts:383:       : "",
001689| NOTE: Implementation detail supporting search page behavior.
001690| src/app/api/search/facets/route.ts:384:   };
001691| NOTE: Implementation detail supporting search page behavior.
001692| src/app/api/search/facets/route.ts:385:   return JSON.stringify(normalized);
001693| NOTE: Return statement for component or helper output.
001694| src/app/api/search/facets/route.ts:386: }
001695| NOTE: Implementation detail supporting search page behavior.
001696| src/app/api/search/facets/route.ts:387: 
001697| NOTE: Blank line for visual separation.
001698| src/app/api/search/facets/route.ts:388: /**
001699| NOTE: Block comment line describing behavior or context.
001700| src/app/api/search/facets/route.ts:389:  * Internal facets fetch function (to be cached)
001701| NOTE: Block comment line describing behavior or context.
001702| src/app/api/search/facets/route.ts:390:  */
001703| NOTE: Block comment line describing behavior or context.
001704| src/app/api/search/facets/route.ts:391: async function getFacetsInternal(
001705| NOTE: Implementation detail supporting search page behavior.
001706| src/app/api/search/facets/route.ts:392:   filterParams: Parameters<typeof buildFacetWhereConditions>[0],
001707| NOTE: Implementation detail supporting search page behavior.
001708| src/app/api/search/facets/route.ts:393: ): Promise<FacetsResponse> {
001709| NOTE: Implementation detail supporting search page behavior.
001710| src/app/api/search/facets/route.ts:394:   // Run all facet queries in parallel for efficiency
001711| NOTE: Line comment documents intent or constraints.
001712| src/app/api/search/facets/route.ts:395:   const [amenities, houseRules, roomTypes, priceRanges] = await Promise.all([
001713| NOTE: Local declaration used by search logic or UI.
001714| src/app/api/search/facets/route.ts:396:     getAmenitiesFacet(filterParams),
001715| NOTE: Implementation detail supporting search page behavior.
001716| src/app/api/search/facets/route.ts:397:     getHouseRulesFacet(filterParams),
001717| NOTE: Implementation detail supporting search page behavior.
001718| src/app/api/search/facets/route.ts:398:     getRoomTypesFacet(filterParams),
001719| NOTE: Implementation detail supporting search page behavior.
001720| src/app/api/search/facets/route.ts:399:     getPriceRanges(filterParams),
001721| NOTE: Implementation detail supporting search page behavior.
001722| src/app/api/search/facets/route.ts:400:   ]);
001723| NOTE: Implementation detail supporting search page behavior.
001724| src/app/api/search/facets/route.ts:401: 
001725| NOTE: Blank line for visual separation.
001726| src/app/api/search/facets/route.ts:402:   return {
001727| NOTE: Return statement for component or helper output.
001728| src/app/api/search/facets/route.ts:403:     amenities,
001729| NOTE: Implementation detail supporting search page behavior.
001730| src/app/api/search/facets/route.ts:404:     houseRules,
001731| NOTE: Implementation detail supporting search page behavior.
001732| src/app/api/search/facets/route.ts:405:     roomTypes,
001733| NOTE: Implementation detail supporting search page behavior.
001734| src/app/api/search/facets/route.ts:406:     priceRanges,
001735| NOTE: Implementation detail supporting search page behavior.
001736| src/app/api/search/facets/route.ts:407:   };
001737| NOTE: Implementation detail supporting search page behavior.
001738| src/app/api/search/facets/route.ts:408: }
001739| NOTE: Implementation detail supporting search page behavior.
001740| src/app/api/search/facets/route.ts:409: 
001741| NOTE: Blank line for visual separation.
001742| src/app/api/search/facets/route.ts:410: /**
001743| NOTE: Block comment line describing behavior or context.
001744| src/app/api/search/facets/route.ts:411:  * GET /api/search/facets
001745| NOTE: Block comment line describing behavior or context.
001746| src/app/api/search/facets/route.ts:412:  *
001747| NOTE: Block comment line describing behavior or context.
001748| src/app/api/search/facets/route.ts:413:  * Returns facet counts for all filter options based on current filters.
001749| NOTE: Block comment line describing behavior or context.
001750| src/app/api/search/facets/route.ts:414:  * Cached with 30s TTL.
001751| NOTE: Block comment line describing behavior or context.
001752| src/app/api/search/facets/route.ts:415:  */
001753| NOTE: Block comment line describing behavior or context.
001754| src/app/api/search/facets/route.ts:416: export async function GET(request: NextRequest) {
001755| NOTE: Implementation detail supporting search page behavior.
001756| src/app/api/search/facets/route.ts:417:   const context = createContextFromHeaders(request.headers);
001757| NOTE: Local declaration used by search logic or UI.
001758| src/app/api/search/facets/route.ts:418: 
001759| NOTE: Blank line for visual separation.
001760| src/app/api/search/facets/route.ts:419:   return runWithRequestContext(context, async () => {
001761| NOTE: Return statement for component or helper output.
001762| src/app/api/search/facets/route.ts:420:     // Rate limiting (uses search-count bucket as they serve similar purposes)
001763| NOTE: Line comment documents intent or constraints.
001764| src/app/api/search/facets/route.ts:421:     const rateLimitResponse = await withRateLimitRedis(request, {
001765| NOTE: Local declaration used by search logic or UI.
001766| src/app/api/search/facets/route.ts:422:       type: "search-count",
001767| NOTE: Implementation detail supporting search page behavior.
001768| src/app/api/search/facets/route.ts:423:     });
001769| NOTE: Implementation detail supporting search page behavior.
001770| src/app/api/search/facets/route.ts:424:     if (rateLimitResponse) {
001771| NOTE: Conditional logic controlling rendering or flow.
001772| src/app/api/search/facets/route.ts:425:       return rateLimitResponse;
001773| NOTE: Return statement for component or helper output.
001774| src/app/api/search/facets/route.ts:426:     }
001775| NOTE: Implementation detail supporting search page behavior.
001776| src/app/api/search/facets/route.ts:427: 
001777| NOTE: Blank line for visual separation.
001778| src/app/api/search/facets/route.ts:428:     try {
001779| NOTE: Implementation detail supporting search page behavior.
001780| src/app/api/search/facets/route.ts:429:       // Parse URL params into FilterParams
001781| NOTE: Line comment documents intent or constraints.
001782| src/app/api/search/facets/route.ts:430:       const searchParams = request.nextUrl.searchParams;
001783| NOTE: Local declaration used by search logic or UI.
001784| src/app/api/search/facets/route.ts:431:       const rawParams: Record<string, string | string[] | undefined> = {};
001785| NOTE: Local declaration used by search logic or UI.
001786| src/app/api/search/facets/route.ts:432:       searchParams.forEach((value, key) => {
001787| NOTE: Implementation detail supporting search page behavior.
001788| src/app/api/search/facets/route.ts:433:         const existing = rawParams[key];
001789| NOTE: Local declaration used by search logic or UI.
001790| src/app/api/search/facets/route.ts:434:         if (existing !== undefined) {
001791| NOTE: Conditional logic controlling rendering or flow.
001792| src/app/api/search/facets/route.ts:435:           rawParams[key] = Array.isArray(existing)
001793| NOTE: Implementation detail supporting search page behavior.
001794| src/app/api/search/facets/route.ts:436:             ? [...existing, value]
001795| NOTE: Implementation detail supporting search page behavior.
001796| src/app/api/search/facets/route.ts:437:             : [existing, value];
001797| NOTE: Implementation detail supporting search page behavior.
001798| src/app/api/search/facets/route.ts:438:         } else {
001799| NOTE: Implementation detail supporting search page behavior.
001800| src/app/api/search/facets/route.ts:439:           rawParams[key] = value;
001801| NOTE: Implementation detail supporting search page behavior.
001802| src/app/api/search/facets/route.ts:440:         }
001803| NOTE: Implementation detail supporting search page behavior.
001804| src/app/api/search/facets/route.ts:441:       });
001805| NOTE: Implementation detail supporting search page behavior.
001806| src/app/api/search/facets/route.ts:442: 
001807| NOTE: Blank line for visual separation.
001808| src/app/api/search/facets/route.ts:443:       const { filterParams } = parseSearchParams(rawParams);
001809| NOTE: Local declaration used by search logic or UI.
001810| src/app/api/search/facets/route.ts:444: 
001811| NOTE: Blank line for visual separation.
001812| src/app/api/search/facets/route.ts:445:       // Build cache key and fetch with caching
001813| NOTE: Line comment documents intent or constraints.
001814| src/app/api/search/facets/route.ts:446:       const cacheKey = generateFacetsCacheKey(filterParams);
001815| NOTE: Local declaration used by search logic or UI.
001816| src/app/api/search/facets/route.ts:447: 
001817| NOTE: Blank line for visual separation.
001818| src/app/api/search/facets/route.ts:448:       const cachedFn = unstable_cache(
001819| NOTE: Local declaration used by search logic or UI.
001820| src/app/api/search/facets/route.ts:449:         async () => getFacetsInternal(filterParams),
001821| NOTE: Implementation detail supporting search page behavior.
001822| src/app/api/search/facets/route.ts:450:         ["search-facets", cacheKey],
001823| NOTE: Implementation detail supporting search page behavior.
001824| src/app/api/search/facets/route.ts:451:         { revalidate: CACHE_TTL },
001825| NOTE: Implementation detail supporting search page behavior.
001826| src/app/api/search/facets/route.ts:452:       );
001827| NOTE: Implementation detail supporting search page behavior.
001828| src/app/api/search/facets/route.ts:453: 
001829| NOTE: Blank line for visual separation.
001830| src/app/api/search/facets/route.ts:454:       const facets = await cachedFn();
001831| NOTE: Local declaration used by search logic or UI.
001832| src/app/api/search/facets/route.ts:455: 
001833| NOTE: Blank line for visual separation.
001834| src/app/api/search/facets/route.ts:456:       return NextResponse.json(facets, {
001835| NOTE: Return statement for component or helper output.
001836| src/app/api/search/facets/route.ts:457:         headers: {
001837| NOTE: Implementation detail supporting search page behavior.
001838| src/app/api/search/facets/route.ts:458:           "Cache-Control": "private, no-store",
001839| NOTE: Implementation detail supporting search page behavior.
001840| src/app/api/search/facets/route.ts:459:           "X-Cache-TTL": String(CACHE_TTL),
001841| NOTE: Implementation detail supporting search page behavior.
001842| src/app/api/search/facets/route.ts:460:         },
001843| NOTE: Implementation detail supporting search page behavior.
001844| src/app/api/search/facets/route.ts:461:       });
001845| NOTE: Implementation detail supporting search page behavior.
001846| src/app/api/search/facets/route.ts:462:     } catch (error) {
001847| NOTE: Implementation detail supporting search page behavior.
001848| src/app/api/search/facets/route.ts:463:       console.error("[search/facets] Error fetching facets:", error);
001849| NOTE: Implementation detail supporting search page behavior.
001850| src/app/api/search/facets/route.ts:464: 
001851| NOTE: Blank line for visual separation.
001852| src/app/api/search/facets/route.ts:465:       return NextResponse.json(
001853| NOTE: Return statement for component or helper output.
001854| src/app/api/search/facets/route.ts:466:         { error: "Failed to fetch facets" },
001855| NOTE: Implementation detail supporting search page behavior.
001856| src/app/api/search/facets/route.ts:467:         { status: 500 },
001857| NOTE: Implementation detail supporting search page behavior.
001858| src/app/api/search/facets/route.ts:468:       );
001859| NOTE: Implementation detail supporting search page behavior.
001860| src/app/api/search/facets/route.ts:469:     }
001861| NOTE: Implementation detail supporting search page behavior.
001862| src/app/api/search/facets/route.ts:470:   });
001863| NOTE: Implementation detail supporting search page behavior.
001864| src/app/api/search/facets/route.ts:471: }
001865| NOTE: Implementation detail supporting search page behavior.
001866| FILE END: src/app/api/search/facets/route.ts
001867| 
001868| FILE START: src/app/api/search/v2/route.ts
001869| FILE ROLE: Unified search endpoint for list + map data.
001870| src/app/api/search/v2/route.ts:1: /**
001871| NOTE: Block comment line describing behavior or context.
001872| src/app/api/search/v2/route.ts:2:  * GET /api/search/v2
001873| NOTE: Block comment line describing behavior or context.
001874| src/app/api/search/v2/route.ts:3:  *
001875| NOTE: Block comment line describing behavior or context.
001876| src/app/api/search/v2/route.ts:4:  * Unified search endpoint that returns both list results and map data
001877| NOTE: Block comment line describing behavior or context.
001878| src/app/api/search/v2/route.ts:5:  * in a single response. Feature-flagged via ENABLE_SEARCH_V2 env var
001879| NOTE: Block comment line describing behavior or context.
001880| src/app/api/search/v2/route.ts:6:  * or ?v2=1 URL param for testing.
001881| NOTE: Block comment line describing behavior or context.
001882| src/app/api/search/v2/route.ts:7:  *
001883| NOTE: Block comment line describing behavior or context.
001884| src/app/api/search/v2/route.ts:8:  * Response contract:
001885| NOTE: Block comment line describing behavior or context.
001886| src/app/api/search/v2/route.ts:9:  * - meta.mode: 'geojson' (>=50 mapListings) or 'pins' (<50 mapListings)
001887| NOTE: Block comment line describing behavior or context.
001888| src/app/api/search/v2/route.ts:10:  * - map.geojson: ALWAYS present (GeoJSON FeatureCollection for Mapbox clustering)
001889| NOTE: Block comment line describing behavior or context.
001890| src/app/api/search/v2/route.ts:11:  * - map.pins: ONLY present when mode='pins' (tiered pins for sparse results)
001891| NOTE: Block comment line describing behavior or context.
001892| src/app/api/search/v2/route.ts:12:  */
001893| NOTE: Block comment line describing behavior or context.
001894| src/app/api/search/v2/route.ts:13: 
001895| NOTE: Blank line for visual separation.
001896| src/app/api/search/v2/route.ts:14: import { NextRequest, NextResponse } from "next/server";
001897| NOTE: Imports dependency for this module.
001898| src/app/api/search/v2/route.ts:15: import { features } from "@/lib/env";
001899| NOTE: Imports dependency for this module.
001900| src/app/api/search/v2/route.ts:16: import { getListingsPaginated, getMapListings } from "@/lib/data";
001901| NOTE: Imports dependency for this module.
001902| src/app/api/search/v2/route.ts:17: import { parseSearchParams } from "@/lib/search-params";
001903| NOTE: Imports dependency for this module.
001904| src/app/api/search/v2/route.ts:18: import { withRateLimitRedis } from "@/lib/with-rate-limit-redis";
001905| NOTE: Imports dependency for this module.
001906| src/app/api/search/v2/route.ts:19: import {
001907| NOTE: Imports dependency for this module.
001908| src/app/api/search/v2/route.ts:20:   createContextFromHeaders,
001909| NOTE: Implementation detail supporting search page behavior.
001910| src/app/api/search/v2/route.ts:21:   runWithRequestContext,
001911| NOTE: Implementation detail supporting search page behavior.
001912| src/app/api/search/v2/route.ts:22:   getRequestId,
001913| NOTE: Implementation detail supporting search page behavior.
001914| src/app/api/search/v2/route.ts:23: } from "@/lib/request-context";
001915| NOTE: Implementation detail supporting search page behavior.
001916| src/app/api/search/v2/route.ts:24: import {
001917| NOTE: Imports dependency for this module.
001918| src/app/api/search/v2/route.ts:25:   generateQueryHash,
001919| NOTE: Implementation detail supporting search page behavior.
001920| src/app/api/search/v2/route.ts:26:   encodeCursor,
001921| NOTE: Implementation detail supporting search page behavior.
001922| src/app/api/search/v2/route.ts:27:   decodeCursor,
001923| NOTE: Implementation detail supporting search page behavior.
001924| src/app/api/search/v2/route.ts:28: } from "@/lib/search/hash";
001925| NOTE: Implementation detail supporting search page behavior.
001926| src/app/api/search/v2/route.ts:29: import {
001927| NOTE: Imports dependency for this module.
001928| src/app/api/search/v2/route.ts:30:   transformToListItems,
001929| NOTE: Implementation detail supporting search page behavior.
001930| src/app/api/search/v2/route.ts:31:   transformToMapResponse,
001931| NOTE: Implementation detail supporting search page behavior.
001932| src/app/api/search/v2/route.ts:32:   determineMode,
001933| NOTE: Implementation detail supporting search page behavior.
001934| src/app/api/search/v2/route.ts:33: } from "@/lib/search/transform";
001935| NOTE: Implementation detail supporting search page behavior.
001936| src/app/api/search/v2/route.ts:34: import type { SearchV2Response } from "@/lib/search/types";
001937| NOTE: Imports dependency for this module.
001938| src/app/api/search/v2/route.ts:35: 
001939| NOTE: Blank line for visual separation.
001940| src/app/api/search/v2/route.ts:36: /**
001941| NOTE: Block comment line describing behavior or context.
001942| src/app/api/search/v2/route.ts:37:  * Check if v2 is enabled via feature flag or URL param.
001943| NOTE: Block comment line describing behavior or context.
001944| src/app/api/search/v2/route.ts:38:  */
001945| NOTE: Block comment line describing behavior or context.
001946| src/app/api/search/v2/route.ts:39: function isV2Enabled(request: NextRequest): boolean {
001947| NOTE: Defines a helper or component function.
001948| src/app/api/search/v2/route.ts:40:   // Global feature flag takes precedence
001949| NOTE: Line comment documents intent or constraints.
001950| src/app/api/search/v2/route.ts:41:   if (features.searchV2) {
001951| NOTE: Conditional logic controlling rendering or flow.
001952| src/app/api/search/v2/route.ts:42:     return true;
001953| NOTE: Return statement for component or helper output.
001954| src/app/api/search/v2/route.ts:43:   }
001955| NOTE: Implementation detail supporting search page behavior.
001956| src/app/api/search/v2/route.ts:44: 
001957| NOTE: Blank line for visual separation.
001958| src/app/api/search/v2/route.ts:45:   // URL param override for testing: ?v2=1
001959| NOTE: Line comment documents intent or constraints.
001960| src/app/api/search/v2/route.ts:46:   const v2Param = request.nextUrl.searchParams.get("v2");
001961| NOTE: Local declaration used by search logic or UI.
001962| src/app/api/search/v2/route.ts:47:   return v2Param === "1" || v2Param === "true";
001963| NOTE: Return statement for component or helper output.
001964| src/app/api/search/v2/route.ts:48: }
001965| NOTE: Implementation detail supporting search page behavior.
001966| src/app/api/search/v2/route.ts:49: 
001967| NOTE: Blank line for visual separation.
001968| src/app/api/search/v2/route.ts:50: export async function GET(request: NextRequest) {
001969| NOTE: Implementation detail supporting search page behavior.
001970| src/app/api/search/v2/route.ts:51:   const context = createContextFromHeaders(request.headers);
001971| NOTE: Local declaration used by search logic or UI.
001972| src/app/api/search/v2/route.ts:52: 
001973| NOTE: Blank line for visual separation.
001974| src/app/api/search/v2/route.ts:53:   return runWithRequestContext(context, async () => {
001975| NOTE: Return statement for component or helper output.
001976| src/app/api/search/v2/route.ts:54:     const requestId = getRequestId();
001977| NOTE: Local declaration used by search logic or UI.
001978| src/app/api/search/v2/route.ts:55: 
001979| NOTE: Blank line for visual separation.
001980| src/app/api/search/v2/route.ts:56:     // Check feature flag before processing
001981| NOTE: Line comment documents intent or constraints.
001982| src/app/api/search/v2/route.ts:57:     if (!isV2Enabled(request)) {
001983| NOTE: Conditional logic controlling rendering or flow.
001984| src/app/api/search/v2/route.ts:58:       return NextResponse.json(
001985| NOTE: Return statement for component or helper output.
001986| src/app/api/search/v2/route.ts:59:         { error: "Search v2 endpoint not enabled" },
001987| NOTE: Implementation detail supporting search page behavior.
001988| src/app/api/search/v2/route.ts:60:         {
001989| NOTE: Implementation detail supporting search page behavior.
001990| src/app/api/search/v2/route.ts:61:           status: 404,
001991| NOTE: Implementation detail supporting search page behavior.
001992| src/app/api/search/v2/route.ts:62:           headers: { "x-request-id": requestId },
001993| NOTE: Implementation detail supporting search page behavior.
001994| src/app/api/search/v2/route.ts:63:         },
001995| NOTE: Implementation detail supporting search page behavior.
001996| src/app/api/search/v2/route.ts:64:       );
001997| NOTE: Implementation detail supporting search page behavior.
001998| src/app/api/search/v2/route.ts:65:     }
001999| NOTE: Implementation detail supporting search page behavior.
002000| src/app/api/search/v2/route.ts:66: 
002001| NOTE: Blank line for visual separation.
002002| src/app/api/search/v2/route.ts:67:     try {
002003| NOTE: Implementation detail supporting search page behavior.
002004| src/app/api/search/v2/route.ts:68:       // Rate limiting via Redis (using map type as it has similar search semantics)
002005| NOTE: Line comment documents intent or constraints.
002006| src/app/api/search/v2/route.ts:69:       const rateLimitResponse = await withRateLimitRedis(request, {
002007| NOTE: Local declaration used by search logic or UI.
002008| src/app/api/search/v2/route.ts:70:         type: "map",
002009| NOTE: Implementation detail supporting search page behavior.
002010| src/app/api/search/v2/route.ts:71:       });
002011| NOTE: Implementation detail supporting search page behavior.
002012| src/app/api/search/v2/route.ts:72:       if (rateLimitResponse) return rateLimitResponse;
002013| NOTE: Conditional logic controlling rendering or flow.
002014| src/app/api/search/v2/route.ts:73: 
002015| NOTE: Blank line for visual separation.
002016| src/app/api/search/v2/route.ts:74:       // Parse and validate search params
002017| NOTE: Line comment documents intent or constraints.
002018| src/app/api/search/v2/route.ts:75:       const searchParams = request.nextUrl.searchParams;
002019| NOTE: Local declaration used by search logic or UI.
002020| src/app/api/search/v2/route.ts:76:       const rawParams = Object.fromEntries(searchParams.entries());
002021| NOTE: Local declaration used by search logic or UI.
002022| src/app/api/search/v2/route.ts:77:       const parsed = parseSearchParams(rawParams);
002023| NOTE: Local declaration used by search logic or UI.
002024| src/app/api/search/v2/route.ts:78: 
002025| NOTE: Blank line for visual separation.
002026| src/app/api/search/v2/route.ts:79:       // Handle cursor-based pagination
002027| NOTE: Line comment documents intent or constraints.
002028| src/app/api/search/v2/route.ts:80:       const cursor = searchParams.get("cursor");
002029| NOTE: Local declaration used by search logic or UI.
002030| src/app/api/search/v2/route.ts:81:       let page = parsed.requestedPage;
002031| NOTE: Local declaration used by search logic or UI.
002032| src/app/api/search/v2/route.ts:82: 
002033| NOTE: Blank line for visual separation.
002034| src/app/api/search/v2/route.ts:83:       if (cursor) {
002035| NOTE: Conditional logic controlling rendering or flow.
002036| src/app/api/search/v2/route.ts:84:         const decodedPage = decodeCursor(cursor);
002037| NOTE: Local declaration used by search logic or UI.
002038| src/app/api/search/v2/route.ts:85:         if (decodedPage !== null) {
002039| NOTE: Conditional logic controlling rendering or flow.
002040| src/app/api/search/v2/route.ts:86:           page = decodedPage;
002041| NOTE: Implementation detail supporting search page behavior.
002042| src/app/api/search/v2/route.ts:87:         }
002043| NOTE: Implementation detail supporting search page behavior.
002044| src/app/api/search/v2/route.ts:88:       }
002045| NOTE: Implementation detail supporting search page behavior.
002046| src/app/api/search/v2/route.ts:89: 
002047| NOTE: Blank line for visual separation.
002048| src/app/api/search/v2/route.ts:90:       // Build filter params with page
002049| NOTE: Line comment documents intent or constraints.
002050| src/app/api/search/v2/route.ts:91:       const filterParams = {
002051| NOTE: Local declaration used by search logic or UI.
002052| src/app/api/search/v2/route.ts:92:         ...parsed.filterParams,
002053| NOTE: Implementation detail supporting search page behavior.
002054| src/app/api/search/v2/route.ts:93:         page,
002055| NOTE: Implementation detail supporting search page behavior.
002056| src/app/api/search/v2/route.ts:94:       };
002057| NOTE: Implementation detail supporting search page behavior.
002058| src/app/api/search/v2/route.ts:95: 
002059| NOTE: Blank line for visual separation.
002060| src/app/api/search/v2/route.ts:96:       // Fetch list and map data in parallel
002061| NOTE: Line comment documents intent or constraints.
002062| src/app/api/search/v2/route.ts:97:       const [listResult, mapListings] = await Promise.all([
002063| NOTE: Local declaration used by search logic or UI.
002064| src/app/api/search/v2/route.ts:98:         getListingsPaginated(filterParams),
002065| NOTE: Implementation detail supporting search page behavior.
002066| src/app/api/search/v2/route.ts:99:         getMapListings(filterParams),
002067| NOTE: Implementation detail supporting search page behavior.
002068| src/app/api/search/v2/route.ts:100:       ]);
002069| NOTE: Implementation detail supporting search page behavior.
002070| src/app/api/search/v2/route.ts:101: 
002071| NOTE: Blank line for visual separation.
002072| src/app/api/search/v2/route.ts:102:       // Determine mode based on mapListings count (not list total)
002073| NOTE: Line comment documents intent or constraints.
002074| src/app/api/search/v2/route.ts:103:       const mode = determineMode(mapListings.length);
002075| NOTE: Local declaration used by search logic or UI.
002076| src/app/api/search/v2/route.ts:104: 
002077| NOTE: Blank line for visual separation.
002078| src/app/api/search/v2/route.ts:105:       // Generate query hash for caching (excludes pagination)
002079| NOTE: Line comment documents intent or constraints.
002080| src/app/api/search/v2/route.ts:106:       const queryHash = generateQueryHash({
002081| NOTE: Local declaration used by search logic or UI.
002082| src/app/api/search/v2/route.ts:107:         query: parsed.filterParams.query,
002083| NOTE: Implementation detail supporting search page behavior.
002084| src/app/api/search/v2/route.ts:108:         minPrice: parsed.filterParams.minPrice,
002085| NOTE: Implementation detail supporting search page behavior.
002086| src/app/api/search/v2/route.ts:109:         maxPrice: parsed.filterParams.maxPrice,
002087| NOTE: Implementation detail supporting search page behavior.
002088| src/app/api/search/v2/route.ts:110:         amenities: parsed.filterParams.amenities,
002089| NOTE: Implementation detail supporting search page behavior.
002090| src/app/api/search/v2/route.ts:111:         houseRules: parsed.filterParams.houseRules,
002091| NOTE: Implementation detail supporting search page behavior.
002092| src/app/api/search/v2/route.ts:112:         languages: parsed.filterParams.languages,
002093| NOTE: Implementation detail supporting search page behavior.
002094| src/app/api/search/v2/route.ts:113:         roomType: parsed.filterParams.roomType,
002095| NOTE: Implementation detail supporting search page behavior.
002096| src/app/api/search/v2/route.ts:114:         leaseDuration: parsed.filterParams.leaseDuration,
002097| NOTE: Implementation detail supporting search page behavior.
002098| src/app/api/search/v2/route.ts:115:         moveInDate: parsed.filterParams.moveInDate,
002099| NOTE: Implementation detail supporting search page behavior.
002100| src/app/api/search/v2/route.ts:116:         bounds: parsed.filterParams.bounds,
002101| NOTE: Implementation detail supporting search page behavior.
002102| src/app/api/search/v2/route.ts:117:         nearMatches: parsed.filterParams.nearMatches,
002103| NOTE: Implementation detail supporting search page behavior.
002104| src/app/api/search/v2/route.ts:118:       });
002105| NOTE: Implementation detail supporting search page behavior.
002106| src/app/api/search/v2/route.ts:119: 
002107| NOTE: Blank line for visual separation.
002108| src/app/api/search/v2/route.ts:120:       // Transform list items
002109| NOTE: Line comment documents intent or constraints.
002110| src/app/api/search/v2/route.ts:121:       const listItems = transformToListItems(listResult.items);
002111| NOTE: Local declaration used by search logic or UI.
002112| src/app/api/search/v2/route.ts:122: 
002113| NOTE: Blank line for visual separation.
002114| src/app/api/search/v2/route.ts:123:       // Transform map data (geojson always, pins only when sparse)
002115| NOTE: Line comment documents intent or constraints.
002116| src/app/api/search/v2/route.ts:124:       const mapResponse = transformToMapResponse(mapListings);
002117| NOTE: Local declaration used by search logic or UI.
002118| src/app/api/search/v2/route.ts:125: 
002119| NOTE: Blank line for visual separation.
002120| src/app/api/search/v2/route.ts:126:       // Build next cursor if more pages available
002121| NOTE: Line comment documents intent or constraints.
002122| src/app/api/search/v2/route.ts:127:       const nextCursor = listResult.hasNextPage ? encodeCursor(page + 1) : null;
002123| NOTE: Local declaration used by search logic or UI.
002124| src/app/api/search/v2/route.ts:128: 
002125| NOTE: Blank line for visual separation.
002126| src/app/api/search/v2/route.ts:129:       // Build response
002127| NOTE: Line comment documents intent or constraints.
002128| src/app/api/search/v2/route.ts:130:       const response: SearchV2Response = {
002129| NOTE: Local declaration used by search logic or UI.
002130| src/app/api/search/v2/route.ts:131:         meta: {
002131| NOTE: Implementation detail supporting search page behavior.
002132| src/app/api/search/v2/route.ts:132:           queryHash,
002133| NOTE: Implementation detail supporting search page behavior.
002134| src/app/api/search/v2/route.ts:133:           generatedAt: new Date().toISOString(),
002135| NOTE: Implementation detail supporting search page behavior.
002136| src/app/api/search/v2/route.ts:134:           mode,
002137| NOTE: Implementation detail supporting search page behavior.
002138| src/app/api/search/v2/route.ts:135:         },
002139| NOTE: Implementation detail supporting search page behavior.
002140| src/app/api/search/v2/route.ts:136:         list: {
002141| NOTE: Implementation detail supporting search page behavior.
002142| src/app/api/search/v2/route.ts:137:           items: listItems,
002143| NOTE: Implementation detail supporting search page behavior.
002144| src/app/api/search/v2/route.ts:138:           nextCursor,
002145| NOTE: Implementation detail supporting search page behavior.
002146| src/app/api/search/v2/route.ts:139:           total: listResult.total,
002147| NOTE: Implementation detail supporting search page behavior.
002148| src/app/api/search/v2/route.ts:140:         },
002149| NOTE: Implementation detail supporting search page behavior.
002150| src/app/api/search/v2/route.ts:141:         map: mapResponse,
002151| NOTE: Implementation detail supporting search page behavior.
002152| src/app/api/search/v2/route.ts:142:       };
002153| NOTE: Implementation detail supporting search page behavior.
002154| src/app/api/search/v2/route.ts:143: 
002155| NOTE: Blank line for visual separation.
002156| src/app/api/search/v2/route.ts:144:       return NextResponse.json(response, {
002157| NOTE: Return statement for component or helper output.
002158| src/app/api/search/v2/route.ts:145:         headers: {
002159| NOTE: Implementation detail supporting search page behavior.
002160| src/app/api/search/v2/route.ts:146:           // CDN caching for search results
002161| NOTE: Line comment documents intent or constraints.
002162| src/app/api/search/v2/route.ts:147:           "Cache-Control":
002163| NOTE: Implementation detail supporting search page behavior.
002164| src/app/api/search/v2/route.ts:148:             "public, s-maxage=60, max-age=30, stale-while-revalidate=120",
002165| NOTE: Implementation detail supporting search page behavior.
002166| src/app/api/search/v2/route.ts:149:           "x-request-id": requestId,
002167| NOTE: Implementation detail supporting search page behavior.
002168| src/app/api/search/v2/route.ts:150:           Vary: "Accept-Encoding",
002169| NOTE: Implementation detail supporting search page behavior.
002170| src/app/api/search/v2/route.ts:151:         },
002171| NOTE: Implementation detail supporting search page behavior.
002172| src/app/api/search/v2/route.ts:152:       });
002173| NOTE: Implementation detail supporting search page behavior.
002174| src/app/api/search/v2/route.ts:153:     } catch (error) {
002175| NOTE: Implementation detail supporting search page behavior.
002176| src/app/api/search/v2/route.ts:154:       console.error("Search v2 API error:", { error, requestId });
002177| NOTE: Implementation detail supporting search page behavior.
002178| src/app/api/search/v2/route.ts:155:       return NextResponse.json(
002179| NOTE: Return statement for component or helper output.
002180| src/app/api/search/v2/route.ts:156:         { error: "Failed to fetch search results" },
002181| NOTE: Implementation detail supporting search page behavior.
002182| src/app/api/search/v2/route.ts:157:         {
002183| NOTE: Implementation detail supporting search page behavior.
002184| src/app/api/search/v2/route.ts:158:           status: 500,
002185| NOTE: Implementation detail supporting search page behavior.
002186| src/app/api/search/v2/route.ts:159:           headers: { "x-request-id": requestId },
002187| NOTE: Implementation detail supporting search page behavior.
002188| src/app/api/search/v2/route.ts:160:         },
002189| NOTE: Implementation detail supporting search page behavior.
002190| src/app/api/search/v2/route.ts:161:       );
002191| NOTE: Implementation detail supporting search page behavior.
002192| src/app/api/search/v2/route.ts:162:     }
002193| NOTE: Implementation detail supporting search page behavior.
002194| src/app/api/search/v2/route.ts:163:   });
002195| NOTE: Implementation detail supporting search page behavior.
002196| src/app/api/search/v2/route.ts:164: }
002197| NOTE: Implementation detail supporting search page behavior.
002198| FILE END: src/app/api/search/v2/route.ts
002199| 
002200| FILE START: src/app/search/error.tsx
002201| FILE ROLE: Client error boundary for search results with retry and navigation.
002202| src/app/search/error.tsx:1: "use client";
002203| NOTE: Implementation detail supporting search page behavior.
002204| src/app/search/error.tsx:2: 
002205| NOTE: Blank line for visual separation.
002206| src/app/search/error.tsx:3: import { useEffect } from "react";
002207| NOTE: Imports dependency for this module.
002208| src/app/search/error.tsx:4: import Link from "next/link";
002209| NOTE: Imports dependency for this module.
002210| src/app/search/error.tsx:5: import { AlertCircle, RefreshCw, Home } from "lucide-react";
002211| NOTE: Imports dependency for this module.
002212| src/app/search/error.tsx:6: import { Button } from "@/components/ui/button";
002213| NOTE: Imports dependency for this module.
002214| src/app/search/error.tsx:7: 
002215| NOTE: Blank line for visual separation.
002216| src/app/search/error.tsx:8: export default function SearchError({
002217| NOTE: Exports main component for this module.
002218| src/app/search/error.tsx:9:   error,
002219| NOTE: Implementation detail supporting search page behavior.
002220| src/app/search/error.tsx:10:   reset,
002221| NOTE: Implementation detail supporting search page behavior.
002222| src/app/search/error.tsx:11: }: {
002223| NOTE: Implementation detail supporting search page behavior.
002224| src/app/search/error.tsx:12:   error: Error & { digest?: string };
002225| NOTE: Implementation detail supporting search page behavior.
002226| src/app/search/error.tsx:13:   reset: () => void;
002227| NOTE: Implementation detail supporting search page behavior.
002228| src/app/search/error.tsx:14: }) {
002229| NOTE: Implementation detail supporting search page behavior.
002230| src/app/search/error.tsx:15:   useEffect(() => {
002231| NOTE: Defines side effect for syncing with external state.
002232| src/app/search/error.tsx:16:     // Log the error to an error reporting service
002233| NOTE: Line comment documents intent or constraints.
002234| src/app/search/error.tsx:17:     console.error("Search page error:", error);
002235| NOTE: Implementation detail supporting search page behavior.
002236| src/app/search/error.tsx:18:   }, [error]);
002237| NOTE: Implementation detail supporting search page behavior.
002238| src/app/search/error.tsx:19: 
002239| NOTE: Blank line for visual separation.
002240| src/app/search/error.tsx:20:   return (
002241| NOTE: Return statement for component or helper output.
002242| src/app/search/error.tsx:21:     <div className="min-h-screen bg-white dark:bg-zinc-950 pt-20">
002243| NOTE: Tailwind classes define layout and styling.
002244| src/app/search/error.tsx:22:       <div className="max-w-lg mx-auto px-4 py-16 text-center">
002245| NOTE: Tailwind classes define layout and styling.
002246| src/app/search/error.tsx:23:         <div className="w-16 h-16 rounded-full bg-red-50 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-6">
002247| NOTE: Tailwind classes define layout and styling.
002248| src/app/search/error.tsx:24:           <AlertCircle className="w-8 h-8 text-red-500 dark:text-red-400" />
002249| NOTE: Tailwind classes define layout and styling.
002250| src/app/search/error.tsx:25:         </div>
002251| NOTE: JSX markup for search UI.
002252| src/app/search/error.tsx:26: 
002253| NOTE: Blank line for visual separation.
002254| src/app/search/error.tsx:27:         <h1 className="text-2xl font-bold text-zinc-900 dark:text-white mb-3">
002255| NOTE: Tailwind classes define layout and styling.
002256| src/app/search/error.tsx:28:           Something went wrong
002257| NOTE: Implementation detail supporting search page behavior.
002258| src/app/search/error.tsx:29:         </h1>
002259| NOTE: JSX markup for search UI.
002260| src/app/search/error.tsx:30: 
002261| NOTE: Blank line for visual separation.
002262| src/app/search/error.tsx:31:         <p className="text-zinc-600 dark:text-zinc-400 mb-8">
002263| NOTE: Tailwind classes define layout and styling.
002264| src/app/search/error.tsx:32:           We couldn&apos;t load the search results. This might be a temporary
002265| NOTE: Implementation detail supporting search page behavior.
002266| src/app/search/error.tsx:33:           issue with our servers.
002267| NOTE: Implementation detail supporting search page behavior.
002268| src/app/search/error.tsx:34:         </p>
002269| NOTE: JSX markup for search UI.
002270| src/app/search/error.tsx:35: 
002271| NOTE: Blank line for visual separation.
002272| src/app/search/error.tsx:36:         <div className="flex flex-col sm:flex-row gap-3 justify-center">
002273| NOTE: Tailwind classes define layout and styling.
002274| src/app/search/error.tsx:37:           <Button onClick={() => reset()} size="lg" className="gap-2">
002275| NOTE: Tailwind classes define layout and styling.
002276| src/app/search/error.tsx:38:             <RefreshCw className="w-4 h-4" />
002277| NOTE: Tailwind classes define layout and styling.
002278| src/app/search/error.tsx:39:             Try again
002279| NOTE: Implementation detail supporting search page behavior.
002280| src/app/search/error.tsx:40:           </Button>
002281| NOTE: JSX markup for search UI.
002282| src/app/search/error.tsx:41: 
002283| NOTE: Blank line for visual separation.
002284| src/app/search/error.tsx:42:           <Button asChild variant="outline" size="lg" className="gap-2">
002285| NOTE: Tailwind classes define layout and styling.
002286| src/app/search/error.tsx:43:             <Link href="/">
002287| NOTE: JSX markup for search UI.
002288| src/app/search/error.tsx:44:               <Home className="w-4 h-4" />
002289| NOTE: Tailwind classes define layout and styling.
002290| src/app/search/error.tsx:45:               Go home
002291| NOTE: Implementation detail supporting search page behavior.
002292| src/app/search/error.tsx:46:             </Link>
002293| NOTE: JSX markup for search UI.
002294| src/app/search/error.tsx:47:           </Button>
002295| NOTE: JSX markup for search UI.
002296| src/app/search/error.tsx:48:         </div>
002297| NOTE: JSX markup for search UI.
002298| src/app/search/error.tsx:49: 
002299| NOTE: Blank line for visual separation.
002300| src/app/search/error.tsx:50:         {/* Error details for debugging (hidden in production) */}
002301| NOTE: Implementation detail supporting search page behavior.
002302| src/app/search/error.tsx:51:         {process.env.NODE_ENV === "development" && (
002303| NOTE: Implementation detail supporting search page behavior.
002304| src/app/search/error.tsx:52:           <details className="mt-8 text-left bg-zinc-50 dark:bg-zinc-900 rounded-lg p-4">
002305| NOTE: Tailwind classes define layout and styling.
002306| src/app/search/error.tsx:53:             <summary className="text-sm font-medium text-zinc-700 dark:text-zinc-300 cursor-pointer">
002307| NOTE: Tailwind classes define layout and styling.
002308| src/app/search/error.tsx:54:               Error details (dev only)
002309| NOTE: Implementation detail supporting search page behavior.
002310| src/app/search/error.tsx:55:             </summary>
002311| NOTE: JSX markup for search UI.
002312| src/app/search/error.tsx:56:             <pre className="mt-2 text-xs text-red-600 dark:text-red-400 overflow-auto">
002313| NOTE: Tailwind classes define layout and styling.
002314| src/app/search/error.tsx:57:               {error.message}
002315| NOTE: Implementation detail supporting search page behavior.
002316| src/app/search/error.tsx:58:               {error.digest && `\nDigest: ${error.digest}`}
002317| NOTE: Implementation detail supporting search page behavior.
002318| src/app/search/error.tsx:59:             </pre>
002319| NOTE: JSX markup for search UI.
002320| src/app/search/error.tsx:60:           </details>
002321| NOTE: JSX markup for search UI.
002322| src/app/search/error.tsx:61:         )}
002323| NOTE: Implementation detail supporting search page behavior.
002324| src/app/search/error.tsx:62:       </div>
002325| NOTE: JSX markup for search UI.
002326| src/app/search/error.tsx:63:     </div>
002327| NOTE: JSX markup for search UI.
002328| src/app/search/error.tsx:64:   );
002329| NOTE: Implementation detail supporting search page behavior.
002330| src/app/search/error.tsx:65: }
002331| NOTE: Implementation detail supporting search page behavior.
002332| FILE END: src/app/search/error.tsx
002333| 
002334| FILE START: src/app/search/layout.tsx
002335| FILE ROLE: Persistent layout for /search with header, map, and provider wiring.
002336| src/app/search/layout.tsx:1: import SearchLayoutView from "@/components/SearchLayoutView";
002337| NOTE: Imports dependency for this module.
002338| src/app/search/layout.tsx:2: import SearchHeaderWrapper from "@/components/SearchHeaderWrapper";
002339| NOTE: Imports dependency for this module.
002340| src/app/search/layout.tsx:3: import { MapBoundsProvider } from "@/contexts/MapBoundsContext";
002341| NOTE: Imports dependency for this module.
002342| src/app/search/layout.tsx:4: import { SearchTransitionProvider } from "@/contexts/SearchTransitionContext";
002343| NOTE: Imports dependency for this module.
002344| src/app/search/layout.tsx:5: import { FilterStateProvider } from "@/contexts/FilterStateContext";
002345| NOTE: Imports dependency for this module.
002346| src/app/search/layout.tsx:6: import { ListingFocusProvider } from "@/contexts/ListingFocusContext";
002347| NOTE: Imports dependency for this module.
002348| src/app/search/layout.tsx:7: import { SearchV2DataProvider } from "@/contexts/SearchV2DataContext";
002349| NOTE: Imports dependency for this module.
002350| src/app/search/layout.tsx:8: import { MobileSearchProvider } from "@/contexts/MobileSearchContext";
002351| NOTE: Imports dependency for this module.
002352| src/app/search/layout.tsx:9: 
002353| NOTE: Blank line for visual separation.
002354| src/app/search/layout.tsx:10: /**
002355| NOTE: Block comment line describing behavior or context.
002356| src/app/search/layout.tsx:11:  * Search Layout - Persistent Map Architecture
002357| NOTE: Block comment line describing behavior or context.
002358| src/app/search/layout.tsx:12:  *
002359| NOTE: Block comment line describing behavior or context.
002360| src/app/search/layout.tsx:13:  * This layout keeps the map mounted across all /search navigations.
002361| NOTE: Block comment line describing behavior or context.
002362| src/app/search/layout.tsx:14:  * When URL params change (via router.replace), the map stays mounted
002363| NOTE: Block comment line describing behavior or context.
002364| src/app/search/layout.tsx:15:  * while only the page segment (results) re-renders.
002365| NOTE: Block comment line describing behavior or context.
002366| src/app/search/layout.tsx:16:  *
002367| NOTE: Block comment line describing behavior or context.
002368| src/app/search/layout.tsx:17:  * Key benefit: Prevents Mapbox re-initialization on every pan/zoom,
002369| NOTE: Block comment line describing behavior or context.
002370| src/app/search/layout.tsx:18:  * saving significant costs (Mapbox bills per map load, not per tile).
002371| NOTE: Block comment line describing behavior or context.
002372| src/app/search/layout.tsx:19:  *
002373| NOTE: Block comment line describing behavior or context.
002374| src/app/search/layout.tsx:20:  * Cost optimization (Phase 1):
002375| NOTE: Block comment line describing behavior or context.
002376| src/app/search/layout.tsx:21:  * - Map initialization is deferred until user opts in
002377| NOTE: Block comment line describing behavior or context.
002378| src/app/search/layout.tsx:22:  * - Mobile defaults to list-only view (no map init)
002379| NOTE: Block comment line describing behavior or context.
002380| src/app/search/layout.tsx:23:  * - Desktop has "Hide map" toggle to avoid map billing
002381| NOTE: Block comment line describing behavior or context.
002382| src/app/search/layout.tsx:24:  * - See SearchLayoutView for toggle logic
002383| NOTE: Block comment line describing behavior or context.
002384| src/app/search/layout.tsx:25:  *
002385| NOTE: Block comment line describing behavior or context.
002386| src/app/search/layout.tsx:26:  * Architecture:
002387| NOTE: Block comment line describing behavior or context.
002388| src/app/search/layout.tsx:27:  * - Layout (persistent): Contains header
002389| NOTE: Block comment line describing behavior or context.
002390| src/app/search/layout.tsx:28:  * - SearchLayoutView: Handles map toggle and rendering
002391| NOTE: Block comment line describing behavior or context.
002392| src/app/search/layout.tsx:29:  * - Page (can suspend): Contains the results list only
002393| NOTE: Block comment line describing behavior or context.
002394| src/app/search/layout.tsx:30:  * - loading.tsx: Shows skeleton for results only
002395| NOTE: Block comment line describing behavior or context.
002396| src/app/search/layout.tsx:31:  */
002397| NOTE: Block comment line describing behavior or context.
002398| src/app/search/layout.tsx:32: 
002399| NOTE: Blank line for visual separation.
002400| src/app/search/layout.tsx:33: export default function SearchLayout({
002401| NOTE: Exports main component for this module.
002402| src/app/search/layout.tsx:34:   children,
002403| NOTE: Implementation detail supporting search page behavior.
002404| src/app/search/layout.tsx:35: }: {
002405| NOTE: Implementation detail supporting search page behavior.
002406| src/app/search/layout.tsx:36:   children: React.ReactNode;
002407| NOTE: Implementation detail supporting search page behavior.
002408| src/app/search/layout.tsx:37: }) {
002409| NOTE: Implementation detail supporting search page behavior.
002410| src/app/search/layout.tsx:38:   return (
002411| NOTE: Return statement for component or helper output.
002412| src/app/search/layout.tsx:39:     <SearchTransitionProvider>
002413| NOTE: JSX markup for search UI.
002414| src/app/search/layout.tsx:40:       <FilterStateProvider>
002415| NOTE: JSX markup for search UI.
002416| src/app/search/layout.tsx:41:         <MobileSearchProvider>
002417| NOTE: JSX markup for search UI.
002418| src/app/search/layout.tsx:42:           <div className="h-screen-safe flex flex-col bg-white dark:bg-zinc-950 overflow-hidden">
002419| NOTE: Tailwind classes define layout and styling.
002420| src/app/search/layout.tsx:43:             {/* Search Header - Persistent across navigations, fixed position */}
002421| NOTE: Implementation detail supporting search page behavior.
002422| src/app/search/layout.tsx:44:             <header className="fixed top-0 left-0 right-0 w-full bg-white/80 dark:bg-zinc-900/80 backdrop-blur-xl border-b border-zinc-100 dark:border-zinc-800 z-50">
002423| NOTE: Tailwind classes define layout and styling.
002424| src/app/search/layout.tsx:45:               <SearchHeaderWrapper />
002425| NOTE: JSX markup for search UI.
002426| src/app/search/layout.tsx:46:             </header>
002427| NOTE: JSX markup for search UI.
002428| src/app/search/layout.tsx:47: 
002429| NOTE: Blank line for visual separation.
002430| src/app/search/layout.tsx:48:             {/* Main content with top padding to account for fixed header */}
002431| NOTE: Implementation detail supporting search page behavior.
002432| src/app/search/layout.tsx:49:             <div className="flex-1 flex flex-col pt-[72px] sm:pt-[88px] overflow-hidden">
002433| NOTE: Tailwind classes define layout and styling.
002434| src/app/search/layout.tsx:50:               {/* Split view: List (from page) + Map (managed by SearchLayoutView) */}
002435| NOTE: Implementation detail supporting search page behavior.
002436| src/app/search/layout.tsx:51:               <MapBoundsProvider>
002437| NOTE: JSX markup for search UI.
002438| src/app/search/layout.tsx:52:                 <ListingFocusProvider>
002439| NOTE: JSX markup for search UI.
002440| src/app/search/layout.tsx:53:                   <SearchV2DataProvider>
002441| NOTE: JSX markup for search UI.
002442| src/app/search/layout.tsx:54:                     <SearchLayoutView>{children}</SearchLayoutView>
002443| NOTE: JSX markup for search UI.
002444| src/app/search/layout.tsx:55:                   </SearchV2DataProvider>
002445| NOTE: JSX markup for search UI.
002446| src/app/search/layout.tsx:56:                 </ListingFocusProvider>
002447| NOTE: JSX markup for search UI.
002448| src/app/search/layout.tsx:57:               </MapBoundsProvider>
002449| NOTE: JSX markup for search UI.
002450| src/app/search/layout.tsx:58:             </div>
002451| NOTE: JSX markup for search UI.
002452| src/app/search/layout.tsx:59:           </div>
002453| NOTE: JSX markup for search UI.
002454| src/app/search/layout.tsx:60:         </MobileSearchProvider>
002455| NOTE: JSX markup for search UI.
002456| src/app/search/layout.tsx:61:       </FilterStateProvider>
002457| NOTE: JSX markup for search UI.
002458| src/app/search/layout.tsx:62:     </SearchTransitionProvider>
002459| NOTE: JSX markup for search UI.
002460| src/app/search/layout.tsx:63:   );
002461| NOTE: Implementation detail supporting search page behavior.
002462| src/app/search/layout.tsx:64: }
002463| NOTE: Implementation detail supporting search page behavior.
002464| FILE END: src/app/search/layout.tsx
002465| 
002466| FILE START: src/app/search/loading.tsx
002467| FILE ROLE: Suspense loading state for search results list.
002468| src/app/search/loading.tsx:1: import { SearchResultsSkeleton } from "@/components/skeletons/PageSkeleton";
002469| NOTE: Imports dependency for this module.
002470| src/app/search/loading.tsx:2: 
002471| NOTE: Blank line for visual separation.
002472| src/app/search/loading.tsx:3: export default function Loading() {
002473| NOTE: Exports main component for this module.
002474| src/app/search/loading.tsx:4:   return <SearchResultsSkeleton count={6} />;
002475| NOTE: Return statement for component or helper output.
002476| src/app/search/loading.tsx:5: }
002477| NOTE: Implementation detail supporting search page behavior.
002478| FILE END: src/app/search/loading.tsx
002479| 
002480| FILE START: src/app/search/page.tsx
002481| FILE ROLE: Server component for /search results list, rate limiting, and v2/v1 fetch flow.
002482| src/app/search/page.tsx:1: import { auth } from "@/auth";
002483| NOTE: Imports dependency for this module.
002484| src/app/search/page.tsx:2: import { getListingsPaginated, getSavedListingIds } from "@/lib/data";
002485| NOTE: Imports dependency for this module.
002486| src/app/search/page.tsx:3: import { Suspense } from "react";
002487| NOTE: Imports dependency for this module.
002488| src/app/search/page.tsx:4: import ListingCard from "@/components/listings/ListingCard";
002489| NOTE: Imports dependency for this module.
002490| src/app/search/page.tsx:5: import NearMatchSeparator from "@/components/listings/NearMatchSeparator";
002491| NOTE: Imports dependency for this module.
002492| src/app/search/page.tsx:6: import Pagination from "@/components/Pagination";
002493| NOTE: Imports dependency for this module.
002494| src/app/search/page.tsx:7: import SortSelect from "@/components/SortSelect";
002495| NOTE: Imports dependency for this module.
002496| src/app/search/page.tsx:8: import SaveSearchButton from "@/components/SaveSearchButton";
002497| NOTE: Imports dependency for this module.
002498| src/app/search/page.tsx:9: import ZeroResultsSuggestions from "@/components/ZeroResultsSuggestions";
002499| NOTE: Imports dependency for this module.
002500| src/app/search/page.tsx:10: import { SearchErrorBanner } from "@/components/SearchErrorBanner";
002501| NOTE: Imports dependency for this module.
002502| src/app/search/page.tsx:11: import { LowResultsGuidance } from "@/components/LowResultsGuidance";
002503| NOTE: Imports dependency for this module.
002504| src/app/search/page.tsx:12: import { Search, Clock, MapPin, Info } from "lucide-react";
002505| NOTE: Imports dependency for this module.
002506| src/app/search/page.tsx:13: import { headers } from "next/headers";
002507| NOTE: Imports dependency for this module.
002508| src/app/search/page.tsx:14: import { checkServerComponentRateLimit } from "@/lib/with-rate-limit";
002509| NOTE: Imports dependency for this module.
002510| src/app/search/page.tsx:15: import { parseSearchParams } from "@/lib/search-params";
002511| NOTE: Imports dependency for this module.
002512| src/app/search/page.tsx:16: import { features } from "@/lib/env";
002513| NOTE: Imports dependency for this module.
002514| src/app/search/page.tsx:17: import { executeSearchV2 } from "@/lib/search/search-v2-service";
002515| NOTE: Imports dependency for this module.
002516| src/app/search/page.tsx:18: import { V2MapDataSetter } from "@/components/search/V2MapDataSetter";
002517| NOTE: Imports dependency for this module.
002518| src/app/search/page.tsx:19: import type { V2MapData } from "@/contexts/SearchV2DataContext";
002519| NOTE: Imports dependency for this module.
002520| src/app/search/page.tsx:20: 
002521| NOTE: Blank line for visual separation.
002522| src/app/search/page.tsx:21: /**
002523| NOTE: Block comment line describing behavior or context.
002524| src/app/search/page.tsx:22:  * Search Page - Results List Only
002525| NOTE: Block comment line describing behavior or context.
002526| src/app/search/page.tsx:23:  *
002527| NOTE: Block comment line describing behavior or context.
002528| src/app/search/page.tsx:24:  * This page only renders the search results list.
002529| NOTE: Block comment line describing behavior or context.
002530| src/app/search/page.tsx:25:  * The header and map are rendered in layout.tsx (persistent).
002531| NOTE: Block comment line describing behavior or context.
002532| src/app/search/page.tsx:26:  *
002533| NOTE: Block comment line describing behavior or context.
002534| src/app/search/page.tsx:27:  * Benefits of this architecture:
002535| NOTE: Block comment line describing behavior or context.
002536| src/app/search/page.tsx:28:  * - Map stays mounted across URL changes (no Mapbox re-init = no extra billing)
002537| NOTE: Block comment line describing behavior or context.
002538| src/app/search/page.tsx:29:  * - Results can suspend independently via loading.tsx
002539| NOTE: Block comment line describing behavior or context.
002540| src/app/search/page.tsx:30:  * - Server-side data fetching for SEO and initial load performance
002541| NOTE: Block comment line describing behavior or context.
002542| src/app/search/page.tsx:31:  */
002543| NOTE: Block comment line describing behavior or context.
002544| src/app/search/page.tsx:32: 
002545| NOTE: Blank line for visual separation.
002546| src/app/search/page.tsx:33: // Skeleton component for listing cards during loading
002547| NOTE: Line comment documents intent or constraints.
002548| src/app/search/page.tsx:34: function ListingSkeleton() {
002549| NOTE: Defines a helper or component function.
002550| src/app/search/page.tsx:35:   return (
002551| NOTE: Return statement for component or helper output.
002552| src/app/search/page.tsx:36:     <div className="px-4 sm:px-6 py-4 sm:py-6 max-w-[840px] mx-auto pb-24 md:pb-6">
002553| NOTE: Tailwind classes define layout and styling.
002554| src/app/search/page.tsx:37:       <div className="flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6">
002555| NOTE: Tailwind classes define layout and styling.
002556| src/app/search/page.tsx:38:         <div>
002557| NOTE: JSX markup for search UI.
002558| src/app/search/page.tsx:39:           <div className="h-6 w-48 bg-zinc-200 dark:bg-zinc-700 rounded animate-pulse" />
002559| NOTE: Tailwind classes define layout and styling.
002560| src/app/search/page.tsx:40:           <div className="h-4 w-64 bg-zinc-100 dark:bg-zinc-800 rounded mt-2 animate-pulse" />
002561| NOTE: Tailwind classes define layout and styling.
002562| src/app/search/page.tsx:41:         </div>
002563| NOTE: JSX markup for search UI.
002564| src/app/search/page.tsx:42:         <div className="flex items-center gap-2 sm:gap-3">
002565| NOTE: Tailwind classes define layout and styling.
002566| src/app/search/page.tsx:43:           <div className="h-9 w-24 bg-zinc-100 dark:bg-zinc-800 rounded-lg animate-pulse" />
002567| NOTE: Tailwind classes define layout and styling.
002568| src/app/search/page.tsx:44:           <div className="h-9 w-32 bg-zinc-100 dark:bg-zinc-800 rounded-lg animate-pulse" />
002569| NOTE: Tailwind classes define layout and styling.
002570| src/app/search/page.tsx:45:         </div>
002571| NOTE: JSX markup for search UI.
002572| src/app/search/page.tsx:46:       </div>
002573| NOTE: JSX markup for search UI.
002574| src/app/search/page.tsx:47:       <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-x-6 sm:gap-y-8">
002575| NOTE: Tailwind classes define layout and styling.
002576| src/app/search/page.tsx:48:         {[...Array(6)].map((_, i) => (
002577| NOTE: Implementation detail supporting search page behavior.
002578| src/app/search/page.tsx:49:           <div
002579| NOTE: JSX markup for search UI.
002580| src/app/search/page.tsx:50:             key={i}
002581| NOTE: Implementation detail supporting search page behavior.
002582| src/app/search/page.tsx:51:             className="bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden animate-pulse"
002583| NOTE: Tailwind classes define layout and styling.
002584| src/app/search/page.tsx:52:           >
002585| NOTE: Implementation detail supporting search page behavior.
002586| src/app/search/page.tsx:53:             <div className="aspect-[4/3] bg-zinc-200 dark:bg-zinc-700" />
002587| NOTE: Tailwind classes define layout and styling.
002588| src/app/search/page.tsx:54:             <div className="p-4 space-y-3">
002589| NOTE: Tailwind classes define layout and styling.
002590| src/app/search/page.tsx:55:               <div className="h-5 bg-zinc-200 dark:bg-zinc-700 rounded w-3/4" />
002591| NOTE: Tailwind classes define layout and styling.
002592| src/app/search/page.tsx:56:               <div className="h-4 bg-zinc-100 dark:bg-zinc-800 rounded w-1/2" />
002593| NOTE: Tailwind classes define layout and styling.
002594| src/app/search/page.tsx:57:               <div className="flex justify-between items-center pt-2">
002595| NOTE: Tailwind classes define layout and styling.
002596| src/app/search/page.tsx:58:                 <div className="h-5 bg-zinc-200 dark:bg-zinc-700 rounded w-20" />
002597| NOTE: Tailwind classes define layout and styling.
002598| src/app/search/page.tsx:59:                 <div className="h-8 w-8 bg-zinc-100 dark:bg-zinc-800 rounded-full" />
002599| NOTE: Tailwind classes define layout and styling.
002600| src/app/search/page.tsx:60:               </div>
002601| NOTE: JSX markup for search UI.
002602| src/app/search/page.tsx:61:             </div>
002603| NOTE: JSX markup for search UI.
002604| src/app/search/page.tsx:62:           </div>
002605| NOTE: JSX markup for search UI.
002606| src/app/search/page.tsx:63:         ))}
002607| NOTE: Implementation detail supporting search page behavior.
002608| src/app/search/page.tsx:64:       </div>
002609| NOTE: JSX markup for search UI.
002610| src/app/search/page.tsx:65:     </div>
002611| NOTE: JSX markup for search UI.
002612| src/app/search/page.tsx:66:   );
002613| NOTE: Implementation detail supporting search page behavior.
002614| src/app/search/page.tsx:67: }
002615| NOTE: Implementation detail supporting search page behavior.
002616| src/app/search/page.tsx:68: 
002617| NOTE: Blank line for visual separation.
002618| src/app/search/page.tsx:69: const ITEMS_PER_PAGE = 12;
002619| NOTE: Local declaration used by search logic or UI.
002620| src/app/search/page.tsx:70: 
002621| NOTE: Blank line for visual separation.
002622| src/app/search/page.tsx:71: export default async function SearchPage({
002623| NOTE: Exports main component for this module.
002624| src/app/search/page.tsx:72:   searchParams,
002625| NOTE: Implementation detail supporting search page behavior.
002626| src/app/search/page.tsx:73: }: {
002627| NOTE: Implementation detail supporting search page behavior.
002628| src/app/search/page.tsx:74:   searchParams: Promise<{
002629| NOTE: Implementation detail supporting search page behavior.
002630| src/app/search/page.tsx:75:     q?: string;
002631| NOTE: Implementation detail supporting search page behavior.
002632| src/app/search/page.tsx:76:     minPrice?: string;
002633| NOTE: Implementation detail supporting search page behavior.
002634| src/app/search/page.tsx:77:     maxPrice?: string;
002635| NOTE: Implementation detail supporting search page behavior.
002636| src/app/search/page.tsx:78:     amenities?: string | string[];
002637| NOTE: Implementation detail supporting search page behavior.
002638| src/app/search/page.tsx:79:     moveInDate?: string;
002639| NOTE: Implementation detail supporting search page behavior.
002640| src/app/search/page.tsx:80:     leaseDuration?: string;
002641| NOTE: Implementation detail supporting search page behavior.
002642| src/app/search/page.tsx:81:     houseRules?: string | string[];
002643| NOTE: Implementation detail supporting search page behavior.
002644| src/app/search/page.tsx:82:     languages?: string | string[];
002645| NOTE: Implementation detail supporting search page behavior.
002646| src/app/search/page.tsx:83:     roomType?: string;
002647| NOTE: Implementation detail supporting search page behavior.
002648| src/app/search/page.tsx:84:     minLat?: string;
002649| NOTE: Implementation detail supporting search page behavior.
002650| src/app/search/page.tsx:85:     maxLat?: string;
002651| NOTE: Implementation detail supporting search page behavior.
002652| src/app/search/page.tsx:86:     minLng?: string;
002653| NOTE: Implementation detail supporting search page behavior.
002654| src/app/search/page.tsx:87:     maxLng?: string;
002655| NOTE: Implementation detail supporting search page behavior.
002656| src/app/search/page.tsx:88:     lat?: string;
002657| NOTE: Implementation detail supporting search page behavior.
002658| src/app/search/page.tsx:89:     lng?: string;
002659| NOTE: Implementation detail supporting search page behavior.
002660| src/app/search/page.tsx:90:     page?: string;
002661| NOTE: Implementation detail supporting search page behavior.
002662| src/app/search/page.tsx:91:     sort?: string;
002663| NOTE: Implementation detail supporting search page behavior.
002664| src/app/search/page.tsx:92:     nearMatches?: string;
002665| NOTE: Implementation detail supporting search page behavior.
002666| src/app/search/page.tsx:93:     /** Feature flag override for Search API v2 (unified list + map) */
002667| NOTE: Block comment line describing behavior or context.
002668| src/app/search/page.tsx:94:     searchV2?: string;
002669| NOTE: Implementation detail supporting search page behavior.
002670| src/app/search/page.tsx:95:   }>;
002671| NOTE: Implementation detail supporting search page behavior.
002672| src/app/search/page.tsx:96: }) {
002673| NOTE: Implementation detail supporting search page behavior.
002674| src/app/search/page.tsx:97:   const rawParams = await searchParams;
002675| NOTE: Local declaration used by search logic or UI.
002676| src/app/search/page.tsx:98: 
002677| NOTE: Blank line for visual separation.
002678| src/app/search/page.tsx:99:   // P0 fix: Rate limit check before any database queries
002679| NOTE: Line comment documents intent or constraints.
002680| src/app/search/page.tsx:100:   const headersList = await headers();
002681| NOTE: Local declaration used by search logic or UI.
002682| src/app/search/page.tsx:101:   const rateLimit = await checkServerComponentRateLimit(
002683| NOTE: Local declaration used by search logic or UI.
002684| src/app/search/page.tsx:102:     headersList,
002685| NOTE: Implementation detail supporting search page behavior.
002686| src/app/search/page.tsx:103:     "search",
002687| NOTE: Implementation detail supporting search page behavior.
002688| src/app/search/page.tsx:104:     "/search",
002689| NOTE: Implementation detail supporting search page behavior.
002690| src/app/search/page.tsx:105:   );
002691| NOTE: Implementation detail supporting search page behavior.
002692| src/app/search/page.tsx:106:   if (!rateLimit.allowed) {
002693| NOTE: Conditional logic controlling rendering or flow.
002694| src/app/search/page.tsx:107:     return (
002695| NOTE: Return statement for component or helper output.
002696| src/app/search/page.tsx:108:       <div className="min-h-screen flex items-center justify-center bg-zinc-50 dark:bg-zinc-950">
002697| NOTE: Tailwind classes define layout and styling.
002698| src/app/search/page.tsx:109:         <div className="text-center p-8 max-w-md">
002699| NOTE: Tailwind classes define layout and styling.
002700| src/app/search/page.tsx:110:           <div className="w-16 h-16 mx-auto mb-6 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center">
002701| NOTE: Tailwind classes define layout and styling.
002702| src/app/search/page.tsx:111:             <Clock className="w-8 h-8 text-amber-600 dark:text-amber-400" />
002703| NOTE: Tailwind classes define layout and styling.
002704| src/app/search/page.tsx:112:           </div>
002705| NOTE: JSX markup for search UI.
002706| src/app/search/page.tsx:113:           <h1 className="text-2xl font-bold text-zinc-900 dark:text-white mb-3">
002707| NOTE: Tailwind classes define layout and styling.
002708| src/app/search/page.tsx:114:             Too Many Requests
002709| NOTE: Implementation detail supporting search page behavior.
002710| src/app/search/page.tsx:115:           </h1>
002711| NOTE: JSX markup for search UI.
002712| src/app/search/page.tsx:116:           <p className="text-zinc-600 dark:text-zinc-400 mb-6">
002713| NOTE: Tailwind classes define layout and styling.
002714| src/app/search/page.tsx:117:             You are searching too quickly. Please wait a moment before trying
002715| NOTE: Implementation detail supporting search page behavior.
002716| src/app/search/page.tsx:118:             again.
002717| NOTE: Implementation detail supporting search page behavior.
002718| src/app/search/page.tsx:119:           </p>
002719| NOTE: JSX markup for search UI.
002720| src/app/search/page.tsx:120:           <p className="text-sm text-zinc-500 dark:text-zinc-500">
002721| NOTE: Tailwind classes define layout and styling.
002722| src/app/search/page.tsx:121:             Try again in {rateLimit.retryAfter || 60} seconds
002723| NOTE: Implementation detail supporting search page behavior.
002724| src/app/search/page.tsx:122:           </p>
002725| NOTE: JSX markup for search UI.
002726| src/app/search/page.tsx:123:         </div>
002727| NOTE: JSX markup for search UI.
002728| src/app/search/page.tsx:124:       </div>
002729| NOTE: JSX markup for search UI.
002730| src/app/search/page.tsx:125:     );
002731| NOTE: Implementation detail supporting search page behavior.
002732| src/app/search/page.tsx:126:   }
002733| NOTE: Implementation detail supporting search page behavior.
002734| src/app/search/page.tsx:127: 
002735| NOTE: Blank line for visual separation.
002736| src/app/search/page.tsx:128:   const session = await auth();
002737| NOTE: Local declaration used by search logic or UI.
002738| src/app/search/page.tsx:129:   const userId = session?.user?.id;
002739| NOTE: Local declaration used by search logic or UI.
002740| src/app/search/page.tsx:130: 
002741| NOTE: Blank line for visual separation.
002742| src/app/search/page.tsx:131:   const { q, filterParams, requestedPage, sortOption } =
002743| NOTE: Local declaration used by search logic or UI.
002744| src/app/search/page.tsx:132:     parseSearchParams(rawParams);
002745| NOTE: Implementation detail supporting search page behavior.
002746| src/app/search/page.tsx:133: 
002747| NOTE: Blank line for visual separation.
002748| src/app/search/page.tsx:134:   // Detect v2 mode: global feature flag OR URL param override (?searchV2=1)
002749| NOTE: Line comment documents intent or constraints.
002750| src/app/search/page.tsx:135:   const useV2 = features.searchV2 || rawParams.searchV2 === "1";
002751| NOTE: Local declaration used by search logic or UI.
002752| src/app/search/page.tsx:136: 
002753| NOTE: Blank line for visual separation.
002754| src/app/search/page.tsx:137:   // Fetch listings with error handling - graceful degradation instead of error boundary
002755| NOTE: Line comment documents intent or constraints.
002756| src/app/search/page.tsx:138:   let paginatedResult;
002757| NOTE: Local declaration used by search logic or UI.
002758| src/app/search/page.tsx:139:   let fetchError: string | null = null;
002759| NOTE: Local declaration used by search logic or UI.
002760| src/app/search/page.tsx:140:   let v2MapData: V2MapData | null = null;
002761| NOTE: Local declaration used by search logic or UI.
002762| src/app/search/page.tsx:141: 
002763| NOTE: Blank line for visual separation.
002764| src/app/search/page.tsx:142:   if (useV2) {
002765| NOTE: Conditional logic controlling rendering or flow.
002766| src/app/search/page.tsx:143:     // V2 path: unified fetch for list + map data
002767| NOTE: Line comment documents intent or constraints.
002768| src/app/search/page.tsx:144:     const v2Result = await executeSearchV2({
002769| NOTE: Local declaration used by search logic or UI.
002770| src/app/search/page.tsx:145:       rawParams: rawParams as Record<string, string>,
002771| NOTE: Implementation detail supporting search page behavior.
002772| src/app/search/page.tsx:146:       limit: ITEMS_PER_PAGE,
002773| NOTE: Implementation detail supporting search page behavior.
002774| src/app/search/page.tsx:147:     });
002775| NOTE: Implementation detail supporting search page behavior.
002776| src/app/search/page.tsx:148: 
002777| NOTE: Blank line for visual separation.
002778| src/app/search/page.tsx:149:     if (v2Result.response && v2Result.paginatedResult) {
002779| NOTE: Conditional logic controlling rendering or flow.
002780| src/app/search/page.tsx:150:       // Extract map data for context injection
002781| NOTE: Line comment documents intent or constraints.
002782| src/app/search/page.tsx:151:       v2MapData = {
002783| NOTE: Implementation detail supporting search page behavior.
002784| src/app/search/page.tsx:152:         geojson: v2Result.response.map.geojson,
002785| NOTE: Implementation detail supporting search page behavior.
002786| src/app/search/page.tsx:153:         pins: v2Result.response.map.pins,
002787| NOTE: Implementation detail supporting search page behavior.
002788| src/app/search/page.tsx:154:         mode: v2Result.response.meta.mode,
002789| NOTE: Implementation detail supporting search page behavior.
002790| src/app/search/page.tsx:155:       };
002791| NOTE: Implementation detail supporting search page behavior.
002792| src/app/search/page.tsx:156:       paginatedResult = v2Result.paginatedResult;
002793| NOTE: Implementation detail supporting search page behavior.
002794| src/app/search/page.tsx:157:     } else {
002795| NOTE: Implementation detail supporting search page behavior.
002796| src/app/search/page.tsx:158:       // V2 failed, fall back to v1 path
002797| NOTE: Line comment documents intent or constraints.
002798| src/app/search/page.tsx:159:       fetchError = v2Result.error || null;
002799| NOTE: Implementation detail supporting search page behavior.
002800| src/app/search/page.tsx:160:     }
002801| NOTE: Implementation detail supporting search page behavior.
002802| src/app/search/page.tsx:161:   }
002803| NOTE: Implementation detail supporting search page behavior.
002804| src/app/search/page.tsx:162: 
002805| NOTE: Blank line for visual separation.
002806| src/app/search/page.tsx:163:   // V1 path (or fallback when v2 fails)
002807| NOTE: Line comment documents intent or constraints.
002808| src/app/search/page.tsx:164:   if (!paginatedResult) {
002809| NOTE: Conditional logic controlling rendering or flow.
002810| src/app/search/page.tsx:165:     try {
002811| NOTE: Implementation detail supporting search page behavior.
002812| src/app/search/page.tsx:166:       paginatedResult = await getListingsPaginated({
002813| NOTE: Implementation detail supporting search page behavior.
002814| src/app/search/page.tsx:167:         ...filterParams,
002815| NOTE: Implementation detail supporting search page behavior.
002816| src/app/search/page.tsx:168:         page: requestedPage,
002817| NOTE: Implementation detail supporting search page behavior.
002818| src/app/search/page.tsx:169:         limit: ITEMS_PER_PAGE,
002819| NOTE: Implementation detail supporting search page behavior.
002820| src/app/search/page.tsx:170:       });
002821| NOTE: Implementation detail supporting search page behavior.
002822| src/app/search/page.tsx:171:     } catch (err) {
002823| NOTE: Implementation detail supporting search page behavior.
002824| src/app/search/page.tsx:172:       console.error("Search listings fetch failed:", err);
002825| NOTE: Implementation detail supporting search page behavior.
002826| src/app/search/page.tsx:173:       fetchError =
002827| NOTE: Implementation detail supporting search page behavior.
002828| src/app/search/page.tsx:174:         err instanceof Error
002829| NOTE: Implementation detail supporting search page behavior.
002830| src/app/search/page.tsx:175:           ? err.message
002831| NOTE: Implementation detail supporting search page behavior.
002832| src/app/search/page.tsx:176:           : "Unable to load listings. Please try again.";
002833| NOTE: Implementation detail supporting search page behavior.
002834| src/app/search/page.tsx:177:       // Provide empty fallback to render gracefully
002835| NOTE: Line comment documents intent or constraints.
002836| src/app/search/page.tsx:178:       paginatedResult = {
002837| NOTE: Implementation detail supporting search page behavior.
002838| src/app/search/page.tsx:179:         items: [],
002839| NOTE: Implementation detail supporting search page behavior.
002840| src/app/search/page.tsx:180:         total: 0,
002841| NOTE: Implementation detail supporting search page behavior.
002842| src/app/search/page.tsx:181:         totalPages: 0,
002843| NOTE: Implementation detail supporting search page behavior.
002844| src/app/search/page.tsx:182:         hasNextPage: false,
002845| NOTE: Implementation detail supporting search page behavior.
002846| src/app/search/page.tsx:183:         hasPrevPage: false,
002847| NOTE: Implementation detail supporting search page behavior.
002848| src/app/search/page.tsx:184:         page: requestedPage,
002849| NOTE: Implementation detail supporting search page behavior.
002850| src/app/search/page.tsx:185:       };
002851| NOTE: Implementation detail supporting search page behavior.
002852| src/app/search/page.tsx:186:     }
002853| NOTE: Implementation detail supporting search page behavior.
002854| src/app/search/page.tsx:187:   }
002855| NOTE: Implementation detail supporting search page behavior.
002856| src/app/search/page.tsx:188: 
002857| NOTE: Blank line for visual separation.
002858| src/app/search/page.tsx:189:   // Non-critical data - graceful degradation
002859| NOTE: Line comment documents intent or constraints.
002860| src/app/search/page.tsx:190:   // Note: Map data is now fetched client-side by PersistentMapWrapper in layout.tsx
002861| NOTE: Line comment documents intent or constraints.
002862| src/app/search/page.tsx:191:   const savedListingIds = userId
002863| NOTE: Local declaration used by search logic or UI.
002864| src/app/search/page.tsx:192:     ? await getSavedListingIds(userId).catch(() => [])
002865| NOTE: Implementation detail supporting search page behavior.
002866| src/app/search/page.tsx:193:     : [];
002867| NOTE: Implementation detail supporting search page behavior.
002868| src/app/search/page.tsx:194: 
002869| NOTE: Blank line for visual separation.
002870| src/app/search/page.tsx:195:   const {
002871| NOTE: Local declaration used by search logic or UI.
002872| src/app/search/page.tsx:196:     items: listings,
002873| NOTE: Implementation detail supporting search page behavior.
002874| src/app/search/page.tsx:197:     total,
002875| NOTE: Implementation detail supporting search page behavior.
002876| src/app/search/page.tsx:198:     totalPages,
002877| NOTE: Implementation detail supporting search page behavior.
002878| src/app/search/page.tsx:199:     hasNextPage,
002879| NOTE: Implementation detail supporting search page behavior.
002880| src/app/search/page.tsx:200:     hasPrevPage,
002881| NOTE: Implementation detail supporting search page behavior.
002882| src/app/search/page.tsx:201:     page: currentPage,
002883| NOTE: Implementation detail supporting search page behavior.
002884| src/app/search/page.tsx:202:     nearMatchCount,
002885| NOTE: Implementation detail supporting search page behavior.
002886| src/app/search/page.tsx:203:   } = paginatedResult;
002887| NOTE: Implementation detail supporting search page behavior.
002888| src/app/search/page.tsx:204: 
002889| NOTE: Blank line for visual separation.
002890| src/app/search/page.tsx:205:   // Filter suggestions are now lazy-loaded by ZeroResultsSuggestions component
002891| NOTE: Line comment documents intent or constraints.
002892| src/app/search/page.tsx:206: 
002893| NOTE: Blank line for visual separation.
002894| src/app/search/page.tsx:207:   const listContent = (
002895| NOTE: Local declaration used by search logic or UI.
002896| src/app/search/page.tsx:208:     <div className="flex flex-col">
002897| NOTE: Tailwind classes define layout and styling.
002898| src/app/search/page.tsx:209:       {/* Inject v2 map data into context for PersistentMapWrapper (renders nothing) */}
002899| NOTE: Implementation detail supporting search page behavior.
002900| src/app/search/page.tsx:210:       {v2MapData && <V2MapDataSetter data={v2MapData} />}
002901| NOTE: Implementation detail supporting search page behavior.
002902| src/app/search/page.tsx:211: 
002903| NOTE: Blank line for visual separation.
002904| src/app/search/page.tsx:212:       {/* Error banner - shows when fetch failed, with retry */}
002905| NOTE: Implementation detail supporting search page behavior.
002906| src/app/search/page.tsx:213:       {fetchError && <SearchErrorBanner message={fetchError} />}
002907| NOTE: Implementation detail supporting search page behavior.
002908| src/app/search/page.tsx:214: 
002909| NOTE: Blank line for visual separation.
002910| src/app/search/page.tsx:215:       <div className="px-4 sm:px-6 py-4 sm:py-6 max-w-[840px] mx-auto pb-24 md:pb-6">
002911| NOTE: Tailwind classes define layout and styling.
002912| src/app/search/page.tsx:216:         {/* Screen reader announcement for search results */}
002913| NOTE: Implementation detail supporting search page behavior.
002914| src/app/search/page.tsx:217:         <div aria-live="polite" aria-atomic="true" className="sr-only">
002915| NOTE: Tailwind classes define layout and styling.
002916| src/app/search/page.tsx:218:           {listings.length === 0
002917| NOTE: Implementation detail supporting search page behavior.
002918| src/app/search/page.tsx:219:             ? `No listings found${q ? ` for "${q}"` : ""}`
002919| NOTE: Implementation detail supporting search page behavior.
002920| src/app/search/page.tsx:220:             : total !== null
002921| NOTE: Implementation detail supporting search page behavior.
002922| src/app/search/page.tsx:221:               ? `Found ${total} ${total === 1 ? "listing" : "listings"}${q ? ` for "${q}"` : ""}`
002923| NOTE: Implementation detail supporting search page behavior.
002924| src/app/search/page.tsx:222:               : `Found 100+ listings${q ? ` for "${q}"` : ""}`}
002925| NOTE: Implementation detail supporting search page behavior.
002926| src/app/search/page.tsx:223:         </div>
002927| NOTE: JSX markup for search UI.
002928| src/app/search/page.tsx:224: 
002929| NOTE: Blank line for visual separation.
002930| src/app/search/page.tsx:225:         <div className="flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6">
002931| NOTE: Tailwind classes define layout and styling.
002932| src/app/search/page.tsx:226:           <div>
002933| NOTE: JSX markup for search UI.
002934| src/app/search/page.tsx:227:             {/* tabIndex -1 allows programmatic focus for screen readers */}
002935| NOTE: Implementation detail supporting search page behavior.
002936| src/app/search/page.tsx:228:             <h1
002937| NOTE: JSX markup for search UI.
002938| src/app/search/page.tsx:229:               id="search-results-heading"
002939| NOTE: Implementation detail supporting search page behavior.
002940| src/app/search/page.tsx:230:               tabIndex={-1}
002941| NOTE: Implementation detail supporting search page behavior.
002942| src/app/search/page.tsx:231:               className="text-lg sm:text-xl font-semibold text-zinc-900 dark:text-white tracking-tight outline-none"
002943| NOTE: Tailwind classes define layout and styling.
002944| src/app/search/page.tsx:232:             >
002945| NOTE: Implementation detail supporting search page behavior.
002946| src/app/search/page.tsx:233:               {total !== null ? (
002947| NOTE: Implementation detail supporting search page behavior.
002948| src/app/search/page.tsx:234:                 <>
002949| NOTE: JSX markup for search UI.
002950| src/app/search/page.tsx:235:                   {total} {total === 1 ? "place" : "places"}{" "}
002951| NOTE: Implementation detail supporting search page behavior.
002952| src/app/search/page.tsx:236:                   {q ? `in "${q}"` : "available"}
002953| NOTE: Implementation detail supporting search page behavior.
002954| src/app/search/page.tsx:237:                 </>
002955| NOTE: JSX markup for search UI.
002956| src/app/search/page.tsx:238:               ) : (
002957| NOTE: Implementation detail supporting search page behavior.
002958| src/app/search/page.tsx:239:                 <>
002959| NOTE: JSX markup for search UI.
002960| src/app/search/page.tsx:240:                   <span className="inline-flex items-center gap-1.5 group relative">
002961| NOTE: Tailwind classes define layout and styling.
002962| src/app/search/page.tsx:241:                     100+
002963| NOTE: Implementation detail supporting search page behavior.
002964| src/app/search/page.tsx:242:                     <button
002965| NOTE: JSX markup for search UI.
002966| src/app/search/page.tsx:243:                       type="button"
002967| NOTE: Implementation detail supporting search page behavior.
002968| src/app/search/page.tsx:244:                       className="text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-1 rounded-full align-middle"
002969| NOTE: Tailwind classes define layout and styling.
002970| src/app/search/page.tsx:245:                       aria-label="Why 100+ results?"
002971| NOTE: Accessibility attribute for screen readers.
002972| src/app/search/page.tsx:246:                     >
002973| NOTE: Implementation detail supporting search page behavior.
002974| src/app/search/page.tsx:247:                       <Info className="w-4 h-4" />
002975| NOTE: Tailwind classes define layout and styling.
002976| src/app/search/page.tsx:248:                     </button>
002977| NOTE: JSX markup for search UI.
002978| src/app/search/page.tsx:249:                     {/* Tooltip - shows on hover/focus within group */}
002979| NOTE: Implementation detail supporting search page behavior.
002980| src/app/search/page.tsx:250:                     <span
002981| NOTE: JSX markup for search UI.
002982| src/app/search/page.tsx:251:                       role="tooltip"
002983| NOTE: Implementation detail supporting search page behavior.
002984| src/app/search/page.tsx:252:                       className="invisible group-hover:visible group-focus-within:visible absolute top-full left-0 mt-2 px-3 py-2 text-xs font-medium text-white bg-zinc-800 dark:bg-zinc-700 rounded-lg shadow-lg whitespace-nowrap z-50 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity"
002985| NOTE: Tailwind classes define layout and styling.
002986| src/app/search/page.tsx:253:                     >
002987| NOTE: Implementation detail supporting search page behavior.
002988| src/app/search/page.tsx:254:                       We limit counts to 100+ for faster searches.
002989| NOTE: Implementation detail supporting search page behavior.
002990| src/app/search/page.tsx:255:                       <br />
002991| NOTE: JSX markup for search UI.
002992| src/app/search/page.tsx:256:                       Refine your filters for an exact count.
002993| NOTE: Implementation detail supporting search page behavior.
002994| src/app/search/page.tsx:257:                       <span className="absolute bottom-full left-4 border-4 border-transparent border-b-zinc-800 dark:border-b-zinc-700" />
002995| NOTE: Tailwind classes define layout and styling.
002996| src/app/search/page.tsx:258:                     </span>
002997| NOTE: JSX markup for search UI.
002998| src/app/search/page.tsx:259:                   </span>{" "}
002999| NOTE: JSX markup for search UI.
003000| src/app/search/page.tsx:260:                   places {q ? `in "${q}"` : "available"}
003001| NOTE: Implementation detail supporting search page behavior.
003002| src/app/search/page.tsx:261:                 </>
003003| NOTE: JSX markup for search UI.
003004| src/app/search/page.tsx:262:               )}
003005| NOTE: Implementation detail supporting search page behavior.
003006| src/app/search/page.tsx:263:             </h1>
003007| NOTE: JSX markup for search UI.
003008| src/app/search/page.tsx:264:             {q ? (
003009| NOTE: Implementation detail supporting search page behavior.
003010| src/app/search/page.tsx:265:               <p className="text-sm text-zinc-500 dark:text-zinc-400 mt-1 flex items-center gap-1">
003011| NOTE: Tailwind classes define layout and styling.
003012| src/app/search/page.tsx:266:                 <MapPin className="w-3.5 h-3.5" />
003013| NOTE: Tailwind classes define layout and styling.
003014| src/app/search/page.tsx:267:                 <span>
003015| NOTE: JSX markup for search UI.
003016| src/app/search/page.tsx:268:                   Results pinned to <span className="font-medium">{q}</span>
003017| NOTE: Tailwind classes define layout and styling.
003018| src/app/search/page.tsx:269:                 </span>
003019| NOTE: JSX markup for search UI.
003020| src/app/search/page.tsx:270:               </p>
003021| NOTE: JSX markup for search UI.
003022| src/app/search/page.tsx:271:             ) : (
003023| NOTE: Implementation detail supporting search page behavior.
003024| src/app/search/page.tsx:272:               <p className="text-sm text-zinc-500 dark:text-zinc-400 mt-1">
003025| NOTE: Tailwind classes define layout and styling.
003026| src/app/search/page.tsx:273:                 Book a place that fits your lifestyle.
003027| NOTE: Implementation detail supporting search page behavior.
003028| src/app/search/page.tsx:274:               </p>
003029| NOTE: JSX markup for search UI.
003030| src/app/search/page.tsx:275:             )}
003031| NOTE: Implementation detail supporting search page behavior.
003032| src/app/search/page.tsx:276:           </div>
003033| NOTE: JSX markup for search UI.
003034| src/app/search/page.tsx:277: 
003035| NOTE: Blank line for visual separation.
003036| src/app/search/page.tsx:278:           <div className="flex items-center gap-2 sm:gap-3">
003037| NOTE: Tailwind classes define layout and styling.
003038| src/app/search/page.tsx:279:             <SaveSearchButton />
003039| NOTE: JSX markup for search UI.
003040| src/app/search/page.tsx:280:             <SortSelect currentSort={sortOption} />
003041| NOTE: JSX markup for search UI.
003042| src/app/search/page.tsx:281:           </div>
003043| NOTE: JSX markup for search UI.
003044| src/app/search/page.tsx:282:         </div>
003045| NOTE: JSX markup for search UI.
003046| src/app/search/page.tsx:283: 
003047| NOTE: Blank line for visual separation.
003048| src/app/search/page.tsx:284:         {listings.length === 0 ? (
003049| NOTE: Implementation detail supporting search page behavior.
003050| src/app/search/page.tsx:285:           <div className="flex flex-col items-center justify-center py-12 sm:py-20 border-2 border-dashed border-zinc-100 dark:border-zinc-800 rounded-2xl sm:rounded-3xl bg-zinc-50/50 dark:bg-zinc-900/50">
003051| NOTE: Tailwind classes define layout and styling.
003052| src/app/search/page.tsx:286:             <div className="w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-white dark:bg-zinc-800 flex items-center justify-center shadow-sm mb-4">
003053| NOTE: Tailwind classes define layout and styling.
003054| src/app/search/page.tsx:287:               <Search className="w-5 h-5 sm:w-6 sm:h-6 text-zinc-400" />
003055| NOTE: Tailwind classes define layout and styling.
003056| src/app/search/page.tsx:288:             </div>
003057| NOTE: JSX markup for search UI.
003058| src/app/search/page.tsx:289:             <h3 className="text-base sm:text-lg font-semibold text-zinc-900 dark:text-white mb-2">
003059| NOTE: Tailwind classes define layout and styling.
003060| src/app/search/page.tsx:290:               No matches found
003061| NOTE: Implementation detail supporting search page behavior.
003062| src/app/search/page.tsx:291:             </h3>
003063| NOTE: JSX markup for search UI.
003064| src/app/search/page.tsx:292:             <p className="text-zinc-500 dark:text-zinc-400 text-sm max-w-xs text-center px-4">
003065| NOTE: Tailwind classes define layout and styling.
003066| src/app/search/page.tsx:293:               We couldn't find any listings {q ? `for "${q}"` : ""}.
003067| NOTE: Implementation detail supporting search page behavior.
003068| src/app/search/page.tsx:294:             </p>
003069| NOTE: JSX markup for search UI.
003070| src/app/search/page.tsx:295: 
003071| NOTE: Blank line for visual separation.
003072| src/app/search/page.tsx:296:             {/* Smart filter suggestions - lazy loaded on user request */}
003073| NOTE: Implementation detail supporting search page behavior.
003074| src/app/search/page.tsx:297:             <div className="w-full max-w-sm px-4 mt-4">
003075| NOTE: Tailwind classes define layout and styling.
003076| src/app/search/page.tsx:298:               <Suspense fallback={null}>
003077| NOTE: JSX markup for search UI.
003078| src/app/search/page.tsx:299:                 <ZeroResultsSuggestions filterParams={filterParams} query={q} />
003079| NOTE: JSX markup for search UI.
003080| src/app/search/page.tsx:300:               </Suspense>
003081| NOTE: JSX markup for search UI.
003082| src/app/search/page.tsx:301:             </div>
003083| NOTE: JSX markup for search UI.
003084| src/app/search/page.tsx:302:           </div>
003085| NOTE: JSX markup for search UI.
003086| src/app/search/page.tsx:303:         ) : (
003087| NOTE: Implementation detail supporting search page behavior.
003088| src/app/search/page.tsx:304:           <>
003089| NOTE: JSX markup for search UI.
003090| src/app/search/page.tsx:305:             {/* Low results guidance - shows when 1-4 exact matches */}
003091| NOTE: Implementation detail supporting search page behavior.
003092| src/app/search/page.tsx:306:             <LowResultsGuidance
003093| NOTE: JSX markup for search UI.
003094| src/app/search/page.tsx:307:               resultCount={listings.filter((l) => !l.isNearMatch).length}
003095| NOTE: Implementation detail supporting search page behavior.
003096| src/app/search/page.tsx:308:               filterParams={filterParams}
003097| NOTE: Implementation detail supporting search page behavior.
003098| src/app/search/page.tsx:309:               nearMatchesEnabled={filterParams.nearMatches === true}
003099| NOTE: Implementation detail supporting search page behavior.
003100| src/app/search/page.tsx:310:               nearMatchCount={nearMatchCount}
003101| NOTE: Implementation detail supporting search page behavior.
003102| src/app/search/page.tsx:311:             />
003103| NOTE: Implementation detail supporting search page behavior.
003104| src/app/search/page.tsx:312: 
003105| NOTE: Blank line for visual separation.
003106| src/app/search/page.tsx:313:             <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-x-6 sm:gap-y-8">
003107| NOTE: Tailwind classes define layout and styling.
003108| src/app/search/page.tsx:314:               {/* Exact matches first */}
003109| NOTE: Implementation detail supporting search page behavior.
003110| src/app/search/page.tsx:315:               {listings
003111| NOTE: Implementation detail supporting search page behavior.
003112| src/app/search/page.tsx:316:                 .filter((listing) => !listing.isNearMatch)
003113| NOTE: Implementation detail supporting search page behavior.
003114| src/app/search/page.tsx:317:                 .map((listing) => (
003115| NOTE: Implementation detail supporting search page behavior.
003116| src/app/search/page.tsx:318:                   <ListingCard
003117| NOTE: JSX markup for search UI.
003118| src/app/search/page.tsx:319:                     key={listing.id}
003119| NOTE: Implementation detail supporting search page behavior.
003120| src/app/search/page.tsx:320:                     listing={listing}
003121| NOTE: Implementation detail supporting search page behavior.
003122| src/app/search/page.tsx:321:                     isSaved={savedListingIds.includes(listing.id)}
003123| NOTE: Implementation detail supporting search page behavior.
003124| src/app/search/page.tsx:322:                   />
003125| NOTE: Implementation detail supporting search page behavior.
003126| src/app/search/page.tsx:323:                 ))}
003127| NOTE: Implementation detail supporting search page behavior.
003128| src/app/search/page.tsx:324: 
003129| NOTE: Blank line for visual separation.
003130| src/app/search/page.tsx:325:               {/* Near-match separator and listings */}
003131| NOTE: Implementation detail supporting search page behavior.
003132| src/app/search/page.tsx:326:               {(nearMatchCount ?? 0) > 0 && (
003133| NOTE: Implementation detail supporting search page behavior.
003134| src/app/search/page.tsx:327:                 <>
003135| NOTE: JSX markup for search UI.
003136| src/app/search/page.tsx:328:                   <NearMatchSeparator nearMatchCount={nearMatchCount ?? 0} />
003137| NOTE: JSX markup for search UI.
003138| src/app/search/page.tsx:329:                   {listings
003139| NOTE: Implementation detail supporting search page behavior.
003140| src/app/search/page.tsx:330:                     .filter((listing) => listing.isNearMatch)
003141| NOTE: Implementation detail supporting search page behavior.
003142| src/app/search/page.tsx:331:                     .map((listing) => (
003143| NOTE: Implementation detail supporting search page behavior.
003144| src/app/search/page.tsx:332:                       <ListingCard
003145| NOTE: JSX markup for search UI.
003146| src/app/search/page.tsx:333:                         key={listing.id}
003147| NOTE: Implementation detail supporting search page behavior.
003148| src/app/search/page.tsx:334:                         listing={listing}
003149| NOTE: Implementation detail supporting search page behavior.
003150| src/app/search/page.tsx:335:                         isSaved={savedListingIds.includes(listing.id)}
003151| NOTE: Implementation detail supporting search page behavior.
003152| src/app/search/page.tsx:336:                       />
003153| NOTE: Implementation detail supporting search page behavior.
003154| src/app/search/page.tsx:337:                     ))}
003155| NOTE: Implementation detail supporting search page behavior.
003156| src/app/search/page.tsx:338:                 </>
003157| NOTE: JSX markup for search UI.
003158| src/app/search/page.tsx:339:               )}
003159| NOTE: Implementation detail supporting search page behavior.
003160| src/app/search/page.tsx:340:             </div>
003161| NOTE: JSX markup for search UI.
003162| src/app/search/page.tsx:341: 
003163| NOTE: Blank line for visual separation.
003164| src/app/search/page.tsx:342:             {/* Pagination */}
003165| NOTE: Implementation detail supporting search page behavior.
003166| src/app/search/page.tsx:343:             <Suspense fallback={null}>
003167| NOTE: JSX markup for search UI.
003168| src/app/search/page.tsx:344:               <Pagination
003169| NOTE: JSX markup for search UI.
003170| src/app/search/page.tsx:345:                 currentPage={currentPage}
003171| NOTE: Implementation detail supporting search page behavior.
003172| src/app/search/page.tsx:346:                 totalPages={totalPages}
003173| NOTE: Implementation detail supporting search page behavior.
003174| src/app/search/page.tsx:347:                 totalItems={total}
003175| NOTE: Implementation detail supporting search page behavior.
003176| src/app/search/page.tsx:348:                 itemsPerPage={ITEMS_PER_PAGE}
003177| NOTE: Implementation detail supporting search page behavior.
003178| src/app/search/page.tsx:349:                 hasNextPage={hasNextPage}
003179| NOTE: Implementation detail supporting search page behavior.
003180| src/app/search/page.tsx:350:                 hasPrevPage={hasPrevPage}
003181| NOTE: Implementation detail supporting search page behavior.
003182| src/app/search/page.tsx:351:               />
003183| NOTE: Implementation detail supporting search page behavior.
003184| src/app/search/page.tsx:352:             </Suspense>
003185| NOTE: JSX markup for search UI.
003186| src/app/search/page.tsx:353:           </>
003187| NOTE: JSX markup for search UI.
003188| src/app/search/page.tsx:354:         )}
003189| NOTE: Implementation detail supporting search page behavior.
003190| src/app/search/page.tsx:355:       </div>
003191| NOTE: JSX markup for search UI.
003192| src/app/search/page.tsx:356:     </div>
003193| NOTE: JSX markup for search UI.
003194| src/app/search/page.tsx:357:   );
003195| NOTE: Implementation detail supporting search page behavior.
003196| src/app/search/page.tsx:358: 
003197| NOTE: Blank line for visual separation.
003198| src/app/search/page.tsx:359:   // Note: Header and map are now in layout.tsx (persistent)
003199| NOTE: Line comment documents intent or constraints.
003200| src/app/search/page.tsx:360:   // This page only renders the results list content
003201| NOTE: Line comment documents intent or constraints.
003202| src/app/search/page.tsx:361:   // The layout's SearchLayoutView handles the split view structure
003203| NOTE: Line comment documents intent or constraints.
003204| src/app/search/page.tsx:362: 
003205| NOTE: Blank line for visual separation.
003206| src/app/search/page.tsx:363:   return listContent;
003207| NOTE: Return statement for component or helper output.
003208| src/app/search/page.tsx:364: }
003209| NOTE: Implementation detail supporting search page behavior.
003210| FILE END: src/app/search/page.tsx
003211| 
003212| FILE START: src/auth.ts
003213| FILE ROLE: Auto-discovered dependency in search page graph.
003214| src/auth.ts:1: import NextAuth from "next-auth";
003215| NOTE: Imports dependency for this module.
003216| src/auth.ts:2: import Credentials from "next-auth/providers/credentials";
003217| NOTE: Imports dependency for this module.
003218| src/auth.ts:3: import Google from "next-auth/providers/google";
003219| NOTE: Imports dependency for this module.
003220| src/auth.ts:4: import { PrismaAdapter } from "@auth/prisma-adapter";
003221| NOTE: Imports dependency for this module.
003222| src/auth.ts:5: import { prisma } from "@/lib/prisma";
003223| NOTE: Imports dependency for this module.
003224| src/auth.ts:6: import bcrypt from "bcryptjs";
003225| NOTE: Imports dependency for this module.
003226| src/auth.ts:7: import { z } from "zod";
003227| NOTE: Imports dependency for this module.
003228| src/auth.ts:8: import { logger } from "@/lib/logger";
003229| NOTE: Imports dependency for this module.
003230| src/auth.ts:9: 
003231| NOTE: Blank line for visual separation.
003232| src/auth.ts:10: async function getUser(email: string) {
003233| NOTE: Implementation detail supporting search page behavior.
003234| src/auth.ts:11:   try {
003235| NOTE: Implementation detail supporting search page behavior.
003236| src/auth.ts:12:     const user = await prisma.user.findUnique({
003237| NOTE: Local declaration used by search logic or UI.
003238| src/auth.ts:13:       where: { email },
003239| NOTE: Implementation detail supporting search page behavior.
003240| src/auth.ts:14:     });
003241| NOTE: Implementation detail supporting search page behavior.
003242| src/auth.ts:15:     return user;
003243| NOTE: Return statement for component or helper output.
003244| src/auth.ts:16:   } catch (error) {
003245| NOTE: Implementation detail supporting search page behavior.
003246| src/auth.ts:17:     logger.sync.error("Failed to fetch user", {
003247| NOTE: Implementation detail supporting search page behavior.
003248| src/auth.ts:18:       error: error instanceof Error ? error.message : String(error),
003249| NOTE: Implementation detail supporting search page behavior.
003250| src/auth.ts:19:     });
003251| NOTE: Implementation detail supporting search page behavior.
003252| src/auth.ts:20:     throw new Error("Failed to fetch user.");
003253| NOTE: Implementation detail supporting search page behavior.
003254| src/auth.ts:21:   }
003255| NOTE: Implementation detail supporting search page behavior.
003256| src/auth.ts:22: }
003257| NOTE: Implementation detail supporting search page behavior.
003258| src/auth.ts:23: 
003259| NOTE: Blank line for visual separation.
003260| src/auth.ts:24: export const { handlers, auth, signIn, signOut } = NextAuth({
003261| NOTE: Implementation detail supporting search page behavior.
003262| src/auth.ts:25:   adapter: PrismaAdapter(prisma) as any,
003263| NOTE: Implementation detail supporting search page behavior.
003264| src/auth.ts:26:   pages: {
003265| NOTE: Implementation detail supporting search page behavior.
003266| src/auth.ts:27:     signIn: "/login",
003267| NOTE: Implementation detail supporting search page behavior.
003268| src/auth.ts:28:     error: "/login", // Redirect OAuth errors to login page with error params
003269| NOTE: Implementation detail supporting search page behavior.
003270| src/auth.ts:29:   },
003271| NOTE: Implementation detail supporting search page behavior.
003272| src/auth.ts:30:   session: {
003273| NOTE: Implementation detail supporting search page behavior.
003274| src/auth.ts:31:     strategy: "jwt",
003275| NOTE: Implementation detail supporting search page behavior.
003276| src/auth.ts:32:     maxAge: 14 * 24 * 60 * 60, // 14 days (security hardening from 30 days)
003277| NOTE: Implementation detail supporting search page behavior.
003278| src/auth.ts:33:     updateAge: 24 * 60 * 60, // Refresh token once per day
003279| NOTE: Implementation detail supporting search page behavior.
003280| src/auth.ts:34:   },
003281| NOTE: Implementation detail supporting search page behavior.
003282| src/auth.ts:35:   // Note: In NextAuth v5 (Auth.js), account linking is handled by the adapter
003283| NOTE: Line comment documents intent or constraints.
003284| src/auth.ts:36:   // The Prisma adapter will auto-link accounts when email matches
003285| NOTE: Line comment documents intent or constraints.
003286| src/auth.ts:37:   callbacks: {
003287| NOTE: Implementation detail supporting search page behavior.
003288| src/auth.ts:38:     async session({ session, token }) {
003289| NOTE: Implementation detail supporting search page behavior.
003290| src/auth.ts:39:       if (token.sub && session.user) {
003291| NOTE: Conditional logic controlling rendering or flow.
003292| src/auth.ts:40:         session.user.id = token.sub;
003293| NOTE: Implementation detail supporting search page behavior.
003294| src/auth.ts:41:         session.user.emailVerified = token.emailVerified as Date | null;
003295| NOTE: Implementation detail supporting search page behavior.
003296| src/auth.ts:42:         session.user.isAdmin = token.isAdmin as boolean;
003297| NOTE: Implementation detail supporting search page behavior.
003298| src/auth.ts:43:         session.user.isSuspended = token.isSuspended as boolean;
003299| NOTE: Implementation detail supporting search page behavior.
003300| src/auth.ts:44:         // Include image from token (refreshed from DB on each request)
003301| NOTE: Line comment documents intent or constraints.
003302| src/auth.ts:45:         if (token.image) {
003303| NOTE: Conditional logic controlling rendering or flow.
003304| src/auth.ts:46:           session.user.image = token.image as string;
003305| NOTE: Implementation detail supporting search page behavior.
003306| src/auth.ts:47:         }
003307| NOTE: Implementation detail supporting search page behavior.
003308| src/auth.ts:48:       }
003309| NOTE: Implementation detail supporting search page behavior.
003310| src/auth.ts:49:       return session;
003311| NOTE: Return statement for component or helper output.
003312| src/auth.ts:50:     },
003313| NOTE: Implementation detail supporting search page behavior.
003314| src/auth.ts:51:     async jwt({ token, user, account, trigger }) {
003315| NOTE: Implementation detail supporting search page behavior.
003316| src/auth.ts:52:       // Only set initial values when user signs in
003317| NOTE: Line comment documents intent or constraints.
003318| src/auth.ts:53:       if (user) {
003319| NOTE: Conditional logic controlling rendering or flow.
003320| src/auth.ts:54:         token.sub = user.id;
003321| NOTE: Implementation detail supporting search page behavior.
003322| src/auth.ts:55:         token.emailVerified = user.emailVerified;
003323| NOTE: Implementation detail supporting search page behavior.
003324| src/auth.ts:56:         token.isAdmin = user.isAdmin;
003325| NOTE: Implementation detail supporting search page behavior.
003326| src/auth.ts:57:         token.isSuspended = user.isSuspended;
003327| NOTE: Implementation detail supporting search page behavior.
003328| src/auth.ts:58:         token.image = user.image;
003329| NOTE: Implementation detail supporting search page behavior.
003330| src/auth.ts:59:         token.name = user.name;
003331| NOTE: Implementation detail supporting search page behavior.
003332| src/auth.ts:60:       }
003333| NOTE: Implementation detail supporting search page behavior.
003334| src/auth.ts:61: 
003335| NOTE: Blank line for visual separation.
003336| src/auth.ts:62:       // Refresh from DB on sign-in, explicit update, or first OAuth link
003337| NOTE: Line comment documents intent or constraints.
003338| src/auth.ts:63:       // This ensures fresh user data after account switching
003339| NOTE: Line comment documents intent or constraints.
003340| src/auth.ts:64:       if (trigger === "signIn" || trigger === "update" || account) {
003341| NOTE: Conditional logic controlling rendering or flow.
003342| src/auth.ts:65:         try {
003343| NOTE: Implementation detail supporting search page behavior.
003344| src/auth.ts:66:           const dbUser = await prisma.user.findUnique({
003345| NOTE: Local declaration used by search logic or UI.
003346| src/auth.ts:67:             where: { id: token.sub as string },
003347| NOTE: Implementation detail supporting search page behavior.
003348| src/auth.ts:68:             select: {
003349| NOTE: Implementation detail supporting search page behavior.
003350| src/auth.ts:69:               emailVerified: true,
003351| NOTE: Implementation detail supporting search page behavior.
003352| src/auth.ts:70:               isAdmin: true,
003353| NOTE: Implementation detail supporting search page behavior.
003354| src/auth.ts:71:               isSuspended: true,
003355| NOTE: Implementation detail supporting search page behavior.
003356| src/auth.ts:72:               image: true,
003357| NOTE: Implementation detail supporting search page behavior.
003358| src/auth.ts:73:               name: true,
003359| NOTE: Implementation detail supporting search page behavior.
003360| src/auth.ts:74:             },
003361| NOTE: Implementation detail supporting search page behavior.
003362| src/auth.ts:75:           });
003363| NOTE: Implementation detail supporting search page behavior.
003364| src/auth.ts:76:           if (dbUser) {
003365| NOTE: Conditional logic controlling rendering or flow.
003366| src/auth.ts:77:             token.emailVerified = dbUser.emailVerified;
003367| NOTE: Implementation detail supporting search page behavior.
003368| src/auth.ts:78:             token.isAdmin = dbUser.isAdmin;
003369| NOTE: Implementation detail supporting search page behavior.
003370| src/auth.ts:79:             token.isSuspended = dbUser.isSuspended;
003371| NOTE: Implementation detail supporting search page behavior.
003372| src/auth.ts:80:             token.image = dbUser.image;
003373| NOTE: Implementation detail supporting search page behavior.
003374| src/auth.ts:81:             token.name = dbUser.name;
003375| NOTE: Implementation detail supporting search page behavior.
003376| src/auth.ts:82:           }
003377| NOTE: Implementation detail supporting search page behavior.
003378| src/auth.ts:83:         } catch (error) {
003379| NOTE: Implementation detail supporting search page behavior.
003380| src/auth.ts:84:           logger.sync.error("JWT callback DB error", {
003381| NOTE: Implementation detail supporting search page behavior.
003382| src/auth.ts:85:             error: error instanceof Error ? error.message : String(error),
003383| NOTE: Implementation detail supporting search page behavior.
003384| src/auth.ts:86:           });
003385| NOTE: Implementation detail supporting search page behavior.
003386| src/auth.ts:87:           // Don't invalidate session on DB errors - keep existing token values
003387| NOTE: Line comment documents intent or constraints.
003388| src/auth.ts:88:         }
003389| NOTE: Implementation detail supporting search page behavior.
003390| src/auth.ts:89:       }
003391| NOTE: Implementation detail supporting search page behavior.
003392| src/auth.ts:90:       return token;
003393| NOTE: Return statement for component or helper output.
003394| src/auth.ts:91:     },
003395| NOTE: Implementation detail supporting search page behavior.
003396| src/auth.ts:92:     async signIn({ user, account, profile }) {
003397| NOTE: Implementation detail supporting search page behavior.
003398| src/auth.ts:93:       // Check Google email verification
003399| NOTE: Line comment documents intent or constraints.
003400| src/auth.ts:94:       if (account?.provider === "google") {
003401| NOTE: Conditional logic controlling rendering or flow.
003402| src/auth.ts:95:         const googleProfile = profile as { email_verified?: boolean };
003403| NOTE: Local declaration used by search logic or UI.
003404| src/auth.ts:96:         if (!googleProfile?.email_verified) {
003405| NOTE: Conditional logic controlling rendering or flow.
003406| src/auth.ts:97:           return "/login?error=EmailNotVerified";
003407| NOTE: Return statement for component or helper output.
003408| src/auth.ts:98:         }
003409| NOTE: Implementation detail supporting search page behavior.
003410| src/auth.ts:99:       }
003411| NOTE: Implementation detail supporting search page behavior.
003412| src/auth.ts:100: 
003413| NOTE: Blank line for visual separation.
003414| src/auth.ts:101:       // Check suspension status for ALL providers (credentials and OAuth)
003415| NOTE: Line comment documents intent or constraints.
003416| src/auth.ts:102:       // Always check database to ensure we have the latest suspension status
003417| NOTE: Line comment documents intent or constraints.
003418| src/auth.ts:103:       if (user?.email) {
003419| NOTE: Conditional logic controlling rendering or flow.
003420| src/auth.ts:104:         const dbUser = await prisma.user.findUnique({
003421| NOTE: Local declaration used by search logic or UI.
003422| src/auth.ts:105:           where: { email: user.email },
003423| NOTE: Implementation detail supporting search page behavior.
003424| src/auth.ts:106:           select: { isSuspended: true },
003425| NOTE: Implementation detail supporting search page behavior.
003426| src/auth.ts:107:         });
003427| NOTE: Implementation detail supporting search page behavior.
003428| src/auth.ts:108: 
003429| NOTE: Blank line for visual separation.
003430| src/auth.ts:109:         if (dbUser?.isSuspended) {
003431| NOTE: Conditional logic controlling rendering or flow.
003432| src/auth.ts:110:           return "/login?error=AccountSuspended";
003433| NOTE: Return statement for component or helper output.
003434| src/auth.ts:111:         }
003435| NOTE: Implementation detail supporting search page behavior.
003436| src/auth.ts:112:       }
003437| NOTE: Implementation detail supporting search page behavior.
003438| src/auth.ts:113: 
003439| NOTE: Blank line for visual separation.
003440| src/auth.ts:114:       return true;
003441| NOTE: Return statement for component or helper output.
003442| src/auth.ts:115:     },
003443| NOTE: Implementation detail supporting search page behavior.
003444| src/auth.ts:116:     authorized({ auth, request: { nextUrl } }) {
003445| NOTE: Implementation detail supporting search page behavior.
003446| src/auth.ts:117:       const isLoggedIn = !!auth?.user;
003447| NOTE: Local declaration used by search logic or UI.
003448| src/auth.ts:118:       const isOnDashboard = nextUrl.pathname.startsWith("/dashboard");
003449| NOTE: Local declaration used by search logic or UI.
003450| src/auth.ts:119:       const isOnAuth =
003451| NOTE: Local declaration used by search logic or UI.
003452| src/auth.ts:120:         nextUrl.pathname.startsWith("/login") ||
003453| NOTE: Implementation detail supporting search page behavior.
003454| src/auth.ts:121:         nextUrl.pathname.startsWith("/signup");
003455| NOTE: Implementation detail supporting search page behavior.
003456| src/auth.ts:122: 
003457| NOTE: Blank line for visual separation.
003458| src/auth.ts:123:       if (isOnDashboard) {
003459| NOTE: Conditional logic controlling rendering or flow.
003460| src/auth.ts:124:         if (isLoggedIn) return true;
003461| NOTE: Conditional logic controlling rendering or flow.
003462| src/auth.ts:125:         return false; // Redirect unauthenticated users to login page
003463| NOTE: Return statement for component or helper output.
003464| src/auth.ts:126:       } else if (isLoggedIn && isOnAuth) {
003465| NOTE: Implementation detail supporting search page behavior.
003466| src/auth.ts:127:         return Response.redirect(new URL("/", nextUrl));
003467| NOTE: Return statement for component or helper output.
003468| src/auth.ts:128:       }
003469| NOTE: Implementation detail supporting search page behavior.
003470| src/auth.ts:129: 
003471| NOTE: Blank line for visual separation.
003472| src/auth.ts:130:       return true;
003473| NOTE: Return statement for component or helper output.
003474| src/auth.ts:131:     },
003475| NOTE: Implementation detail supporting search page behavior.
003476| src/auth.ts:132:   },
003477| NOTE: Implementation detail supporting search page behavior.
003478| src/auth.ts:133:   providers: [
003479| NOTE: Implementation detail supporting search page behavior.
003480| src/auth.ts:134:     Google({
003481| NOTE: Implementation detail supporting search page behavior.
003482| src/auth.ts:135:       clientId: process.env.GOOGLE_CLIENT_ID!,
003483| NOTE: Implementation detail supporting search page behavior.
003484| src/auth.ts:136:       clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
003485| NOTE: Implementation detail supporting search page behavior.
003486| src/auth.ts:137:     }),
003487| NOTE: Implementation detail supporting search page behavior.
003488| src/auth.ts:138:     Credentials({
003489| NOTE: Implementation detail supporting search page behavior.
003490| src/auth.ts:139:       async authorize(credentials) {
003491| NOTE: Implementation detail supporting search page behavior.
003492| src/auth.ts:140:         const parsedCredentials = z
003493| NOTE: Local declaration used by search logic or UI.
003494| src/auth.ts:141:           .object({ email: z.string().email(), password: z.string().min(12) })
003495| NOTE: Implementation detail supporting search page behavior.
003496| src/auth.ts:142:           .safeParse(credentials);
003497| NOTE: Implementation detail supporting search page behavior.
003498| src/auth.ts:143: 
003499| NOTE: Blank line for visual separation.
003500| src/auth.ts:144:         if (parsedCredentials.success) {
003501| NOTE: Conditional logic controlling rendering or flow.
003502| src/auth.ts:145:           const { email, password } = parsedCredentials.data;
003503| NOTE: Local declaration used by search logic or UI.
003504| src/auth.ts:146:           const user = await getUser(email);
003505| NOTE: Local declaration used by search logic or UI.
003506| src/auth.ts:147:           if (!user) return null;
003507| NOTE: Conditional logic controlling rendering or flow.
003508| src/auth.ts:148:           if (!user.password) return null;
003509| NOTE: Conditional logic controlling rendering or flow.
003510| src/auth.ts:149: 
003511| NOTE: Blank line for visual separation.
003512| src/auth.ts:150:           const passwordsMatch = await bcrypt.compare(password, user.password);
003513| NOTE: Local declaration used by search logic or UI.
003514| src/auth.ts:151:           if (passwordsMatch) return user;
003515| NOTE: Conditional logic controlling rendering or flow.
003516| src/auth.ts:152:         }
003517| NOTE: Implementation detail supporting search page behavior.
003518| src/auth.ts:153: 
003519| NOTE: Blank line for visual separation.
003520| src/auth.ts:154:         logger.sync.warn("Invalid credentials attempt");
003521| NOTE: Implementation detail supporting search page behavior.
003522| src/auth.ts:155:         return null;
003523| NOTE: Return statement for component or helper output.
003524| src/auth.ts:156:       },
003525| NOTE: Implementation detail supporting search page behavior.
003526| src/auth.ts:157:     }),
003527| NOTE: Implementation detail supporting search page behavior.
003528| src/auth.ts:158:   ],
003529| NOTE: Implementation detail supporting search page behavior.
003530| src/auth.ts:159: });
003531| NOTE: Implementation detail supporting search page behavior.
003532| FILE END: src/auth.ts
003533| 
003534| FILE START: src/components/CollapsedMobileSearch.tsx
003535| FILE ROLE: Auto-discovered dependency in search page graph.
003536| src/components/CollapsedMobileSearch.tsx:1: "use client";
003537| NOTE: Implementation detail supporting search page behavior.
003538| src/components/CollapsedMobileSearch.tsx:2: 
003539| NOTE: Blank line for visual separation.
003540| src/components/CollapsedMobileSearch.tsx:3: /**
003541| NOTE: Block comment line describing behavior or context.
003542| src/components/CollapsedMobileSearch.tsx:4:  * CollapsedMobileSearch - Compact search bar shown when scrolled on mobile
003543| NOTE: Block comment line describing behavior or context.
003544| src/components/CollapsedMobileSearch.tsx:5:  *
003545| NOTE: Block comment line describing behavior or context.
003546| src/components/CollapsedMobileSearch.tsx:6:  * Shows a minimal summary of current search state:
003547| NOTE: Block comment line describing behavior or context.
003548| src/components/CollapsedMobileSearch.tsx:7:  * - Location name (or "Where to?")
003549| NOTE: Block comment line describing behavior or context.
003550| src/components/CollapsedMobileSearch.tsx:8:  * - Active filter count badge
003551| NOTE: Block comment line describing behavior or context.
003552| src/components/CollapsedMobileSearch.tsx:9:  *
003553| NOTE: Block comment line describing behavior or context.
003554| src/components/CollapsedMobileSearch.tsx:10:  * Tapping expands to show the full search form.
003555| NOTE: Block comment line describing behavior or context.
003556| src/components/CollapsedMobileSearch.tsx:11:  *
003557| NOTE: Block comment line describing behavior or context.
003558| src/components/CollapsedMobileSearch.tsx:12:  * Design inspired by Airbnb's collapsing mobile search bar.
003559| NOTE: Block comment line describing behavior or context.
003560| src/components/CollapsedMobileSearch.tsx:13:  */
003561| NOTE: Block comment line describing behavior or context.
003562| src/components/CollapsedMobileSearch.tsx:14: 
003563| NOTE: Blank line for visual separation.
003564| src/components/CollapsedMobileSearch.tsx:15: import { Search, SlidersHorizontal } from "lucide-react";
003565| NOTE: Imports dependency for this module.
003566| src/components/CollapsedMobileSearch.tsx:16: import { useSearchParams } from "next/navigation";
003567| NOTE: Imports dependency for this module.
003568| src/components/CollapsedMobileSearch.tsx:17: import { useMemo } from "react";
003569| NOTE: Imports dependency for this module.
003570| src/components/CollapsedMobileSearch.tsx:18: 
003571| NOTE: Blank line for visual separation.
003572| src/components/CollapsedMobileSearch.tsx:19: interface CollapsedMobileSearchProps {
003573| NOTE: Type declaration for search data contracts.
003574| src/components/CollapsedMobileSearch.tsx:20:   /** Callback when tapped to expand */
003575| NOTE: Block comment line describing behavior or context.
003576| src/components/CollapsedMobileSearch.tsx:21:   onExpand: () => void;
003577| NOTE: Implementation detail supporting search page behavior.
003578| src/components/CollapsedMobileSearch.tsx:22:   /** Optional: open filter drawer directly */
003579| NOTE: Block comment line describing behavior or context.
003580| src/components/CollapsedMobileSearch.tsx:23:   onOpenFilters?: () => void;
003581| NOTE: Implementation detail supporting search page behavior.
003582| src/components/CollapsedMobileSearch.tsx:24: }
003583| NOTE: Implementation detail supporting search page behavior.
003584| src/components/CollapsedMobileSearch.tsx:25: 
003585| NOTE: Blank line for visual separation.
003586| src/components/CollapsedMobileSearch.tsx:26: export default function CollapsedMobileSearch({
003587| NOTE: Exports main component for this module.
003588| src/components/CollapsedMobileSearch.tsx:27:   onExpand,
003589| NOTE: Implementation detail supporting search page behavior.
003590| src/components/CollapsedMobileSearch.tsx:28:   onOpenFilters,
003591| NOTE: Implementation detail supporting search page behavior.
003592| src/components/CollapsedMobileSearch.tsx:29: }: CollapsedMobileSearchProps) {
003593| NOTE: Implementation detail supporting search page behavior.
003594| src/components/CollapsedMobileSearch.tsx:30:   const searchParams = useSearchParams();
003595| NOTE: Local declaration used by search logic or UI.
003596| src/components/CollapsedMobileSearch.tsx:31: 
003597| NOTE: Blank line for visual separation.
003598| src/components/CollapsedMobileSearch.tsx:32:   // Get current search state from URL
003599| NOTE: Line comment documents intent or constraints.
003600| src/components/CollapsedMobileSearch.tsx:33:   const location = searchParams.get("q") || "";
003601| NOTE: Local declaration used by search logic or UI.
003602| src/components/CollapsedMobileSearch.tsx:34:   const minPrice = searchParams.get("minPrice");
003603| NOTE: Local declaration used by search logic or UI.
003604| src/components/CollapsedMobileSearch.tsx:35:   const maxPrice = searchParams.get("maxPrice");
003605| NOTE: Local declaration used by search logic or UI.
003606| src/components/CollapsedMobileSearch.tsx:36: 
003607| NOTE: Blank line for visual separation.
003608| src/components/CollapsedMobileSearch.tsx:37:   // Count active filters (excluding location and price which are shown separately)
003609| NOTE: Line comment documents intent or constraints.
003610| src/components/CollapsedMobileSearch.tsx:38:   const activeFilterCount = useMemo(() => {
003611| NOTE: Memoizes derived values to reduce re-render work.
003612| src/components/CollapsedMobileSearch.tsx:39:     let count = 0;
003613| NOTE: Local declaration used by search logic or UI.
003614| src/components/CollapsedMobileSearch.tsx:40:     if (searchParams.get("moveInDate")) count++;
003615| NOTE: Conditional logic controlling rendering or flow.
003616| src/components/CollapsedMobileSearch.tsx:41:     if (
003617| NOTE: Conditional logic controlling rendering or flow.
003618| src/components/CollapsedMobileSearch.tsx:42:       searchParams.get("leaseDuration") &&
003619| NOTE: Implementation detail supporting search page behavior.
003620| src/components/CollapsedMobileSearch.tsx:43:       searchParams.get("leaseDuration") !== "any"
003621| NOTE: Implementation detail supporting search page behavior.
003622| src/components/CollapsedMobileSearch.tsx:44:     )
003623| NOTE: Implementation detail supporting search page behavior.
003624| src/components/CollapsedMobileSearch.tsx:45:       count++;
003625| NOTE: Implementation detail supporting search page behavior.
003626| src/components/CollapsedMobileSearch.tsx:46:     if (searchParams.get("roomType") && searchParams.get("roomType") !== "any")
003627| NOTE: Conditional logic controlling rendering or flow.
003628| src/components/CollapsedMobileSearch.tsx:47:       count++;
003629| NOTE: Implementation detail supporting search page behavior.
003630| src/components/CollapsedMobileSearch.tsx:48:     // Count amenities
003631| NOTE: Line comment documents intent or constraints.
003632| src/components/CollapsedMobileSearch.tsx:49:     searchParams.getAll("amenities").forEach(() => count++);
003633| NOTE: Implementation detail supporting search page behavior.
003634| src/components/CollapsedMobileSearch.tsx:50:     // Count house rules
003635| NOTE: Line comment documents intent or constraints.
003636| src/components/CollapsedMobileSearch.tsx:51:     searchParams.getAll("houseRules").forEach(() => count++);
003637| NOTE: Implementation detail supporting search page behavior.
003638| src/components/CollapsedMobileSearch.tsx:52:     // Count languages
003639| NOTE: Line comment documents intent or constraints.
003640| src/components/CollapsedMobileSearch.tsx:53:     searchParams.getAll("languages").forEach(() => count++);
003641| NOTE: Implementation detail supporting search page behavior.
003642| src/components/CollapsedMobileSearch.tsx:54:     return count;
003643| NOTE: Return statement for component or helper output.
003644| src/components/CollapsedMobileSearch.tsx:55:   }, [searchParams]);
003645| NOTE: Implementation detail supporting search page behavior.
003646| src/components/CollapsedMobileSearch.tsx:56: 
003647| NOTE: Blank line for visual separation.
003648| src/components/CollapsedMobileSearch.tsx:57:   // Format price range display
003649| NOTE: Line comment documents intent or constraints.
003650| src/components/CollapsedMobileSearch.tsx:58:   const priceDisplay = useMemo(() => {
003651| NOTE: Memoizes derived values to reduce re-render work.
003652| src/components/CollapsedMobileSearch.tsx:59:     if (minPrice && maxPrice) {
003653| NOTE: Conditional logic controlling rendering or flow.
003654| src/components/CollapsedMobileSearch.tsx:60:       return `$${minPrice}-$${maxPrice}`;
003655| NOTE: Return statement for component or helper output.
003656| src/components/CollapsedMobileSearch.tsx:61:     }
003657| NOTE: Implementation detail supporting search page behavior.
003658| src/components/CollapsedMobileSearch.tsx:62:     if (minPrice) {
003659| NOTE: Conditional logic controlling rendering or flow.
003660| src/components/CollapsedMobileSearch.tsx:63:       return `$${minPrice}+`;
003661| NOTE: Return statement for component or helper output.
003662| src/components/CollapsedMobileSearch.tsx:64:     }
003663| NOTE: Implementation detail supporting search page behavior.
003664| src/components/CollapsedMobileSearch.tsx:65:     if (maxPrice) {
003665| NOTE: Conditional logic controlling rendering or flow.
003666| src/components/CollapsedMobileSearch.tsx:66:       return `Up to $${maxPrice}`;
003667| NOTE: Return statement for component or helper output.
003668| src/components/CollapsedMobileSearch.tsx:67:     }
003669| NOTE: Implementation detail supporting search page behavior.
003670| src/components/CollapsedMobileSearch.tsx:68:     return null;
003671| NOTE: Return statement for component or helper output.
003672| src/components/CollapsedMobileSearch.tsx:69:   }, [minPrice, maxPrice]);
003673| NOTE: Implementation detail supporting search page behavior.
003674| src/components/CollapsedMobileSearch.tsx:70: 
003675| NOTE: Blank line for visual separation.
003676| src/components/CollapsedMobileSearch.tsx:71:   // Build display text
003677| NOTE: Line comment documents intent or constraints.
003678| src/components/CollapsedMobileSearch.tsx:72:   const displayText = location || "Where to?";
003679| NOTE: Local declaration used by search logic or UI.
003680| src/components/CollapsedMobileSearch.tsx:73: 
003681| NOTE: Blank line for visual separation.
003682| src/components/CollapsedMobileSearch.tsx:74:   return (
003683| NOTE: Return statement for component or helper output.
003684| src/components/CollapsedMobileSearch.tsx:75:     <div className="md:hidden flex items-center gap-2 w-full max-w-md mx-auto px-3">
003685| NOTE: Tailwind classes define layout and styling.
003686| src/components/CollapsedMobileSearch.tsx:76:       {/* Main search area - tap to expand */}
003687| NOTE: Implementation detail supporting search page behavior.
003688| src/components/CollapsedMobileSearch.tsx:77:       <button
003689| NOTE: JSX markup for search UI.
003690| src/components/CollapsedMobileSearch.tsx:78:         onClick={onExpand}
003691| NOTE: Implementation detail supporting search page behavior.
003692| src/components/CollapsedMobileSearch.tsx:79:         className="flex-1 flex items-center gap-3 h-12 px-4 bg-white dark:bg-zinc-900 rounded-full shadow-sm border border-zinc-200 dark:border-zinc-700 hover:shadow-md transition-shadow"
003693| NOTE: Tailwind classes define layout and styling.
003694| src/components/CollapsedMobileSearch.tsx:80:         aria-label="Expand search"
003695| NOTE: Accessibility attribute for screen readers.
003696| src/components/CollapsedMobileSearch.tsx:81:       >
003697| NOTE: Implementation detail supporting search page behavior.
003698| src/components/CollapsedMobileSearch.tsx:82:         <Search className="w-5 h-5 text-zinc-400 flex-shrink-0" />
003699| NOTE: Tailwind classes define layout and styling.
003700| src/components/CollapsedMobileSearch.tsx:83:         <div className="flex-1 min-w-0 text-left">
003701| NOTE: Tailwind classes define layout and styling.
003702| src/components/CollapsedMobileSearch.tsx:84:           <div
003703| NOTE: JSX markup for search UI.
003704| src/components/CollapsedMobileSearch.tsx:85:             className={`text-sm font-medium truncate ${
003705| NOTE: Tailwind classes define layout and styling.
003706| src/components/CollapsedMobileSearch.tsx:86:               location
003707| NOTE: Implementation detail supporting search page behavior.
003708| src/components/CollapsedMobileSearch.tsx:87:                 ? "text-zinc-900 dark:text-white"
003709| NOTE: Implementation detail supporting search page behavior.
003710| src/components/CollapsedMobileSearch.tsx:88:                 : "text-zinc-400 dark:text-zinc-500"
003711| NOTE: Implementation detail supporting search page behavior.
003712| src/components/CollapsedMobileSearch.tsx:89:             }`}
003713| NOTE: Implementation detail supporting search page behavior.
003714| src/components/CollapsedMobileSearch.tsx:90:           >
003715| NOTE: Implementation detail supporting search page behavior.
003716| src/components/CollapsedMobileSearch.tsx:91:             {displayText}
003717| NOTE: Implementation detail supporting search page behavior.
003718| src/components/CollapsedMobileSearch.tsx:92:           </div>
003719| NOTE: JSX markup for search UI.
003720| src/components/CollapsedMobileSearch.tsx:93:           {priceDisplay && (
003721| NOTE: Implementation detail supporting search page behavior.
003722| src/components/CollapsedMobileSearch.tsx:94:             <div className="text-xs text-zinc-500 dark:text-zinc-400 truncate">
003723| NOTE: Tailwind classes define layout and styling.
003724| src/components/CollapsedMobileSearch.tsx:95:               {priceDisplay}
003725| NOTE: Implementation detail supporting search page behavior.
003726| src/components/CollapsedMobileSearch.tsx:96:             </div>
003727| NOTE: JSX markup for search UI.
003728| src/components/CollapsedMobileSearch.tsx:97:           )}
003729| NOTE: Implementation detail supporting search page behavior.
003730| src/components/CollapsedMobileSearch.tsx:98:         </div>
003731| NOTE: JSX markup for search UI.
003732| src/components/CollapsedMobileSearch.tsx:99:       </button>
003733| NOTE: JSX markup for search UI.
003734| src/components/CollapsedMobileSearch.tsx:100: 
003735| NOTE: Blank line for visual separation.
003736| src/components/CollapsedMobileSearch.tsx:101:       {/* Filters button - direct access */}
003737| NOTE: Implementation detail supporting search page behavior.
003738| src/components/CollapsedMobileSearch.tsx:102:       {onOpenFilters && (
003739| NOTE: Implementation detail supporting search page behavior.
003740| src/components/CollapsedMobileSearch.tsx:103:         <button
003741| NOTE: JSX markup for search UI.
003742| src/components/CollapsedMobileSearch.tsx:104:           onClick={onOpenFilters}
003743| NOTE: Implementation detail supporting search page behavior.
003744| src/components/CollapsedMobileSearch.tsx:105:           className="relative flex items-center justify-center w-12 h-12 bg-white dark:bg-zinc-900 rounded-full shadow-sm border border-zinc-200 dark:border-zinc-700 hover:shadow-md transition-shadow"
003745| NOTE: Tailwind classes define layout and styling.
003746| src/components/CollapsedMobileSearch.tsx:106:           aria-label={`Filters${activeFilterCount > 0 ? ` (${activeFilterCount} active)` : ""}`}
003747| NOTE: Accessibility attribute for screen readers.
003748| src/components/CollapsedMobileSearch.tsx:107:         >
003749| NOTE: Implementation detail supporting search page behavior.
003750| src/components/CollapsedMobileSearch.tsx:108:           <SlidersHorizontal className="w-5 h-5 text-zinc-600 dark:text-zinc-400" />
003751| NOTE: Tailwind classes define layout and styling.
003752| src/components/CollapsedMobileSearch.tsx:109:           {activeFilterCount > 0 && (
003753| NOTE: Implementation detail supporting search page behavior.
003754| src/components/CollapsedMobileSearch.tsx:110:             <span className="absolute -top-1 -right-1 flex items-center justify-center min-w-[18px] h-[18px] px-1 text-[10px] font-bold rounded-full bg-zinc-900 dark:bg-white text-white dark:text-zinc-900">
003755| NOTE: Tailwind classes define layout and styling.
003756| src/components/CollapsedMobileSearch.tsx:111:               {activeFilterCount}
003757| NOTE: Implementation detail supporting search page behavior.
003758| src/components/CollapsedMobileSearch.tsx:112:             </span>
003759| NOTE: JSX markup for search UI.
003760| src/components/CollapsedMobileSearch.tsx:113:           )}
003761| NOTE: Implementation detail supporting search page behavior.
003762| src/components/CollapsedMobileSearch.tsx:114:         </button>
003763| NOTE: JSX markup for search UI.
003764| src/components/CollapsedMobileSearch.tsx:115:       )}
003765| NOTE: Implementation detail supporting search page behavior.
003766| src/components/CollapsedMobileSearch.tsx:116:     </div>
003767| NOTE: JSX markup for search UI.
003768| src/components/CollapsedMobileSearch.tsx:117:   );
003769| NOTE: Implementation detail supporting search page behavior.
003770| src/components/CollapsedMobileSearch.tsx:118: }
003771| NOTE: Implementation detail supporting search page behavior.
003772| FILE END: src/components/CollapsedMobileSearch.tsx
003773| 
003774| FILE START: src/components/DynamicMap.tsx
003775| FILE ROLE: Auto-discovered dependency in search page graph.
003776| src/components/DynamicMap.tsx:1: "use client";
003777| NOTE: Implementation detail supporting search page behavior.
003778| src/components/DynamicMap.tsx:2: 
003779| NOTE: Blank line for visual separation.
003780| src/components/DynamicMap.tsx:3: import dynamic from "next/dynamic";
003781| NOTE: Imports dependency for this module.
003782| src/components/DynamicMap.tsx:4: import type { V2MapData } from "@/contexts/SearchV2DataContext";
003783| NOTE: Imports dependency for this module.
003784| src/components/DynamicMap.tsx:5: import type { MapListingData } from "@/lib/data";
003785| NOTE: Imports dependency for this module.
003786| src/components/DynamicMap.tsx:6: 
003787| NOTE: Blank line for visual separation.
003788| src/components/DynamicMap.tsx:7: // Dynamic import for Map component - defers 944KB mapbox-gl bundle until needed
003789| NOTE: Line comment documents intent or constraints.
003790| src/components/DynamicMap.tsx:8: const MapComponent = dynamic(() => import("@/components/Map"), {
003791| NOTE: Local declaration used by search logic or UI.
003792| src/components/DynamicMap.tsx:9:   ssr: false,
003793| NOTE: Implementation detail supporting search page behavior.
003794| src/components/DynamicMap.tsx:10:   loading: () => (
003795| NOTE: Implementation detail supporting search page behavior.
003796| src/components/DynamicMap.tsx:11:     <div className="w-full h-full bg-zinc-100 dark:bg-zinc-800 animate-pulse flex items-center justify-center">
003797| NOTE: Tailwind classes define layout and styling.
003798| src/components/DynamicMap.tsx:12:       <div className="text-zinc-400 dark:text-zinc-500 text-sm">
003799| NOTE: Tailwind classes define layout and styling.
003800| src/components/DynamicMap.tsx:13:         Loading map...
003801| NOTE: Implementation detail supporting search page behavior.
003802| src/components/DynamicMap.tsx:14:       </div>
003803| NOTE: JSX markup for search UI.
003804| src/components/DynamicMap.tsx:15:     </div>
003805| NOTE: JSX markup for search UI.
003806| src/components/DynamicMap.tsx:16:   ),
003807| NOTE: Implementation detail supporting search page behavior.
003808| src/components/DynamicMap.tsx:17: });
003809| NOTE: Implementation detail supporting search page behavior.
003810| src/components/DynamicMap.tsx:18: 
003811| NOTE: Blank line for visual separation.
003812| src/components/DynamicMap.tsx:19: interface DynamicMapProps {
003813| NOTE: Type declaration for search data contracts.
003814| src/components/DynamicMap.tsx:20:   /** Listings for v1 path (client-fetched from /api/map-listings) */
003815| NOTE: Block comment line describing behavior or context.
003816| src/components/DynamicMap.tsx:21:   listings?: MapListingData[];
003817| NOTE: Implementation detail supporting search page behavior.
003818| src/components/DynamicMap.tsx:22:   /** V2 map data from unified search response (server-provided via context) */
003819| NOTE: Block comment line describing behavior or context.
003820| src/components/DynamicMap.tsx:23:   v2MapData?: V2MapData | null;
003821| NOTE: Implementation detail supporting search page behavior.
003822| src/components/DynamicMap.tsx:24: }
003823| NOTE: Implementation detail supporting search page behavior.
003824| src/components/DynamicMap.tsx:25: 
003825| NOTE: Blank line for visual separation.
003826| src/components/DynamicMap.tsx:26: export default function DynamicMap({ listings, v2MapData }: DynamicMapProps) {
003827| NOTE: Exports main component for this module.
003828| src/components/DynamicMap.tsx:27:   return <MapComponent listings={listings} v2MapData={v2MapData} />;
003829| NOTE: Return statement for component or helper output.
003830| src/components/DynamicMap.tsx:28: }
003831| NOTE: Implementation detail supporting search page behavior.
003832| FILE END: src/components/DynamicMap.tsx
003833| 
003834| FILE START: src/components/FavoriteButton.tsx
003835| FILE ROLE: Auto-discovered dependency in search page graph.
003836| src/components/FavoriteButton.tsx:1: "use client";
003837| NOTE: Implementation detail supporting search page behavior.
003838| src/components/FavoriteButton.tsx:2: 
003839| NOTE: Blank line for visual separation.
003840| src/components/FavoriteButton.tsx:3: import { useState } from "react";
003841| NOTE: Imports dependency for this module.
003842| src/components/FavoriteButton.tsx:4: import { Heart } from "lucide-react";
003843| NOTE: Imports dependency for this module.
003844| src/components/FavoriteButton.tsx:5: import { useRouter } from "next/navigation";
003845| NOTE: Imports dependency for this module.
003846| src/components/FavoriteButton.tsx:6: import { toast } from "sonner";
003847| NOTE: Imports dependency for this module.
003848| src/components/FavoriteButton.tsx:7: import { cn } from "@/lib/utils";
003849| NOTE: Imports dependency for this module.
003850| src/components/FavoriteButton.tsx:8: 
003851| NOTE: Blank line for visual separation.
003852| src/components/FavoriteButton.tsx:9: interface FavoriteButtonProps {
003853| NOTE: Type declaration for search data contracts.
003854| src/components/FavoriteButton.tsx:10:   listingId: string;
003855| NOTE: Implementation detail supporting search page behavior.
003856| src/components/FavoriteButton.tsx:11:   initialIsSaved?: boolean;
003857| NOTE: Implementation detail supporting search page behavior.
003858| src/components/FavoriteButton.tsx:12:   className?: string;
003859| NOTE: Implementation detail supporting search page behavior.
003860| src/components/FavoriteButton.tsx:13: }
003861| NOTE: Implementation detail supporting search page behavior.
003862| src/components/FavoriteButton.tsx:14: 
003863| NOTE: Blank line for visual separation.
003864| src/components/FavoriteButton.tsx:15: export default function FavoriteButton({
003865| NOTE: Exports main component for this module.
003866| src/components/FavoriteButton.tsx:16:   listingId,
003867| NOTE: Implementation detail supporting search page behavior.
003868| src/components/FavoriteButton.tsx:17:   initialIsSaved = false,
003869| NOTE: Implementation detail supporting search page behavior.
003870| src/components/FavoriteButton.tsx:18:   className,
003871| NOTE: Implementation detail supporting search page behavior.
003872| src/components/FavoriteButton.tsx:19: }: FavoriteButtonProps) {
003873| NOTE: Implementation detail supporting search page behavior.
003874| src/components/FavoriteButton.tsx:20:   const [isSaved, setIsSaved] = useState(initialIsSaved);
003875| NOTE: Initializes local state for search UI behavior.
003876| src/components/FavoriteButton.tsx:21:   const [isLoading, setIsLoading] = useState(false);
003877| NOTE: Initializes local state for search UI behavior.
003878| src/components/FavoriteButton.tsx:22:   const router = useRouter();
003879| NOTE: Local declaration used by search logic or UI.
003880| src/components/FavoriteButton.tsx:23: 
003881| NOTE: Blank line for visual separation.
003882| src/components/FavoriteButton.tsx:24:   const toggleFavorite = async (e: React.MouseEvent) => {
003883| NOTE: Local declaration used by search logic or UI.
003884| src/components/FavoriteButton.tsx:25:     e.preventDefault();
003885| NOTE: Implementation detail supporting search page behavior.
003886| src/components/FavoriteButton.tsx:26:     e.stopPropagation();
003887| NOTE: Implementation detail supporting search page behavior.
003888| src/components/FavoriteButton.tsx:27: 
003889| NOTE: Blank line for visual separation.
003890| src/components/FavoriteButton.tsx:28:     if (isLoading) return;
003891| NOTE: Conditional logic controlling rendering or flow.
003892| src/components/FavoriteButton.tsx:29: 
003893| NOTE: Blank line for visual separation.
003894| src/components/FavoriteButton.tsx:30:     setIsLoading(true);
003895| NOTE: Implementation detail supporting search page behavior.
003896| src/components/FavoriteButton.tsx:31:     // Optimistic update
003897| NOTE: Line comment documents intent or constraints.
003898| src/components/FavoriteButton.tsx:32:     const previousState = isSaved;
003899| NOTE: Local declaration used by search logic or UI.
003900| src/components/FavoriteButton.tsx:33:     setIsSaved(!isSaved);
003901| NOTE: Implementation detail supporting search page behavior.
003902| src/components/FavoriteButton.tsx:34: 
003903| NOTE: Blank line for visual separation.
003904| src/components/FavoriteButton.tsx:35:     try {
003905| NOTE: Implementation detail supporting search page behavior.
003906| src/components/FavoriteButton.tsx:36:       const response = await fetch("/api/favorites", {
003907| NOTE: Local declaration used by search logic or UI.
003908| src/components/FavoriteButton.tsx:37:         method: "POST",
003909| NOTE: Implementation detail supporting search page behavior.
003910| src/components/FavoriteButton.tsx:38:         headers: {
003911| NOTE: Implementation detail supporting search page behavior.
003912| src/components/FavoriteButton.tsx:39:           "Content-Type": "application/json",
003913| NOTE: Implementation detail supporting search page behavior.
003914| src/components/FavoriteButton.tsx:40:         },
003915| NOTE: Implementation detail supporting search page behavior.
003916| src/components/FavoriteButton.tsx:41:         body: JSON.stringify({ listingId }),
003917| NOTE: Implementation detail supporting search page behavior.
003918| src/components/FavoriteButton.tsx:42:       });
003919| NOTE: Implementation detail supporting search page behavior.
003920| src/components/FavoriteButton.tsx:43: 
003921| NOTE: Blank line for visual separation.
003922| src/components/FavoriteButton.tsx:44:       if (response.status === 401) {
003923| NOTE: Conditional logic controlling rendering or flow.
003924| src/components/FavoriteButton.tsx:45:         // Redirect to login if unauthorized
003925| NOTE: Line comment documents intent or constraints.
003926| src/components/FavoriteButton.tsx:46:         toast.info("Sign in to save listings");
003927| NOTE: Implementation detail supporting search page behavior.
003928| src/components/FavoriteButton.tsx:47:         router.push("/login");
003929| NOTE: Routing logic updates search URL state.
003930| src/components/FavoriteButton.tsx:48:         setIsSaved(previousState); // Revert
003931| NOTE: Implementation detail supporting search page behavior.
003932| src/components/FavoriteButton.tsx:49:         return;
003933| NOTE: Implementation detail supporting search page behavior.
003934| src/components/FavoriteButton.tsx:50:       }
003935| NOTE: Implementation detail supporting search page behavior.
003936| src/components/FavoriteButton.tsx:51: 
003937| NOTE: Blank line for visual separation.
003938| src/components/FavoriteButton.tsx:52:       if (!response.ok) {
003939| NOTE: Conditional logic controlling rendering or flow.
003940| src/components/FavoriteButton.tsx:53:         throw new Error("Failed to toggle favorite");
003941| NOTE: Implementation detail supporting search page behavior.
003942| src/components/FavoriteButton.tsx:54:       }
003943| NOTE: Implementation detail supporting search page behavior.
003944| src/components/FavoriteButton.tsx:55: 
003945| NOTE: Blank line for visual separation.
003946| src/components/FavoriteButton.tsx:56:       const data = await response.json();
003947| NOTE: Local declaration used by search logic or UI.
003948| src/components/FavoriteButton.tsx:57:       setIsSaved(data.saved);
003949| NOTE: Implementation detail supporting search page behavior.
003950| src/components/FavoriteButton.tsx:58:       router.refresh(); // Refresh server components to update lists if needed
003951| NOTE: Routing logic updates search URL state.
003952| src/components/FavoriteButton.tsx:59:     } catch (error) {
003953| NOTE: Implementation detail supporting search page behavior.
003954| src/components/FavoriteButton.tsx:60:       console.error("Error toggling favorite:", error);
003955| NOTE: Implementation detail supporting search page behavior.
003956| src/components/FavoriteButton.tsx:61:       toast.error("Couldn't save listing. Please try again.");
003957| NOTE: Implementation detail supporting search page behavior.
003958| src/components/FavoriteButton.tsx:62:       setIsSaved(previousState); // Revert on error
003959| NOTE: Implementation detail supporting search page behavior.
003960| src/components/FavoriteButton.tsx:63:     } finally {
003961| NOTE: Implementation detail supporting search page behavior.
003962| src/components/FavoriteButton.tsx:64:       setIsLoading(false);
003963| NOTE: Implementation detail supporting search page behavior.
003964| src/components/FavoriteButton.tsx:65:     }
003965| NOTE: Implementation detail supporting search page behavior.
003966| src/components/FavoriteButton.tsx:66:   };
003967| NOTE: Implementation detail supporting search page behavior.
003968| src/components/FavoriteButton.tsx:67: 
003969| NOTE: Blank line for visual separation.
003970| src/components/FavoriteButton.tsx:68:   return (
003971| NOTE: Return statement for component or helper output.
003972| src/components/FavoriteButton.tsx:69:     <button
003973| NOTE: JSX markup for search UI.
003974| src/components/FavoriteButton.tsx:70:       onClick={toggleFavorite}
003975| NOTE: Implementation detail supporting search page behavior.
003976| src/components/FavoriteButton.tsx:71:       disabled={isLoading}
003977| NOTE: Implementation detail supporting search page behavior.
003978| src/components/FavoriteButton.tsx:72:       className={cn(
003979| NOTE: Tailwind classes define layout and styling.
003980| src/components/FavoriteButton.tsx:73:         "p-2 rounded-full bg-white/90 backdrop-blur-sm hover:bg-white transition-colors shadow-sm group",
003981| NOTE: Implementation detail supporting search page behavior.
003982| src/components/FavoriteButton.tsx:74:         isSaved ? "text-red-500" : "text-zinc-400 hover:text-red-500",
003983| NOTE: Implementation detail supporting search page behavior.
003984| src/components/FavoriteButton.tsx:75:         className,
003985| NOTE: Implementation detail supporting search page behavior.
003986| src/components/FavoriteButton.tsx:76:       )}
003987| NOTE: Implementation detail supporting search page behavior.
003988| src/components/FavoriteButton.tsx:77:     >
003989| NOTE: Implementation detail supporting search page behavior.
003990| src/components/FavoriteButton.tsx:78:       <Heart
003991| NOTE: JSX markup for search UI.
003992| src/components/FavoriteButton.tsx:79:         className={cn(
003993| NOTE: Tailwind classes define layout and styling.
003994| src/components/FavoriteButton.tsx:80:           "w-4 h-4 transition-all duration-300",
003995| NOTE: Implementation detail supporting search page behavior.
003996| src/components/FavoriteButton.tsx:81:           isSaved ? "fill-current scale-110" : "scale-100",
003997| NOTE: Implementation detail supporting search page behavior.
003998| src/components/FavoriteButton.tsx:82:         )}
003999| NOTE: Implementation detail supporting search page behavior.
004000| src/components/FavoriteButton.tsx:83:       />
004001| NOTE: Implementation detail supporting search page behavior.
004002| src/components/FavoriteButton.tsx:84:     </button>
004003| NOTE: JSX markup for search UI.
004004| src/components/FavoriteButton.tsx:85:   );
004005| NOTE: Implementation detail supporting search page behavior.
004006| src/components/FavoriteButton.tsx:86: }
004007| NOTE: Implementation detail supporting search page behavior.
004008| FILE END: src/components/FavoriteButton.tsx
004009| 
004010| FILE START: src/components/LocationSearchInput.tsx
004011| FILE ROLE: Auto-discovered dependency in search page graph.
004012| src/components/LocationSearchInput.tsx:1: "use client";
004013| NOTE: Implementation detail supporting search page behavior.
004014| src/components/LocationSearchInput.tsx:2: 
004015| NOTE: Blank line for visual separation.
004016| src/components/LocationSearchInput.tsx:3: import {
004017| NOTE: Imports dependency for this module.
004018| src/components/LocationSearchInput.tsx:4:   useState,
004019| NOTE: Initializes local state for search UI behavior.
004020| src/components/LocationSearchInput.tsx:5:   useRef,
004021| NOTE: Uses ref for stable mutable storage between renders.
004022| src/components/LocationSearchInput.tsx:6:   useEffect,
004023| NOTE: Defines side effect for syncing with external state.
004024| src/components/LocationSearchInput.tsx:7:   useCallback,
004025| NOTE: Memoizes callback to preserve references across renders.
004026| src/components/LocationSearchInput.tsx:8:   forwardRef,
004027| NOTE: Implementation detail supporting search page behavior.
004028| src/components/LocationSearchInput.tsx:9:   useImperativeHandle,
004029| NOTE: Implementation detail supporting search page behavior.
004030| src/components/LocationSearchInput.tsx:10: } from "react";
004031| NOTE: Implementation detail supporting search page behavior.
004032| src/components/LocationSearchInput.tsx:11: import { MapPin, Loader2, X, AlertCircle, SearchX } from "lucide-react";
004033| NOTE: Imports dependency for this module.
004034| src/components/LocationSearchInput.tsx:12: import { useDebounce } from "use-debounce";
004035| NOTE: Imports dependency for this module.
004036| src/components/LocationSearchInput.tsx:13: import {
004037| NOTE: Imports dependency for this module.
004038| src/components/LocationSearchInput.tsx:14:   searchLocalLocations,
004039| NOTE: Implementation detail supporting search page behavior.
004040| src/components/LocationSearchInput.tsx:15:   looksLikeStreetAddress,
004041| NOTE: Implementation detail supporting search page behavior.
004042| src/components/LocationSearchInput.tsx:16:   type LocalSearchResult,
004043| NOTE: Type declaration for search data contracts.
004044| src/components/LocationSearchInput.tsx:17: } from "@/lib/locations/us-locations";
004045| NOTE: Implementation detail supporting search page behavior.
004046| src/components/LocationSearchInput.tsx:18: 
004047| NOTE: Blank line for visual separation.
004048| src/components/LocationSearchInput.tsx:19: interface LocationSuggestion {
004049| NOTE: Type declaration for search data contracts.
004050| src/components/LocationSearchInput.tsx:20:   id: string;
004051| NOTE: Implementation detail supporting search page behavior.
004052| src/components/LocationSearchInput.tsx:21:   place_name: string;
004053| NOTE: Implementation detail supporting search page behavior.
004054| src/components/LocationSearchInput.tsx:22:   center: [number, number]; // [lng, lat]
004055| NOTE: Implementation detail supporting search page behavior.
004056| src/components/LocationSearchInput.tsx:23:   place_type: string[];
004057| NOTE: Implementation detail supporting search page behavior.
004058| src/components/LocationSearchInput.tsx:24:   bbox?: [number, number, number, number];
004059| NOTE: Implementation detail supporting search page behavior.
004060| src/components/LocationSearchInput.tsx:25:   source: "local" | "mapbox";
004061| NOTE: Implementation detail supporting search page behavior.
004062| src/components/LocationSearchInput.tsx:26: }
004063| NOTE: Implementation detail supporting search page behavior.
004064| src/components/LocationSearchInput.tsx:27: 
004065| NOTE: Blank line for visual separation.
004066| src/components/LocationSearchInput.tsx:28: /**
004067| NOTE: Block comment line describing behavior or context.
004068| src/components/LocationSearchInput.tsx:29:  * Convert local search result to LocationSuggestion format
004069| NOTE: Block comment line describing behavior or context.
004070| src/components/LocationSearchInput.tsx:30:  */
004071| NOTE: Block comment line describing behavior or context.
004072| src/components/LocationSearchInput.tsx:31: function localToSuggestion(result: LocalSearchResult): LocationSuggestion {
004073| NOTE: Defines a helper or component function.
004074| src/components/LocationSearchInput.tsx:32:   return {
004075| NOTE: Return statement for component or helper output.
004076| src/components/LocationSearchInput.tsx:33:     id: `local-${result.location.id}`,
004077| NOTE: Implementation detail supporting search page behavior.
004078| src/components/LocationSearchInput.tsx:34:     place_name: result.location.displayName,
004079| NOTE: Implementation detail supporting search page behavior.
004080| src/components/LocationSearchInput.tsx:35:     center: result.location.center,
004081| NOTE: Implementation detail supporting search page behavior.
004082| src/components/LocationSearchInput.tsx:36:     place_type: [result.location.type],
004083| NOTE: Implementation detail supporting search page behavior.
004084| src/components/LocationSearchInput.tsx:37:     bbox: result.location.bbox,
004085| NOTE: Implementation detail supporting search page behavior.
004086| src/components/LocationSearchInput.tsx:38:     source: "local",
004087| NOTE: Implementation detail supporting search page behavior.
004088| src/components/LocationSearchInput.tsx:39:   };
004089| NOTE: Implementation detail supporting search page behavior.
004090| src/components/LocationSearchInput.tsx:40: }
004091| NOTE: Implementation detail supporting search page behavior.
004092| src/components/LocationSearchInput.tsx:41: 
004093| NOTE: Blank line for visual separation.
004094| src/components/LocationSearchInput.tsx:42: /**
004095| NOTE: Block comment line describing behavior or context.
004096| src/components/LocationSearchInput.tsx:43:  * Dedupe suggestions by display name (case-insensitive)
004097| NOTE: Block comment line describing behavior or context.
004098| src/components/LocationSearchInput.tsx:44:  * Local results take priority over Mapbox results
004099| NOTE: Block comment line describing behavior or context.
004100| src/components/LocationSearchInput.tsx:45:  */
004101| NOTE: Block comment line describing behavior or context.
004102| src/components/LocationSearchInput.tsx:46: function dedupeSuggestions(
004103| NOTE: Defines a helper or component function.
004104| src/components/LocationSearchInput.tsx:47:   suggestions: LocationSuggestion[],
004105| NOTE: Implementation detail supporting search page behavior.
004106| src/components/LocationSearchInput.tsx:48: ): LocationSuggestion[] {
004107| NOTE: Implementation detail supporting search page behavior.
004108| src/components/LocationSearchInput.tsx:49:   const seen = new Map<string, LocationSuggestion>();
004109| NOTE: Local declaration used by search logic or UI.
004110| src/components/LocationSearchInput.tsx:50:   for (const s of suggestions) {
004111| NOTE: Implementation detail supporting search page behavior.
004112| src/components/LocationSearchInput.tsx:51:     const key = s.place_name.toLowerCase();
004113| NOTE: Local declaration used by search logic or UI.
004114| src/components/LocationSearchInput.tsx:52:     // Local results have priority - only add if not already seen
004115| NOTE: Line comment documents intent or constraints.
004116| src/components/LocationSearchInput.tsx:53:     if (!seen.has(key)) {
004117| NOTE: Conditional logic controlling rendering or flow.
004118| src/components/LocationSearchInput.tsx:54:       seen.set(key, s);
004119| NOTE: Implementation detail supporting search page behavior.
004120| src/components/LocationSearchInput.tsx:55:     }
004121| NOTE: Implementation detail supporting search page behavior.
004122| src/components/LocationSearchInput.tsx:56:   }
004123| NOTE: Implementation detail supporting search page behavior.
004124| src/components/LocationSearchInput.tsx:57:   return Array.from(seen.values());
004125| NOTE: Return statement for component or helper output.
004126| src/components/LocationSearchInput.tsx:58: }
004127| NOTE: Implementation detail supporting search page behavior.
004128| src/components/LocationSearchInput.tsx:59: 
004129| NOTE: Blank line for visual separation.
004130| src/components/LocationSearchInput.tsx:60: interface LocationSearchInputProps {
004131| NOTE: Type declaration for search data contracts.
004132| src/components/LocationSearchInput.tsx:61:   value: string;
004133| NOTE: Implementation detail supporting search page behavior.
004134| src/components/LocationSearchInput.tsx:62:   onChange: (value: string) => void;
004135| NOTE: Implementation detail supporting search page behavior.
004136| src/components/LocationSearchInput.tsx:63:   onLocationSelect?: (location: {
004137| NOTE: Implementation detail supporting search page behavior.
004138| src/components/LocationSearchInput.tsx:64:     name: string;
004139| NOTE: Implementation detail supporting search page behavior.
004140| src/components/LocationSearchInput.tsx:65:     lat: number;
004141| NOTE: Implementation detail supporting search page behavior.
004142| src/components/LocationSearchInput.tsx:66:     lng: number;
004143| NOTE: Implementation detail supporting search page behavior.
004144| src/components/LocationSearchInput.tsx:67:     bbox?: [number, number, number, number]; // [minLng, minLat, maxLng, maxLat]
004145| NOTE: Implementation detail supporting search page behavior.
004146| src/components/LocationSearchInput.tsx:68:   }) => void;
004147| NOTE: Implementation detail supporting search page behavior.
004148| src/components/LocationSearchInput.tsx:69:   onFocus?: () => void;
004149| NOTE: Implementation detail supporting search page behavior.
004150| src/components/LocationSearchInput.tsx:70:   onBlur?: () => void;
004151| NOTE: Implementation detail supporting search page behavior.
004152| src/components/LocationSearchInput.tsx:71:   placeholder?: string;
004153| NOTE: Implementation detail supporting search page behavior.
004154| src/components/LocationSearchInput.tsx:72:   className?: string;
004155| NOTE: Implementation detail supporting search page behavior.
004156| src/components/LocationSearchInput.tsx:73: }
004157| NOTE: Implementation detail supporting search page behavior.
004158| src/components/LocationSearchInput.tsx:74: 
004159| NOTE: Blank line for visual separation.
004160| src/components/LocationSearchInput.tsx:75: /**
004161| NOTE: Block comment line describing behavior or context.
004162| src/components/LocationSearchInput.tsx:76:  * Imperative handle for programmatic control
004163| NOTE: Block comment line describing behavior or context.
004164| src/components/LocationSearchInput.tsx:77:  */
004165| NOTE: Block comment line describing behavior or context.
004166| src/components/LocationSearchInput.tsx:78: export interface LocationSearchInputRef {
004167| NOTE: Implementation detail supporting search page behavior.
004168| src/components/LocationSearchInput.tsx:79:   focus: () => void;
004169| NOTE: Implementation detail supporting search page behavior.
004170| src/components/LocationSearchInput.tsx:80: }
004171| NOTE: Implementation detail supporting search page behavior.
004172| src/components/LocationSearchInput.tsx:81: 
004173| NOTE: Blank line for visual separation.
004174| src/components/LocationSearchInput.tsx:82: const LocationSearchInput = forwardRef<
004175| NOTE: Local declaration used by search logic or UI.
004176| src/components/LocationSearchInput.tsx:83:   LocationSearchInputRef,
004177| NOTE: Implementation detail supporting search page behavior.
004178| src/components/LocationSearchInput.tsx:84:   LocationSearchInputProps
004179| NOTE: Implementation detail supporting search page behavior.
004180| src/components/LocationSearchInput.tsx:85: >(function LocationSearchInput(
004181| NOTE: Implementation detail supporting search page behavior.
004182| src/components/LocationSearchInput.tsx:86:   {
004183| NOTE: Implementation detail supporting search page behavior.
004184| src/components/LocationSearchInput.tsx:87:     value,
004185| NOTE: Implementation detail supporting search page behavior.
004186| src/components/LocationSearchInput.tsx:88:     onChange,
004187| NOTE: Implementation detail supporting search page behavior.
004188| src/components/LocationSearchInput.tsx:89:     onLocationSelect,
004189| NOTE: Implementation detail supporting search page behavior.
004190| src/components/LocationSearchInput.tsx:90:     onFocus,
004191| NOTE: Implementation detail supporting search page behavior.
004192| src/components/LocationSearchInput.tsx:91:     onBlur,
004193| NOTE: Implementation detail supporting search page behavior.
004194| src/components/LocationSearchInput.tsx:92:     placeholder = "City, neighborhood...",
004195| NOTE: Implementation detail supporting search page behavior.
004196| src/components/LocationSearchInput.tsx:93:     className = "",
004197| NOTE: Implementation detail supporting search page behavior.
004198| src/components/LocationSearchInput.tsx:94:   },
004199| NOTE: Implementation detail supporting search page behavior.
004200| src/components/LocationSearchInput.tsx:95:   ref,
004201| NOTE: Implementation detail supporting search page behavior.
004202| src/components/LocationSearchInput.tsx:96: ) {
004203| NOTE: Implementation detail supporting search page behavior.
004204| src/components/LocationSearchInput.tsx:97:   const [suggestions, setSuggestions] = useState<LocationSuggestion[]>([]);
004205| NOTE: Initializes local state for search UI behavior.
004206| src/components/LocationSearchInput.tsx:98:   const [isLoading, setIsLoading] = useState(false);
004207| NOTE: Initializes local state for search UI behavior.
004208| src/components/LocationSearchInput.tsx:99:   const [showSuggestions, setShowSuggestions] = useState(false);
004209| NOTE: Initializes local state for search UI behavior.
004210| src/components/LocationSearchInput.tsx:100:   const [selectedIndex, setSelectedIndex] = useState(-1);
004211| NOTE: Initializes local state for search UI behavior.
004212| src/components/LocationSearchInput.tsx:101:   const [error, setError] = useState<string | null>(null);
004213| NOTE: Initializes local state for search UI behavior.
004214| src/components/LocationSearchInput.tsx:102:   const [noResults, setNoResults] = useState(false);
004215| NOTE: Initializes local state for search UI behavior.
004216| src/components/LocationSearchInput.tsx:103:   const inputRef = useRef<HTMLInputElement>(null);
004217| NOTE: Uses ref for stable mutable storage between renders.
004218| src/components/LocationSearchInput.tsx:104:   const suggestionsRef = useRef<HTMLDivElement>(null);
004219| NOTE: Uses ref for stable mutable storage between renders.
004220| src/components/LocationSearchInput.tsx:105:   const requestIdRef = useRef(0);
004221| NOTE: Uses ref for stable mutable storage between renders.
004222| src/components/LocationSearchInput.tsx:106:   const abortRef = useRef<AbortController | null>(null);
004223| NOTE: Uses ref for stable mutable storage between renders.
004224| src/components/LocationSearchInput.tsx:107: 
004225| NOTE: Blank line for visual separation.
004226| src/components/LocationSearchInput.tsx:108:   // Expose focus method via imperative handle
004227| NOTE: Line comment documents intent or constraints.
004228| src/components/LocationSearchInput.tsx:109:   useImperativeHandle(ref, () => ({
004229| NOTE: Implementation detail supporting search page behavior.
004230| src/components/LocationSearchInput.tsx:110:     focus: () => {
004231| NOTE: Implementation detail supporting search page behavior.
004232| src/components/LocationSearchInput.tsx:111:       inputRef.current?.focus();
004233| NOTE: Implementation detail supporting search page behavior.
004234| src/components/LocationSearchInput.tsx:112:     },
004235| NOTE: Implementation detail supporting search page behavior.
004236| src/components/LocationSearchInput.tsx:113:   }));
004237| NOTE: Implementation detail supporting search page behavior.
004238| src/components/LocationSearchInput.tsx:114: 
004239| NOTE: Blank line for visual separation.
004240| src/components/LocationSearchInput.tsx:115:   // Increased debounce from 300ms to 350ms to reduce API calls
004241| NOTE: Line comment documents intent or constraints.
004242| src/components/LocationSearchInput.tsx:116:   const [debouncedValue] = useDebounce(value, 350);
004243| NOTE: Local declaration used by search logic or UI.
004244| src/components/LocationSearchInput.tsx:117: 
004245| NOTE: Blank line for visual separation.
004246| src/components/LocationSearchInput.tsx:118:   /**
004247| NOTE: Block comment line describing behavior or context.
004248| src/components/LocationSearchInput.tsx:119:    * Local-first search: Search local dataset first, only call Mapbox when needed.
004249| NOTE: Block comment line describing behavior or context.
004250| src/components/LocationSearchInput.tsx:120:    * This reduces Mapbox Geocoding API costs significantly.
004251| NOTE: Block comment line describing behavior or context.
004252| src/components/LocationSearchInput.tsx:121:    *
004253| NOTE: Block comment line describing behavior or context.
004254| src/components/LocationSearchInput.tsx:122:    * Strategy:
004255| NOTE: Block comment line describing behavior or context.
004256| src/components/LocationSearchInput.tsx:123:    * 1. Search local dataset first (free, fast, ~500 US locations)
004257| NOTE: Block comment line describing behavior or context.
004258| src/components/LocationSearchInput.tsx:124:    * 2. Only call Mapbox if:
004259| NOTE: Block comment line describing behavior or context.
004260| src/components/LocationSearchInput.tsx:125:    *    - Query looks like a street address (contains numbers)
004261| NOTE: Block comment line describing behavior or context.
004262| src/components/LocationSearchInput.tsx:126:    *    - Less than 3 local matches found
004263| NOTE: Block comment line describing behavior or context.
004264| src/components/LocationSearchInput.tsx:127:    * 3. Merge results (local first, dedupe by name)
004265| NOTE: Block comment line describing behavior or context.
004266| src/components/LocationSearchInput.tsx:128:    * 4. On API error, fall back to local results
004267| NOTE: Block comment line describing behavior or context.
004268| src/components/LocationSearchInput.tsx:129:    */
004269| NOTE: Block comment line describing behavior or context.
004270| src/components/LocationSearchInput.tsx:130:   const fetchSuggestions = useCallback(async (query: string) => {
004271| NOTE: Memoizes callback to preserve references across renders.
004272| src/components/LocationSearchInput.tsx:131:     const requestId = requestIdRef.current + 1;
004273| NOTE: Local declaration used by search logic or UI.
004274| src/components/LocationSearchInput.tsx:132:     requestIdRef.current = requestId;
004275| NOTE: Implementation detail supporting search page behavior.
004276| src/components/LocationSearchInput.tsx:133: 
004277| NOTE: Blank line for visual separation.
004278| src/components/LocationSearchInput.tsx:134:     // Reset states
004279| NOTE: Line comment documents intent or constraints.
004280| src/components/LocationSearchInput.tsx:135:     setError(null);
004281| NOTE: Implementation detail supporting search page behavior.
004282| src/components/LocationSearchInput.tsx:136:     setNoResults(false);
004283| NOTE: Implementation detail supporting search page behavior.
004284| src/components/LocationSearchInput.tsx:137: 
004285| NOTE: Blank line for visual separation.
004286| src/components/LocationSearchInput.tsx:138:     // Require 3+ chars to search
004287| NOTE: Line comment documents intent or constraints.
004288| src/components/LocationSearchInput.tsx:139:     if (!query || query.length < 3) {
004289| NOTE: Conditional logic controlling rendering or flow.
004290| src/components/LocationSearchInput.tsx:140:       setSuggestions([]);
004291| NOTE: Implementation detail supporting search page behavior.
004292| src/components/LocationSearchInput.tsx:141:       return;
004293| NOTE: Implementation detail supporting search page behavior.
004294| src/components/LocationSearchInput.tsx:142:     }
004295| NOTE: Implementation detail supporting search page behavior.
004296| src/components/LocationSearchInput.tsx:143: 
004297| NOTE: Blank line for visual separation.
004298| src/components/LocationSearchInput.tsx:144:     // Step 1: Search local dataset first (always free)
004299| NOTE: Line comment documents intent or constraints.
004300| src/components/LocationSearchInput.tsx:145:     const localResults = searchLocalLocations(query, 5);
004301| NOTE: Local declaration used by search logic or UI.
004302| src/components/LocationSearchInput.tsx:146:     const localSuggestions = localResults.map(localToSuggestion);
004303| NOTE: Local declaration used by search logic or UI.
004304| src/components/LocationSearchInput.tsx:147: 
004305| NOTE: Blank line for visual separation.
004306| src/components/LocationSearchInput.tsx:148:     // Step 2: Determine if we need to call Mapbox
004307| NOTE: Line comment documents intent or constraints.
004308| src/components/LocationSearchInput.tsx:149:     const isStreetAddress = looksLikeStreetAddress(query);
004309| NOTE: Local declaration used by search logic or UI.
004310| src/components/LocationSearchInput.tsx:150:     const needsMapbox = isStreetAddress || localResults.length < 3;
004311| NOTE: Local declaration used by search logic or UI.
004312| src/components/LocationSearchInput.tsx:151: 
004313| NOTE: Blank line for visual separation.
004314| src/components/LocationSearchInput.tsx:152:     // If we have enough local results and it's not a street address, skip Mapbox
004315| NOTE: Line comment documents intent or constraints.
004316| src/components/LocationSearchInput.tsx:153:     if (!needsMapbox) {
004317| NOTE: Conditional logic controlling rendering or flow.
004318| src/components/LocationSearchInput.tsx:154:       setSuggestions(localSuggestions);
004319| NOTE: Implementation detail supporting search page behavior.
004320| src/components/LocationSearchInput.tsx:155:       setSelectedIndex(-1);
004321| NOTE: Implementation detail supporting search page behavior.
004322| src/components/LocationSearchInput.tsx:156:       if (localSuggestions.length === 0) {
004323| NOTE: Conditional logic controlling rendering or flow.
004324| src/components/LocationSearchInput.tsx:157:         setNoResults(true);
004325| NOTE: Implementation detail supporting search page behavior.
004326| src/components/LocationSearchInput.tsx:158:       }
004327| NOTE: Implementation detail supporting search page behavior.
004328| src/components/LocationSearchInput.tsx:159:       return;
004329| NOTE: Implementation detail supporting search page behavior.
004330| src/components/LocationSearchInput.tsx:160:     }
004331| NOTE: Implementation detail supporting search page behavior.
004332| src/components/LocationSearchInput.tsx:161: 
004333| NOTE: Blank line for visual separation.
004334| src/components/LocationSearchInput.tsx:162:     // Step 3: Call Mapbox for additional results
004335| NOTE: Line comment documents intent or constraints.
004336| src/components/LocationSearchInput.tsx:163:     const token = process.env.NEXT_PUBLIC_MAPBOX_TOKEN;
004337| NOTE: Local declaration used by search logic or UI.
004338| src/components/LocationSearchInput.tsx:164:     if (!token) {
004339| NOTE: Conditional logic controlling rendering or flow.
004340| src/components/LocationSearchInput.tsx:165:       // Graceful fallback to local results
004341| NOTE: Line comment documents intent or constraints.
004342| src/components/LocationSearchInput.tsx:166:       if (localSuggestions.length > 0) {
004343| NOTE: Conditional logic controlling rendering or flow.
004344| src/components/LocationSearchInput.tsx:167:         setSuggestions(localSuggestions);
004345| NOTE: Implementation detail supporting search page behavior.
004346| src/components/LocationSearchInput.tsx:168:         setSelectedIndex(-1);
004347| NOTE: Implementation detail supporting search page behavior.
004348| src/components/LocationSearchInput.tsx:169:         return;
004349| NOTE: Implementation detail supporting search page behavior.
004350| src/components/LocationSearchInput.tsx:170:       }
004351| NOTE: Implementation detail supporting search page behavior.
004352| src/components/LocationSearchInput.tsx:171:       setError("Location search is temporarily unavailable");
004353| NOTE: Implementation detail supporting search page behavior.
004354| src/components/LocationSearchInput.tsx:172:       console.error("Mapbox token is missing");
004355| NOTE: Implementation detail supporting search page behavior.
004356| src/components/LocationSearchInput.tsx:173:       return;
004357| NOTE: Implementation detail supporting search page behavior.
004358| src/components/LocationSearchInput.tsx:174:     }
004359| NOTE: Implementation detail supporting search page behavior.
004360| src/components/LocationSearchInput.tsx:175: 
004361| NOTE: Blank line for visual separation.
004362| src/components/LocationSearchInput.tsx:176:     if (abortRef.current) {
004363| NOTE: Conditional logic controlling rendering or flow.
004364| src/components/LocationSearchInput.tsx:177:       abortRef.current.abort();
004365| NOTE: Implementation detail supporting search page behavior.
004366| src/components/LocationSearchInput.tsx:178:     }
004367| NOTE: Implementation detail supporting search page behavior.
004368| src/components/LocationSearchInput.tsx:179:     const controller = new AbortController();
004369| NOTE: Local declaration used by search logic or UI.
004370| src/components/LocationSearchInput.tsx:180:     abortRef.current = controller;
004371| NOTE: Implementation detail supporting search page behavior.
004372| src/components/LocationSearchInput.tsx:181: 
004373| NOTE: Blank line for visual separation.
004374| src/components/LocationSearchInput.tsx:182:     setIsLoading(true);
004375| NOTE: Implementation detail supporting search page behavior.
004376| src/components/LocationSearchInput.tsx:183:     try {
004377| NOTE: Implementation detail supporting search page behavior.
004378| src/components/LocationSearchInput.tsx:184:       const encodedQuery = encodeURIComponent(query);
004379| NOTE: Local declaration used by search logic or UI.
004380| src/components/LocationSearchInput.tsx:185:       // Focus on places, regions, localities, neighborhoods
004381| NOTE: Line comment documents intent or constraints.
004382| src/components/LocationSearchInput.tsx:186:       const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodedQuery}.json?access_token=${token}&types=place,locality,neighborhood,address,region&limit=5&autocomplete=true`;
004383| NOTE: Local declaration used by search logic or UI.
004384| src/components/LocationSearchInput.tsx:187: 
004385| NOTE: Blank line for visual separation.
004386| src/components/LocationSearchInput.tsx:188:       const response = await fetch(url, { signal: controller.signal });
004387| NOTE: Local declaration used by search logic or UI.
004388| src/components/LocationSearchInput.tsx:189: 
004389| NOTE: Blank line for visual separation.
004390| src/components/LocationSearchInput.tsx:190:       if (!response.ok) {
004391| NOTE: Conditional logic controlling rendering or flow.
004392| src/components/LocationSearchInput.tsx:191:         if (response.status === 401 || response.status === 403) {
004393| NOTE: Conditional logic controlling rendering or flow.
004394| src/components/LocationSearchInput.tsx:192:           throw new Error("Location service authentication failed");
004395| NOTE: Implementation detail supporting search page behavior.
004396| src/components/LocationSearchInput.tsx:193:         } else if (response.status >= 500) {
004397| NOTE: Implementation detail supporting search page behavior.
004398| src/components/LocationSearchInput.tsx:194:           throw new Error("Location service is temporarily unavailable");
004399| NOTE: Implementation detail supporting search page behavior.
004400| src/components/LocationSearchInput.tsx:195:         }
004401| NOTE: Implementation detail supporting search page behavior.
004402| src/components/LocationSearchInput.tsx:196:         throw new Error("Failed to fetch suggestions");
004403| NOTE: Implementation detail supporting search page behavior.
004404| src/components/LocationSearchInput.tsx:197:       }
004405| NOTE: Implementation detail supporting search page behavior.
004406| src/components/LocationSearchInput.tsx:198: 
004407| NOTE: Blank line for visual separation.
004408| src/components/LocationSearchInput.tsx:199:       const data = await response.json();
004409| NOTE: Local declaration used by search logic or UI.
004410| src/components/LocationSearchInput.tsx:200:       if (requestId !== requestIdRef.current) return;
004411| NOTE: Conditional logic controlling rendering or flow.
004412| src/components/LocationSearchInput.tsx:201: 
004413| NOTE: Blank line for visual separation.
004414| src/components/LocationSearchInput.tsx:202:       // Convert Mapbox features to our format with source marker
004415| NOTE: Line comment documents intent or constraints.
004416| src/components/LocationSearchInput.tsx:203:       const mapboxFeatures: LocationSuggestion[] = (data.features || []).map(
004417| NOTE: Local declaration used by search logic or UI.
004418| src/components/LocationSearchInput.tsx:204:         (f: any) => ({
004419| NOTE: Implementation detail supporting search page behavior.
004420| src/components/LocationSearchInput.tsx:205:           id: f.id,
004421| NOTE: Implementation detail supporting search page behavior.
004422| src/components/LocationSearchInput.tsx:206:           place_name: f.place_name,
004423| NOTE: Implementation detail supporting search page behavior.
004424| src/components/LocationSearchInput.tsx:207:           center: f.center as [number, number],
004425| NOTE: Implementation detail supporting search page behavior.
004426| src/components/LocationSearchInput.tsx:208:           place_type: f.place_type,
004427| NOTE: Implementation detail supporting search page behavior.
004428| src/components/LocationSearchInput.tsx:209:           bbox: f.bbox as [number, number, number, number] | undefined,
004429| NOTE: Implementation detail supporting search page behavior.
004430| src/components/LocationSearchInput.tsx:210:           source: "mapbox" as const,
004431| NOTE: Implementation detail supporting search page behavior.
004432| src/components/LocationSearchInput.tsx:211:         }),
004433| NOTE: Implementation detail supporting search page behavior.
004434| src/components/LocationSearchInput.tsx:212:       );
004435| NOTE: Implementation detail supporting search page behavior.
004436| src/components/LocationSearchInput.tsx:213: 
004437| NOTE: Blank line for visual separation.
004438| src/components/LocationSearchInput.tsx:214:       // Step 4: Merge results (local first, dedupe)
004439| NOTE: Line comment documents intent or constraints.
004440| src/components/LocationSearchInput.tsx:215:       const merged = dedupeSuggestions([
004441| NOTE: Local declaration used by search logic or UI.
004442| src/components/LocationSearchInput.tsx:216:         ...localSuggestions,
004443| NOTE: Implementation detail supporting search page behavior.
004444| src/components/LocationSearchInput.tsx:217:         ...mapboxFeatures,
004445| NOTE: Implementation detail supporting search page behavior.
004446| src/components/LocationSearchInput.tsx:218:       ]);
004447| NOTE: Implementation detail supporting search page behavior.
004448| src/components/LocationSearchInput.tsx:219:       const limited = merged.slice(0, 5);
004449| NOTE: Local declaration used by search logic or UI.
004450| src/components/LocationSearchInput.tsx:220: 
004451| NOTE: Blank line for visual separation.
004452| src/components/LocationSearchInput.tsx:221:       setSuggestions(limited);
004453| NOTE: Implementation detail supporting search page behavior.
004454| src/components/LocationSearchInput.tsx:222:       setSelectedIndex(-1);
004455| NOTE: Implementation detail supporting search page behavior.
004456| src/components/LocationSearchInput.tsx:223: 
004457| NOTE: Blank line for visual separation.
004458| src/components/LocationSearchInput.tsx:224:       // Set noResults if query was long enough but no results found
004459| NOTE: Line comment documents intent or constraints.
004460| src/components/LocationSearchInput.tsx:225:       if (query.length >= 3 && limited.length === 0) {
004461| NOTE: Conditional logic controlling rendering or flow.
004462| src/components/LocationSearchInput.tsx:226:         setNoResults(true);
004463| NOTE: Implementation detail supporting search page behavior.
004464| src/components/LocationSearchInput.tsx:227:       }
004465| NOTE: Implementation detail supporting search page behavior.
004466| src/components/LocationSearchInput.tsx:228:     } catch (err) {
004467| NOTE: Implementation detail supporting search page behavior.
004468| src/components/LocationSearchInput.tsx:229:       if (err instanceof DOMException && err.name === "AbortError") {
004469| NOTE: Conditional logic controlling rendering or flow.
004470| src/components/LocationSearchInput.tsx:230:         return;
004471| NOTE: Implementation detail supporting search page behavior.
004472| src/components/LocationSearchInput.tsx:231:       }
004473| NOTE: Implementation detail supporting search page behavior.
004474| src/components/LocationSearchInput.tsx:232:       console.error("Error fetching location suggestions:", err);
004475| NOTE: Implementation detail supporting search page behavior.
004476| src/components/LocationSearchInput.tsx:233: 
004477| NOTE: Blank line for visual separation.
004478| src/components/LocationSearchInput.tsx:234:       // Graceful fallback to local results on API error
004479| NOTE: Line comment documents intent or constraints.
004480| src/components/LocationSearchInput.tsx:235:       if (requestId === requestIdRef.current) {
004481| NOTE: Conditional logic controlling rendering or flow.
004482| src/components/LocationSearchInput.tsx:236:         if (localSuggestions.length > 0) {
004483| NOTE: Conditional logic controlling rendering or flow.
004484| src/components/LocationSearchInput.tsx:237:           setSuggestions(localSuggestions);
004485| NOTE: Implementation detail supporting search page behavior.
004486| src/components/LocationSearchInput.tsx:238:           setSelectedIndex(-1);
004487| NOTE: Implementation detail supporting search page behavior.
004488| src/components/LocationSearchInput.tsx:239:         } else {
004489| NOTE: Implementation detail supporting search page behavior.
004490| src/components/LocationSearchInput.tsx:240:           setSuggestions([]);
004491| NOTE: Implementation detail supporting search page behavior.
004492| src/components/LocationSearchInput.tsx:241:           setError(
004493| NOTE: Implementation detail supporting search page behavior.
004494| src/components/LocationSearchInput.tsx:242:             err instanceof Error ? err.message : "Unable to search locations",
004495| NOTE: Implementation detail supporting search page behavior.
004496| src/components/LocationSearchInput.tsx:243:           );
004497| NOTE: Implementation detail supporting search page behavior.
004498| src/components/LocationSearchInput.tsx:244:         }
004499| NOTE: Implementation detail supporting search page behavior.
004500| src/components/LocationSearchInput.tsx:245:       }
004501| NOTE: Implementation detail supporting search page behavior.
004502| src/components/LocationSearchInput.tsx:246:     } finally {
004503| NOTE: Implementation detail supporting search page behavior.
004504| src/components/LocationSearchInput.tsx:247:       if (requestId === requestIdRef.current) {
004505| NOTE: Conditional logic controlling rendering or flow.
004506| src/components/LocationSearchInput.tsx:248:         setIsLoading(false);
004507| NOTE: Implementation detail supporting search page behavior.
004508| src/components/LocationSearchInput.tsx:249:       }
004509| NOTE: Implementation detail supporting search page behavior.
004510| src/components/LocationSearchInput.tsx:250:     }
004511| NOTE: Implementation detail supporting search page behavior.
004512| src/components/LocationSearchInput.tsx:251:   }, []);
004513| NOTE: Implementation detail supporting search page behavior.
004514| src/components/LocationSearchInput.tsx:252: 
004515| NOTE: Blank line for visual separation.
004516| src/components/LocationSearchInput.tsx:253:   // Fetch suggestions when debounced value changes
004517| NOTE: Line comment documents intent or constraints.
004518| src/components/LocationSearchInput.tsx:254:   useEffect(() => {
004519| NOTE: Defines side effect for syncing with external state.
004520| src/components/LocationSearchInput.tsx:255:     fetchSuggestions(debouncedValue);
004521| NOTE: Implementation detail supporting search page behavior.
004522| src/components/LocationSearchInput.tsx:256:   }, [debouncedValue, fetchSuggestions]);
004523| NOTE: Implementation detail supporting search page behavior.
004524| src/components/LocationSearchInput.tsx:257: 
004525| NOTE: Blank line for visual separation.
004526| src/components/LocationSearchInput.tsx:258:   // Handle clicking outside to close suggestions
004527| NOTE: Line comment documents intent or constraints.
004528| src/components/LocationSearchInput.tsx:259:   useEffect(() => {
004529| NOTE: Defines side effect for syncing with external state.
004530| src/components/LocationSearchInput.tsx:260:     const handleClickOutside = (event: MouseEvent) => {
004531| NOTE: Local declaration used by search logic or UI.
004532| src/components/LocationSearchInput.tsx:261:       if (
004533| NOTE: Conditional logic controlling rendering or flow.
004534| src/components/LocationSearchInput.tsx:262:         suggestionsRef.current &&
004535| NOTE: Implementation detail supporting search page behavior.
004536| src/components/LocationSearchInput.tsx:263:         !suggestionsRef.current.contains(event.target as Node) &&
004537| NOTE: Implementation detail supporting search page behavior.
004538| src/components/LocationSearchInput.tsx:264:         inputRef.current &&
004539| NOTE: Implementation detail supporting search page behavior.
004540| src/components/LocationSearchInput.tsx:265:         !inputRef.current.contains(event.target as Node)
004541| NOTE: Implementation detail supporting search page behavior.
004542| src/components/LocationSearchInput.tsx:266:       ) {
004543| NOTE: Implementation detail supporting search page behavior.
004544| src/components/LocationSearchInput.tsx:267:         setShowSuggestions(false);
004545| NOTE: Implementation detail supporting search page behavior.
004546| src/components/LocationSearchInput.tsx:268:       }
004547| NOTE: Implementation detail supporting search page behavior.
004548| src/components/LocationSearchInput.tsx:269:     };
004549| NOTE: Implementation detail supporting search page behavior.
004550| src/components/LocationSearchInput.tsx:270: 
004551| NOTE: Blank line for visual separation.
004552| src/components/LocationSearchInput.tsx:271:     document.addEventListener("mousedown", handleClickOutside);
004553| NOTE: Implementation detail supporting search page behavior.
004554| src/components/LocationSearchInput.tsx:272:     return () => document.removeEventListener("mousedown", handleClickOutside);
004555| NOTE: Return statement for component or helper output.
004556| src/components/LocationSearchInput.tsx:273:   }, []);
004557| NOTE: Implementation detail supporting search page behavior.
004558| src/components/LocationSearchInput.tsx:274: 
004559| NOTE: Blank line for visual separation.
004560| src/components/LocationSearchInput.tsx:275:   // Handle keyboard navigation
004561| NOTE: Line comment documents intent or constraints.
004562| src/components/LocationSearchInput.tsx:276:   const handleKeyDown = (e: React.KeyboardEvent) => {
004563| NOTE: Local declaration used by search logic or UI.
004564| src/components/LocationSearchInput.tsx:277:     if (!showSuggestions || suggestions.length === 0) return;
004565| NOTE: Conditional logic controlling rendering or flow.
004566| src/components/LocationSearchInput.tsx:278: 
004567| NOTE: Blank line for visual separation.
004568| src/components/LocationSearchInput.tsx:279:     switch (e.key) {
004569| NOTE: Implementation detail supporting search page behavior.
004570| src/components/LocationSearchInput.tsx:280:       case "ArrowDown":
004571| NOTE: Implementation detail supporting search page behavior.
004572| src/components/LocationSearchInput.tsx:281:         e.preventDefault();
004573| NOTE: Implementation detail supporting search page behavior.
004574| src/components/LocationSearchInput.tsx:282:         setSelectedIndex((prev) =>
004575| NOTE: Implementation detail supporting search page behavior.
004576| src/components/LocationSearchInput.tsx:283:           prev < suggestions.length - 1 ? prev + 1 : prev,
004577| NOTE: Implementation detail supporting search page behavior.
004578| src/components/LocationSearchInput.tsx:284:         );
004579| NOTE: Implementation detail supporting search page behavior.
004580| src/components/LocationSearchInput.tsx:285:         break;
004581| NOTE: Implementation detail supporting search page behavior.
004582| src/components/LocationSearchInput.tsx:286:       case "ArrowUp":
004583| NOTE: Implementation detail supporting search page behavior.
004584| src/components/LocationSearchInput.tsx:287:         e.preventDefault();
004585| NOTE: Implementation detail supporting search page behavior.
004586| src/components/LocationSearchInput.tsx:288:         setSelectedIndex((prev) => (prev > 0 ? prev - 1 : -1));
004587| NOTE: Implementation detail supporting search page behavior.
004588| src/components/LocationSearchInput.tsx:289:         break;
004589| NOTE: Implementation detail supporting search page behavior.
004590| src/components/LocationSearchInput.tsx:290:       case "Enter":
004591| NOTE: Implementation detail supporting search page behavior.
004592| src/components/LocationSearchInput.tsx:291:         e.preventDefault();
004593| NOTE: Implementation detail supporting search page behavior.
004594| src/components/LocationSearchInput.tsx:292:         if (selectedIndex >= 0 && selectedIndex < suggestions.length) {
004595| NOTE: Conditional logic controlling rendering or flow.
004596| src/components/LocationSearchInput.tsx:293:           handleSelectSuggestion(suggestions[selectedIndex]);
004597| NOTE: Implementation detail supporting search page behavior.
004598| src/components/LocationSearchInput.tsx:294:         }
004599| NOTE: Implementation detail supporting search page behavior.
004600| src/components/LocationSearchInput.tsx:295:         break;
004601| NOTE: Implementation detail supporting search page behavior.
004602| src/components/LocationSearchInput.tsx:296:       case "Escape":
004603| NOTE: Implementation detail supporting search page behavior.
004604| src/components/LocationSearchInput.tsx:297:         setShowSuggestions(false);
004605| NOTE: Implementation detail supporting search page behavior.
004606| src/components/LocationSearchInput.tsx:298:         setSelectedIndex(-1);
004607| NOTE: Implementation detail supporting search page behavior.
004608| src/components/LocationSearchInput.tsx:299:         break;
004609| NOTE: Implementation detail supporting search page behavior.
004610| src/components/LocationSearchInput.tsx:300:     }
004611| NOTE: Implementation detail supporting search page behavior.
004612| src/components/LocationSearchInput.tsx:301:   };
004613| NOTE: Implementation detail supporting search page behavior.
004614| src/components/LocationSearchInput.tsx:302: 
004615| NOTE: Blank line for visual separation.
004616| src/components/LocationSearchInput.tsx:303:   const handleSelectSuggestion = (suggestion: LocationSuggestion) => {
004617| NOTE: Local declaration used by search logic or UI.
004618| src/components/LocationSearchInput.tsx:304:     const [lng, lat] = suggestion.center;
004619| NOTE: Local declaration used by search logic or UI.
004620| src/components/LocationSearchInput.tsx:305:     onChange(suggestion.place_name);
004621| NOTE: Implementation detail supporting search page behavior.
004622| src/components/LocationSearchInput.tsx:306:     setShowSuggestions(false);
004623| NOTE: Implementation detail supporting search page behavior.
004624| src/components/LocationSearchInput.tsx:307:     setSuggestions([]);
004625| NOTE: Implementation detail supporting search page behavior.
004626| src/components/LocationSearchInput.tsx:308: 
004627| NOTE: Blank line for visual separation.
004628| src/components/LocationSearchInput.tsx:309:     if (onLocationSelect) {
004629| NOTE: Conditional logic controlling rendering or flow.
004630| src/components/LocationSearchInput.tsx:310:       onLocationSelect({
004631| NOTE: Implementation detail supporting search page behavior.
004632| src/components/LocationSearchInput.tsx:311:         name: suggestion.place_name,
004633| NOTE: Implementation detail supporting search page behavior.
004634| src/components/LocationSearchInput.tsx:312:         lat,
004635| NOTE: Implementation detail supporting search page behavior.
004636| src/components/LocationSearchInput.tsx:313:         lng,
004637| NOTE: Implementation detail supporting search page behavior.
004638| src/components/LocationSearchInput.tsx:314:         bbox: suggestion.bbox,
004639| NOTE: Implementation detail supporting search page behavior.
004640| src/components/LocationSearchInput.tsx:315:       });
004641| NOTE: Implementation detail supporting search page behavior.
004642| src/components/LocationSearchInput.tsx:316:     }
004643| NOTE: Implementation detail supporting search page behavior.
004644| src/components/LocationSearchInput.tsx:317:   };
004645| NOTE: Implementation detail supporting search page behavior.
004646| src/components/LocationSearchInput.tsx:318: 
004647| NOTE: Blank line for visual separation.
004648| src/components/LocationSearchInput.tsx:319:   const handleClear = () => {
004649| NOTE: Local declaration used by search logic or UI.
004650| src/components/LocationSearchInput.tsx:320:     onChange("");
004651| NOTE: Implementation detail supporting search page behavior.
004652| src/components/LocationSearchInput.tsx:321:     setSuggestions([]);
004653| NOTE: Implementation detail supporting search page behavior.
004654| src/components/LocationSearchInput.tsx:322:     inputRef.current?.focus();
004655| NOTE: Implementation detail supporting search page behavior.
004656| src/components/LocationSearchInput.tsx:323:   };
004657| NOTE: Implementation detail supporting search page behavior.
004658| src/components/LocationSearchInput.tsx:324: 
004659| NOTE: Blank line for visual separation.
004660| src/components/LocationSearchInput.tsx:325:   const getPlaceTypeIcon = (placeTypes: string[]) => {
004661| NOTE: Local declaration used by search logic or UI.
004662| src/components/LocationSearchInput.tsx:326:     // Return appropriate styling based on place type
004663| NOTE: Line comment documents intent or constraints.
004664| src/components/LocationSearchInput.tsx:327:     // Supports both Mapbox types and local dataset types
004665| NOTE: Line comment documents intent or constraints.
004666| src/components/LocationSearchInput.tsx:328:     if (placeTypes.includes("neighborhood")) return "text-orange-500";
004667| NOTE: Conditional logic controlling rendering or flow.
004668| src/components/LocationSearchInput.tsx:329:     if (placeTypes.includes("locality")) return "text-blue-500";
004669| NOTE: Conditional logic controlling rendering or flow.
004670| src/components/LocationSearchInput.tsx:330:     if (placeTypes.includes("place") || placeTypes.includes("city"))
004671| NOTE: Conditional logic controlling rendering or flow.
004672| src/components/LocationSearchInput.tsx:331:       return "text-green-500";
004673| NOTE: Return statement for component or helper output.
004674| src/components/LocationSearchInput.tsx:332:     if (
004675| NOTE: Conditional logic controlling rendering or flow.
004676| src/components/LocationSearchInput.tsx:333:       placeTypes.includes("region") ||
004677| NOTE: Implementation detail supporting search page behavior.
004678| src/components/LocationSearchInput.tsx:334:       placeTypes.includes("state") ||
004679| NOTE: Implementation detail supporting search page behavior.
004680| src/components/LocationSearchInput.tsx:335:       placeTypes.includes("metro")
004681| NOTE: Implementation detail supporting search page behavior.
004682| src/components/LocationSearchInput.tsx:336:     )
004683| NOTE: Implementation detail supporting search page behavior.
004684| src/components/LocationSearchInput.tsx:337:       return "text-purple-500";
004685| NOTE: Return statement for component or helper output.
004686| src/components/LocationSearchInput.tsx:338:     return "text-zinc-400";
004687| NOTE: Return statement for component or helper output.
004688| src/components/LocationSearchInput.tsx:339:   };
004689| NOTE: Implementation detail supporting search page behavior.
004690| src/components/LocationSearchInput.tsx:340: 
004691| NOTE: Blank line for visual separation.
004692| src/components/LocationSearchInput.tsx:341:   return (
004693| NOTE: Return statement for component or helper output.
004694| src/components/LocationSearchInput.tsx:342:     <div className={`relative ${className}`}>
004695| NOTE: Tailwind classes define layout and styling.
004696| src/components/LocationSearchInput.tsx:343:       <div className="relative">
004697| NOTE: Tailwind classes define layout and styling.
004698| src/components/LocationSearchInput.tsx:344:         <input
004699| NOTE: JSX markup for search UI.
004700| src/components/LocationSearchInput.tsx:345:           ref={inputRef}
004701| NOTE: Implementation detail supporting search page behavior.
004702| src/components/LocationSearchInput.tsx:346:           type="text"
004703| NOTE: Implementation detail supporting search page behavior.
004704| src/components/LocationSearchInput.tsx:347:           value={value}
004705| NOTE: Implementation detail supporting search page behavior.
004706| src/components/LocationSearchInput.tsx:348:           onChange={(e) => {
004707| NOTE: Implementation detail supporting search page behavior.
004708| src/components/LocationSearchInput.tsx:349:             onChange(e.target.value);
004709| NOTE: Implementation detail supporting search page behavior.
004710| src/components/LocationSearchInput.tsx:350:             setShowSuggestions(true);
004711| NOTE: Implementation detail supporting search page behavior.
004712| src/components/LocationSearchInput.tsx:351:           }}
004713| NOTE: Implementation detail supporting search page behavior.
004714| src/components/LocationSearchInput.tsx:352:           onFocus={() => {
004715| NOTE: Implementation detail supporting search page behavior.
004716| src/components/LocationSearchInput.tsx:353:             if (suggestions.length > 0 || value.length >= 3) {
004717| NOTE: Conditional logic controlling rendering or flow.
004718| src/components/LocationSearchInput.tsx:354:               setShowSuggestions(true);
004719| NOTE: Implementation detail supporting search page behavior.
004720| src/components/LocationSearchInput.tsx:355:             }
004721| NOTE: Implementation detail supporting search page behavior.
004722| src/components/LocationSearchInput.tsx:356:             onFocus?.();
004723| NOTE: Implementation detail supporting search page behavior.
004724| src/components/LocationSearchInput.tsx:357:           }}
004725| NOTE: Implementation detail supporting search page behavior.
004726| src/components/LocationSearchInput.tsx:358:           onBlur={() => {
004727| NOTE: Implementation detail supporting search page behavior.
004728| src/components/LocationSearchInput.tsx:359:             onBlur?.();
004729| NOTE: Implementation detail supporting search page behavior.
004730| src/components/LocationSearchInput.tsx:360:           }}
004731| NOTE: Implementation detail supporting search page behavior.
004732| src/components/LocationSearchInput.tsx:361:           onKeyDown={handleKeyDown}
004733| NOTE: Implementation detail supporting search page behavior.
004734| src/components/LocationSearchInput.tsx:362:           placeholder={placeholder}
004735| NOTE: Implementation detail supporting search page behavior.
004736| src/components/LocationSearchInput.tsx:363:           className="w-full bg-transparent border-none p-0 text-zinc-900 dark:text-white placeholder:text-zinc-500 dark:placeholder:text-zinc-400 focus:ring-0 focus:outline-none text-sm truncate pr-8"
004737| NOTE: Tailwind classes define layout and styling.
004738| src/components/LocationSearchInput.tsx:364:           autoComplete="off"
004739| NOTE: Implementation detail supporting search page behavior.
004740| src/components/LocationSearchInput.tsx:365:         />
004741| NOTE: Implementation detail supporting search page behavior.
004742| src/components/LocationSearchInput.tsx:366: 
004743| NOTE: Blank line for visual separation.
004744| src/components/LocationSearchInput.tsx:367:         {/* Loading/Clear indicator */}
004745| NOTE: Implementation detail supporting search page behavior.
004746| src/components/LocationSearchInput.tsx:368:         <div className="absolute right-0 top-1/2 -translate-y-1/2">
004747| NOTE: Tailwind classes define layout and styling.
004748| src/components/LocationSearchInput.tsx:369:           {isLoading ? (
004749| NOTE: Implementation detail supporting search page behavior.
004750| src/components/LocationSearchInput.tsx:370:             <Loader2 className="w-4 h-4 text-zinc-400 animate-spin" />
004751| NOTE: Tailwind classes define layout and styling.
004752| src/components/LocationSearchInput.tsx:371:           ) : value ? (
004753| NOTE: Implementation detail supporting search page behavior.
004754| src/components/LocationSearchInput.tsx:372:             <button
004755| NOTE: JSX markup for search UI.
004756| src/components/LocationSearchInput.tsx:373:               type="button"
004757| NOTE: Implementation detail supporting search page behavior.
004758| src/components/LocationSearchInput.tsx:374:               onClick={handleClear}
004759| NOTE: Implementation detail supporting search page behavior.
004760| src/components/LocationSearchInput.tsx:375:               className="p-1 hover:bg-zinc-100 dark:hover:bg-zinc-700 rounded-full transition-colors"
004761| NOTE: Tailwind classes define layout and styling.
004762| src/components/LocationSearchInput.tsx:376:             >
004763| NOTE: Implementation detail supporting search page behavior.
004764| src/components/LocationSearchInput.tsx:377:               <X className="w-3 h-3 text-zinc-400" />
004765| NOTE: Tailwind classes define layout and styling.
004766| src/components/LocationSearchInput.tsx:378:             </button>
004767| NOTE: JSX markup for search UI.
004768| src/components/LocationSearchInput.tsx:379:           ) : null}
004769| NOTE: Implementation detail supporting search page behavior.
004770| src/components/LocationSearchInput.tsx:380:         </div>
004771| NOTE: JSX markup for search UI.
004772| src/components/LocationSearchInput.tsx:381:       </div>
004773| NOTE: JSX markup for search UI.
004774| src/components/LocationSearchInput.tsx:382: 
004775| NOTE: Blank line for visual separation.
004776| src/components/LocationSearchInput.tsx:383:       {/* Suggestions dropdown */}
004777| NOTE: Implementation detail supporting search page behavior.
004778| src/components/LocationSearchInput.tsx:384:       {showSuggestions && suggestions.length > 0 && (
004779| NOTE: Implementation detail supporting search page behavior.
004780| src/components/LocationSearchInput.tsx:385:         <div
004781| NOTE: JSX markup for search UI.
004782| src/components/LocationSearchInput.tsx:386:           ref={suggestionsRef}
004783| NOTE: Implementation detail supporting search page behavior.
004784| src/components/LocationSearchInput.tsx:387:           className="absolute top-full left-0 right-0 mt-2 bg-white/95 dark:bg-zinc-900/95 backdrop-blur-xl rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.12)] dark:shadow-[0_8px_32px_rgba(0,0,0,0.4)] border border-zinc-200/80 dark:border-zinc-700/80 overflow-hidden z-dropdown min-w-[300px] animate-in fade-in-0 slide-in-from-top-2"
004785| NOTE: Tailwind classes define layout and styling.
004786| src/components/LocationSearchInput.tsx:388:         >
004787| NOTE: Implementation detail supporting search page behavior.
004788| src/components/LocationSearchInput.tsx:389:           <ul className="p-2">
004789| NOTE: Tailwind classes define layout and styling.
004790| src/components/LocationSearchInput.tsx:390:             {suggestions.map((suggestion, index) => (
004791| NOTE: Implementation detail supporting search page behavior.
004792| src/components/LocationSearchInput.tsx:391:               <li key={suggestion.id}>
004793| NOTE: JSX markup for search UI.
004794| src/components/LocationSearchInput.tsx:392:                 <button
004795| NOTE: JSX markup for search UI.
004796| src/components/LocationSearchInput.tsx:393:                   type="button"
004797| NOTE: Implementation detail supporting search page behavior.
004798| src/components/LocationSearchInput.tsx:394:                   onClick={() => handleSelectSuggestion(suggestion)}
004799| NOTE: Implementation detail supporting search page behavior.
004800| src/components/LocationSearchInput.tsx:395:                   className={`w-full px-3 py-2.5 flex items-start gap-3 rounded-xl transition-colors duration-150 text-left ${
004801| NOTE: Tailwind classes define layout and styling.
004802| src/components/LocationSearchInput.tsx:396:                     index === selectedIndex
004803| NOTE: Implementation detail supporting search page behavior.
004804| src/components/LocationSearchInput.tsx:397:                       ? "bg-zinc-100 dark:bg-zinc-800"
004805| NOTE: Implementation detail supporting search page behavior.
004806| src/components/LocationSearchInput.tsx:398:                       : "hover:bg-zinc-100/80 dark:hover:bg-zinc-800/80"
004807| NOTE: Implementation detail supporting search page behavior.
004808| src/components/LocationSearchInput.tsx:399:                   }`}
004809| NOTE: Implementation detail supporting search page behavior.
004810| src/components/LocationSearchInput.tsx:400:                 >
004811| NOTE: Implementation detail supporting search page behavior.
004812| src/components/LocationSearchInput.tsx:401:                   <MapPin
004813| NOTE: JSX markup for search UI.
004814| src/components/LocationSearchInput.tsx:402:                     className={`w-5 h-5 mt-0.5 flex-shrink-0 ${getPlaceTypeIcon(suggestion.place_type)}`}
004815| NOTE: Tailwind classes define layout and styling.
004816| src/components/LocationSearchInput.tsx:403:                   />
004817| NOTE: Implementation detail supporting search page behavior.
004818| src/components/LocationSearchInput.tsx:404:                   <div className="flex-1 min-w-0">
004819| NOTE: Tailwind classes define layout and styling.
004820| src/components/LocationSearchInput.tsx:405:                     <p className="text-sm font-medium text-zinc-900 dark:text-white truncate">
004821| NOTE: Tailwind classes define layout and styling.
004822| src/components/LocationSearchInput.tsx:406:                       {suggestion.place_name.split(",")[0]}
004823| NOTE: Implementation detail supporting search page behavior.
004824| src/components/LocationSearchInput.tsx:407:                     </p>
004825| NOTE: JSX markup for search UI.
004826| src/components/LocationSearchInput.tsx:408:                     <p className="text-xs text-zinc-500 dark:text-zinc-400 truncate">
004827| NOTE: Tailwind classes define layout and styling.
004828| src/components/LocationSearchInput.tsx:409:                       {suggestion.place_name
004829| NOTE: Implementation detail supporting search page behavior.
004830| src/components/LocationSearchInput.tsx:410:                         .split(",")
004831| NOTE: Implementation detail supporting search page behavior.
004832| src/components/LocationSearchInput.tsx:411:                         .slice(1)
004833| NOTE: Implementation detail supporting search page behavior.
004834| src/components/LocationSearchInput.tsx:412:                         .join(",")
004835| NOTE: Implementation detail supporting search page behavior.
004836| src/components/LocationSearchInput.tsx:413:                         .trim()}
004837| NOTE: Implementation detail supporting search page behavior.
004838| src/components/LocationSearchInput.tsx:414:                     </p>
004839| NOTE: JSX markup for search UI.
004840| src/components/LocationSearchInput.tsx:415:                   </div>
004841| NOTE: JSX markup for search UI.
004842| src/components/LocationSearchInput.tsx:416:                 </button>
004843| NOTE: JSX markup for search UI.
004844| src/components/LocationSearchInput.tsx:417:               </li>
004845| NOTE: JSX markup for search UI.
004846| src/components/LocationSearchInput.tsx:418:             ))}
004847| NOTE: Implementation detail supporting search page behavior.
004848| src/components/LocationSearchInput.tsx:419:           </ul>
004849| NOTE: JSX markup for search UI.
004850| src/components/LocationSearchInput.tsx:420:         </div>
004851| NOTE: JSX markup for search UI.
004852| src/components/LocationSearchInput.tsx:421:       )}
004853| NOTE: Implementation detail supporting search page behavior.
004854| src/components/LocationSearchInput.tsx:422: 
004855| NOTE: Blank line for visual separation.
004856| src/components/LocationSearchInput.tsx:423:       {/* Error state dropdown */}
004857| NOTE: Implementation detail supporting search page behavior.
004858| src/components/LocationSearchInput.tsx:424:       {showSuggestions && error && !isLoading && (
004859| NOTE: Implementation detail supporting search page behavior.
004860| src/components/LocationSearchInput.tsx:425:         <div
004861| NOTE: JSX markup for search UI.
004862| src/components/LocationSearchInput.tsx:426:           ref={suggestionsRef}
004863| NOTE: Implementation detail supporting search page behavior.
004864| src/components/LocationSearchInput.tsx:427:           className="absolute top-full left-0 right-0 mt-2 bg-white/95 dark:bg-zinc-900/95 backdrop-blur-xl rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.12)] dark:shadow-[0_8px_32px_rgba(0,0,0,0.4)] border border-zinc-200/80 dark:border-zinc-700/80 overflow-hidden z-dropdown min-w-[300px] animate-in fade-in-0 slide-in-from-top-2"
004865| NOTE: Tailwind classes define layout and styling.
004866| src/components/LocationSearchInput.tsx:428:         >
004867| NOTE: Implementation detail supporting search page behavior.
004868| src/components/LocationSearchInput.tsx:429:           <div className="p-4 flex items-center gap-3">
004869| NOTE: Tailwind classes define layout and styling.
004870| src/components/LocationSearchInput.tsx:430:             <div className="p-2 rounded-full bg-red-100 dark:bg-red-900/30">
004871| NOTE: Tailwind classes define layout and styling.
004872| src/components/LocationSearchInput.tsx:431:               <AlertCircle className="w-5 h-5 text-red-500 dark:text-red-400" />
004873| NOTE: Tailwind classes define layout and styling.
004874| src/components/LocationSearchInput.tsx:432:             </div>
004875| NOTE: JSX markup for search UI.
004876| src/components/LocationSearchInput.tsx:433:             <div>
004877| NOTE: JSX markup for search UI.
004878| src/components/LocationSearchInput.tsx:434:               <p className="text-sm font-medium text-red-700 dark:text-red-300">
004879| NOTE: Tailwind classes define layout and styling.
004880| src/components/LocationSearchInput.tsx:435:                 Search unavailable
004881| NOTE: Implementation detail supporting search page behavior.
004882| src/components/LocationSearchInput.tsx:436:               </p>
004883| NOTE: JSX markup for search UI.
004884| src/components/LocationSearchInput.tsx:437:               <p className="text-xs text-red-500 dark:text-red-400">{error}</p>
004885| NOTE: Tailwind classes define layout and styling.
004886| src/components/LocationSearchInput.tsx:438:             </div>
004887| NOTE: JSX markup for search UI.
004888| src/components/LocationSearchInput.tsx:439:           </div>
004889| NOTE: JSX markup for search UI.
004890| src/components/LocationSearchInput.tsx:440:         </div>
004891| NOTE: JSX markup for search UI.
004892| src/components/LocationSearchInput.tsx:441:       )}
004893| NOTE: Implementation detail supporting search page behavior.
004894| src/components/LocationSearchInput.tsx:442: 
004895| NOTE: Blank line for visual separation.
004896| src/components/LocationSearchInput.tsx:443:       {/* No results dropdown */}
004897| NOTE: Implementation detail supporting search page behavior.
004898| src/components/LocationSearchInput.tsx:444:       {showSuggestions &&
004899| NOTE: Implementation detail supporting search page behavior.
004900| src/components/LocationSearchInput.tsx:445:         noResults &&
004901| NOTE: Implementation detail supporting search page behavior.
004902| src/components/LocationSearchInput.tsx:446:         !error &&
004903| NOTE: Implementation detail supporting search page behavior.
004904| src/components/LocationSearchInput.tsx:447:         !isLoading &&
004905| NOTE: Implementation detail supporting search page behavior.
004906| src/components/LocationSearchInput.tsx:448:         suggestions.length === 0 && (
004907| NOTE: Implementation detail supporting search page behavior.
004908| src/components/LocationSearchInput.tsx:449:           <div
004909| NOTE: JSX markup for search UI.
004910| src/components/LocationSearchInput.tsx:450:             ref={suggestionsRef}
004911| NOTE: Implementation detail supporting search page behavior.
004912| src/components/LocationSearchInput.tsx:451:             className="absolute top-full left-0 right-0 mt-2 bg-white/95 dark:bg-zinc-900/95 backdrop-blur-xl rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.12)] dark:shadow-[0_8px_32px_rgba(0,0,0,0.4)] border border-zinc-200/80 dark:border-zinc-700/80 overflow-hidden z-dropdown min-w-[300px] animate-in fade-in-0 slide-in-from-top-2"
004913| NOTE: Tailwind classes define layout and styling.
004914| src/components/LocationSearchInput.tsx:452:           >
004915| NOTE: Implementation detail supporting search page behavior.
004916| src/components/LocationSearchInput.tsx:453:             <div className="p-4 flex items-center gap-3">
004917| NOTE: Tailwind classes define layout and styling.
004918| src/components/LocationSearchInput.tsx:454:               <div className="p-2 rounded-full bg-zinc-100 dark:bg-zinc-800">
004919| NOTE: Tailwind classes define layout and styling.
004920| src/components/LocationSearchInput.tsx:455:                 <SearchX className="w-5 h-5 text-zinc-400 dark:text-zinc-500" />
004921| NOTE: Tailwind classes define layout and styling.
004922| src/components/LocationSearchInput.tsx:456:               </div>
004923| NOTE: JSX markup for search UI.
004924| src/components/LocationSearchInput.tsx:457:               <div>
004925| NOTE: JSX markup for search UI.
004926| src/components/LocationSearchInput.tsx:458:                 <p className="text-sm font-medium text-zinc-700 dark:text-zinc-300">
004927| NOTE: Tailwind classes define layout and styling.
004928| src/components/LocationSearchInput.tsx:459:                   No locations found
004929| NOTE: Implementation detail supporting search page behavior.
004930| src/components/LocationSearchInput.tsx:460:                 </p>
004931| NOTE: JSX markup for search UI.
004932| src/components/LocationSearchInput.tsx:461:                 <p className="text-xs text-zinc-500 dark:text-zinc-400">
004933| NOTE: Tailwind classes define layout and styling.
004934| src/components/LocationSearchInput.tsx:462:                   Try a different city or neighborhood name
004935| NOTE: Implementation detail supporting search page behavior.
004936| src/components/LocationSearchInput.tsx:463:                 </p>
004937| NOTE: JSX markup for search UI.
004938| src/components/LocationSearchInput.tsx:464:               </div>
004939| NOTE: JSX markup for search UI.
004940| src/components/LocationSearchInput.tsx:465:             </div>
004941| NOTE: JSX markup for search UI.
004942| src/components/LocationSearchInput.tsx:466:           </div>
004943| NOTE: JSX markup for search UI.
004944| src/components/LocationSearchInput.tsx:467:         )}
004945| NOTE: Implementation detail supporting search page behavior.
004946| src/components/LocationSearchInput.tsx:468:     </div>
004947| NOTE: JSX markup for search UI.
004948| src/components/LocationSearchInput.tsx:469:   );
004949| NOTE: Implementation detail supporting search page behavior.
004950| src/components/LocationSearchInput.tsx:470: });
004951| NOTE: Implementation detail supporting search page behavior.
004952| src/components/LocationSearchInput.tsx:471: 
004953| NOTE: Blank line for visual separation.
004954| src/components/LocationSearchInput.tsx:472: export default LocationSearchInput;
004955| NOTE: Implementation detail supporting search page behavior.
004956| FILE END: src/components/LocationSearchInput.tsx
004957| 
004958| FILE START: src/components/LowResultsGuidance.tsx
004959| FILE ROLE: Auto-discovered dependency in search page graph.
004960| src/components/LowResultsGuidance.tsx:1: "use client";
004961| NOTE: Implementation detail supporting search page behavior.
004962| src/components/LowResultsGuidance.tsx:2: 
004963| NOTE: Blank line for visual separation.
004964| src/components/LowResultsGuidance.tsx:3: /**
004965| NOTE: Block comment line describing behavior or context.
004966| src/components/LowResultsGuidance.tsx:4:  * LowResultsGuidance - Guidance panel for low search results
004967| NOTE: Block comment line describing behavior or context.
004968| src/components/LowResultsGuidance.tsx:5:  *
004969| NOTE: Block comment line describing behavior or context.
004970| src/components/LowResultsGuidance.tsx:6:  * Displays when search returns fewer than 5 results.
004971| NOTE: Block comment line describing behavior or context.
004972| src/components/LowResultsGuidance.tsx:7:  * Shows filter suggestions and an "Include near matches" toggle.
004973| NOTE: Block comment line describing behavior or context.
004974| src/components/LowResultsGuidance.tsx:8:  */
004975| NOTE: Block comment line describing behavior or context.
004976| src/components/LowResultsGuidance.tsx:9: 
004977| NOTE: Blank line for visual separation.
004978| src/components/LowResultsGuidance.tsx:10: import { useRouter, useSearchParams } from "next/navigation";
004979| NOTE: Imports dependency for this module.
004980| src/components/LowResultsGuidance.tsx:11: import { useCallback, useTransition } from "react";
004981| NOTE: Imports dependency for this module.
004982| src/components/LowResultsGuidance.tsx:12: import { Button } from "@/components/ui/button";
004983| NOTE: Imports dependency for this module.
004984| src/components/LowResultsGuidance.tsx:13: import { Lightbulb, Sparkles, ChevronRight } from "lucide-react";
004985| NOTE: Imports dependency for this module.
004986| src/components/LowResultsGuidance.tsx:14: import type { FilterParams } from "@/lib/search-params";
004987| NOTE: Imports dependency for this module.
004988| src/components/LowResultsGuidance.tsx:15: import {
004989| NOTE: Imports dependency for this module.
004990| src/components/LowResultsGuidance.tsx:16:   LOW_RESULTS_THRESHOLD,
004991| NOTE: Implementation detail supporting search page behavior.
004992| src/components/LowResultsGuidance.tsx:17:   generateFilterSuggestions,
004993| NOTE: Implementation detail supporting search page behavior.
004994| src/components/LowResultsGuidance.tsx:18:   type FilterSuggestion,
004995| NOTE: Type declaration for search data contracts.
004996| src/components/LowResultsGuidance.tsx:19: } from "@/lib/near-matches";
004997| NOTE: Implementation detail supporting search page behavior.
004998| src/components/LowResultsGuidance.tsx:20: 
004999| NOTE: Blank line for visual separation.
005000| src/components/LowResultsGuidance.tsx:21: interface LowResultsGuidanceProps {
005001| NOTE: Type declaration for search data contracts.
005002| src/components/LowResultsGuidance.tsx:22:   /** Current result count */
005003| NOTE: Block comment line describing behavior or context.
005004| src/components/LowResultsGuidance.tsx:23:   resultCount: number;
005005| NOTE: Implementation detail supporting search page behavior.
005006| src/components/LowResultsGuidance.tsx:24:   /** Current filter parameters */
005007| NOTE: Block comment line describing behavior or context.
005008| src/components/LowResultsGuidance.tsx:25:   filterParams: FilterParams;
005009| NOTE: Implementation detail supporting search page behavior.
005010| src/components/LowResultsGuidance.tsx:26:   /** Whether near matches are currently enabled */
005011| NOTE: Block comment line describing behavior or context.
005012| src/components/LowResultsGuidance.tsx:27:   nearMatchesEnabled: boolean;
005013| NOTE: Implementation detail supporting search page behavior.
005014| src/components/LowResultsGuidance.tsx:28:   /** Optional: Count of near-match results available */
005015| NOTE: Block comment line describing behavior or context.
005016| src/components/LowResultsGuidance.tsx:29:   nearMatchCount?: number;
005017| NOTE: Implementation detail supporting search page behavior.
005018| src/components/LowResultsGuidance.tsx:30: }
005019| NOTE: Implementation detail supporting search page behavior.
005020| src/components/LowResultsGuidance.tsx:31: 
005021| NOTE: Blank line for visual separation.
005022| src/components/LowResultsGuidance.tsx:32: export function LowResultsGuidance({
005023| NOTE: Exports helper or component function.
005024| src/components/LowResultsGuidance.tsx:33:   resultCount,
005025| NOTE: Implementation detail supporting search page behavior.
005026| src/components/LowResultsGuidance.tsx:34:   filterParams,
005027| NOTE: Implementation detail supporting search page behavior.
005028| src/components/LowResultsGuidance.tsx:35:   nearMatchesEnabled,
005029| NOTE: Implementation detail supporting search page behavior.
005030| src/components/LowResultsGuidance.tsx:36:   nearMatchCount,
005031| NOTE: Implementation detail supporting search page behavior.
005032| src/components/LowResultsGuidance.tsx:37: }: LowResultsGuidanceProps) {
005033| NOTE: Implementation detail supporting search page behavior.
005034| src/components/LowResultsGuidance.tsx:38:   const router = useRouter();
005035| NOTE: Local declaration used by search logic or UI.
005036| src/components/LowResultsGuidance.tsx:39:   const searchParams = useSearchParams();
005037| NOTE: Local declaration used by search logic or UI.
005038| src/components/LowResultsGuidance.tsx:40:   const [isPending, startTransition] = useTransition();
005039| NOTE: Local declaration used by search logic or UI.
005040| src/components/LowResultsGuidance.tsx:41: 
005041| NOTE: Blank line for visual separation.
005042| src/components/LowResultsGuidance.tsx:42:   // Handle toggle near matches - must be defined before early returns (Rules of Hooks)
005043| NOTE: Line comment documents intent or constraints.
005044| src/components/LowResultsGuidance.tsx:43:   const handleToggleNearMatches = useCallback(() => {
005045| NOTE: Memoizes callback to preserve references across renders.
005046| src/components/LowResultsGuidance.tsx:44:     startTransition(() => {
005047| NOTE: Implementation detail supporting search page behavior.
005048| src/components/LowResultsGuidance.tsx:45:       const params = new URLSearchParams(searchParams.toString());
005049| NOTE: Local declaration used by search logic or UI.
005050| src/components/LowResultsGuidance.tsx:46:       params.set("nearMatches", "1");
005051| NOTE: Implementation detail supporting search page behavior.
005052| src/components/LowResultsGuidance.tsx:47:       // Reset to page 1 when enabling near matches
005053| NOTE: Line comment documents intent or constraints.
005054| src/components/LowResultsGuidance.tsx:48:       params.delete("page");
005055| NOTE: Implementation detail supporting search page behavior.
005056| src/components/LowResultsGuidance.tsx:49:       router.push(`/search?${params.toString()}`, { scroll: false });
005057| NOTE: Routing logic updates search URL state.
005058| src/components/LowResultsGuidance.tsx:50:     });
005059| NOTE: Implementation detail supporting search page behavior.
005060| src/components/LowResultsGuidance.tsx:51:   }, [router, searchParams]);
005061| NOTE: Implementation detail supporting search page behavior.
005062| src/components/LowResultsGuidance.tsx:52: 
005063| NOTE: Blank line for visual separation.
005064| src/components/LowResultsGuidance.tsx:53:   // Handle suggestion click - remove the filter
005065| NOTE: Line comment documents intent or constraints.
005066| src/components/LowResultsGuidance.tsx:54:   const handleSuggestionClick = useCallback(
005067| NOTE: Memoizes callback to preserve references across renders.
005068| src/components/LowResultsGuidance.tsx:55:     (suggestion: FilterSuggestion) => {
005069| NOTE: Implementation detail supporting search page behavior.
005070| src/components/LowResultsGuidance.tsx:56:       startTransition(() => {
005071| NOTE: Implementation detail supporting search page behavior.
005072| src/components/LowResultsGuidance.tsx:57:         const params = new URLSearchParams(searchParams.toString());
005073| NOTE: Local declaration used by search logic or UI.
005074| src/components/LowResultsGuidance.tsx:58: 
005075| NOTE: Blank line for visual separation.
005076| src/components/LowResultsGuidance.tsx:59:         switch (suggestion.type) {
005077| NOTE: Implementation detail supporting search page behavior.
005078| src/components/LowResultsGuidance.tsx:60:           case "price":
005079| NOTE: Implementation detail supporting search page behavior.
005080| src/components/LowResultsGuidance.tsx:61:             params.delete("minPrice");
005081| NOTE: Implementation detail supporting search page behavior.
005082| src/components/LowResultsGuidance.tsx:62:             params.delete("maxPrice");
005083| NOTE: Implementation detail supporting search page behavior.
005084| src/components/LowResultsGuidance.tsx:63:             break;
005085| NOTE: Implementation detail supporting search page behavior.
005086| src/components/LowResultsGuidance.tsx:64:           case "date":
005087| NOTE: Implementation detail supporting search page behavior.
005088| src/components/LowResultsGuidance.tsx:65:             params.delete("moveInDate");
005089| NOTE: Implementation detail supporting search page behavior.
005090| src/components/LowResultsGuidance.tsx:66:             break;
005091| NOTE: Implementation detail supporting search page behavior.
005092| src/components/LowResultsGuidance.tsx:67:           case "roomType":
005093| NOTE: Implementation detail supporting search page behavior.
005094| src/components/LowResultsGuidance.tsx:68:             params.delete("roomType");
005095| NOTE: Implementation detail supporting search page behavior.
005096| src/components/LowResultsGuidance.tsx:69:             break;
005097| NOTE: Implementation detail supporting search page behavior.
005098| src/components/LowResultsGuidance.tsx:70:           case "amenities":
005099| NOTE: Implementation detail supporting search page behavior.
005100| src/components/LowResultsGuidance.tsx:71:             params.delete("amenities");
005101| NOTE: Implementation detail supporting search page behavior.
005102| src/components/LowResultsGuidance.tsx:72:             break;
005103| NOTE: Implementation detail supporting search page behavior.
005104| src/components/LowResultsGuidance.tsx:73:           case "leaseDuration":
005105| NOTE: Implementation detail supporting search page behavior.
005106| src/components/LowResultsGuidance.tsx:74:             params.delete("leaseDuration");
005107| NOTE: Implementation detail supporting search page behavior.
005108| src/components/LowResultsGuidance.tsx:75:             break;
005109| NOTE: Implementation detail supporting search page behavior.
005110| src/components/LowResultsGuidance.tsx:76:         }
005111| NOTE: Implementation detail supporting search page behavior.
005112| src/components/LowResultsGuidance.tsx:77: 
005113| NOTE: Blank line for visual separation.
005114| src/components/LowResultsGuidance.tsx:78:         // Reset to page 1 when changing filters
005115| NOTE: Line comment documents intent or constraints.
005116| src/components/LowResultsGuidance.tsx:79:         params.delete("page");
005117| NOTE: Implementation detail supporting search page behavior.
005118| src/components/LowResultsGuidance.tsx:80:         router.push(`/search?${params.toString()}`, { scroll: false });
005119| NOTE: Routing logic updates search URL state.
005120| src/components/LowResultsGuidance.tsx:81:       });
005121| NOTE: Implementation detail supporting search page behavior.
005122| src/components/LowResultsGuidance.tsx:82:     },
005123| NOTE: Implementation detail supporting search page behavior.
005124| src/components/LowResultsGuidance.tsx:83:     [router, searchParams],
005125| NOTE: Implementation detail supporting search page behavior.
005126| src/components/LowResultsGuidance.tsx:84:   );
005127| NOTE: Implementation detail supporting search page behavior.
005128| src/components/LowResultsGuidance.tsx:85: 
005129| NOTE: Blank line for visual separation.
005130| src/components/LowResultsGuidance.tsx:86:   // Don't show if we have enough results or no results at all
005131| NOTE: Line comment documents intent or constraints.
005132| src/components/LowResultsGuidance.tsx:87:   if (resultCount >= LOW_RESULTS_THRESHOLD || resultCount === 0) {
005133| NOTE: Conditional logic controlling rendering or flow.
005134| src/components/LowResultsGuidance.tsx:88:     return null;
005135| NOTE: Return statement for component or helper output.
005136| src/components/LowResultsGuidance.tsx:89:   }
005137| NOTE: Implementation detail supporting search page behavior.
005138| src/components/LowResultsGuidance.tsx:90: 
005139| NOTE: Blank line for visual separation.
005140| src/components/LowResultsGuidance.tsx:91:   // Don't show if near matches are already enabled
005141| NOTE: Line comment documents intent or constraints.
005142| src/components/LowResultsGuidance.tsx:92:   if (nearMatchesEnabled) {
005143| NOTE: Conditional logic controlling rendering or flow.
005144| src/components/LowResultsGuidance.tsx:93:     return null;
005145| NOTE: Return statement for component or helper output.
005146| src/components/LowResultsGuidance.tsx:94:   }
005147| NOTE: Implementation detail supporting search page behavior.
005148| src/components/LowResultsGuidance.tsx:95: 
005149| NOTE: Blank line for visual separation.
005150| src/components/LowResultsGuidance.tsx:96:   const suggestions = generateFilterSuggestions(filterParams, resultCount);
005151| NOTE: Local declaration used by search logic or UI.
005152| src/components/LowResultsGuidance.tsx:97: 
005153| NOTE: Blank line for visual separation.
005154| src/components/LowResultsGuidance.tsx:98:   return (
005155| NOTE: Return statement for component or helper output.
005156| src/components/LowResultsGuidance.tsx:99:     <div className="mb-6 rounded-lg border border-amber-200 bg-amber-50 p-4 dark:border-amber-800 dark:bg-amber-950/30">
005157| NOTE: Tailwind classes define layout and styling.
005158| src/components/LowResultsGuidance.tsx:100:       <div className="flex items-start gap-3">
005159| NOTE: Tailwind classes define layout and styling.
005160| src/components/LowResultsGuidance.tsx:101:         <div className="flex-shrink-0 rounded-full bg-amber-100 p-2 dark:bg-amber-900/50">
005161| NOTE: Tailwind classes define layout and styling.
005162| src/components/LowResultsGuidance.tsx:102:           <Lightbulb className="h-5 w-5 text-amber-600 dark:text-amber-400" />
005163| NOTE: Tailwind classes define layout and styling.
005164| src/components/LowResultsGuidance.tsx:103:         </div>
005165| NOTE: JSX markup for search UI.
005166| src/components/LowResultsGuidance.tsx:104: 
005167| NOTE: Blank line for visual separation.
005168| src/components/LowResultsGuidance.tsx:105:         <div className="flex-1 min-w-0">
005169| NOTE: Tailwind classes define layout and styling.
005170| src/components/LowResultsGuidance.tsx:106:           <h3 className="text-sm font-medium text-amber-900 dark:text-amber-100">
005171| NOTE: Tailwind classes define layout and styling.
005172| src/components/LowResultsGuidance.tsx:107:             Only {resultCount} {resultCount === 1 ? "listing" : "listings"}{" "}
005173| NOTE: Implementation detail supporting search page behavior.
005174| src/components/LowResultsGuidance.tsx:108:             found
005175| NOTE: Implementation detail supporting search page behavior.
005176| src/components/LowResultsGuidance.tsx:109:           </h3>
005177| NOTE: JSX markup for search UI.
005178| src/components/LowResultsGuidance.tsx:110: 
005179| NOTE: Blank line for visual separation.
005180| src/components/LowResultsGuidance.tsx:111:           <p className="mt-1 text-sm text-amber-700 dark:text-amber-300">
005181| NOTE: Tailwind classes define layout and styling.
005182| src/components/LowResultsGuidance.tsx:112:             Try adjusting your filters to see more options:
005183| NOTE: Implementation detail supporting search page behavior.
005184| src/components/LowResultsGuidance.tsx:113:           </p>
005185| NOTE: JSX markup for search UI.
005186| src/components/LowResultsGuidance.tsx:114: 
005187| NOTE: Blank line for visual separation.
005188| src/components/LowResultsGuidance.tsx:115:           {/* Filter suggestions */}
005189| NOTE: Implementation detail supporting search page behavior.
005190| src/components/LowResultsGuidance.tsx:116:           {suggestions.length > 0 && (
005191| NOTE: Implementation detail supporting search page behavior.
005192| src/components/LowResultsGuidance.tsx:117:             <div className="mt-3 flex flex-wrap gap-2">
005193| NOTE: Tailwind classes define layout and styling.
005194| src/components/LowResultsGuidance.tsx:118:               {suggestions.map((suggestion) => (
005195| NOTE: Implementation detail supporting search page behavior.
005196| src/components/LowResultsGuidance.tsx:119:                 <button
005197| NOTE: JSX markup for search UI.
005198| src/components/LowResultsGuidance.tsx:120:                   key={suggestion.type}
005199| NOTE: Implementation detail supporting search page behavior.
005200| src/components/LowResultsGuidance.tsx:121:                   onClick={() => handleSuggestionClick(suggestion)}
005201| NOTE: Implementation detail supporting search page behavior.
005202| src/components/LowResultsGuidance.tsx:122:                   disabled={isPending}
005203| NOTE: Implementation detail supporting search page behavior.
005204| src/components/LowResultsGuidance.tsx:123:                   className="inline-flex items-center gap-1 rounded-full border border-amber-300 bg-white px-3 py-1.5 text-xs font-medium text-amber-800 transition-colors hover:bg-amber-100 disabled:opacity-50 dark:border-amber-700 dark:bg-amber-900/50 dark:text-amber-200 dark:hover:bg-amber-800/50"
005205| NOTE: Tailwind classes define layout and styling.
005206| src/components/LowResultsGuidance.tsx:124:                 >
005207| NOTE: Implementation detail supporting search page behavior.
005208| src/components/LowResultsGuidance.tsx:125:                   {suggestion.label}
005209| NOTE: Implementation detail supporting search page behavior.
005210| src/components/LowResultsGuidance.tsx:126:                   <ChevronRight className="h-3 w-3" />
005211| NOTE: Tailwind classes define layout and styling.
005212| src/components/LowResultsGuidance.tsx:127:                 </button>
005213| NOTE: JSX markup for search UI.
005214| src/components/LowResultsGuidance.tsx:128:               ))}
005215| NOTE: Implementation detail supporting search page behavior.
005216| src/components/LowResultsGuidance.tsx:129:             </div>
005217| NOTE: JSX markup for search UI.
005218| src/components/LowResultsGuidance.tsx:130:           )}
005219| NOTE: Implementation detail supporting search page behavior.
005220| src/components/LowResultsGuidance.tsx:131: 
005221| NOTE: Blank line for visual separation.
005222| src/components/LowResultsGuidance.tsx:132:           {/* Near matches toggle */}
005223| NOTE: Implementation detail supporting search page behavior.
005224| src/components/LowResultsGuidance.tsx:133:           <div className="mt-4 border-t border-amber-200 pt-4 dark:border-amber-800">
005225| NOTE: Tailwind classes define layout and styling.
005226| src/components/LowResultsGuidance.tsx:134:             <Button
005227| NOTE: JSX markup for search UI.
005228| src/components/LowResultsGuidance.tsx:135:               onClick={handleToggleNearMatches}
005229| NOTE: Implementation detail supporting search page behavior.
005230| src/components/LowResultsGuidance.tsx:136:               disabled={isPending}
005231| NOTE: Implementation detail supporting search page behavior.
005232| src/components/LowResultsGuidance.tsx:137:               variant="outline"
005233| NOTE: Implementation detail supporting search page behavior.
005234| src/components/LowResultsGuidance.tsx:138:               size="sm"
005235| NOTE: Implementation detail supporting search page behavior.
005236| src/components/LowResultsGuidance.tsx:139:               className="group border-amber-400 bg-white text-amber-800 hover:bg-amber-100 hover:text-amber-900 dark:border-amber-600 dark:bg-amber-900/50 dark:text-amber-200 dark:hover:bg-amber-800/50"
005237| NOTE: Tailwind classes define layout and styling.
005238| src/components/LowResultsGuidance.tsx:140:             >
005239| NOTE: Implementation detail supporting search page behavior.
005240| src/components/LowResultsGuidance.tsx:141:               <Sparkles className="mr-2 h-4 w-4 text-amber-500 group-hover:text-amber-600" />
005241| NOTE: Tailwind classes define layout and styling.
005242| src/components/LowResultsGuidance.tsx:142:               Include near matches
005243| NOTE: Implementation detail supporting search page behavior.
005244| src/components/LowResultsGuidance.tsx:143:               {nearMatchCount !== undefined && nearMatchCount > 0 && (
005245| NOTE: Implementation detail supporting search page behavior.
005246| src/components/LowResultsGuidance.tsx:144:                 <span className="ml-2 rounded-full bg-amber-200 px-2 py-0.5 text-xs font-semibold text-amber-800 dark:bg-amber-800 dark:text-amber-200">
005247| NOTE: Tailwind classes define layout and styling.
005248| src/components/LowResultsGuidance.tsx:145:                   +{nearMatchCount}
005249| NOTE: Implementation detail supporting search page behavior.
005250| src/components/LowResultsGuidance.tsx:146:                 </span>
005251| NOTE: JSX markup for search UI.
005252| src/components/LowResultsGuidance.tsx:147:               )}
005253| NOTE: Implementation detail supporting search page behavior.
005254| src/components/LowResultsGuidance.tsx:148:             </Button>
005255| NOTE: JSX markup for search UI.
005256| src/components/LowResultsGuidance.tsx:149:             <p className="mt-2 text-xs text-amber-600 dark:text-amber-400">
005257| NOTE: Tailwind classes define layout and styling.
005258| src/components/LowResultsGuidance.tsx:150:               See listings that almost match your filters (slightly outside
005259| NOTE: Implementation detail supporting search page behavior.
005260| src/components/LowResultsGuidance.tsx:151:               price or date range)
005261| NOTE: Implementation detail supporting search page behavior.
005262| src/components/LowResultsGuidance.tsx:152:             </p>
005263| NOTE: JSX markup for search UI.
005264| src/components/LowResultsGuidance.tsx:153:           </div>
005265| NOTE: JSX markup for search UI.
005266| src/components/LowResultsGuidance.tsx:154:         </div>
005267| NOTE: JSX markup for search UI.
005268| src/components/LowResultsGuidance.tsx:155:       </div>
005269| NOTE: JSX markup for search UI.
005270| src/components/LowResultsGuidance.tsx:156:     </div>
005271| NOTE: JSX markup for search UI.
005272| src/components/LowResultsGuidance.tsx:157:   );
005273| NOTE: Implementation detail supporting search page behavior.
005274| src/components/LowResultsGuidance.tsx:158: }
005275| NOTE: Implementation detail supporting search page behavior.
005276| FILE END: src/components/LowResultsGuidance.tsx
005277| 
005278| FILE START: src/components/Map.tsx
005279| FILE ROLE: Mapbox-based map rendering, clustering, and list/map sync.
005280| src/components/Map.tsx:1: "use client";
005281| NOTE: Implementation detail supporting search page behavior.
005282| src/components/Map.tsx:2: 
005283| NOTE: Blank line for visual separation.
005284| src/components/Map.tsx:3: /**
005285| NOTE: Block comment line describing behavior or context.
005286| src/components/Map.tsx:4:  * Map Component for displaying listings with marker clustering
005287| NOTE: Block comment line describing behavior or context.
005288| src/components/Map.tsx:5:  *
005289| NOTE: Block comment line describing behavior or context.
005290| src/components/Map.tsx:6:  * Uses Mapbox GL JS built-in clustering for performance optimization.
005291| NOTE: Block comment line describing behavior or context.
005292| src/components/Map.tsx:7:  * - Clustered points show as circles with count
005293| NOTE: Block comment line describing behavior or context.
005294| src/components/Map.tsx:8:  * - Individual points show custom price markers
005295| NOTE: Block comment line describing behavior or context.
005296| src/components/Map.tsx:9:  * - Click cluster to zoom and expand
005297| NOTE: Block comment line describing behavior or context.
005298| src/components/Map.tsx:10:  */
005299| NOTE: Block comment line describing behavior or context.
005300| src/components/Map.tsx:11: 
005301| NOTE: Blank line for visual separation.
005302| src/components/Map.tsx:12: import "@/lib/mapbox-init"; // Must be first - initializes worker
005303| NOTE: Imports dependency for this module.
005304| src/components/Map.tsx:13: import MapGL, {
005305| NOTE: Imports dependency for this module.
005306| src/components/Map.tsx:14:   Marker,
005307| NOTE: Implementation detail supporting search page behavior.
005308| src/components/Map.tsx:15:   Popup,
005309| NOTE: Implementation detail supporting search page behavior.
005310| src/components/Map.tsx:16:   Source,
005311| NOTE: Implementation detail supporting search page behavior.
005312| src/components/Map.tsx:17:   Layer,
005313| NOTE: Implementation detail supporting search page behavior.
005314| src/components/Map.tsx:18:   MapLayerMouseEvent,
005315| NOTE: Implementation detail supporting search page behavior.
005316| src/components/Map.tsx:19:   ViewStateChangeEvent,
005317| NOTE: Implementation detail supporting search page behavior.
005318| src/components/Map.tsx:20: } from "react-map-gl";
005319| NOTE: Implementation detail supporting search page behavior.
005320| src/components/Map.tsx:21: import type { LayerProps, GeoJSONSource } from "react-map-gl";
005321| NOTE: Imports dependency for this module.
005322| src/components/Map.tsx:22: import "mapbox-gl/dist/mapbox-gl.css";
005323| NOTE: Imports dependency for this module.
005324| src/components/Map.tsx:23: import { useState, useMemo, useRef, useEffect, useCallback } from "react";
005325| NOTE: Imports dependency for this module.
005326| src/components/Map.tsx:24: import Link from "next/link";
005327| NOTE: Imports dependency for this module.
005328| src/components/Map.tsx:25: import Image from "next/image";
005329| NOTE: Imports dependency for this module.
005330| src/components/Map.tsx:26: import { useRouter, useSearchParams } from "next/navigation";
005331| NOTE: Imports dependency for this module.
005332| src/components/Map.tsx:27: import { Home, Loader2, MapPin, X } from "lucide-react";
005333| NOTE: Imports dependency for this module.
005334| src/components/Map.tsx:28: import { Button } from "./ui/button";
005335| NOTE: Imports dependency for this module.
005336| src/components/Map.tsx:29: import { Checkbox } from "./ui/checkbox";
005337| NOTE: Imports dependency for this module.
005338| src/components/Map.tsx:30: import { MAP_FLY_TO_EVENT, MapFlyToEventDetail } from "./SearchForm";
005339| NOTE: Imports dependency for this module.
005340| src/components/Map.tsx:31: import {
005341| NOTE: Imports dependency for this module.
005342| src/components/Map.tsx:32:   groupListingsByCoord,
005343| NOTE: Implementation detail supporting search page behavior.
005344| src/components/Map.tsx:33:   formatStackPriceRange,
005345| NOTE: Implementation detail supporting search page behavior.
005346| src/components/Map.tsx:34:   computeTieredGroups,
005347| NOTE: Implementation detail supporting search page behavior.
005348| src/components/Map.tsx:35:   buildRankMap,
005349| NOTE: Implementation detail supporting search page behavior.
005350| src/components/Map.tsx:36:   getBestListingInGroup,
005351| NOTE: Implementation detail supporting search page behavior.
005352| src/components/Map.tsx:37:   getPrimaryPinLimit,
005353| NOTE: Implementation detail supporting search page behavior.
005354| src/components/Map.tsx:38:   type ListingGroup,
005355| NOTE: Type declaration for search data contracts.
005356| src/components/Map.tsx:39:   type TieredGroup,
005357| NOTE: Type declaration for search data contracts.
005358| src/components/Map.tsx:40: } from "@/lib/maps/marker-utils";
005359| NOTE: Implementation detail supporting search page behavior.
005360| src/components/Map.tsx:41: import { StackedListingPopup } from "./map/StackedListingPopup";
005361| NOTE: Imports dependency for this module.
005362| src/components/Map.tsx:42: import { MapMovedBanner } from "./map/MapMovedBanner";
005363| NOTE: Imports dependency for this module.
005364| src/components/Map.tsx:43: import { useMapBounds } from "@/contexts/MapBoundsContext";
005365| NOTE: Imports dependency for this module.
005366| src/components/Map.tsx:44: import { useListingFocus } from "@/contexts/ListingFocusContext";
005367| NOTE: Imports dependency for this module.
005368| src/components/Map.tsx:45: import { useSearchMapUI } from "@/contexts/SearchMapUIContext";
005369| NOTE: Imports dependency for this module.
005370| src/components/Map.tsx:46: import type { V2MapData } from "@/contexts/SearchV2DataContext";
005371| NOTE: Imports dependency for this module.
005372| src/components/Map.tsx:47: 
005373| NOTE: Blank line for visual separation.
005374| src/components/Map.tsx:48: interface Listing {
005375| NOTE: Type declaration for search data contracts.
005376| src/components/Map.tsx:49:   id: string;
005377| NOTE: Implementation detail supporting search page behavior.
005378| src/components/Map.tsx:50:   title: string;
005379| NOTE: Implementation detail supporting search page behavior.
005380| src/components/Map.tsx:51:   price: number;
005381| NOTE: Implementation detail supporting search page behavior.
005382| src/components/Map.tsx:52:   availableSlots: number;
005383| NOTE: Implementation detail supporting search page behavior.
005384| src/components/Map.tsx:53:   ownerId?: string;
005385| NOTE: Implementation detail supporting search page behavior.
005386| src/components/Map.tsx:54:   images?: string[];
005387| NOTE: Implementation detail supporting search page behavior.
005388| src/components/Map.tsx:55:   location: {
005389| NOTE: Implementation detail supporting search page behavior.
005390| src/components/Map.tsx:56:     lat: number;
005391| NOTE: Implementation detail supporting search page behavior.
005392| src/components/Map.tsx:57:     lng: number;
005393| NOTE: Implementation detail supporting search page behavior.
005394| src/components/Map.tsx:58:   };
005395| NOTE: Implementation detail supporting search page behavior.
005396| src/components/Map.tsx:59: }
005397| NOTE: Implementation detail supporting search page behavior.
005398| src/components/Map.tsx:60: 
005399| NOTE: Blank line for visual separation.
005400| src/components/Map.tsx:61: interface MapComponentProps {
005401| NOTE: Type declaration for search data contracts.
005402| src/components/Map.tsx:62:   /** Listings for v1 path (client-fetched from /api/map-listings) */
005403| NOTE: Block comment line describing behavior or context.
005404| src/components/Map.tsx:63:   listings?: Listing[];
005405| NOTE: Implementation detail supporting search page behavior.
005406| src/components/Map.tsx:64:   /** V2 map data from unified search response (server-provided via context) */
005407| NOTE: Block comment line describing behavior or context.
005408| src/components/Map.tsx:65:   v2MapData?: V2MapData | null;
005409| NOTE: Implementation detail supporting search page behavior.
005410| src/components/Map.tsx:66: }
005411| NOTE: Implementation detail supporting search page behavior.
005412| src/components/Map.tsx:67: 
005413| NOTE: Blank line for visual separation.
005414| src/components/Map.tsx:68: // Mapbox Layer Colors - Synced with Tailwind Zinc Palette
005415| NOTE: Line comment documents intent or constraints.
005416| src/components/Map.tsx:69: const MAP_COLORS = {
005417| NOTE: Local declaration used by search logic or UI.
005418| src/components/Map.tsx:70:   zinc900: "#18181b",
005419| NOTE: Implementation detail supporting search page behavior.
005420| src/components/Map.tsx:71:   white: "#ffffff",
005421| NOTE: Implementation detail supporting search page behavior.
005422| src/components/Map.tsx:72:   zinc800: "#27272a",
005423| NOTE: Implementation detail supporting search page behavior.
005424| src/components/Map.tsx:73: };
005425| NOTE: Implementation detail supporting search page behavior.
005426| src/components/Map.tsx:74: 
005427| NOTE: Blank line for visual separation.
005428| src/components/Map.tsx:75: // Cluster layer - circles for grouped markers
005429| NOTE: Line comment documents intent or constraints.
005430| src/components/Map.tsx:76: // Note: No 'source' property - Layer inherits from parent Source component
005431| NOTE: Line comment documents intent or constraints.
005432| src/components/Map.tsx:77: const clusterLayer: LayerProps = {
005433| NOTE: Local declaration used by search logic or UI.
005434| src/components/Map.tsx:78:   id: "clusters",
005435| NOTE: Implementation detail supporting search page behavior.
005436| src/components/Map.tsx:79:   type: "circle",
005437| NOTE: Implementation detail supporting search page behavior.
005438| src/components/Map.tsx:80:   filter: ["has", "point_count"],
005439| NOTE: Implementation detail supporting search page behavior.
005440| src/components/Map.tsx:81:   paint: {
005441| NOTE: Implementation detail supporting search page behavior.
005442| src/components/Map.tsx:82:     "circle-color": MAP_COLORS.zinc900, // zinc-900
005443| NOTE: Implementation detail supporting search page behavior.
005444| src/components/Map.tsx:83:     "circle-radius": [
005445| NOTE: Implementation detail supporting search page behavior.
005446| src/components/Map.tsx:84:       "step",
005447| NOTE: Implementation detail supporting search page behavior.
005448| src/components/Map.tsx:85:       ["get", "point_count"],
005449| NOTE: Implementation detail supporting search page behavior.
005450| src/components/Map.tsx:86:       20, // 20px radius for < 10 points
005451| NOTE: Implementation detail supporting search page behavior.
005452| src/components/Map.tsx:87:       10,
005453| NOTE: Implementation detail supporting search page behavior.
005454| src/components/Map.tsx:88:       25, // 25px radius for 10-49 points
005455| NOTE: Implementation detail supporting search page behavior.
005456| src/components/Map.tsx:89:       50,
005457| NOTE: Implementation detail supporting search page behavior.
005458| src/components/Map.tsx:90:       32, // 32px radius for 50-99 points
005459| NOTE: Implementation detail supporting search page behavior.
005460| src/components/Map.tsx:91:       100,
005461| NOTE: Implementation detail supporting search page behavior.
005462| src/components/Map.tsx:92:       40, // 40px radius for 100+ points
005463| NOTE: Implementation detail supporting search page behavior.
005464| src/components/Map.tsx:93:     ],
005465| NOTE: Implementation detail supporting search page behavior.
005466| src/components/Map.tsx:94:     "circle-stroke-width": 3,
005467| NOTE: Implementation detail supporting search page behavior.
005468| src/components/Map.tsx:95:     "circle-stroke-color": MAP_COLORS.white,
005469| NOTE: Implementation detail supporting search page behavior.
005470| src/components/Map.tsx:96:   },
005471| NOTE: Implementation detail supporting search page behavior.
005472| src/components/Map.tsx:97: };
005473| NOTE: Implementation detail supporting search page behavior.
005474| src/components/Map.tsx:98: 
005475| NOTE: Blank line for visual separation.
005476| src/components/Map.tsx:99: // Dark mode cluster layer
005477| NOTE: Line comment documents intent or constraints.
005478| src/components/Map.tsx:100: const clusterLayerDark: LayerProps = {
005479| NOTE: Local declaration used by search logic or UI.
005480| src/components/Map.tsx:101:   id: "clusters-dark",
005481| NOTE: Implementation detail supporting search page behavior.
005482| src/components/Map.tsx:102:   type: "circle",
005483| NOTE: Implementation detail supporting search page behavior.
005484| src/components/Map.tsx:103:   filter: ["has", "point_count"],
005485| NOTE: Implementation detail supporting search page behavior.
005486| src/components/Map.tsx:104:   paint: {
005487| NOTE: Implementation detail supporting search page behavior.
005488| src/components/Map.tsx:105:     "circle-color": MAP_COLORS.white,
005489| NOTE: Implementation detail supporting search page behavior.
005490| src/components/Map.tsx:106:     "circle-radius": [
005491| NOTE: Implementation detail supporting search page behavior.
005492| src/components/Map.tsx:107:       "step",
005493| NOTE: Implementation detail supporting search page behavior.
005494| src/components/Map.tsx:108:       ["get", "point_count"],
005495| NOTE: Implementation detail supporting search page behavior.
005496| src/components/Map.tsx:109:       20,
005497| NOTE: Implementation detail supporting search page behavior.
005498| src/components/Map.tsx:110:       10,
005499| NOTE: Implementation detail supporting search page behavior.
005500| src/components/Map.tsx:111:       25,
005501| NOTE: Implementation detail supporting search page behavior.
005502| src/components/Map.tsx:112:       50,
005503| NOTE: Implementation detail supporting search page behavior.
005504| src/components/Map.tsx:113:       32,
005505| NOTE: Implementation detail supporting search page behavior.
005506| src/components/Map.tsx:114:       100,
005507| NOTE: Implementation detail supporting search page behavior.
005508| src/components/Map.tsx:115:       40,
005509| NOTE: Implementation detail supporting search page behavior.
005510| src/components/Map.tsx:116:     ],
005511| NOTE: Implementation detail supporting search page behavior.
005512| src/components/Map.tsx:117:     "circle-stroke-width": 3,
005513| NOTE: Implementation detail supporting search page behavior.
005514| src/components/Map.tsx:118:     "circle-stroke-color": MAP_COLORS.zinc900,
005515| NOTE: Implementation detail supporting search page behavior.
005516| src/components/Map.tsx:119:   },
005517| NOTE: Implementation detail supporting search page behavior.
005518| src/components/Map.tsx:120: };
005519| NOTE: Implementation detail supporting search page behavior.
005520| src/components/Map.tsx:121: 
005521| NOTE: Blank line for visual separation.
005522| src/components/Map.tsx:122: // Cluster count label layer
005523| NOTE: Line comment documents intent or constraints.
005524| src/components/Map.tsx:123: const clusterCountLayer: LayerProps = {
005525| NOTE: Local declaration used by search logic or UI.
005526| src/components/Map.tsx:124:   id: "cluster-count",
005527| NOTE: Implementation detail supporting search page behavior.
005528| src/components/Map.tsx:125:   type: "symbol",
005529| NOTE: Implementation detail supporting search page behavior.
005530| src/components/Map.tsx:126:   filter: ["has", "point_count"],
005531| NOTE: Implementation detail supporting search page behavior.
005532| src/components/Map.tsx:127:   layout: {
005533| NOTE: Implementation detail supporting search page behavior.
005534| src/components/Map.tsx:128:     "text-field": "{point_count_abbreviated}",
005535| NOTE: Implementation detail supporting search page behavior.
005536| src/components/Map.tsx:129:     "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
005537| NOTE: Implementation detail supporting search page behavior.
005538| src/components/Map.tsx:130:     "text-size": 14,
005539| NOTE: Implementation detail supporting search page behavior.
005540| src/components/Map.tsx:131:   },
005541| NOTE: Implementation detail supporting search page behavior.
005542| src/components/Map.tsx:132:   paint: {
005543| NOTE: Implementation detail supporting search page behavior.
005544| src/components/Map.tsx:133:     "text-color": MAP_COLORS.white,
005545| NOTE: Implementation detail supporting search page behavior.
005546| src/components/Map.tsx:134:   },
005547| NOTE: Implementation detail supporting search page behavior.
005548| src/components/Map.tsx:135: };
005549| NOTE: Implementation detail supporting search page behavior.
005550| src/components/Map.tsx:136: 
005551| NOTE: Blank line for visual separation.
005552| src/components/Map.tsx:137: // Dark mode cluster count
005553| NOTE: Line comment documents intent or constraints.
005554| src/components/Map.tsx:138: const clusterCountLayerDark: LayerProps = {
005555| NOTE: Local declaration used by search logic or UI.
005556| src/components/Map.tsx:139:   id: "cluster-count-dark",
005557| NOTE: Implementation detail supporting search page behavior.
005558| src/components/Map.tsx:140:   type: "symbol",
005559| NOTE: Implementation detail supporting search page behavior.
005560| src/components/Map.tsx:141:   filter: ["has", "point_count"],
005561| NOTE: Implementation detail supporting search page behavior.
005562| src/components/Map.tsx:142:   layout: {
005563| NOTE: Implementation detail supporting search page behavior.
005564| src/components/Map.tsx:143:     "text-field": "{point_count_abbreviated}",
005565| NOTE: Implementation detail supporting search page behavior.
005566| src/components/Map.tsx:144:     "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
005567| NOTE: Implementation detail supporting search page behavior.
005568| src/components/Map.tsx:145:     "text-size": 14,
005569| NOTE: Implementation detail supporting search page behavior.
005570| src/components/Map.tsx:146:   },
005571| NOTE: Implementation detail supporting search page behavior.
005572| src/components/Map.tsx:147:   paint: {
005573| NOTE: Implementation detail supporting search page behavior.
005574| src/components/Map.tsx:148:     "text-color": MAP_COLORS.zinc900,
005575| NOTE: Implementation detail supporting search page behavior.
005576| src/components/Map.tsx:149:   },
005577| NOTE: Implementation detail supporting search page behavior.
005578| src/components/Map.tsx:150: };
005579| NOTE: Implementation detail supporting search page behavior.
005580| src/components/Map.tsx:151: 
005581| NOTE: Blank line for visual separation.
005582| src/components/Map.tsx:152: // Threshold for when to use clustering vs individual markers
005583| NOTE: Line comment documents intent or constraints.
005584| src/components/Map.tsx:153: const CLUSTER_THRESHOLD = 50;
005585| NOTE: Local declaration used by search logic or UI.
005586| src/components/Map.tsx:154: 
005587| NOTE: Blank line for visual separation.
005588| src/components/Map.tsx:155: // Primary pin limit for tiering (configurable via env var)
005589| NOTE: Line comment documents intent or constraints.
005590| src/components/Map.tsx:156: const PRIMARY_PIN_LIMIT = getPrimaryPinLimit();
005591| NOTE: Local declaration used by search logic or UI.
005592| src/components/Map.tsx:157: 
005593| NOTE: Blank line for visual separation.
005594| src/components/Map.tsx:158: export default function MapComponent({
005595| NOTE: Exports main component for this module.
005596| src/components/Map.tsx:159:   listings,
005597| NOTE: Implementation detail supporting search page behavior.
005598| src/components/Map.tsx:160:   v2MapData,
005599| NOTE: Implementation detail supporting search page behavior.
005600| src/components/Map.tsx:161: }: MapComponentProps) {
005601| NOTE: Implementation detail supporting search page behavior.
005602| src/components/Map.tsx:162:   // Determine data source: v2 (direct geojson) or v1 (convert listings)
005603| NOTE: Line comment documents intent or constraints.
005604| src/components/Map.tsx:163:   const useV2Source = v2MapData !== null && v2MapData !== undefined;
005605| NOTE: Local declaration used by search logic or UI.
005606| src/components/Map.tsx:164: 
005607| NOTE: Blank line for visual separation.
005608| src/components/Map.tsx:165:   // For v1 path, use listings (default to empty array if undefined)
005609| NOTE: Line comment documents intent or constraints.
005610| src/components/Map.tsx:166:   // For v2 path, we derive listings from geojson for popups/interactions
005611| NOTE: Line comment documents intent or constraints.
005612| src/components/Map.tsx:167:   const effectiveListings = useMemo(() => {
005613| NOTE: Memoizes derived values to reduce re-render work.
005614| src/components/Map.tsx:168:     if (!useV2Source) {
005615| NOTE: Conditional logic controlling rendering or flow.
005616| src/components/Map.tsx:169:       return listings || [];
005617| NOTE: Return statement for component or helper output.
005618| src/components/Map.tsx:170:     }
005619| NOTE: Implementation detail supporting search page behavior.
005620| src/components/Map.tsx:171:     // Convert v2 geojson features to Listing shape for popups
005621| NOTE: Line comment documents intent or constraints.
005622| src/components/Map.tsx:172:     return v2MapData!.geojson.features.map((feature) => ({
005623| NOTE: Return statement for component or helper output.
005624| src/components/Map.tsx:173:       id: feature.properties.id,
005625| NOTE: Implementation detail supporting search page behavior.
005626| src/components/Map.tsx:174:       title: feature.properties.title,
005627| NOTE: Implementation detail supporting search page behavior.
005628| src/components/Map.tsx:175:       price: feature.properties.price ?? 0,
005629| NOTE: Implementation detail supporting search page behavior.
005630| src/components/Map.tsx:176:       availableSlots: 0, // Not available in v2 geojson
005631| NOTE: Implementation detail supporting search page behavior.
005632| src/components/Map.tsx:177:       ownerId: undefined,
005633| NOTE: Implementation detail supporting search page behavior.
005634| src/components/Map.tsx:178:       images: feature.properties.image ? [feature.properties.image] : [],
005635| NOTE: Implementation detail supporting search page behavior.
005636| src/components/Map.tsx:179:       location: {
005637| NOTE: Implementation detail supporting search page behavior.
005638| src/components/Map.tsx:180:         lat: feature.geometry.coordinates[1],
005639| NOTE: Implementation detail supporting search page behavior.
005640| src/components/Map.tsx:181:         lng: feature.geometry.coordinates[0],
005641| NOTE: Implementation detail supporting search page behavior.
005642| src/components/Map.tsx:182:       },
005643| NOTE: Implementation detail supporting search page behavior.
005644| src/components/Map.tsx:183:     }));
005645| NOTE: Implementation detail supporting search page behavior.
005646| src/components/Map.tsx:184:   }, [useV2Source, listings, v2MapData]);
005647| NOTE: Implementation detail supporting search page behavior.
005648| src/components/Map.tsx:185: 
005649| NOTE: Blank line for visual separation.
005650| src/components/Map.tsx:186:   // Build lookup map for hydrating v2 pins with real listing data
005651| NOTE: Line comment documents intent or constraints.
005652| src/components/Map.tsx:187:   const listingById = useMemo(
005653| NOTE: Memoizes derived values to reduce re-render work.
005654| src/components/Map.tsx:188:     () => new Map(effectiveListings.map((l) => [l.id, l])),
005655| NOTE: Implementation detail supporting search page behavior.
005656| src/components/Map.tsx:189:     [effectiveListings],
005657| NOTE: Implementation detail supporting search page behavior.
005658| src/components/Map.tsx:190:   );
005659| NOTE: Implementation detail supporting search page behavior.
005660| src/components/Map.tsx:191: 
005661| NOTE: Blank line for visual separation.
005662| src/components/Map.tsx:192:   // Debug: Track map mount/unmount for billing verification
005663| NOTE: Line comment documents intent or constraints.
005664| src/components/Map.tsx:193:   useEffect(() => {
005665| NOTE: Defines side effect for syncing with external state.
005666| src/components/Map.tsx:194:     console.log("\U0001F5FA\uFE0F MAP MOUNT - Mapbox billing event");
005667| NOTE: Implementation detail supporting search page behavior.
005668| src/components/Map.tsx:195:     return () => console.log("\U0001F5FA\uFE0F MAP UNMOUNT");
005669| NOTE: Return statement for component or helper output.
005670| src/components/Map.tsx:196:   }, []);
005671| NOTE: Implementation detail supporting search page behavior.
005672| src/components/Map.tsx:197: 
005673| NOTE: Blank line for visual separation.
005674| src/components/Map.tsx:198:   const [selectedListing, setSelectedListing] = useState<Listing | null>(null);
005675| NOTE: Initializes local state for search UI behavior.
005676| src/components/Map.tsx:199:   const [selectedGroup, setSelectedGroup] = useState<ListingGroup | null>(null);
005677| NOTE: Initializes local state for search UI behavior.
005678| src/components/Map.tsx:200:   const [searchAsMove, setSearchAsMove] = useState(false); // Default OFF to reduce queries
005679| NOTE: Initializes local state for search UI behavior.
005680| src/components/Map.tsx:201:   const [unclusteredListings, setUnclusteredListings] = useState<Listing[]>([]);
005681| NOTE: Initializes local state for search UI behavior.
005682| src/components/Map.tsx:202:   const [isDarkMode, setIsDarkMode] = useState(false);
005683| NOTE: Initializes local state for search UI behavior.
005684| src/components/Map.tsx:203:   const [isMapLoaded, setIsMapLoaded] = useState(false);
005685| NOTE: Initializes local state for search UI behavior.
005686| src/components/Map.tsx:204:   const [areTilesLoading, setAreTilesLoading] = useState(false);
005687| NOTE: Initializes local state for search UI behavior.
005688| src/components/Map.tsx:205:   const [isSearching, setIsSearching] = useState(false);
005689| NOTE: Initializes local state for search UI behavior.
005690| src/components/Map.tsx:206:   // Track if map bounds differ from URL bounds (for "Search this area" CTA)
005691| NOTE: Line comment documents intent or constraints.
005692| src/components/Map.tsx:207:   const [boundsDirty, setBoundsDirtyLocal] = useState(false);
005693| NOTE: Initializes local state for search UI behavior.
005694| src/components/Map.tsx:208:   // Track if USER (not programmatic) has moved map - gates CTA visibility
005695| NOTE: Line comment documents intent or constraints.
005696| src/components/Map.tsx:209:   const [hasUserMoved, setHasUserMovedLocal] = useState(false);
005697| NOTE: Initializes local state for search UI behavior.
005698| src/components/Map.tsx:210: 
005699| NOTE: Blank line for visual separation.
005700| src/components/Map.tsx:211:   // Sync state with context for cross-component banner visibility
005701| NOTE: Line comment documents intent or constraints.
005702| src/components/Map.tsx:212:   const mapBoundsContext = useMapBounds();
005703| NOTE: Local declaration used by search logic or UI.
005704| src/components/Map.tsx:213: 
005705| NOTE: Blank line for visual separation.
005706| src/components/Map.tsx:214:   // Get listing focus state for list \u2194 map sync
005707| NOTE: Line comment documents intent or constraints.
005708| src/components/Map.tsx:215:   const { hoveredId, activeId, setHovered, setActive, requestScrollTo } =
005709| NOTE: Local declaration used by search logic or UI.
005710| src/components/Map.tsx:216:     useListingFocus();
005711| NOTE: Implementation detail supporting search page behavior.
005712| src/components/Map.tsx:217: 
005713| NOTE: Blank line for visual separation.
005714| src/components/Map.tsx:218:   // Get pending focus state for card \u2192 map "View on map" feature
005715| NOTE: Line comment documents intent or constraints.
005716| src/components/Map.tsx:219:   // Also get registerDismiss to allow cross-component popup dismissal
005717| NOTE: Line comment documents intent or constraints.
005718| src/components/Map.tsx:220:   const { pendingFocus, acknowledgeFocus, registerDismiss } = useSearchMapUI();
005719| NOTE: Local declaration used by search logic or UI.
005720| src/components/Map.tsx:221: 
005721| NOTE: Blank line for visual separation.
005722| src/components/Map.tsx:222:   // Destructure stable functions from context to avoid dependency on the entire object
005723| NOTE: Line comment documents intent or constraints.
005724| src/components/Map.tsx:223:   // These setters are stable (from useState in context), so they won't cause re-renders
005725| NOTE: Line comment documents intent or constraints.
005726| src/components/Map.tsx:224:   const {
005727| NOTE: Local declaration used by search logic or UI.
005728| src/components/Map.tsx:225:     setBoundsDirty: contextSetBoundsDirty,
005729| NOTE: Implementation detail supporting search page behavior.
005730| src/components/Map.tsx:226:     setHasUserMoved: contextSetHasUserMoved,
005731| NOTE: Implementation detail supporting search page behavior.
005732| src/components/Map.tsx:227:     setSearchHandler,
005733| NOTE: Implementation detail supporting search page behavior.
005734| src/components/Map.tsx:228:     setResetHandler,
005735| NOTE: Implementation detail supporting search page behavior.
005736| src/components/Map.tsx:229:     setSearchAsMove: contextSetSearchAsMove,
005737| NOTE: Implementation detail supporting search page behavior.
005738| src/components/Map.tsx:230:     setSearchLocation,
005739| NOTE: Implementation detail supporting search page behavior.
005740| src/components/Map.tsx:231:     setCurrentMapBounds: contextSetCurrentMapBounds,
005741| NOTE: Implementation detail supporting search page behavior.
005742| src/components/Map.tsx:232:     // Location conflict state for banner
005743| NOTE: Line comment documents intent or constraints.
005744| src/components/Map.tsx:233:     locationConflict,
005745| NOTE: Implementation detail supporting search page behavior.
005746| src/components/Map.tsx:234:     searchLocationName,
005747| NOTE: Implementation detail supporting search page behavior.
005748| src/components/Map.tsx:235:   } = mapBoundsContext;
005749| NOTE: Implementation detail supporting search page behavior.
005750| src/components/Map.tsx:236: 
005751| NOTE: Blank line for visual separation.
005752| src/components/Map.tsx:237:   // Wrapper setters that update both local state and context
005753| NOTE: Line comment documents intent or constraints.
005754| src/components/Map.tsx:238:   const setBoundsDirty = useCallback(
005755| NOTE: Memoizes callback to preserve references across renders.
005756| src/components/Map.tsx:239:     (value: boolean) => {
005757| NOTE: Implementation detail supporting search page behavior.
005758| src/components/Map.tsx:240:       setBoundsDirtyLocal(value);
005759| NOTE: Implementation detail supporting search page behavior.
005760| src/components/Map.tsx:241:       contextSetBoundsDirty(value);
005761| NOTE: Implementation detail supporting search page behavior.
005762| src/components/Map.tsx:242:     },
005763| NOTE: Implementation detail supporting search page behavior.
005764| src/components/Map.tsx:243:     [contextSetBoundsDirty],
005765| NOTE: Implementation detail supporting search page behavior.
005766| src/components/Map.tsx:244:   );
005767| NOTE: Implementation detail supporting search page behavior.
005768| src/components/Map.tsx:245: 
005769| NOTE: Blank line for visual separation.
005770| src/components/Map.tsx:246:   const setHasUserMoved = useCallback(
005771| NOTE: Memoizes callback to preserve references across renders.
005772| src/components/Map.tsx:247:     (value: boolean) => {
005773| NOTE: Implementation detail supporting search page behavior.
005774| src/components/Map.tsx:248:       setHasUserMovedLocal(value);
005775| NOTE: Implementation detail supporting search page behavior.
005776| src/components/Map.tsx:249:       contextSetHasUserMoved(value);
005777| NOTE: Implementation detail supporting search page behavior.
005778| src/components/Map.tsx:250:     },
005779| NOTE: Implementation detail supporting search page behavior.
005780| src/components/Map.tsx:251:     [contextSetHasUserMoved],
005781| NOTE: Implementation detail supporting search page behavior.
005782| src/components/Map.tsx:252:   );
005783| NOTE: Implementation detail supporting search page behavior.
005784| src/components/Map.tsx:253:   const router = useRouter();
005785| NOTE: Local declaration used by search logic or UI.
005786| src/components/Map.tsx:254:   const searchParams = useSearchParams();
005787| NOTE: Local declaration used by search logic or UI.
005788| src/components/Map.tsx:255:   const mapRef = useRef<any>(null);
005789| NOTE: Uses ref for stable mutable storage between renders.
005790| src/components/Map.tsx:256:   const debounceTimer = useRef<NodeJS.Timeout | null>(null);
005791| NOTE: Uses ref for stable mutable storage between renders.
005792| src/components/Map.tsx:257:   const lastSearchTimeRef = useRef<number>(0);
005793| NOTE: Uses ref for stable mutable storage between renders.
005794| src/components/Map.tsx:258:   const pendingBoundsRef = useRef<{
005795| NOTE: Uses ref for stable mutable storage between renders.
005796| src/components/Map.tsx:259:     minLng: number;
005797| NOTE: Implementation detail supporting search page behavior.
005798| src/components/Map.tsx:260:     maxLng: number;
005799| NOTE: Implementation detail supporting search page behavior.
005800| src/components/Map.tsx:261:     minLat: number;
005801| NOTE: Implementation detail supporting search page behavior.
005802| src/components/Map.tsx:262:     maxLat: number;
005803| NOTE: Implementation detail supporting search page behavior.
005804| src/components/Map.tsx:263:   } | null>(null);
005805| NOTE: Implementation detail supporting search page behavior.
005806| src/components/Map.tsx:264:   const throttleTimeoutRef = useRef<NodeJS.Timeout | null>(null);
005807| NOTE: Uses ref for stable mutable storage between renders.
005808| src/components/Map.tsx:265:   // Current map bounds for CTA click
005809| NOTE: Line comment documents intent or constraints.
005810| src/components/Map.tsx:266:   const currentMapBoundsRef = useRef<{
005811| NOTE: Uses ref for stable mutable storage between renders.
005812| src/components/Map.tsx:267:     minLng: number;
005813| NOTE: Implementation detail supporting search page behavior.
005814| src/components/Map.tsx:268:     maxLng: number;
005815| NOTE: Implementation detail supporting search page behavior.
005816| src/components/Map.tsx:269:     minLat: number;
005817| NOTE: Implementation detail supporting search page behavior.
005818| src/components/Map.tsx:270:     maxLat: number;
005819| NOTE: Implementation detail supporting search page behavior.
005820| src/components/Map.tsx:271:   } | null>(null);
005821| NOTE: Implementation detail supporting search page behavior.
005822| src/components/Map.tsx:272:   // Flag to distinguish programmatic moves (flyTo/fitBounds) from user moves
005823| NOTE: Line comment documents intent or constraints.
005824| src/components/Map.tsx:273:   const isProgrammaticMoveRef = useRef(false);
005825| NOTE: Uses ref for stable mutable storage between renders.
005826| src/components/Map.tsx:274:   // Track if we've already auto-fit once (prevents multiple auto-fits in session)
005827| NOTE: Line comment documents intent or constraints.
005828| src/components/Map.tsx:275:   const hasAutoFitRef = useRef(false);
005829| NOTE: Uses ref for stable mutable storage between renders.
005830| src/components/Map.tsx:276: 
005831| NOTE: Blank line for visual separation.
005832| src/components/Map.tsx:277:   // Minimum interval between map searches (prevents 429 rate limiting)
005833| NOTE: Line comment documents intent or constraints.
005834| src/components/Map.tsx:278:   const MIN_SEARCH_INTERVAL_MS = 2000;
005835| NOTE: Local declaration used by search logic or UI.
005836| src/components/Map.tsx:279: 
005837| NOTE: Blank line for visual separation.
005838| src/components/Map.tsx:280:   // Dismiss all popups and clear selection (used by ESC key and background clicks)
005839| NOTE: Line comment documents intent or constraints.
005840| src/components/Map.tsx:281:   // NOTE: Uses setActive/setHovered directly instead of clearFocus to avoid scroll side effects
005841| NOTE: Line comment documents intent or constraints.
005842| src/components/Map.tsx:282:   const dismissSelectionAndPopups = useCallback(() => {
005843| NOTE: Memoizes callback to preserve references across renders.
005844| src/components/Map.tsx:283:     setSelectedListing(null);
005845| NOTE: Implementation detail supporting search page behavior.
005846| src/components/Map.tsx:284:     setSelectedGroup(null);
005847| NOTE: Implementation detail supporting search page behavior.
005848| src/components/Map.tsx:285:     setActive(null);
005849| NOTE: Implementation detail supporting search page behavior.
005850| src/components/Map.tsx:286:     setHovered(null);
005851| NOTE: Implementation detail supporting search page behavior.
005852| src/components/Map.tsx:287:   }, [setActive, setHovered]);
005853| NOTE: Implementation detail supporting search page behavior.
005854| src/components/Map.tsx:288: 
005855| NOTE: Blank line for visual separation.
005856| src/components/Map.tsx:289:   // Detect dark mode
005857| NOTE: Line comment documents intent or constraints.
005858| src/components/Map.tsx:290:   useEffect(() => {
005859| NOTE: Defines side effect for syncing with external state.
005860| src/components/Map.tsx:291:     const checkDarkMode = () => {
005861| NOTE: Local declaration used by search logic or UI.
005862| src/components/Map.tsx:292:       setIsDarkMode(document.documentElement.classList.contains("dark"));
005863| NOTE: Implementation detail supporting search page behavior.
005864| src/components/Map.tsx:293:     };
005865| NOTE: Implementation detail supporting search page behavior.
005866| src/components/Map.tsx:294:     checkDarkMode();
005867| NOTE: Implementation detail supporting search page behavior.
005868| src/components/Map.tsx:295: 
005869| NOTE: Blank line for visual separation.
005870| src/components/Map.tsx:296:     // Watch for theme changes
005871| NOTE: Line comment documents intent or constraints.
005872| src/components/Map.tsx:297:     const observer = new MutationObserver(checkDarkMode);
005873| NOTE: Local declaration used by search logic or UI.
005874| src/components/Map.tsx:298:     observer.observe(document.documentElement, {
005875| NOTE: Implementation detail supporting search page behavior.
005876| src/components/Map.tsx:299:       attributes: true,
005877| NOTE: Implementation detail supporting search page behavior.
005878| src/components/Map.tsx:300:       attributeFilter: ["class"],
005879| NOTE: Implementation detail supporting search page behavior.
005880| src/components/Map.tsx:301:     });
005881| NOTE: Implementation detail supporting search page behavior.
005882| src/components/Map.tsx:302: 
005883| NOTE: Blank line for visual separation.
005884| src/components/Map.tsx:303:     return () => observer.disconnect();
005885| NOTE: Return statement for component or helper output.
005886| src/components/Map.tsx:304:   }, []);
005887| NOTE: Implementation detail supporting search page behavior.
005888| src/components/Map.tsx:305: 
005889| NOTE: Blank line for visual separation.
005890| src/components/Map.tsx:306:   // Document-level ESC handler for dismissing popups/selection
005891| NOTE: Line comment documents intent or constraints.
005892| src/components/Map.tsx:307:   useEffect(() => {
005893| NOTE: Defines side effect for syncing with external state.
005894| src/components/Map.tsx:308:     const handleKeyDown = (e: KeyboardEvent) => {
005895| NOTE: Local declaration used by search logic or UI.
005896| src/components/Map.tsx:309:       if (e.key === "Escape") {
005897| NOTE: Conditional logic controlling rendering or flow.
005898| src/components/Map.tsx:310:         // Only dismiss if something is actually open/selected
005899| NOTE: Line comment documents intent or constraints.
005900| src/components/Map.tsx:311:         if (selectedListing || selectedGroup || activeId) {
005901| NOTE: Conditional logic controlling rendering or flow.
005902| src/components/Map.tsx:312:           e.preventDefault();
005903| NOTE: Implementation detail supporting search page behavior.
005904| src/components/Map.tsx:313:           dismissSelectionAndPopups();
005905| NOTE: Implementation detail supporting search page behavior.
005906| src/components/Map.tsx:314:         }
005907| NOTE: Implementation detail supporting search page behavior.
005908| src/components/Map.tsx:315:       }
005909| NOTE: Implementation detail supporting search page behavior.
005910| src/components/Map.tsx:316:     };
005911| NOTE: Implementation detail supporting search page behavior.
005912| src/components/Map.tsx:317: 
005913| NOTE: Blank line for visual separation.
005914| src/components/Map.tsx:318:     document.addEventListener("keydown", handleKeyDown);
005915| NOTE: Implementation detail supporting search page behavior.
005916| src/components/Map.tsx:319:     return () => document.removeEventListener("keydown", handleKeyDown);
005917| NOTE: Return statement for component or helper output.
005918| src/components/Map.tsx:320:   }, [selectedListing, selectedGroup, activeId, dismissSelectionAndPopups]);
005919| NOTE: Implementation detail supporting search page behavior.
005920| src/components/Map.tsx:321: 
005921| NOTE: Blank line for visual separation.
005922| src/components/Map.tsx:322:   // Register dismiss function with context for cross-component dismissal
005923| NOTE: Line comment documents intent or constraints.
005924| src/components/Map.tsx:323:   // (e.g., ListingCard can dismiss popup before navigation)
005925| NOTE: Line comment documents intent or constraints.
005926| src/components/Map.tsx:324:   useEffect(() => {
005927| NOTE: Defines side effect for syncing with external state.
005928| src/components/Map.tsx:325:     registerDismiss(dismissSelectionAndPopups);
005929| NOTE: Implementation detail supporting search page behavior.
005930| src/components/Map.tsx:326:     // Cleanup: clear the ref on unmount to prevent stale function calls
005931| NOTE: Line comment documents intent or constraints.
005932| src/components/Map.tsx:327:     return () => registerDismiss(() => {});
005933| NOTE: Return statement for component or helper output.
005934| src/components/Map.tsx:328:   }, [registerDismiss, dismissSelectionAndPopups]);
005935| NOTE: Implementation detail supporting search page behavior.
005936| src/components/Map.tsx:329: 
005937| NOTE: Blank line for visual separation.
005938| src/components/Map.tsx:330:   // Use clustering only when there are many listings
005939| NOTE: Line comment documents intent or constraints.
005940| src/components/Map.tsx:331:   // For v2, mode determines this: 'geojson' = clustering, 'pins' = individual markers
005941| NOTE: Line comment documents intent or constraints.
005942| src/components/Map.tsx:332:   const useClustering = useV2Source
005943| NOTE: Local declaration used by search logic or UI.
005944| src/components/Map.tsx:333:     ? v2MapData!.mode === "geojson"
005945| NOTE: Implementation detail supporting search page behavior.
005946| src/components/Map.tsx:334:     : effectiveListings.length >= CLUSTER_THRESHOLD;
005947| NOTE: Implementation detail supporting search page behavior.
005948| src/components/Map.tsx:335: 
005949| NOTE: Blank line for visual separation.
005950| src/components/Map.tsx:336:   // Convert listings to GeoJSON for Mapbox clustering
005951| NOTE: Line comment documents intent or constraints.
005952| src/components/Map.tsx:337:   // For v2 path, use the pre-computed geojson directly
005953| NOTE: Line comment documents intent or constraints.
005954| src/components/Map.tsx:338:   const geojsonData = useMemo(() => {
005955| NOTE: Memoizes derived values to reduce re-render work.
005956| src/components/Map.tsx:339:     if (useV2Source) {
005957| NOTE: Conditional logic controlling rendering or flow.
005958| src/components/Map.tsx:340:       // V2 path: use server-provided geojson directly
005959| NOTE: Line comment documents intent or constraints.
005960| src/components/Map.tsx:341:       // Transform to match expected properties format for popups
005961| NOTE: Line comment documents intent or constraints.
005962| src/components/Map.tsx:342:       return {
005963| NOTE: Return statement for component or helper output.
005964| src/components/Map.tsx:343:         type: "FeatureCollection" as const,
005965| NOTE: Implementation detail supporting search page behavior.
005966| src/components/Map.tsx:344:         features: v2MapData!.geojson.features.map((feature) => ({
005967| NOTE: Implementation detail supporting search page behavior.
005968| src/components/Map.tsx:345:           type: "Feature" as const,
005969| NOTE: Implementation detail supporting search page behavior.
005970| src/components/Map.tsx:346:           geometry: feature.geometry,
005971| NOTE: Implementation detail supporting search page behavior.
005972| src/components/Map.tsx:347:           properties: {
005973| NOTE: Implementation detail supporting search page behavior.
005974| src/components/Map.tsx:348:             id: feature.properties.id,
005975| NOTE: Implementation detail supporting search page behavior.
005976| src/components/Map.tsx:349:             title: feature.properties.title,
005977| NOTE: Implementation detail supporting search page behavior.
005978| src/components/Map.tsx:350:             price: feature.properties.price ?? 0,
005979| NOTE: Implementation detail supporting search page behavior.
005980| src/components/Map.tsx:351:             availableSlots: 0,
005981| NOTE: Implementation detail supporting search page behavior.
005982| src/components/Map.tsx:352:             ownerId: "",
005983| NOTE: Implementation detail supporting search page behavior.
005984| src/components/Map.tsx:353:             images: JSON.stringify(
005985| NOTE: Implementation detail supporting search page behavior.
005986| src/components/Map.tsx:354:               feature.properties.image ? [feature.properties.image] : [],
005987| NOTE: Implementation detail supporting search page behavior.
005988| src/components/Map.tsx:355:             ),
005989| NOTE: Implementation detail supporting search page behavior.
005990| src/components/Map.tsx:356:             lat: feature.geometry.coordinates[1],
005991| NOTE: Implementation detail supporting search page behavior.
005992| src/components/Map.tsx:357:             lng: feature.geometry.coordinates[0],
005993| NOTE: Implementation detail supporting search page behavior.
005994| src/components/Map.tsx:358:           },
005995| NOTE: Implementation detail supporting search page behavior.
005996| src/components/Map.tsx:359:         })),
005997| NOTE: Implementation detail supporting search page behavior.
005998| src/components/Map.tsx:360:       };
005999| NOTE: Implementation detail supporting search page behavior.
006000| src/components/Map.tsx:361:     }
006001| NOTE: Implementation detail supporting search page behavior.
006002| src/components/Map.tsx:362:     // V1 path: convert listings to geojson
006003| NOTE: Line comment documents intent or constraints.
006004| src/components/Map.tsx:363:     return {
006005| NOTE: Return statement for component or helper output.
006006| src/components/Map.tsx:364:       type: "FeatureCollection" as const,
006007| NOTE: Implementation detail supporting search page behavior.
006008| src/components/Map.tsx:365:       features: effectiveListings.map((listing) => ({
006009| NOTE: Implementation detail supporting search page behavior.
006010| src/components/Map.tsx:366:         type: "Feature" as const,
006011| NOTE: Implementation detail supporting search page behavior.
006012| src/components/Map.tsx:367:         geometry: {
006013| NOTE: Implementation detail supporting search page behavior.
006014| src/components/Map.tsx:368:           type: "Point" as const,
006015| NOTE: Implementation detail supporting search page behavior.
006016| src/components/Map.tsx:369:           coordinates: [listing.location.lng, listing.location.lat],
006017| NOTE: Implementation detail supporting search page behavior.
006018| src/components/Map.tsx:370:         },
006019| NOTE: Implementation detail supporting search page behavior.
006020| src/components/Map.tsx:371:         properties: {
006021| NOTE: Implementation detail supporting search page behavior.
006022| src/components/Map.tsx:372:           id: listing.id,
006023| NOTE: Implementation detail supporting search page behavior.
006024| src/components/Map.tsx:373:           title: listing.title,
006025| NOTE: Implementation detail supporting search page behavior.
006026| src/components/Map.tsx:374:           price: listing.price,
006027| NOTE: Implementation detail supporting search page behavior.
006028| src/components/Map.tsx:375:           availableSlots: listing.availableSlots,
006029| NOTE: Implementation detail supporting search page behavior.
006030| src/components/Map.tsx:376:           ownerId: listing.ownerId || "",
006031| NOTE: Implementation detail supporting search page behavior.
006032| src/components/Map.tsx:377:           images: JSON.stringify(listing.images || []),
006033| NOTE: Implementation detail supporting search page behavior.
006034| src/components/Map.tsx:378:           lat: listing.location.lat,
006035| NOTE: Implementation detail supporting search page behavior.
006036| src/components/Map.tsx:379:           lng: listing.location.lng,
006037| NOTE: Implementation detail supporting search page behavior.
006038| src/components/Map.tsx:380:         },
006039| NOTE: Implementation detail supporting search page behavior.
006040| src/components/Map.tsx:381:       })),
006041| NOTE: Implementation detail supporting search page behavior.
006042| src/components/Map.tsx:382:     };
006043| NOTE: Implementation detail supporting search page behavior.
006044| src/components/Map.tsx:383:   }, [useV2Source, v2MapData, effectiveListings]);
006045| NOTE: Implementation detail supporting search page behavior.
006046| src/components/Map.tsx:384: 
006047| NOTE: Blank line for visual separation.
006048| src/components/Map.tsx:385:   // Handle cluster click to zoom in and expand
006049| NOTE: Line comment documents intent or constraints.
006050| src/components/Map.tsx:386:   const onClusterClick = useCallback((event: MapLayerMouseEvent) => {
006051| NOTE: Memoizes callback to preserve references across renders.
006052| src/components/Map.tsx:387:     const feature = event.features?.[0];
006053| NOTE: Local declaration used by search logic or UI.
006054| src/components/Map.tsx:388:     if (!feature || !mapRef.current) return;
006055| NOTE: Conditional logic controlling rendering or flow.
006056| src/components/Map.tsx:389: 
006057| NOTE: Blank line for visual separation.
006058| src/components/Map.tsx:390:     const clusterId = feature.properties?.cluster_id;
006059| NOTE: Local declaration used by search logic or UI.
006060| src/components/Map.tsx:391:     if (!clusterId) return;
006061| NOTE: Conditional logic controlling rendering or flow.
006062| src/components/Map.tsx:392: 
006063| NOTE: Blank line for visual separation.
006064| src/components/Map.tsx:393:     const mapboxSource = mapRef.current.getSource("listings") as
006065| NOTE: Local declaration used by search logic or UI.
006066| src/components/Map.tsx:394:       | GeoJSONSource
006067| NOTE: Implementation detail supporting search page behavior.
006068| src/components/Map.tsx:395:       | undefined;
006069| NOTE: Implementation detail supporting search page behavior.
006070| src/components/Map.tsx:396:     if (!mapboxSource) return;
006071| NOTE: Conditional logic controlling rendering or flow.
006072| src/components/Map.tsx:397: 
006073| NOTE: Blank line for visual separation.
006074| src/components/Map.tsx:398:     try {
006075| NOTE: Implementation detail supporting search page behavior.
006076| src/components/Map.tsx:399:       mapboxSource.getClusterExpansionZoom(
006077| NOTE: Implementation detail supporting search page behavior.
006078| src/components/Map.tsx:400:         clusterId,
006079| NOTE: Implementation detail supporting search page behavior.
006080| src/components/Map.tsx:401:         (err: Error | null, zoom: number) => {
006081| NOTE: Implementation detail supporting search page behavior.
006082| src/components/Map.tsx:402:           if (err || !feature.geometry || feature.geometry.type !== "Point")
006083| NOTE: Conditional logic controlling rendering or flow.
006084| src/components/Map.tsx:403:             return;
006085| NOTE: Implementation detail supporting search page behavior.
006086| src/components/Map.tsx:404: 
006087| NOTE: Blank line for visual separation.
006088| src/components/Map.tsx:405:           mapRef.current?.flyTo({
006089| NOTE: Implementation detail supporting search page behavior.
006090| src/components/Map.tsx:406:             center: feature.geometry.coordinates as [number, number],
006091| NOTE: Implementation detail supporting search page behavior.
006092| src/components/Map.tsx:407:             zoom: zoom,
006093| NOTE: Implementation detail supporting search page behavior.
006094| src/components/Map.tsx:408:             duration: 500,
006095| NOTE: Implementation detail supporting search page behavior.
006096| src/components/Map.tsx:409:           });
006097| NOTE: Implementation detail supporting search page behavior.
006098| src/components/Map.tsx:410:         },
006099| NOTE: Implementation detail supporting search page behavior.
006100| src/components/Map.tsx:411:       );
006101| NOTE: Implementation detail supporting search page behavior.
006102| src/components/Map.tsx:412:     } catch (error) {
006103| NOTE: Implementation detail supporting search page behavior.
006104| src/components/Map.tsx:413:       console.warn("Cluster expansion failed", error);
006105| NOTE: Implementation detail supporting search page behavior.
006106| src/components/Map.tsx:414:     }
006107| NOTE: Implementation detail supporting search page behavior.
006108| src/components/Map.tsx:415:   }, []);
006109| NOTE: Implementation detail supporting search page behavior.
006110| src/components/Map.tsx:416: 
006111| NOTE: Blank line for visual separation.
006112| src/components/Map.tsx:417:   // Handle map background click to dismiss popups and clear selection
006113| NOTE: Line comment documents intent or constraints.
006114| src/components/Map.tsx:418:   // Markers use stopPropagation, so only genuine background clicks reach here
006115| NOTE: Line comment documents intent or constraints.
006116| src/components/Map.tsx:419:   const handleMapClick = useCallback(
006117| NOTE: Memoizes callback to preserve references across renders.
006118| src/components/Map.tsx:420:     (e: MapLayerMouseEvent) => {
006119| NOTE: Implementation detail supporting search page behavior.
006120| src/components/Map.tsx:421:       // If clustering is enabled, check if this is a cluster click
006121| NOTE: Line comment documents intent or constraints.
006122| src/components/Map.tsx:422:       if (useClustering) {
006123| NOTE: Conditional logic controlling rendering or flow.
006124| src/components/Map.tsx:423:         const clusterFeature = e.features?.find(
006125| NOTE: Local declaration used by search logic or UI.
006126| src/components/Map.tsx:424:           (f) => f.properties?.cluster_id !== undefined,
006127| NOTE: Implementation detail supporting search page behavior.
006128| src/components/Map.tsx:425:         );
006129| NOTE: Implementation detail supporting search page behavior.
006130| src/components/Map.tsx:426:         if (clusterFeature) {
006131| NOTE: Conditional logic controlling rendering or flow.
006132| src/components/Map.tsx:427:           // This is a cluster click - handle expansion and return early
006133| NOTE: Line comment documents intent or constraints.
006134| src/components/Map.tsx:428:           // DON'T dismiss - user clicked a cluster to expand it
006135| NOTE: Line comment documents intent or constraints.
006136| src/components/Map.tsx:429:           onClusterClick(e);
006137| NOTE: Implementation detail supporting search page behavior.
006138| src/components/Map.tsx:430:           return;
006139| NOTE: Implementation detail supporting search page behavior.
006140| src/components/Map.tsx:431:         }
006141| NOTE: Implementation detail supporting search page behavior.
006142| src/components/Map.tsx:432:       }
006143| NOTE: Implementation detail supporting search page behavior.
006144| src/components/Map.tsx:433: 
006145| NOTE: Blank line for visual separation.
006146| src/components/Map.tsx:434:       // Fallback safety check: if click target is inside a popup or marker element,
006147| NOTE: Line comment documents intent or constraints.
006148| src/components/Map.tsx:435:       // don't dismiss (in case stopPropagation didn't catch it)
006149| NOTE: Line comment documents intent or constraints.
006150| src/components/Map.tsx:436:       const target = e.originalEvent?.target as HTMLElement | null;
006151| NOTE: Local declaration used by search logic or UI.
006152| src/components/Map.tsx:437:       if (target?.closest(".mapboxgl-popup, .mapboxgl-marker")) {
006153| NOTE: Conditional logic controlling rendering or flow.
006154| src/components/Map.tsx:438:         return;
006155| NOTE: Implementation detail supporting search page behavior.
006156| src/components/Map.tsx:439:       }
006157| NOTE: Implementation detail supporting search page behavior.
006158| src/components/Map.tsx:440: 
006159| NOTE: Blank line for visual separation.
006160| src/components/Map.tsx:441:       // Only genuine background clicks reach here - dismiss everything
006161| NOTE: Line comment documents intent or constraints.
006162| src/components/Map.tsx:442:       dismissSelectionAndPopups();
006163| NOTE: Implementation detail supporting search page behavior.
006164| src/components/Map.tsx:443:     },
006165| NOTE: Implementation detail supporting search page behavior.
006166| src/components/Map.tsx:444:     [useClustering, onClusterClick, dismissSelectionAndPopups],
006167| NOTE: Implementation detail supporting search page behavior.
006168| src/components/Map.tsx:445:   );
006169| NOTE: Implementation detail supporting search page behavior.
006170| src/components/Map.tsx:446: 
006171| NOTE: Blank line for visual separation.
006172| src/components/Map.tsx:447:   // Update unclustered listings when map moves (for rendering individual markers)
006173| NOTE: Line comment documents intent or constraints.
006174| src/components/Map.tsx:448:   const updateUnclusteredListings = useCallback(() => {
006175| NOTE: Memoizes callback to preserve references across renders.
006176| src/components/Map.tsx:449:     if (!mapRef.current || !useClustering) return;
006177| NOTE: Conditional logic controlling rendering or flow.
006178| src/components/Map.tsx:450: 
006179| NOTE: Blank line for visual separation.
006180| src/components/Map.tsx:451:     const map = mapRef.current.getMap();
006181| NOTE: Local declaration used by search logic or UI.
006182| src/components/Map.tsx:452:     if (!map || !map.getSource("listings")) return;
006183| NOTE: Conditional logic controlling rendering or flow.
006184| src/components/Map.tsx:453: 
006185| NOTE: Blank line for visual separation.
006186| src/components/Map.tsx:454:     // Query for unclustered points (points without cluster)
006187| NOTE: Line comment documents intent or constraints.
006188| src/components/Map.tsx:455:     const features = map.querySourceFeatures("listings", {
006189| NOTE: Local declaration used by search logic or UI.
006190| src/components/Map.tsx:456:       filter: ["!", ["has", "point_count"]],
006191| NOTE: Implementation detail supporting search page behavior.
006192| src/components/Map.tsx:457:     });
006193| NOTE: Implementation detail supporting search page behavior.
006194| src/components/Map.tsx:458: 
006195| NOTE: Blank line for visual separation.
006196| src/components/Map.tsx:459:     const unclustered = features.map((f: any) => ({
006197| NOTE: Local declaration used by search logic or UI.
006198| src/components/Map.tsx:460:       id: f.properties.id,
006199| NOTE: Implementation detail supporting search page behavior.
006200| src/components/Map.tsx:461:       title: f.properties.title,
006201| NOTE: Implementation detail supporting search page behavior.
006202| src/components/Map.tsx:462:       price: f.properties.price,
006203| NOTE: Implementation detail supporting search page behavior.
006204| src/components/Map.tsx:463:       availableSlots: f.properties.availableSlots,
006205| NOTE: Implementation detail supporting search page behavior.
006206| src/components/Map.tsx:464:       ownerId: f.properties.ownerId,
006207| NOTE: Implementation detail supporting search page behavior.
006208| src/components/Map.tsx:465:       images: JSON.parse(f.properties.images || "[]"),
006209| NOTE: Implementation detail supporting search page behavior.
006210| src/components/Map.tsx:466:       location: {
006211| NOTE: Implementation detail supporting search page behavior.
006212| src/components/Map.tsx:467:         lat: f.properties.lat,
006213| NOTE: Implementation detail supporting search page behavior.
006214| src/components/Map.tsx:468:         lng: f.properties.lng,
006215| NOTE: Implementation detail supporting search page behavior.
006216| src/components/Map.tsx:469:       },
006217| NOTE: Implementation detail supporting search page behavior.
006218| src/components/Map.tsx:470:     }));
006219| NOTE: Implementation detail supporting search page behavior.
006220| src/components/Map.tsx:471: 
006221| NOTE: Blank line for visual separation.
006222| src/components/Map.tsx:472:     // Deduplicate by id
006223| NOTE: Line comment documents intent or constraints.
006224| src/components/Map.tsx:473:     const seen = new Set<string>();
006225| NOTE: Local declaration used by search logic or UI.
006226| src/components/Map.tsx:474:     const unique = unclustered.filter((l: Listing) => {
006227| NOTE: Local declaration used by search logic or UI.
006228| src/components/Map.tsx:475:       if (seen.has(l.id)) return false;
006229| NOTE: Conditional logic controlling rendering or flow.
006230| src/components/Map.tsx:476:       seen.add(l.id);
006231| NOTE: Implementation detail supporting search page behavior.
006232| src/components/Map.tsx:477:       return true;
006233| NOTE: Return statement for component or helper output.
006234| src/components/Map.tsx:478:     });
006235| NOTE: Implementation detail supporting search page behavior.
006236| src/components/Map.tsx:479: 
006237| NOTE: Blank line for visual separation.
006238| src/components/Map.tsx:480:     setUnclusteredListings(unique);
006239| NOTE: Implementation detail supporting search page behavior.
006240| src/components/Map.tsx:481:   }, [useClustering]);
006241| NOTE: Implementation detail supporting search page behavior.
006242| src/components/Map.tsx:482: 
006243| NOTE: Blank line for visual separation.
006244| src/components/Map.tsx:483:   // Group listings by coordinate for stack markers (TRUE position, no offset)
006245| NOTE: Line comment documents intent or constraints.
006246| src/components/Map.tsx:484:   // When clustering, use unclustered listings; otherwise use all listings
006247| NOTE: Line comment documents intent or constraints.
006248| src/components/Map.tsx:485:   const markersSource = useClustering ? unclusteredListings : effectiveListings;
006249| NOTE: Local declaration used by search logic or UI.
006250| src/components/Map.tsx:486: 
006251| NOTE: Blank line for visual separation.
006252| src/components/Map.tsx:487:   // Build rank map from original listings array (preserves API sort order)
006253| NOTE: Line comment documents intent or constraints.
006254| src/components/Map.tsx:488:   const rankMap = useMemo(
006255| NOTE: Memoizes derived values to reduce re-render work.
006256| src/components/Map.tsx:489:     () => buildRankMap(effectiveListings),
006257| NOTE: Implementation detail supporting search page behavior.
006258| src/components/Map.tsx:490:     [effectiveListings],
006259| NOTE: Implementation detail supporting search page behavior.
006260| src/components/Map.tsx:491:   );
006261| NOTE: Implementation detail supporting search page behavior.
006262| src/components/Map.tsx:492: 
006263| NOTE: Blank line for visual separation.
006264| src/components/Map.tsx:493:   // Compute tiered groups with primary/mini classification
006265| NOTE: Line comment documents intent or constraints.
006266| src/components/Map.tsx:494:   // For v2 sparse mode: use server-provided pins with real listing data
006267| NOTE: Line comment documents intent or constraints.
006268| src/components/Map.tsx:495:   // For v1 or v2 dense mode: compute tiering client-side
006269| NOTE: Line comment documents intent or constraints.
006270| src/components/Map.tsx:496:   const tieredGroups = useMemo(() => {
006271| NOTE: Memoizes derived values to reduce re-render work.
006272| src/components/Map.tsx:497:     // V2 sparse mode: use pre-computed pins, hydrate with real listings
006273| NOTE: Line comment documents intent or constraints.
006274| src/components/Map.tsx:498:     if (
006275| NOTE: Conditional logic controlling rendering or flow.
006276| src/components/Map.tsx:499:       useV2Source &&
006277| NOTE: Implementation detail supporting search page behavior.
006278| src/components/Map.tsx:500:       v2MapData?.mode === "pins" &&
006279| NOTE: Implementation detail supporting search page behavior.
006280| src/components/Map.tsx:501:       v2MapData.pins &&
006281| NOTE: Implementation detail supporting search page behavior.
006282| src/components/Map.tsx:502:       v2MapData.pins.length > 0
006283| NOTE: Implementation detail supporting search page behavior.
006284| src/components/Map.tsx:503:     ) {
006285| NOTE: Implementation detail supporting search page behavior.
006286| src/components/Map.tsx:504:       return v2MapData.pins.map((pin) => {
006287| NOTE: Return statement for component or helper output.
006288| src/components/Map.tsx:505:         // Hydrate from real listing if available
006289| NOTE: Line comment documents intent or constraints.
006290| src/components/Map.tsx:506:         const listing = listingById.get(pin.id);
006291| NOTE: Local declaration used by search logic or UI.
006292| src/components/Map.tsx:507:         return {
006293| NOTE: Return statement for component or helper output.
006294| src/components/Map.tsx:508:           key: `${pin.lat.toFixed(5)},${pin.lng.toFixed(5)}`,
006295| NOTE: Implementation detail supporting search page behavior.
006296| src/components/Map.tsx:509:           lat: pin.lat,
006297| NOTE: Implementation detail supporting search page behavior.
006298| src/components/Map.tsx:510:           lng: pin.lng,
006299| NOTE: Implementation detail supporting search page behavior.
006300| src/components/Map.tsx:511:           groupRank: pin.tier === "primary" ? 0 : 999,
006301| NOTE: Implementation detail supporting search page behavior.
006302| src/components/Map.tsx:512:           tier: pin.tier || "mini",
006303| NOTE: Implementation detail supporting search page behavior.
006304| src/components/Map.tsx:513:           // Use real listing data when available, fallback to pin values
006305| NOTE: Line comment documents intent or constraints.
006306| src/components/Map.tsx:514:           listings: listing
006307| NOTE: Implementation detail supporting search page behavior.
006308| src/components/Map.tsx:515:             ? [listing]
006309| NOTE: Implementation detail supporting search page behavior.
006310| src/components/Map.tsx:516:             : [
006311| NOTE: Implementation detail supporting search page behavior.
006312| src/components/Map.tsx:517:                 {
006313| NOTE: Implementation detail supporting search page behavior.
006314| src/components/Map.tsx:518:                   id: pin.id,
006315| NOTE: Implementation detail supporting search page behavior.
006316| src/components/Map.tsx:519:                   title: "",
006317| NOTE: Implementation detail supporting search page behavior.
006318| src/components/Map.tsx:520:                   price: pin.price ?? 0,
006319| NOTE: Implementation detail supporting search page behavior.
006320| src/components/Map.tsx:521:                   availableSlots: 0,
006321| NOTE: Implementation detail supporting search page behavior.
006322| src/components/Map.tsx:522:                   ownerId: undefined,
006323| NOTE: Implementation detail supporting search page behavior.
006324| src/components/Map.tsx:523:                   images: [],
006325| NOTE: Implementation detail supporting search page behavior.
006326| src/components/Map.tsx:524:                   location: { lat: pin.lat, lng: pin.lng },
006327| NOTE: Implementation detail supporting search page behavior.
006328| src/components/Map.tsx:525:                 },
006329| NOTE: Implementation detail supporting search page behavior.
006330| src/components/Map.tsx:526:               ],
006331| NOTE: Implementation detail supporting search page behavior.
006332| src/components/Map.tsx:527:           // Explicit stackCount from v2 pins (don't rely on listings.length)
006333| NOTE: Line comment documents intent or constraints.
006334| src/components/Map.tsx:528:           stackCount: pin.stackCount ?? 1,
006335| NOTE: Implementation detail supporting search page behavior.
006336| src/components/Map.tsx:529:         } as TieredGroup & { stackCount?: number };
006337| NOTE: Implementation detail supporting search page behavior.
006338| src/components/Map.tsx:530:       });
006339| NOTE: Implementation detail supporting search page behavior.
006340| src/components/Map.tsx:531:     }
006341| NOTE: Implementation detail supporting search page behavior.
006342| src/components/Map.tsx:532: 
006343| NOTE: Blank line for visual separation.
006344| src/components/Map.tsx:533:     // V1 path or V2 dense mode: compute client-side
006345| NOTE: Line comment documents intent or constraints.
006346| src/components/Map.tsx:534:     const groups = groupListingsByCoord(markersSource);
006347| NOTE: Local declaration used by search logic or UI.
006348| src/components/Map.tsx:535:     return computeTieredGroups(groups, rankMap, PRIMARY_PIN_LIMIT);
006349| NOTE: Return statement for component or helper output.
006350| src/components/Map.tsx:536:   }, [useV2Source, v2MapData, listingById, markersSource, rankMap]);
006351| NOTE: Implementation detail supporting search page behavior.
006352| src/components/Map.tsx:537: 
006353| NOTE: Blank line for visual separation.
006354| src/components/Map.tsx:538:   // Split for rendering order (mini first = lower z-index)
006355| NOTE: Line comment documents intent or constraints.
006356| src/components/Map.tsx:539:   const { primaryGroups, miniGroups } = useMemo(
006357| NOTE: Memoizes derived values to reduce re-render work.
006358| src/components/Map.tsx:540:     () => ({
006359| NOTE: Implementation detail supporting search page behavior.
006360| src/components/Map.tsx:541:       primaryGroups: tieredGroups.filter((g) => g.tier === "primary"),
006361| NOTE: Implementation detail supporting search page behavior.
006362| src/components/Map.tsx:542:       miniGroups: tieredGroups.filter((g) => g.tier === "mini"),
006363| NOTE: Implementation detail supporting search page behavior.
006364| src/components/Map.tsx:543:     }),
006365| NOTE: Implementation detail supporting search page behavior.
006366| src/components/Map.tsx:544:     [tieredGroups],
006367| NOTE: Implementation detail supporting search page behavior.
006368| src/components/Map.tsx:545:   );
006369| NOTE: Implementation detail supporting search page behavior.
006370| src/components/Map.tsx:546: 
006371| NOTE: Blank line for visual separation.
006372| src/components/Map.tsx:547:   // Default to San Francisco if no listings, or center on first listing
006373| NOTE: Line comment documents intent or constraints.
006374| src/components/Map.tsx:548:   const initialViewState =
006375| NOTE: Local declaration used by search logic or UI.
006376| src/components/Map.tsx:549:     effectiveListings.length > 0
006377| NOTE: Implementation detail supporting search page behavior.
006378| src/components/Map.tsx:550:       ? {
006379| NOTE: Implementation detail supporting search page behavior.
006380| src/components/Map.tsx:551:           longitude: effectiveListings[0].location.lng,
006381| NOTE: Implementation detail supporting search page behavior.
006382| src/components/Map.tsx:552:           latitude: effectiveListings[0].location.lat,
006383| NOTE: Implementation detail supporting search page behavior.
006384| src/components/Map.tsx:553:           zoom: 12,
006385| NOTE: Implementation detail supporting search page behavior.
006386| src/components/Map.tsx:554:         }
006387| NOTE: Implementation detail supporting search page behavior.
006388| src/components/Map.tsx:555:       : { longitude: -122.4194, latitude: 37.7749, zoom: 12 };
006389| NOTE: Implementation detail supporting search page behavior.
006390| src/components/Map.tsx:556: 
006391| NOTE: Blank line for visual separation.
006392| src/components/Map.tsx:557:   // Auto-fly to listings on search (but not on map move)
006393| NOTE: Line comment documents intent or constraints.
006394| src/components/Map.tsx:558:   useEffect(() => {
006395| NOTE: Defines side effect for syncing with external state.
006396| src/components/Map.tsx:559:     if (!mapRef.current || effectiveListings.length === 0) return;
006397| NOTE: Conditional logic controlling rendering or flow.
006398| src/components/Map.tsx:560: 
006399| NOTE: Blank line for visual separation.
006400| src/components/Map.tsx:561:     // If we have map bounds in the URL, it means the user is panning/zooming manually
006401| NOTE: Line comment documents intent or constraints.
006402| src/components/Map.tsx:562:     // So we shouldn't auto-fly the map
006403| NOTE: Line comment documents intent or constraints.
006404| src/components/Map.tsx:563:     if (searchParams.has("minLat")) return;
006405| NOTE: Conditional logic controlling rendering or flow.
006406| src/components/Map.tsx:564: 
006407| NOTE: Blank line for visual separation.
006408| src/components/Map.tsx:565:     // Skip if user has manually interacted with map this session
006409| NOTE: Line comment documents intent or constraints.
006410| src/components/Map.tsx:566:     if (hasUserMoved) return;
006411| NOTE: Conditional logic controlling rendering or flow.
006412| src/components/Map.tsx:567: 
006413| NOTE: Blank line for visual separation.
006414| src/components/Map.tsx:568:     // Skip if we've already auto-fit once this session
006415| NOTE: Line comment documents intent or constraints.
006416| src/components/Map.tsx:569:     if (hasAutoFitRef.current) return;
006417| NOTE: Conditional logic controlling rendering or flow.
006418| src/components/Map.tsx:570: 
006419| NOTE: Blank line for visual separation.
006420| src/components/Map.tsx:571:     hasAutoFitRef.current = true;
006421| NOTE: Implementation detail supporting search page behavior.
006422| src/components/Map.tsx:572: 
006423| NOTE: Blank line for visual separation.
006424| src/components/Map.tsx:573:     const points = effectiveListings.map((l) => ({
006425| NOTE: Local declaration used by search logic or UI.
006426| src/components/Map.tsx:574:       lng: l.location.lng,
006427| NOTE: Implementation detail supporting search page behavior.
006428| src/components/Map.tsx:575:       lat: l.location.lat,
006429| NOTE: Implementation detail supporting search page behavior.
006430| src/components/Map.tsx:576:     }));
006431| NOTE: Implementation detail supporting search page behavior.
006432| src/components/Map.tsx:577: 
006433| NOTE: Blank line for visual separation.
006434| src/components/Map.tsx:578:     // Mark as programmatic move so handleMoveEnd doesn't treat it as user action
006435| NOTE: Line comment documents intent or constraints.
006436| src/components/Map.tsx:579:     isProgrammaticMoveRef.current = true;
006437| NOTE: Implementation detail supporting search page behavior.
006438| src/components/Map.tsx:580: 
006439| NOTE: Blank line for visual separation.
006440| src/components/Map.tsx:581:     if (points.length === 1) {
006441| NOTE: Conditional logic controlling rendering or flow.
006442| src/components/Map.tsx:582:       mapRef.current.flyTo({
006443| NOTE: Implementation detail supporting search page behavior.
006444| src/components/Map.tsx:583:         center: [points[0].lng, points[0].lat],
006445| NOTE: Implementation detail supporting search page behavior.
006446| src/components/Map.tsx:584:         zoom: 14,
006447| NOTE: Implementation detail supporting search page behavior.
006448| src/components/Map.tsx:585:         duration: 2000,
006449| NOTE: Implementation detail supporting search page behavior.
006450| src/components/Map.tsx:586:       });
006451| NOTE: Implementation detail supporting search page behavior.
006452| src/components/Map.tsx:587:     } else {
006453| NOTE: Implementation detail supporting search page behavior.
006454| src/components/Map.tsx:588:       // Calculate bounds
006455| NOTE: Line comment documents intent or constraints.
006456| src/components/Map.tsx:589:       const minLng = Math.min(...points.map((p) => p.lng));
006457| NOTE: Local declaration used by search logic or UI.
006458| src/components/Map.tsx:590:       const maxLng = Math.max(...points.map((p) => p.lng));
006459| NOTE: Local declaration used by search logic or UI.
006460| src/components/Map.tsx:591:       const minLat = Math.min(...points.map((p) => p.lat));
006461| NOTE: Local declaration used by search logic or UI.
006462| src/components/Map.tsx:592:       const maxLat = Math.max(...points.map((p) => p.lat));
006463| NOTE: Local declaration used by search logic or UI.
006464| src/components/Map.tsx:593: 
006465| NOTE: Blank line for visual separation.
006466| src/components/Map.tsx:594:       mapRef.current.fitBounds(
006467| NOTE: Implementation detail supporting search page behavior.
006468| src/components/Map.tsx:595:         [
006469| NOTE: Implementation detail supporting search page behavior.
006470| src/components/Map.tsx:596:           [minLng, minLat],
006471| NOTE: Implementation detail supporting search page behavior.
006472| src/components/Map.tsx:597:           [maxLng, maxLat],
006473| NOTE: Implementation detail supporting search page behavior.
006474| src/components/Map.tsx:598:         ],
006475| NOTE: Implementation detail supporting search page behavior.
006476| src/components/Map.tsx:599:         {
006477| NOTE: Implementation detail supporting search page behavior.
006478| src/components/Map.tsx:600:           padding: { top: 50, bottom: 50, left: 50, right: 50 },
006479| NOTE: Implementation detail supporting search page behavior.
006480| src/components/Map.tsx:601:           duration: 2000,
006481| NOTE: Implementation detail supporting search page behavior.
006482| src/components/Map.tsx:602:         },
006483| NOTE: Implementation detail supporting search page behavior.
006484| src/components/Map.tsx:603:       );
006485| NOTE: Implementation detail supporting search page behavior.
006486| src/components/Map.tsx:604:     }
006487| NOTE: Implementation detail supporting search page behavior.
006488| src/components/Map.tsx:605:   }, [effectiveListings, searchParams, hasUserMoved]);
006489| NOTE: Implementation detail supporting search page behavior.
006490| src/components/Map.tsx:606: 
006491| NOTE: Blank line for visual separation.
006492| src/components/Map.tsx:607:   // Listen for fly-to events from location search
006493| NOTE: Line comment documents intent or constraints.
006494| src/components/Map.tsx:608:   useEffect(() => {
006495| NOTE: Defines side effect for syncing with external state.
006496| src/components/Map.tsx:609:     const handleFlyTo = (event: CustomEvent<MapFlyToEventDetail>) => {
006497| NOTE: Local declaration used by search logic or UI.
006498| src/components/Map.tsx:610:       if (!mapRef.current) return;
006499| NOTE: Conditional logic controlling rendering or flow.
006500| src/components/Map.tsx:611: 
006501| NOTE: Blank line for visual separation.
006502| src/components/Map.tsx:612:       const { lat, lng, bbox, zoom, locationName } = event.detail;
006503| NOTE: Local declaration used by search logic or UI.
006504| src/components/Map.tsx:613: 
006505| NOTE: Blank line for visual separation.
006506| src/components/Map.tsx:614:       // Mark as programmatic move so handleMoveEnd doesn't treat it as user action
006507| NOTE: Line comment documents intent or constraints.
006508| src/components/Map.tsx:615:       isProgrammaticMoveRef.current = true;
006509| NOTE: Implementation detail supporting search page behavior.
006510| src/components/Map.tsx:616:       // Reset user interaction tracking when explicit location selected
006511| NOTE: Line comment documents intent or constraints.
006512| src/components/Map.tsx:617:       setHasUserMoved(false);
006513| NOTE: Implementation detail supporting search page behavior.
006514| src/components/Map.tsx:618:       setBoundsDirty(false);
006515| NOTE: Implementation detail supporting search page behavior.
006516| src/components/Map.tsx:619:       // Allow auto-fit again since user explicitly selected a new location
006517| NOTE: Line comment documents intent or constraints.
006518| src/components/Map.tsx:620:       hasAutoFitRef.current = false;
006519| NOTE: Implementation detail supporting search page behavior.
006520| src/components/Map.tsx:621:       // Store search location for conflict detection
006521| NOTE: Line comment documents intent or constraints.
006522| src/components/Map.tsx:622:       if (locationName) {
006523| NOTE: Conditional logic controlling rendering or flow.
006524| src/components/Map.tsx:623:         setSearchLocation(locationName, { lat, lng });
006525| NOTE: Implementation detail supporting search page behavior.
006526| src/components/Map.tsx:624:       }
006527| NOTE: Implementation detail supporting search page behavior.
006528| src/components/Map.tsx:625: 
006529| NOTE: Blank line for visual separation.
006530| src/components/Map.tsx:626:       // If bbox (bounding box) is available, use fitBounds for a better view
006531| NOTE: Line comment documents intent or constraints.
006532| src/components/Map.tsx:627:       if (bbox) {
006533| NOTE: Conditional logic controlling rendering or flow.
006534| src/components/Map.tsx:628:         mapRef.current.fitBounds(
006535| NOTE: Implementation detail supporting search page behavior.
006536| src/components/Map.tsx:629:           [
006537| NOTE: Implementation detail supporting search page behavior.
006538| src/components/Map.tsx:630:             [bbox[0], bbox[1]], // [minLng, minLat]
006539| NOTE: Implementation detail supporting search page behavior.
006540| src/components/Map.tsx:631:             [bbox[2], bbox[3]], // [maxLng, maxLat]
006541| NOTE: Implementation detail supporting search page behavior.
006542| src/components/Map.tsx:632:           ],
006543| NOTE: Implementation detail supporting search page behavior.
006544| src/components/Map.tsx:633:           {
006545| NOTE: Implementation detail supporting search page behavior.
006546| src/components/Map.tsx:634:             padding: { top: 50, bottom: 50, left: 50, right: 50 },
006547| NOTE: Implementation detail supporting search page behavior.
006548| src/components/Map.tsx:635:             duration: 2000,
006549| NOTE: Implementation detail supporting search page behavior.
006550| src/components/Map.tsx:636:             essential: true,
006551| NOTE: Implementation detail supporting search page behavior.
006552| src/components/Map.tsx:637:           },
006553| NOTE: Implementation detail supporting search page behavior.
006554| src/components/Map.tsx:638:         );
006555| NOTE: Implementation detail supporting search page behavior.
006556| src/components/Map.tsx:639:       } else {
006557| NOTE: Implementation detail supporting search page behavior.
006558| src/components/Map.tsx:640:         // Use flyTo with smooth animation
006559| NOTE: Line comment documents intent or constraints.
006560| src/components/Map.tsx:641:         mapRef.current.flyTo({
006561| NOTE: Implementation detail supporting search page behavior.
006562| src/components/Map.tsx:642:           center: [lng, lat],
006563| NOTE: Implementation detail supporting search page behavior.
006564| src/components/Map.tsx:643:           zoom: zoom || 13,
006565| NOTE: Implementation detail supporting search page behavior.
006566| src/components/Map.tsx:644:           duration: 2000,
006567| NOTE: Implementation detail supporting search page behavior.
006568| src/components/Map.tsx:645:           essential: true,
006569| NOTE: Implementation detail supporting search page behavior.
006570| src/components/Map.tsx:646:           curve: 1.42, // Animation curve (ease)
006571| NOTE: Implementation detail supporting search page behavior.
006572| src/components/Map.tsx:647:           speed: 1.2, // Animation speed
006573| NOTE: Implementation detail supporting search page behavior.
006574| src/components/Map.tsx:648:         });
006575| NOTE: Implementation detail supporting search page behavior.
006576| src/components/Map.tsx:649:       }
006577| NOTE: Implementation detail supporting search page behavior.
006578| src/components/Map.tsx:650:     };
006579| NOTE: Implementation detail supporting search page behavior.
006580| src/components/Map.tsx:651: 
006581| NOTE: Blank line for visual separation.
006582| src/components/Map.tsx:652:     window.addEventListener(MAP_FLY_TO_EVENT, handleFlyTo as EventListener);
006583| NOTE: Implementation detail supporting search page behavior.
006584| src/components/Map.tsx:653:     return () => {
006585| NOTE: Return statement for component or helper output.
006586| src/components/Map.tsx:654:       window.removeEventListener(
006587| NOTE: Implementation detail supporting search page behavior.
006588| src/components/Map.tsx:655:         MAP_FLY_TO_EVENT,
006589| NOTE: Implementation detail supporting search page behavior.
006590| src/components/Map.tsx:656:         handleFlyTo as EventListener,
006591| NOTE: Implementation detail supporting search page behavior.
006592| src/components/Map.tsx:657:       );
006593| NOTE: Implementation detail supporting search page behavior.
006594| src/components/Map.tsx:658:     };
006595| NOTE: Implementation detail supporting search page behavior.
006596| src/components/Map.tsx:659:   }, [setHasUserMoved, setBoundsDirty, setSearchLocation]);
006597| NOTE: Implementation detail supporting search page behavior.
006598| src/components/Map.tsx:660: 
006599| NOTE: Blank line for visual separation.
006600| src/components/Map.tsx:661:   // Clear searching state when listings update from SSR
006601| NOTE: Line comment documents intent or constraints.
006602| src/components/Map.tsx:662:   useEffect(() => {
006603| NOTE: Defines side effect for syncing with external state.
006604| src/components/Map.tsx:663:     setIsSearching(false);
006605| NOTE: Implementation detail supporting search page behavior.
006606| src/components/Map.tsx:664:   }, [listings]);
006607| NOTE: Implementation detail supporting search page behavior.
006608| src/components/Map.tsx:665: 
006609| NOTE: Blank line for visual separation.
006610| src/components/Map.tsx:666:   // Cleanup timers on unmount
006611| NOTE: Line comment documents intent or constraints.
006612| src/components/Map.tsx:667:   useEffect(() => {
006613| NOTE: Defines side effect for syncing with external state.
006614| src/components/Map.tsx:668:     return () => {
006615| NOTE: Return statement for component or helper output.
006616| src/components/Map.tsx:669:       if (debounceTimer.current) {
006617| NOTE: Conditional logic controlling rendering or flow.
006618| src/components/Map.tsx:670:         clearTimeout(debounceTimer.current);
006619| NOTE: Implementation detail supporting search page behavior.
006620| src/components/Map.tsx:671:       }
006621| NOTE: Implementation detail supporting search page behavior.
006622| src/components/Map.tsx:672:       if (throttleTimeoutRef.current) {
006623| NOTE: Conditional logic controlling rendering or flow.
006624| src/components/Map.tsx:673:         clearTimeout(throttleTimeoutRef.current);
006625| NOTE: Implementation detail supporting search page behavior.
006626| src/components/Map.tsx:674:       }
006627| NOTE: Implementation detail supporting search page behavior.
006628| src/components/Map.tsx:675:     };
006629| NOTE: Implementation detail supporting search page behavior.
006630| src/components/Map.tsx:676:   }, []);
006631| NOTE: Implementation detail supporting search page behavior.
006632| src/components/Map.tsx:677: 
006633| NOTE: Blank line for visual separation.
006634| src/components/Map.tsx:678:   // Handle pending focus from "View on map" button clicks
006635| NOTE: Line comment documents intent or constraints.
006636| src/components/Map.tsx:679:   // NOTE: ListingCard owns setActive (user-initiated). Map only handles flyTo + popup.
006637| NOTE: Line comment documents intent or constraints.
006638| src/components/Map.tsx:680:   useEffect(() => {
006639| NOTE: Defines side effect for syncing with external state.
006640| src/components/Map.tsx:681:     if (!pendingFocus || !mapRef.current || !isMapLoaded) return;
006641| NOTE: Conditional logic controlling rendering or flow.
006642| src/components/Map.tsx:682: 
006643| NOTE: Blank line for visual separation.
006644| src/components/Map.tsx:683:     const { listingId, nonce } = pendingFocus;
006645| NOTE: Local declaration used by search logic or UI.
006646| src/components/Map.tsx:684:     const targetListing = effectiveListings.find((l) => l.id === listingId);
006647| NOTE: Local declaration used by search logic or UI.
006648| src/components/Map.tsx:685: 
006649| NOTE: Blank line for visual separation.
006650| src/components/Map.tsx:686:     if (!targetListing) return; // Not in viewport yet, wait for data
006651| NOTE: Conditional logic controlling rendering or flow.
006652| src/components/Map.tsx:687: 
006653| NOTE: Blank line for visual separation.
006654| src/components/Map.tsx:688:     const { lat, lng } = targetListing.location;
006655| NOTE: Local declaration used by search logic or UI.
006656| src/components/Map.tsx:689:     const map = mapRef.current;
006657| NOTE: Local declaration used by search logic or UI.
006658| src/components/Map.tsx:690: 
006659| NOTE: Blank line for visual separation.
006660| src/components/Map.tsx:691:     // Prevent dirty bounds state from programmatic move
006661| NOTE: Line comment documents intent or constraints.
006662| src/components/Map.tsx:692:     isProgrammaticMoveRef.current = true;
006663| NOTE: Implementation detail supporting search page behavior.
006664| src/components/Map.tsx:693: 
006665| NOTE: Blank line for visual separation.
006666| src/components/Map.tsx:694:     // Open popup after flyTo completes (using moveend event, not setTimeout)
006667| NOTE: Line comment documents intent or constraints.
006668| src/components/Map.tsx:695:     const handleMoveEnd = () => {
006669| NOTE: Local declaration used by search logic or UI.
006670| src/components/Map.tsx:696:       const targetGroup = tieredGroups.find((g) =>
006671| NOTE: Local declaration used by search logic or UI.
006672| src/components/Map.tsx:697:         g.listings.some((l) => l.id === listingId),
006673| NOTE: Implementation detail supporting search page behavior.
006674| src/components/Map.tsx:698:       );
006675| NOTE: Implementation detail supporting search page behavior.
006676| src/components/Map.tsx:699: 
006677| NOTE: Blank line for visual separation.
006678| src/components/Map.tsx:700:       if (targetGroup && targetGroup.listings.length > 1) {
006679| NOTE: Conditional logic controlling rendering or flow.
006680| src/components/Map.tsx:701:         setSelectedGroup(targetGroup);
006681| NOTE: Implementation detail supporting search page behavior.
006682| src/components/Map.tsx:702:         setSelectedListing(null);
006683| NOTE: Implementation detail supporting search page behavior.
006684| src/components/Map.tsx:703:       } else {
006685| NOTE: Implementation detail supporting search page behavior.
006686| src/components/Map.tsx:704:         setSelectedListing(targetListing);
006687| NOTE: Implementation detail supporting search page behavior.
006688| src/components/Map.tsx:705:         setSelectedGroup(null);
006689| NOTE: Implementation detail supporting search page behavior.
006690| src/components/Map.tsx:706:       }
006691| NOTE: Implementation detail supporting search page behavior.
006692| src/components/Map.tsx:707: 
006693| NOTE: Blank line for visual separation.
006694| src/components/Map.tsx:708:       // Acknowledge only after popup is opened
006695| NOTE: Line comment documents intent or constraints.
006696| src/components/Map.tsx:709:       acknowledgeFocus(nonce);
006697| NOTE: Implementation detail supporting search page behavior.
006698| src/components/Map.tsx:710:     };
006699| NOTE: Implementation detail supporting search page behavior.
006700| src/components/Map.tsx:711: 
006701| NOTE: Blank line for visual separation.
006702| src/components/Map.tsx:712:     // Use once() so handler auto-removes after firing
006703| NOTE: Line comment documents intent or constraints.
006704| src/components/Map.tsx:713:     map.once("moveend", handleMoveEnd);
006705| NOTE: Implementation detail supporting search page behavior.
006706| src/components/Map.tsx:714: 
006707| NOTE: Blank line for visual separation.
006708| src/components/Map.tsx:715:     // Fly to listing
006709| NOTE: Line comment documents intent or constraints.
006710| src/components/Map.tsx:716:     map.flyTo({
006711| NOTE: Implementation detail supporting search page behavior.
006712| src/components/Map.tsx:717:       center: [lng, lat],
006713| NOTE: Implementation detail supporting search page behavior.
006714| src/components/Map.tsx:718:       zoom: Math.max(map.getZoom() || 14, 14),
006715| NOTE: Implementation detail supporting search page behavior.
006716| src/components/Map.tsx:719:       duration: 1500,
006717| NOTE: Implementation detail supporting search page behavior.
006718| src/components/Map.tsx:720:       essential: true,
006719| NOTE: Implementation detail supporting search page behavior.
006720| src/components/Map.tsx:721:     });
006721| NOTE: Implementation detail supporting search page behavior.
006722| src/components/Map.tsx:722: 
006723| NOTE: Blank line for visual separation.
006724| src/components/Map.tsx:723:     // Cleanup if effect re-runs before moveend fires
006725| NOTE: Line comment documents intent or constraints.
006726| src/components/Map.tsx:724:     return () => {
006727| NOTE: Return statement for component or helper output.
006728| src/components/Map.tsx:725:       map.off("moveend", handleMoveEnd);
006729| NOTE: Implementation detail supporting search page behavior.
006730| src/components/Map.tsx:726:     };
006731| NOTE: Implementation detail supporting search page behavior.
006732| src/components/Map.tsx:727:   }, [pendingFocus, listings, tieredGroups, isMapLoaded, acknowledgeFocus]);
006733| NOTE: Implementation detail supporting search page behavior.
006734| src/components/Map.tsx:728: 
006735| NOTE: Blank line for visual separation.
006736| src/components/Map.tsx:729:   // Suppress mapbox-gl worker communication errors during HMR/Turbopack
006737| NOTE: Line comment documents intent or constraints.
006738| src/components/Map.tsx:730:   // These are non-fatal and occur when the worker connection is lost during hot reload
006739| NOTE: Line comment documents intent or constraints.
006740| src/components/Map.tsx:731:   useEffect(() => {
006741| NOTE: Defines side effect for syncing with external state.
006742| src/components/Map.tsx:732:     const handleError = (event: ErrorEvent) => {
006743| NOTE: Local declaration used by search logic or UI.
006744| src/components/Map.tsx:733:       const message = event.message || "";
006745| NOTE: Local declaration used by search logic or UI.
006746| src/components/Map.tsx:734:       if (
006747| NOTE: Conditional logic controlling rendering or flow.
006748| src/components/Map.tsx:735:         message.includes("reading 'send'") ||
006749| NOTE: Implementation detail supporting search page behavior.
006750| src/components/Map.tsx:736:         message.includes("reading 'target'") ||
006751| NOTE: Implementation detail supporting search page behavior.
006752| src/components/Map.tsx:737:         message.includes("Actor")
006753| NOTE: Implementation detail supporting search page behavior.
006754| src/components/Map.tsx:738:       ) {
006755| NOTE: Implementation detail supporting search page behavior.
006756| src/components/Map.tsx:739:         event.preventDefault();
006757| NOTE: Implementation detail supporting search page behavior.
006758| src/components/Map.tsx:740:         console.warn("[Map] Suppressed worker communication error during HMR");
006759| NOTE: Implementation detail supporting search page behavior.
006760| src/components/Map.tsx:741:       }
006761| NOTE: Implementation detail supporting search page behavior.
006762| src/components/Map.tsx:742:     };
006763| NOTE: Implementation detail supporting search page behavior.
006764| src/components/Map.tsx:743: 
006765| NOTE: Blank line for visual separation.
006766| src/components/Map.tsx:744:     const handleRejection = (event: PromiseRejectionEvent) => {
006767| NOTE: Local declaration used by search logic or UI.
006768| src/components/Map.tsx:745:       const message = String(event.reason?.message || event.reason || "");
006769| NOTE: Local declaration used by search logic or UI.
006770| src/components/Map.tsx:746:       if (
006771| NOTE: Conditional logic controlling rendering or flow.
006772| src/components/Map.tsx:747:         message.includes("reading 'send'") ||
006773| NOTE: Implementation detail supporting search page behavior.
006774| src/components/Map.tsx:748:         message.includes("reading 'target'") ||
006775| NOTE: Implementation detail supporting search page behavior.
006776| src/components/Map.tsx:749:         message.includes("Actor")
006777| NOTE: Implementation detail supporting search page behavior.
006778| src/components/Map.tsx:750:       ) {
006779| NOTE: Implementation detail supporting search page behavior.
006780| src/components/Map.tsx:751:         event.preventDefault();
006781| NOTE: Implementation detail supporting search page behavior.
006782| src/components/Map.tsx:752:         console.warn("[Map] Suppressed worker rejection during HMR");
006783| NOTE: Implementation detail supporting search page behavior.
006784| src/components/Map.tsx:753:       }
006785| NOTE: Implementation detail supporting search page behavior.
006786| src/components/Map.tsx:754:     };
006787| NOTE: Implementation detail supporting search page behavior.
006788| src/components/Map.tsx:755: 
006789| NOTE: Blank line for visual separation.
006790| src/components/Map.tsx:756:     window.addEventListener("error", handleError);
006791| NOTE: Implementation detail supporting search page behavior.
006792| src/components/Map.tsx:757:     window.addEventListener("unhandledrejection", handleRejection);
006793| NOTE: Implementation detail supporting search page behavior.
006794| src/components/Map.tsx:758:     return () => {
006795| NOTE: Return statement for component or helper output.
006796| src/components/Map.tsx:759:       window.removeEventListener("error", handleError);
006797| NOTE: Implementation detail supporting search page behavior.
006798| src/components/Map.tsx:760:       window.removeEventListener("unhandledrejection", handleRejection);
006799| NOTE: Implementation detail supporting search page behavior.
006800| src/components/Map.tsx:761:     };
006801| NOTE: Implementation detail supporting search page behavior.
006802| src/components/Map.tsx:762:   }, []);
006803| NOTE: Implementation detail supporting search page behavior.
006804| src/components/Map.tsx:763: 
006805| NOTE: Blank line for visual separation.
006806| src/components/Map.tsx:764:   // Helper to compare bounds with tolerance (~100m at equator)
006807| NOTE: Line comment documents intent or constraints.
006808| src/components/Map.tsx:765:   const boundsApproximatelyEqual = useCallback(
006809| NOTE: Memoizes callback to preserve references across renders.
006810| src/components/Map.tsx:766:     (
006811| NOTE: Implementation detail supporting search page behavior.
006812| src/components/Map.tsx:767:       a: { minLng: number; maxLng: number; minLat: number; maxLat: number },
006813| NOTE: Implementation detail supporting search page behavior.
006814| src/components/Map.tsx:768:       b: { minLng: number; maxLng: number; minLat: number; maxLat: number },
006815| NOTE: Implementation detail supporting search page behavior.
006816| src/components/Map.tsx:769:       epsilon = 0.001,
006817| NOTE: Implementation detail supporting search page behavior.
006818| src/components/Map.tsx:770:     ) => {
006819| NOTE: Implementation detail supporting search page behavior.
006820| src/components/Map.tsx:771:       return (
006821| NOTE: Return statement for component or helper output.
006822| src/components/Map.tsx:772:         Math.abs(a.minLng - b.minLng) < epsilon &&
006823| NOTE: Implementation detail supporting search page behavior.
006824| src/components/Map.tsx:773:         Math.abs(a.maxLng - b.maxLng) < epsilon &&
006825| NOTE: Implementation detail supporting search page behavior.
006826| src/components/Map.tsx:774:         Math.abs(a.minLat - b.minLat) < epsilon &&
006827| NOTE: Implementation detail supporting search page behavior.
006828| src/components/Map.tsx:775:         Math.abs(a.maxLat - b.maxLat) < epsilon
006829| NOTE: Implementation detail supporting search page behavior.
006830| src/components/Map.tsx:776:       );
006831| NOTE: Implementation detail supporting search page behavior.
006832| src/components/Map.tsx:777:     },
006833| NOTE: Implementation detail supporting search page behavior.
006834| src/components/Map.tsx:778:     [],
006835| NOTE: Implementation detail supporting search page behavior.
006836| src/components/Map.tsx:779:   );
006837| NOTE: Implementation detail supporting search page behavior.
006838| src/components/Map.tsx:780: 
006839| NOTE: Blank line for visual separation.
006840| src/components/Map.tsx:781:   // Execute the actual search with the given bounds
006841| NOTE: Line comment documents intent or constraints.
006842| src/components/Map.tsx:782:   const executeMapSearch = useCallback(
006843| NOTE: Memoizes callback to preserve references across renders.
006844| src/components/Map.tsx:783:     (bounds: {
006845| NOTE: Implementation detail supporting search page behavior.
006846| src/components/Map.tsx:784:       minLng: number;
006847| NOTE: Implementation detail supporting search page behavior.
006848| src/components/Map.tsx:785:       maxLng: number;
006849| NOTE: Implementation detail supporting search page behavior.
006850| src/components/Map.tsx:786:       minLat: number;
006851| NOTE: Implementation detail supporting search page behavior.
006852| src/components/Map.tsx:787:       maxLat: number;
006853| NOTE: Implementation detail supporting search page behavior.
006854| src/components/Map.tsx:788:     }) => {
006855| NOTE: Implementation detail supporting search page behavior.
006856| src/components/Map.tsx:789:       const params = new URLSearchParams(searchParams.toString());
006857| NOTE: Local declaration used by search logic or UI.
006858| src/components/Map.tsx:790: 
006859| NOTE: Blank line for visual separation.
006860| src/components/Map.tsx:791:       // Remove single point coordinates since we now have bounds
006861| NOTE: Line comment documents intent or constraints.
006862| src/components/Map.tsx:792:       params.delete("lat");
006863| NOTE: Implementation detail supporting search page behavior.
006864| src/components/Map.tsx:793:       params.delete("lng");
006865| NOTE: Implementation detail supporting search page behavior.
006866| src/components/Map.tsx:794:       params.delete("page");
006867| NOTE: Implementation detail supporting search page behavior.
006868| src/components/Map.tsx:795: 
006869| NOTE: Blank line for visual separation.
006870| src/components/Map.tsx:796:       params.set("minLng", bounds.minLng.toString());
006871| NOTE: Implementation detail supporting search page behavior.
006872| src/components/Map.tsx:797:       params.set("maxLng", bounds.maxLng.toString());
006873| NOTE: Implementation detail supporting search page behavior.
006874| src/components/Map.tsx:798:       params.set("minLat", bounds.minLat.toString());
006875| NOTE: Implementation detail supporting search page behavior.
006876| src/components/Map.tsx:799:       params.set("maxLat", bounds.maxLat.toString());
006877| NOTE: Implementation detail supporting search page behavior.
006878| src/components/Map.tsx:800: 
006879| NOTE: Blank line for visual separation.
006880| src/components/Map.tsx:801:       lastSearchTimeRef.current = Date.now();
006881| NOTE: Implementation detail supporting search page behavior.
006882| src/components/Map.tsx:802:       pendingBoundsRef.current = null;
006883| NOTE: Implementation detail supporting search page behavior.
006884| src/components/Map.tsx:803:       setIsSearching(true);
006885| NOTE: Implementation detail supporting search page behavior.
006886| src/components/Map.tsx:804:       // Use replace instead of push to avoid huge browser history stack on every pan
006887| NOTE: Line comment documents intent or constraints.
006888| src/components/Map.tsx:805:       // push: 100 pans = 100 history entries (bad UX)
006889| NOTE: Line comment documents intent or constraints.
006890| src/components/Map.tsx:806:       // replace: updates current entry, back goes to previous page (good UX)
006891| NOTE: Line comment documents intent or constraints.
006892| src/components/Map.tsx:807:       router.replace(`/search?${params.toString()}`);
006893| NOTE: Routing logic updates search URL state.
006894| src/components/Map.tsx:808:     },
006895| NOTE: Implementation detail supporting search page behavior.
006896| src/components/Map.tsx:809:     [router, searchParams],
006897| NOTE: Implementation detail supporting search page behavior.
006898| src/components/Map.tsx:810:   );
006899| NOTE: Implementation detail supporting search page behavior.
006900| src/components/Map.tsx:811: 
006901| NOTE: Blank line for visual separation.
006902| src/components/Map.tsx:812:   // Reset map view to URL bounds (for "Reset" button in CTA)
006903| NOTE: Line comment documents intent or constraints.
006904| src/components/Map.tsx:813:   const handleResetToUrlBounds = useCallback(() => {
006905| NOTE: Memoizes callback to preserve references across renders.
006906| src/components/Map.tsx:814:     if (!mapRef.current) return;
006907| NOTE: Conditional logic controlling rendering or flow.
006908| src/components/Map.tsx:815:     const minLng = parseFloat(searchParams.get("minLng") || "");
006909| NOTE: Local declaration used by search logic or UI.
006910| src/components/Map.tsx:816:     const maxLng = parseFloat(searchParams.get("maxLng") || "");
006911| NOTE: Local declaration used by search logic or UI.
006912| src/components/Map.tsx:817:     const minLat = parseFloat(searchParams.get("minLat") || "");
006913| NOTE: Local declaration used by search logic or UI.
006914| src/components/Map.tsx:818:     const maxLat = parseFloat(searchParams.get("maxLat") || "");
006915| NOTE: Local declaration used by search logic or UI.
006916| src/components/Map.tsx:819: 
006917| NOTE: Blank line for visual separation.
006918| src/components/Map.tsx:820:     if (isNaN(minLng) || isNaN(maxLng) || isNaN(minLat) || isNaN(maxLat))
006919| NOTE: Conditional logic controlling rendering or flow.
006920| src/components/Map.tsx:821:       return;
006921| NOTE: Implementation detail supporting search page behavior.
006922| src/components/Map.tsx:822: 
006923| NOTE: Blank line for visual separation.
006924| src/components/Map.tsx:823:     isProgrammaticMoveRef.current = true; // Mark as programmatic
006925| NOTE: Implementation detail supporting search page behavior.
006926| src/components/Map.tsx:824:     mapRef.current.fitBounds(
006927| NOTE: Implementation detail supporting search page behavior.
006928| src/components/Map.tsx:825:       [
006929| NOTE: Implementation detail supporting search page behavior.
006930| src/components/Map.tsx:826:         [minLng, minLat],
006931| NOTE: Implementation detail supporting search page behavior.
006932| src/components/Map.tsx:827:         [maxLng, maxLat],
006933| NOTE: Implementation detail supporting search page behavior.
006934| src/components/Map.tsx:828:       ],
006935| NOTE: Implementation detail supporting search page behavior.
006936| src/components/Map.tsx:829:       {
006937| NOTE: Implementation detail supporting search page behavior.
006938| src/components/Map.tsx:830:         padding: 50,
006939| NOTE: Implementation detail supporting search page behavior.
006940| src/components/Map.tsx:831:         duration: 1000,
006941| NOTE: Implementation detail supporting search page behavior.
006942| src/components/Map.tsx:832:       },
006943| NOTE: Implementation detail supporting search page behavior.
006944| src/components/Map.tsx:833:     );
006945| NOTE: Implementation detail supporting search page behavior.
006946| src/components/Map.tsx:834:     setBoundsDirty(false);
006947| NOTE: Implementation detail supporting search page behavior.
006948| src/components/Map.tsx:835:   }, [searchParams, setBoundsDirty]);
006949| NOTE: Implementation detail supporting search page behavior.
006950| src/components/Map.tsx:836: 
006951| NOTE: Blank line for visual separation.
006952| src/components/Map.tsx:837:   // Handler for "Search this area" button - wraps executeMapSearch with current bounds
006953| NOTE: Line comment documents intent or constraints.
006954| src/components/Map.tsx:838:   const handleSearchThisArea = useCallback(() => {
006955| NOTE: Memoizes callback to preserve references across renders.
006956| src/components/Map.tsx:839:     if (currentMapBoundsRef.current) {
006957| NOTE: Conditional logic controlling rendering or flow.
006958| src/components/Map.tsx:840:       executeMapSearch(currentMapBoundsRef.current);
006959| NOTE: Implementation detail supporting search page behavior.
006960| src/components/Map.tsx:841:       setBoundsDirty(false);
006961| NOTE: Implementation detail supporting search page behavior.
006962| src/components/Map.tsx:842:     }
006963| NOTE: Implementation detail supporting search page behavior.
006964| src/components/Map.tsx:843:   }, [executeMapSearch, setBoundsDirty]);
006965| NOTE: Implementation detail supporting search page behavior.
006966| src/components/Map.tsx:844: 
006967| NOTE: Blank line for visual separation.
006968| src/components/Map.tsx:845:   // Register handlers with context so list banner can trigger them
006969| NOTE: Line comment documents intent or constraints.
006970| src/components/Map.tsx:846:   // Using destructured setters (stable references) instead of mapBoundsContext object
006971| NOTE: Line comment documents intent or constraints.
006972| src/components/Map.tsx:847:   useEffect(() => {
006973| NOTE: Defines side effect for syncing with external state.
006974| src/components/Map.tsx:848:     setSearchHandler(handleSearchThisArea);
006975| NOTE: Implementation detail supporting search page behavior.
006976| src/components/Map.tsx:849:     setResetHandler(handleResetToUrlBounds);
006977| NOTE: Implementation detail supporting search page behavior.
006978| src/components/Map.tsx:850:   }, [
006979| NOTE: Implementation detail supporting search page behavior.
006980| src/components/Map.tsx:851:     setSearchHandler,
006981| NOTE: Implementation detail supporting search page behavior.
006982| src/components/Map.tsx:852:     setResetHandler,
006983| NOTE: Implementation detail supporting search page behavior.
006984| src/components/Map.tsx:853:     handleSearchThisArea,
006985| NOTE: Implementation detail supporting search page behavior.
006986| src/components/Map.tsx:854:     handleResetToUrlBounds,
006987| NOTE: Implementation detail supporting search page behavior.
006988| src/components/Map.tsx:855:   ]);
006989| NOTE: Implementation detail supporting search page behavior.
006990| src/components/Map.tsx:856: 
006991| NOTE: Blank line for visual separation.
006992| src/components/Map.tsx:857:   // Sync searchAsMove with context
006993| NOTE: Line comment documents intent or constraints.
006994| src/components/Map.tsx:858:   useEffect(() => {
006995| NOTE: Defines side effect for syncing with external state.
006996| src/components/Map.tsx:859:     contextSetSearchAsMove(searchAsMove);
006997| NOTE: Implementation detail supporting search page behavior.
006998| src/components/Map.tsx:860:   }, [contextSetSearchAsMove, searchAsMove]);
006999| NOTE: Implementation detail supporting search page behavior.
007000| src/components/Map.tsx:861: 
007001| NOTE: Blank line for visual separation.
007002| src/components/Map.tsx:862:   // Fit map to show all current listings (for "Fit results" button)
007003| NOTE: Line comment documents intent or constraints.
007004| src/components/Map.tsx:863:   const handleFitResults = useCallback(() => {
007005| NOTE: Memoizes callback to preserve references across renders.
007006| src/components/Map.tsx:864:     if (!mapRef.current || effectiveListings.length === 0) return;
007007| NOTE: Conditional logic controlling rendering or flow.
007008| src/components/Map.tsx:865: 
007009| NOTE: Blank line for visual separation.
007010| src/components/Map.tsx:866:     const points = effectiveListings.map((l) => ({
007011| NOTE: Local declaration used by search logic or UI.
007012| src/components/Map.tsx:867:       lng: l.location.lng,
007013| NOTE: Implementation detail supporting search page behavior.
007014| src/components/Map.tsx:868:       lat: l.location.lat,
007015| NOTE: Implementation detail supporting search page behavior.
007016| src/components/Map.tsx:869:     }));
007017| NOTE: Implementation detail supporting search page behavior.
007018| src/components/Map.tsx:870: 
007019| NOTE: Blank line for visual separation.
007020| src/components/Map.tsx:871:     isProgrammaticMoveRef.current = true; // Mark as programmatic
007021| NOTE: Implementation detail supporting search page behavior.
007022| src/components/Map.tsx:872: 
007023| NOTE: Blank line for visual separation.
007024| src/components/Map.tsx:873:     if (points.length === 1) {
007025| NOTE: Conditional logic controlling rendering or flow.
007026| src/components/Map.tsx:874:       mapRef.current.flyTo({
007027| NOTE: Implementation detail supporting search page behavior.
007028| src/components/Map.tsx:875:         center: [points[0].lng, points[0].lat],
007029| NOTE: Implementation detail supporting search page behavior.
007030| src/components/Map.tsx:876:         zoom: 14,
007031| NOTE: Implementation detail supporting search page behavior.
007032| src/components/Map.tsx:877:         duration: 1000,
007033| NOTE: Implementation detail supporting search page behavior.
007034| src/components/Map.tsx:878:       });
007035| NOTE: Implementation detail supporting search page behavior.
007036| src/components/Map.tsx:879:     } else {
007037| NOTE: Implementation detail supporting search page behavior.
007038| src/components/Map.tsx:880:       const minLng = Math.min(...points.map((p) => p.lng));
007039| NOTE: Local declaration used by search logic or UI.
007040| src/components/Map.tsx:881:       const maxLng = Math.max(...points.map((p) => p.lng));
007041| NOTE: Local declaration used by search logic or UI.
007042| src/components/Map.tsx:882:       const minLat = Math.min(...points.map((p) => p.lat));
007043| NOTE: Local declaration used by search logic or UI.
007044| src/components/Map.tsx:883:       const maxLat = Math.max(...points.map((p) => p.lat));
007045| NOTE: Local declaration used by search logic or UI.
007046| src/components/Map.tsx:884: 
007047| NOTE: Blank line for visual separation.
007048| src/components/Map.tsx:885:       mapRef.current.fitBounds(
007049| NOTE: Implementation detail supporting search page behavior.
007050| src/components/Map.tsx:886:         [
007051| NOTE: Implementation detail supporting search page behavior.
007052| src/components/Map.tsx:887:           [minLng, minLat],
007053| NOTE: Implementation detail supporting search page behavior.
007054| src/components/Map.tsx:888:           [maxLng, maxLat],
007055| NOTE: Implementation detail supporting search page behavior.
007056| src/components/Map.tsx:889:         ],
007057| NOTE: Implementation detail supporting search page behavior.
007058| src/components/Map.tsx:890:         {
007059| NOTE: Implementation detail supporting search page behavior.
007060| src/components/Map.tsx:891:           padding: 50,
007061| NOTE: Implementation detail supporting search page behavior.
007062| src/components/Map.tsx:892:           duration: 1000,
007063| NOTE: Implementation detail supporting search page behavior.
007064| src/components/Map.tsx:893:         },
007065| NOTE: Implementation detail supporting search page behavior.
007066| src/components/Map.tsx:894:       );
007067| NOTE: Implementation detail supporting search page behavior.
007068| src/components/Map.tsx:895:     }
007069| NOTE: Implementation detail supporting search page behavior.
007070| src/components/Map.tsx:896:   }, [effectiveListings]);
007071| NOTE: Implementation detail supporting search page behavior.
007072| src/components/Map.tsx:897: 
007073| NOTE: Blank line for visual separation.
007074| src/components/Map.tsx:898:   const handleMoveEnd = (e: ViewStateChangeEvent) => {
007075| NOTE: Local declaration used by search logic or UI.
007076| src/components/Map.tsx:899:     // Update unclustered listings for rendering individual markers
007077| NOTE: Line comment documents intent or constraints.
007078| src/components/Map.tsx:900:     updateUnclusteredListings();
007079| NOTE: Implementation detail supporting search page behavior.
007080| src/components/Map.tsx:901: 
007081| NOTE: Blank line for visual separation.
007082| src/components/Map.tsx:902:     const mapBounds = e.target.getBounds();
007083| NOTE: Local declaration used by search logic or UI.
007084| src/components/Map.tsx:903:     if (!mapBounds) return;
007085| NOTE: Conditional logic controlling rendering or flow.
007086| src/components/Map.tsx:904: 
007087| NOTE: Blank line for visual separation.
007088| src/components/Map.tsx:905:     const currentBounds = {
007089| NOTE: Local declaration used by search logic or UI.
007090| src/components/Map.tsx:906:       minLng: mapBounds.getWest(),
007091| NOTE: Implementation detail supporting search page behavior.
007092| src/components/Map.tsx:907:       maxLng: mapBounds.getEast(),
007093| NOTE: Implementation detail supporting search page behavior.
007094| src/components/Map.tsx:908:       minLat: mapBounds.getSouth(),
007095| NOTE: Implementation detail supporting search page behavior.
007096| src/components/Map.tsx:909:       maxLat: mapBounds.getNorth(),
007097| NOTE: Implementation detail supporting search page behavior.
007098| src/components/Map.tsx:910:     };
007099| NOTE: Implementation detail supporting search page behavior.
007100| src/components/Map.tsx:911:     currentMapBoundsRef.current = currentBounds;
007101| NOTE: Implementation detail supporting search page behavior.
007102| src/components/Map.tsx:912:     // Update context with current bounds for location conflict detection
007103| NOTE: Line comment documents intent or constraints.
007104| src/components/Map.tsx:913:     contextSetCurrentMapBounds(currentBounds);
007105| NOTE: Implementation detail supporting search page behavior.
007106| src/components/Map.tsx:914: 
007107| NOTE: Blank line for visual separation.
007108| src/components/Map.tsx:915:     // Skip user-move tracking if this was a programmatic move (flyTo/fitBounds)
007109| NOTE: Line comment documents intent or constraints.
007110| src/components/Map.tsx:916:     if (isProgrammaticMoveRef.current) {
007111| NOTE: Conditional logic controlling rendering or flow.
007112| src/components/Map.tsx:917:       isProgrammaticMoveRef.current = false;
007113| NOTE: Implementation detail supporting search page behavior.
007114| src/components/Map.tsx:918:       return; // Don't treat programmatic moves as user interaction
007115| NOTE: Implementation detail supporting search page behavior.
007116| src/components/Map.tsx:919:     }
007117| NOTE: Implementation detail supporting search page behavior.
007118| src/components/Map.tsx:920: 
007119| NOTE: Blank line for visual separation.
007120| src/components/Map.tsx:921:     // Mark that user has manually moved the map (enables CTA)
007121| NOTE: Line comment documents intent or constraints.
007122| src/components/Map.tsx:922:     if (!hasUserMoved) {
007123| NOTE: Conditional logic controlling rendering or flow.
007124| src/components/Map.tsx:923:       setHasUserMoved(true);
007125| NOTE: Implementation detail supporting search page behavior.
007126| src/components/Map.tsx:924:     }
007127| NOTE: Implementation detail supporting search page behavior.
007128| src/components/Map.tsx:925: 
007129| NOTE: Blank line for visual separation.
007130| src/components/Map.tsx:926:     // Compare with URL bounds to determine if dirty
007131| NOTE: Line comment documents intent or constraints.
007132| src/components/Map.tsx:927:     const hasUrlBounds = searchParams.has("minLat");
007133| NOTE: Local declaration used by search logic or UI.
007134| src/components/Map.tsx:928:     if (hasUrlBounds) {
007135| NOTE: Conditional logic controlling rendering or flow.
007136| src/components/Map.tsx:929:       const urlBounds = {
007137| NOTE: Local declaration used by search logic or UI.
007138| src/components/Map.tsx:930:         minLng: parseFloat(searchParams.get("minLng") || "0"),
007139| NOTE: Implementation detail supporting search page behavior.
007140| src/components/Map.tsx:931:         maxLng: parseFloat(searchParams.get("maxLng") || "0"),
007141| NOTE: Implementation detail supporting search page behavior.
007142| src/components/Map.tsx:932:         minLat: parseFloat(searchParams.get("minLat") || "0"),
007143| NOTE: Implementation detail supporting search page behavior.
007144| src/components/Map.tsx:933:         maxLat: parseFloat(searchParams.get("maxLat") || "0"),
007145| NOTE: Implementation detail supporting search page behavior.
007146| src/components/Map.tsx:934:       };
007147| NOTE: Implementation detail supporting search page behavior.
007148| src/components/Map.tsx:935:       setBoundsDirty(!boundsApproximatelyEqual(currentBounds, urlBounds));
007149| NOTE: Implementation detail supporting search page behavior.
007150| src/components/Map.tsx:936:     } else {
007151| NOTE: Implementation detail supporting search page behavior.
007152| src/components/Map.tsx:937:       // No URL bounds yet - dirty if user moved
007153| NOTE: Line comment documents intent or constraints.
007154| src/components/Map.tsx:938:       setBoundsDirty(true);
007155| NOTE: Implementation detail supporting search page behavior.
007156| src/components/Map.tsx:939:     }
007157| NOTE: Implementation detail supporting search page behavior.
007158| src/components/Map.tsx:940: 
007159| NOTE: Blank line for visual separation.
007160| src/components/Map.tsx:941:     // If toggle ON, update URL with debounce/throttle
007161| NOTE: Line comment documents intent or constraints.
007162| src/components/Map.tsx:942:     if (!searchAsMove) return;
007163| NOTE: Conditional logic controlling rendering or flow.
007164| src/components/Map.tsx:943: 
007165| NOTE: Blank line for visual separation.
007166| src/components/Map.tsx:944:     if (debounceTimer.current) {
007167| NOTE: Conditional logic controlling rendering or flow.
007168| src/components/Map.tsx:945:       clearTimeout(debounceTimer.current);
007169| NOTE: Implementation detail supporting search page behavior.
007170| src/components/Map.tsx:946:     }
007171| NOTE: Implementation detail supporting search page behavior.
007172| src/components/Map.tsx:947: 
007173| NOTE: Blank line for visual separation.
007174| src/components/Map.tsx:948:     debounceTimer.current = setTimeout(() => {
007175| NOTE: Implementation detail supporting search page behavior.
007176| src/components/Map.tsx:949:       const now = Date.now();
007177| NOTE: Local declaration used by search logic or UI.
007178| src/components/Map.tsx:950:       const timeSinceLastSearch = now - lastSearchTimeRef.current;
007179| NOTE: Local declaration used by search logic or UI.
007180| src/components/Map.tsx:951: 
007181| NOTE: Blank line for visual separation.
007182| src/components/Map.tsx:952:       // If we're within the throttle window, queue the search for later
007183| NOTE: Line comment documents intent or constraints.
007184| src/components/Map.tsx:953:       if (timeSinceLastSearch < MIN_SEARCH_INTERVAL_MS) {
007185| NOTE: Conditional logic controlling rendering or flow.
007186| src/components/Map.tsx:954:         pendingBoundsRef.current = currentBounds;
007187| NOTE: Implementation detail supporting search page behavior.
007188| src/components/Map.tsx:955: 
007189| NOTE: Blank line for visual separation.
007190| src/components/Map.tsx:956:         // Clear any existing throttle timeout
007191| NOTE: Line comment documents intent or constraints.
007192| src/components/Map.tsx:957:         if (throttleTimeoutRef.current) {
007193| NOTE: Conditional logic controlling rendering or flow.
007194| src/components/Map.tsx:958:           clearTimeout(throttleTimeoutRef.current);
007195| NOTE: Implementation detail supporting search page behavior.
007196| src/components/Map.tsx:959:         }
007197| NOTE: Implementation detail supporting search page behavior.
007198| src/components/Map.tsx:960: 
007199| NOTE: Blank line for visual separation.
007200| src/components/Map.tsx:961:         // Schedule the pending search for when the throttle window expires
007201| NOTE: Line comment documents intent or constraints.
007202| src/components/Map.tsx:962:         const delay = MIN_SEARCH_INTERVAL_MS - timeSinceLastSearch;
007203| NOTE: Local declaration used by search logic or UI.
007204| src/components/Map.tsx:963:         throttleTimeoutRef.current = setTimeout(() => {
007205| NOTE: Implementation detail supporting search page behavior.
007206| src/components/Map.tsx:964:           if (pendingBoundsRef.current) {
007207| NOTE: Conditional logic controlling rendering or flow.
007208| src/components/Map.tsx:965:             executeMapSearch(pendingBoundsRef.current);
007209| NOTE: Implementation detail supporting search page behavior.
007210| src/components/Map.tsx:966:           }
007211| NOTE: Implementation detail supporting search page behavior.
007212| src/components/Map.tsx:967:         }, delay);
007213| NOTE: Implementation detail supporting search page behavior.
007214| src/components/Map.tsx:968:         return;
007215| NOTE: Implementation detail supporting search page behavior.
007216| src/components/Map.tsx:969:       }
007217| NOTE: Implementation detail supporting search page behavior.
007218| src/components/Map.tsx:970: 
007219| NOTE: Blank line for visual separation.
007220| src/components/Map.tsx:971:       // Execute immediately if outside throttle window
007221| NOTE: Line comment documents intent or constraints.
007222| src/components/Map.tsx:972:       executeMapSearch(currentBounds);
007223| NOTE: Implementation detail supporting search page behavior.
007224| src/components/Map.tsx:973:       setBoundsDirty(false); // URL is now in sync
007225| NOTE: Implementation detail supporting search page behavior.
007226| src/components/Map.tsx:974:     }, 500); // 500ms debounce
007227| NOTE: Implementation detail supporting search page behavior.
007228| src/components/Map.tsx:975:   };
007229| NOTE: Implementation detail supporting search page behavior.
007230| src/components/Map.tsx:976: 
007231| NOTE: Blank line for visual separation.
007232| src/components/Map.tsx:977:   const token = process.env.NEXT_PUBLIC_MAPBOX_TOKEN;
007233| NOTE: Local declaration used by search logic or UI.
007234| src/components/Map.tsx:978: 
007235| NOTE: Blank line for visual separation.
007236| src/components/Map.tsx:979:   if (!token) {
007237| NOTE: Conditional logic controlling rendering or flow.
007238| src/components/Map.tsx:980:     return (
007239| NOTE: Return statement for component or helper output.
007240| src/components/Map.tsx:981:       <div className="w-full h-full rounded-xl overflow-hidden border shadow-lg relative bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center">
007241| NOTE: Tailwind classes define layout and styling.
007242| src/components/Map.tsx:982:         <div className="bg-destructive/10 text-destructive p-4 rounded-lg text-center">
007243| NOTE: Tailwind classes define layout and styling.
007244| src/components/Map.tsx:983:           <p className="font-bold">Mapbox Token Missing</p>
007245| NOTE: Tailwind classes define layout and styling.
007246| src/components/Map.tsx:984:           <p className="text-sm">
007247| NOTE: Tailwind classes define layout and styling.
007248| src/components/Map.tsx:985:             Please add NEXT_PUBLIC_MAPBOX_TOKEN to your .env file
007249| NOTE: Implementation detail supporting search page behavior.
007250| src/components/Map.tsx:986:           </p>
007251| NOTE: JSX markup for search UI.
007252| src/components/Map.tsx:987:         </div>
007253| NOTE: JSX markup for search UI.
007254| src/components/Map.tsx:988:       </div>
007255| NOTE: JSX markup for search UI.
007256| src/components/Map.tsx:989:     );
007257| NOTE: Implementation detail supporting search page behavior.
007258| src/components/Map.tsx:990:   }
007259| NOTE: Implementation detail supporting search page behavior.
007260| src/components/Map.tsx:991: 
007261| NOTE: Blank line for visual separation.
007262| src/components/Map.tsx:992:   return (
007263| NOTE: Return statement for component or helper output.
007264| src/components/Map.tsx:993:     <div className="w-full h-full rounded-xl overflow-hidden border shadow-lg relative group">
007265| NOTE: Tailwind classes define layout and styling.
007266| src/components/Map.tsx:994:       {/* Initial loading skeleton */}
007267| NOTE: Implementation detail supporting search page behavior.
007268| src/components/Map.tsx:995:       {!isMapLoaded && (
007269| NOTE: Implementation detail supporting search page behavior.
007270| src/components/Map.tsx:996:         <div className="absolute inset-0 bg-zinc-100 dark:bg-zinc-800 z-20 flex items-center justify-center">
007271| NOTE: Tailwind classes define layout and styling.
007272| src/components/Map.tsx:997:           <div className="flex flex-col items-center gap-3">
007273| NOTE: Tailwind classes define layout and styling.
007274| src/components/Map.tsx:998:             <MapPin className="w-10 h-10 text-zinc-300 dark:text-zinc-600 animate-pulse" />
007275| NOTE: Tailwind classes define layout and styling.
007276| src/components/Map.tsx:999:             <span className="text-sm text-zinc-500 dark:text-zinc-400">
007277| NOTE: Tailwind classes define layout and styling.
007278| src/components/Map.tsx:1000:               Loading map...
007279| NOTE: Implementation detail supporting search page behavior.
007280| src/components/Map.tsx:1001:             </span>
007281| NOTE: JSX markup for search UI.
007282| src/components/Map.tsx:1002:           </div>
007283| NOTE: JSX markup for search UI.
007284| src/components/Map.tsx:1003:         </div>
007285| NOTE: JSX markup for search UI.
007286| src/components/Map.tsx:1004:       )}
007287| NOTE: Implementation detail supporting search page behavior.
007288| src/components/Map.tsx:1005: 
007289| NOTE: Blank line for visual separation.
007290| src/components/Map.tsx:1006:       {/* Tile loading indicator */}
007291| NOTE: Implementation detail supporting search page behavior.
007292| src/components/Map.tsx:1007:       {isMapLoaded && areTilesLoading && (
007293| NOTE: Implementation detail supporting search page behavior.
007294| src/components/Map.tsx:1008:         <div className="absolute inset-0 bg-zinc-100/30 dark:bg-zinc-900/30 backdrop-blur-[1px] z-10 flex items-center justify-center pointer-events-none">
007295| NOTE: Tailwind classes define layout and styling.
007296| src/components/Map.tsx:1009:           <div className="flex items-center gap-2 bg-white/90 dark:bg-zinc-800/90 px-4 py-2 rounded-lg shadow-sm">
007297| NOTE: Tailwind classes define layout and styling.
007298| src/components/Map.tsx:1010:             <Loader2 className="w-4 h-4 animate-spin text-zinc-600 dark:text-zinc-300" />
007299| NOTE: Tailwind classes define layout and styling.
007300| src/components/Map.tsx:1011:             <span className="text-sm text-zinc-600 dark:text-zinc-300">
007301| NOTE: Tailwind classes define layout and styling.
007302| src/components/Map.tsx:1012:               Loading tiles...
007303| NOTE: Implementation detail supporting search page behavior.
007304| src/components/Map.tsx:1013:             </span>
007305| NOTE: JSX markup for search UI.
007306| src/components/Map.tsx:1014:           </div>
007307| NOTE: JSX markup for search UI.
007308| src/components/Map.tsx:1015:         </div>
007309| NOTE: JSX markup for search UI.
007310| src/components/Map.tsx:1016:       )}
007311| NOTE: Implementation detail supporting search page behavior.
007312| src/components/Map.tsx:1017: 
007313| NOTE: Blank line for visual separation.
007314| src/components/Map.tsx:1018:       {/* Search-as-move loading indicator */}
007315| NOTE: Implementation detail supporting search page behavior.
007316| src/components/Map.tsx:1019:       {isSearching && isMapLoaded && !areTilesLoading && (
007317| NOTE: Implementation detail supporting search page behavior.
007318| src/components/Map.tsx:1020:         <div className="absolute top-16 left-1/2 -translate-x-1/2 bg-white/90 dark:bg-zinc-800/90 px-3 py-2 rounded-lg shadow-sm flex items-center gap-2 z-10 pointer-events-none">
007319| NOTE: Tailwind classes define layout and styling.
007320| src/components/Map.tsx:1021:           <Loader2 className="w-4 h-4 animate-spin text-zinc-600 dark:text-zinc-300" />
007321| NOTE: Tailwind classes define layout and styling.
007322| src/components/Map.tsx:1022:           <span className="text-sm text-zinc-600 dark:text-zinc-300">
007323| NOTE: Tailwind classes define layout and styling.
007324| src/components/Map.tsx:1023:             Searching area...
007325| NOTE: Implementation detail supporting search page behavior.
007326| src/components/Map.tsx:1024:           </span>
007327| NOTE: JSX markup for search UI.
007328| src/components/Map.tsx:1025:         </div>
007329| NOTE: JSX markup for search UI.
007330| src/components/Map.tsx:1026:       )}
007331| NOTE: Implementation detail supporting search page behavior.
007332| src/components/Map.tsx:1027: 
007333| NOTE: Blank line for visual separation.
007334| src/components/Map.tsx:1028:       <MapGL
007335| NOTE: JSX markup for search UI.
007336| src/components/Map.tsx:1029:         ref={mapRef}
007337| NOTE: Implementation detail supporting search page behavior.
007338| src/components/Map.tsx:1030:         mapboxAccessToken={token}
007339| NOTE: Implementation detail supporting search page behavior.
007340| src/components/Map.tsx:1031:         initialViewState={initialViewState}
007341| NOTE: Implementation detail supporting search page behavior.
007342| src/components/Map.tsx:1032:         style={{ width: "100%", height: "100%" }}
007343| NOTE: Implementation detail supporting search page behavior.
007344| src/components/Map.tsx:1033:         mapStyle={
007345| NOTE: Implementation detail supporting search page behavior.
007346| src/components/Map.tsx:1034:           isDarkMode
007347| NOTE: Implementation detail supporting search page behavior.
007348| src/components/Map.tsx:1035:             ? "mapbox://styles/mapbox/dark-v11"
007349| NOTE: Implementation detail supporting search page behavior.
007350| src/components/Map.tsx:1036:             : "mapbox://styles/mapbox/streets-v11"
007351| NOTE: Implementation detail supporting search page behavior.
007352| src/components/Map.tsx:1037:         }
007353| NOTE: Implementation detail supporting search page behavior.
007354| src/components/Map.tsx:1038:         onMoveEnd={handleMoveEnd}
007355| NOTE: Implementation detail supporting search page behavior.
007356| src/components/Map.tsx:1039:         onLoad={() => {
007357| NOTE: Implementation detail supporting search page behavior.
007358| src/components/Map.tsx:1040:           setIsMapLoaded(true);
007359| NOTE: Implementation detail supporting search page behavior.
007360| src/components/Map.tsx:1041:           updateUnclusteredListings();
007361| NOTE: Implementation detail supporting search page behavior.
007362| src/components/Map.tsx:1042:         }}
007363| NOTE: Implementation detail supporting search page behavior.
007364| src/components/Map.tsx:1043:         onMoveStart={() => setAreTilesLoading(true)}
007365| NOTE: Implementation detail supporting search page behavior.
007366| src/components/Map.tsx:1044:         onIdle={() => setAreTilesLoading(false)}
007367| NOTE: Implementation detail supporting search page behavior.
007368| src/components/Map.tsx:1045:         onClick={handleMapClick}
007369| NOTE: Implementation detail supporting search page behavior.
007370| src/components/Map.tsx:1046:         interactiveLayerIds={
007371| NOTE: Implementation detail supporting search page behavior.
007372| src/components/Map.tsx:1047:           useClustering ? [isDarkMode ? "clusters-dark" : "clusters"] : []
007373| NOTE: Implementation detail supporting search page behavior.
007374| src/components/Map.tsx:1048:         }
007375| NOTE: Implementation detail supporting search page behavior.
007376| src/components/Map.tsx:1049:         onError={(e) => {
007377| NOTE: Implementation detail supporting search page behavior.
007378| src/components/Map.tsx:1050:           const error = (e as { error?: Error }).error;
007379| NOTE: Local declaration used by search logic or UI.
007380| src/components/Map.tsx:1051:           const message = error?.message || "Unknown map error";
007381| NOTE: Local declaration used by search logic or UI.
007382| src/components/Map.tsx:1052: 
007383| NOTE: Blank line for visual separation.
007384| src/components/Map.tsx:1053:           // Worker communication errors are non-fatal during HMR/navigation
007385| NOTE: Line comment documents intent or constraints.
007386| src/components/Map.tsx:1054:           // These occur when the mapbox-gl worker loses connection during hot reload
007387| NOTE: Line comment documents intent or constraints.
007388| src/components/Map.tsx:1055:           if (
007389| NOTE: Conditional logic controlling rendering or flow.
007390| src/components/Map.tsx:1056:             message.includes("send") ||
007391| NOTE: Implementation detail supporting search page behavior.
007392| src/components/Map.tsx:1057:             message.includes("worker") ||
007393| NOTE: Implementation detail supporting search page behavior.
007394| src/components/Map.tsx:1058:             message.includes("Actor")
007395| NOTE: Implementation detail supporting search page behavior.
007396| src/components/Map.tsx:1059:           ) {
007397| NOTE: Implementation detail supporting search page behavior.
007398| src/components/Map.tsx:1060:             console.warn(
007399| NOTE: Implementation detail supporting search page behavior.
007400| src/components/Map.tsx:1061:               "[Map] Worker communication issue (safe to ignore during HMR):",
007401| NOTE: Implementation detail supporting search page behavior.
007402| src/components/Map.tsx:1062:               message,
007403| NOTE: Implementation detail supporting search page behavior.
007404| src/components/Map.tsx:1063:             );
007405| NOTE: Implementation detail supporting search page behavior.
007406| src/components/Map.tsx:1064:             return;
007407| NOTE: Implementation detail supporting search page behavior.
007408| src/components/Map.tsx:1065:           }
007409| NOTE: Implementation detail supporting search page behavior.
007410| src/components/Map.tsx:1066: 
007411| NOTE: Blank line for visual separation.
007412| src/components/Map.tsx:1067:           console.error("Map Error:", message, error?.stack);
007413| NOTE: Implementation detail supporting search page behavior.
007414| src/components/Map.tsx:1068:         }}
007415| NOTE: Implementation detail supporting search page behavior.
007416| src/components/Map.tsx:1069:       >
007417| NOTE: Implementation detail supporting search page behavior.
007418| src/components/Map.tsx:1070:         {/* Clustering Source and Layers - Layer nested inside Source inherits source automatically */}
007419| NOTE: Implementation detail supporting search page behavior.
007420| src/components/Map.tsx:1071:         {useClustering && (
007421| NOTE: Implementation detail supporting search page behavior.
007422| src/components/Map.tsx:1072:           <Source
007423| NOTE: JSX markup for search UI.
007424| src/components/Map.tsx:1073:             id="listings"
007425| NOTE: Implementation detail supporting search page behavior.
007426| src/components/Map.tsx:1074:             type="geojson"
007427| NOTE: Implementation detail supporting search page behavior.
007428| src/components/Map.tsx:1075:             data={geojsonData}
007429| NOTE: Implementation detail supporting search page behavior.
007430| src/components/Map.tsx:1076:             cluster={true}
007431| NOTE: Implementation detail supporting search page behavior.
007432| src/components/Map.tsx:1077:             clusterMaxZoom={14}
007433| NOTE: Implementation detail supporting search page behavior.
007434| src/components/Map.tsx:1078:             clusterRadius={50}
007435| NOTE: Implementation detail supporting search page behavior.
007436| src/components/Map.tsx:1079:           >
007437| NOTE: Implementation detail supporting search page behavior.
007438| src/components/Map.tsx:1080:             {isDarkMode && <Layer {...clusterLayerDark} />}
007439| NOTE: Implementation detail supporting search page behavior.
007440| src/components/Map.tsx:1081:             {isDarkMode && <Layer {...clusterCountLayerDark} />}
007441| NOTE: Implementation detail supporting search page behavior.
007442| src/components/Map.tsx:1082:             {!isDarkMode && <Layer {...clusterLayer} />}
007443| NOTE: Implementation detail supporting search page behavior.
007444| src/components/Map.tsx:1083:             {!isDarkMode && <Layer {...clusterCountLayer} />}
007445| NOTE: Implementation detail supporting search page behavior.
007446| src/components/Map.tsx:1084:           </Source>
007447| NOTE: JSX markup for search UI.
007448| src/components/Map.tsx:1085:         )}
007449| NOTE: Implementation detail supporting search page behavior.
007450| src/components/Map.tsx:1086: 
007451| NOTE: Blank line for visual separation.
007452| src/components/Map.tsx:1087:         {/* Mini pins first (lower z-index) - small dots for lower-ranked listings */}
007453| NOTE: Implementation detail supporting search page behavior.
007454| src/components/Map.tsx:1088:         {miniGroups.map((group) => {
007455| NOTE: Implementation detail supporting search page behavior.
007456| src/components/Map.tsx:1089:           const bestListing = getBestListingInGroup(group.listings, rankMap);
007457| NOTE: Local declaration used by search logic or UI.
007458| src/components/Map.tsx:1090:           const isGroupHovered = group.listings.some((l) => l.id === hoveredId);
007459| NOTE: Local declaration used by search logic or UI.
007460| src/components/Map.tsx:1091:           const isGroupActive = group.listings.some((l) => l.id === activeId);
007461| NOTE: Local declaration used by search logic or UI.
007462| src/components/Map.tsx:1092:           const isGroupFocused = isGroupHovered || isGroupActive;
007463| NOTE: Local declaration used by search logic or UI.
007464| src/components/Map.tsx:1093: 
007465| NOTE: Blank line for visual separation.
007466| src/components/Map.tsx:1094:           return (
007467| NOTE: Return statement for component or helper output.
007468| src/components/Map.tsx:1095:             <Marker
007469| NOTE: JSX markup for search UI.
007470| src/components/Map.tsx:1096:               key={`mini-${group.key}`}
007471| NOTE: Implementation detail supporting search page behavior.
007472| src/components/Map.tsx:1097:               longitude={group.lng}
007473| NOTE: Implementation detail supporting search page behavior.
007474| src/components/Map.tsx:1098:               latitude={group.lat}
007475| NOTE: Implementation detail supporting search page behavior.
007476| src/components/Map.tsx:1099:               anchor="center"
007477| NOTE: Implementation detail supporting search page behavior.
007478| src/components/Map.tsx:1100:             >
007479| NOTE: Implementation detail supporting search page behavior.
007480| src/components/Map.tsx:1101:               <div
007481| NOTE: JSX markup for search UI.
007482| src/components/Map.tsx:1102:                 data-testid={`map-pin-mini-${group.key}`}
007483| NOTE: Implementation detail supporting search page behavior.
007484| src/components/Map.tsx:1103:                 className="relative cursor-pointer"
007485| NOTE: Tailwind classes define layout and styling.
007486| src/components/Map.tsx:1104:                 onMouseEnter={() => setHovered(bestListing.id)}
007487| NOTE: Implementation detail supporting search page behavior.
007488| src/components/Map.tsx:1105:                 onMouseLeave={() => setHovered(null)}
007489| NOTE: Implementation detail supporting search page behavior.
007490| src/components/Map.tsx:1106:                 onClick={(e) => {
007491| NOTE: Implementation detail supporting search page behavior.
007492| src/components/Map.tsx:1107:                   e.stopPropagation();
007493| NOTE: Implementation detail supporting search page behavior.
007494| src/components/Map.tsx:1108: 
007495| NOTE: Blank line for visual separation.
007496| src/components/Map.tsx:1109:                   if (group.listings.length === 1) {
007497| NOTE: Conditional logic controlling rendering or flow.
007498| src/components/Map.tsx:1110:                     setSelectedListing(group.listings[0]);
007499| NOTE: Implementation detail supporting search page behavior.
007500| src/components/Map.tsx:1111:                     setSelectedGroup(null);
007501| NOTE: Implementation detail supporting search page behavior.
007502| src/components/Map.tsx:1112:                     setActive(group.listings[0].id);
007503| NOTE: Implementation detail supporting search page behavior.
007504| src/components/Map.tsx:1113:                     requestScrollTo(group.listings[0].id);
007505| NOTE: Implementation detail supporting search page behavior.
007506| src/components/Map.tsx:1114:                   } else {
007507| NOTE: Implementation detail supporting search page behavior.
007508| src/components/Map.tsx:1115:                     setSelectedGroup(group);
007509| NOTE: Implementation detail supporting search page behavior.
007510| src/components/Map.tsx:1116:                     setSelectedListing(null);
007511| NOTE: Implementation detail supporting search page behavior.
007512| src/components/Map.tsx:1117:                   }
007513| NOTE: Implementation detail supporting search page behavior.
007514| src/components/Map.tsx:1118: 
007515| NOTE: Blank line for visual separation.
007516| src/components/Map.tsx:1119:                   mapRef.current?.easeTo({
007517| NOTE: Implementation detail supporting search page behavior.
007518| src/components/Map.tsx:1120:                     center: [group.lng, group.lat],
007519| NOTE: Implementation detail supporting search page behavior.
007520| src/components/Map.tsx:1121:                     offset: [0, -150],
007521| NOTE: Implementation detail supporting search page behavior.
007522| src/components/Map.tsx:1122:                     duration: 400,
007523| NOTE: Implementation detail supporting search page behavior.
007524| src/components/Map.tsx:1123:                   });
007525| NOTE: Implementation detail supporting search page behavior.
007526| src/components/Map.tsx:1124:                 }}
007527| NOTE: Implementation detail supporting search page behavior.
007528| src/components/Map.tsx:1125:               >
007529| NOTE: Implementation detail supporting search page behavior.
007530| src/components/Map.tsx:1126:                 {/* Base dot: theme colors, scales on hover/active */}
007531| NOTE: Implementation detail supporting search page behavior.
007532| src/components/Map.tsx:1127:                 <div
007533| NOTE: JSX markup for search UI.
007534| src/components/Map.tsx:1128:                   className={`w-2.5 h-2.5 rounded-full shadow-md transition-all duration-200
007535| NOTE: Tailwind classes define layout and styling.
007536| src/components/Map.tsx:1129:                     ${isGroupFocused ? "scale-150 ring-2 ring-offset-1 ring-blue-400" : "hover:scale-125"}
007537| NOTE: Implementation detail supporting search page behavior.
007538| src/components/Map.tsx:1130:                     ${isDarkMode ? "bg-white border border-zinc-700" : "bg-zinc-900 border border-white"}
007539| NOTE: Implementation detail supporting search page behavior.
007540| src/components/Map.tsx:1131:                   `}
007541| NOTE: Implementation detail supporting search page behavior.
007542| src/components/Map.tsx:1132:                 />
007543| NOTE: Implementation detail supporting search page behavior.
007544| src/components/Map.tsx:1133:                 {/* Stack badge for multi-listing groups */}
007545| NOTE: Implementation detail supporting search page behavior.
007546| src/components/Map.tsx:1134:                 {(("stackCount" in group
007547| NOTE: Implementation detail supporting search page behavior.
007548| src/components/Map.tsx:1135:                   ? (group as { stackCount?: number }).stackCount
007549| NOTE: Implementation detail supporting search page behavior.
007550| src/components/Map.tsx:1136:                   : undefined) ?? group.listings.length) > 1 && (
007551| NOTE: Implementation detail supporting search page behavior.
007552| src/components/Map.tsx:1137:                   <span
007553| NOTE: JSX markup for search UI.
007554| src/components/Map.tsx:1138:                     className={`absolute -top-1.5 -right-1.5 text-[8px] font-bold rounded-full
007555| NOTE: Tailwind classes define layout and styling.
007556| src/components/Map.tsx:1139:                       w-3.5 h-3.5 flex items-center justify-center
007557| NOTE: Implementation detail supporting search page behavior.
007558| src/components/Map.tsx:1140:                       ${isDarkMode ? "bg-zinc-700 text-white" : "bg-zinc-200 text-zinc-900"}
007559| NOTE: Implementation detail supporting search page behavior.
007560| src/components/Map.tsx:1141:                     `}
007561| NOTE: Implementation detail supporting search page behavior.
007562| src/components/Map.tsx:1142:                   >
007563| NOTE: Implementation detail supporting search page behavior.
007564| src/components/Map.tsx:1143:                     {("stackCount" in group
007565| NOTE: Implementation detail supporting search page behavior.
007566| src/components/Map.tsx:1144:                       ? (group as { stackCount?: number }).stackCount
007567| NOTE: Implementation detail supporting search page behavior.
007568| src/components/Map.tsx:1145:                       : undefined) ?? group.listings.length}
007569| NOTE: Implementation detail supporting search page behavior.
007570| src/components/Map.tsx:1146:                   </span>
007571| NOTE: JSX markup for search UI.
007572| src/components/Map.tsx:1147:                 )}
007573| NOTE: Implementation detail supporting search page behavior.
007574| src/components/Map.tsx:1148:               </div>
007575| NOTE: JSX markup for search UI.
007576| src/components/Map.tsx:1149:             </Marker>
007577| NOTE: JSX markup for search UI.
007578| src/components/Map.tsx:1150:           );
007579| NOTE: Implementation detail supporting search page behavior.
007580| src/components/Map.tsx:1151:         })}
007581| NOTE: Implementation detail supporting search page behavior.
007582| src/components/Map.tsx:1152: 
007583| NOTE: Blank line for visual separation.
007584| src/components/Map.tsx:1153:         {/* Primary pins second (higher z-index) - full price pills for top-ranked listings */}
007585| NOTE: Implementation detail supporting search page behavior.
007586| src/components/Map.tsx:1154:         {primaryGroups.map((group) => {
007587| NOTE: Implementation detail supporting search page behavior.
007588| src/components/Map.tsx:1155:           const isGroupHovered = group.listings.some((l) => l.id === hoveredId);
007589| NOTE: Local declaration used by search logic or UI.
007590| src/components/Map.tsx:1156: 
007591| NOTE: Blank line for visual separation.
007592| src/components/Map.tsx:1157:           return (
007593| NOTE: Return statement for component or helper output.
007594| src/components/Map.tsx:1158:             <Marker
007595| NOTE: JSX markup for search UI.
007596| src/components/Map.tsx:1159:               key={`primary-${group.key}`}
007597| NOTE: Implementation detail supporting search page behavior.
007598| src/components/Map.tsx:1160:               longitude={group.lng}
007599| NOTE: Implementation detail supporting search page behavior.
007600| src/components/Map.tsx:1161:               latitude={group.lat}
007601| NOTE: Implementation detail supporting search page behavior.
007602| src/components/Map.tsx:1162:               anchor="bottom"
007603| NOTE: Implementation detail supporting search page behavior.
007604| src/components/Map.tsx:1163:               onClick={(e: any) => {
007605| NOTE: Implementation detail supporting search page behavior.
007606| src/components/Map.tsx:1164:                 e.originalEvent.stopPropagation();
007607| NOTE: Implementation detail supporting search page behavior.
007608| src/components/Map.tsx:1165: 
007609| NOTE: Blank line for visual separation.
007610| src/components/Map.tsx:1166:                 if (group.listings.length === 1) {
007611| NOTE: Conditional logic controlling rendering or flow.
007612| src/components/Map.tsx:1167:                   setSelectedListing(group.listings[0]);
007613| NOTE: Implementation detail supporting search page behavior.
007614| src/components/Map.tsx:1168:                   setSelectedGroup(null);
007615| NOTE: Implementation detail supporting search page behavior.
007616| src/components/Map.tsx:1169:                   setActive(group.listings[0].id);
007617| NOTE: Implementation detail supporting search page behavior.
007618| src/components/Map.tsx:1170:                   requestScrollTo(group.listings[0].id);
007619| NOTE: Implementation detail supporting search page behavior.
007620| src/components/Map.tsx:1171:                 } else {
007621| NOTE: Implementation detail supporting search page behavior.
007622| src/components/Map.tsx:1172:                   setSelectedGroup(group);
007623| NOTE: Implementation detail supporting search page behavior.
007624| src/components/Map.tsx:1173:                   setSelectedListing(null);
007625| NOTE: Implementation detail supporting search page behavior.
007626| src/components/Map.tsx:1174:                 }
007627| NOTE: Implementation detail supporting search page behavior.
007628| src/components/Map.tsx:1175: 
007629| NOTE: Blank line for visual separation.
007630| src/components/Map.tsx:1176:                 mapRef.current?.easeTo({
007631| NOTE: Implementation detail supporting search page behavior.
007632| src/components/Map.tsx:1177:                   center: [group.lng, group.lat],
007633| NOTE: Implementation detail supporting search page behavior.
007634| src/components/Map.tsx:1178:                   offset: [0, -150],
007635| NOTE: Implementation detail supporting search page behavior.
007636| src/components/Map.tsx:1179:                   duration: 400,
007637| NOTE: Implementation detail supporting search page behavior.
007638| src/components/Map.tsx:1180:                 });
007639| NOTE: Implementation detail supporting search page behavior.
007640| src/components/Map.tsx:1181:               }}
007641| NOTE: Implementation detail supporting search page behavior.
007642| src/components/Map.tsx:1182:             >
007643| NOTE: Implementation detail supporting search page behavior.
007644| src/components/Map.tsx:1183:               <div
007645| NOTE: JSX markup for search UI.
007646| src/components/Map.tsx:1184:                 data-testid={`map-pin-primary-${group.key}`}
007647| NOTE: Implementation detail supporting search page behavior.
007648| src/components/Map.tsx:1185:                 className="relative cursor-pointer group/marker"
007649| NOTE: Tailwind classes define layout and styling.
007650| src/components/Map.tsx:1186:                 onMouseEnter={() => {
007651| NOTE: Implementation detail supporting search page behavior.
007652| src/components/Map.tsx:1187:                   if (group.listings.length === 1) {
007653| NOTE: Conditional logic controlling rendering or flow.
007654| src/components/Map.tsx:1188:                     setHovered(group.listings[0].id);
007655| NOTE: Implementation detail supporting search page behavior.
007656| src/components/Map.tsx:1189:                   }
007657| NOTE: Implementation detail supporting search page behavior.
007658| src/components/Map.tsx:1190:                 }}
007659| NOTE: Implementation detail supporting search page behavior.
007660| src/components/Map.tsx:1191:                 onMouseLeave={() => setHovered(null)}
007661| NOTE: Implementation detail supporting search page behavior.
007662| src/components/Map.tsx:1192:               >
007663| NOTE: Implementation detail supporting search page behavior.
007664| src/components/Map.tsx:1193:                 {/* Pin body with price (or price range for stacked) */}
007665| NOTE: Implementation detail supporting search page behavior.
007666| src/components/Map.tsx:1194:                 <div
007667| NOTE: JSX markup for search UI.
007668| src/components/Map.tsx:1195:                   className={`px-3 py-1.5 rounded-xl shadow-lg group-hover/marker:scale-105 transition-all duration-200 font-semibold text-sm whitespace-nowrap relative ${
007669| NOTE: Tailwind classes define layout and styling.
007670| src/components/Map.tsx:1196:                     isGroupHovered
007671| NOTE: Implementation detail supporting search page behavior.
007672| src/components/Map.tsx:1197:                       ? "bg-blue-600 text-white ring-2 ring-blue-400 ring-offset-1 scale-110"
007673| NOTE: Implementation detail supporting search page behavior.
007674| src/components/Map.tsx:1198:                       : "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 group-hover/marker:bg-zinc-800 dark:group-hover/marker:bg-zinc-200"
007675| NOTE: Implementation detail supporting search page behavior.
007676| src/components/Map.tsx:1199:                   }`}
007677| NOTE: Implementation detail supporting search page behavior.
007678| src/components/Map.tsx:1200:                 >
007679| NOTE: Implementation detail supporting search page behavior.
007680| src/components/Map.tsx:1201:                   {formatStackPriceRange(group.listings)}
007681| NOTE: Implementation detail supporting search page behavior.
007682| src/components/Map.tsx:1202:                   {/* Badge for stacked markers (2+ listings at same location) */}
007683| NOTE: Implementation detail supporting search page behavior.
007684| src/components/Map.tsx:1203:                   {(("stackCount" in group
007685| NOTE: Implementation detail supporting search page behavior.
007686| src/components/Map.tsx:1204:                     ? (group as { stackCount?: number }).stackCount
007687| NOTE: Implementation detail supporting search page behavior.
007688| src/components/Map.tsx:1205:                     : undefined) ?? group.listings.length) > 1 && (
007689| NOTE: Implementation detail supporting search page behavior.
007690| src/components/Map.tsx:1206:                     <span className="absolute -top-2 -right-2 bg-blue-500 text-white text-xs rounded-full px-1.5 min-w-[20px] text-center font-medium shadow-sm">
007691| NOTE: Tailwind classes define layout and styling.
007692| src/components/Map.tsx:1207:                       {("stackCount" in group
007693| NOTE: Implementation detail supporting search page behavior.
007694| src/components/Map.tsx:1208:                         ? (group as { stackCount?: number }).stackCount
007695| NOTE: Implementation detail supporting search page behavior.
007696| src/components/Map.tsx:1209:                         : undefined) ?? group.listings.length}
007697| NOTE: Implementation detail supporting search page behavior.
007698| src/components/Map.tsx:1210:                     </span>
007699| NOTE: JSX markup for search UI.
007700| src/components/Map.tsx:1211:                   )}
007701| NOTE: Implementation detail supporting search page behavior.
007702| src/components/Map.tsx:1212:                 </div>
007703| NOTE: JSX markup for search UI.
007704| src/components/Map.tsx:1213:                 {/* Pin tail/pointer */}
007705| NOTE: Implementation detail supporting search page behavior.
007706| src/components/Map.tsx:1214:                 <div
007707| NOTE: JSX markup for search UI.
007708| src/components/Map.tsx:1215:                   className={`absolute -bottom-[6px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[7px] border-l-transparent border-r-[7px] border-r-transparent border-t-[7px] transition-colors ${
007709| NOTE: Tailwind classes define layout and styling.
007710| src/components/Map.tsx:1216:                     isGroupHovered
007711| NOTE: Implementation detail supporting search page behavior.
007712| src/components/Map.tsx:1217:                       ? "border-t-blue-600"
007713| NOTE: Implementation detail supporting search page behavior.
007714| src/components/Map.tsx:1218:                       : "border-t-zinc-900 dark:border-t-white group-hover/marker:border-t-zinc-800 dark:group-hover/marker:border-t-zinc-200"
007715| NOTE: Implementation detail supporting search page behavior.
007716| src/components/Map.tsx:1219:                   }`}
007717| NOTE: Implementation detail supporting search page behavior.
007718| src/components/Map.tsx:1220:                 ></div>
007719| NOTE: Implementation detail supporting search page behavior.
007720| src/components/Map.tsx:1221:                 {/* Shadow under the pin for depth */}
007721| NOTE: Implementation detail supporting search page behavior.
007722| src/components/Map.tsx:1222:                 <div className="absolute -bottom-1 left-1/2 -translate-x-1/2 w-3 h-1 bg-zinc-950/20 dark:bg-zinc-950/40 rounded-full blur-[2px]"></div>
007723| NOTE: Tailwind classes define layout and styling.
007724| src/components/Map.tsx:1223:               </div>
007725| NOTE: JSX markup for search UI.
007726| src/components/Map.tsx:1224:             </Marker>
007727| NOTE: JSX markup for search UI.
007728| src/components/Map.tsx:1225:           );
007729| NOTE: Implementation detail supporting search page behavior.
007730| src/components/Map.tsx:1226:         })}
007731| NOTE: Implementation detail supporting search page behavior.
007732| src/components/Map.tsx:1227: 
007733| NOTE: Blank line for visual separation.
007734| src/components/Map.tsx:1228:         {selectedListing && (
007735| NOTE: Implementation detail supporting search page behavior.
007736| src/components/Map.tsx:1229:           <Popup
007737| NOTE: JSX markup for search UI.
007738| src/components/Map.tsx:1230:             longitude={selectedListing.location.lng}
007739| NOTE: Implementation detail supporting search page behavior.
007740| src/components/Map.tsx:1231:             latitude={selectedListing.location.lat}
007741| NOTE: Implementation detail supporting search page behavior.
007742| src/components/Map.tsx:1232:             anchor="top"
007743| NOTE: Implementation detail supporting search page behavior.
007744| src/components/Map.tsx:1233:             onClose={() => setSelectedListing(null)}
007745| NOTE: Implementation detail supporting search page behavior.
007746| src/components/Map.tsx:1234:             closeOnClick={false}
007747| NOTE: Implementation detail supporting search page behavior.
007748| src/components/Map.tsx:1235:             maxWidth="320px"
007749| NOTE: Implementation detail supporting search page behavior.
007750| src/components/Map.tsx:1236:             className={`z-50 [&_.mapboxgl-popup-content]:rounded-xl [&_.mapboxgl-popup-content]:p-0 [&_.mapboxgl-popup-content]:!bg-transparent [&_.mapboxgl-popup-content]:!shadow-none [&_.mapboxgl-popup-close-button]:hidden ${
007751| NOTE: Tailwind classes define layout and styling.
007752| src/components/Map.tsx:1237:               isDarkMode
007753| NOTE: Implementation detail supporting search page behavior.
007754| src/components/Map.tsx:1238:                 ? "[&_.mapboxgl-popup-tip]:border-t-zinc-900"
007755| NOTE: Implementation detail supporting search page behavior.
007756| src/components/Map.tsx:1239:                 : "[&_.mapboxgl-popup-tip]:border-t-white"
007757| NOTE: Implementation detail supporting search page behavior.
007758| src/components/Map.tsx:1240:             }`}
007759| NOTE: Implementation detail supporting search page behavior.
007760| src/components/Map.tsx:1241:           >
007761| NOTE: Implementation detail supporting search page behavior.
007762| src/components/Map.tsx:1242:             {/* Premium Card Design */}
007763| NOTE: Implementation detail supporting search page behavior.
007764| src/components/Map.tsx:1243:             <div
007765| NOTE: JSX markup for search UI.
007766| src/components/Map.tsx:1244:               className={`w-[280px] overflow-hidden rounded-xl ${
007767| NOTE: Tailwind classes define layout and styling.
007768| src/components/Map.tsx:1245:                 isDarkMode
007769| NOTE: Implementation detail supporting search page behavior.
007770| src/components/Map.tsx:1246:                   ? "bg-zinc-900 shadow-[0_10px_40px_-10px_rgba(0,0,0,0.5)]"
007771| NOTE: Implementation detail supporting search page behavior.
007772| src/components/Map.tsx:1247:                   : "bg-white shadow-[0_10px_40px_-10px_rgba(0,0,0,0.15)]"
007773| NOTE: Implementation detail supporting search page behavior.
007774| src/components/Map.tsx:1248:               }`}
007775| NOTE: Implementation detail supporting search page behavior.
007776| src/components/Map.tsx:1249:             >
007777| NOTE: Implementation detail supporting search page behavior.
007778| src/components/Map.tsx:1250:               {/* Image Thumbnail - optimized with next/image */}
007779| NOTE: Implementation detail supporting search page behavior.
007780| src/components/Map.tsx:1251:               <div
007781| NOTE: JSX markup for search UI.
007782| src/components/Map.tsx:1252:                 className={`aspect-[16/9] relative overflow-hidden ${isDarkMode ? "bg-zinc-800" : "bg-zinc-100"}`}
007783| NOTE: Tailwind classes define layout and styling.
007784| src/components/Map.tsx:1253:               >
007785| NOTE: Implementation detail supporting search page behavior.
007786| src/components/Map.tsx:1254:                 {selectedListing.images && selectedListing.images[0] ? (
007787| NOTE: Implementation detail supporting search page behavior.
007788| src/components/Map.tsx:1255:                   <Image
007789| NOTE: JSX markup for search UI.
007790| src/components/Map.tsx:1256:                     src={selectedListing.images[0]}
007791| NOTE: Implementation detail supporting search page behavior.
007792| src/components/Map.tsx:1257:                     alt={selectedListing.title}
007793| NOTE: Implementation detail supporting search page behavior.
007794| src/components/Map.tsx:1258:                     fill
007795| NOTE: Implementation detail supporting search page behavior.
007796| src/components/Map.tsx:1259:                     sizes="280px"
007797| NOTE: Implementation detail supporting search page behavior.
007798| src/components/Map.tsx:1260:                     className="object-cover"
007799| NOTE: Tailwind classes define layout and styling.
007800| src/components/Map.tsx:1261:                   />
007801| NOTE: Implementation detail supporting search page behavior.
007802| src/components/Map.tsx:1262:                 ) : (
007803| NOTE: Implementation detail supporting search page behavior.
007804| src/components/Map.tsx:1263:                   <div className="w-full h-full flex items-center justify-center">
007805| NOTE: Tailwind classes define layout and styling.
007806| src/components/Map.tsx:1264:                     <Home
007807| NOTE: JSX markup for search UI.
007808| src/components/Map.tsx:1265:                       className={`w-10 h-10 ${isDarkMode ? "text-zinc-600" : "text-zinc-300"}`}
007809| NOTE: Tailwind classes define layout and styling.
007810| src/components/Map.tsx:1266:                     />
007811| NOTE: Implementation detail supporting search page behavior.
007812| src/components/Map.tsx:1267:                   </div>
007813| NOTE: JSX markup for search UI.
007814| src/components/Map.tsx:1268:                 )}
007815| NOTE: Implementation detail supporting search page behavior.
007816| src/components/Map.tsx:1269:                 {/* Close button overlay */}
007817| NOTE: Implementation detail supporting search page behavior.
007818| src/components/Map.tsx:1270:                 <div className="absolute top-2 right-2">
007819| NOTE: Tailwind classes define layout and styling.
007820| src/components/Map.tsx:1271:                   <Button
007821| NOTE: JSX markup for search UI.
007822| src/components/Map.tsx:1272:                     variant="ghost"
007823| NOTE: Implementation detail supporting search page behavior.
007824| src/components/Map.tsx:1273:                     size="icon"
007825| NOTE: Implementation detail supporting search page behavior.
007826| src/components/Map.tsx:1274:                     onClick={() => setSelectedListing(null)}
007827| NOTE: Implementation detail supporting search page behavior.
007828| src/components/Map.tsx:1275:                     className="w-7 h-7 rounded-full bg-zinc-950/50 hover:bg-zinc-950/70 text-white hover:text-white border-none"
007829| NOTE: Tailwind classes define layout and styling.
007830| src/components/Map.tsx:1276:                   >
007831| NOTE: Implementation detail supporting search page behavior.
007832| src/components/Map.tsx:1277:                     <X className="w-4 h-4" />
007833| NOTE: Tailwind classes define layout and styling.
007834| src/components/Map.tsx:1278:                   </Button>
007835| NOTE: JSX markup for search UI.
007836| src/components/Map.tsx:1279:                 </div>
007837| NOTE: JSX markup for search UI.
007838| src/components/Map.tsx:1280:                 {/* Availability badge */}
007839| NOTE: Implementation detail supporting search page behavior.
007840| src/components/Map.tsx:1281:                 <div className="absolute bottom-2 left-2">
007841| NOTE: Tailwind classes define layout and styling.
007842| src/components/Map.tsx:1282:                   <span
007843| NOTE: JSX markup for search UI.
007844| src/components/Map.tsx:1283:                     className={`inline-flex px-2 py-0.5 rounded-md text-2xs font-semibold uppercase ${
007845| NOTE: Tailwind classes define layout and styling.
007846| src/components/Map.tsx:1284:                       selectedListing.availableSlots > 0
007847| NOTE: Implementation detail supporting search page behavior.
007848| src/components/Map.tsx:1285:                         ? "bg-emerald-500 text-white"
007849| NOTE: Implementation detail supporting search page behavior.
007850| src/components/Map.tsx:1286:                         : "bg-zinc-900 text-white"
007851| NOTE: Implementation detail supporting search page behavior.
007852| src/components/Map.tsx:1287:                     }`}
007853| NOTE: Implementation detail supporting search page behavior.
007854| src/components/Map.tsx:1288:                   >
007855| NOTE: Implementation detail supporting search page behavior.
007856| src/components/Map.tsx:1289:                     {selectedListing.availableSlots > 0
007857| NOTE: Implementation detail supporting search page behavior.
007858| src/components/Map.tsx:1290:                       ? `${selectedListing.availableSlots} Available`
007859| NOTE: Implementation detail supporting search page behavior.
007860| src/components/Map.tsx:1291:                       : "Filled"}
007861| NOTE: Implementation detail supporting search page behavior.
007862| src/components/Map.tsx:1292:                   </span>
007863| NOTE: JSX markup for search UI.
007864| src/components/Map.tsx:1293:                 </div>
007865| NOTE: JSX markup for search UI.
007866| src/components/Map.tsx:1294:               </div>
007867| NOTE: JSX markup for search UI.
007868| src/components/Map.tsx:1295: 
007869| NOTE: Blank line for visual separation.
007870| src/components/Map.tsx:1296:               {/* Content */}
007871| NOTE: Implementation detail supporting search page behavior.
007872| src/components/Map.tsx:1297:               <div className="p-3">
007873| NOTE: Tailwind classes define layout and styling.
007874| src/components/Map.tsx:1298:                 <h3
007875| NOTE: JSX markup for search UI.
007876| src/components/Map.tsx:1299:                   className={`font-semibold text-sm line-clamp-1 mb-1 ${isDarkMode ? "text-white" : "text-zinc-900"}`}
007877| NOTE: Tailwind classes define layout and styling.
007878| src/components/Map.tsx:1300:                 >
007879| NOTE: Implementation detail supporting search page behavior.
007880| src/components/Map.tsx:1301:                   {selectedListing.title}
007881| NOTE: Implementation detail supporting search page behavior.
007882| src/components/Map.tsx:1302:                 </h3>
007883| NOTE: JSX markup for search UI.
007884| src/components/Map.tsx:1303:                 <p className="mb-3">
007885| NOTE: Tailwind classes define layout and styling.
007886| src/components/Map.tsx:1304:                   <span
007887| NOTE: JSX markup for search UI.
007888| src/components/Map.tsx:1305:                     className={`text-lg font-bold ${isDarkMode ? "text-white" : "text-zinc-900"}`}
007889| NOTE: Tailwind classes define layout and styling.
007890| src/components/Map.tsx:1306:                   >
007891| NOTE: Implementation detail supporting search page behavior.
007892| src/components/Map.tsx:1307:                     ${selectedListing.price}
007893| NOTE: Implementation detail supporting search page behavior.
007894| src/components/Map.tsx:1308:                   </span>
007895| NOTE: JSX markup for search UI.
007896| src/components/Map.tsx:1309:                   <span
007897| NOTE: JSX markup for search UI.
007898| src/components/Map.tsx:1310:                     className={`text-sm ${isDarkMode ? "text-zinc-400" : "text-zinc-500"}`}
007899| NOTE: Tailwind classes define layout and styling.
007900| src/components/Map.tsx:1311:                   >
007901| NOTE: Implementation detail supporting search page behavior.
007902| src/components/Map.tsx:1312:                     /month
007903| NOTE: Implementation detail supporting search page behavior.
007904| src/components/Map.tsx:1313:                   </span>
007905| NOTE: JSX markup for search UI.
007906| src/components/Map.tsx:1314:                 </p>
007907| NOTE: JSX markup for search UI.
007908| src/components/Map.tsx:1315:                 <div className="flex gap-2">
007909| NOTE: Tailwind classes define layout and styling.
007910| src/components/Map.tsx:1316:                   <Link
007911| NOTE: JSX markup for search UI.
007912| src/components/Map.tsx:1317:                     href={`/listings/${selectedListing.id}`}
007913| NOTE: Implementation detail supporting search page behavior.
007914| src/components/Map.tsx:1318:                     className="flex-1"
007915| NOTE: Tailwind classes define layout and styling.
007916| src/components/Map.tsx:1319:                   >
007917| NOTE: Implementation detail supporting search page behavior.
007918| src/components/Map.tsx:1320:                     <Button
007919| NOTE: JSX markup for search UI.
007920| src/components/Map.tsx:1321:                       size="sm"
007921| NOTE: Implementation detail supporting search page behavior.
007922| src/components/Map.tsx:1322:                       className={`w-full h-9 text-xs-plus font-medium rounded-lg ${
007923| NOTE: Tailwind classes define layout and styling.
007924| src/components/Map.tsx:1323:                         isDarkMode
007925| NOTE: Implementation detail supporting search page behavior.
007926| src/components/Map.tsx:1324:                           ? "bg-white text-zinc-900 hover:bg-zinc-200"
007927| NOTE: Implementation detail supporting search page behavior.
007928| src/components/Map.tsx:1325:                           : "bg-zinc-900 text-white hover:bg-zinc-800"
007929| NOTE: Implementation detail supporting search page behavior.
007930| src/components/Map.tsx:1326:                       }`}
007931| NOTE: Implementation detail supporting search page behavior.
007932| src/components/Map.tsx:1327:                     >
007933| NOTE: Implementation detail supporting search page behavior.
007934| src/components/Map.tsx:1328:                       View Details
007935| NOTE: Implementation detail supporting search page behavior.
007936| src/components/Map.tsx:1329:                     </Button>
007937| NOTE: JSX markup for search UI.
007938| src/components/Map.tsx:1330:                   </Link>
007939| NOTE: JSX markup for search UI.
007940| src/components/Map.tsx:1331:                   {selectedListing.ownerId && (
007941| NOTE: Implementation detail supporting search page behavior.
007942| src/components/Map.tsx:1332:                     <Link
007943| NOTE: JSX markup for search UI.
007944| src/components/Map.tsx:1333:                       href={`/messages?userId=${selectedListing.ownerId}`}
007945| NOTE: Implementation detail supporting search page behavior.
007946| src/components/Map.tsx:1334:                       className="flex-1"
007947| NOTE: Tailwind classes define layout and styling.
007948| src/components/Map.tsx:1335:                     >
007949| NOTE: Implementation detail supporting search page behavior.
007950| src/components/Map.tsx:1336:                       <Button
007951| NOTE: JSX markup for search UI.
007952| src/components/Map.tsx:1337:                         size="sm"
007953| NOTE: Implementation detail supporting search page behavior.
007954| src/components/Map.tsx:1338:                         variant="outline"
007955| NOTE: Implementation detail supporting search page behavior.
007956| src/components/Map.tsx:1339:                         className={`w-full h-9 text-xs-plus font-medium rounded-lg ${
007957| NOTE: Tailwind classes define layout and styling.
007958| src/components/Map.tsx:1340:                           isDarkMode
007959| NOTE: Implementation detail supporting search page behavior.
007960| src/components/Map.tsx:1341:                             ? "border-zinc-700 text-white hover:bg-zinc-800"
007961| NOTE: Implementation detail supporting search page behavior.
007962| src/components/Map.tsx:1342:                             : "border-zinc-300 text-zinc-900 hover:bg-zinc-100"
007963| NOTE: Implementation detail supporting search page behavior.
007964| src/components/Map.tsx:1343:                         }`}
007965| NOTE: Implementation detail supporting search page behavior.
007966| src/components/Map.tsx:1344:                       >
007967| NOTE: Implementation detail supporting search page behavior.
007968| src/components/Map.tsx:1345:                         Message
007969| NOTE: Implementation detail supporting search page behavior.
007970| src/components/Map.tsx:1346:                       </Button>
007971| NOTE: JSX markup for search UI.
007972| src/components/Map.tsx:1347:                     </Link>
007973| NOTE: JSX markup for search UI.
007974| src/components/Map.tsx:1348:                   )}
007975| NOTE: Implementation detail supporting search page behavior.
007976| src/components/Map.tsx:1349:                 </div>
007977| NOTE: JSX markup for search UI.
007978| src/components/Map.tsx:1350:               </div>
007979| NOTE: JSX markup for search UI.
007980| src/components/Map.tsx:1351:             </div>
007981| NOTE: JSX markup for search UI.
007982| src/components/Map.tsx:1352:           </Popup>
007983| NOTE: JSX markup for search UI.
007984| src/components/Map.tsx:1353:         )}
007985| NOTE: Implementation detail supporting search page behavior.
007986| src/components/Map.tsx:1354: 
007987| NOTE: Blank line for visual separation.
007988| src/components/Map.tsx:1355:         {/* Stacked listing popup - shown when clicking a marker with multiple listings */}
007989| NOTE: Implementation detail supporting search page behavior.
007990| src/components/Map.tsx:1356:         {selectedGroup && (
007991| NOTE: Implementation detail supporting search page behavior.
007992| src/components/Map.tsx:1357:           <StackedListingPopup
007993| NOTE: JSX markup for search UI.
007994| src/components/Map.tsx:1358:             group={selectedGroup}
007995| NOTE: Implementation detail supporting search page behavior.
007996| src/components/Map.tsx:1359:             onClose={() => setSelectedGroup(null)}
007997| NOTE: Implementation detail supporting search page behavior.
007998| src/components/Map.tsx:1360:             isDarkMode={isDarkMode}
007999| NOTE: Implementation detail supporting search page behavior.
008000| src/components/Map.tsx:1361:           />
008001| NOTE: Implementation detail supporting search page behavior.
008002| src/components/Map.tsx:1362:         )}
008003| NOTE: Implementation detail supporting search page behavior.
008004| src/components/Map.tsx:1363:       </MapGL>
008005| NOTE: JSX markup for search UI.
008006| src/components/Map.tsx:1364: 
008007| NOTE: Blank line for visual separation.
008008| src/components/Map.tsx:1365:       {/* Search as I move toggle - Consistent rounded-xl radius with soft shadow */}
008009| NOTE: Implementation detail supporting search page behavior.
008010| src/components/Map.tsx:1366:       <div className="absolute top-4 left-1/2 -translate-x-1/2 bg-white dark:bg-zinc-900 px-4 py-2.5 rounded-xl shadow-[0_4px_20px_-4px_rgba(0,0,0,0.1)] dark:shadow-[0_4px_20px_-4px_rgba(0,0,0,0.4)] border border-zinc-100 dark:border-zinc-800 flex items-center gap-2.5 z-10 transition-opacity duration-200">
008011| NOTE: Tailwind classes define layout and styling.
008012| src/components/Map.tsx:1367:         <input
008013| NOTE: JSX markup for search UI.
008014| src/components/Map.tsx:1368:           type="checkbox"
008015| NOTE: Implementation detail supporting search page behavior.
008016| src/components/Map.tsx:1369:           id="searchAsMove"
008017| NOTE: Implementation detail supporting search page behavior.
008018| src/components/Map.tsx:1370:           checked={searchAsMove}
008019| NOTE: Implementation detail supporting search page behavior.
008020| src/components/Map.tsx:1371:           onChange={(e) => setSearchAsMove(e.target.checked)}
008021| NOTE: Implementation detail supporting search page behavior.
008022| src/components/Map.tsx:1372:           className="w-4 h-4 rounded border-zinc-300 dark:border-zinc-600 text-zinc-900 dark:text-white bg-white dark:bg-zinc-800 focus:ring-zinc-900 dark:focus:ring-zinc-400 focus:ring-offset-0"
008023| NOTE: Tailwind classes define layout and styling.
008024| src/components/Map.tsx:1373:         />
008025| NOTE: Implementation detail supporting search page behavior.
008026| src/components/Map.tsx:1374:         <label
008027| NOTE: JSX markup for search UI.
008028| src/components/Map.tsx:1375:           htmlFor="searchAsMove"
008029| NOTE: Implementation detail supporting search page behavior.
008030| src/components/Map.tsx:1376:           className="text-xs-plus font-medium text-zinc-700 dark:text-zinc-300 cursor-pointer select-none"
008031| NOTE: Tailwind classes define layout and styling.
008032| src/components/Map.tsx:1377:         >
008033| NOTE: Implementation detail supporting search page behavior.
008034| src/components/Map.tsx:1378:           Search as I move the map
008035| NOTE: Implementation detail supporting search page behavior.
008036| src/components/Map.tsx:1379:         </label>
008037| NOTE: JSX markup for search UI.
008038| src/components/Map.tsx:1380:       </div>
008039| NOTE: JSX markup for search UI.
008040| src/components/Map.tsx:1381: 
008041| NOTE: Blank line for visual separation.
008042| src/components/Map.tsx:1382:       {/* Search this area CTA - show when map moved or location conflict (toggle OFF) */}
008043| NOTE: Implementation detail supporting search page behavior.
008044| src/components/Map.tsx:1383:       {!searchAsMove && ((hasUserMoved && boundsDirty) || locationConflict) && (
008045| NOTE: Implementation detail supporting search page behavior.
008046| src/components/Map.tsx:1384:         <MapMovedBanner
008047| NOTE: JSX markup for search UI.
008048| src/components/Map.tsx:1385:           variant="map"
008049| NOTE: Implementation detail supporting search page behavior.
008050| src/components/Map.tsx:1386:           onSearch={handleSearchThisArea}
008051| NOTE: Implementation detail supporting search page behavior.
008052| src/components/Map.tsx:1387:           onReset={handleResetToUrlBounds}
008053| NOTE: Implementation detail supporting search page behavior.
008054| src/components/Map.tsx:1388:           isLocationConflict={locationConflict}
008055| NOTE: Implementation detail supporting search page behavior.
008056| src/components/Map.tsx:1389:           locationName={searchLocationName}
008057| NOTE: Implementation detail supporting search page behavior.
008058| src/components/Map.tsx:1390:         />
008059| NOTE: Implementation detail supporting search page behavior.
008060| src/components/Map.tsx:1391:       )}
008061| NOTE: Implementation detail supporting search page behavior.
008062| src/components/Map.tsx:1392: 
008063| NOTE: Blank line for visual separation.
008064| src/components/Map.tsx:1393:       {/* Fit results button - show when user has panned away from results */}
008065| NOTE: Implementation detail supporting search page behavior.
008066| src/components/Map.tsx:1394:       {effectiveListings.length > 0 && hasUserMoved && (
008067| NOTE: Implementation detail supporting search page behavior.
008068| src/components/Map.tsx:1395:         <button
008069| NOTE: JSX markup for search UI.
008070| src/components/Map.tsx:1396:           onClick={handleFitResults}
008071| NOTE: Implementation detail supporting search page behavior.
008072| src/components/Map.tsx:1397:           className="absolute bottom-4 left-4 px-3 py-1.5 bg-white dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 rounded-lg text-xs font-medium shadow border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-colors z-10"
008073| NOTE: Tailwind classes define layout and styling.
008074| src/components/Map.tsx:1398:         >
008075| NOTE: Implementation detail supporting search page behavior.
008076| src/components/Map.tsx:1399:           Fit results
008077| NOTE: Implementation detail supporting search page behavior.
008078| src/components/Map.tsx:1400:         </button>
008079| NOTE: JSX markup for search UI.
008080| src/components/Map.tsx:1401:       )}
008081| NOTE: Implementation detail supporting search page behavior.
008082| src/components/Map.tsx:1402:     </div>
008083| NOTE: JSX markup for search UI.
008084| src/components/Map.tsx:1403:   );
008085| NOTE: Implementation detail supporting search page behavior.
008086| src/components/Map.tsx:1404: }
008087| NOTE: Implementation detail supporting search page behavior.
008088| FILE END: src/components/Map.tsx
008089| 
008090| FILE START: src/components/Pagination.tsx
008091| FILE ROLE: Auto-discovered dependency in search page graph.
008092| src/components/Pagination.tsx:1: "use client";
008093| NOTE: Implementation detail supporting search page behavior.
008094| src/components/Pagination.tsx:2: 
008095| NOTE: Blank line for visual separation.
008096| src/components/Pagination.tsx:3: import { useRouter, useSearchParams } from "next/navigation";
008097| NOTE: Imports dependency for this module.
008098| src/components/Pagination.tsx:4: import { useTransition } from "react";
008099| NOTE: Imports dependency for this module.
008100| src/components/Pagination.tsx:5: import { ChevronLeft, ChevronRight, Loader2, Info } from "lucide-react";
008101| NOTE: Imports dependency for this module.
008102| src/components/Pagination.tsx:6: 
008103| NOTE: Blank line for visual separation.
008104| src/components/Pagination.tsx:7: /**
008105| NOTE: Block comment line describing behavior or context.
008106| src/components/Pagination.tsx:8:  * Hybrid pagination props - supports both exact and unknown totals.
008107| NOTE: Block comment line describing behavior or context.
008108| src/components/Pagination.tsx:9:  *
008109| NOTE: Block comment line describing behavior or context.
008110| src/components/Pagination.tsx:10:  * When totalItems is known (\u2264100 results):
008111| NOTE: Block comment line describing behavior or context.
008112| src/components/Pagination.tsx:11:  *   - Shows "Showing 1 to 12 of 50 results"
008113| NOTE: Block comment line describing behavior or context.
008114| src/components/Pagination.tsx:12:  *   - Full page number navigation
008115| NOTE: Block comment line describing behavior or context.
008116| src/components/Pagination.tsx:13:  *
008117| NOTE: Block comment line describing behavior or context.
008118| src/components/Pagination.tsx:14:  * When totalItems is null (>100 results):
008119| NOTE: Block comment line describing behavior or context.
008120| src/components/Pagination.tsx:15:  *   - Shows "Showing 1-12 (100+ results)"
008121| NOTE: Block comment line describing behavior or context.
008122| src/components/Pagination.tsx:16:  *   - Simplified prev/next navigation with page indicator
008123| NOTE: Block comment line describing behavior or context.
008124| src/components/Pagination.tsx:17:  */
008125| NOTE: Block comment line describing behavior or context.
008126| src/components/Pagination.tsx:18: interface PaginationProps {
008127| NOTE: Type declaration for search data contracts.
008128| src/components/Pagination.tsx:19:   currentPage: number;
008129| NOTE: Implementation detail supporting search page behavior.
008130| src/components/Pagination.tsx:20:   totalPages: number | null;
008131| NOTE: Implementation detail supporting search page behavior.
008132| src/components/Pagination.tsx:21:   totalItems: number | null;
008133| NOTE: Implementation detail supporting search page behavior.
008134| src/components/Pagination.tsx:22:   itemsPerPage: number;
008135| NOTE: Implementation detail supporting search page behavior.
008136| src/components/Pagination.tsx:23:   hasNextPage: boolean;
008137| NOTE: Implementation detail supporting search page behavior.
008138| src/components/Pagination.tsx:24:   hasPrevPage: boolean;
008139| NOTE: Implementation detail supporting search page behavior.
008140| src/components/Pagination.tsx:25: }
008141| NOTE: Implementation detail supporting search page behavior.
008142| src/components/Pagination.tsx:26: 
008143| NOTE: Blank line for visual separation.
008144| src/components/Pagination.tsx:27: export default function Pagination({
008145| NOTE: Exports main component for this module.
008146| src/components/Pagination.tsx:28:   currentPage,
008147| NOTE: Implementation detail supporting search page behavior.
008148| src/components/Pagination.tsx:29:   totalPages,
008149| NOTE: Implementation detail supporting search page behavior.
008150| src/components/Pagination.tsx:30:   totalItems,
008151| NOTE: Implementation detail supporting search page behavior.
008152| src/components/Pagination.tsx:31:   itemsPerPage,
008153| NOTE: Implementation detail supporting search page behavior.
008154| src/components/Pagination.tsx:32:   hasNextPage,
008155| NOTE: Implementation detail supporting search page behavior.
008156| src/components/Pagination.tsx:33:   hasPrevPage,
008157| NOTE: Implementation detail supporting search page behavior.
008158| src/components/Pagination.tsx:34: }: PaginationProps) {
008159| NOTE: Implementation detail supporting search page behavior.
008160| src/components/Pagination.tsx:35:   const router = useRouter();
008161| NOTE: Local declaration used by search logic or UI.
008162| src/components/Pagination.tsx:36:   const searchParams = useSearchParams();
008163| NOTE: Local declaration used by search logic or UI.
008164| src/components/Pagination.tsx:37:   const [isPending, startTransition] = useTransition();
008165| NOTE: Local declaration used by search logic or UI.
008166| src/components/Pagination.tsx:38: 
008167| NOTE: Blank line for visual separation.
008168| src/components/Pagination.tsx:39:   // Hide pagination if there's only one page and we know the total
008169| NOTE: Line comment documents intent or constraints.
008170| src/components/Pagination.tsx:40:   // For unknown totals, always show pagination controls
008171| NOTE: Line comment documents intent or constraints.
008172| src/components/Pagination.tsx:41:   const hasExactTotal = totalItems !== null && totalPages !== null;
008173| NOTE: Local declaration used by search logic or UI.
008174| src/components/Pagination.tsx:42:   if (hasExactTotal && totalPages <= 1) return null;
008175| NOTE: Conditional logic controlling rendering or flow.
008176| src/components/Pagination.tsx:43: 
008177| NOTE: Blank line for visual separation.
008178| src/components/Pagination.tsx:44:   // For unknown totals with no prev/next, also hide
008179| NOTE: Line comment documents intent or constraints.
008180| src/components/Pagination.tsx:45:   if (!hasExactTotal && !hasNextPage && !hasPrevPage) return null;
008181| NOTE: Conditional logic controlling rendering or flow.
008182| src/components/Pagination.tsx:46: 
008183| NOTE: Blank line for visual separation.
008184| src/components/Pagination.tsx:47:   const handlePageChange = (page: number) => {
008185| NOTE: Local declaration used by search logic or UI.
008186| src/components/Pagination.tsx:48:     startTransition(() => {
008187| NOTE: Implementation detail supporting search page behavior.
008188| src/components/Pagination.tsx:49:       const params = new URLSearchParams(searchParams.toString());
008189| NOTE: Local declaration used by search logic or UI.
008190| src/components/Pagination.tsx:50:       params.set("page", page.toString());
008191| NOTE: Implementation detail supporting search page behavior.
008192| src/components/Pagination.tsx:51:       router.push(`?${params.toString()}`, { scroll: false });
008193| NOTE: Routing logic updates search URL state.
008194| src/components/Pagination.tsx:52:     });
008195| NOTE: Implementation detail supporting search page behavior.
008196| src/components/Pagination.tsx:53:   };
008197| NOTE: Implementation detail supporting search page behavior.
008198| src/components/Pagination.tsx:54: 
008199| NOTE: Blank line for visual separation.
008200| src/components/Pagination.tsx:55:   // Generate page numbers to show (only for exact totals)
008201| NOTE: Line comment documents intent or constraints.
008202| src/components/Pagination.tsx:56:   const getPageNumbers = () => {
008203| NOTE: Local declaration used by search logic or UI.
008204| src/components/Pagination.tsx:57:     if (!hasExactTotal || totalPages === null) return [];
008205| NOTE: Conditional logic controlling rendering or flow.
008206| src/components/Pagination.tsx:58: 
008207| NOTE: Blank line for visual separation.
008208| src/components/Pagination.tsx:59:     const pages: (number | string)[] = [];
008209| NOTE: Local declaration used by search logic or UI.
008210| src/components/Pagination.tsx:60:     const showEllipsis = totalPages > 7;
008211| NOTE: Local declaration used by search logic or UI.
008212| src/components/Pagination.tsx:61: 
008213| NOTE: Blank line for visual separation.
008214| src/components/Pagination.tsx:62:     if (!showEllipsis) {
008215| NOTE: Conditional logic controlling rendering or flow.
008216| src/components/Pagination.tsx:63:       for (let i = 1; i <= totalPages; i++) {
008217| NOTE: Implementation detail supporting search page behavior.
008218| src/components/Pagination.tsx:64:         pages.push(i);
008219| NOTE: Implementation detail supporting search page behavior.
008220| src/components/Pagination.tsx:65:       }
008221| NOTE: Implementation detail supporting search page behavior.
008222| src/components/Pagination.tsx:66:     } else {
008223| NOTE: Implementation detail supporting search page behavior.
008224| src/components/Pagination.tsx:67:       // Always show first page
008225| NOTE: Line comment documents intent or constraints.
008226| src/components/Pagination.tsx:68:       pages.push(1);
008227| NOTE: Implementation detail supporting search page behavior.
008228| src/components/Pagination.tsx:69: 
008229| NOTE: Blank line for visual separation.
008230| src/components/Pagination.tsx:70:       if (currentPage > 3) {
008231| NOTE: Conditional logic controlling rendering or flow.
008232| src/components/Pagination.tsx:71:         pages.push("...");
008233| NOTE: Implementation detail supporting search page behavior.
008234| src/components/Pagination.tsx:72:       }
008235| NOTE: Implementation detail supporting search page behavior.
008236| src/components/Pagination.tsx:73: 
008237| NOTE: Blank line for visual separation.
008238| src/components/Pagination.tsx:74:       // Show pages around current page
008239| NOTE: Line comment documents intent or constraints.
008240| src/components/Pagination.tsx:75:       const start = Math.max(2, currentPage - 1);
008241| NOTE: Local declaration used by search logic or UI.
008242| src/components/Pagination.tsx:76:       const end = Math.min(totalPages - 1, currentPage + 1);
008243| NOTE: Local declaration used by search logic or UI.
008244| src/components/Pagination.tsx:77: 
008245| NOTE: Blank line for visual separation.
008246| src/components/Pagination.tsx:78:       for (let i = start; i <= end; i++) {
008247| NOTE: Implementation detail supporting search page behavior.
008248| src/components/Pagination.tsx:79:         pages.push(i);
008249| NOTE: Implementation detail supporting search page behavior.
008250| src/components/Pagination.tsx:80:       }
008251| NOTE: Implementation detail supporting search page behavior.
008252| src/components/Pagination.tsx:81: 
008253| NOTE: Blank line for visual separation.
008254| src/components/Pagination.tsx:82:       if (currentPage < totalPages - 2) {
008255| NOTE: Conditional logic controlling rendering or flow.
008256| src/components/Pagination.tsx:83:         pages.push("...");
008257| NOTE: Implementation detail supporting search page behavior.
008258| src/components/Pagination.tsx:84:       }
008259| NOTE: Implementation detail supporting search page behavior.
008260| src/components/Pagination.tsx:85: 
008261| NOTE: Blank line for visual separation.
008262| src/components/Pagination.tsx:86:       // Always show last page
008263| NOTE: Line comment documents intent or constraints.
008264| src/components/Pagination.tsx:87:       if (totalPages > 1) {
008265| NOTE: Conditional logic controlling rendering or flow.
008266| src/components/Pagination.tsx:88:         pages.push(totalPages);
008267| NOTE: Implementation detail supporting search page behavior.
008268| src/components/Pagination.tsx:89:       }
008269| NOTE: Implementation detail supporting search page behavior.
008270| src/components/Pagination.tsx:90:     }
008271| NOTE: Implementation detail supporting search page behavior.
008272| src/components/Pagination.tsx:91: 
008273| NOTE: Blank line for visual separation.
008274| src/components/Pagination.tsx:92:     return pages;
008275| NOTE: Return statement for component or helper output.
008276| src/components/Pagination.tsx:93:   };
008277| NOTE: Implementation detail supporting search page behavior.
008278| src/components/Pagination.tsx:94: 
008279| NOTE: Blank line for visual separation.
008280| src/components/Pagination.tsx:95:   const startItem = (currentPage - 1) * itemsPerPage + 1;
008281| NOTE: Local declaration used by search logic or UI.
008282| src/components/Pagination.tsx:96:   const endItem = hasExactTotal
008283| NOTE: Local declaration used by search logic or UI.
008284| src/components/Pagination.tsx:97:     ? Math.min(currentPage * itemsPerPage, totalItems!)
008285| NOTE: Implementation detail supporting search page behavior.
008286| src/components/Pagination.tsx:98:     : currentPage * itemsPerPage;
008287| NOTE: Implementation detail supporting search page behavior.
008288| src/components/Pagination.tsx:99: 
008289| NOTE: Blank line for visual separation.
008290| src/components/Pagination.tsx:100:   // Render results info based on whether we have exact total
008291| NOTE: Line comment documents intent or constraints.
008292| src/components/Pagination.tsx:101:   const renderResultsInfo = () => {
008293| NOTE: Local declaration used by search logic or UI.
008294| src/components/Pagination.tsx:102:     if (hasExactTotal) {
008295| NOTE: Conditional logic controlling rendering or flow.
008296| src/components/Pagination.tsx:103:       return (
008297| NOTE: Return statement for component or helper output.
008298| src/components/Pagination.tsx:104:         <p className="text-sm text-zinc-500">
008299| NOTE: Tailwind classes define layout and styling.
008300| src/components/Pagination.tsx:105:           Showing{" "}
008301| NOTE: Implementation detail supporting search page behavior.
008302| src/components/Pagination.tsx:106:           <span className="font-medium text-zinc-900 dark:text-zinc-100">
008303| NOTE: Tailwind classes define layout and styling.
008304| src/components/Pagination.tsx:107:             {startItem}
008305| NOTE: Implementation detail supporting search page behavior.
008306| src/components/Pagination.tsx:108:           </span>{" "}
008307| NOTE: JSX markup for search UI.
008308| src/components/Pagination.tsx:109:           to{" "}
008309| NOTE: Implementation detail supporting search page behavior.
008310| src/components/Pagination.tsx:110:           <span className="font-medium text-zinc-900 dark:text-zinc-100">
008311| NOTE: Tailwind classes define layout and styling.
008312| src/components/Pagination.tsx:111:             {endItem}
008313| NOTE: Implementation detail supporting search page behavior.
008314| src/components/Pagination.tsx:112:           </span>{" "}
008315| NOTE: JSX markup for search UI.
008316| src/components/Pagination.tsx:113:           of{" "}
008317| NOTE: Implementation detail supporting search page behavior.
008318| src/components/Pagination.tsx:114:           <span className="font-medium text-zinc-900 dark:text-zinc-100">
008319| NOTE: Tailwind classes define layout and styling.
008320| src/components/Pagination.tsx:115:             {totalItems}
008321| NOTE: Implementation detail supporting search page behavior.
008322| src/components/Pagination.tsx:116:           </span>{" "}
008323| NOTE: JSX markup for search UI.
008324| src/components/Pagination.tsx:117:           results
008325| NOTE: Implementation detail supporting search page behavior.
008326| src/components/Pagination.tsx:118:           {isPending && (
008327| NOTE: Implementation detail supporting search page behavior.
008328| src/components/Pagination.tsx:119:             <span className="ml-2 text-zinc-400">(Loading...)</span>
008329| NOTE: Tailwind classes define layout and styling.
008330| src/components/Pagination.tsx:120:           )}
008331| NOTE: Implementation detail supporting search page behavior.
008332| src/components/Pagination.tsx:121:         </p>
008333| NOTE: JSX markup for search UI.
008334| src/components/Pagination.tsx:122:       );
008335| NOTE: Implementation detail supporting search page behavior.
008336| src/components/Pagination.tsx:123:     }
008337| NOTE: Implementation detail supporting search page behavior.
008338| src/components/Pagination.tsx:124: 
008339| NOTE: Blank line for visual separation.
008340| src/components/Pagination.tsx:125:     // Unknown total (>100 results)
008341| NOTE: Line comment documents intent or constraints.
008342| src/components/Pagination.tsx:126:     return (
008343| NOTE: Return statement for component or helper output.
008344| src/components/Pagination.tsx:127:       <p className="text-sm text-zinc-500">
008345| NOTE: Tailwind classes define layout and styling.
008346| src/components/Pagination.tsx:128:         <span className="font-medium text-zinc-900 dark:text-zinc-100">
008347| NOTE: Tailwind classes define layout and styling.
008348| src/components/Pagination.tsx:129:           Page {currentPage}
008349| NOTE: Implementation detail supporting search page behavior.
008350| src/components/Pagination.tsx:130:         </span>{" "}
008351| NOTE: JSX markup for search UI.
008352| src/components/Pagination.tsx:131:         <span className="text-zinc-400">\u00B7</span>{" "}
008353| NOTE: Tailwind classes define layout and styling.
008354| src/components/Pagination.tsx:132:         <span className="inline-flex items-center gap-1 group relative">
008355| NOTE: Tailwind classes define layout and styling.
008356| src/components/Pagination.tsx:133:           <span className="text-zinc-500">100+ results</span>
008357| NOTE: Tailwind classes define layout and styling.
008358| src/components/Pagination.tsx:134:           <button
008359| NOTE: JSX markup for search UI.
008360| src/components/Pagination.tsx:135:             type="button"
008361| NOTE: Implementation detail supporting search page behavior.
008362| src/components/Pagination.tsx:136:             className="text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-1 rounded-full"
008363| NOTE: Tailwind classes define layout and styling.
008364| src/components/Pagination.tsx:137:             aria-label="Why 100+ results?"
008365| NOTE: Accessibility attribute for screen readers.
008366| src/components/Pagination.tsx:138:           >
008367| NOTE: Implementation detail supporting search page behavior.
008368| src/components/Pagination.tsx:139:             <Info className="w-3.5 h-3.5" />
008369| NOTE: Tailwind classes define layout and styling.
008370| src/components/Pagination.tsx:140:           </button>
008371| NOTE: JSX markup for search UI.
008372| src/components/Pagination.tsx:141:           {/* Tooltip - shows on hover/focus within group */}
008373| NOTE: Implementation detail supporting search page behavior.
008374| src/components/Pagination.tsx:142:           <span
008375| NOTE: JSX markup for search UI.
008376| src/components/Pagination.tsx:143:             role="tooltip"
008377| NOTE: Implementation detail supporting search page behavior.
008378| src/components/Pagination.tsx:144:             className="invisible group-hover:visible group-focus-within:visible absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-1.5 text-xs font-medium text-white bg-zinc-800 dark:bg-zinc-700 rounded-lg shadow-lg whitespace-nowrap z-50 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity"
008379| NOTE: Tailwind classes define layout and styling.
008380| src/components/Pagination.tsx:145:           >
008381| NOTE: Implementation detail supporting search page behavior.
008382| src/components/Pagination.tsx:146:             Exact counts shown up to 100 for faster search
008383| NOTE: Implementation detail supporting search page behavior.
008384| src/components/Pagination.tsx:147:             <span className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-zinc-800 dark:border-t-zinc-700" />
008385| NOTE: Tailwind classes define layout and styling.
008386| src/components/Pagination.tsx:148:           </span>
008387| NOTE: JSX markup for search UI.
008388| src/components/Pagination.tsx:149:         </span>
008389| NOTE: JSX markup for search UI.
008390| src/components/Pagination.tsx:150:         {isPending && <span className="ml-2 text-zinc-400">(Loading...)</span>}
008391| NOTE: Tailwind classes define layout and styling.
008392| src/components/Pagination.tsx:151:       </p>
008393| NOTE: JSX markup for search UI.
008394| src/components/Pagination.tsx:152:     );
008395| NOTE: Implementation detail supporting search page behavior.
008396| src/components/Pagination.tsx:153:   };
008397| NOTE: Implementation detail supporting search page behavior.
008398| src/components/Pagination.tsx:154: 
008399| NOTE: Blank line for visual separation.
008400| src/components/Pagination.tsx:155:   return (
008401| NOTE: Return statement for component or helper output.
008402| src/components/Pagination.tsx:156:     <nav
008403| NOTE: JSX markup for search UI.
008404| src/components/Pagination.tsx:157:       className={`flex flex-col sm:flex-row items-center justify-between gap-4 py-6 sm:py-8 transition-opacity ${isPending ? "opacity-70" : ""}`}
008405| NOTE: Tailwind classes define layout and styling.
008406| src/components/Pagination.tsx:158:       aria-label="Pagination navigation"
008407| NOTE: Accessibility attribute for screen readers.
008408| src/components/Pagination.tsx:159:       aria-busy={isPending}
008409| NOTE: Accessibility attribute for screen readers.
008410| src/components/Pagination.tsx:160:     >
008411| NOTE: Implementation detail supporting search page behavior.
008412| src/components/Pagination.tsx:161:       {/* Results info */}
008413| NOTE: Implementation detail supporting search page behavior.
008414| src/components/Pagination.tsx:162:       {renderResultsInfo()}
008415| NOTE: Implementation detail supporting search page behavior.
008416| src/components/Pagination.tsx:163: 
008417| NOTE: Blank line for visual separation.
008418| src/components/Pagination.tsx:164:       {/* Pagination controls */}
008419| NOTE: Implementation detail supporting search page behavior.
008420| src/components/Pagination.tsx:165:       <div
008421| NOTE: JSX markup for search UI.
008422| src/components/Pagination.tsx:166:         className="flex items-center gap-1"
008423| NOTE: Tailwind classes define layout and styling.
008424| src/components/Pagination.tsx:167:         role="group"
008425| NOTE: Implementation detail supporting search page behavior.
008426| src/components/Pagination.tsx:168:         aria-label="Page navigation"
008427| NOTE: Accessibility attribute for screen readers.
008428| src/components/Pagination.tsx:169:       >
008429| NOTE: Implementation detail supporting search page behavior.
008430| src/components/Pagination.tsx:170:         {/* Previous button */}
008431| NOTE: Implementation detail supporting search page behavior.
008432| src/components/Pagination.tsx:171:         <button
008433| NOTE: JSX markup for search UI.
008434| src/components/Pagination.tsx:172:           onClick={() => handlePageChange(currentPage - 1)}
008435| NOTE: Implementation detail supporting search page behavior.
008436| src/components/Pagination.tsx:173:           disabled={!hasPrevPage || isPending}
008437| NOTE: Implementation detail supporting search page behavior.
008438| src/components/Pagination.tsx:174:           aria-label="Go to previous page"
008439| NOTE: Accessibility attribute for screen readers.
008440| src/components/Pagination.tsx:175:           className="p-2.5 sm:p-2 rounded-lg border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-target"
008441| NOTE: Tailwind classes define layout and styling.
008442| src/components/Pagination.tsx:176:         >
008443| NOTE: Implementation detail supporting search page behavior.
008444| src/components/Pagination.tsx:177:           {isPending ? (
008445| NOTE: Implementation detail supporting search page behavior.
008446| src/components/Pagination.tsx:178:             <Loader2 className="w-4 h-4 animate-spin" />
008447| NOTE: Tailwind classes define layout and styling.
008448| src/components/Pagination.tsx:179:           ) : (
008449| NOTE: Implementation detail supporting search page behavior.
008450| src/components/Pagination.tsx:180:             <ChevronLeft className="w-4 h-4" />
008451| NOTE: Tailwind classes define layout and styling.
008452| src/components/Pagination.tsx:181:           )}
008453| NOTE: Implementation detail supporting search page behavior.
008454| src/components/Pagination.tsx:182:         </button>
008455| NOTE: JSX markup for search UI.
008456| src/components/Pagination.tsx:183: 
008457| NOTE: Blank line for visual separation.
008458| src/components/Pagination.tsx:184:         {/* Page numbers - only show for exact totals */}
008459| NOTE: Implementation detail supporting search page behavior.
008460| src/components/Pagination.tsx:185:         {hasExactTotal && (
008461| NOTE: Implementation detail supporting search page behavior.
008462| src/components/Pagination.tsx:186:           <div className="flex items-center gap-0.5 sm:gap-1">
008463| NOTE: Tailwind classes define layout and styling.
008464| src/components/Pagination.tsx:187:             {getPageNumbers().map((page, index) =>
008465| NOTE: Implementation detail supporting search page behavior.
008466| src/components/Pagination.tsx:188:               typeof page === "number" ? (
008467| NOTE: Implementation detail supporting search page behavior.
008468| src/components/Pagination.tsx:189:                 <button
008469| NOTE: JSX markup for search UI.
008470| src/components/Pagination.tsx:190:                   key={index}
008471| NOTE: Implementation detail supporting search page behavior.
008472| src/components/Pagination.tsx:191:                   onClick={() => handlePageChange(page)}
008473| NOTE: Implementation detail supporting search page behavior.
008474| src/components/Pagination.tsx:192:                   disabled={isPending}
008475| NOTE: Implementation detail supporting search page behavior.
008476| src/components/Pagination.tsx:193:                   aria-label={`Page ${page}`}
008477| NOTE: Accessibility attribute for screen readers.
008478| src/components/Pagination.tsx:194:                   aria-current={page === currentPage ? "page" : undefined}
008479| NOTE: Accessibility attribute for screen readers.
008480| src/components/Pagination.tsx:195:                   className={`min-w-[40px] sm:min-w-[36px] h-10 sm:h-9 px-2 sm:px-3 rounded-lg text-sm font-medium transition-colors touch-target disabled:cursor-not-allowed ${
008481| NOTE: Tailwind classes define layout and styling.
008482| src/components/Pagination.tsx:196:                     page === currentPage
008483| NOTE: Implementation detail supporting search page behavior.
008484| src/components/Pagination.tsx:197:                       ? "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900"
008485| NOTE: Implementation detail supporting search page behavior.
008486| src/components/Pagination.tsx:198:                       : "text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white disabled:hover:bg-transparent"
008487| NOTE: Implementation detail supporting search page behavior.
008488| src/components/Pagination.tsx:199:                   }`}
008489| NOTE: Implementation detail supporting search page behavior.
008490| src/components/Pagination.tsx:200:                 >
008491| NOTE: Implementation detail supporting search page behavior.
008492| src/components/Pagination.tsx:201:                   {page}
008493| NOTE: Implementation detail supporting search page behavior.
008494| src/components/Pagination.tsx:202:                 </button>
008495| NOTE: JSX markup for search UI.
008496| src/components/Pagination.tsx:203:               ) : (
008497| NOTE: Implementation detail supporting search page behavior.
008498| src/components/Pagination.tsx:204:                 <span
008499| NOTE: JSX markup for search UI.
008500| src/components/Pagination.tsx:205:                   key={index}
008501| NOTE: Implementation detail supporting search page behavior.
008502| src/components/Pagination.tsx:206:                   className="px-1 sm:px-2 text-zinc-400"
008503| NOTE: Tailwind classes define layout and styling.
008504| src/components/Pagination.tsx:207:                   aria-hidden="true"
008505| NOTE: Accessibility attribute for screen readers.
008506| src/components/Pagination.tsx:208:                 >
008507| NOTE: Implementation detail supporting search page behavior.
008508| src/components/Pagination.tsx:209:                   {page}
008509| NOTE: Implementation detail supporting search page behavior.
008510| src/components/Pagination.tsx:210:                 </span>
008511| NOTE: JSX markup for search UI.
008512| src/components/Pagination.tsx:211:               ),
008513| NOTE: Implementation detail supporting search page behavior.
008514| src/components/Pagination.tsx:212:             )}
008515| NOTE: Implementation detail supporting search page behavior.
008516| src/components/Pagination.tsx:213:           </div>
008517| NOTE: JSX markup for search UI.
008518| src/components/Pagination.tsx:214:         )}
008519| NOTE: Implementation detail supporting search page behavior.
008520| src/components/Pagination.tsx:215: 
008521| NOTE: Blank line for visual separation.
008522| src/components/Pagination.tsx:216:         {/* For unknown totals, show simple page indicator */}
008523| NOTE: Implementation detail supporting search page behavior.
008524| src/components/Pagination.tsx:217:         {!hasExactTotal && (
008525| NOTE: Implementation detail supporting search page behavior.
008526| src/components/Pagination.tsx:218:           <div className="px-3 py-1.5 text-sm font-medium text-zinc-600 dark:text-zinc-400">
008527| NOTE: Tailwind classes define layout and styling.
008528| src/components/Pagination.tsx:219:             Page {currentPage}
008529| NOTE: Implementation detail supporting search page behavior.
008530| src/components/Pagination.tsx:220:           </div>
008531| NOTE: JSX markup for search UI.
008532| src/components/Pagination.tsx:221:         )}
008533| NOTE: Implementation detail supporting search page behavior.
008534| src/components/Pagination.tsx:222: 
008535| NOTE: Blank line for visual separation.
008536| src/components/Pagination.tsx:223:         {/* Next button */}
008537| NOTE: Implementation detail supporting search page behavior.
008538| src/components/Pagination.tsx:224:         <button
008539| NOTE: JSX markup for search UI.
008540| src/components/Pagination.tsx:225:           onClick={() => handlePageChange(currentPage + 1)}
008541| NOTE: Implementation detail supporting search page behavior.
008542| src/components/Pagination.tsx:226:           disabled={!hasNextPage || isPending}
008543| NOTE: Implementation detail supporting search page behavior.
008544| src/components/Pagination.tsx:227:           aria-label="Go to next page"
008545| NOTE: Accessibility attribute for screen readers.
008546| src/components/Pagination.tsx:228:           className="p-2.5 sm:p-2 rounded-lg border border-zinc-200 dark:border-zinc-700 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-50 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-target"
008547| NOTE: Tailwind classes define layout and styling.
008548| src/components/Pagination.tsx:229:         >
008549| NOTE: Implementation detail supporting search page behavior.
008550| src/components/Pagination.tsx:230:           {isPending ? (
008551| NOTE: Implementation detail supporting search page behavior.
008552| src/components/Pagination.tsx:231:             <Loader2 className="w-4 h-4 animate-spin" />
008553| NOTE: Tailwind classes define layout and styling.
008554| src/components/Pagination.tsx:232:           ) : (
008555| NOTE: Implementation detail supporting search page behavior.
008556| src/components/Pagination.tsx:233:             <ChevronRight className="w-4 h-4" />
008557| NOTE: Tailwind classes define layout and styling.
008558| src/components/Pagination.tsx:234:           )}
008559| NOTE: Implementation detail supporting search page behavior.
008560| src/components/Pagination.tsx:235:         </button>
008561| NOTE: JSX markup for search UI.
008562| src/components/Pagination.tsx:236:       </div>
008563| NOTE: JSX markup for search UI.
008564| src/components/Pagination.tsx:237:     </nav>
008565| NOTE: JSX markup for search UI.
008566| src/components/Pagination.tsx:238:   );
008567| NOTE: Implementation detail supporting search page behavior.
008568| src/components/Pagination.tsx:239: }
008569| NOTE: Implementation detail supporting search page behavior.
008570| FILE END: src/components/Pagination.tsx
008571| 
008572| FILE START: src/components/PersistentMapWrapper.tsx
008573| FILE ROLE: Lazy-loaded map wrapper with map data fetching and v2 context support.
008574| src/components/PersistentMapWrapper.tsx:1: "use client";
008575| NOTE: Implementation detail supporting search page behavior.
008576| src/components/PersistentMapWrapper.tsx:2: 
008577| NOTE: Blank line for visual separation.
008578| src/components/PersistentMapWrapper.tsx:3: /**
008579| NOTE: Block comment line describing behavior or context.
008580| src/components/PersistentMapWrapper.tsx:4:  * PersistentMapWrapper - A wrapper component for the map that fetches its own data.
008581| NOTE: Block comment line describing behavior or context.
008582| src/components/PersistentMapWrapper.tsx:5:  *
008583| NOTE: Block comment line describing behavior or context.
008584| src/components/PersistentMapWrapper.tsx:6:  * This component is designed to live in the layout.tsx so it persists across
008585| NOTE: Block comment line describing behavior or context.
008586| src/components/PersistentMapWrapper.tsx:7:  * page navigations (router.replace/push). It reads URL search params and fetches
008587| NOTE: Block comment line describing behavior or context.
008588| src/components/PersistentMapWrapper.tsx:8:  * map listings data via the /api/map-listings endpoint.
008589| NOTE: Block comment line describing behavior or context.
008590| src/components/PersistentMapWrapper.tsx:9:  *
008591| NOTE: Block comment line describing behavior or context.
008592| src/components/PersistentMapWrapper.tsx:10:  * Key benefits:
008593| NOTE: Block comment line describing behavior or context.
008594| src/components/PersistentMapWrapper.tsx:11:  * - Map stays mounted across /search navigations (no Mapbox re-init = no extra billing)
008595| NOTE: Block comment line describing behavior or context.
008596| src/components/PersistentMapWrapper.tsx:12:  * - Uses useSearchParams() to react to URL changes
008597| NOTE: Block comment line describing behavior or context.
008598| src/components/PersistentMapWrapper.tsx:13:  * - Fetches data independently of the server component page
008599| NOTE: Block comment line describing behavior or context.
008600| src/components/PersistentMapWrapper.tsx:14:  *
008601| NOTE: Block comment line describing behavior or context.
008602| src/components/PersistentMapWrapper.tsx:15:  * Cost optimization (Phase 1):
008603| NOTE: Block comment line describing behavior or context.
008604| src/components/PersistentMapWrapper.tsx:16:  * - DynamicMap is NOT imported at module scope
008605| NOTE: Block comment line describing behavior or context.
008606| src/components/PersistentMapWrapper.tsx:17:  * - Only loads Mapbox bundle when shouldRenderMap is true
008607| NOTE: Block comment line describing behavior or context.
008608| src/components/PersistentMapWrapper.tsx:18:  * - Unmounts entirely when hidden (not CSS display:none)
008609| NOTE: Block comment line describing behavior or context.
008610| src/components/PersistentMapWrapper.tsx:19:  */
008611| NOTE: Block comment line describing behavior or context.
008612| src/components/PersistentMapWrapper.tsx:20: 
008613| NOTE: Blank line for visual separation.
008614| src/components/PersistentMapWrapper.tsx:21: import { useSearchParams } from "next/navigation";
008615| NOTE: Imports dependency for this module.
008616| src/components/PersistentMapWrapper.tsx:22: import {
008617| NOTE: Imports dependency for this module.
008618| src/components/PersistentMapWrapper.tsx:23:   useEffect,
008619| NOTE: Defines side effect for syncing with external state.
008620| src/components/PersistentMapWrapper.tsx:24:   useState,
008621| NOTE: Initializes local state for search UI behavior.
008622| src/components/PersistentMapWrapper.tsx:25:   useRef,
008623| NOTE: Uses ref for stable mutable storage between renders.
008624| src/components/PersistentMapWrapper.tsx:26:   useCallback,
008625| NOTE: Memoizes callback to preserve references across renders.
008626| src/components/PersistentMapWrapper.tsx:27:   lazy,
008627| NOTE: Implementation detail supporting search page behavior.
008628| src/components/PersistentMapWrapper.tsx:28:   Suspense,
008629| NOTE: Suspense boundary for async rendering.
008630| src/components/PersistentMapWrapper.tsx:29: } from "react";
008631| NOTE: Implementation detail supporting search page behavior.
008632| src/components/PersistentMapWrapper.tsx:30: import type { MapListingData } from "@/lib/data";
008633| NOTE: Imports dependency for this module.
008634| src/components/PersistentMapWrapper.tsx:31: import { useSearchV2Data } from "@/contexts/SearchV2DataContext";
008635| NOTE: Imports dependency for this module.
008636| src/components/PersistentMapWrapper.tsx:32: import { useSearchTransitionSafe } from "@/contexts/SearchTransitionContext";
008637| NOTE: Imports dependency for this module.
008638| src/components/PersistentMapWrapper.tsx:33: 
008639| NOTE: Blank line for visual separation.
008640| src/components/PersistentMapWrapper.tsx:34: // CRITICAL: Lazy import - only loads when component renders
008641| NOTE: Line comment documents intent or constraints.
008642| src/components/PersistentMapWrapper.tsx:35: // This defers the 944KB mapbox-gl bundle until user opts to see map
008643| NOTE: Line comment documents intent or constraints.
008644| src/components/PersistentMapWrapper.tsx:36: const LazyDynamicMap = lazy(() => import("./DynamicMap"));
008645| NOTE: Local declaration used by search logic or UI.
008646| src/components/PersistentMapWrapper.tsx:37: 
008647| NOTE: Blank line for visual separation.
008648| src/components/PersistentMapWrapper.tsx:38: // Maximum viewport span (matches server-side validation)
008649| NOTE: Line comment documents intent or constraints.
008650| src/components/PersistentMapWrapper.tsx:39: // Increased from 2 to 5 (~550km) to allow regional zoom-out views
008651| NOTE: Line comment documents intent or constraints.
008652| src/components/PersistentMapWrapper.tsx:40: // with Mapbox native clustering handling dense markers at wide viewports
008653| NOTE: Line comment documents intent or constraints.
008654| src/components/PersistentMapWrapper.tsx:41: const MAX_LAT_SPAN = 5;
008655| NOTE: Local declaration used by search logic or UI.
008656| src/components/PersistentMapWrapper.tsx:42: const MAX_LNG_SPAN = 5;
008657| NOTE: Local declaration used by search logic or UI.
008658| src/components/PersistentMapWrapper.tsx:43: 
008659| NOTE: Blank line for visual separation.
008660| src/components/PersistentMapWrapper.tsx:44: /**
008661| NOTE: Block comment line describing behavior or context.
008662| src/components/PersistentMapWrapper.tsx:45:  * Get user-friendly error message based on HTTP status
008663| NOTE: Block comment line describing behavior or context.
008664| src/components/PersistentMapWrapper.tsx:46:  */
008665| NOTE: Block comment line describing behavior or context.
008666| src/components/PersistentMapWrapper.tsx:47: function getStatusErrorMessage(status: number, serverMessage?: string): string {
008667| NOTE: Defines a helper or component function.
008668| src/components/PersistentMapWrapper.tsx:48:   switch (status) {
008669| NOTE: Implementation detail supporting search page behavior.
008670| src/components/PersistentMapWrapper.tsx:49:     case 400:
008671| NOTE: Implementation detail supporting search page behavior.
008672| src/components/PersistentMapWrapper.tsx:50:       return serverMessage || "Invalid map area. Try zooming in.";
008673| NOTE: Return statement for component or helper output.
008674| src/components/PersistentMapWrapper.tsx:51:     case 429:
008675| NOTE: Implementation detail supporting search page behavior.
008676| src/components/PersistentMapWrapper.tsx:52:       return "Too many requests. Please wait a moment.";
008677| NOTE: Return statement for component or helper output.
008678| src/components/PersistentMapWrapper.tsx:53:     case 500:
008679| NOTE: Implementation detail supporting search page behavior.
008680| src/components/PersistentMapWrapper.tsx:54:       return "Server error. Please try again.";
008681| NOTE: Return statement for component or helper output.
008682| src/components/PersistentMapWrapper.tsx:55:     default:
008683| NOTE: Implementation detail supporting search page behavior.
008684| src/components/PersistentMapWrapper.tsx:56:       return serverMessage || "Failed to load map data";
008685| NOTE: Return statement for component or helper output.
008686| src/components/PersistentMapWrapper.tsx:57:   }
008687| NOTE: Implementation detail supporting search page behavior.
008688| src/components/PersistentMapWrapper.tsx:58: }
008689| NOTE: Implementation detail supporting search page behavior.
008690| src/components/PersistentMapWrapper.tsx:59: 
008691| NOTE: Blank line for visual separation.
008692| src/components/PersistentMapWrapper.tsx:60: /**
008693| NOTE: Block comment line describing behavior or context.
008694| src/components/PersistentMapWrapper.tsx:61:  * Validate viewport bounds before making API request
008695| NOTE: Block comment line describing behavior or context.
008696| src/components/PersistentMapWrapper.tsx:62:  * Mirrors server-side validation to prevent unnecessary requests
008697| NOTE: Block comment line describing behavior or context.
008698| src/components/PersistentMapWrapper.tsx:63:  */
008699| NOTE: Block comment line describing behavior or context.
008700| src/components/PersistentMapWrapper.tsx:64: function isValidViewport(params: URLSearchParams): {
008701| NOTE: Defines a helper or component function.
008702| src/components/PersistentMapWrapper.tsx:65:   valid: boolean;
008703| NOTE: Implementation detail supporting search page behavior.
008704| src/components/PersistentMapWrapper.tsx:66:   error?: string;
008705| NOTE: Implementation detail supporting search page behavior.
008706| src/components/PersistentMapWrapper.tsx:67: } {
008707| NOTE: Implementation detail supporting search page behavior.
008708| src/components/PersistentMapWrapper.tsx:68:   const minLng = parseFloat(params.get("minLng") || "");
008709| NOTE: Local declaration used by search logic or UI.
008710| src/components/PersistentMapWrapper.tsx:69:   const maxLng = parseFloat(params.get("maxLng") || "");
008711| NOTE: Local declaration used by search logic or UI.
008712| src/components/PersistentMapWrapper.tsx:70:   const minLat = parseFloat(params.get("minLat") || "");
008713| NOTE: Local declaration used by search logic or UI.
008714| src/components/PersistentMapWrapper.tsx:71:   const maxLat = parseFloat(params.get("maxLat") || "");
008715| NOTE: Local declaration used by search logic or UI.
008716| src/components/PersistentMapWrapper.tsx:72: 
008717| NOTE: Blank line for visual separation.
008718| src/components/PersistentMapWrapper.tsx:73:   // NaN/Infinity check
008719| NOTE: Line comment documents intent or constraints.
008720| src/components/PersistentMapWrapper.tsx:74:   if (
008721| NOTE: Conditional logic controlling rendering or flow.
008722| src/components/PersistentMapWrapper.tsx:75:     !Number.isFinite(minLng) ||
008723| NOTE: Implementation detail supporting search page behavior.
008724| src/components/PersistentMapWrapper.tsx:76:     !Number.isFinite(maxLng) ||
008725| NOTE: Implementation detail supporting search page behavior.
008726| src/components/PersistentMapWrapper.tsx:77:     !Number.isFinite(minLat) ||
008727| NOTE: Implementation detail supporting search page behavior.
008728| src/components/PersistentMapWrapper.tsx:78:     !Number.isFinite(maxLat)
008729| NOTE: Implementation detail supporting search page behavior.
008730| src/components/PersistentMapWrapper.tsx:79:   ) {
008731| NOTE: Implementation detail supporting search page behavior.
008732| src/components/PersistentMapWrapper.tsx:80:     return { valid: false, error: "Invalid coordinates" };
008733| NOTE: Return statement for component or helper output.
008734| src/components/PersistentMapWrapper.tsx:81:   }
008735| NOTE: Implementation detail supporting search page behavior.
008736| src/components/PersistentMapWrapper.tsx:82: 
008737| NOTE: Blank line for visual separation.
008738| src/components/PersistentMapWrapper.tsx:83:   // Viewport size check (handle antimeridian crossing like server does)
008739| NOTE: Line comment documents intent or constraints.
008740| src/components/PersistentMapWrapper.tsx:84:   const latSpan = maxLat - minLat;
008741| NOTE: Local declaration used by search logic or UI.
008742| src/components/PersistentMapWrapper.tsx:85:   const crossesAntimeridian = minLng > maxLng;
008743| NOTE: Local declaration used by search logic or UI.
008744| src/components/PersistentMapWrapper.tsx:86:   const lngSpan = crossesAntimeridian
008745| NOTE: Local declaration used by search logic or UI.
008746| src/components/PersistentMapWrapper.tsx:87:     ? 180 - minLng + (maxLng + 180)
008747| NOTE: Implementation detail supporting search page behavior.
008748| src/components/PersistentMapWrapper.tsx:88:     : maxLng - minLng;
008749| NOTE: Implementation detail supporting search page behavior.
008750| src/components/PersistentMapWrapper.tsx:89: 
008751| NOTE: Blank line for visual separation.
008752| src/components/PersistentMapWrapper.tsx:90:   if (latSpan > MAX_LAT_SPAN || lngSpan > MAX_LNG_SPAN) {
008753| NOTE: Conditional logic controlling rendering or flow.
008754| src/components/PersistentMapWrapper.tsx:91:     return { valid: false, error: "Zoom in further to see listings" };
008755| NOTE: Return statement for component or helper output.
008756| src/components/PersistentMapWrapper.tsx:92:   }
008757| NOTE: Implementation detail supporting search page behavior.
008758| src/components/PersistentMapWrapper.tsx:93: 
008759| NOTE: Blank line for visual separation.
008760| src/components/PersistentMapWrapper.tsx:94:   return { valid: true };
008761| NOTE: Return statement for component or helper output.
008762| src/components/PersistentMapWrapper.tsx:95: }
008763| NOTE: Implementation detail supporting search page behavior.
008764| src/components/PersistentMapWrapper.tsx:96: 
008765| NOTE: Blank line for visual separation.
008766| src/components/PersistentMapWrapper.tsx:97: // Error banner component for map data fetch errors
008767| NOTE: Line comment documents intent or constraints.
008768| src/components/PersistentMapWrapper.tsx:98: function MapErrorBanner({
008769| NOTE: Defines a helper or component function.
008770| src/components/PersistentMapWrapper.tsx:99:   message,
008771| NOTE: Implementation detail supporting search page behavior.
008772| src/components/PersistentMapWrapper.tsx:100:   onRetry,
008773| NOTE: Implementation detail supporting search page behavior.
008774| src/components/PersistentMapWrapper.tsx:101: }: {
008775| NOTE: Implementation detail supporting search page behavior.
008776| src/components/PersistentMapWrapper.tsx:102:   message: string;
008777| NOTE: Implementation detail supporting search page behavior.
008778| src/components/PersistentMapWrapper.tsx:103:   onRetry: () => void;
008779| NOTE: Implementation detail supporting search page behavior.
008780| src/components/PersistentMapWrapper.tsx:104: }) {
008781| NOTE: Implementation detail supporting search page behavior.
008782| src/components/PersistentMapWrapper.tsx:105:   return (
008783| NOTE: Return statement for component or helper output.
008784| src/components/PersistentMapWrapper.tsx:106:     <div className="absolute top-4 left-4 right-4 z-10 bg-amber-50 dark:bg-amber-950/50 border border-amber-200 dark:border-amber-800 rounded-lg p-3 flex items-center justify-between gap-2">
008785| NOTE: Tailwind classes define layout and styling.
008786| src/components/PersistentMapWrapper.tsx:107:       <span className="text-sm text-amber-700 dark:text-amber-300">
008787| NOTE: Tailwind classes define layout and styling.
008788| src/components/PersistentMapWrapper.tsx:108:         {message}
008789| NOTE: Implementation detail supporting search page behavior.
008790| src/components/PersistentMapWrapper.tsx:109:       </span>
008791| NOTE: JSX markup for search UI.
008792| src/components/PersistentMapWrapper.tsx:110:       <button
008793| NOTE: JSX markup for search UI.
008794| src/components/PersistentMapWrapper.tsx:111:         onClick={onRetry}
008795| NOTE: Implementation detail supporting search page behavior.
008796| src/components/PersistentMapWrapper.tsx:112:         className="text-sm font-medium text-amber-800 dark:text-amber-200 hover:underline"
008797| NOTE: Tailwind classes define layout and styling.
008798| src/components/PersistentMapWrapper.tsx:113:       >
008799| NOTE: Implementation detail supporting search page behavior.
008800| src/components/PersistentMapWrapper.tsx:114:         Retry
008801| NOTE: Implementation detail supporting search page behavior.
008802| src/components/PersistentMapWrapper.tsx:115:       </button>
008803| NOTE: JSX markup for search UI.
008804| src/components/PersistentMapWrapper.tsx:116:     </div>
008805| NOTE: JSX markup for search UI.
008806| src/components/PersistentMapWrapper.tsx:117:   );
008807| NOTE: Implementation detail supporting search page behavior.
008808| src/components/PersistentMapWrapper.tsx:118: }
008809| NOTE: Implementation detail supporting search page behavior.
008810| src/components/PersistentMapWrapper.tsx:119: 
008811| NOTE: Blank line for visual separation.
008812| src/components/PersistentMapWrapper.tsx:120: // Loading placeholder for lazy map component
008813| NOTE: Line comment documents intent or constraints.
008814| src/components/PersistentMapWrapper.tsx:121: function MapLoadingPlaceholder() {
008815| NOTE: Defines a helper or component function.
008816| src/components/PersistentMapWrapper.tsx:122:   return (
008817| NOTE: Return statement for component or helper output.
008818| src/components/PersistentMapWrapper.tsx:123:     <div className="w-full h-full bg-zinc-100 dark:bg-zinc-800 animate-pulse flex items-center justify-center">
008819| NOTE: Tailwind classes define layout and styling.
008820| src/components/PersistentMapWrapper.tsx:124:       <div className="text-zinc-400 dark:text-zinc-500 text-sm">
008821| NOTE: Tailwind classes define layout and styling.
008822| src/components/PersistentMapWrapper.tsx:125:         Loading map...
008823| NOTE: Implementation detail supporting search page behavior.
008824| src/components/PersistentMapWrapper.tsx:126:       </div>
008825| NOTE: JSX markup for search UI.
008826| src/components/PersistentMapWrapper.tsx:127:     </div>
008827| NOTE: JSX markup for search UI.
008828| src/components/PersistentMapWrapper.tsx:128:   );
008829| NOTE: Implementation detail supporting search page behavior.
008830| src/components/PersistentMapWrapper.tsx:129: }
008831| NOTE: Implementation detail supporting search page behavior.
008832| src/components/PersistentMapWrapper.tsx:130: 
008833| NOTE: Blank line for visual separation.
008834| src/components/PersistentMapWrapper.tsx:131: // Subtle loading overlay shown when list is transitioning (filter change)
008835| NOTE: Line comment documents intent or constraints.
008836| src/components/PersistentMapWrapper.tsx:132: // This coordinates visual feedback between map and list
008837| NOTE: Line comment documents intent or constraints.
008838| src/components/PersistentMapWrapper.tsx:133: function MapTransitionOverlay() {
008839| NOTE: Defines a helper or component function.
008840| src/components/PersistentMapWrapper.tsx:134:   return (
008841| NOTE: Return statement for component or helper output.
008842| src/components/PersistentMapWrapper.tsx:135:     <div
008843| NOTE: JSX markup for search UI.
008844| src/components/PersistentMapWrapper.tsx:136:       className="absolute inset-0 z-10 bg-white/30 dark:bg-zinc-950/30 pointer-events-none flex items-start justify-center pt-20"
008845| NOTE: Tailwind classes define layout and styling.
008846| src/components/PersistentMapWrapper.tsx:137:       role="status"
008847| NOTE: Implementation detail supporting search page behavior.
008848| src/components/PersistentMapWrapper.tsx:138:       aria-label="Updating map results"
008849| NOTE: Accessibility attribute for screen readers.
008850| src/components/PersistentMapWrapper.tsx:139:     >
008851| NOTE: Implementation detail supporting search page behavior.
008852| src/components/PersistentMapWrapper.tsx:140:       <span className="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-zinc-800 rounded-full shadow-md border border-zinc-200 dark:border-zinc-700 text-xs font-medium text-zinc-500 dark:text-zinc-400">
008853| NOTE: Tailwind classes define layout and styling.
008854| src/components/PersistentMapWrapper.tsx:141:         <span className="w-1.5 h-1.5 rounded-full bg-zinc-400 dark:bg-zinc-500 animate-pulse" />
008855| NOTE: Tailwind classes define layout and styling.
008856| src/components/PersistentMapWrapper.tsx:142:         Updating...
008857| NOTE: Implementation detail supporting search page behavior.
008858| src/components/PersistentMapWrapper.tsx:143:       </span>
008859| NOTE: JSX markup for search UI.
008860| src/components/PersistentMapWrapper.tsx:144:     </div>
008861| NOTE: JSX markup for search UI.
008862| src/components/PersistentMapWrapper.tsx:145:   );
008863| NOTE: Implementation detail supporting search page behavior.
008864| src/components/PersistentMapWrapper.tsx:146: }
008865| NOTE: Implementation detail supporting search page behavior.
008866| src/components/PersistentMapWrapper.tsx:147: 
008867| NOTE: Blank line for visual separation.
008868| src/components/PersistentMapWrapper.tsx:148: interface PersistentMapWrapperProps {
008869| NOTE: Type declaration for search data contracts.
008870| src/components/PersistentMapWrapper.tsx:149:   /**
008871| NOTE: Block comment line describing behavior or context.
008872| src/components/PersistentMapWrapper.tsx:150:    * Whether to render the map. When false, map bundle is not loaded.
008873| NOTE: Block comment line describing behavior or context.
008874| src/components/PersistentMapWrapper.tsx:151:    * Used for lazy map initialization (cost optimization).
008875| NOTE: Block comment line describing behavior or context.
008876| src/components/PersistentMapWrapper.tsx:152:    */
008877| NOTE: Block comment line describing behavior or context.
008878| src/components/PersistentMapWrapper.tsx:153:   shouldRenderMap: boolean;
008879| NOTE: Implementation detail supporting search page behavior.
008880| src/components/PersistentMapWrapper.tsx:154: }
008881| NOTE: Implementation detail supporting search page behavior.
008882| src/components/PersistentMapWrapper.tsx:155: 
008883| NOTE: Blank line for visual separation.
008884| src/components/PersistentMapWrapper.tsx:156: export default function PersistentMapWrapper({
008885| NOTE: Exports main component for this module.
008886| src/components/PersistentMapWrapper.tsx:157:   shouldRenderMap,
008887| NOTE: Implementation detail supporting search page behavior.
008888| src/components/PersistentMapWrapper.tsx:158: }: PersistentMapWrapperProps) {
008889| NOTE: Implementation detail supporting search page behavior.
008890| src/components/PersistentMapWrapper.tsx:159:   const searchParams = useSearchParams();
008891| NOTE: Local declaration used by search logic or UI.
008892| src/components/PersistentMapWrapper.tsx:160:   const [listings, setListings] = useState<MapListingData[]>([]);
008893| NOTE: Initializes local state for search UI behavior.
008894| src/components/PersistentMapWrapper.tsx:161:   const [isFetchingMapData, setIsFetchingMapData] = useState(false);
008895| NOTE: Initializes local state for search UI behavior.
008896| src/components/PersistentMapWrapper.tsx:162:   const [error, setError] = useState<string | null>(null);
008897| NOTE: Initializes local state for search UI behavior.
008898| src/components/PersistentMapWrapper.tsx:163: 
008899| NOTE: Blank line for visual separation.
008900| src/components/PersistentMapWrapper.tsx:164:   // Check for v2 data from context (injected by page.tsx via V2MapDataSetter)
008901| NOTE: Line comment documents intent or constraints.
008902| src/components/PersistentMapWrapper.tsx:165:   const { v2MapData, isV2Enabled } = useSearchV2Data();
008903| NOTE: Local declaration used by search logic or UI.
008904| src/components/PersistentMapWrapper.tsx:166: 
008905| NOTE: Blank line for visual separation.
008906| src/components/PersistentMapWrapper.tsx:167:   // Coordinate with list transitions - show overlay when list is loading
008907| NOTE: Line comment documents intent or constraints.
008908| src/components/PersistentMapWrapper.tsx:168:   const transitionContext = useSearchTransitionSafe();
008909| NOTE: Local declaration used by search logic or UI.
008910| src/components/PersistentMapWrapper.tsx:169:   const isListTransitioning = transitionContext?.isPending ?? false;
008911| NOTE: Local declaration used by search logic or UI.
008912| src/components/PersistentMapWrapper.tsx:170:   const hasV2Data = v2MapData !== null;
008913| NOTE: Local declaration used by search logic or UI.
008914| src/components/PersistentMapWrapper.tsx:171: 
008915| NOTE: Blank line for visual separation.
008916| src/components/PersistentMapWrapper.tsx:172:   // Track current params to detect changes for debouncing
008917| NOTE: Line comment documents intent or constraints.
008918| src/components/PersistentMapWrapper.tsx:173:   const lastFetchedParamsRef = useRef<string | null>(null);
008919| NOTE: Uses ref for stable mutable storage between renders.
008920| src/components/PersistentMapWrapper.tsx:174:   const fetchTimeoutRef = useRef<NodeJS.Timeout | null>(null);
008921| NOTE: Uses ref for stable mutable storage between renders.
008922| src/components/PersistentMapWrapper.tsx:175: 
008923| NOTE: Blank line for visual separation.
008924| src/components/PersistentMapWrapper.tsx:176:   const fetchListings = useCallback(
008925| NOTE: Memoizes callback to preserve references across renders.
008926| src/components/PersistentMapWrapper.tsx:177:     async (paramsString: string, signal?: AbortSignal) => {
008927| NOTE: Implementation detail supporting search page behavior.
008928| src/components/PersistentMapWrapper.tsx:178:       setIsFetchingMapData(true);
008929| NOTE: Implementation detail supporting search page behavior.
008930| src/components/PersistentMapWrapper.tsx:179:       setError(null);
008931| NOTE: Implementation detail supporting search page behavior.
008932| src/components/PersistentMapWrapper.tsx:180: 
008933| NOTE: Blank line for visual separation.
008934| src/components/PersistentMapWrapper.tsx:181:       try {
008935| NOTE: Implementation detail supporting search page behavior.
008936| src/components/PersistentMapWrapper.tsx:182:         const response = await fetch(`/api/map-listings?${paramsString}`, {
008937| NOTE: Local declaration used by search logic or UI.
008938| src/components/PersistentMapWrapper.tsx:183:           signal,
008939| NOTE: Implementation detail supporting search page behavior.
008940| src/components/PersistentMapWrapper.tsx:184:         });
008941| NOTE: Implementation detail supporting search page behavior.
008942| src/components/PersistentMapWrapper.tsx:185: 
008943| NOTE: Blank line for visual separation.
008944| src/components/PersistentMapWrapper.tsx:186:         if (!response.ok) {
008945| NOTE: Conditional logic controlling rendering or flow.
008946| src/components/PersistentMapWrapper.tsx:187:           // Extract detailed error from response body
008947| NOTE: Line comment documents intent or constraints.
008948| src/components/PersistentMapWrapper.tsx:188:           let serverMessage: string | undefined;
008949| NOTE: Local declaration used by search logic or UI.
008950| src/components/PersistentMapWrapper.tsx:189:           let requestId: string | undefined;
008951| NOTE: Local declaration used by search logic or UI.
008952| src/components/PersistentMapWrapper.tsx:190: 
008953| NOTE: Blank line for visual separation.
008954| src/components/PersistentMapWrapper.tsx:191:           try {
008955| NOTE: Implementation detail supporting search page behavior.
008956| src/components/PersistentMapWrapper.tsx:192:             const errorData = await response.json();
008957| NOTE: Local declaration used by search logic or UI.
008958| src/components/PersistentMapWrapper.tsx:193:             serverMessage = errorData.error;
008959| NOTE: Implementation detail supporting search page behavior.
008960| src/components/PersistentMapWrapper.tsx:194:             requestId = response.headers.get("x-request-id") || undefined;
008961| NOTE: Implementation detail supporting search page behavior.
008962| src/components/PersistentMapWrapper.tsx:195:           } catch {
008963| NOTE: Implementation detail supporting search page behavior.
008964| src/components/PersistentMapWrapper.tsx:196:             // JSON parsing failed, use status-based message
008965| NOTE: Line comment documents intent or constraints.
008966| src/components/PersistentMapWrapper.tsx:197:           }
008967| NOTE: Implementation detail supporting search page behavior.
008968| src/components/PersistentMapWrapper.tsx:198: 
008969| NOTE: Blank line for visual separation.
008970| src/components/PersistentMapWrapper.tsx:199:           // Log error for debugging (PII-safe - no raw params)
008971| NOTE: Line comment documents intent or constraints.
008972| src/components/PersistentMapWrapper.tsx:200:           // Use warn for 400 (expected validation failures) to avoid polluting error overlay
008973| NOTE: Line comment documents intent or constraints.
008974| src/components/PersistentMapWrapper.tsx:201:           if (response.status === 400) {
008975| NOTE: Conditional logic controlling rendering or flow.
008976| src/components/PersistentMapWrapper.tsx:202:             console.warn("Map viewport validation failed:", {
008977| NOTE: Implementation detail supporting search page behavior.
008978| src/components/PersistentMapWrapper.tsx:203:               status: response.status,
008979| NOTE: Implementation detail supporting search page behavior.
008980| src/components/PersistentMapWrapper.tsx:204:               error: serverMessage,
008981| NOTE: Implementation detail supporting search page behavior.
008982| src/components/PersistentMapWrapper.tsx:205:             });
008983| NOTE: Implementation detail supporting search page behavior.
008984| src/components/PersistentMapWrapper.tsx:206:           } else {
008985| NOTE: Implementation detail supporting search page behavior.
008986| src/components/PersistentMapWrapper.tsx:207:             console.error("Map listings fetch failed:", {
008987| NOTE: Implementation detail supporting search page behavior.
008988| src/components/PersistentMapWrapper.tsx:208:               status: response.status,
008989| NOTE: Implementation detail supporting search page behavior.
008990| src/components/PersistentMapWrapper.tsx:209:               statusText: response.statusText,
008991| NOTE: Implementation detail supporting search page behavior.
008992| src/components/PersistentMapWrapper.tsx:210:               error: serverMessage,
008993| NOTE: Implementation detail supporting search page behavior.
008994| src/components/PersistentMapWrapper.tsx:211:               requestId,
008995| NOTE: Implementation detail supporting search page behavior.
008996| src/components/PersistentMapWrapper.tsx:212:             });
008997| NOTE: Implementation detail supporting search page behavior.
008998| src/components/PersistentMapWrapper.tsx:213:           }
008999| NOTE: Implementation detail supporting search page behavior.
009000| src/components/PersistentMapWrapper.tsx:214: 
009001| NOTE: Blank line for visual separation.
009002| src/components/PersistentMapWrapper.tsx:215:           const errorMessage = getStatusErrorMessage(
009003| NOTE: Local declaration used by search logic or UI.
009004| src/components/PersistentMapWrapper.tsx:216:             response.status,
009005| NOTE: Implementation detail supporting search page behavior.
009006| src/components/PersistentMapWrapper.tsx:217:             serverMessage,
009007| NOTE: Implementation detail supporting search page behavior.
009008| src/components/PersistentMapWrapper.tsx:218:           );
009009| NOTE: Implementation detail supporting search page behavior.
009010| src/components/PersistentMapWrapper.tsx:219:           throw new Error(errorMessage);
009011| NOTE: Implementation detail supporting search page behavior.
009012| src/components/PersistentMapWrapper.tsx:220:         }
009013| NOTE: Implementation detail supporting search page behavior.
009014| src/components/PersistentMapWrapper.tsx:221: 
009015| NOTE: Blank line for visual separation.
009016| src/components/PersistentMapWrapper.tsx:222:         const data = await response.json();
009017| NOTE: Local declaration used by search logic or UI.
009018| src/components/PersistentMapWrapper.tsx:223:         setListings(data.listings || []);
009019| NOTE: Implementation detail supporting search page behavior.
009020| src/components/PersistentMapWrapper.tsx:224:       } catch (err) {
009021| NOTE: Implementation detail supporting search page behavior.
009022| src/components/PersistentMapWrapper.tsx:225:         if ((err as Error).name !== "AbortError") {
009023| NOTE: Conditional logic controlling rendering or flow.
009024| src/components/PersistentMapWrapper.tsx:226:           console.error("Failed to fetch map listings:", err);
009025| NOTE: Implementation detail supporting search page behavior.
009026| src/components/PersistentMapWrapper.tsx:227:           setError((err as Error).message || "Failed to load map data");
009027| NOTE: Implementation detail supporting search page behavior.
009028| src/components/PersistentMapWrapper.tsx:228:         }
009029| NOTE: Implementation detail supporting search page behavior.
009030| src/components/PersistentMapWrapper.tsx:229:       } finally {
009031| NOTE: Implementation detail supporting search page behavior.
009032| src/components/PersistentMapWrapper.tsx:230:         setIsFetchingMapData(false);
009033| NOTE: Implementation detail supporting search page behavior.
009034| src/components/PersistentMapWrapper.tsx:231:       }
009035| NOTE: Implementation detail supporting search page behavior.
009036| src/components/PersistentMapWrapper.tsx:232:     },
009037| NOTE: Implementation detail supporting search page behavior.
009038| src/components/PersistentMapWrapper.tsx:233:     [],
009039| NOTE: Implementation detail supporting search page behavior.
009040| src/components/PersistentMapWrapper.tsx:234:   );
009041| NOTE: Implementation detail supporting search page behavior.
009042| src/components/PersistentMapWrapper.tsx:235: 
009043| NOTE: Blank line for visual separation.
009044| src/components/PersistentMapWrapper.tsx:236:   // Single effect that handles both initial fetch and param changes
009045| NOTE: Line comment documents intent or constraints.
009046| src/components/PersistentMapWrapper.tsx:237:   // Only fetches when map is rendered to avoid unnecessary API calls
009047| NOTE: Line comment documents intent or constraints.
009048| src/components/PersistentMapWrapper.tsx:238:   // V2 mode: Skip fetch entirely when v2MapData is provided via context
009049| NOTE: Line comment documents intent or constraints.
009050| src/components/PersistentMapWrapper.tsx:239:   useEffect(() => {
009051| NOTE: Defines side effect for syncing with external state.
009052| src/components/PersistentMapWrapper.tsx:240:     // Don't fetch if map isn't being rendered
009053| NOTE: Line comment documents intent or constraints.
009054| src/components/PersistentMapWrapper.tsx:241:     if (!shouldRenderMap) {
009055| NOTE: Conditional logic controlling rendering or flow.
009056| src/components/PersistentMapWrapper.tsx:242:       return;
009057| NOTE: Implementation detail supporting search page behavior.
009058| src/components/PersistentMapWrapper.tsx:243:     }
009059| NOTE: Implementation detail supporting search page behavior.
009060| src/components/PersistentMapWrapper.tsx:244: 
009061| NOTE: Blank line for visual separation.
009062| src/components/PersistentMapWrapper.tsx:245:     // RACE GUARD: If v2 mode is signaled but data hasn't arrived yet,
009063| NOTE: Line comment documents intent or constraints.
009064| src/components/PersistentMapWrapper.tsx:246:     // delay the v1 fetch to give the setter time to run.
009065| NOTE: Line comment documents intent or constraints.
009066| src/components/PersistentMapWrapper.tsx:247:     // This prevents double-fetch and flicker.
009067| NOTE: Line comment documents intent or constraints.
009068| src/components/PersistentMapWrapper.tsx:248:     if (isV2Enabled && !hasV2Data) {
009069| NOTE: Conditional logic controlling rendering or flow.
009070| src/components/PersistentMapWrapper.tsx:249:       const raceGuardTimeout = setTimeout(() => {
009071| NOTE: Local declaration used by search logic or UI.
009072| src/components/PersistentMapWrapper.tsx:250:         // After delay, if still no v2 data, the component will re-render
009073| NOTE: Line comment documents intent or constraints.
009074| src/components/PersistentMapWrapper.tsx:251:         // and this effect will run again. If v2 data still hasn't arrived,
009075| NOTE: Line comment documents intent or constraints.
009076| src/components/PersistentMapWrapper.tsx:252:         // it means v2 failed and we should fall back to v1 (done on next effect run).
009077| NOTE: Line comment documents intent or constraints.
009078| src/components/PersistentMapWrapper.tsx:253:       }, 100); // 100ms is enough for React to flush the setter
009079| NOTE: Implementation detail supporting search page behavior.
009080| src/components/PersistentMapWrapper.tsx:254:       return () => clearTimeout(raceGuardTimeout);
009081| NOTE: Return statement for component or helper output.
009082| src/components/PersistentMapWrapper.tsx:255:     }
009083| NOTE: Implementation detail supporting search page behavior.
009084| src/components/PersistentMapWrapper.tsx:256: 
009085| NOTE: Blank line for visual separation.
009086| src/components/PersistentMapWrapper.tsx:257:     // Skip v1 fetch entirely if v2 data is provided via context
009087| NOTE: Line comment documents intent or constraints.
009088| src/components/PersistentMapWrapper.tsx:258:     if (hasV2Data) {
009089| NOTE: Conditional logic controlling rendering or flow.
009090| src/components/PersistentMapWrapper.tsx:259:       // Clear any stale v1 state
009091| NOTE: Line comment documents intent or constraints.
009092| src/components/PersistentMapWrapper.tsx:260:       setError(null);
009093| NOTE: Implementation detail supporting search page behavior.
009094| src/components/PersistentMapWrapper.tsx:261:       return;
009095| NOTE: Implementation detail supporting search page behavior.
009096| src/components/PersistentMapWrapper.tsx:262:     }
009097| NOTE: Implementation detail supporting search page behavior.
009098| src/components/PersistentMapWrapper.tsx:263: 
009099| NOTE: Blank line for visual separation.
009100| src/components/PersistentMapWrapper.tsx:264:     const paramsString = searchParams.toString();
009101| NOTE: Local declaration used by search logic or UI.
009102| src/components/PersistentMapWrapper.tsx:265: 
009103| NOTE: Blank line for visual separation.
009104| src/components/PersistentMapWrapper.tsx:266:     // Skip if we've already fetched for these exact params
009105| NOTE: Line comment documents intent or constraints.
009106| src/components/PersistentMapWrapper.tsx:267:     if (paramsString === lastFetchedParamsRef.current) {
009107| NOTE: Conditional logic controlling rendering or flow.
009108| src/components/PersistentMapWrapper.tsx:268:       return;
009109| NOTE: Implementation detail supporting search page behavior.
009110| src/components/PersistentMapWrapper.tsx:269:     }
009111| NOTE: Implementation detail supporting search page behavior.
009112| src/components/PersistentMapWrapper.tsx:270: 
009113| NOTE: Blank line for visual separation.
009114| src/components/PersistentMapWrapper.tsx:271:     // Skip if bounds are missing - wait for map to set them
009115| NOTE: Line comment documents intent or constraints.
009116| src/components/PersistentMapWrapper.tsx:272:     const hasBounds =
009117| NOTE: Local declaration used by search logic or UI.
009118| src/components/PersistentMapWrapper.tsx:273:       searchParams.has("minLng") &&
009119| NOTE: Implementation detail supporting search page behavior.
009120| src/components/PersistentMapWrapper.tsx:274:       searchParams.has("maxLng") &&
009121| NOTE: Implementation detail supporting search page behavior.
009122| src/components/PersistentMapWrapper.tsx:275:       searchParams.has("minLat") &&
009123| NOTE: Implementation detail supporting search page behavior.
009124| src/components/PersistentMapWrapper.tsx:276:       searchParams.has("maxLat");
009125| NOTE: Implementation detail supporting search page behavior.
009126| src/components/PersistentMapWrapper.tsx:277: 
009127| NOTE: Blank line for visual separation.
009128| src/components/PersistentMapWrapper.tsx:278:     if (!hasBounds) {
009129| NOTE: Conditional logic controlling rendering or flow.
009130| src/components/PersistentMapWrapper.tsx:279:       // Don't fetch without bounds - map will set them after load
009131| NOTE: Line comment documents intent or constraints.
009132| src/components/PersistentMapWrapper.tsx:280:       // Clear loading state so map is interactive
009133| NOTE: Line comment documents intent or constraints.
009134| src/components/PersistentMapWrapper.tsx:281:       setIsFetchingMapData(false);
009135| NOTE: Implementation detail supporting search page behavior.
009136| src/components/PersistentMapWrapper.tsx:282:       return;
009137| NOTE: Implementation detail supporting search page behavior.
009138| src/components/PersistentMapWrapper.tsx:283:     }
009139| NOTE: Implementation detail supporting search page behavior.
009140| src/components/PersistentMapWrapper.tsx:284: 
009141| NOTE: Blank line for visual separation.
009142| src/components/PersistentMapWrapper.tsx:285:     // Client-side bounds validation to prevent unnecessary API requests
009143| NOTE: Line comment documents intent or constraints.
009144| src/components/PersistentMapWrapper.tsx:286:     const validation = isValidViewport(searchParams);
009145| NOTE: Local declaration used by search logic or UI.
009146| src/components/PersistentMapWrapper.tsx:287:     if (!validation.valid) {
009147| NOTE: Conditional logic controlling rendering or flow.
009148| src/components/PersistentMapWrapper.tsx:288:       setError(validation.error || "Invalid viewport");
009149| NOTE: Implementation detail supporting search page behavior.
009150| src/components/PersistentMapWrapper.tsx:289:       setIsFetchingMapData(false);
009151| NOTE: Implementation detail supporting search page behavior.
009152| src/components/PersistentMapWrapper.tsx:290:       lastFetchedParamsRef.current = paramsString; // Prevent re-validation spam
009153| NOTE: Implementation detail supporting search page behavior.
009154| src/components/PersistentMapWrapper.tsx:291:       return;
009155| NOTE: Implementation detail supporting search page behavior.
009156| src/components/PersistentMapWrapper.tsx:292:     }
009157| NOTE: Implementation detail supporting search page behavior.
009158| src/components/PersistentMapWrapper.tsx:293: 
009159| NOTE: Blank line for visual separation.
009160| src/components/PersistentMapWrapper.tsx:294:     // Clear error if viewport is now valid
009161| NOTE: Line comment documents intent or constraints.
009162| src/components/PersistentMapWrapper.tsx:295:     setError(null);
009163| NOTE: Implementation detail supporting search page behavior.
009164| src/components/PersistentMapWrapper.tsx:296: 
009165| NOTE: Blank line for visual separation.
009166| src/components/PersistentMapWrapper.tsx:297:     // Clear any pending fetch timeout
009167| NOTE: Line comment documents intent or constraints.
009168| src/components/PersistentMapWrapper.tsx:298:     if (fetchTimeoutRef.current) {
009169| NOTE: Conditional logic controlling rendering or flow.
009170| src/components/PersistentMapWrapper.tsx:299:       clearTimeout(fetchTimeoutRef.current);
009171| NOTE: Implementation detail supporting search page behavior.
009172| src/components/PersistentMapWrapper.tsx:300:     }
009173| NOTE: Implementation detail supporting search page behavior.
009174| src/components/PersistentMapWrapper.tsx:301: 
009175| NOTE: Blank line for visual separation.
009176| src/components/PersistentMapWrapper.tsx:302:     // Create abort controller for this fetch
009177| NOTE: Line comment documents intent or constraints.
009178| src/components/PersistentMapWrapper.tsx:303:     const abortController = new AbortController();
009179| NOTE: Local declaration used by search logic or UI.
009180| src/components/PersistentMapWrapper.tsx:304: 
009181| NOTE: Blank line for visual separation.
009182| src/components/PersistentMapWrapper.tsx:305:     // Throttle to 2s to stay within 30 req/min rate limit
009183| NOTE: Line comment documents intent or constraints.
009184| src/components/PersistentMapWrapper.tsx:306:     fetchTimeoutRef.current = setTimeout(() => {
009185| NOTE: Implementation detail supporting search page behavior.
009186| src/components/PersistentMapWrapper.tsx:307:       lastFetchedParamsRef.current = paramsString;
009187| NOTE: Implementation detail supporting search page behavior.
009188| src/components/PersistentMapWrapper.tsx:308:       fetchListings(paramsString, abortController.signal);
009189| NOTE: Implementation detail supporting search page behavior.
009190| src/components/PersistentMapWrapper.tsx:309:     }, 2000);
009191| NOTE: Implementation detail supporting search page behavior.
009192| src/components/PersistentMapWrapper.tsx:310: 
009193| NOTE: Blank line for visual separation.
009194| src/components/PersistentMapWrapper.tsx:311:     return () => {
009195| NOTE: Return statement for component or helper output.
009196| src/components/PersistentMapWrapper.tsx:312:       if (fetchTimeoutRef.current) {
009197| NOTE: Conditional logic controlling rendering or flow.
009198| src/components/PersistentMapWrapper.tsx:313:         clearTimeout(fetchTimeoutRef.current);
009199| NOTE: Implementation detail supporting search page behavior.
009200| src/components/PersistentMapWrapper.tsx:314:       }
009201| NOTE: Implementation detail supporting search page behavior.
009202| src/components/PersistentMapWrapper.tsx:315:       abortController.abort();
009203| NOTE: Implementation detail supporting search page behavior.
009204| src/components/PersistentMapWrapper.tsx:316:     };
009205| NOTE: Implementation detail supporting search page behavior.
009206| src/components/PersistentMapWrapper.tsx:317:   }, [searchParams, fetchListings, shouldRenderMap, isV2Enabled, hasV2Data]);
009207| NOTE: Implementation detail supporting search page behavior.
009208| src/components/PersistentMapWrapper.tsx:318: 
009209| NOTE: Blank line for visual separation.
009210| src/components/PersistentMapWrapper.tsx:319:   const handleRetry = useCallback(() => {
009211| NOTE: Memoizes callback to preserve references across renders.
009212| src/components/PersistentMapWrapper.tsx:320:     // Validate viewport before retrying - prevents API call for known-invalid viewports
009213| NOTE: Line comment documents intent or constraints.
009214| src/components/PersistentMapWrapper.tsx:321:     const validation = isValidViewport(searchParams);
009215| NOTE: Local declaration used by search logic or UI.
009216| src/components/PersistentMapWrapper.tsx:322:     if (!validation.valid) {
009217| NOTE: Conditional logic controlling rendering or flow.
009218| src/components/PersistentMapWrapper.tsx:323:       setError(validation.error || "Invalid viewport");
009219| NOTE: Implementation detail supporting search page behavior.
009220| src/components/PersistentMapWrapper.tsx:324:       return;
009221| NOTE: Implementation detail supporting search page behavior.
009222| src/components/PersistentMapWrapper.tsx:325:     }
009223| NOTE: Implementation detail supporting search page behavior.
009224| src/components/PersistentMapWrapper.tsx:326: 
009225| NOTE: Blank line for visual separation.
009226| src/components/PersistentMapWrapper.tsx:327:     // Force a refetch by clearing the last fetched ref
009227| NOTE: Line comment documents intent or constraints.
009228| src/components/PersistentMapWrapper.tsx:328:     lastFetchedParamsRef.current = null;
009229| NOTE: Implementation detail supporting search page behavior.
009230| src/components/PersistentMapWrapper.tsx:329:     setError(null);
009231| NOTE: Implementation detail supporting search page behavior.
009232| src/components/PersistentMapWrapper.tsx:330:     fetchListings(searchParams.toString());
009233| NOTE: Implementation detail supporting search page behavior.
009234| src/components/PersistentMapWrapper.tsx:331:   }, [searchParams, fetchListings]);
009235| NOTE: Implementation detail supporting search page behavior.
009236| src/components/PersistentMapWrapper.tsx:332: 
009237| NOTE: Blank line for visual separation.
009238| src/components/PersistentMapWrapper.tsx:333:   // CRITICAL: Don't render map component if shouldRenderMap is false
009239| NOTE: Line comment documents intent or constraints.
009240| src/components/PersistentMapWrapper.tsx:334:   // This prevents Mapbox GL JS from loading (saves ~944KB and Mapbox billing)
009241| NOTE: Line comment documents intent or constraints.
009242| src/components/PersistentMapWrapper.tsx:335:   if (!shouldRenderMap) {
009243| NOTE: Conditional logic controlling rendering or flow.
009244| src/components/PersistentMapWrapper.tsx:336:     return null;
009245| NOTE: Return statement for component or helper output.
009246| src/components/PersistentMapWrapper.tsx:337:   }
009247| NOTE: Implementation detail supporting search page behavior.
009248| src/components/PersistentMapWrapper.tsx:338: 
009249| NOTE: Blank line for visual separation.
009250| src/components/PersistentMapWrapper.tsx:339:   // Show loading placeholder while waiting for v2 data (race guard)
009251| NOTE: Line comment documents intent or constraints.
009252| src/components/PersistentMapWrapper.tsx:340:   // This prevents showing an empty map before v2MapData arrives
009253| NOTE: Line comment documents intent or constraints.
009254| src/components/PersistentMapWrapper.tsx:341:   if (isV2Enabled && !hasV2Data) {
009255| NOTE: Conditional logic controlling rendering or flow.
009256| src/components/PersistentMapWrapper.tsx:342:     return (
009257| NOTE: Return statement for component or helper output.
009258| src/components/PersistentMapWrapper.tsx:343:       <div className="relative h-full">
009259| NOTE: Tailwind classes define layout and styling.
009260| src/components/PersistentMapWrapper.tsx:344:         <MapLoadingPlaceholder />
009261| NOTE: JSX markup for search UI.
009262| src/components/PersistentMapWrapper.tsx:345:       </div>
009263| NOTE: JSX markup for search UI.
009264| src/components/PersistentMapWrapper.tsx:346:     );
009265| NOTE: Implementation detail supporting search page behavior.
009266| src/components/PersistentMapWrapper.tsx:347:   }
009267| NOTE: Implementation detail supporting search page behavior.
009268| src/components/PersistentMapWrapper.tsx:348: 
009269| NOTE: Blank line for visual separation.
009270| src/components/PersistentMapWrapper.tsx:349:   return (
009271| NOTE: Return statement for component or helper output.
009272| src/components/PersistentMapWrapper.tsx:350:     <div className="relative h-full">
009273| NOTE: Tailwind classes define layout and styling.
009274| src/components/PersistentMapWrapper.tsx:351:       {error && <MapErrorBanner message={error} onRetry={handleRetry} />}
009275| NOTE: Implementation detail supporting search page behavior.
009276| src/components/PersistentMapWrapper.tsx:352:       {/* Coordinated loading overlay - shows when list is transitioning (filter change) */}
009277| NOTE: Implementation detail supporting search page behavior.
009278| src/components/PersistentMapWrapper.tsx:353:       {isListTransitioning && <MapTransitionOverlay />}
009279| NOTE: Implementation detail supporting search page behavior.
009280| src/components/PersistentMapWrapper.tsx:354:       <Suspense fallback={<MapLoadingPlaceholder />}>
009281| NOTE: JSX markup for search UI.
009282| src/components/PersistentMapWrapper.tsx:355:         <LazyDynamicMap
009283| NOTE: JSX markup for search UI.
009284| src/components/PersistentMapWrapper.tsx:356:           listings={hasV2Data ? undefined : listings}
009285| NOTE: Implementation detail supporting search page behavior.
009286| src/components/PersistentMapWrapper.tsx:357:           v2MapData={v2MapData}
009287| NOTE: Implementation detail supporting search page behavior.
009288| src/components/PersistentMapWrapper.tsx:358:         />
009289| NOTE: Implementation detail supporting search page behavior.
009290| src/components/PersistentMapWrapper.tsx:359:       </Suspense>
009291| NOTE: JSX markup for search UI.
009292| src/components/PersistentMapWrapper.tsx:360:     </div>
009293| NOTE: JSX markup for search UI.
009294| src/components/PersistentMapWrapper.tsx:361:   );
009295| NOTE: Implementation detail supporting search page behavior.
009296| src/components/PersistentMapWrapper.tsx:362: }
009297| NOTE: Implementation detail supporting search page behavior.
009298| FILE END: src/components/PersistentMapWrapper.tsx
009299| 
009300| FILE START: src/components/SaveSearchButton.tsx
009301| FILE ROLE: Save search modal and alert settings.
009302| src/components/SaveSearchButton.tsx:1: "use client";
009303| NOTE: Implementation detail supporting search page behavior.
009304| src/components/SaveSearchButton.tsx:2: 
009305| NOTE: Blank line for visual separation.
009306| src/components/SaveSearchButton.tsx:3: import { useState } from "react";
009307| NOTE: Imports dependency for this module.
009308| src/components/SaveSearchButton.tsx:4: import { saveSearch } from "@/app/actions/saved-search";
009309| NOTE: Imports dependency for this module.
009310| src/components/SaveSearchButton.tsx:5: import type { SearchFilters } from "@/lib/search-utils";
009311| NOTE: Imports dependency for this module.
009312| src/components/SaveSearchButton.tsx:6: import { parseSearchParams, type RawSearchParams } from "@/lib/search-params";
009313| NOTE: Imports dependency for this module.
009314| src/components/SaveSearchButton.tsx:7: import { Bookmark, Loader2, X, Bell, BellOff } from "lucide-react";
009315| NOTE: Imports dependency for this module.
009316| src/components/SaveSearchButton.tsx:8: import { toast } from "sonner";
009317| NOTE: Imports dependency for this module.
009318| src/components/SaveSearchButton.tsx:9: import { useSearchParams } from "next/navigation";
009319| NOTE: Imports dependency for this module.
009320| src/components/SaveSearchButton.tsx:10: 
009321| NOTE: Blank line for visual separation.
009322| src/components/SaveSearchButton.tsx:11: interface SaveSearchButtonProps {
009323| NOTE: Type declaration for search data contracts.
009324| src/components/SaveSearchButton.tsx:12:   className?: string;
009325| NOTE: Implementation detail supporting search page behavior.
009326| src/components/SaveSearchButton.tsx:13: }
009327| NOTE: Implementation detail supporting search page behavior.
009328| src/components/SaveSearchButton.tsx:14: 
009329| NOTE: Blank line for visual separation.
009330| src/components/SaveSearchButton.tsx:15: type AlertFrequency = "INSTANT" | "DAILY" | "WEEKLY";
009331| NOTE: Type declaration for search data contracts.
009332| src/components/SaveSearchButton.tsx:16: 
009333| NOTE: Blank line for visual separation.
009334| src/components/SaveSearchButton.tsx:17: export default function SaveSearchButton({
009335| NOTE: Exports main component for this module.
009336| src/components/SaveSearchButton.tsx:18:   className = "",
009337| NOTE: Implementation detail supporting search page behavior.
009338| src/components/SaveSearchButton.tsx:19: }: SaveSearchButtonProps) {
009339| NOTE: Implementation detail supporting search page behavior.
009340| src/components/SaveSearchButton.tsx:20:   const [isOpen, setIsOpen] = useState(false);
009341| NOTE: Initializes local state for search UI behavior.
009342| src/components/SaveSearchButton.tsx:21:   const [name, setName] = useState("");
009343| NOTE: Initializes local state for search UI behavior.
009344| src/components/SaveSearchButton.tsx:22:   const [alertEnabled, setAlertEnabled] = useState(true);
009345| NOTE: Initializes local state for search UI behavior.
009346| src/components/SaveSearchButton.tsx:23:   const [alertFrequency, setAlertFrequency] = useState<AlertFrequency>("DAILY");
009347| NOTE: Initializes local state for search UI behavior.
009348| src/components/SaveSearchButton.tsx:24:   const [isLoading, setIsLoading] = useState(false);
009349| NOTE: Initializes local state for search UI behavior.
009350| src/components/SaveSearchButton.tsx:25:   const [error, setError] = useState<string | null>(null);
009351| NOTE: Initializes local state for search UI behavior.
009352| src/components/SaveSearchButton.tsx:26:   const searchParams = useSearchParams();
009353| NOTE: Local declaration used by search logic or UI.
009354| src/components/SaveSearchButton.tsx:27: 
009355| NOTE: Blank line for visual separation.
009356| src/components/SaveSearchButton.tsx:28:   // Get current filters from URL using centralized validation
009357| NOTE: Line comment documents intent or constraints.
009358| src/components/SaveSearchButton.tsx:29:   const getCurrentFilters = (): SearchFilters => {
009359| NOTE: Local declaration used by search logic or UI.
009360| src/components/SaveSearchButton.tsx:30:     // Build RawSearchParams from URL
009361| NOTE: Line comment documents intent or constraints.
009362| src/components/SaveSearchButton.tsx:31:     const raw: RawSearchParams = {
009363| NOTE: Local declaration used by search logic or UI.
009364| src/components/SaveSearchButton.tsx:32:       q: searchParams.get("q") ?? undefined,
009365| NOTE: Implementation detail supporting search page behavior.
009366| src/components/SaveSearchButton.tsx:33:       minPrice: searchParams.get("minPrice") ?? undefined,
009367| NOTE: Implementation detail supporting search page behavior.
009368| src/components/SaveSearchButton.tsx:34:       maxPrice: searchParams.get("maxPrice") ?? undefined,
009369| NOTE: Implementation detail supporting search page behavior.
009370| src/components/SaveSearchButton.tsx:35:       amenities: searchParams.getAll("amenities"),
009371| NOTE: Implementation detail supporting search page behavior.
009372| src/components/SaveSearchButton.tsx:36:       moveInDate: searchParams.get("moveInDate") ?? undefined,
009373| NOTE: Implementation detail supporting search page behavior.
009374| src/components/SaveSearchButton.tsx:37:       leaseDuration: searchParams.get("leaseDuration") ?? undefined,
009375| NOTE: Implementation detail supporting search page behavior.
009376| src/components/SaveSearchButton.tsx:38:       houseRules: searchParams.getAll("houseRules"),
009377| NOTE: Implementation detail supporting search page behavior.
009378| src/components/SaveSearchButton.tsx:39:       roomType: searchParams.get("roomType") ?? undefined,
009379| NOTE: Implementation detail supporting search page behavior.
009380| src/components/SaveSearchButton.tsx:40:       languages: searchParams.getAll("languages"),
009381| NOTE: Implementation detail supporting search page behavior.
009382| src/components/SaveSearchButton.tsx:41:       lat: searchParams.get("lat") ?? undefined,
009383| NOTE: Implementation detail supporting search page behavior.
009384| src/components/SaveSearchButton.tsx:42:       lng: searchParams.get("lng") ?? undefined,
009385| NOTE: Implementation detail supporting search page behavior.
009386| src/components/SaveSearchButton.tsx:43:       minLat: searchParams.get("minLat") ?? undefined,
009387| NOTE: Implementation detail supporting search page behavior.
009388| src/components/SaveSearchButton.tsx:44:       maxLat: searchParams.get("maxLat") ?? undefined,
009389| NOTE: Implementation detail supporting search page behavior.
009390| src/components/SaveSearchButton.tsx:45:       minLng: searchParams.get("minLng") ?? undefined,
009391| NOTE: Implementation detail supporting search page behavior.
009392| src/components/SaveSearchButton.tsx:46:       maxLng: searchParams.get("maxLng") ?? undefined,
009393| NOTE: Implementation detail supporting search page behavior.
009394| src/components/SaveSearchButton.tsx:47:       sort: searchParams.get("sort") ?? undefined,
009395| NOTE: Implementation detail supporting search page behavior.
009396| src/components/SaveSearchButton.tsx:48:     };
009397| NOTE: Implementation detail supporting search page behavior.
009398| src/components/SaveSearchButton.tsx:49: 
009399| NOTE: Blank line for visual separation.
009400| src/components/SaveSearchButton.tsx:50:     // Use centralized parser for validation (MAX_SAFE_PRICE, date validation, allowlists, etc.)
009401| NOTE: Line comment documents intent or constraints.
009402| src/components/SaveSearchButton.tsx:51:     const parsed = parseSearchParams(raw);
009403| NOTE: Local declaration used by search logic or UI.
009404| src/components/SaveSearchButton.tsx:52:     const fp = parsed.filterParams;
009405| NOTE: Local declaration used by search logic or UI.
009406| src/components/SaveSearchButton.tsx:53: 
009407| NOTE: Blank line for visual separation.
009408| src/components/SaveSearchButton.tsx:54:     // Convert FilterParams to SearchFilters format
009409| NOTE: Line comment documents intent or constraints.
009410| src/components/SaveSearchButton.tsx:55:     const filters: SearchFilters = {};
009411| NOTE: Local declaration used by search logic or UI.
009412| src/components/SaveSearchButton.tsx:56:     if (fp.query) filters.query = fp.query;
009413| NOTE: Conditional logic controlling rendering or flow.
009414| src/components/SaveSearchButton.tsx:57:     if (fp.minPrice !== undefined) filters.minPrice = fp.minPrice;
009415| NOTE: Conditional logic controlling rendering or flow.
009416| src/components/SaveSearchButton.tsx:58:     if (fp.maxPrice !== undefined) filters.maxPrice = fp.maxPrice;
009417| NOTE: Conditional logic controlling rendering or flow.
009418| src/components/SaveSearchButton.tsx:59:     if (fp.amenities) filters.amenities = fp.amenities;
009419| NOTE: Conditional logic controlling rendering or flow.
009420| src/components/SaveSearchButton.tsx:60:     if (fp.moveInDate) filters.moveInDate = fp.moveInDate;
009421| NOTE: Conditional logic controlling rendering or flow.
009422| src/components/SaveSearchButton.tsx:61:     if (fp.leaseDuration) filters.leaseDuration = fp.leaseDuration;
009423| NOTE: Conditional logic controlling rendering or flow.
009424| src/components/SaveSearchButton.tsx:62:     if (fp.houseRules) filters.houseRules = fp.houseRules;
009425| NOTE: Conditional logic controlling rendering or flow.
009426| src/components/SaveSearchButton.tsx:63:     if (fp.roomType) filters.roomType = fp.roomType;
009427| NOTE: Conditional logic controlling rendering or flow.
009428| src/components/SaveSearchButton.tsx:64:     if (fp.languages) filters.languages = fp.languages;
009429| NOTE: Conditional logic controlling rendering or flow.
009430| src/components/SaveSearchButton.tsx:65:     if (fp.sort) filters.sort = fp.sort;
009431| NOTE: Conditional logic controlling rendering or flow.
009432| src/components/SaveSearchButton.tsx:66:     // Convert bounds back to flat coordinate fields for SearchFilters
009433| NOTE: Line comment documents intent or constraints.
009434| src/components/SaveSearchButton.tsx:67:     if (fp.bounds) {
009435| NOTE: Conditional logic controlling rendering or flow.
009436| src/components/SaveSearchButton.tsx:68:       filters.minLat = fp.bounds.minLat;
009437| NOTE: Implementation detail supporting search page behavior.
009438| src/components/SaveSearchButton.tsx:69:       filters.maxLat = fp.bounds.maxLat;
009439| NOTE: Implementation detail supporting search page behavior.
009440| src/components/SaveSearchButton.tsx:70:       filters.minLng = fp.bounds.minLng;
009441| NOTE: Implementation detail supporting search page behavior.
009442| src/components/SaveSearchButton.tsx:71:       filters.maxLng = fp.bounds.maxLng;
009443| NOTE: Implementation detail supporting search page behavior.
009444| src/components/SaveSearchButton.tsx:72:     }
009445| NOTE: Implementation detail supporting search page behavior.
009446| src/components/SaveSearchButton.tsx:73: 
009447| NOTE: Blank line for visual separation.
009448| src/components/SaveSearchButton.tsx:74:     return filters;
009449| NOTE: Return statement for component or helper output.
009450| src/components/SaveSearchButton.tsx:75:   };
009451| NOTE: Implementation detail supporting search page behavior.
009452| src/components/SaveSearchButton.tsx:76: 
009453| NOTE: Blank line for visual separation.
009454| src/components/SaveSearchButton.tsx:77:   // Generate a default name based on filters
009455| NOTE: Line comment documents intent or constraints.
009456| src/components/SaveSearchButton.tsx:78:   const generateDefaultName = (): string => {
009457| NOTE: Local declaration used by search logic or UI.
009458| src/components/SaveSearchButton.tsx:79:     const filters = getCurrentFilters();
009459| NOTE: Local declaration used by search logic or UI.
009460| src/components/SaveSearchButton.tsx:80:     const parts: string[] = [];
009461| NOTE: Local declaration used by search logic or UI.
009462| src/components/SaveSearchButton.tsx:81: 
009463| NOTE: Blank line for visual separation.
009464| src/components/SaveSearchButton.tsx:82:     if (filters.query) parts.push(filters.query);
009465| NOTE: Conditional logic controlling rendering or flow.
009466| src/components/SaveSearchButton.tsx:83:     if (filters.roomType) parts.push(filters.roomType.replace("_", " "));
009467| NOTE: Conditional logic controlling rendering or flow.
009468| src/components/SaveSearchButton.tsx:84:     if (filters.minPrice !== undefined || filters.maxPrice !== undefined) {
009469| NOTE: Conditional logic controlling rendering or flow.
009470| src/components/SaveSearchButton.tsx:85:       const priceRange = [
009471| NOTE: Local declaration used by search logic or UI.
009472| src/components/SaveSearchButton.tsx:86:         filters.minPrice !== undefined ? `$${filters.minPrice}` : "",
009473| NOTE: Implementation detail supporting search page behavior.
009474| src/components/SaveSearchButton.tsx:87:         filters.maxPrice !== undefined ? `$${filters.maxPrice}` : "",
009475| NOTE: Implementation detail supporting search page behavior.
009476| src/components/SaveSearchButton.tsx:88:       ]
009477| NOTE: Implementation detail supporting search page behavior.
009478| src/components/SaveSearchButton.tsx:89:         .filter(Boolean)
009479| NOTE: Implementation detail supporting search page behavior.
009480| src/components/SaveSearchButton.tsx:90:         .join("-");
009481| NOTE: Implementation detail supporting search page behavior.
009482| src/components/SaveSearchButton.tsx:91:       if (priceRange) parts.push(priceRange);
009483| NOTE: Conditional logic controlling rendering or flow.
009484| src/components/SaveSearchButton.tsx:92:     }
009485| NOTE: Implementation detail supporting search page behavior.
009486| src/components/SaveSearchButton.tsx:93: 
009487| NOTE: Blank line for visual separation.
009488| src/components/SaveSearchButton.tsx:94:     return parts.length > 0 ? parts.join(" - ") : "My Search";
009489| NOTE: Return statement for component or helper output.
009490| src/components/SaveSearchButton.tsx:95:   };
009491| NOTE: Implementation detail supporting search page behavior.
009492| src/components/SaveSearchButton.tsx:96: 
009493| NOTE: Blank line for visual separation.
009494| src/components/SaveSearchButton.tsx:97:   const handleOpen = () => {
009495| NOTE: Local declaration used by search logic or UI.
009496| src/components/SaveSearchButton.tsx:98:     setName(generateDefaultName());
009497| NOTE: Implementation detail supporting search page behavior.
009498| src/components/SaveSearchButton.tsx:99:     setError(null);
009499| NOTE: Implementation detail supporting search page behavior.
009500| src/components/SaveSearchButton.tsx:100:     setIsOpen(true);
009501| NOTE: Implementation detail supporting search page behavior.
009502| src/components/SaveSearchButton.tsx:101:   };
009503| NOTE: Implementation detail supporting search page behavior.
009504| src/components/SaveSearchButton.tsx:102: 
009505| NOTE: Blank line for visual separation.
009506| src/components/SaveSearchButton.tsx:103:   const handleSave = async () => {
009507| NOTE: Local declaration used by search logic or UI.
009508| src/components/SaveSearchButton.tsx:104:     if (!name.trim()) {
009509| NOTE: Conditional logic controlling rendering or flow.
009510| src/components/SaveSearchButton.tsx:105:       setError("Please enter a name for this search");
009511| NOTE: Implementation detail supporting search page behavior.
009512| src/components/SaveSearchButton.tsx:106:       return;
009513| NOTE: Implementation detail supporting search page behavior.
009514| src/components/SaveSearchButton.tsx:107:     }
009515| NOTE: Implementation detail supporting search page behavior.
009516| src/components/SaveSearchButton.tsx:108: 
009517| NOTE: Blank line for visual separation.
009518| src/components/SaveSearchButton.tsx:109:     setIsLoading(true);
009519| NOTE: Implementation detail supporting search page behavior.
009520| src/components/SaveSearchButton.tsx:110:     setError(null);
009521| NOTE: Implementation detail supporting search page behavior.
009522| src/components/SaveSearchButton.tsx:111: 
009523| NOTE: Blank line for visual separation.
009524| src/components/SaveSearchButton.tsx:112:     try {
009525| NOTE: Implementation detail supporting search page behavior.
009526| src/components/SaveSearchButton.tsx:113:       const result = await saveSearch({
009527| NOTE: Local declaration used by search logic or UI.
009528| src/components/SaveSearchButton.tsx:114:         name: name.trim(),
009529| NOTE: Implementation detail supporting search page behavior.
009530| src/components/SaveSearchButton.tsx:115:         filters: getCurrentFilters(),
009531| NOTE: Implementation detail supporting search page behavior.
009532| src/components/SaveSearchButton.tsx:116:         alertEnabled,
009533| NOTE: Implementation detail supporting search page behavior.
009534| src/components/SaveSearchButton.tsx:117:         alertFrequency,
009535| NOTE: Implementation detail supporting search page behavior.
009536| src/components/SaveSearchButton.tsx:118:       });
009537| NOTE: Implementation detail supporting search page behavior.
009538| src/components/SaveSearchButton.tsx:119: 
009539| NOTE: Blank line for visual separation.
009540| src/components/SaveSearchButton.tsx:120:       if (result.error) {
009541| NOTE: Conditional logic controlling rendering or flow.
009542| src/components/SaveSearchButton.tsx:121:         setError(result.error);
009543| NOTE: Implementation detail supporting search page behavior.
009544| src/components/SaveSearchButton.tsx:122:       } else {
009545| NOTE: Implementation detail supporting search page behavior.
009546| src/components/SaveSearchButton.tsx:123:         setIsOpen(false);
009547| NOTE: Implementation detail supporting search page behavior.
009548| src/components/SaveSearchButton.tsx:124:         toast.success("Search saved successfully!");
009549| NOTE: Implementation detail supporting search page behavior.
009550| src/components/SaveSearchButton.tsx:125:       }
009551| NOTE: Implementation detail supporting search page behavior.
009552| src/components/SaveSearchButton.tsx:126:     } catch (err) {
009553| NOTE: Implementation detail supporting search page behavior.
009554| src/components/SaveSearchButton.tsx:127:       setError("Something went wrong");
009555| NOTE: Implementation detail supporting search page behavior.
009556| src/components/SaveSearchButton.tsx:128:     } finally {
009557| NOTE: Implementation detail supporting search page behavior.
009558| src/components/SaveSearchButton.tsx:129:       setIsLoading(false);
009559| NOTE: Implementation detail supporting search page behavior.
009560| src/components/SaveSearchButton.tsx:130:     }
009561| NOTE: Implementation detail supporting search page behavior.
009562| src/components/SaveSearchButton.tsx:131:   };
009563| NOTE: Implementation detail supporting search page behavior.
009564| src/components/SaveSearchButton.tsx:132: 
009565| NOTE: Blank line for visual separation.
009566| src/components/SaveSearchButton.tsx:133:   return (
009567| NOTE: Return statement for component or helper output.
009568| src/components/SaveSearchButton.tsx:134:     <>
009569| NOTE: JSX markup for search UI.
009570| src/components/SaveSearchButton.tsx:135:       <button
009571| NOTE: JSX markup for search UI.
009572| src/components/SaveSearchButton.tsx:136:         onClick={handleOpen}
009573| NOTE: Implementation detail supporting search page behavior.
009574| src/components/SaveSearchButton.tsx:137:         className={`inline-flex items-center gap-2 text-sm font-medium text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors whitespace-nowrap ${className}`}
009575| NOTE: Tailwind classes define layout and styling.
009576| src/components/SaveSearchButton.tsx:138:       >
009577| NOTE: Implementation detail supporting search page behavior.
009578| src/components/SaveSearchButton.tsx:139:         <Bookmark className="w-4 h-4" />
009579| NOTE: Tailwind classes define layout and styling.
009580| src/components/SaveSearchButton.tsx:140:         <span className="hidden sm:inline">Save Search</span>
009581| NOTE: Tailwind classes define layout and styling.
009582| src/components/SaveSearchButton.tsx:141:       </button>
009583| NOTE: JSX markup for search UI.
009584| src/components/SaveSearchButton.tsx:142: 
009585| NOTE: Blank line for visual separation.
009586| src/components/SaveSearchButton.tsx:143:       {/* Modal */}
009587| NOTE: Implementation detail supporting search page behavior.
009588| src/components/SaveSearchButton.tsx:144:       {isOpen && (
009589| NOTE: Implementation detail supporting search page behavior.
009590| src/components/SaveSearchButton.tsx:145:         <div className="fixed inset-0 z-[1000] flex items-center justify-center p-4">
009591| NOTE: Tailwind classes define layout and styling.
009592| src/components/SaveSearchButton.tsx:146:           {/* Backdrop */}
009593| NOTE: Implementation detail supporting search page behavior.
009594| src/components/SaveSearchButton.tsx:147:           <div
009595| NOTE: JSX markup for search UI.
009596| src/components/SaveSearchButton.tsx:148:             className="absolute inset-0 bg-black/50"
009597| NOTE: Tailwind classes define layout and styling.
009598| src/components/SaveSearchButton.tsx:149:             onClick={() => setIsOpen(false)}
009599| NOTE: Implementation detail supporting search page behavior.
009600| src/components/SaveSearchButton.tsx:150:           />
009601| NOTE: Implementation detail supporting search page behavior.
009602| src/components/SaveSearchButton.tsx:151: 
009603| NOTE: Blank line for visual separation.
009604| src/components/SaveSearchButton.tsx:152:           {/* Modal Content */}
009605| NOTE: Implementation detail supporting search page behavior.
009606| src/components/SaveSearchButton.tsx:153:           <div className="relative bg-white rounded-2xl shadow-xl max-w-md w-full p-6">
009607| NOTE: Tailwind classes define layout and styling.
009608| src/components/SaveSearchButton.tsx:154:             <button
009609| NOTE: JSX markup for search UI.
009610| src/components/SaveSearchButton.tsx:155:               onClick={() => setIsOpen(false)}
009611| NOTE: Implementation detail supporting search page behavior.
009612| src/components/SaveSearchButton.tsx:156:               className="absolute top-4 right-4 p-1 text-zinc-400 hover:text-zinc-600"
009613| NOTE: Tailwind classes define layout and styling.
009614| src/components/SaveSearchButton.tsx:157:             >
009615| NOTE: Implementation detail supporting search page behavior.
009616| src/components/SaveSearchButton.tsx:158:               <X className="w-5 h-5" />
009617| NOTE: Tailwind classes define layout and styling.
009618| src/components/SaveSearchButton.tsx:159:             </button>
009619| NOTE: JSX markup for search UI.
009620| src/components/SaveSearchButton.tsx:160: 
009621| NOTE: Blank line for visual separation.
009622| src/components/SaveSearchButton.tsx:161:             <h2 className="text-xl font-bold text-zinc-900 mb-4">
009623| NOTE: Tailwind classes define layout and styling.
009624| src/components/SaveSearchButton.tsx:162:               Save This Search
009625| NOTE: Implementation detail supporting search page behavior.
009626| src/components/SaveSearchButton.tsx:163:             </h2>
009627| NOTE: JSX markup for search UI.
009628| src/components/SaveSearchButton.tsx:164: 
009629| NOTE: Blank line for visual separation.
009630| src/components/SaveSearchButton.tsx:165:             <div className="space-y-4">
009631| NOTE: Tailwind classes define layout and styling.
009632| src/components/SaveSearchButton.tsx:166:               {/* Search Name */}
009633| NOTE: Implementation detail supporting search page behavior.
009634| src/components/SaveSearchButton.tsx:167:               <div>
009635| NOTE: JSX markup for search UI.
009636| src/components/SaveSearchButton.tsx:168:                 <label className="block text-sm font-medium text-zinc-700 mb-1">
009637| NOTE: Tailwind classes define layout and styling.
009638| src/components/SaveSearchButton.tsx:169:                   Search Name
009639| NOTE: Implementation detail supporting search page behavior.
009640| src/components/SaveSearchButton.tsx:170:                 </label>
009641| NOTE: JSX markup for search UI.
009642| src/components/SaveSearchButton.tsx:171:                 <input
009643| NOTE: JSX markup for search UI.
009644| src/components/SaveSearchButton.tsx:172:                   type="text"
009645| NOTE: Implementation detail supporting search page behavior.
009646| src/components/SaveSearchButton.tsx:173:                   value={name}
009647| NOTE: Implementation detail supporting search page behavior.
009648| src/components/SaveSearchButton.tsx:174:                   onChange={(e) => setName(e.target.value)}
009649| NOTE: Implementation detail supporting search page behavior.
009650| src/components/SaveSearchButton.tsx:175:                   placeholder="e.g., Downtown apartments under $1500"
009651| NOTE: Implementation detail supporting search page behavior.
009652| src/components/SaveSearchButton.tsx:176:                   className="w-full px-4 py-2.5 border border-zinc-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-zinc-900/10"
009653| NOTE: Tailwind classes define layout and styling.
009654| src/components/SaveSearchButton.tsx:177:                 />
009655| NOTE: Implementation detail supporting search page behavior.
009656| src/components/SaveSearchButton.tsx:178:               </div>
009657| NOTE: JSX markup for search UI.
009658| src/components/SaveSearchButton.tsx:179: 
009659| NOTE: Blank line for visual separation.
009660| src/components/SaveSearchButton.tsx:180:               {/* Alert Toggle */}
009661| NOTE: Implementation detail supporting search page behavior.
009662| src/components/SaveSearchButton.tsx:181:               <div className="p-4 bg-zinc-50 rounded-xl space-y-4">
009663| NOTE: Tailwind classes define layout and styling.
009664| src/components/SaveSearchButton.tsx:182:                 <div className="flex items-center justify-between">
009665| NOTE: Tailwind classes define layout and styling.
009666| src/components/SaveSearchButton.tsx:183:                   <div className="flex items-center gap-3">
009667| NOTE: Tailwind classes define layout and styling.
009668| src/components/SaveSearchButton.tsx:184:                     {alertEnabled ? (
009669| NOTE: Implementation detail supporting search page behavior.
009670| src/components/SaveSearchButton.tsx:185:                       <Bell className="w-5 h-5 text-zinc-600" />
009671| NOTE: Tailwind classes define layout and styling.
009672| src/components/SaveSearchButton.tsx:186:                     ) : (
009673| NOTE: Implementation detail supporting search page behavior.
009674| src/components/SaveSearchButton.tsx:187:                       <BellOff className="w-5 h-5 text-zinc-400" />
009675| NOTE: Tailwind classes define layout and styling.
009676| src/components/SaveSearchButton.tsx:188:                     )}
009677| NOTE: Implementation detail supporting search page behavior.
009678| src/components/SaveSearchButton.tsx:189:                     <div>
009679| NOTE: JSX markup for search UI.
009680| src/components/SaveSearchButton.tsx:190:                       <p className="font-medium text-zinc-900">Email Alerts</p>
009681| NOTE: Tailwind classes define layout and styling.
009682| src/components/SaveSearchButton.tsx:191:                       <p className="text-xs text-zinc-500">
009683| NOTE: Tailwind classes define layout and styling.
009684| src/components/SaveSearchButton.tsx:192:                         Get notified when new listings match
009685| NOTE: Implementation detail supporting search page behavior.
009686| src/components/SaveSearchButton.tsx:193:                       </p>
009687| NOTE: JSX markup for search UI.
009688| src/components/SaveSearchButton.tsx:194:                     </div>
009689| NOTE: JSX markup for search UI.
009690| src/components/SaveSearchButton.tsx:195:                   </div>
009691| NOTE: JSX markup for search UI.
009692| src/components/SaveSearchButton.tsx:196:                   <button
009693| NOTE: JSX markup for search UI.
009694| src/components/SaveSearchButton.tsx:197:                     type="button"
009695| NOTE: Implementation detail supporting search page behavior.
009696| src/components/SaveSearchButton.tsx:198:                     onClick={() => setAlertEnabled(!alertEnabled)}
009697| NOTE: Implementation detail supporting search page behavior.
009698| src/components/SaveSearchButton.tsx:199:                     className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
009699| NOTE: Tailwind classes define layout and styling.
009700| src/components/SaveSearchButton.tsx:200:                       alertEnabled ? "bg-zinc-900" : "bg-zinc-200"
009701| NOTE: Implementation detail supporting search page behavior.
009702| src/components/SaveSearchButton.tsx:201:                     }`}
009703| NOTE: Implementation detail supporting search page behavior.
009704| src/components/SaveSearchButton.tsx:202:                   >
009705| NOTE: Implementation detail supporting search page behavior.
009706| src/components/SaveSearchButton.tsx:203:                     <span
009707| NOTE: JSX markup for search UI.
009708| src/components/SaveSearchButton.tsx:204:                       className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
009709| NOTE: Tailwind classes define layout and styling.
009710| src/components/SaveSearchButton.tsx:205:                         alertEnabled ? "translate-x-6" : "translate-x-1"
009711| NOTE: Implementation detail supporting search page behavior.
009712| src/components/SaveSearchButton.tsx:206:                       }`}
009713| NOTE: Implementation detail supporting search page behavior.
009714| src/components/SaveSearchButton.tsx:207:                     />
009715| NOTE: Implementation detail supporting search page behavior.
009716| src/components/SaveSearchButton.tsx:208:                   </button>
009717| NOTE: JSX markup for search UI.
009718| src/components/SaveSearchButton.tsx:209:                 </div>
009719| NOTE: JSX markup for search UI.
009720| src/components/SaveSearchButton.tsx:210: 
009721| NOTE: Blank line for visual separation.
009722| src/components/SaveSearchButton.tsx:211:                 {/* Alert Frequency */}
009723| NOTE: Implementation detail supporting search page behavior.
009724| src/components/SaveSearchButton.tsx:212:                 {alertEnabled && (
009725| NOTE: Implementation detail supporting search page behavior.
009726| src/components/SaveSearchButton.tsx:213:                   <div className="pt-3 border-t border-zinc-200">
009727| NOTE: Tailwind classes define layout and styling.
009728| src/components/SaveSearchButton.tsx:214:                     <label className="block text-sm font-medium text-zinc-700 mb-2">
009729| NOTE: Tailwind classes define layout and styling.
009730| src/components/SaveSearchButton.tsx:215:                       Alert Frequency
009731| NOTE: Implementation detail supporting search page behavior.
009732| src/components/SaveSearchButton.tsx:216:                     </label>
009733| NOTE: JSX markup for search UI.
009734| src/components/SaveSearchButton.tsx:217:                     <div className="flex gap-2">
009735| NOTE: Tailwind classes define layout and styling.
009736| src/components/SaveSearchButton.tsx:218:                       {(["INSTANT", "DAILY", "WEEKLY"] as const).map((freq) => (
009737| NOTE: Implementation detail supporting search page behavior.
009738| src/components/SaveSearchButton.tsx:219:                         <button
009739| NOTE: JSX markup for search UI.
009740| src/components/SaveSearchButton.tsx:220:                           key={freq}
009741| NOTE: Implementation detail supporting search page behavior.
009742| src/components/SaveSearchButton.tsx:221:                           type="button"
009743| NOTE: Implementation detail supporting search page behavior.
009744| src/components/SaveSearchButton.tsx:222:                           onClick={() => setAlertFrequency(freq)}
009745| NOTE: Implementation detail supporting search page behavior.
009746| src/components/SaveSearchButton.tsx:223:                           className={`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
009747| NOTE: Tailwind classes define layout and styling.
009748| src/components/SaveSearchButton.tsx:224:                             alertFrequency === freq
009749| NOTE: Implementation detail supporting search page behavior.
009750| src/components/SaveSearchButton.tsx:225:                               ? "bg-zinc-900 text-white"
009751| NOTE: Implementation detail supporting search page behavior.
009752| src/components/SaveSearchButton.tsx:226:                               : "bg-white border border-zinc-200 text-zinc-600 hover:bg-zinc-100"
009753| NOTE: Implementation detail supporting search page behavior.
009754| src/components/SaveSearchButton.tsx:227:                           }`}
009755| NOTE: Implementation detail supporting search page behavior.
009756| src/components/SaveSearchButton.tsx:228:                         >
009757| NOTE: Implementation detail supporting search page behavior.
009758| src/components/SaveSearchButton.tsx:229:                           {freq === "INSTANT"
009759| NOTE: Implementation detail supporting search page behavior.
009760| src/components/SaveSearchButton.tsx:230:                             ? "Instant"
009761| NOTE: Implementation detail supporting search page behavior.
009762| src/components/SaveSearchButton.tsx:231:                             : freq === "DAILY"
009763| NOTE: Implementation detail supporting search page behavior.
009764| src/components/SaveSearchButton.tsx:232:                               ? "Daily"
009765| NOTE: Implementation detail supporting search page behavior.
009766| src/components/SaveSearchButton.tsx:233:                               : "Weekly"}
009767| NOTE: Implementation detail supporting search page behavior.
009768| src/components/SaveSearchButton.tsx:234:                         </button>
009769| NOTE: JSX markup for search UI.
009770| src/components/SaveSearchButton.tsx:235:                       ))}
009771| NOTE: Implementation detail supporting search page behavior.
009772| src/components/SaveSearchButton.tsx:236:                     </div>
009773| NOTE: JSX markup for search UI.
009774| src/components/SaveSearchButton.tsx:237:                     {alertFrequency === "INSTANT" && (
009775| NOTE: Implementation detail supporting search page behavior.
009776| src/components/SaveSearchButton.tsx:238:                       <p className="mt-2 text-xs text-zinc-500">
009777| NOTE: Tailwind classes define layout and styling.
009778| src/components/SaveSearchButton.tsx:239:                         Get notified immediately when a new listing matches your
009779| NOTE: Implementation detail supporting search page behavior.
009780| src/components/SaveSearchButton.tsx:240:                         search
009781| NOTE: Implementation detail supporting search page behavior.
009782| src/components/SaveSearchButton.tsx:241:                       </p>
009783| NOTE: JSX markup for search UI.
009784| src/components/SaveSearchButton.tsx:242:                     )}
009785| NOTE: Implementation detail supporting search page behavior.
009786| src/components/SaveSearchButton.tsx:243:                   </div>
009787| NOTE: JSX markup for search UI.
009788| src/components/SaveSearchButton.tsx:244:                 )}
009789| NOTE: Implementation detail supporting search page behavior.
009790| src/components/SaveSearchButton.tsx:245:               </div>
009791| NOTE: JSX markup for search UI.
009792| src/components/SaveSearchButton.tsx:246: 
009793| NOTE: Blank line for visual separation.
009794| src/components/SaveSearchButton.tsx:247:               {/* Error */}
009795| NOTE: Implementation detail supporting search page behavior.
009796| src/components/SaveSearchButton.tsx:248:               {error && <p className="text-sm text-red-600">{error}</p>}
009797| NOTE: Tailwind classes define layout and styling.
009798| src/components/SaveSearchButton.tsx:249: 
009799| NOTE: Blank line for visual separation.
009800| src/components/SaveSearchButton.tsx:250:               {/* Actions */}
009801| NOTE: Implementation detail supporting search page behavior.
009802| src/components/SaveSearchButton.tsx:251:               <div className="flex gap-3 pt-2">
009803| NOTE: Tailwind classes define layout and styling.
009804| src/components/SaveSearchButton.tsx:252:                 <button
009805| NOTE: JSX markup for search UI.
009806| src/components/SaveSearchButton.tsx:253:                   onClick={() => setIsOpen(false)}
009807| NOTE: Implementation detail supporting search page behavior.
009808| src/components/SaveSearchButton.tsx:254:                   className="flex-1 px-4 py-2.5 border border-zinc-200 rounded-lg font-medium text-zinc-700 hover:bg-zinc-50 transition-colors"
009809| NOTE: Tailwind classes define layout and styling.
009810| src/components/SaveSearchButton.tsx:255:                 >
009811| NOTE: Implementation detail supporting search page behavior.
009812| src/components/SaveSearchButton.tsx:256:                   Cancel
009813| NOTE: Implementation detail supporting search page behavior.
009814| src/components/SaveSearchButton.tsx:257:                 </button>
009815| NOTE: JSX markup for search UI.
009816| src/components/SaveSearchButton.tsx:258:                 <button
009817| NOTE: JSX markup for search UI.
009818| src/components/SaveSearchButton.tsx:259:                   onClick={handleSave}
009819| NOTE: Implementation detail supporting search page behavior.
009820| src/components/SaveSearchButton.tsx:260:                   disabled={isLoading}
009821| NOTE: Implementation detail supporting search page behavior.
009822| src/components/SaveSearchButton.tsx:261:                   data-testid="confirm-save-search"
009823| NOTE: Implementation detail supporting search page behavior.
009824| src/components/SaveSearchButton.tsx:262:                   className="flex-1 px-4 py-2.5 bg-zinc-900 text-white rounded-lg font-medium hover:bg-zinc-800 disabled:opacity-50 transition-colors flex items-center justify-center gap-2"
009825| NOTE: Tailwind classes define layout and styling.
009826| src/components/SaveSearchButton.tsx:263:                 >
009827| NOTE: Implementation detail supporting search page behavior.
009828| src/components/SaveSearchButton.tsx:264:                   {isLoading ? (
009829| NOTE: Implementation detail supporting search page behavior.
009830| src/components/SaveSearchButton.tsx:265:                     <>
009831| NOTE: JSX markup for search UI.
009832| src/components/SaveSearchButton.tsx:266:                       <Loader2 className="w-4 h-4 animate-spin" />
009833| NOTE: Tailwind classes define layout and styling.
009834| src/components/SaveSearchButton.tsx:267:                       Saving...
009835| NOTE: Implementation detail supporting search page behavior.
009836| src/components/SaveSearchButton.tsx:268:                     </>
009837| NOTE: JSX markup for search UI.
009838| src/components/SaveSearchButton.tsx:269:                   ) : (
009839| NOTE: Implementation detail supporting search page behavior.
009840| src/components/SaveSearchButton.tsx:270:                     "Save Search"
009841| NOTE: Implementation detail supporting search page behavior.
009842| src/components/SaveSearchButton.tsx:271:                   )}
009843| NOTE: Implementation detail supporting search page behavior.
009844| src/components/SaveSearchButton.tsx:272:                 </button>
009845| NOTE: JSX markup for search UI.
009846| src/components/SaveSearchButton.tsx:273:               </div>
009847| NOTE: JSX markup for search UI.
009848| src/components/SaveSearchButton.tsx:274:             </div>
009849| NOTE: JSX markup for search UI.
009850| src/components/SaveSearchButton.tsx:275:           </div>
009851| NOTE: JSX markup for search UI.
009852| src/components/SaveSearchButton.tsx:276:         </div>
009853| NOTE: JSX markup for search UI.
009854| src/components/SaveSearchButton.tsx:277:       )}
009855| NOTE: Implementation detail supporting search page behavior.
009856| src/components/SaveSearchButton.tsx:278:     </>
009857| NOTE: JSX markup for search UI.
009858| src/components/SaveSearchButton.tsx:279:   );
009859| NOTE: Implementation detail supporting search page behavior.
009860| src/components/SaveSearchButton.tsx:280: }
009861| NOTE: Implementation detail supporting search page behavior.
009862| FILE END: src/components/SaveSearchButton.tsx
009863| 
009864| FILE START: src/components/SearchErrorBanner.tsx
009865| FILE ROLE: Auto-discovered dependency in search page graph.
009866| src/components/SearchErrorBanner.tsx:1: "use client";
009867| NOTE: Implementation detail supporting search page behavior.
009868| src/components/SearchErrorBanner.tsx:2: 
009869| NOTE: Blank line for visual separation.
009870| src/components/SearchErrorBanner.tsx:3: /**
009871| NOTE: Block comment line describing behavior or context.
009872| src/components/SearchErrorBanner.tsx:4:  * SearchErrorBanner - Non-blocking error banner for search results
009873| NOTE: Block comment line describing behavior or context.
009874| src/components/SearchErrorBanner.tsx:5:  *
009875| NOTE: Block comment line describing behavior or context.
009876| src/components/SearchErrorBanner.tsx:6:  * Based on MapErrorBanner pattern from PersistentMapWrapper.
009877| NOTE: Block comment line describing behavior or context.
009878| src/components/SearchErrorBanner.tsx:7:  * Shows an inline error with retry button, keeping previous results visible.
009879| NOTE: Block comment line describing behavior or context.
009880| src/components/SearchErrorBanner.tsx:8:  * Uses router.refresh() for soft reload that re-runs server components.
009881| NOTE: Block comment line describing behavior or context.
009882| src/components/SearchErrorBanner.tsx:9:  */
009883| NOTE: Block comment line describing behavior or context.
009884| src/components/SearchErrorBanner.tsx:10: 
009885| NOTE: Blank line for visual separation.
009886| src/components/SearchErrorBanner.tsx:11: import { useRouter } from "next/navigation";
009887| NOTE: Imports dependency for this module.
009888| src/components/SearchErrorBanner.tsx:12: import { useTransition } from "react";
009889| NOTE: Imports dependency for this module.
009890| src/components/SearchErrorBanner.tsx:13: import { AlertTriangle, RefreshCw } from "lucide-react";
009891| NOTE: Imports dependency for this module.
009892| src/components/SearchErrorBanner.tsx:14: 
009893| NOTE: Blank line for visual separation.
009894| src/components/SearchErrorBanner.tsx:15: interface SearchErrorBannerProps {
009895| NOTE: Type declaration for search data contracts.
009896| src/components/SearchErrorBanner.tsx:16:   /** Error message to display */
009897| NOTE: Block comment line describing behavior or context.
009898| src/components/SearchErrorBanner.tsx:17:   message: string;
009899| NOTE: Implementation detail supporting search page behavior.
009900| src/components/SearchErrorBanner.tsx:18:   /** Optional request ID for support reference */
009901| NOTE: Block comment line describing behavior or context.
009902| src/components/SearchErrorBanner.tsx:19:   requestId?: string;
009903| NOTE: Implementation detail supporting search page behavior.
009904| src/components/SearchErrorBanner.tsx:20: }
009905| NOTE: Implementation detail supporting search page behavior.
009906| src/components/SearchErrorBanner.tsx:21: 
009907| NOTE: Blank line for visual separation.
009908| src/components/SearchErrorBanner.tsx:22: export function SearchErrorBanner({
009909| NOTE: Exports helper or component function.
009910| src/components/SearchErrorBanner.tsx:23:   message,
009911| NOTE: Implementation detail supporting search page behavior.
009912| src/components/SearchErrorBanner.tsx:24:   requestId,
009913| NOTE: Implementation detail supporting search page behavior.
009914| src/components/SearchErrorBanner.tsx:25: }: SearchErrorBannerProps) {
009915| NOTE: Implementation detail supporting search page behavior.
009916| src/components/SearchErrorBanner.tsx:26:   const router = useRouter();
009917| NOTE: Local declaration used by search logic or UI.
009918| src/components/SearchErrorBanner.tsx:27:   const [isPending, startTransition] = useTransition();
009919| NOTE: Local declaration used by search logic or UI.
009920| src/components/SearchErrorBanner.tsx:28: 
009921| NOTE: Blank line for visual separation.
009922| src/components/SearchErrorBanner.tsx:29:   const handleRetry = () => {
009923| NOTE: Local declaration used by search logic or UI.
009924| src/components/SearchErrorBanner.tsx:30:     if (isPending) return;
009925| NOTE: Conditional logic controlling rendering or flow.
009926| src/components/SearchErrorBanner.tsx:31: 
009927| NOTE: Blank line for visual separation.
009928| src/components/SearchErrorBanner.tsx:32:     startTransition(() => {
009929| NOTE: Implementation detail supporting search page behavior.
009930| src/components/SearchErrorBanner.tsx:33:       // router.refresh() re-runs server components without full page reload
009931| NOTE: Line comment documents intent or constraints.
009932| src/components/SearchErrorBanner.tsx:34:       router.refresh();
009933| NOTE: Routing logic updates search URL state.
009934| src/components/SearchErrorBanner.tsx:35:     });
009935| NOTE: Implementation detail supporting search page behavior.
009936| src/components/SearchErrorBanner.tsx:36:   };
009937| NOTE: Implementation detail supporting search page behavior.
009938| src/components/SearchErrorBanner.tsx:37: 
009939| NOTE: Blank line for visual separation.
009940| src/components/SearchErrorBanner.tsx:38:   return (
009941| NOTE: Return statement for component or helper output.
009942| src/components/SearchErrorBanner.tsx:39:     <div
009943| NOTE: JSX markup for search UI.
009944| src/components/SearchErrorBanner.tsx:40:       className="bg-amber-50 dark:bg-amber-950/50 border-b border-amber-200 dark:border-amber-800 px-4 py-3"
009945| NOTE: Tailwind classes define layout and styling.
009946| src/components/SearchErrorBanner.tsx:41:       role="alert"
009947| NOTE: Implementation detail supporting search page behavior.
009948| src/components/SearchErrorBanner.tsx:42:       aria-live="assertive"
009949| NOTE: Accessibility attribute for screen readers.
009950| src/components/SearchErrorBanner.tsx:43:     >
009951| NOTE: Implementation detail supporting search page behavior.
009952| src/components/SearchErrorBanner.tsx:44:       <div className="max-w-7xl mx-auto flex flex-wrap items-center justify-between gap-3">
009953| NOTE: Tailwind classes define layout and styling.
009954| src/components/SearchErrorBanner.tsx:45:         <div className="flex items-center gap-2 text-sm text-amber-800 dark:text-amber-300">
009955| NOTE: Tailwind classes define layout and styling.
009956| src/components/SearchErrorBanner.tsx:46:           <AlertTriangle className="w-4 h-4 flex-shrink-0" aria-hidden="true" />
009957| NOTE: Tailwind classes define layout and styling.
009958| src/components/SearchErrorBanner.tsx:47:           <span>
009959| NOTE: JSX markup for search UI.
009960| src/components/SearchErrorBanner.tsx:48:             <span className="font-medium">{message}</span>
009961| NOTE: Tailwind classes define layout and styling.
009962| src/components/SearchErrorBanner.tsx:49:             {requestId && (
009963| NOTE: Implementation detail supporting search page behavior.
009964| src/components/SearchErrorBanner.tsx:50:               <span className="text-amber-600 dark:text-amber-400 ml-2 text-xs">
009965| NOTE: Tailwind classes define layout and styling.
009966| src/components/SearchErrorBanner.tsx:51:                 (Ref: {requestId.slice(0, 8)})
009967| NOTE: Implementation detail supporting search page behavior.
009968| src/components/SearchErrorBanner.tsx:52:               </span>
009969| NOTE: JSX markup for search UI.
009970| src/components/SearchErrorBanner.tsx:53:             )}
009971| NOTE: Implementation detail supporting search page behavior.
009972| src/components/SearchErrorBanner.tsx:54:           </span>
009973| NOTE: JSX markup for search UI.
009974| src/components/SearchErrorBanner.tsx:55:         </div>
009975| NOTE: JSX markup for search UI.
009976| src/components/SearchErrorBanner.tsx:56: 
009977| NOTE: Blank line for visual separation.
009978| src/components/SearchErrorBanner.tsx:57:         <button
009979| NOTE: JSX markup for search UI.
009980| src/components/SearchErrorBanner.tsx:58:           type="button"
009981| NOTE: Implementation detail supporting search page behavior.
009982| src/components/SearchErrorBanner.tsx:59:           onClick={handleRetry}
009983| NOTE: Implementation detail supporting search page behavior.
009984| src/components/SearchErrorBanner.tsx:60:           disabled={isPending}
009985| NOTE: Implementation detail supporting search page behavior.
009986| src/components/SearchErrorBanner.tsx:61:           className="flex-shrink-0 flex items-center gap-1.5 rounded-md border border-amber-300 dark:border-amber-700 bg-white dark:bg-amber-900/30 px-3 py-1.5 text-xs font-medium text-amber-800 dark:text-amber-200 transition-colors hover:bg-amber-100 dark:hover:bg-amber-900/50 hover:border-amber-400 dark:hover:border-amber-600 disabled:opacity-50 disabled:cursor-not-allowed"
009987| NOTE: Tailwind classes define layout and styling.
009988| src/components/SearchErrorBanner.tsx:62:         >
009989| NOTE: Implementation detail supporting search page behavior.
009990| src/components/SearchErrorBanner.tsx:63:           <RefreshCw
009991| NOTE: JSX markup for search UI.
009992| src/components/SearchErrorBanner.tsx:64:             className={`h-3.5 w-3.5 ${isPending ? "animate-spin" : ""}`}
009993| NOTE: Tailwind classes define layout and styling.
009994| src/components/SearchErrorBanner.tsx:65:             aria-hidden="true"
009995| NOTE: Accessibility attribute for screen readers.
009996| src/components/SearchErrorBanner.tsx:66:           />
009997| NOTE: Implementation detail supporting search page behavior.
009998| src/components/SearchErrorBanner.tsx:67:           {isPending ? "Retrying..." : "Retry"}
009999| NOTE: Implementation detail supporting search page behavior.
010000| src/components/SearchErrorBanner.tsx:68:         </button>
010001| NOTE: JSX markup for search UI.
010002| src/components/SearchErrorBanner.tsx:69:       </div>
010003| NOTE: JSX markup for search UI.
010004| src/components/SearchErrorBanner.tsx:70:     </div>
010005| NOTE: JSX markup for search UI.
010006| src/components/SearchErrorBanner.tsx:71:   );
010007| NOTE: Implementation detail supporting search page behavior.
010008| src/components/SearchErrorBanner.tsx:72: }
010009| NOTE: Implementation detail supporting search page behavior.
010010| FILE END: src/components/SearchErrorBanner.tsx
010011| 
010012| FILE START: src/components/SearchForm.tsx
010013| FILE ROLE: Search form UI, filters, and URL sync for the search experience.
010014| src/components/SearchForm.tsx:1: "use client";
010015| NOTE: Implementation detail supporting search page behavior.
010016| src/components/SearchForm.tsx:2: 
010017| NOTE: Blank line for visual separation.
010018| src/components/SearchForm.tsx:3: import { useState, useEffect, useRef, useCallback, useMemo } from "react";
010019| NOTE: Imports dependency for this module.
010020| src/components/SearchForm.tsx:4: import { createPortal } from "react-dom";
010021| NOTE: Imports dependency for this module.
010022| src/components/SearchForm.tsx:5: import { useRouter, useSearchParams } from "next/navigation";
010023| NOTE: Imports dependency for this module.
010024| src/components/SearchForm.tsx:6: import { Search, X, Clock, SlidersHorizontal, Loader2 } from "lucide-react";
010025| NOTE: Imports dependency for this module.
010026| src/components/SearchForm.tsx:7: import { useSearchTransitionSafe } from "@/contexts/SearchTransitionContext";
010027| NOTE: Imports dependency for this module.
010028| src/components/SearchForm.tsx:8: import { useFilterStateSafe } from "@/contexts/FilterStateContext";
010029| NOTE: Imports dependency for this module.
010030| src/components/SearchForm.tsx:9: import { useMobileSearch } from "@/contexts/MobileSearchContext";
010031| NOTE: Imports dependency for this module.
010032| src/components/SearchForm.tsx:10: import { useBatchedFilters } from "@/hooks/useBatchedFilters";
010033| NOTE: Imports dependency for this module.
010034| src/components/SearchForm.tsx:11: import { useDebouncedFilterCount } from "@/hooks/useDebouncedFilterCount";
010035| NOTE: Imports dependency for this module.
010036| src/components/SearchForm.tsx:12: import {
010037| NOTE: Imports dependency for this module.
010038| src/components/SearchForm.tsx:13:   useRecentSearches,
010039| NOTE: Implementation detail supporting search page behavior.
010040| src/components/SearchForm.tsx:14:   type RecentSearch,
010041| NOTE: Type declaration for search data contracts.
010042| src/components/SearchForm.tsx:15:   type RecentSearchFilters,
010043| NOTE: Type declaration for search data contracts.
010044| src/components/SearchForm.tsx:16: } from "@/hooks/useRecentSearches";
010045| NOTE: Implementation detail supporting search page behavior.
010046| src/components/SearchForm.tsx:17: import {
010047| NOTE: Imports dependency for this module.
010048| src/components/SearchForm.tsx:18:   useKeyboardShortcuts,
010049| NOTE: Implementation detail supporting search page behavior.
010050| src/components/SearchForm.tsx:19:   SEARCH_SHORTCUTS,
010051| NOTE: Implementation detail supporting search page behavior.
010052| src/components/SearchForm.tsx:20: } from "@/hooks/useKeyboardShortcuts";
010053| NOTE: Implementation detail supporting search page behavior.
010054| src/components/SearchForm.tsx:21: import { Button } from "@/components/ui/button";
010055| NOTE: Imports dependency for this module.
010056| src/components/SearchForm.tsx:22: import { Input } from "@/components/ui/input";
010057| NOTE: Imports dependency for this module.
010058| src/components/SearchForm.tsx:23: import { FocusTrap } from "@/components/ui/FocusTrap";
010059| NOTE: Imports dependency for this module.
010060| src/components/SearchForm.tsx:24: import { FilterStickyFooter } from "@/components/filters/FilterStickyFooter";
010061| NOTE: Imports dependency for this module.
010062| src/components/SearchForm.tsx:25: import LocationSearchInput, {
010063| NOTE: Imports dependency for this module.
010064| src/components/SearchForm.tsx:26:   type LocationSearchInputRef,
010065| NOTE: Type declaration for search data contracts.
010066| src/components/SearchForm.tsx:27: } from "@/components/LocationSearchInput";
010067| NOTE: Implementation detail supporting search page behavior.
010068| src/components/SearchForm.tsx:28: import { DatePicker } from "@/components/ui/date-picker";
010069| NOTE: Imports dependency for this module.
010070| src/components/SearchForm.tsx:29: import {
010071| NOTE: Imports dependency for this module.
010072| src/components/SearchForm.tsx:30:   SUPPORTED_LANGUAGES,
010073| NOTE: Implementation detail supporting search page behavior.
010074| src/components/SearchForm.tsx:31:   getLanguageName,
010075| NOTE: Implementation detail supporting search page behavior.
010076| src/components/SearchForm.tsx:32:   normalizeLanguages,
010077| NOTE: Implementation detail supporting search page behavior.
010078| src/components/SearchForm.tsx:33:   type LanguageCode,
010079| NOTE: Type declaration for search data contracts.
010080| src/components/SearchForm.tsx:34: } from "@/lib/languages";
010081| NOTE: Implementation detail supporting search page behavior.
010082| src/components/SearchForm.tsx:35: import {
010083| NOTE: Imports dependency for this module.
010084| src/components/SearchForm.tsx:36:   Select,
010085| NOTE: Implementation detail supporting search page behavior.
010086| src/components/SearchForm.tsx:37:   SelectContent,
010087| NOTE: Implementation detail supporting search page behavior.
010088| src/components/SearchForm.tsx:38:   SelectItem,
010089| NOTE: Implementation detail supporting search page behavior.
010090| src/components/SearchForm.tsx:39:   SelectTrigger,
010091| NOTE: Implementation detail supporting search page behavior.
010092| src/components/SearchForm.tsx:40:   SelectValue,
010093| NOTE: Implementation detail supporting search page behavior.
010094| src/components/SearchForm.tsx:41: } from "@/components/ui/select";
010095| NOTE: Implementation detail supporting search page behavior.
010096| src/components/SearchForm.tsx:42: import { sortOptions } from "@/components/SortSelect";
010097| NOTE: Imports dependency for this module.
010098| src/components/SearchForm.tsx:43: import type { SortOption } from "@/lib/data";
010099| NOTE: Imports dependency for this module.
010100| src/components/SearchForm.tsx:44: 
010101| NOTE: Blank line for visual separation.
010102| src/components/SearchForm.tsx:45: // Debounce delay in milliseconds
010103| NOTE: Line comment documents intent or constraints.
010104| src/components/SearchForm.tsx:46: const SEARCH_DEBOUNCE_MS = 300;
010105| NOTE: Local declaration used by search logic or UI.
010106| src/components/SearchForm.tsx:47: 
010107| NOTE: Blank line for visual separation.
010108| src/components/SearchForm.tsx:48: const AMENITY_OPTIONS = [
010109| NOTE: Local declaration used by search logic or UI.
010110| src/components/SearchForm.tsx:49:   "Wifi",
010111| NOTE: Implementation detail supporting search page behavior.
010112| src/components/SearchForm.tsx:50:   "AC",
010113| NOTE: Implementation detail supporting search page behavior.
010114| src/components/SearchForm.tsx:51:   "Parking",
010115| NOTE: Implementation detail supporting search page behavior.
010116| src/components/SearchForm.tsx:52:   "Washer",
010117| NOTE: Implementation detail supporting search page behavior.
010118| src/components/SearchForm.tsx:53:   "Dryer",
010119| NOTE: Implementation detail supporting search page behavior.
010120| src/components/SearchForm.tsx:54:   "Kitchen",
010121| NOTE: Implementation detail supporting search page behavior.
010122| src/components/SearchForm.tsx:55:   "Gym",
010123| NOTE: Implementation detail supporting search page behavior.
010124| src/components/SearchForm.tsx:56:   "Pool",
010125| NOTE: Implementation detail supporting search page behavior.
010126| src/components/SearchForm.tsx:57:   "Furnished",
010127| NOTE: Implementation detail supporting search page behavior.
010128| src/components/SearchForm.tsx:58: ] as const;
010129| NOTE: Implementation detail supporting search page behavior.
010130| src/components/SearchForm.tsx:59: const HOUSE_RULE_OPTIONS = [
010131| NOTE: Local declaration used by search logic or UI.
010132| src/components/SearchForm.tsx:60:   "Pets allowed",
010133| NOTE: Implementation detail supporting search page behavior.
010134| src/components/SearchForm.tsx:61:   "Smoking allowed",
010135| NOTE: Implementation detail supporting search page behavior.
010136| src/components/SearchForm.tsx:62:   "Couples allowed",
010137| NOTE: Implementation detail supporting search page behavior.
010138| src/components/SearchForm.tsx:63:   "Guests allowed",
010139| NOTE: Implementation detail supporting search page behavior.
010140| src/components/SearchForm.tsx:64: ] as const;
010141| NOTE: Implementation detail supporting search page behavior.
010142| src/components/SearchForm.tsx:65: const LEASE_DURATION_OPTIONS = [
010143| NOTE: Local declaration used by search logic or UI.
010144| src/components/SearchForm.tsx:66:   "any",
010145| NOTE: Implementation detail supporting search page behavior.
010146| src/components/SearchForm.tsx:67:   "Month-to-month",
010147| NOTE: Implementation detail supporting search page behavior.
010148| src/components/SearchForm.tsx:68:   "3 months",
010149| NOTE: Implementation detail supporting search page behavior.
010150| src/components/SearchForm.tsx:69:   "6 months",
010151| NOTE: Implementation detail supporting search page behavior.
010152| src/components/SearchForm.tsx:70:   "12 months",
010153| NOTE: Implementation detail supporting search page behavior.
010154| src/components/SearchForm.tsx:71:   "Flexible",
010155| NOTE: Implementation detail supporting search page behavior.
010156| src/components/SearchForm.tsx:72: ] as const;
010157| NOTE: Implementation detail supporting search page behavior.
010158| src/components/SearchForm.tsx:73: const ROOM_TYPE_OPTIONS = [
010159| NOTE: Local declaration used by search logic or UI.
010160| src/components/SearchForm.tsx:74:   "any",
010161| NOTE: Implementation detail supporting search page behavior.
010162| src/components/SearchForm.tsx:75:   "Private Room",
010163| NOTE: Implementation detail supporting search page behavior.
010164| src/components/SearchForm.tsx:76:   "Shared Room",
010165| NOTE: Implementation detail supporting search page behavior.
010166| src/components/SearchForm.tsx:77:   "Entire Place",
010167| NOTE: Implementation detail supporting search page behavior.
010168| src/components/SearchForm.tsx:78: ] as const;
010169| NOTE: Implementation detail supporting search page behavior.
010170| src/components/SearchForm.tsx:79: 
010171| NOTE: Blank line for visual separation.
010172| src/components/SearchForm.tsx:80: // URL-friendly aliases for enum values
010173| NOTE: Line comment documents intent or constraints.
010174| src/components/SearchForm.tsx:81: const LEASE_DURATION_ALIASES: Record<string, string> = {
010175| NOTE: Local declaration used by search logic or UI.
010176| src/components/SearchForm.tsx:82:   "month-to-month": "Month-to-month",
010177| NOTE: Implementation detail supporting search page behavior.
010178| src/components/SearchForm.tsx:83:   month_to_month: "Month-to-month",
010179| NOTE: Implementation detail supporting search page behavior.
010180| src/components/SearchForm.tsx:84:   mtm: "Month-to-month",
010181| NOTE: Implementation detail supporting search page behavior.
010182| src/components/SearchForm.tsx:85:   "3_months": "3 months",
010183| NOTE: Implementation detail supporting search page behavior.
010184| src/components/SearchForm.tsx:86:   "6_months": "6 months",
010185| NOTE: Implementation detail supporting search page behavior.
010186| src/components/SearchForm.tsx:87:   "12_months": "12 months",
010187| NOTE: Implementation detail supporting search page behavior.
010188| src/components/SearchForm.tsx:88:   "1_year": "12 months",
010189| NOTE: Implementation detail supporting search page behavior.
010190| src/components/SearchForm.tsx:89: };
010191| NOTE: Implementation detail supporting search page behavior.
010192| src/components/SearchForm.tsx:90: 
010193| NOTE: Blank line for visual separation.
010194| src/components/SearchForm.tsx:91: const ROOM_TYPE_ALIASES: Record<string, string> = {
010195| NOTE: Local declaration used by search logic or UI.
010196| src/components/SearchForm.tsx:92:   private: "Private Room",
010197| NOTE: Implementation detail supporting search page behavior.
010198| src/components/SearchForm.tsx:93:   private_room: "Private Room",
010199| NOTE: Implementation detail supporting search page behavior.
010200| src/components/SearchForm.tsx:94:   shared: "Shared Room",
010201| NOTE: Implementation detail supporting search page behavior.
010202| src/components/SearchForm.tsx:95:   shared_room: "Shared Room",
010203| NOTE: Implementation detail supporting search page behavior.
010204| src/components/SearchForm.tsx:96:   entire: "Entire Place",
010205| NOTE: Implementation detail supporting search page behavior.
010206| src/components/SearchForm.tsx:97:   entire_place: "Entire Place",
010207| NOTE: Implementation detail supporting search page behavior.
010208| src/components/SearchForm.tsx:98: };
010209| NOTE: Implementation detail supporting search page behavior.
010210| src/components/SearchForm.tsx:99: 
010211| NOTE: Blank line for visual separation.
010212| src/components/SearchForm.tsx:100: /**
010213| NOTE: Block comment line describing behavior or context.
010214| src/components/SearchForm.tsx:101:  * Validate a price input. Returns true if empty or a valid non-negative number.
010215| NOTE: Block comment line describing behavior or context.
010216| src/components/SearchForm.tsx:102:  */
010217| NOTE: Block comment line describing behavior or context.
010218| src/components/SearchForm.tsx:103: const isValidPrice = (value: string): boolean => {
010219| NOTE: Local declaration used by search logic or UI.
010220| src/components/SearchForm.tsx:104:   if (!value || value.trim() === "") return true;
010221| NOTE: Conditional logic controlling rendering or flow.
010222| src/components/SearchForm.tsx:105:   const num = parseFloat(value);
010223| NOTE: Local declaration used by search logic or UI.
010224| src/components/SearchForm.tsx:106:   return !isNaN(num) && isFinite(num) && num >= 0;
010225| NOTE: Return statement for component or helper output.
010226| src/components/SearchForm.tsx:107: };
010227| NOTE: Implementation detail supporting search page behavior.
010228| src/components/SearchForm.tsx:108: 
010229| NOTE: Blank line for visual separation.
010230| src/components/SearchForm.tsx:109: /**
010231| NOTE: Block comment line describing behavior or context.
010232| src/components/SearchForm.tsx:110:  * Validate a move-in date string. Returns the date if valid (today or future, within 2 years),
010233| NOTE: Block comment line describing behavior or context.
010234| src/components/SearchForm.tsx:111:  * otherwise returns empty string. This matches the server-side safeParseDate logic.
010235| NOTE: Block comment line describing behavior or context.
010236| src/components/SearchForm.tsx:112:  */
010237| NOTE: Block comment line describing behavior or context.
010238| src/components/SearchForm.tsx:113: const validateMoveInDate = (value: string | null): string => {
010239| NOTE: Local declaration used by search logic or UI.
010240| src/components/SearchForm.tsx:114:   if (!value) return "";
010241| NOTE: Conditional logic controlling rendering or flow.
010242| src/components/SearchForm.tsx:115:   const trimmed = value.trim();
010243| NOTE: Local declaration used by search logic or UI.
010244| src/components/SearchForm.tsx:116:   if (!/^\d{4}-\d{2}-\d{2}$/.test(trimmed)) return "";
010245| NOTE: Conditional logic controlling rendering or flow.
010246| src/components/SearchForm.tsx:117: 
010247| NOTE: Blank line for visual separation.
010248| src/components/SearchForm.tsx:118:   const [yearStr, monthStr, dayStr] = trimmed.split("-");
010249| NOTE: Local declaration used by search logic or UI.
010250| src/components/SearchForm.tsx:119:   const year = parseInt(yearStr, 10);
010251| NOTE: Local declaration used by search logic or UI.
010252| src/components/SearchForm.tsx:120:   const month = parseInt(monthStr, 10);
010253| NOTE: Local declaration used by search logic or UI.
010254| src/components/SearchForm.tsx:121:   const day = parseInt(dayStr, 10);
010255| NOTE: Local declaration used by search logic or UI.
010256| src/components/SearchForm.tsx:122: 
010257| NOTE: Blank line for visual separation.
010258| src/components/SearchForm.tsx:123:   if (month < 1 || month > 12) return "";
010259| NOTE: Conditional logic controlling rendering or flow.
010260| src/components/SearchForm.tsx:124:   if (day < 1 || day > 31) return "";
010261| NOTE: Conditional logic controlling rendering or flow.
010262| src/components/SearchForm.tsx:125: 
010263| NOTE: Blank line for visual separation.
010264| src/components/SearchForm.tsx:126:   const date = new Date(year, month - 1, day);
010265| NOTE: Local declaration used by search logic or UI.
010266| src/components/SearchForm.tsx:127:   if (
010267| NOTE: Conditional logic controlling rendering or flow.
010268| src/components/SearchForm.tsx:128:     date.getFullYear() !== year ||
010269| NOTE: Implementation detail supporting search page behavior.
010270| src/components/SearchForm.tsx:129:     date.getMonth() !== month - 1 ||
010271| NOTE: Implementation detail supporting search page behavior.
010272| src/components/SearchForm.tsx:130:     date.getDate() !== day
010273| NOTE: Implementation detail supporting search page behavior.
010274| src/components/SearchForm.tsx:131:   ) {
010275| NOTE: Implementation detail supporting search page behavior.
010276| src/components/SearchForm.tsx:132:     return "";
010277| NOTE: Return statement for component or helper output.
010278| src/components/SearchForm.tsx:133:   }
010279| NOTE: Implementation detail supporting search page behavior.
010280| src/components/SearchForm.tsx:134: 
010281| NOTE: Blank line for visual separation.
010282| src/components/SearchForm.tsx:135:   // Reject past dates
010283| NOTE: Line comment documents intent or constraints.
010284| src/components/SearchForm.tsx:136:   const today = new Date();
010285| NOTE: Local declaration used by search logic or UI.
010286| src/components/SearchForm.tsx:137:   today.setHours(0, 0, 0, 0);
010287| NOTE: Implementation detail supporting search page behavior.
010288| src/components/SearchForm.tsx:138:   if (date < today) return "";
010289| NOTE: Conditional logic controlling rendering or flow.
010290| src/components/SearchForm.tsx:139: 
010291| NOTE: Blank line for visual separation.
010292| src/components/SearchForm.tsx:140:   // Reject dates more than 2 years in the future
010293| NOTE: Line comment documents intent or constraints.
010294| src/components/SearchForm.tsx:141:   const maxDate = new Date();
010295| NOTE: Local declaration used by search logic or UI.
010296| src/components/SearchForm.tsx:142:   maxDate.setFullYear(maxDate.getFullYear() + 2);
010297| NOTE: Implementation detail supporting search page behavior.
010298| src/components/SearchForm.tsx:143:   if (date > maxDate) return "";
010299| NOTE: Conditional logic controlling rendering or flow.
010300| src/components/SearchForm.tsx:144: 
010301| NOTE: Blank line for visual separation.
010302| src/components/SearchForm.tsx:145:   return trimmed;
010303| NOTE: Return statement for component or helper output.
010304| src/components/SearchForm.tsx:146: };
010305| NOTE: Implementation detail supporting search page behavior.
010306| src/components/SearchForm.tsx:147: 
010307| NOTE: Blank line for visual separation.
010308| src/components/SearchForm.tsx:148: // Custom event for map fly-to
010309| NOTE: Line comment documents intent or constraints.
010310| src/components/SearchForm.tsx:149: export const MAP_FLY_TO_EVENT = "mapFlyToLocation";
010311| NOTE: Implementation detail supporting search page behavior.
010312| src/components/SearchForm.tsx:150: 
010313| NOTE: Blank line for visual separation.
010314| src/components/SearchForm.tsx:151: export interface MapFlyToEventDetail {
010315| NOTE: Implementation detail supporting search page behavior.
010316| src/components/SearchForm.tsx:152:   lat: number;
010317| NOTE: Implementation detail supporting search page behavior.
010318| src/components/SearchForm.tsx:153:   lng: number;
010319| NOTE: Implementation detail supporting search page behavior.
010320| src/components/SearchForm.tsx:154:   bbox?: [number, number, number, number];
010321| NOTE: Implementation detail supporting search page behavior.
010322| src/components/SearchForm.tsx:155:   zoom?: number;
010323| NOTE: Implementation detail supporting search page behavior.
010324| src/components/SearchForm.tsx:156:   /** Search location name for conflict detection */
010325| NOTE: Block comment line describing behavior or context.
010326| src/components/SearchForm.tsx:157:   locationName?: string;
010327| NOTE: Implementation detail supporting search page behavior.
010328| src/components/SearchForm.tsx:158: }
010329| NOTE: Implementation detail supporting search page behavior.
010330| src/components/SearchForm.tsx:159: 
010331| NOTE: Blank line for visual separation.
010332| src/components/SearchForm.tsx:160: export default function SearchForm({
010333| NOTE: Exports main component for this module.
010334| src/components/SearchForm.tsx:161:   variant = "default",
010335| NOTE: Implementation detail supporting search page behavior.
010336| src/components/SearchForm.tsx:162: }: {
010337| NOTE: Implementation detail supporting search page behavior.
010338| src/components/SearchForm.tsx:163:   variant?: "default" | "compact";
010339| NOTE: Implementation detail supporting search page behavior.
010340| src/components/SearchForm.tsx:164: }) {
010341| NOTE: Implementation detail supporting search page behavior.
010342| src/components/SearchForm.tsx:165:   const searchParams = useSearchParams();
010343| NOTE: Local declaration used by search logic or UI.
010344| src/components/SearchForm.tsx:166:   const parseParamList = (key: string): string[] => {
010345| NOTE: Local declaration used by search logic or UI.
010346| src/components/SearchForm.tsx:167:     const values = searchParams.getAll(key);
010347| NOTE: Local declaration used by search logic or UI.
010348| src/components/SearchForm.tsx:168:     if (values.length === 0) return [];
010349| NOTE: Conditional logic controlling rendering or flow.
010350| src/components/SearchForm.tsx:169:     return values
010351| NOTE: Return statement for component or helper output.
010352| src/components/SearchForm.tsx:170:       .flatMap((value) => value.split(","))
010353| NOTE: Implementation detail supporting search page behavior.
010354| src/components/SearchForm.tsx:171:       .map((value) => value.trim())
010355| NOTE: Implementation detail supporting search page behavior.
010356| src/components/SearchForm.tsx:172:       .filter(Boolean);
010357| NOTE: Implementation detail supporting search page behavior.
010358| src/components/SearchForm.tsx:173:   };
010359| NOTE: Implementation detail supporting search page behavior.
010360| src/components/SearchForm.tsx:174:   const normalizeByAllowlist = (
010361| NOTE: Local declaration used by search logic or UI.
010362| src/components/SearchForm.tsx:175:     values: string[],
010363| NOTE: Implementation detail supporting search page behavior.
010364| src/components/SearchForm.tsx:176:     allowlist: readonly string[],
010365| NOTE: Implementation detail supporting search page behavior.
010366| src/components/SearchForm.tsx:177:   ) => {
010367| NOTE: Implementation detail supporting search page behavior.
010368| src/components/SearchForm.tsx:178:     const allowMap = new Map(
010369| NOTE: Local declaration used by search logic or UI.
010370| src/components/SearchForm.tsx:179:       allowlist.map((item) => [item.toLowerCase(), item]),
010371| NOTE: Implementation detail supporting search page behavior.
010372| src/components/SearchForm.tsx:180:     );
010373| NOTE: Implementation detail supporting search page behavior.
010374| src/components/SearchForm.tsx:181:     const normalized = values
010375| NOTE: Local declaration used by search logic or UI.
010376| src/components/SearchForm.tsx:182:       .map((value) => allowMap.get(value.toLowerCase()))
010377| NOTE: Implementation detail supporting search page behavior.
010378| src/components/SearchForm.tsx:183:       .filter((value): value is string => Boolean(value));
010379| NOTE: Implementation detail supporting search page behavior.
010380| src/components/SearchForm.tsx:184:     return Array.from(new Set(normalized));
010381| NOTE: Return statement for component or helper output.
010382| src/components/SearchForm.tsx:185:   };
010383| NOTE: Implementation detail supporting search page behavior.
010384| src/components/SearchForm.tsx:186:   const parseEnumParam = (
010385| NOTE: Local declaration used by search logic or UI.
010386| src/components/SearchForm.tsx:187:     key: string,
010387| NOTE: Implementation detail supporting search page behavior.
010388| src/components/SearchForm.tsx:188:     allowlist: readonly string[],
010389| NOTE: Implementation detail supporting search page behavior.
010390| src/components/SearchForm.tsx:189:     aliases?: Record<string, string>,
010391| NOTE: Implementation detail supporting search page behavior.
010392| src/components/SearchForm.tsx:190:   ) => {
010393| NOTE: Implementation detail supporting search page behavior.
010394| src/components/SearchForm.tsx:191:     const value = searchParams.get(key);
010395| NOTE: Local declaration used by search logic or UI.
010396| src/components/SearchForm.tsx:192:     if (!value) return "";
010397| NOTE: Conditional logic controlling rendering or flow.
010398| src/components/SearchForm.tsx:193:     const trimmed = value.trim();
010399| NOTE: Local declaration used by search logic or UI.
010400| src/components/SearchForm.tsx:194:     // Check direct match first
010401| NOTE: Line comment documents intent or constraints.
010402| src/components/SearchForm.tsx:195:     if (allowlist.includes(trimmed)) return trimmed;
010403| NOTE: Conditional logic controlling rendering or flow.
010404| src/components/SearchForm.tsx:196:     // Check case-insensitive match
010405| NOTE: Line comment documents intent or constraints.
010406| src/components/SearchForm.tsx:197:     const lowerValue = trimmed.toLowerCase();
010407| NOTE: Local declaration used by search logic or UI.
010408| src/components/SearchForm.tsx:198:     const caseMatch = allowlist.find(
010409| NOTE: Local declaration used by search logic or UI.
010410| src/components/SearchForm.tsx:199:       (item) => item.toLowerCase() === lowerValue,
010411| NOTE: Implementation detail supporting search page behavior.
010412| src/components/SearchForm.tsx:200:     );
010413| NOTE: Implementation detail supporting search page behavior.
010414| src/components/SearchForm.tsx:201:     if (caseMatch) return caseMatch;
010415| NOTE: Conditional logic controlling rendering or flow.
010416| src/components/SearchForm.tsx:202:     // Check aliases if provided
010417| NOTE: Line comment documents intent or constraints.
010418| src/components/SearchForm.tsx:203:     if (aliases) {
010419| NOTE: Conditional logic controlling rendering or flow.
010420| src/components/SearchForm.tsx:204:       const aliasMatch = aliases[lowerValue];
010421| NOTE: Local declaration used by search logic or UI.
010422| src/components/SearchForm.tsx:205:       if (aliasMatch && allowlist.includes(aliasMatch)) return aliasMatch;
010423| NOTE: Conditional logic controlling rendering or flow.
010424| src/components/SearchForm.tsx:206:     }
010425| NOTE: Implementation detail supporting search page behavior.
010426| src/components/SearchForm.tsx:207:     // Invalid value - return empty string
010427| NOTE: Line comment documents intent or constraints.
010428| src/components/SearchForm.tsx:208:     return "";
010429| NOTE: Return statement for component or helper output.
010430| src/components/SearchForm.tsx:209:   };
010431| NOTE: Implementation detail supporting search page behavior.
010432| src/components/SearchForm.tsx:210:   const parseLanguages = () => {
010433| NOTE: Local declaration used by search logic or UI.
010434| src/components/SearchForm.tsx:211:     const normalized = normalizeLanguages(parseParamList("languages"));
010435| NOTE: Local declaration used by search logic or UI.
010436| src/components/SearchForm.tsx:212:     return Array.from(new Set(normalized));
010437| NOTE: Return statement for component or helper output.
010438| src/components/SearchForm.tsx:213:   };
010439| NOTE: Implementation detail supporting search page behavior.
010440| src/components/SearchForm.tsx:214:   const parseCoords = () => {
010441| NOTE: Local declaration used by search logic or UI.
010442| src/components/SearchForm.tsx:215:     const lat = searchParams.get("lat");
010443| NOTE: Local declaration used by search logic or UI.
010444| src/components/SearchForm.tsx:216:     const lng = searchParams.get("lng");
010445| NOTE: Local declaration used by search logic or UI.
010446| src/components/SearchForm.tsx:217:     if (!lat || !lng) return null;
010447| NOTE: Conditional logic controlling rendering or flow.
010448| src/components/SearchForm.tsx:218:     const parsedLat = parseFloat(lat);
010449| NOTE: Local declaration used by search logic or UI.
010450| src/components/SearchForm.tsx:219:     const parsedLng = parseFloat(lng);
010451| NOTE: Local declaration used by search logic or UI.
010452| src/components/SearchForm.tsx:220:     if (!Number.isFinite(parsedLat) || !Number.isFinite(parsedLng)) {
010453| NOTE: Conditional logic controlling rendering or flow.
010454| src/components/SearchForm.tsx:221:       return null;
010455| NOTE: Return statement for component or helper output.
010456| src/components/SearchForm.tsx:222:     }
010457| NOTE: Implementation detail supporting search page behavior.
010458| src/components/SearchForm.tsx:223:     return { lat: parsedLat, lng: parsedLng };
010459| NOTE: Return statement for component or helper output.
010460| src/components/SearchForm.tsx:224:   };
010461| NOTE: Implementation detail supporting search page behavior.
010462| src/components/SearchForm.tsx:225:   const [location, setLocation] = useState(searchParams.get("q") || "");
010463| NOTE: Initializes local state for search UI behavior.
010464| src/components/SearchForm.tsx:226:   const [showFilters, setShowFilters] = useState(false);
010465| NOTE: Initializes local state for search UI behavior.
010466| src/components/SearchForm.tsx:227: 
010467| NOTE: Blank line for visual separation.
010468| src/components/SearchForm.tsx:228:   const [selectedCoords, setSelectedCoords] = useState<{
010469| NOTE: Initializes local state for search UI behavior.
010470| src/components/SearchForm.tsx:229:     lat: number;
010471| NOTE: Implementation detail supporting search page behavior.
010472| src/components/SearchForm.tsx:230:     lng: number;
010473| NOTE: Implementation detail supporting search page behavior.
010474| src/components/SearchForm.tsx:231:     bbox?: [number, number, number, number];
010475| NOTE: Implementation detail supporting search page behavior.
010476| src/components/SearchForm.tsx:232:   } | null>(parseCoords);
010477| NOTE: Implementation detail supporting search page behavior.
010478| src/components/SearchForm.tsx:233: 
010479| NOTE: Blank line for visual separation.
010480| src/components/SearchForm.tsx:234:   // Batched filters - changes accumulate until Apply is clicked
010481| NOTE: Line comment documents intent or constraints.
010482| src/components/SearchForm.tsx:235:   const {
010483| NOTE: Local declaration used by search logic or UI.
010484| src/components/SearchForm.tsx:236:     pending: batchedFilters,
010485| NOTE: Implementation detail supporting search page behavior.
010486| src/components/SearchForm.tsx:237:     committed: committedFilters,
010487| NOTE: Implementation detail supporting search page behavior.
010488| src/components/SearchForm.tsx:238:     isDirty: filtersDirty,
010489| NOTE: Implementation detail supporting search page behavior.
010490| src/components/SearchForm.tsx:239:     changeCount: filtersChangeCount,
010491| NOTE: Implementation detail supporting search page behavior.
010492| src/components/SearchForm.tsx:240:     apply: applyBatchedFilters,
010493| NOTE: Implementation detail supporting search page behavior.
010494| src/components/SearchForm.tsx:241:     reset: resetBatchedFilters,
010495| NOTE: Implementation detail supporting search page behavior.
010496| src/components/SearchForm.tsx:242:     updateField: updateBatchedField,
010497| NOTE: Implementation detail supporting search page behavior.
010498| src/components/SearchForm.tsx:243:     toggleArrayItem: toggleBatchedArrayItem,
010499| NOTE: Implementation detail supporting search page behavior.
010500| src/components/SearchForm.tsx:244:   } = useBatchedFilters();
010501| NOTE: Implementation detail supporting search page behavior.
010502| src/components/SearchForm.tsx:245: 
010503| NOTE: Blank line for visual separation.
010504| src/components/SearchForm.tsx:246:   // Debounced count for "Show X listings" button in filter drawer
010505| NOTE: Line comment documents intent or constraints.
010506| src/components/SearchForm.tsx:247:   const {
010507| NOTE: Local declaration used by search logic or UI.
010508| src/components/SearchForm.tsx:248:     count: pendingCount,
010509| NOTE: Implementation detail supporting search page behavior.
010510| src/components/SearchForm.tsx:249:     previousCount,
010511| NOTE: Implementation detail supporting search page behavior.
010512| src/components/SearchForm.tsx:250:     baselineCount,
010513| NOTE: Implementation detail supporting search page behavior.
010514| src/components/SearchForm.tsx:251:     isLoading: isCountLoading,
010515| NOTE: Implementation detail supporting search page behavior.
010516| src/components/SearchForm.tsx:252:   } = useDebouncedFilterCount({
010517| NOTE: Implementation detail supporting search page behavior.
010518| src/components/SearchForm.tsx:253:     pending: batchedFilters,
010519| NOTE: Implementation detail supporting search page behavior.
010520| src/components/SearchForm.tsx:254:     isDirty: filtersDirty,
010521| NOTE: Implementation detail supporting search page behavior.
010522| src/components/SearchForm.tsx:255:     isDrawerOpen: showFilters,
010523| NOTE: Implementation detail supporting search page behavior.
010524| src/components/SearchForm.tsx:256:   });
010525| NOTE: Implementation detail supporting search page behavior.
010526| src/components/SearchForm.tsx:257: 
010527| NOTE: Blank line for visual separation.
010528| src/components/SearchForm.tsx:258:   // Sync filter state with context for external components (e.g., PendingFiltersBanner)
010529| NOTE: Line comment documents intent or constraints.
010530| src/components/SearchForm.tsx:259:   const filterStateContext = useFilterStateSafe();
010531| NOTE: Local declaration used by search logic or UI.
010532| src/components/SearchForm.tsx:260: 
010533| NOTE: Blank line for visual separation.
010534| src/components/SearchForm.tsx:261:   // Sync dirty state to context
010535| NOTE: Line comment documents intent or constraints.
010536| src/components/SearchForm.tsx:262:   useEffect(() => {
010537| NOTE: Defines side effect for syncing with external state.
010538| src/components/SearchForm.tsx:263:     if (filterStateContext) {
010539| NOTE: Conditional logic controlling rendering or flow.
010540| src/components/SearchForm.tsx:264:       filterStateContext.setDirtyState(filtersDirty, filtersChangeCount);
010541| NOTE: Implementation detail supporting search page behavior.
010542| src/components/SearchForm.tsx:265:     }
010543| NOTE: Implementation detail supporting search page behavior.
010544| src/components/SearchForm.tsx:266:   }, [filterStateContext, filtersDirty, filtersChangeCount]);
010545| NOTE: Implementation detail supporting search page behavior.
010546| src/components/SearchForm.tsx:267: 
010547| NOTE: Blank line for visual separation.
010548| src/components/SearchForm.tsx:268:   // Sync drawer open state to context
010549| NOTE: Line comment documents intent or constraints.
010550| src/components/SearchForm.tsx:269:   useEffect(() => {
010551| NOTE: Defines side effect for syncing with external state.
010552| src/components/SearchForm.tsx:270:     if (filterStateContext) {
010553| NOTE: Conditional logic controlling rendering or flow.
010554| src/components/SearchForm.tsx:271:       filterStateContext.setDrawerOpen(showFilters);
010555| NOTE: Implementation detail supporting search page behavior.
010556| src/components/SearchForm.tsx:272:     }
010557| NOTE: Implementation detail supporting search page behavior.
010558| src/components/SearchForm.tsx:273:   }, [filterStateContext, showFilters]);
010559| NOTE: Implementation detail supporting search page behavior.
010560| src/components/SearchForm.tsx:274: 
010561| NOTE: Blank line for visual separation.
010562| src/components/SearchForm.tsx:275:   // Register callback to open drawer from external components
010563| NOTE: Line comment documents intent or constraints.
010564| src/components/SearchForm.tsx:276:   useEffect(() => {
010565| NOTE: Defines side effect for syncing with external state.
010566| src/components/SearchForm.tsx:277:     if (filterStateContext) {
010567| NOTE: Conditional logic controlling rendering or flow.
010568| src/components/SearchForm.tsx:278:       filterStateContext.registerOpenDrawer(() => setShowFilters(true));
010569| NOTE: Implementation detail supporting search page behavior.
010570| src/components/SearchForm.tsx:279:     }
010571| NOTE: Implementation detail supporting search page behavior.
010572| src/components/SearchForm.tsx:280:   }, [filterStateContext]);
010573| NOTE: Implementation detail supporting search page behavior.
010574| src/components/SearchForm.tsx:281: 
010575| NOTE: Blank line for visual separation.
010576| src/components/SearchForm.tsx:282:   // Register callback to open filters from collapsed mobile header
010577| NOTE: Line comment documents intent or constraints.
010578| src/components/SearchForm.tsx:283:   // Destructure only the function needed to avoid infinite re-render loops
010579| NOTE: Line comment documents intent or constraints.
010580| src/components/SearchForm.tsx:284:   const { registerOpenFilters } = useMobileSearch();
010581| NOTE: Local declaration used by search logic or UI.
010582| src/components/SearchForm.tsx:285:   useEffect(() => {
010583| NOTE: Defines side effect for syncing with external state.
010584| src/components/SearchForm.tsx:286:     registerOpenFilters(() => setShowFilters(true));
010585| NOTE: Implementation detail supporting search page behavior.
010586| src/components/SearchForm.tsx:287:   }, [registerOpenFilters]);
010587| NOTE: Implementation detail supporting search page behavior.
010588| src/components/SearchForm.tsx:288: 
010589| NOTE: Blank line for visual separation.
010590| src/components/SearchForm.tsx:289:   // Local price state for main search bar (synced from batched filters)
010591| NOTE: Line comment documents intent or constraints.
010592| src/components/SearchForm.tsx:290:   // This allows the main form to show/edit price while keeping batched logic
010593| NOTE: Line comment documents intent or constraints.
010594| src/components/SearchForm.tsx:291:   const [localMinPrice, setLocalMinPrice] = useState(batchedFilters.minPrice);
010595| NOTE: Initializes local state for search UI behavior.
010596| src/components/SearchForm.tsx:292:   const [localMaxPrice, setLocalMaxPrice] = useState(batchedFilters.maxPrice);
010597| NOTE: Initializes local state for search UI behavior.
010598| src/components/SearchForm.tsx:293: 
010599| NOTE: Blank line for visual separation.
010600| src/components/SearchForm.tsx:294:   // Sync local price with batched filters when URL changes
010601| NOTE: Line comment documents intent or constraints.
010602| src/components/SearchForm.tsx:295:   useEffect(() => {
010603| NOTE: Defines side effect for syncing with external state.
010604| src/components/SearchForm.tsx:296:     setLocalMinPrice(committedFilters.minPrice);
010605| NOTE: Implementation detail supporting search page behavior.
010606| src/components/SearchForm.tsx:297:     setLocalMaxPrice(committedFilters.maxPrice);
010607| NOTE: Implementation detail supporting search page behavior.
010608| src/components/SearchForm.tsx:298:   }, [committedFilters.minPrice, committedFilters.maxPrice]);
010609| NOTE: Implementation detail supporting search page behavior.
010610| src/components/SearchForm.tsx:299: 
010611| NOTE: Blank line for visual separation.
010612| src/components/SearchForm.tsx:300:   const [hasMounted, setHasMounted] = useState(false);
010613| NOTE: Initializes local state for search UI behavior.
010614| src/components/SearchForm.tsx:301: 
010615| NOTE: Blank line for visual separation.
010616| src/components/SearchForm.tsx:302:   // Language search filter state
010617| NOTE: Line comment documents intent or constraints.
010618| src/components/SearchForm.tsx:303:   const [languageSearch, setLanguageSearch] = useState("");
010619| NOTE: Initializes local state for search UI behavior.
010620| src/components/SearchForm.tsx:304: 
010621| NOTE: Blank line for visual separation.
010622| src/components/SearchForm.tsx:305:   // Get all language codes from canonical list
010623| NOTE: Line comment documents intent or constraints.
010624| src/components/SearchForm.tsx:306:   const LANGUAGE_CODES = Object.keys(SUPPORTED_LANGUAGES) as LanguageCode[];
010625| NOTE: Local declaration used by search logic or UI.
010626| src/components/SearchForm.tsx:307: 
010627| NOTE: Blank line for visual separation.
010628| src/components/SearchForm.tsx:308:   // Filter languages based on search
010629| NOTE: Line comment documents intent or constraints.
010630| src/components/SearchForm.tsx:309:   const filteredLanguages = useMemo(() => {
010631| NOTE: Memoizes derived values to reduce re-render work.
010632| src/components/SearchForm.tsx:310:     if (!languageSearch.trim()) return LANGUAGE_CODES;
010633| NOTE: Conditional logic controlling rendering or flow.
010634| src/components/SearchForm.tsx:311:     const search = languageSearch.toLowerCase();
010635| NOTE: Local declaration used by search logic or UI.
010636| src/components/SearchForm.tsx:312:     return LANGUAGE_CODES.filter(
010637| NOTE: Return statement for component or helper output.
010638| src/components/SearchForm.tsx:313:       (code) =>
010639| NOTE: Implementation detail supporting search page behavior.
010640| src/components/SearchForm.tsx:314:         getLanguageName(code).toLowerCase().includes(search) ||
010641| NOTE: Implementation detail supporting search page behavior.
010642| src/components/SearchForm.tsx:315:         code.toLowerCase().includes(search),
010643| NOTE: Implementation detail supporting search page behavior.
010644| src/components/SearchForm.tsx:316:     );
010645| NOTE: Implementation detail supporting search page behavior.
010646| src/components/SearchForm.tsx:317:   }, [languageSearch]);
010647| NOTE: Implementation detail supporting search page behavior.
010648| src/components/SearchForm.tsx:318: 
010649| NOTE: Blank line for visual separation.
010650| src/components/SearchForm.tsx:319:   // Debounce and submission state to prevent race conditions
010651| NOTE: Line comment documents intent or constraints.
010652| src/components/SearchForm.tsx:320:   const [isSearching, setIsSearching] = useState(false);
010653| NOTE: Initializes local state for search UI behavior.
010654| src/components/SearchForm.tsx:321:   const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);
010655| NOTE: Uses ref for stable mutable storage between renders.
010656| src/components/SearchForm.tsx:322:   const lastSearchRef = useRef<string>(""); // Track last search to prevent duplicates
010657| NOTE: Uses ref for stable mutable storage between renders.
010658| src/components/SearchForm.tsx:323: 
010659| NOTE: Blank line for visual separation.
010660| src/components/SearchForm.tsx:324:   // Recent searches hook (P2-11)
010661| NOTE: Line comment documents intent or constraints.
010662| src/components/SearchForm.tsx:325:   const {
010663| NOTE: Local declaration used by search logic or UI.
010664| src/components/SearchForm.tsx:326:     recentSearches,
010665| NOTE: Implementation detail supporting search page behavior.
010666| src/components/SearchForm.tsx:327:     saveRecentSearch,
010667| NOTE: Implementation detail supporting search page behavior.
010668| src/components/SearchForm.tsx:328:     clearRecentSearches,
010669| NOTE: Implementation detail supporting search page behavior.
010670| src/components/SearchForm.tsx:329:     getFilterSummary,
010671| NOTE: Implementation detail supporting search page behavior.
010672| src/components/SearchForm.tsx:330:   } = useRecentSearches();
010673| NOTE: Implementation detail supporting search page behavior.
010674| src/components/SearchForm.tsx:331:   const [showRecentSearches, setShowRecentSearches] = useState(false);
010675| NOTE: Initializes local state for search UI behavior.
010676| src/components/SearchForm.tsx:332: 
010677| NOTE: Blank line for visual separation.
010678| src/components/SearchForm.tsx:333:   // Ref for programmatic focus on location search input (keyboard shortcuts)
010679| NOTE: Line comment documents intent or constraints.
010680| src/components/SearchForm.tsx:334:   const locationInputRef = useRef<LocationSearchInputRef>(null);
010681| NOTE: Uses ref for stable mutable storage between renders.
010682| src/components/SearchForm.tsx:335: 
010683| NOTE: Blank line for visual separation.
010684| src/components/SearchForm.tsx:336:   // Select a recent search - applies location, coords, and optionally filters
010685| NOTE: Line comment documents intent or constraints.
010686| src/components/SearchForm.tsx:337:   const selectRecentSearch = useCallback(
010687| NOTE: Memoizes callback to preserve references across renders.
010688| src/components/SearchForm.tsx:338:     (search: RecentSearch) => {
010689| NOTE: Implementation detail supporting search page behavior.
010690| src/components/SearchForm.tsx:339:       setLocation(search.location);
010691| NOTE: Implementation detail supporting search page behavior.
010692| src/components/SearchForm.tsx:340:       if (search.coords) {
010693| NOTE: Conditional logic controlling rendering or flow.
010694| src/components/SearchForm.tsx:341:         setSelectedCoords(search.coords);
010695| NOTE: Implementation detail supporting search page behavior.
010696| src/components/SearchForm.tsx:342:       }
010697| NOTE: Implementation detail supporting search page behavior.
010698| src/components/SearchForm.tsx:343:       // Optionally restore filters from the recent search
010699| NOTE: Line comment documents intent or constraints.
010700| src/components/SearchForm.tsx:344:       // This is a UX choice - we restore filters if they were saved
010701| NOTE: Line comment documents intent or constraints.
010702| src/components/SearchForm.tsx:345:       if (search.filters) {
010703| NOTE: Conditional logic controlling rendering or flow.
010704| src/components/SearchForm.tsx:346:         if (search.filters.minPrice) setLocalMinPrice(search.filters.minPrice);
010705| NOTE: Conditional logic controlling rendering or flow.
010706| src/components/SearchForm.tsx:347:         if (search.filters.maxPrice) setLocalMaxPrice(search.filters.maxPrice);
010707| NOTE: Conditional logic controlling rendering or flow.
010708| src/components/SearchForm.tsx:348:         // Note: For batched filters, we'd need to call setBatchedFilter for each
010709| NOTE: Line comment documents intent or constraints.
010710| src/components/SearchForm.tsx:349:         // but that could be jarring UX. For now, just restore location/coords.
010711| NOTE: Line comment documents intent or constraints.
010712| src/components/SearchForm.tsx:350:       }
010713| NOTE: Implementation detail supporting search page behavior.
010714| src/components/SearchForm.tsx:351:       setShowRecentSearches(false);
010715| NOTE: Implementation detail supporting search page behavior.
010716| src/components/SearchForm.tsx:352:     },
010717| NOTE: Implementation detail supporting search page behavior.
010718| src/components/SearchForm.tsx:353:     [setLocalMinPrice, setLocalMaxPrice],
010719| NOTE: Implementation detail supporting search page behavior.
010720| src/components/SearchForm.tsx:354:   );
010721| NOTE: Implementation detail supporting search page behavior.
010722| src/components/SearchForm.tsx:355: 
010723| NOTE: Blank line for visual separation.
010724| src/components/SearchForm.tsx:356:   // Set hasMounted after initial render
010725| NOTE: Line comment documents intent or constraints.
010726| src/components/SearchForm.tsx:357:   useEffect(() => {
010727| NOTE: Defines side effect for syncing with external state.
010728| src/components/SearchForm.tsx:358:     setHasMounted(true);
010729| NOTE: Implementation detail supporting search page behavior.
010730| src/components/SearchForm.tsx:359:   }, []);
010731| NOTE: Implementation detail supporting search page behavior.
010732| src/components/SearchForm.tsx:360: 
010733| NOTE: Blank line for visual separation.
010734| src/components/SearchForm.tsx:361:   // Sync non-batched state with URL params when they change (e.g., after navigation)
010735| NOTE: Line comment documents intent or constraints.
010736| src/components/SearchForm.tsx:362:   // Note: Batched filters are automatically synced by useBatchedFilters hook
010737| NOTE: Line comment documents intent or constraints.
010738| src/components/SearchForm.tsx:363:   useEffect(() => {
010739| NOTE: Defines side effect for syncing with external state.
010740| src/components/SearchForm.tsx:364:     const coords = parseCoords();
010741| NOTE: Local declaration used by search logic or UI.
010742| src/components/SearchForm.tsx:365:     if (coords) {
010743| NOTE: Conditional logic controlling rendering or flow.
010744| src/components/SearchForm.tsx:366:       setSelectedCoords(coords);
010745| NOTE: Implementation detail supporting search page behavior.
010746| src/components/SearchForm.tsx:367:     }
010747| NOTE: Implementation detail supporting search page behavior.
010748| src/components/SearchForm.tsx:368:     // Only sync location - batched filters handled by hook
010749| NOTE: Line comment documents intent or constraints.
010750| src/components/SearchForm.tsx:369:     setLocation(searchParams.get("q") || "");
010751| NOTE: Implementation detail supporting search page behavior.
010752| src/components/SearchForm.tsx:370:   }, [searchParams]);
010753| NOTE: Implementation detail supporting search page behavior.
010754| src/components/SearchForm.tsx:371: 
010755| NOTE: Blank line for visual separation.
010756| src/components/SearchForm.tsx:372:   const router = useRouter();
010757| NOTE: Local declaration used by search logic or UI.
010758| src/components/SearchForm.tsx:373:   const transitionContext = useSearchTransitionSafe();
010759| NOTE: Local declaration used by search logic or UI.
010760| src/components/SearchForm.tsx:374:   // Use transition-aware navigation when available, fallback to router
010761| NOTE: Line comment documents intent or constraints.
010762| src/components/SearchForm.tsx:375:   const navigate = useCallback(
010763| NOTE: Memoizes callback to preserve references across renders.
010764| src/components/SearchForm.tsx:376:     (url: string) => {
010765| NOTE: Implementation detail supporting search page behavior.
010766| src/components/SearchForm.tsx:377:       if (transitionContext) {
010767| NOTE: Conditional logic controlling rendering or flow.
010768| src/components/SearchForm.tsx:378:         transitionContext.navigateWithTransition(url);
010769| NOTE: Routing logic updates search URL state.
010770| src/components/SearchForm.tsx:379:       } else {
010771| NOTE: Implementation detail supporting search page behavior.
010772| src/components/SearchForm.tsx:380:         router.push(url, { scroll: false });
010773| NOTE: Routing logic updates search URL state.
010774| src/components/SearchForm.tsx:381:       }
010775| NOTE: Implementation detail supporting search page behavior.
010776| src/components/SearchForm.tsx:382:     },
010777| NOTE: Implementation detail supporting search page behavior.
010778| src/components/SearchForm.tsx:383:     [transitionContext, router],
010779| NOTE: Implementation detail supporting search page behavior.
010780| src/components/SearchForm.tsx:384:   );
010781| NOTE: Implementation detail supporting search page behavior.
010782| src/components/SearchForm.tsx:385: 
010783| NOTE: Blank line for visual separation.
010784| src/components/SearchForm.tsx:386:   // Get current sort from URL for mobile filter drawer
010785| NOTE: Line comment documents intent or constraints.
010786| src/components/SearchForm.tsx:387:   const currentSort = (searchParams.get("sort") as SortOption) || "recommended";
010787| NOTE: Local declaration used by search logic or UI.
010788| src/components/SearchForm.tsx:388: 
010789| NOTE: Blank line for visual separation.
010790| src/components/SearchForm.tsx:389:   // Handle sort change (instant apply like desktop)
010791| NOTE: Line comment documents intent or constraints.
010792| src/components/SearchForm.tsx:390:   const handleSortChange = useCallback(
010793| NOTE: Memoizes callback to preserve references across renders.
010794| src/components/SearchForm.tsx:391:     (newSort: SortOption) => {
010795| NOTE: Implementation detail supporting search page behavior.
010796| src/components/SearchForm.tsx:392:       const params = new URLSearchParams(searchParams.toString());
010797| NOTE: Local declaration used by search logic or UI.
010798| src/components/SearchForm.tsx:393:       if (newSort === "recommended") {
010799| NOTE: Conditional logic controlling rendering or flow.
010800| src/components/SearchForm.tsx:394:         params.delete("sort");
010801| NOTE: Implementation detail supporting search page behavior.
010802| src/components/SearchForm.tsx:395:       } else {
010803| NOTE: Implementation detail supporting search page behavior.
010804| src/components/SearchForm.tsx:396:         params.set("sort", newSort);
010805| NOTE: Implementation detail supporting search page behavior.
010806| src/components/SearchForm.tsx:397:       }
010807| NOTE: Implementation detail supporting search page behavior.
010808| src/components/SearchForm.tsx:398:       // Reset to page 1 when sorting changes
010809| NOTE: Line comment documents intent or constraints.
010810| src/components/SearchForm.tsx:399:       params.delete("page");
010811| NOTE: Implementation detail supporting search page behavior.
010812| src/components/SearchForm.tsx:400:       navigate(`/search?${params.toString()}`);
010813| NOTE: Routing logic updates search URL state.
010814| src/components/SearchForm.tsx:401:     },
010815| NOTE: Implementation detail supporting search page behavior.
010816| src/components/SearchForm.tsx:402:     [searchParams, navigate],
010817| NOTE: Routing logic updates search URL state.
010818| src/components/SearchForm.tsx:403:   );
010819| NOTE: Implementation detail supporting search page behavior.
010820| src/components/SearchForm.tsx:404: 
010821| NOTE: Blank line for visual separation.
010822| src/components/SearchForm.tsx:405:   const handleLocationSelect = (locationData: {
010823| NOTE: Local declaration used by search logic or UI.
010824| src/components/SearchForm.tsx:406:     name: string;
010825| NOTE: Implementation detail supporting search page behavior.
010826| src/components/SearchForm.tsx:407:     lat: number;
010827| NOTE: Implementation detail supporting search page behavior.
010828| src/components/SearchForm.tsx:408:     lng: number;
010829| NOTE: Implementation detail supporting search page behavior.
010830| src/components/SearchForm.tsx:409:     bbox?: [number, number, number, number];
010831| NOTE: Implementation detail supporting search page behavior.
010832| src/components/SearchForm.tsx:410:   }) => {
010833| NOTE: Implementation detail supporting search page behavior.
010834| src/components/SearchForm.tsx:411:     setSelectedCoords({
010835| NOTE: Implementation detail supporting search page behavior.
010836| src/components/SearchForm.tsx:412:       lat: locationData.lat,
010837| NOTE: Implementation detail supporting search page behavior.
010838| src/components/SearchForm.tsx:413:       lng: locationData.lng,
010839| NOTE: Implementation detail supporting search page behavior.
010840| src/components/SearchForm.tsx:414:       bbox: locationData.bbox,
010841| NOTE: Implementation detail supporting search page behavior.
010842| src/components/SearchForm.tsx:415:     });
010843| NOTE: Implementation detail supporting search page behavior.
010844| src/components/SearchForm.tsx:416: 
010845| NOTE: Blank line for visual separation.
010846| src/components/SearchForm.tsx:417:     // Dispatch custom event for map to fly to location
010847| NOTE: Line comment documents intent or constraints.
010848| src/components/SearchForm.tsx:418:     const event = new CustomEvent<MapFlyToEventDetail>(MAP_FLY_TO_EVENT, {
010849| NOTE: Local declaration used by search logic or UI.
010850| src/components/SearchForm.tsx:419:       detail: {
010851| NOTE: Implementation detail supporting search page behavior.
010852| src/components/SearchForm.tsx:420:         lat: locationData.lat,
010853| NOTE: Implementation detail supporting search page behavior.
010854| src/components/SearchForm.tsx:421:         lng: locationData.lng,
010855| NOTE: Implementation detail supporting search page behavior.
010856| src/components/SearchForm.tsx:422:         bbox: locationData.bbox,
010857| NOTE: Implementation detail supporting search page behavior.
010858| src/components/SearchForm.tsx:423:         zoom: 13,
010859| NOTE: Implementation detail supporting search page behavior.
010860| src/components/SearchForm.tsx:424:         locationName: locationData.name,
010861| NOTE: Implementation detail supporting search page behavior.
010862| src/components/SearchForm.tsx:425:       },
010863| NOTE: Implementation detail supporting search page behavior.
010864| src/components/SearchForm.tsx:426:     });
010865| NOTE: Implementation detail supporting search page behavior.
010866| src/components/SearchForm.tsx:427:     window.dispatchEvent(event);
010867| NOTE: Implementation detail supporting search page behavior.
010868| src/components/SearchForm.tsx:428:   };
010869| NOTE: Implementation detail supporting search page behavior.
010870| src/components/SearchForm.tsx:429: 
010871| NOTE: Blank line for visual separation.
010872| src/components/SearchForm.tsx:430:   // Build URL params from filter values (used by both main search and drawer apply)
010873| NOTE: Line comment documents intent or constraints.
010874| src/components/SearchForm.tsx:431:   const buildSearchParams = useCallback(
010875| NOTE: Memoizes callback to preserve references across renders.
010876| src/components/SearchForm.tsx:432:     (filterValues: {
010877| NOTE: Implementation detail supporting search page behavior.
010878| src/components/SearchForm.tsx:433:       minPrice: string;
010879| NOTE: Implementation detail supporting search page behavior.
010880| src/components/SearchForm.tsx:434:       maxPrice: string;
010881| NOTE: Implementation detail supporting search page behavior.
010882| src/components/SearchForm.tsx:435:       moveInDate: string;
010883| NOTE: Implementation detail supporting search page behavior.
010884| src/components/SearchForm.tsx:436:       leaseDuration: string;
010885| NOTE: Implementation detail supporting search page behavior.
010886| src/components/SearchForm.tsx:437:       roomType: string;
010887| NOTE: Implementation detail supporting search page behavior.
010888| src/components/SearchForm.tsx:438:       amenities: string[];
010889| NOTE: Implementation detail supporting search page behavior.
010890| src/components/SearchForm.tsx:439:       houseRules: string[];
010891| NOTE: Implementation detail supporting search page behavior.
010892| src/components/SearchForm.tsx:440:       languages: string[];
010893| NOTE: Implementation detail supporting search page behavior.
010894| src/components/SearchForm.tsx:441:     }) => {
010895| NOTE: Implementation detail supporting search page behavior.
010896| src/components/SearchForm.tsx:442:       const params = new URLSearchParams();
010897| NOTE: Local declaration used by search logic or UI.
010898| src/components/SearchForm.tsx:443: 
010899| NOTE: Blank line for visual separation.
010900| src/components/SearchForm.tsx:444:       // Preserve existing sort parameter from URL
010901| NOTE: Line comment documents intent or constraints.
010902| src/components/SearchForm.tsx:445:       const existingSort = searchParams.get("sort");
010903| NOTE: Local declaration used by search logic or UI.
010904| src/components/SearchForm.tsx:446:       if (
010905| NOTE: Conditional logic controlling rendering or flow.
010906| src/components/SearchForm.tsx:447:         existingSort &&
010907| NOTE: Implementation detail supporting search page behavior.
010908| src/components/SearchForm.tsx:448:         ["recommended", "price_asc", "price_desc", "newest", "rating"].includes(
010909| NOTE: Implementation detail supporting search page behavior.
010910| src/components/SearchForm.tsx:449:           existingSort,
010911| NOTE: Implementation detail supporting search page behavior.
010912| src/components/SearchForm.tsx:450:         )
010913| NOTE: Implementation detail supporting search page behavior.
010914| src/components/SearchForm.tsx:451:       ) {
010915| NOTE: Implementation detail supporting search page behavior.
010916| src/components/SearchForm.tsx:452:         params.set("sort", existingSort);
010917| NOTE: Implementation detail supporting search page behavior.
010918| src/components/SearchForm.tsx:453:       }
010919| NOTE: Implementation detail supporting search page behavior.
010920| src/components/SearchForm.tsx:454: 
010921| NOTE: Blank line for visual separation.
010922| src/components/SearchForm.tsx:455:       // Only include query if it has actual content (not just whitespace)
010923| NOTE: Line comment documents intent or constraints.
010924| src/components/SearchForm.tsx:456:       const trimmedLocation = location.trim();
010925| NOTE: Local declaration used by search logic or UI.
010926| src/components/SearchForm.tsx:457:       if (trimmedLocation && trimmedLocation.length >= 2) {
010927| NOTE: Conditional logic controlling rendering or flow.
010928| src/components/SearchForm.tsx:458:         params.set("q", trimmedLocation);
010929| NOTE: Implementation detail supporting search page behavior.
010930| src/components/SearchForm.tsx:459:       }
010931| NOTE: Implementation detail supporting search page behavior.
010932| src/components/SearchForm.tsx:460: 
010933| NOTE: Blank line for visual separation.
010934| src/components/SearchForm.tsx:461:       // Price validation with auto-swap if inverted
010935| NOTE: Line comment documents intent or constraints.
010936| src/components/SearchForm.tsx:462:       let finalMinPrice = filterValues.minPrice
010937| NOTE: Local declaration used by search logic or UI.
010938| src/components/SearchForm.tsx:463:         ? parseFloat(filterValues.minPrice)
010939| NOTE: Implementation detail supporting search page behavior.
010940| src/components/SearchForm.tsx:464:         : null;
010941| NOTE: Implementation detail supporting search page behavior.
010942| src/components/SearchForm.tsx:465:       let finalMaxPrice = filterValues.maxPrice
010943| NOTE: Local declaration used by search logic or UI.
010944| src/components/SearchForm.tsx:466:         ? parseFloat(filterValues.maxPrice)
010945| NOTE: Implementation detail supporting search page behavior.
010946| src/components/SearchForm.tsx:467:         : null;
010947| NOTE: Implementation detail supporting search page behavior.
010948| src/components/SearchForm.tsx:468: 
010949| NOTE: Blank line for visual separation.
010950| src/components/SearchForm.tsx:469:       // Enforce non-negative values
010951| NOTE: Line comment documents intent or constraints.
010952| src/components/SearchForm.tsx:470:       if (finalMinPrice !== null && finalMinPrice < 0) finalMinPrice = 0;
010953| NOTE: Conditional logic controlling rendering or flow.
010954| src/components/SearchForm.tsx:471:       if (finalMaxPrice !== null && finalMaxPrice < 0) finalMaxPrice = 0;
010955| NOTE: Conditional logic controlling rendering or flow.
010956| src/components/SearchForm.tsx:472: 
010957| NOTE: Blank line for visual separation.
010958| src/components/SearchForm.tsx:473:       // Auto-swap if min > max
010959| NOTE: Line comment documents intent or constraints.
010960| src/components/SearchForm.tsx:474:       if (
010961| NOTE: Conditional logic controlling rendering or flow.
010962| src/components/SearchForm.tsx:475:         finalMinPrice !== null &&
010963| NOTE: Implementation detail supporting search page behavior.
010964| src/components/SearchForm.tsx:476:         finalMaxPrice !== null &&
010965| NOTE: Implementation detail supporting search page behavior.
010966| src/components/SearchForm.tsx:477:         finalMinPrice > finalMaxPrice
010967| NOTE: Implementation detail supporting search page behavior.
010968| src/components/SearchForm.tsx:478:       ) {
010969| NOTE: Implementation detail supporting search page behavior.
010970| src/components/SearchForm.tsx:479:         [finalMinPrice, finalMaxPrice] = [finalMaxPrice, finalMinPrice];
010971| NOTE: Implementation detail supporting search page behavior.
010972| src/components/SearchForm.tsx:480:       }
010973| NOTE: Implementation detail supporting search page behavior.
010974| src/components/SearchForm.tsx:481: 
010975| NOTE: Blank line for visual separation.
010976| src/components/SearchForm.tsx:482:       if (finalMinPrice !== null)
010977| NOTE: Conditional logic controlling rendering or flow.
010978| src/components/SearchForm.tsx:483:         params.set("minPrice", finalMinPrice.toString());
010979| NOTE: Implementation detail supporting search page behavior.
010980| src/components/SearchForm.tsx:484:       if (finalMaxPrice !== null)
010981| NOTE: Conditional logic controlling rendering or flow.
010982| src/components/SearchForm.tsx:485:         params.set("maxPrice", finalMaxPrice.toString());
010983| NOTE: Implementation detail supporting search page behavior.
010984| src/components/SearchForm.tsx:486: 
010985| NOTE: Blank line for visual separation.
010986| src/components/SearchForm.tsx:487:       // Include coordinates if a location was selected from suggestions
010987| NOTE: Line comment documents intent or constraints.
010988| src/components/SearchForm.tsx:488:       // Only include if location text is not empty (prevents stale coords)
010989| NOTE: Line comment documents intent or constraints.
010990| src/components/SearchForm.tsx:489:       if (selectedCoords && trimmedLocation) {
010991| NOTE: Conditional logic controlling rendering or flow.
010992| src/components/SearchForm.tsx:490:         params.set("lat", selectedCoords.lat.toString());
010993| NOTE: Implementation detail supporting search page behavior.
010994| src/components/SearchForm.tsx:491:         params.set("lng", selectedCoords.lng.toString());
010995| NOTE: Implementation detail supporting search page behavior.
010996| src/components/SearchForm.tsx:492:       }
010997| NOTE: Implementation detail supporting search page behavior.
010998| src/components/SearchForm.tsx:493: 
010999| NOTE: Blank line for visual separation.
011000| src/components/SearchForm.tsx:494:       if (filterValues.moveInDate)
011001| NOTE: Conditional logic controlling rendering or flow.
011002| src/components/SearchForm.tsx:495:         params.set("moveInDate", filterValues.moveInDate);
011003| NOTE: Implementation detail supporting search page behavior.
011004| src/components/SearchForm.tsx:496:       if (filterValues.leaseDuration)
011005| NOTE: Conditional logic controlling rendering or flow.
011006| src/components/SearchForm.tsx:497:         params.set("leaseDuration", filterValues.leaseDuration);
011007| NOTE: Implementation detail supporting search page behavior.
011008| src/components/SearchForm.tsx:498:       if (filterValues.roomType) params.set("roomType", filterValues.roomType);
011009| NOTE: Conditional logic controlling rendering or flow.
011010| src/components/SearchForm.tsx:499:       filterValues.amenities.forEach((a) => params.append("amenities", a));
011011| NOTE: Implementation detail supporting search page behavior.
011012| src/components/SearchForm.tsx:500:       filterValues.houseRules.forEach((r) => params.append("houseRules", r));
011013| NOTE: Implementation detail supporting search page behavior.
011014| src/components/SearchForm.tsx:501:       filterValues.languages.forEach((l) => params.append("languages", l));
011015| NOTE: Implementation detail supporting search page behavior.
011016| src/components/SearchForm.tsx:502: 
011017| NOTE: Blank line for visual separation.
011018| src/components/SearchForm.tsx:503:       return params;
011019| NOTE: Return statement for component or helper output.
011020| src/components/SearchForm.tsx:504:     },
011021| NOTE: Implementation detail supporting search page behavior.
011022| src/components/SearchForm.tsx:505:     [searchParams, location, selectedCoords],
011023| NOTE: Implementation detail supporting search page behavior.
011024| src/components/SearchForm.tsx:506:   );
011025| NOTE: Implementation detail supporting search page behavior.
011026| src/components/SearchForm.tsx:507: 
011027| NOTE: Blank line for visual separation.
011028| src/components/SearchForm.tsx:508:   const handleSearch = useCallback(
011029| NOTE: Memoizes callback to preserve references across renders.
011030| src/components/SearchForm.tsx:509:     (e: React.FormEvent) => {
011031| NOTE: Implementation detail supporting search page behavior.
011032| src/components/SearchForm.tsx:510:       e.preventDefault();
011033| NOTE: Implementation detail supporting search page behavior.
011034| src/components/SearchForm.tsx:511: 
011035| NOTE: Blank line for visual separation.
011036| src/components/SearchForm.tsx:512:       // Clear any pending search timeout
011037| NOTE: Line comment documents intent or constraints.
011038| src/components/SearchForm.tsx:513:       if (searchTimeoutRef.current) {
011039| NOTE: Conditional logic controlling rendering or flow.
011040| src/components/SearchForm.tsx:514:         clearTimeout(searchTimeoutRef.current);
011041| NOTE: Implementation detail supporting search page behavior.
011042| src/components/SearchForm.tsx:515:       }
011043| NOTE: Implementation detail supporting search page behavior.
011044| src/components/SearchForm.tsx:516: 
011045| NOTE: Blank line for visual separation.
011046| src/components/SearchForm.tsx:517:       // Build URL from local price + committed batched filters
011047| NOTE: Line comment documents intent or constraints.
011048| src/components/SearchForm.tsx:518:       // Main form search uses committed filters, not pending (user must use Apply in drawer)
011049| NOTE: Line comment documents intent or constraints.
011050| src/components/SearchForm.tsx:519:       const params = buildSearchParams({
011051| NOTE: Local declaration used by search logic or UI.
011052| src/components/SearchForm.tsx:520:         minPrice: localMinPrice,
011053| NOTE: Implementation detail supporting search page behavior.
011054| src/components/SearchForm.tsx:521:         maxPrice: localMaxPrice,
011055| NOTE: Implementation detail supporting search page behavior.
011056| src/components/SearchForm.tsx:522:         moveInDate: committedFilters.moveInDate,
011057| NOTE: Implementation detail supporting search page behavior.
011058| src/components/SearchForm.tsx:523:         leaseDuration: committedFilters.leaseDuration,
011059| NOTE: Implementation detail supporting search page behavior.
011060| src/components/SearchForm.tsx:524:         roomType: committedFilters.roomType,
011061| NOTE: Implementation detail supporting search page behavior.
011062| src/components/SearchForm.tsx:525:         amenities: committedFilters.amenities,
011063| NOTE: Implementation detail supporting search page behavior.
011064| src/components/SearchForm.tsx:526:         houseRules: committedFilters.houseRules,
011065| NOTE: Implementation detail supporting search page behavior.
011066| src/components/SearchForm.tsx:527:         languages: committedFilters.languages,
011067| NOTE: Implementation detail supporting search page behavior.
011068| src/components/SearchForm.tsx:528:       });
011069| NOTE: Implementation detail supporting search page behavior.
011070| src/components/SearchForm.tsx:529: 
011071| NOTE: Blank line for visual separation.
011072| src/components/SearchForm.tsx:530:       const searchUrl = `/search?${params.toString()}`;
011073| NOTE: Local declaration used by search logic or UI.
011074| src/components/SearchForm.tsx:531: 
011075| NOTE: Blank line for visual separation.
011076| src/components/SearchForm.tsx:532:       // Prevent duplicate searches (same URL within debounce window)
011077| NOTE: Line comment documents intent or constraints.
011078| src/components/SearchForm.tsx:533:       if (searchUrl === lastSearchRef.current && isSearching) {
011079| NOTE: Conditional logic controlling rendering or flow.
011080| src/components/SearchForm.tsx:534:         return;
011081| NOTE: Implementation detail supporting search page behavior.
011082| src/components/SearchForm.tsx:535:       }
011083| NOTE: Implementation detail supporting search page behavior.
011084| src/components/SearchForm.tsx:536: 
011085| NOTE: Blank line for visual separation.
011086| src/components/SearchForm.tsx:537:       // Debounce the navigation to prevent race conditions
011087| NOTE: Line comment documents intent or constraints.
011088| src/components/SearchForm.tsx:538:       setIsSearching(true);
011089| NOTE: Implementation detail supporting search page behavior.
011090| src/components/SearchForm.tsx:539:       lastSearchRef.current = searchUrl;
011091| NOTE: Implementation detail supporting search page behavior.
011092| src/components/SearchForm.tsx:540: 
011093| NOTE: Blank line for visual separation.
011094| src/components/SearchForm.tsx:541:       // Save to recent searches when navigating (with filter state)
011095| NOTE: Line comment documents intent or constraints.
011096| src/components/SearchForm.tsx:542:       const trimmedLocation = location.trim();
011097| NOTE: Local declaration used by search logic or UI.
011098| src/components/SearchForm.tsx:543:       if (trimmedLocation) {
011099| NOTE: Conditional logic controlling rendering or flow.
011100| src/components/SearchForm.tsx:544:         const filters: RecentSearchFilters = {
011101| NOTE: Local declaration used by search logic or UI.
011102| src/components/SearchForm.tsx:545:           minPrice: localMinPrice || undefined,
011103| NOTE: Implementation detail supporting search page behavior.
011104| src/components/SearchForm.tsx:546:           maxPrice: localMaxPrice || undefined,
011105| NOTE: Implementation detail supporting search page behavior.
011106| src/components/SearchForm.tsx:547:           roomType: committedFilters.roomType || undefined,
011107| NOTE: Implementation detail supporting search page behavior.
011108| src/components/SearchForm.tsx:548:           leaseDuration: committedFilters.leaseDuration || undefined,
011109| NOTE: Implementation detail supporting search page behavior.
011110| src/components/SearchForm.tsx:549:           amenities:
011111| NOTE: Implementation detail supporting search page behavior.
011112| src/components/SearchForm.tsx:550:             committedFilters.amenities.length > 0
011113| NOTE: Implementation detail supporting search page behavior.
011114| src/components/SearchForm.tsx:551:               ? committedFilters.amenities
011115| NOTE: Implementation detail supporting search page behavior.
011116| src/components/SearchForm.tsx:552:               : undefined,
011117| NOTE: Implementation detail supporting search page behavior.
011118| src/components/SearchForm.tsx:553:           houseRules:
011119| NOTE: Implementation detail supporting search page behavior.
011120| src/components/SearchForm.tsx:554:             committedFilters.houseRules.length > 0
011121| NOTE: Implementation detail supporting search page behavior.
011122| src/components/SearchForm.tsx:555:               ? committedFilters.houseRules
011123| NOTE: Implementation detail supporting search page behavior.
011124| src/components/SearchForm.tsx:556:               : undefined,
011125| NOTE: Implementation detail supporting search page behavior.
011126| src/components/SearchForm.tsx:557:         };
011127| NOTE: Implementation detail supporting search page behavior.
011128| src/components/SearchForm.tsx:558:         saveRecentSearch(trimmedLocation, selectedCoords || undefined, filters);
011129| NOTE: Implementation detail supporting search page behavior.
011130| src/components/SearchForm.tsx:559:       }
011131| NOTE: Implementation detail supporting search page behavior.
011132| src/components/SearchForm.tsx:560: 
011133| NOTE: Blank line for visual separation.
011134| src/components/SearchForm.tsx:561:       // Close filter drawer on search
011135| NOTE: Line comment documents intent or constraints.
011136| src/components/SearchForm.tsx:562:       setShowFilters(false);
011137| NOTE: Implementation detail supporting search page behavior.
011138| src/components/SearchForm.tsx:563: 
011139| NOTE: Blank line for visual separation.
011140| src/components/SearchForm.tsx:564:       searchTimeoutRef.current = setTimeout(() => {
011141| NOTE: Implementation detail supporting search page behavior.
011142| src/components/SearchForm.tsx:565:         navigate(searchUrl);
011143| NOTE: Routing logic updates search URL state.
011144| src/components/SearchForm.tsx:566:         // Reset searching state after navigation starts
011145| NOTE: Line comment documents intent or constraints.
011146| src/components/SearchForm.tsx:567:         setTimeout(() => setIsSearching(false), 500);
011147| NOTE: Implementation detail supporting search page behavior.
011148| src/components/SearchForm.tsx:568:       }, SEARCH_DEBOUNCE_MS);
011149| NOTE: Implementation detail supporting search page behavior.
011150| src/components/SearchForm.tsx:569:     },
011151| NOTE: Implementation detail supporting search page behavior.
011152| src/components/SearchForm.tsx:570:     [
011153| NOTE: Implementation detail supporting search page behavior.
011154| src/components/SearchForm.tsx:571:       buildSearchParams,
011155| NOTE: Implementation detail supporting search page behavior.
011156| src/components/SearchForm.tsx:572:       localMinPrice,
011157| NOTE: Implementation detail supporting search page behavior.
011158| src/components/SearchForm.tsx:573:       localMaxPrice,
011159| NOTE: Implementation detail supporting search page behavior.
011160| src/components/SearchForm.tsx:574:       committedFilters,
011161| NOTE: Implementation detail supporting search page behavior.
011162| src/components/SearchForm.tsx:575:       location,
011163| NOTE: Implementation detail supporting search page behavior.
011164| src/components/SearchForm.tsx:576:       selectedCoords,
011165| NOTE: Implementation detail supporting search page behavior.
011166| src/components/SearchForm.tsx:577:       navigate,
011167| NOTE: Routing logic updates search URL state.
011168| src/components/SearchForm.tsx:578:       isSearching,
011169| NOTE: Implementation detail supporting search page behavior.
011170| src/components/SearchForm.tsx:579:       saveRecentSearch,
011171| NOTE: Implementation detail supporting search page behavior.
011172| src/components/SearchForm.tsx:580:     ],
011173| NOTE: Implementation detail supporting search page behavior.
011174| src/components/SearchForm.tsx:581:   );
011175| NOTE: Implementation detail supporting search page behavior.
011176| src/components/SearchForm.tsx:582: 
011177| NOTE: Blank line for visual separation.
011178| src/components/SearchForm.tsx:583:   // Handle Apply button in filter drawer - uses pending (batched) filter values
011179| NOTE: Line comment documents intent or constraints.
011180| src/components/SearchForm.tsx:584:   const handleApplyFilters = useCallback(() => {
011181| NOTE: Memoizes callback to preserve references across renders.
011182| src/components/SearchForm.tsx:585:     // Get pending filter values
011183| NOTE: Line comment documents intent or constraints.
011184| src/components/SearchForm.tsx:586:     const pendingValues = applyBatchedFilters();
011185| NOTE: Local declaration used by search logic or UI.
011186| src/components/SearchForm.tsx:587: 
011187| NOTE: Blank line for visual separation.
011188| src/components/SearchForm.tsx:588:     // Build URL from pending batched filters
011189| NOTE: Line comment documents intent or constraints.
011190| src/components/SearchForm.tsx:589:     const params = buildSearchParams(pendingValues);
011191| NOTE: Local declaration used by search logic or UI.
011192| src/components/SearchForm.tsx:590:     const searchUrl = `/search?${params.toString()}`;
011193| NOTE: Local declaration used by search logic or UI.
011194| src/components/SearchForm.tsx:591: 
011195| NOTE: Blank line for visual separation.
011196| src/components/SearchForm.tsx:592:     // Close filter drawer
011197| NOTE: Line comment documents intent or constraints.
011198| src/components/SearchForm.tsx:593:     setShowFilters(false);
011199| NOTE: Implementation detail supporting search page behavior.
011200| src/components/SearchForm.tsx:594: 
011201| NOTE: Blank line for visual separation.
011202| src/components/SearchForm.tsx:595:     // Navigate with transition
011203| NOTE: Line comment documents intent or constraints.
011204| src/components/SearchForm.tsx:596:     navigate(searchUrl);
011205| NOTE: Routing logic updates search URL state.
011206| src/components/SearchForm.tsx:597:   }, [applyBatchedFilters, buildSearchParams, navigate]);
011207| NOTE: Routing logic updates search URL state.
011208| src/components/SearchForm.tsx:598: 
011209| NOTE: Blank line for visual separation.
011210| src/components/SearchForm.tsx:599:   // Handle Reset button in filter drawer
011211| NOTE: Line comment documents intent or constraints.
011212| src/components/SearchForm.tsx:600:   const handleResetFilters = useCallback(() => {
011213| NOTE: Memoizes callback to preserve references across renders.
011214| src/components/SearchForm.tsx:601:     resetBatchedFilters();
011215| NOTE: Implementation detail supporting search page behavior.
011216| src/components/SearchForm.tsx:602:   }, [resetBatchedFilters]);
011217| NOTE: Implementation detail supporting search page behavior.
011218| src/components/SearchForm.tsx:603: 
011219| NOTE: Blank line for visual separation.
011220| src/components/SearchForm.tsx:604:   // Keyboard shortcuts (P2-12)
011221| NOTE: Line comment documents intent or constraints.
011222| src/components/SearchForm.tsx:605:   useKeyboardShortcuts([
011223| NOTE: Implementation detail supporting search page behavior.
011224| src/components/SearchForm.tsx:606:     {
011225| NOTE: Implementation detail supporting search page behavior.
011226| src/components/SearchForm.tsx:607:       ...SEARCH_SHORTCUTS.FOCUS_SEARCH,
011227| NOTE: Implementation detail supporting search page behavior.
011228| src/components/SearchForm.tsx:608:       action: () => locationInputRef.current?.focus(),
011229| NOTE: Implementation detail supporting search page behavior.
011230| src/components/SearchForm.tsx:609:     },
011231| NOTE: Implementation detail supporting search page behavior.
011232| src/components/SearchForm.tsx:610:     {
011233| NOTE: Implementation detail supporting search page behavior.
011234| src/components/SearchForm.tsx:611:       ...SEARCH_SHORTCUTS.CLOSE,
011235| NOTE: Implementation detail supporting search page behavior.
011236| src/components/SearchForm.tsx:612:       action: () => setShowFilters(false),
011237| NOTE: Implementation detail supporting search page behavior.
011238| src/components/SearchForm.tsx:613:       disabled: !showFilters, // Only active when drawer is open
011239| NOTE: Implementation detail supporting search page behavior.
011240| src/components/SearchForm.tsx:614:     },
011241| NOTE: Implementation detail supporting search page behavior.
011242| src/components/SearchForm.tsx:615:     {
011243| NOTE: Implementation detail supporting search page behavior.
011244| src/components/SearchForm.tsx:616:       ...SEARCH_SHORTCUTS.APPLY_FILTERS,
011245| NOTE: Implementation detail supporting search page behavior.
011246| src/components/SearchForm.tsx:617:       action: handleApplyFilters,
011247| NOTE: Implementation detail supporting search page behavior.
011248| src/components/SearchForm.tsx:618:       disabled: !showFilters || !filtersDirty, // Only active when drawer open with changes
011249| NOTE: Implementation detail supporting search page behavior.
011250| src/components/SearchForm.tsx:619:     },
011251| NOTE: Implementation detail supporting search page behavior.
011252| src/components/SearchForm.tsx:620:   ]);
011253| NOTE: Implementation detail supporting search page behavior.
011254| src/components/SearchForm.tsx:621: 
011255| NOTE: Blank line for visual separation.
011256| src/components/SearchForm.tsx:622:   // Cleanup timeout on unmount
011257| NOTE: Line comment documents intent or constraints.
011258| src/components/SearchForm.tsx:623:   useEffect(() => {
011259| NOTE: Defines side effect for syncing with external state.
011260| src/components/SearchForm.tsx:624:     return () => {
011261| NOTE: Return statement for component or helper output.
011262| src/components/SearchForm.tsx:625:       if (searchTimeoutRef.current) {
011263| NOTE: Conditional logic controlling rendering or flow.
011264| src/components/SearchForm.tsx:626:         clearTimeout(searchTimeoutRef.current);
011265| NOTE: Implementation detail supporting search page behavior.
011266| src/components/SearchForm.tsx:627:       }
011267| NOTE: Implementation detail supporting search page behavior.
011268| src/components/SearchForm.tsx:628:     };
011269| NOTE: Implementation detail supporting search page behavior.
011270| src/components/SearchForm.tsx:629:   }, []);
011271| NOTE: Implementation detail supporting search page behavior.
011272| src/components/SearchForm.tsx:630: 
011273| NOTE: Blank line for visual separation.
011274| src/components/SearchForm.tsx:631:   // Toggle functions now use batched filter hook
011275| NOTE: Line comment documents intent or constraints.
011276| src/components/SearchForm.tsx:632:   const toggleAmenity = useCallback(
011277| NOTE: Memoizes callback to preserve references across renders.
011278| src/components/SearchForm.tsx:633:     (amenity: string) => {
011279| NOTE: Implementation detail supporting search page behavior.
011280| src/components/SearchForm.tsx:634:       toggleBatchedArrayItem("amenities", amenity);
011281| NOTE: Implementation detail supporting search page behavior.
011282| src/components/SearchForm.tsx:635:     },
011283| NOTE: Implementation detail supporting search page behavior.
011284| src/components/SearchForm.tsx:636:     [toggleBatchedArrayItem],
011285| NOTE: Implementation detail supporting search page behavior.
011286| src/components/SearchForm.tsx:637:   );
011287| NOTE: Implementation detail supporting search page behavior.
011288| src/components/SearchForm.tsx:638: 
011289| NOTE: Blank line for visual separation.
011290| src/components/SearchForm.tsx:639:   const toggleHouseRule = useCallback(
011291| NOTE: Memoizes callback to preserve references across renders.
011292| src/components/SearchForm.tsx:640:     (rule: string) => {
011293| NOTE: Implementation detail supporting search page behavior.
011294| src/components/SearchForm.tsx:641:       toggleBatchedArrayItem("houseRules", rule);
011295| NOTE: Implementation detail supporting search page behavior.
011296| src/components/SearchForm.tsx:642:     },
011297| NOTE: Implementation detail supporting search page behavior.
011298| src/components/SearchForm.tsx:643:     [toggleBatchedArrayItem],
011299| NOTE: Implementation detail supporting search page behavior.
011300| src/components/SearchForm.tsx:644:   );
011301| NOTE: Implementation detail supporting search page behavior.
011302| src/components/SearchForm.tsx:645: 
011303| NOTE: Blank line for visual separation.
011304| src/components/SearchForm.tsx:646:   const toggleLanguage = useCallback(
011305| NOTE: Memoizes callback to preserve references across renders.
011306| src/components/SearchForm.tsx:647:     (lang: string) => {
011307| NOTE: Implementation detail supporting search page behavior.
011308| src/components/SearchForm.tsx:648:       toggleBatchedArrayItem("languages", lang);
011309| NOTE: Implementation detail supporting search page behavior.
011310| src/components/SearchForm.tsx:649:     },
011311| NOTE: Implementation detail supporting search page behavior.
011312| src/components/SearchForm.tsx:650:     [toggleBatchedArrayItem],
011313| NOTE: Implementation detail supporting search page behavior.
011314| src/components/SearchForm.tsx:651:   );
011315| NOTE: Implementation detail supporting search page behavior.
011316| src/components/SearchForm.tsx:652: 
011317| NOTE: Blank line for visual separation.
011318| src/components/SearchForm.tsx:653:   // Clear all filters and reset to defaults
011319| NOTE: Line comment documents intent or constraints.
011320| src/components/SearchForm.tsx:654:   const handleClearAllFilters = useCallback(() => {
011321| NOTE: Memoizes callback to preserve references across renders.
011322| src/components/SearchForm.tsx:655:     setLocation("");
011323| NOTE: Implementation detail supporting search page behavior.
011324| src/components/SearchForm.tsx:656:     setLocalMinPrice("");
011325| NOTE: Implementation detail supporting search page behavior.
011326| src/components/SearchForm.tsx:657:     setLocalMaxPrice("");
011327| NOTE: Implementation detail supporting search page behavior.
011328| src/components/SearchForm.tsx:658:     setSelectedCoords(null);
011329| NOTE: Implementation detail supporting search page behavior.
011330| src/components/SearchForm.tsx:659:     // Navigate to clean search page - this will reset batched filters via URL change
011331| NOTE: Line comment documents intent or constraints.
011332| src/components/SearchForm.tsx:660:     navigate("/search");
011333| NOTE: Routing logic updates search URL state.
011334| src/components/SearchForm.tsx:661:   }, [navigate]);
011335| NOTE: Routing logic updates search URL state.
011336| src/components/SearchForm.tsx:662: 
011337| NOTE: Blank line for visual separation.
011338| src/components/SearchForm.tsx:663:   // Count active filters for badge - uses committed (URL) values
011339| NOTE: Line comment documents intent or constraints.
011340| src/components/SearchForm.tsx:664:   // Split into two parts to avoid hydration mismatch
011341| NOTE: Line comment documents intent or constraints.
011342| src/components/SearchForm.tsx:665:   // Base count excludes moveInDate (no Date() calls, safe for SSR)
011343| NOTE: Line comment documents intent or constraints.
011344| src/components/SearchForm.tsx:666:   const baseFilterCount = [
011345| NOTE: Local declaration used by search logic or UI.
011346| src/components/SearchForm.tsx:667:     committedFilters.leaseDuration && committedFilters.leaseDuration !== "any",
011347| NOTE: Implementation detail supporting search page behavior.
011348| src/components/SearchForm.tsx:668:     committedFilters.roomType && committedFilters.roomType !== "any",
011349| NOTE: Implementation detail supporting search page behavior.
011350| src/components/SearchForm.tsx:669:     ...committedFilters.amenities,
011351| NOTE: Implementation detail supporting search page behavior.
011352| src/components/SearchForm.tsx:670:     ...committedFilters.houseRules,
011353| NOTE: Implementation detail supporting search page behavior.
011354| src/components/SearchForm.tsx:671:     ...committedFilters.languages,
011355| NOTE: Implementation detail supporting search page behavior.
011356| src/components/SearchForm.tsx:672:   ].filter(Boolean).length;
011357| NOTE: Implementation detail supporting search page behavior.
011358| src/components/SearchForm.tsx:673: 
011359| NOTE: Blank line for visual separation.
011360| src/components/SearchForm.tsx:674:   // moveInDate count only calculated after mount (uses Date() which differs server/client)
011361| NOTE: Line comment documents intent or constraints.
011362| src/components/SearchForm.tsx:675:   // IMPORTANT: Only call validateMoveInDate when hasMounted is true to avoid hydration mismatch
011363| NOTE: Line comment documents intent or constraints.
011364| src/components/SearchForm.tsx:676:   // The Date() comparison inside validateMoveInDate can produce different results on server vs client
011365| NOTE: Line comment documents intent or constraints.
011366| src/components/SearchForm.tsx:677:   const moveInDateCount = hasMounted
011367| NOTE: Local declaration used by search logic or UI.
011368| src/components/SearchForm.tsx:678:     ? validateMoveInDate(committedFilters.moveInDate)
011369| NOTE: Implementation detail supporting search page behavior.
011370| src/components/SearchForm.tsx:679:       ? 1
011371| NOTE: Implementation detail supporting search page behavior.
011372| src/components/SearchForm.tsx:680:       : 0
011373| NOTE: Implementation detail supporting search page behavior.
011374| src/components/SearchForm.tsx:681:     : 0;
011375| NOTE: Implementation detail supporting search page behavior.
011376| src/components/SearchForm.tsx:682:   const activeFilterCount = baseFilterCount + moveInDateCount;
011377| NOTE: Local declaration used by search logic or UI.
011378| src/components/SearchForm.tsx:683: 
011379| NOTE: Blank line for visual separation.
011380| src/components/SearchForm.tsx:684:   // Check if any filters are active (for "Clear all" button visibility)
011381| NOTE: Line comment documents intent or constraints.
011382| src/components/SearchForm.tsx:685:   const hasActiveFilters =
011383| NOTE: Local declaration used by search logic or UI.
011384| src/components/SearchForm.tsx:686:     location ||
011385| NOTE: Implementation detail supporting search page behavior.
011386| src/components/SearchForm.tsx:687:     committedFilters.minPrice ||
011387| NOTE: Implementation detail supporting search page behavior.
011388| src/components/SearchForm.tsx:688:     committedFilters.maxPrice ||
011389| NOTE: Implementation detail supporting search page behavior.
011390| src/components/SearchForm.tsx:689:     (committedFilters.leaseDuration &&
011391| NOTE: Implementation detail supporting search page behavior.
011392| src/components/SearchForm.tsx:690:       committedFilters.leaseDuration !== "any") ||
011393| NOTE: Implementation detail supporting search page behavior.
011394| src/components/SearchForm.tsx:691:     (committedFilters.roomType && committedFilters.roomType !== "any") ||
011395| NOTE: Implementation detail supporting search page behavior.
011396| src/components/SearchForm.tsx:692:     committedFilters.amenities.length > 0 ||
011397| NOTE: Implementation detail supporting search page behavior.
011398| src/components/SearchForm.tsx:693:     committedFilters.houseRules.length > 0 ||
011399| NOTE: Implementation detail supporting search page behavior.
011400| src/components/SearchForm.tsx:694:     committedFilters.languages.length > 0 ||
011401| NOTE: Implementation detail supporting search page behavior.
011402| src/components/SearchForm.tsx:695:     moveInDateCount > 0;
011403| NOTE: Implementation detail supporting search page behavior.
011404| src/components/SearchForm.tsx:696: 
011405| NOTE: Blank line for visual separation.
011406| src/components/SearchForm.tsx:697:   // Show warning when user has typed location but not selected from dropdown
011407| NOTE: Line comment documents intent or constraints.
011408| src/components/SearchForm.tsx:698:   const showLocationWarning = location.trim().length > 2 && !selectedCoords;
011409| NOTE: Local declaration used by search logic or UI.
011410| src/components/SearchForm.tsx:699: 
011411| NOTE: Blank line for visual separation.
011412| src/components/SearchForm.tsx:700:   // Handle Escape key to close filter drawer
011413| NOTE: Line comment documents intent or constraints.
011414| src/components/SearchForm.tsx:701:   useEffect(() => {
011415| NOTE: Defines side effect for syncing with external state.
011416| src/components/SearchForm.tsx:702:     const handleEscape = (e: KeyboardEvent) => {
011417| NOTE: Local declaration used by search logic or UI.
011418| src/components/SearchForm.tsx:703:       if (e.key === "Escape" && showFilters) {
011419| NOTE: Conditional logic controlling rendering or flow.
011420| src/components/SearchForm.tsx:704:         setShowFilters(false);
011421| NOTE: Implementation detail supporting search page behavior.
011422| src/components/SearchForm.tsx:705:       }
011423| NOTE: Implementation detail supporting search page behavior.
011424| src/components/SearchForm.tsx:706:     };
011425| NOTE: Implementation detail supporting search page behavior.
011426| src/components/SearchForm.tsx:707:     document.addEventListener("keydown", handleEscape);
011427| NOTE: Implementation detail supporting search page behavior.
011428| src/components/SearchForm.tsx:708:     return () => document.removeEventListener("keydown", handleEscape);
011429| NOTE: Return statement for component or helper output.
011430| src/components/SearchForm.tsx:709:   }, [showFilters]);
011431| NOTE: Implementation detail supporting search page behavior.
011432| src/components/SearchForm.tsx:710: 
011433| NOTE: Blank line for visual separation.
011434| src/components/SearchForm.tsx:711:   // Prevent body scroll when drawer is open
011435| NOTE: Line comment documents intent or constraints.
011436| src/components/SearchForm.tsx:712:   useEffect(() => {
011437| NOTE: Defines side effect for syncing with external state.
011438| src/components/SearchForm.tsx:713:     if (showFilters) {
011439| NOTE: Conditional logic controlling rendering or flow.
011440| src/components/SearchForm.tsx:714:       document.body.style.overflow = "hidden";
011441| NOTE: Implementation detail supporting search page behavior.
011442| src/components/SearchForm.tsx:715:     } else {
011443| NOTE: Implementation detail supporting search page behavior.
011444| src/components/SearchForm.tsx:716:       document.body.style.overflow = "";
011445| NOTE: Implementation detail supporting search page behavior.
011446| src/components/SearchForm.tsx:717:     }
011447| NOTE: Implementation detail supporting search page behavior.
011448| src/components/SearchForm.tsx:718:     return () => {
011449| NOTE: Return statement for component or helper output.
011450| src/components/SearchForm.tsx:719:       document.body.style.overflow = "";
011451| NOTE: Implementation detail supporting search page behavior.
011452| src/components/SearchForm.tsx:720:     };
011453| NOTE: Implementation detail supporting search page behavior.
011454| src/components/SearchForm.tsx:721:   }, [showFilters]);
011455| NOTE: Implementation detail supporting search page behavior.
011456| src/components/SearchForm.tsx:722: 
011457| NOTE: Blank line for visual separation.
011458| src/components/SearchForm.tsx:723:   const isCompact = variant === "compact";
011459| NOTE: Local declaration used by search logic or UI.
011460| src/components/SearchForm.tsx:724:   const minMoveInDate = new Date(
011461| NOTE: Local declaration used by search logic or UI.
011462| src/components/SearchForm.tsx:725:     Date.now() - new Date().getTimezoneOffset() * 60000,
011463| NOTE: Implementation detail supporting search page behavior.
011464| src/components/SearchForm.tsx:726:   )
011465| NOTE: Implementation detail supporting search page behavior.
011466| src/components/SearchForm.tsx:727:     .toISOString()
011467| NOTE: Implementation detail supporting search page behavior.
011468| src/components/SearchForm.tsx:728:     .split("T")[0];
011469| NOTE: Implementation detail supporting search page behavior.
011470| src/components/SearchForm.tsx:729: 
011471| NOTE: Blank line for visual separation.
011472| src/components/SearchForm.tsx:730:   return (
011473| NOTE: Return statement for component or helper output.
011474| src/components/SearchForm.tsx:731:     <div className={`w-full mx-auto ${isCompact ? "max-w-2xl" : "max-w-4xl"}`}>
011475| NOTE: Tailwind classes define layout and styling.
011476| src/components/SearchForm.tsx:732:       <form
011477| NOTE: JSX markup for search UI.
011478| src/components/SearchForm.tsx:733:         onSubmit={handleSearch}
011479| NOTE: Implementation detail supporting search page behavior.
011480| src/components/SearchForm.tsx:734:         className={`group relative flex flex-col md:flex-row md:items-center bg-white/90 dark:bg-zinc-900/90 backdrop-blur-xl rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08),0_12px_40px_rgba(0,0,0,0.06)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.3),0_12px_40px_rgba(0,0,0,0.2)] border border-zinc-200/80 dark:border-zinc-700/80 hover:border-zinc-300 dark:hover:border-zinc-600 hover:shadow-[0_4px_20px_rgba(0,0,0,0.1),0_16px_48px_rgba(0,0,0,0.08)] dark:hover:shadow-[0_4px_20px_rgba(0,0,0,0.3),0_16px_48px_rgba(0,0,0,0.2)] transition-all duration-200 w-full ${isCompact ? "p-1" : "p-1.5 md:p-2 md:pr-2"}`}
011481| NOTE: Tailwind classes define layout and styling.
011482| src/components/SearchForm.tsx:735:         role="search"
011483| NOTE: Implementation detail supporting search page behavior.
011484| src/components/SearchForm.tsx:736:       >
011485| NOTE: Implementation detail supporting search page behavior.
011486| src/components/SearchForm.tsx:737:         {/* Location Input with Autocomplete - Airbnb-style stacked layout */}
011487| NOTE: Implementation detail supporting search page behavior.
011488| src/components/SearchForm.tsx:738:         <div
011489| NOTE: JSX markup for search UI.
011490| src/components/SearchForm.tsx:739:           className={`w-full md:flex-1 flex flex-col relative ${isCompact ? "px-4 py-2" : "px-5 sm:px-6 py-3 md:py-2"}`}
011491| NOTE: Tailwind classes define layout and styling.
011492| src/components/SearchForm.tsx:740:         >
011493| NOTE: Implementation detail supporting search page behavior.
011494| src/components/SearchForm.tsx:741:           {!isCompact && (
011495| NOTE: Implementation detail supporting search page behavior.
011496| src/components/SearchForm.tsx:742:             <span className="text-2xs font-bold text-zinc-900 dark:text-white uppercase tracking-wider mb-1">
011497| NOTE: Tailwind classes define layout and styling.
011498| src/components/SearchForm.tsx:743:               Where
011499| NOTE: Implementation detail supporting search page behavior.
011500| src/components/SearchForm.tsx:744:             </span>
011501| NOTE: JSX markup for search UI.
011502| src/components/SearchForm.tsx:745:           )}
011503| NOTE: Implementation detail supporting search page behavior.
011504| src/components/SearchForm.tsx:746:           <LocationSearchInput
011505| NOTE: JSX markup for search UI.
011506| src/components/SearchForm.tsx:747:             ref={locationInputRef}
011507| NOTE: Implementation detail supporting search page behavior.
011508| src/components/SearchForm.tsx:748:             value={location}
011509| NOTE: Implementation detail supporting search page behavior.
011510| src/components/SearchForm.tsx:749:             onChange={(value) => {
011511| NOTE: Implementation detail supporting search page behavior.
011512| src/components/SearchForm.tsx:750:               setLocation(value);
011513| NOTE: Implementation detail supporting search page behavior.
011514| src/components/SearchForm.tsx:751:               if (selectedCoords) setSelectedCoords(null);
011515| NOTE: Conditional logic controlling rendering or flow.
011516| src/components/SearchForm.tsx:752:               setShowRecentSearches(false);
011517| NOTE: Implementation detail supporting search page behavior.
011518| src/components/SearchForm.tsx:753:             }}
011519| NOTE: Implementation detail supporting search page behavior.
011520| src/components/SearchForm.tsx:754:             onLocationSelect={(data) => {
011521| NOTE: Implementation detail supporting search page behavior.
011522| src/components/SearchForm.tsx:755:               handleLocationSelect(data);
011523| NOTE: Implementation detail supporting search page behavior.
011524| src/components/SearchForm.tsx:756:               setShowRecentSearches(false);
011525| NOTE: Implementation detail supporting search page behavior.
011526| src/components/SearchForm.tsx:757:             }}
011527| NOTE: Implementation detail supporting search page behavior.
011528| src/components/SearchForm.tsx:758:             onFocus={() => {
011529| NOTE: Implementation detail supporting search page behavior.
011530| src/components/SearchForm.tsx:759:               if (recentSearches.length > 0 && !location) {
011531| NOTE: Conditional logic controlling rendering or flow.
011532| src/components/SearchForm.tsx:760:                 setShowRecentSearches(true);
011533| NOTE: Implementation detail supporting search page behavior.
011534| src/components/SearchForm.tsx:761:               }
011535| NOTE: Implementation detail supporting search page behavior.
011536| src/components/SearchForm.tsx:762:             }}
011537| NOTE: Implementation detail supporting search page behavior.
011538| src/components/SearchForm.tsx:763:             onBlur={() => {
011539| NOTE: Implementation detail supporting search page behavior.
011540| src/components/SearchForm.tsx:764:               // Delay hiding to allow click on recent search
011541| NOTE: Line comment documents intent or constraints.
011542| src/components/SearchForm.tsx:765:               setTimeout(() => setShowRecentSearches(false), 200);
011543| NOTE: Implementation detail supporting search page behavior.
011544| src/components/SearchForm.tsx:766:             }}
011545| NOTE: Implementation detail supporting search page behavior.
011546| src/components/SearchForm.tsx:767:             placeholder="Search destinations"
011547| NOTE: Implementation detail supporting search page behavior.
011548| src/components/SearchForm.tsx:768:             className={isCompact ? "text-sm" : "text-sm"}
011549| NOTE: Tailwind classes define layout and styling.
011550| src/components/SearchForm.tsx:769:           />
011551| NOTE: Implementation detail supporting search page behavior.
011552| src/components/SearchForm.tsx:770:           {/* Query length hint - show when exactly 1 character typed */}
011553| NOTE: Implementation detail supporting search page behavior.
011554| src/components/SearchForm.tsx:771:           {location.length === 1 && (
011555| NOTE: Implementation detail supporting search page behavior.
011556| src/components/SearchForm.tsx:772:             <p className="text-xs text-zinc-500 dark:text-zinc-400 mt-1">
011557| NOTE: Tailwind classes define layout and styling.
011558| src/components/SearchForm.tsx:773:               Type 2+ characters to search
011559| NOTE: Implementation detail supporting search page behavior.
011560| src/components/SearchForm.tsx:774:             </p>
011561| NOTE: JSX markup for search UI.
011562| src/components/SearchForm.tsx:775:           )}
011563| NOTE: Implementation detail supporting search page behavior.
011564| src/components/SearchForm.tsx:776: 
011565| NOTE: Blank line for visual separation.
011566| src/components/SearchForm.tsx:777:           {/* Recent Searches Dropdown */}
011567| NOTE: Implementation detail supporting search page behavior.
011568| src/components/SearchForm.tsx:778:           {showRecentSearches && recentSearches.length > 0 && (
011569| NOTE: Implementation detail supporting search page behavior.
011570| src/components/SearchForm.tsx:779:             <div className="absolute top-full left-0 right-0 mt-2 bg-white dark:bg-zinc-900 rounded-xl shadow-lg border border-zinc-200 dark:border-zinc-700 z-50 overflow-hidden">
011571| NOTE: Tailwind classes define layout and styling.
011572| src/components/SearchForm.tsx:780:               <div className="flex items-center justify-between px-4 py-2 border-b border-zinc-100 dark:border-zinc-800">
011573| NOTE: Tailwind classes define layout and styling.
011574| src/components/SearchForm.tsx:781:                 <span className="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase">
011575| NOTE: Tailwind classes define layout and styling.
011576| src/components/SearchForm.tsx:782:                   Recent Searches
011577| NOTE: Implementation detail supporting search page behavior.
011578| src/components/SearchForm.tsx:783:                 </span>
011579| NOTE: JSX markup for search UI.
011580| src/components/SearchForm.tsx:784:                 <button
011581| NOTE: JSX markup for search UI.
011582| src/components/SearchForm.tsx:785:                   type="button"
011583| NOTE: Implementation detail supporting search page behavior.
011584| src/components/SearchForm.tsx:786:                   onClick={(e) => {
011585| NOTE: Implementation detail supporting search page behavior.
011586| src/components/SearchForm.tsx:787:                     e.preventDefault();
011587| NOTE: Implementation detail supporting search page behavior.
011588| src/components/SearchForm.tsx:788:                     e.stopPropagation();
011589| NOTE: Implementation detail supporting search page behavior.
011590| src/components/SearchForm.tsx:789:                     clearRecentSearches();
011591| NOTE: Implementation detail supporting search page behavior.
011592| src/components/SearchForm.tsx:790:                   }}
011593| NOTE: Implementation detail supporting search page behavior.
011594| src/components/SearchForm.tsx:791:                   className="text-xs text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 px-2 py-1 min-h-[44px] flex items-center"
011595| NOTE: Tailwind classes define layout and styling.
011596| src/components/SearchForm.tsx:792:                 >
011597| NOTE: Implementation detail supporting search page behavior.
011598| src/components/SearchForm.tsx:793:                   Clear
011599| NOTE: Implementation detail supporting search page behavior.
011600| src/components/SearchForm.tsx:794:                 </button>
011601| NOTE: JSX markup for search UI.
011602| src/components/SearchForm.tsx:795:               </div>
011603| NOTE: JSX markup for search UI.
011604| src/components/SearchForm.tsx:796:               <ul className="py-1">
011605| NOTE: Tailwind classes define layout and styling.
011606| src/components/SearchForm.tsx:797:                 {recentSearches.map((search) => {
011607| NOTE: Implementation detail supporting search page behavior.
011608| src/components/SearchForm.tsx:798:                   const filterSummary = getFilterSummary(search.filters);
011609| NOTE: Local declaration used by search logic or UI.
011610| src/components/SearchForm.tsx:799:                   return (
011611| NOTE: Return statement for component or helper output.
011612| src/components/SearchForm.tsx:800:                     <li key={search.id}>
011613| NOTE: JSX markup for search UI.
011614| src/components/SearchForm.tsx:801:                       <button
011615| NOTE: JSX markup for search UI.
011616| src/components/SearchForm.tsx:802:                         type="button"
011617| NOTE: Implementation detail supporting search page behavior.
011618| src/components/SearchForm.tsx:803:                         onClick={(e) => {
011619| NOTE: Implementation detail supporting search page behavior.
011620| src/components/SearchForm.tsx:804:                           e.preventDefault();
011621| NOTE: Implementation detail supporting search page behavior.
011622| src/components/SearchForm.tsx:805:                           e.stopPropagation();
011623| NOTE: Implementation detail supporting search page behavior.
011624| src/components/SearchForm.tsx:806:                           selectRecentSearch(search);
011625| NOTE: Implementation detail supporting search page behavior.
011626| src/components/SearchForm.tsx:807:                         }}
011627| NOTE: Implementation detail supporting search page behavior.
011628| src/components/SearchForm.tsx:808:                         className="w-full flex items-start gap-3 px-4 py-2.5 min-h-[44px] hover:bg-zinc-50 dark:hover:bg-zinc-800 text-left transition-colors"
011629| NOTE: Tailwind classes define layout and styling.
011630| src/components/SearchForm.tsx:809:                       >
011631| NOTE: Implementation detail supporting search page behavior.
011632| src/components/SearchForm.tsx:810:                         <Clock className="w-4 h-4 text-zinc-400 flex-shrink-0 mt-0.5" />
011633| NOTE: Tailwind classes define layout and styling.
011634| src/components/SearchForm.tsx:811:                         <div className="flex flex-col min-w-0">
011635| NOTE: Tailwind classes define layout and styling.
011636| src/components/SearchForm.tsx:812:                           <span className="text-sm text-zinc-700 dark:text-zinc-200 truncate">
011637| NOTE: Tailwind classes define layout and styling.
011638| src/components/SearchForm.tsx:813:                             {search.location}
011639| NOTE: Implementation detail supporting search page behavior.
011640| src/components/SearchForm.tsx:814:                           </span>
011641| NOTE: JSX markup for search UI.
011642| src/components/SearchForm.tsx:815:                           {filterSummary && (
011643| NOTE: Implementation detail supporting search page behavior.
011644| src/components/SearchForm.tsx:816:                             <span className="text-xs text-zinc-400 dark:text-zinc-500 truncate">
011645| NOTE: Tailwind classes define layout and styling.
011646| src/components/SearchForm.tsx:817:                               {filterSummary}
011647| NOTE: Implementation detail supporting search page behavior.
011648| src/components/SearchForm.tsx:818:                             </span>
011649| NOTE: JSX markup for search UI.
011650| src/components/SearchForm.tsx:819:                           )}
011651| NOTE: Implementation detail supporting search page behavior.
011652| src/components/SearchForm.tsx:820:                         </div>
011653| NOTE: JSX markup for search UI.
011654| src/components/SearchForm.tsx:821:                       </button>
011655| NOTE: JSX markup for search UI.
011656| src/components/SearchForm.tsx:822:                     </li>
011657| NOTE: JSX markup for search UI.
011658| src/components/SearchForm.tsx:823:                   );
011659| NOTE: Implementation detail supporting search page behavior.
011660| src/components/SearchForm.tsx:824:                 })}
011661| NOTE: Implementation detail supporting search page behavior.
011662| src/components/SearchForm.tsx:825:               </ul>
011663| NOTE: JSX markup for search UI.
011664| src/components/SearchForm.tsx:826:             </div>
011665| NOTE: JSX markup for search UI.
011666| src/components/SearchForm.tsx:827:           )}
011667| NOTE: Implementation detail supporting search page behavior.
011668| src/components/SearchForm.tsx:828:         </div>
011669| NOTE: JSX markup for search UI.
011670| src/components/SearchForm.tsx:829: 
011671| NOTE: Blank line for visual separation.
011672| src/components/SearchForm.tsx:830:         {/* Divider - Taller for better segmentation */}
011673| NOTE: Implementation detail supporting search page behavior.
011674| src/components/SearchForm.tsx:831:         <div
011675| NOTE: JSX markup for search UI.
011676| src/components/SearchForm.tsx:832:           className="hidden md:flex items-center self-stretch"
011677| NOTE: Tailwind classes define layout and styling.
011678| src/components/SearchForm.tsx:833:           aria-hidden="true"
011679| NOTE: Accessibility attribute for screen readers.
011680| src/components/SearchForm.tsx:834:         >
011681| NOTE: Implementation detail supporting search page behavior.
011682| src/components/SearchForm.tsx:835:           <div className="w-px h-10 bg-zinc-200 dark:bg-zinc-700"></div>
011683| NOTE: Tailwind classes define layout and styling.
011684| src/components/SearchForm.tsx:836:         </div>
011685| NOTE: JSX markup for search UI.
011686| src/components/SearchForm.tsx:837:         <div
011687| NOTE: JSX markup for search UI.
011688| src/components/SearchForm.tsx:838:           className="md:hidden w-[calc(100%-2rem)] mx-auto h-px bg-zinc-100 dark:bg-zinc-800"
011689| NOTE: Tailwind classes define layout and styling.
011690| src/components/SearchForm.tsx:839:           aria-hidden="true"
011691| NOTE: Accessibility attribute for screen readers.
011692| src/components/SearchForm.tsx:840:         ></div>
011693| NOTE: Implementation detail supporting search page behavior.
011694| src/components/SearchForm.tsx:841: 
011695| NOTE: Blank line for visual separation.
011696| src/components/SearchForm.tsx:842:         {/* Price Range Input - Airbnb-style stacked layout */}
011697| NOTE: Implementation detail supporting search page behavior.
011698| src/components/SearchForm.tsx:843:         <div
011699| NOTE: JSX markup for search UI.
011700| src/components/SearchForm.tsx:844:           className={`w-full md:flex-1 flex flex-col ${isCompact ? "px-4 py-2" : "px-5 sm:px-6 py-3 md:py-2"}`}
011701| NOTE: Tailwind classes define layout and styling.
011702| src/components/SearchForm.tsx:845:         >
011703| NOTE: Implementation detail supporting search page behavior.
011704| src/components/SearchForm.tsx:846:           {!isCompact && (
011705| NOTE: Implementation detail supporting search page behavior.
011706| src/components/SearchForm.tsx:847:             <label className="text-2xs font-bold text-zinc-900 dark:text-white uppercase tracking-wider mb-1">
011707| NOTE: Tailwind classes define layout and styling.
011708| src/components/SearchForm.tsx:848:               Budget
011709| NOTE: Implementation detail supporting search page behavior.
011710| src/components/SearchForm.tsx:849:             </label>
011711| NOTE: JSX markup for search UI.
011712| src/components/SearchForm.tsx:850:           )}
011713| NOTE: Implementation detail supporting search page behavior.
011714| src/components/SearchForm.tsx:851:           <div className="flex items-center gap-1.5 px-2 py-1 -mx-2 -my-1 rounded-lg transition-colors focus-within:bg-zinc-100/50 dark:focus-within:bg-zinc-800/50">
011715| NOTE: Tailwind classes define layout and styling.
011716| src/components/SearchForm.tsx:852:             <input
011717| NOTE: JSX markup for search UI.
011718| src/components/SearchForm.tsx:853:               id="search-budget-min"
011719| NOTE: Implementation detail supporting search page behavior.
011720| src/components/SearchForm.tsx:854:               type="number"
011721| NOTE: Implementation detail supporting search page behavior.
011722| src/components/SearchForm.tsx:855:               inputMode="numeric"
011723| NOTE: Implementation detail supporting search page behavior.
011724| src/components/SearchForm.tsx:856:               pattern="[0-9]*"
011725| NOTE: Implementation detail supporting search page behavior.
011726| src/components/SearchForm.tsx:857:               value={localMinPrice}
011727| NOTE: Implementation detail supporting search page behavior.
011728| src/components/SearchForm.tsx:858:               onChange={(e) => setLocalMinPrice(e.target.value)}
011729| NOTE: Implementation detail supporting search page behavior.
011730| src/components/SearchForm.tsx:859:               placeholder="Min"
011731| NOTE: Implementation detail supporting search page behavior.
011732| src/components/SearchForm.tsx:860:               className={`w-full bg-transparent border-none p-0 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-zinc-500 focus:ring-0 focus:outline-none outline-none ring-0 cursor-text appearance-none [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield] ${isCompact ? "text-sm" : "text-sm"}`}
011733| NOTE: Tailwind classes define layout and styling.
011734| src/components/SearchForm.tsx:861:               min="0"
011735| NOTE: Implementation detail supporting search page behavior.
011736| src/components/SearchForm.tsx:862:               step="50"
011737| NOTE: Implementation detail supporting search page behavior.
011738| src/components/SearchForm.tsx:863:               aria-label="Minimum budget"
011739| NOTE: Accessibility attribute for screen readers.
011740| src/components/SearchForm.tsx:864:             />
011741| NOTE: Implementation detail supporting search page behavior.
011742| src/components/SearchForm.tsx:865:             <span className="text-zinc-300 dark:text-zinc-600 text-sm">-</span>
011743| NOTE: Tailwind classes define layout and styling.
011744| src/components/SearchForm.tsx:866:             <input
011745| NOTE: JSX markup for search UI.
011746| src/components/SearchForm.tsx:867:               id="search-budget-max"
011747| NOTE: Implementation detail supporting search page behavior.
011748| src/components/SearchForm.tsx:868:               type="number"
011749| NOTE: Implementation detail supporting search page behavior.
011750| src/components/SearchForm.tsx:869:               inputMode="numeric"
011751| NOTE: Implementation detail supporting search page behavior.
011752| src/components/SearchForm.tsx:870:               pattern="[0-9]*"
011753| NOTE: Implementation detail supporting search page behavior.
011754| src/components/SearchForm.tsx:871:               value={localMaxPrice}
011755| NOTE: Implementation detail supporting search page behavior.
011756| src/components/SearchForm.tsx:872:               onChange={(e) => setLocalMaxPrice(e.target.value)}
011757| NOTE: Implementation detail supporting search page behavior.
011758| src/components/SearchForm.tsx:873:               placeholder="Max"
011759| NOTE: Implementation detail supporting search page behavior.
011760| src/components/SearchForm.tsx:874:               className={`w-full bg-transparent border-none p-0 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-zinc-500 focus:ring-0 focus:outline-none outline-none ring-0 cursor-text appearance-none [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield] ${isCompact ? "text-sm" : "text-sm"}`}
011761| NOTE: Tailwind classes define layout and styling.
011762| src/components/SearchForm.tsx:875:               min="0"
011763| NOTE: Implementation detail supporting search page behavior.
011764| src/components/SearchForm.tsx:876:               step="50"
011765| NOTE: Implementation detail supporting search page behavior.
011766| src/components/SearchForm.tsx:877:               aria-label="Maximum budget"
011767| NOTE: Accessibility attribute for screen readers.
011768| src/components/SearchForm.tsx:878:             />
011769| NOTE: Implementation detail supporting search page behavior.
011770| src/components/SearchForm.tsx:879:           </div>
011771| NOTE: JSX markup for search UI.
011772| src/components/SearchForm.tsx:880:           {/* Price validation feedback */}
011773| NOTE: Implementation detail supporting search page behavior.
011774| src/components/SearchForm.tsx:881:           {(!isValidPrice(localMinPrice) || !isValidPrice(localMaxPrice)) && (
011775| NOTE: Implementation detail supporting search page behavior.
011776| src/components/SearchForm.tsx:882:             <p
011777| NOTE: JSX markup for search UI.
011778| src/components/SearchForm.tsx:883:               className="text-xs text-red-500 dark:text-red-400 mt-1"
011779| NOTE: Tailwind classes define layout and styling.
011780| src/components/SearchForm.tsx:884:               role="alert"
011781| NOTE: Implementation detail supporting search page behavior.
011782| src/components/SearchForm.tsx:885:             >
011783| NOTE: Implementation detail supporting search page behavior.
011784| src/components/SearchForm.tsx:886:               {!isValidPrice(localMinPrice) && !isValidPrice(localMaxPrice)
011785| NOTE: Implementation detail supporting search page behavior.
011786| src/components/SearchForm.tsx:887:                 ? "Invalid min and max price"
011787| NOTE: Implementation detail supporting search page behavior.
011788| src/components/SearchForm.tsx:888:                 : !isValidPrice(localMinPrice)
011789| NOTE: Implementation detail supporting search page behavior.
011790| src/components/SearchForm.tsx:889:                   ? "Invalid min price"
011791| NOTE: Implementation detail supporting search page behavior.
011792| src/components/SearchForm.tsx:890:                   : "Invalid max price"}
011793| NOTE: Implementation detail supporting search page behavior.
011794| src/components/SearchForm.tsx:891:             </p>
011795| NOTE: JSX markup for search UI.
011796| src/components/SearchForm.tsx:892:           )}
011797| NOTE: Implementation detail supporting search page behavior.
011798| src/components/SearchForm.tsx:893:           <span id="budget-hint" className="sr-only">
011799| NOTE: Tailwind classes define layout and styling.
011800| src/components/SearchForm.tsx:894:             Enter minimum and maximum monthly budget in dollars
011801| NOTE: Implementation detail supporting search page behavior.
011802| src/components/SearchForm.tsx:895:           </span>
011803| NOTE: JSX markup for search UI.
011804| src/components/SearchForm.tsx:896:         </div>
011805| NOTE: JSX markup for search UI.
011806| src/components/SearchForm.tsx:897: 
011807| NOTE: Blank line for visual separation.
011808| src/components/SearchForm.tsx:898:         {/* Filters Toggle */}
011809| NOTE: Implementation detail supporting search page behavior.
011810| src/components/SearchForm.tsx:899:         {!isCompact && (
011811| NOTE: Implementation detail supporting search page behavior.
011812| src/components/SearchForm.tsx:900:           <>
011813| NOTE: JSX markup for search UI.
011814| src/components/SearchForm.tsx:901:             <div
011815| NOTE: JSX markup for search UI.
011816| src/components/SearchForm.tsx:902:               className="hidden md:flex items-center self-stretch mx-2"
011817| NOTE: Tailwind classes define layout and styling.
011818| src/components/SearchForm.tsx:903:               aria-hidden="true"
011819| NOTE: Accessibility attribute for screen readers.
011820| src/components/SearchForm.tsx:904:             >
011821| NOTE: Implementation detail supporting search page behavior.
011822| src/components/SearchForm.tsx:905:               <div className="w-px h-10 bg-zinc-200 dark:bg-zinc-700"></div>
011823| NOTE: Tailwind classes define layout and styling.
011824| src/components/SearchForm.tsx:906:             </div>
011825| NOTE: JSX markup for search UI.
011826| src/components/SearchForm.tsx:907:             <Button
011827| NOTE: JSX markup for search UI.
011828| src/components/SearchForm.tsx:908:               type="button"
011829| NOTE: Implementation detail supporting search page behavior.
011830| src/components/SearchForm.tsx:909:               variant="filter"
011831| NOTE: Implementation detail supporting search page behavior.
011832| src/components/SearchForm.tsx:910:               onClick={() => setShowFilters(!showFilters)}
011833| NOTE: Implementation detail supporting search page behavior.
011834| src/components/SearchForm.tsx:911:               data-active={activeFilterCount > 0}
011835| NOTE: Implementation detail supporting search page behavior.
011836| src/components/SearchForm.tsx:912:               className={`hidden sm:flex items-center gap-2 rounded-full h-10 px-5 transition-all duration-200 ${showFilters ? "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 border-zinc-900 dark:border-white" : ""}`}
011837| NOTE: Tailwind classes define layout and styling.
011838| src/components/SearchForm.tsx:913:               aria-expanded={showFilters}
011839| NOTE: Accessibility attribute for screen readers.
011840| src/components/SearchForm.tsx:914:               aria-controls="search-filters"
011841| NOTE: Accessibility attribute for screen readers.
011842| src/components/SearchForm.tsx:915:             >
011843| NOTE: Implementation detail supporting search page behavior.
011844| src/components/SearchForm.tsx:916:               <SlidersHorizontal className="w-4 h-4" />
011845| NOTE: Tailwind classes define layout and styling.
011846| src/components/SearchForm.tsx:917:               Filters
011847| NOTE: Implementation detail supporting search page behavior.
011848| src/components/SearchForm.tsx:918:               {activeFilterCount > 0 && (
011849| NOTE: Implementation detail supporting search page behavior.
011850| src/components/SearchForm.tsx:919:                 <span
011851| NOTE: JSX markup for search UI.
011852| src/components/SearchForm.tsx:920:                   className={`ml-1.5 inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-semibold rounded-full transition-colors ${showFilters ? "bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white" : "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900"}`}
011853| NOTE: Tailwind classes define layout and styling.
011854| src/components/SearchForm.tsx:921:                 >
011855| NOTE: Implementation detail supporting search page behavior.
011856| src/components/SearchForm.tsx:922:                   {activeFilterCount}
011857| NOTE: Implementation detail supporting search page behavior.
011858| src/components/SearchForm.tsx:923:                 </span>
011859| NOTE: JSX markup for search UI.
011860| src/components/SearchForm.tsx:924:               )}
011861| NOTE: Implementation detail supporting search page behavior.
011862| src/components/SearchForm.tsx:925:             </Button>
011863| NOTE: JSX markup for search UI.
011864| src/components/SearchForm.tsx:926:           </>
011865| NOTE: JSX markup for search UI.
011866| src/components/SearchForm.tsx:927:         )}
011867| NOTE: Implementation detail supporting search page behavior.
011868| src/components/SearchForm.tsx:928: 
011869| NOTE: Blank line for visual separation.
011870| src/components/SearchForm.tsx:929:         {/* Search Button */}
011871| NOTE: Implementation detail supporting search page behavior.
011872| src/components/SearchForm.tsx:930:         <div
011873| NOTE: JSX markup for search UI.
011874| src/components/SearchForm.tsx:931:           className={`flex items-center justify-center mt-2 md:mt-0 ${isCompact ? "p-0.5" : "p-1 md:ml-2"}`}
011875| NOTE: Tailwind classes define layout and styling.
011876| src/components/SearchForm.tsx:932:         >
011877| NOTE: Implementation detail supporting search page behavior.
011878| src/components/SearchForm.tsx:933:           <Button
011879| NOTE: JSX markup for search UI.
011880| src/components/SearchForm.tsx:934:             type="submit"
011881| NOTE: Implementation detail supporting search page behavior.
011882| src/components/SearchForm.tsx:935:             disabled={isSearching}
011883| NOTE: Implementation detail supporting search page behavior.
011884| src/components/SearchForm.tsx:936:             aria-label={isSearching ? "Searching..." : "Search listings"}
011885| NOTE: Accessibility attribute for screen readers.
011886| src/components/SearchForm.tsx:937:             aria-busy={isSearching}
011887| NOTE: Accessibility attribute for screen readers.
011888| src/components/SearchForm.tsx:938:             className={`rounded-full transition-all duration-200 hover:scale-[1.02] active:scale-[0.98] shadow-md ${isCompact ? "h-9 w-9 p-0" : "h-11 sm:h-12 w-full md:w-12"}`}
011889| NOTE: Tailwind classes define layout and styling.
011890| src/components/SearchForm.tsx:939:           >
011891| NOTE: Implementation detail supporting search page behavior.
011892| src/components/SearchForm.tsx:940:             {isSearching ? (
011893| NOTE: Implementation detail supporting search page behavior.
011894| src/components/SearchForm.tsx:941:               <Loader2
011895| NOTE: JSX markup for search UI.
011896| src/components/SearchForm.tsx:942:                 className={`animate-spin ${isCompact ? "w-4 h-4" : "w-5 h-5"}`}
011897| NOTE: Tailwind classes define layout and styling.
011898| src/components/SearchForm.tsx:943:               />
011899| NOTE: Implementation detail supporting search page behavior.
011900| src/components/SearchForm.tsx:944:             ) : (
011901| NOTE: Implementation detail supporting search page behavior.
011902| src/components/SearchForm.tsx:945:               <Search
011903| NOTE: JSX markup for search UI.
011904| src/components/SearchForm.tsx:946:                 className={`${isCompact ? "w-4 h-4" : "w-[22px] h-[22px]"}`}
011905| NOTE: Tailwind classes define layout and styling.
011906| src/components/SearchForm.tsx:947:                 strokeWidth={2.5}
011907| NOTE: Implementation detail supporting search page behavior.
011908| src/components/SearchForm.tsx:948:               />
011909| NOTE: Implementation detail supporting search page behavior.
011910| src/components/SearchForm.tsx:949:             )}
011911| NOTE: Implementation detail supporting search page behavior.
011912| src/components/SearchForm.tsx:950:             <span
011913| NOTE: JSX markup for search UI.
011914| src/components/SearchForm.tsx:951:               className={`md:hidden ml-2 font-medium text-sm ${isCompact ? "hidden" : ""}`}
011915| NOTE: Tailwind classes define layout and styling.
011916| src/components/SearchForm.tsx:952:             >
011917| NOTE: Implementation detail supporting search page behavior.
011918| src/components/SearchForm.tsx:953:               {isSearching ? "Searching..." : "Search"}
011919| NOTE: Implementation detail supporting search page behavior.
011920| src/components/SearchForm.tsx:954:             </span>
011921| NOTE: JSX markup for search UI.
011922| src/components/SearchForm.tsx:955:           </Button>
011923| NOTE: JSX markup for search UI.
011924| src/components/SearchForm.tsx:956:         </div>
011925| NOTE: JSX markup for search UI.
011926| src/components/SearchForm.tsx:957:       </form>
011927| NOTE: JSX markup for search UI.
011928| src/components/SearchForm.tsx:958: 
011929| NOTE: Blank line for visual separation.
011930| src/components/SearchForm.tsx:959:       {/* Location warning when user hasn't selected from dropdown */}
011931| NOTE: Implementation detail supporting search page behavior.
011932| src/components/SearchForm.tsx:960:       {showLocationWarning && !isCompact && (
011933| NOTE: Implementation detail supporting search page behavior.
011934| src/components/SearchForm.tsx:961:         <div className="mt-2 px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl text-sm text-amber-800 dark:text-amber-400 flex items-center gap-2">
011935| NOTE: Tailwind classes define layout and styling.
011936| src/components/SearchForm.tsx:962:           <svg
011937| NOTE: JSX markup for search UI.
011938| src/components/SearchForm.tsx:963:             className="w-4 h-4 flex-shrink-0"
011939| NOTE: Tailwind classes define layout and styling.
011940| src/components/SearchForm.tsx:964:             fill="none"
011941| NOTE: Implementation detail supporting search page behavior.
011942| src/components/SearchForm.tsx:965:             stroke="currentColor"
011943| NOTE: Implementation detail supporting search page behavior.
011944| src/components/SearchForm.tsx:966:             viewBox="0 0 24 24"
011945| NOTE: Implementation detail supporting search page behavior.
011946| src/components/SearchForm.tsx:967:           >
011947| NOTE: Implementation detail supporting search page behavior.
011948| src/components/SearchForm.tsx:968:             <path
011949| NOTE: JSX markup for search UI.
011950| src/components/SearchForm.tsx:969:               strokeLinecap="round"
011951| NOTE: Implementation detail supporting search page behavior.
011952| src/components/SearchForm.tsx:970:               strokeLinejoin="round"
011953| NOTE: Implementation detail supporting search page behavior.
011954| src/components/SearchForm.tsx:971:               strokeWidth={2}
011955| NOTE: Implementation detail supporting search page behavior.
011956| src/components/SearchForm.tsx:972:               d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
011957| NOTE: Implementation detail supporting search page behavior.
011958| src/components/SearchForm.tsx:973:             />
011959| NOTE: Implementation detail supporting search page behavior.
011960| src/components/SearchForm.tsx:974:           </svg>
011961| NOTE: JSX markup for search UI.
011962| src/components/SearchForm.tsx:975:           <span>
011963| NOTE: JSX markup for search UI.
011964| src/components/SearchForm.tsx:976:             Select a location from the dropdown for more accurate results
011965| NOTE: Implementation detail supporting search page behavior.
011966| src/components/SearchForm.tsx:977:           </span>
011967| NOTE: JSX markup for search UI.
011968| src/components/SearchForm.tsx:978:         </div>
011969| NOTE: JSX markup for search UI.
011970| src/components/SearchForm.tsx:979:       )}
011971| NOTE: Implementation detail supporting search page behavior.
011972| src/components/SearchForm.tsx:980: 
011973| NOTE: Blank line for visual separation.
011974| src/components/SearchForm.tsx:981:       {/* Filter Drawer Overlay - Rendered via Portal to escape stacking contexts */}
011975| NOTE: Implementation detail supporting search page behavior.
011976| src/components/SearchForm.tsx:982:       {showFilters &&
011977| NOTE: Implementation detail supporting search page behavior.
011978| src/components/SearchForm.tsx:983:         typeof document !== "undefined" &&
011979| NOTE: Implementation detail supporting search page behavior.
011980| src/components/SearchForm.tsx:984:         createPortal(
011981| NOTE: Implementation detail supporting search page behavior.
011982| src/components/SearchForm.tsx:985:           <div
011983| NOTE: JSX markup for search UI.
011984| src/components/SearchForm.tsx:986:             className="fixed inset-0 z-modal overflow-hidden"
011985| NOTE: Tailwind classes define layout and styling.
011986| src/components/SearchForm.tsx:987:             aria-labelledby="filter-drawer-title"
011987| NOTE: Accessibility attribute for screen readers.
011988| src/components/SearchForm.tsx:988:             role="dialog"
011989| NOTE: Implementation detail supporting search page behavior.
011990| src/components/SearchForm.tsx:989:             aria-modal="true"
011991| NOTE: Accessibility attribute for screen readers.
011992| src/components/SearchForm.tsx:990:           >
011993| NOTE: Implementation detail supporting search page behavior.
011994| src/components/SearchForm.tsx:991:             {/* Backdrop */}
011995| NOTE: Implementation detail supporting search page behavior.
011996| src/components/SearchForm.tsx:992:             <div
011997| NOTE: JSX markup for search UI.
011998| src/components/SearchForm.tsx:993:               className="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-300"
011999| NOTE: Tailwind classes define layout and styling.
012000| src/components/SearchForm.tsx:994:               onClick={() => setShowFilters(false)}
012001| NOTE: Implementation detail supporting search page behavior.
012002| src/components/SearchForm.tsx:995:               aria-label="Close filters"
012003| NOTE: Accessibility attribute for screen readers.
012004| src/components/SearchForm.tsx:996:             />
012005| NOTE: Implementation detail supporting search page behavior.
012006| src/components/SearchForm.tsx:997: 
012007| NOTE: Blank line for visual separation.
012008| src/components/SearchForm.tsx:998:             {/* Drawer Panel with Focus Trap for accessibility */}
012009| NOTE: Implementation detail supporting search page behavior.
012010| src/components/SearchForm.tsx:999:             <FocusTrap active={showFilters}>
012011| NOTE: JSX markup for search UI.
012012| src/components/SearchForm.tsx:1000:               <div
012013| NOTE: JSX markup for search UI.
012014| src/components/SearchForm.tsx:1001:                 id="search-filters"
012015| NOTE: Implementation detail supporting search page behavior.
012016| src/components/SearchForm.tsx:1002:                 className="absolute right-0 top-0 h-full w-full md:max-w-md bg-white dark:bg-zinc-900 shadow-2xl transform transition-transform duration-300 ease-out animate-in slide-in-from-right overflow-hidden flex flex-col"
012017| NOTE: Tailwind classes define layout and styling.
012018| src/components/SearchForm.tsx:1003:               >
012019| NOTE: Implementation detail supporting search page behavior.
012020| src/components/SearchForm.tsx:1004:                 {/* Note: FocusTrap wraps this - close button below will receive focus */}
012021| NOTE: Implementation detail supporting search page behavior.
012022| src/components/SearchForm.tsx:1005:                 {/* Drawer Header */}
012023| NOTE: Implementation detail supporting search page behavior.
012024| src/components/SearchForm.tsx:1006:                 <div className="flex items-center justify-between px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-900">
012025| NOTE: Tailwind classes define layout and styling.
012026| src/components/SearchForm.tsx:1007:                   <h2
012027| NOTE: JSX markup for search UI.
012028| src/components/SearchForm.tsx:1008:                     id="filter-drawer-title"
012029| NOTE: Implementation detail supporting search page behavior.
012030| src/components/SearchForm.tsx:1009:                     className="text-lg font-semibold text-zinc-900 dark:text-white"
012031| NOTE: Tailwind classes define layout and styling.
012032| src/components/SearchForm.tsx:1010:                   >
012033| NOTE: Implementation detail supporting search page behavior.
012034| src/components/SearchForm.tsx:1011:                     Filters
012035| NOTE: Implementation detail supporting search page behavior.
012036| src/components/SearchForm.tsx:1012:                     {activeFilterCount > 0 && (
012037| NOTE: Implementation detail supporting search page behavior.
012038| src/components/SearchForm.tsx:1013:                       <span className="ml-2 inline-flex items-center justify-center min-w-[24px] h-6 px-2 text-sm font-semibold rounded-full bg-zinc-900 dark:bg-white text-white dark:text-zinc-900">
012039| NOTE: Tailwind classes define layout and styling.
012040| src/components/SearchForm.tsx:1014:                         {activeFilterCount}
012041| NOTE: Implementation detail supporting search page behavior.
012042| src/components/SearchForm.tsx:1015:                       </span>
012043| NOTE: JSX markup for search UI.
012044| src/components/SearchForm.tsx:1016:                     )}
012045| NOTE: Implementation detail supporting search page behavior.
012046| src/components/SearchForm.tsx:1017:                   </h2>
012047| NOTE: JSX markup for search UI.
012048| src/components/SearchForm.tsx:1018:                   <div className="flex items-center gap-2">
012049| NOTE: Tailwind classes define layout and styling.
012050| src/components/SearchForm.tsx:1019:                     {/* Clear all button - shows when filters are active or pending changes exist */}
012051| NOTE: Implementation detail supporting search page behavior.
012052| src/components/SearchForm.tsx:1020:                     {(hasActiveFilters || filtersDirty) && (
012053| NOTE: Implementation detail supporting search page behavior.
012054| src/components/SearchForm.tsx:1021:                       <Button
012055| NOTE: JSX markup for search UI.
012056| src/components/SearchForm.tsx:1022:                         variant="ghost"
012057| NOTE: Implementation detail supporting search page behavior.
012058| src/components/SearchForm.tsx:1023:                         size="sm"
012059| NOTE: Implementation detail supporting search page behavior.
012060| src/components/SearchForm.tsx:1024:                         onClick={handleClearAllFilters}
012061| NOTE: Implementation detail supporting search page behavior.
012062| src/components/SearchForm.tsx:1025:                         className="text-sm text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white"
012063| NOTE: Tailwind classes define layout and styling.
012064| src/components/SearchForm.tsx:1026:                       >
012065| NOTE: Implementation detail supporting search page behavior.
012066| src/components/SearchForm.tsx:1027:                         Clear all
012067| NOTE: Implementation detail supporting search page behavior.
012068| src/components/SearchForm.tsx:1028:                       </Button>
012069| NOTE: JSX markup for search UI.
012070| src/components/SearchForm.tsx:1029:                     )}
012071| NOTE: Implementation detail supporting search page behavior.
012072| src/components/SearchForm.tsx:1030:                     <Button
012073| NOTE: JSX markup for search UI.
012074| src/components/SearchForm.tsx:1031:                       variant="ghost"
012075| NOTE: Implementation detail supporting search page behavior.
012076| src/components/SearchForm.tsx:1032:                       size="icon"
012077| NOTE: Implementation detail supporting search page behavior.
012078| src/components/SearchForm.tsx:1033:                       onClick={() => setShowFilters(false)}
012079| NOTE: Implementation detail supporting search page behavior.
012080| src/components/SearchForm.tsx:1034:                       className="rounded-full w-11 h-11 p-0 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"
012081| NOTE: Tailwind classes define layout and styling.
012082| src/components/SearchForm.tsx:1035:                       aria-label="Close filters"
012083| NOTE: Accessibility attribute for screen readers.
012084| src/components/SearchForm.tsx:1036:                     >
012085| NOTE: Implementation detail supporting search page behavior.
012086| src/components/SearchForm.tsx:1037:                       <X className="w-5 h-5 text-zinc-500 dark:text-zinc-400" />
012087| NOTE: Tailwind classes define layout and styling.
012088| src/components/SearchForm.tsx:1038:                     </Button>
012089| NOTE: JSX markup for search UI.
012090| src/components/SearchForm.tsx:1039:                   </div>
012091| NOTE: JSX markup for search UI.
012092| src/components/SearchForm.tsx:1040:                 </div>
012093| NOTE: JSX markup for search UI.
012094| src/components/SearchForm.tsx:1041: 
012095| NOTE: Blank line for visual separation.
012096| src/components/SearchForm.tsx:1042:                 {/* Scrollable Filter Content */}
012097| NOTE: Implementation detail supporting search page behavior.
012098| src/components/SearchForm.tsx:1043:                 <div className="flex-1 overflow-y-auto p-6 space-y-6 scrollbar-hide">
012099| NOTE: Tailwind classes define layout and styling.
012100| src/components/SearchForm.tsx:1044:                   {/* Sort By (Mobile only - instant apply like desktop) */}
012101| NOTE: Implementation detail supporting search page behavior.
012102| src/components/SearchForm.tsx:1045:                   <fieldset className="space-y-3">
012103| NOTE: Tailwind classes define layout and styling.
012104| src/components/SearchForm.tsx:1046:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
012105| NOTE: Tailwind classes define layout and styling.
012106| src/components/SearchForm.tsx:1047:                       Sort by
012107| NOTE: Implementation detail supporting search page behavior.
012108| src/components/SearchForm.tsx:1048:                     </legend>
012109| NOTE: JSX markup for search UI.
012110| src/components/SearchForm.tsx:1049:                     <div
012111| NOTE: JSX markup for search UI.
012112| src/components/SearchForm.tsx:1050:                       className="flex flex-col gap-2"
012113| NOTE: Tailwind classes define layout and styling.
012114| src/components/SearchForm.tsx:1051:                       role="radiogroup"
012115| NOTE: Implementation detail supporting search page behavior.
012116| src/components/SearchForm.tsx:1052:                       aria-label="Sort options"
012117| NOTE: Accessibility attribute for screen readers.
012118| src/components/SearchForm.tsx:1053:                     >
012119| NOTE: Implementation detail supporting search page behavior.
012120| src/components/SearchForm.tsx:1054:                       {sortOptions.map((option) => (
012121| NOTE: Implementation detail supporting search page behavior.
012122| src/components/SearchForm.tsx:1055:                         <label
012123| NOTE: JSX markup for search UI.
012124| src/components/SearchForm.tsx:1056:                           key={option.value}
012125| NOTE: Implementation detail supporting search page behavior.
012126| src/components/SearchForm.tsx:1057:                           className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${
012127| NOTE: Tailwind classes define layout and styling.
012128| src/components/SearchForm.tsx:1058:                             currentSort === option.value
012129| NOTE: Implementation detail supporting search page behavior.
012130| src/components/SearchForm.tsx:1059:                               ? "border-zinc-900 dark:border-white bg-zinc-50 dark:bg-zinc-800"
012131| NOTE: Implementation detail supporting search page behavior.
012132| src/components/SearchForm.tsx:1060:                               : "border-zinc-200 dark:border-zinc-700 hover:border-zinc-300 dark:hover:border-zinc-600"
012133| NOTE: Implementation detail supporting search page behavior.
012134| src/components/SearchForm.tsx:1061:                           }`}
012135| NOTE: Implementation detail supporting search page behavior.
012136| src/components/SearchForm.tsx:1062:                         >
012137| NOTE: Implementation detail supporting search page behavior.
012138| src/components/SearchForm.tsx:1063:                           <input
012139| NOTE: JSX markup for search UI.
012140| src/components/SearchForm.tsx:1064:                             type="radio"
012141| NOTE: Implementation detail supporting search page behavior.
012142| src/components/SearchForm.tsx:1065:                             name="sort"
012143| NOTE: Implementation detail supporting search page behavior.
012144| src/components/SearchForm.tsx:1066:                             value={option.value}
012145| NOTE: Implementation detail supporting search page behavior.
012146| src/components/SearchForm.tsx:1067:                             checked={currentSort === option.value}
012147| NOTE: Implementation detail supporting search page behavior.
012148| src/components/SearchForm.tsx:1068:                             onChange={() =>
012149| NOTE: Implementation detail supporting search page behavior.
012150| src/components/SearchForm.tsx:1069:                               handleSortChange(option.value as SortOption)
012151| NOTE: Implementation detail supporting search page behavior.
012152| src/components/SearchForm.tsx:1070:                             }
012153| NOTE: Implementation detail supporting search page behavior.
012154| src/components/SearchForm.tsx:1071:                             className="w-4 h-4 text-zinc-900 dark:text-white border-zinc-300 dark:border-zinc-600 focus:ring-zinc-500"
012155| NOTE: Tailwind classes define layout and styling.
012156| src/components/SearchForm.tsx:1072:                           />
012157| NOTE: Implementation detail supporting search page behavior.
012158| src/components/SearchForm.tsx:1073:                           <span className="text-sm font-medium text-zinc-900 dark:text-white">
012159| NOTE: Tailwind classes define layout and styling.
012160| src/components/SearchForm.tsx:1074:                             {option.label}
012161| NOTE: Implementation detail supporting search page behavior.
012162| src/components/SearchForm.tsx:1075:                           </span>
012163| NOTE: JSX markup for search UI.
012164| src/components/SearchForm.tsx:1076:                         </label>
012165| NOTE: JSX markup for search UI.
012166| src/components/SearchForm.tsx:1077:                       ))}
012167| NOTE: Implementation detail supporting search page behavior.
012168| src/components/SearchForm.tsx:1078:                     </div>
012169| NOTE: JSX markup for search UI.
012170| src/components/SearchForm.tsx:1079:                   </fieldset>
012171| NOTE: JSX markup for search UI.
012172| src/components/SearchForm.tsx:1080: 
012173| NOTE: Blank line for visual separation.
012174| src/components/SearchForm.tsx:1081:                   {/* Move-in Date */}
012175| NOTE: Implementation detail supporting search page behavior.
012176| src/components/SearchForm.tsx:1082:                   <div className="space-y-2">
012177| NOTE: Tailwind classes define layout and styling.
012178| src/components/SearchForm.tsx:1083:                     <label
012179| NOTE: JSX markup for search UI.
012180| src/components/SearchForm.tsx:1084:                       htmlFor="filter-move-in"
012181| NOTE: Implementation detail supporting search page behavior.
012182| src/components/SearchForm.tsx:1085:                       className="text-sm font-semibold text-zinc-900 dark:text-white"
012183| NOTE: Tailwind classes define layout and styling.
012184| src/components/SearchForm.tsx:1086:                     >
012185| NOTE: Implementation detail supporting search page behavior.
012186| src/components/SearchForm.tsx:1087:                       Move-in Date
012187| NOTE: Implementation detail supporting search page behavior.
012188| src/components/SearchForm.tsx:1088:                     </label>
012189| NOTE: JSX markup for search UI.
012190| src/components/SearchForm.tsx:1089:                     <DatePicker
012191| NOTE: JSX markup for search UI.
012192| src/components/SearchForm.tsx:1090:                       id="filter-move-in"
012193| NOTE: Implementation detail supporting search page behavior.
012194| src/components/SearchForm.tsx:1091:                       value={batchedFilters.moveInDate}
012195| NOTE: Implementation detail supporting search page behavior.
012196| src/components/SearchForm.tsx:1092:                       onChange={(value) =>
012197| NOTE: Implementation detail supporting search page behavior.
012198| src/components/SearchForm.tsx:1093:                         updateBatchedField("moveInDate", value)
012199| NOTE: Implementation detail supporting search page behavior.
012200| src/components/SearchForm.tsx:1094:                       }
012201| NOTE: Implementation detail supporting search page behavior.
012202| src/components/SearchForm.tsx:1095:                       placeholder="Select move-in date"
012203| NOTE: Implementation detail supporting search page behavior.
012204| src/components/SearchForm.tsx:1096:                       minDate={minMoveInDate}
012205| NOTE: Implementation detail supporting search page behavior.
012206| src/components/SearchForm.tsx:1097:                     />
012207| NOTE: Implementation detail supporting search page behavior.
012208| src/components/SearchForm.tsx:1098:                   </div>
012209| NOTE: JSX markup for search UI.
012210| src/components/SearchForm.tsx:1099: 
012211| NOTE: Blank line for visual separation.
012212| src/components/SearchForm.tsx:1100:                   {/* Lease Duration */}
012213| NOTE: Implementation detail supporting search page behavior.
012214| src/components/SearchForm.tsx:1101:                   <div className="space-y-2">
012215| NOTE: Tailwind classes define layout and styling.
012216| src/components/SearchForm.tsx:1102:                     <label
012217| NOTE: JSX markup for search UI.
012218| src/components/SearchForm.tsx:1103:                       htmlFor="filter-lease"
012219| NOTE: Implementation detail supporting search page behavior.
012220| src/components/SearchForm.tsx:1104:                       className="text-sm font-semibold text-zinc-900 dark:text-white"
012221| NOTE: Tailwind classes define layout and styling.
012222| src/components/SearchForm.tsx:1105:                     >
012223| NOTE: Implementation detail supporting search page behavior.
012224| src/components/SearchForm.tsx:1106:                       Lease Duration
012225| NOTE: Implementation detail supporting search page behavior.
012226| src/components/SearchForm.tsx:1107:                     </label>
012227| NOTE: JSX markup for search UI.
012228| src/components/SearchForm.tsx:1108:                     <Select
012229| NOTE: JSX markup for search UI.
012230| src/components/SearchForm.tsx:1109:                       value={batchedFilters.leaseDuration || "any"}
012231| NOTE: Implementation detail supporting search page behavior.
012232| src/components/SearchForm.tsx:1110:                       onValueChange={(value) =>
012233| NOTE: Implementation detail supporting search page behavior.
012234| src/components/SearchForm.tsx:1111:                         updateBatchedField(
012235| NOTE: Implementation detail supporting search page behavior.
012236| src/components/SearchForm.tsx:1112:                           "leaseDuration",
012237| NOTE: Implementation detail supporting search page behavior.
012238| src/components/SearchForm.tsx:1113:                           value === "any" ? "" : value,
012239| NOTE: Implementation detail supporting search page behavior.
012240| src/components/SearchForm.tsx:1114:                         )
012241| NOTE: Implementation detail supporting search page behavior.
012242| src/components/SearchForm.tsx:1115:                       }
012243| NOTE: Implementation detail supporting search page behavior.
012244| src/components/SearchForm.tsx:1116:                     >
012245| NOTE: Implementation detail supporting search page behavior.
012246| src/components/SearchForm.tsx:1117:                       <SelectTrigger id="filter-lease">
012247| NOTE: JSX markup for search UI.
012248| src/components/SearchForm.tsx:1118:                         <SelectValue placeholder="Any" />
012249| NOTE: JSX markup for search UI.
012250| src/components/SearchForm.tsx:1119:                       </SelectTrigger>
012251| NOTE: JSX markup for search UI.
012252| src/components/SearchForm.tsx:1120:                       <SelectContent>
012253| NOTE: JSX markup for search UI.
012254| src/components/SearchForm.tsx:1121:                         <SelectItem value="any">Any</SelectItem>
012255| NOTE: JSX markup for search UI.
012256| src/components/SearchForm.tsx:1122:                         <SelectItem value="Month-to-month">
012257| NOTE: JSX markup for search UI.
012258| src/components/SearchForm.tsx:1123:                           Month-to-month
012259| NOTE: Implementation detail supporting search page behavior.
012260| src/components/SearchForm.tsx:1124:                         </SelectItem>
012261| NOTE: JSX markup for search UI.
012262| src/components/SearchForm.tsx:1125:                         <SelectItem value="3 months">3 months</SelectItem>
012263| NOTE: JSX markup for search UI.
012264| src/components/SearchForm.tsx:1126:                         <SelectItem value="6 months">6 months</SelectItem>
012265| NOTE: JSX markup for search UI.
012266| src/components/SearchForm.tsx:1127:                         <SelectItem value="12 months">12 months</SelectItem>
012267| NOTE: JSX markup for search UI.
012268| src/components/SearchForm.tsx:1128:                         <SelectItem value="Flexible">Flexible</SelectItem>
012269| NOTE: JSX markup for search UI.
012270| src/components/SearchForm.tsx:1129:                       </SelectContent>
012271| NOTE: JSX markup for search UI.
012272| src/components/SearchForm.tsx:1130:                     </Select>
012273| NOTE: JSX markup for search UI.
012274| src/components/SearchForm.tsx:1131:                   </div>
012275| NOTE: JSX markup for search UI.
012276| src/components/SearchForm.tsx:1132: 
012277| NOTE: Blank line for visual separation.
012278| src/components/SearchForm.tsx:1133:                   {/* Room Type */}
012279| NOTE: Implementation detail supporting search page behavior.
012280| src/components/SearchForm.tsx:1134:                   <div className="space-y-2">
012281| NOTE: Tailwind classes define layout and styling.
012282| src/components/SearchForm.tsx:1135:                     <label
012283| NOTE: JSX markup for search UI.
012284| src/components/SearchForm.tsx:1136:                       htmlFor="filter-room-type"
012285| NOTE: Implementation detail supporting search page behavior.
012286| src/components/SearchForm.tsx:1137:                       className="text-sm font-semibold text-zinc-900 dark:text-white"
012287| NOTE: Tailwind classes define layout and styling.
012288| src/components/SearchForm.tsx:1138:                     >
012289| NOTE: Implementation detail supporting search page behavior.
012290| src/components/SearchForm.tsx:1139:                       Room Type
012291| NOTE: Implementation detail supporting search page behavior.
012292| src/components/SearchForm.tsx:1140:                     </label>
012293| NOTE: JSX markup for search UI.
012294| src/components/SearchForm.tsx:1141:                     <Select
012295| NOTE: JSX markup for search UI.
012296| src/components/SearchForm.tsx:1142:                       value={batchedFilters.roomType || "any"}
012297| NOTE: Implementation detail supporting search page behavior.
012298| src/components/SearchForm.tsx:1143:                       onValueChange={(value) =>
012299| NOTE: Implementation detail supporting search page behavior.
012300| src/components/SearchForm.tsx:1144:                         updateBatchedField(
012301| NOTE: Implementation detail supporting search page behavior.
012302| src/components/SearchForm.tsx:1145:                           "roomType",
012303| NOTE: Implementation detail supporting search page behavior.
012304| src/components/SearchForm.tsx:1146:                           value === "any" ? "" : value,
012305| NOTE: Implementation detail supporting search page behavior.
012306| src/components/SearchForm.tsx:1147:                         )
012307| NOTE: Implementation detail supporting search page behavior.
012308| src/components/SearchForm.tsx:1148:                       }
012309| NOTE: Implementation detail supporting search page behavior.
012310| src/components/SearchForm.tsx:1149:                     >
012311| NOTE: Implementation detail supporting search page behavior.
012312| src/components/SearchForm.tsx:1150:                       <SelectTrigger id="filter-room-type">
012313| NOTE: JSX markup for search UI.
012314| src/components/SearchForm.tsx:1151:                         <SelectValue placeholder="Any" />
012315| NOTE: JSX markup for search UI.
012316| src/components/SearchForm.tsx:1152:                       </SelectTrigger>
012317| NOTE: JSX markup for search UI.
012318| src/components/SearchForm.tsx:1153:                       <SelectContent>
012319| NOTE: JSX markup for search UI.
012320| src/components/SearchForm.tsx:1154:                         <SelectItem value="any">Any</SelectItem>
012321| NOTE: JSX markup for search UI.
012322| src/components/SearchForm.tsx:1155:                         <SelectItem value="Private Room">
012323| NOTE: JSX markup for search UI.
012324| src/components/SearchForm.tsx:1156:                           Private Room
012325| NOTE: Implementation detail supporting search page behavior.
012326| src/components/SearchForm.tsx:1157:                         </SelectItem>
012327| NOTE: JSX markup for search UI.
012328| src/components/SearchForm.tsx:1158:                         <SelectItem value="Shared Room">Shared Room</SelectItem>
012329| NOTE: JSX markup for search UI.
012330| src/components/SearchForm.tsx:1159:                         <SelectItem value="Entire Place">
012331| NOTE: JSX markup for search UI.
012332| src/components/SearchForm.tsx:1160:                           Entire Place
012333| NOTE: Implementation detail supporting search page behavior.
012334| src/components/SearchForm.tsx:1161:                         </SelectItem>
012335| NOTE: JSX markup for search UI.
012336| src/components/SearchForm.tsx:1162:                       </SelectContent>
012337| NOTE: JSX markup for search UI.
012338| src/components/SearchForm.tsx:1163:                     </Select>
012339| NOTE: JSX markup for search UI.
012340| src/components/SearchForm.tsx:1164:                   </div>
012341| NOTE: JSX markup for search UI.
012342| src/components/SearchForm.tsx:1165: 
012343| NOTE: Blank line for visual separation.
012344| src/components/SearchForm.tsx:1166:                   {/* Amenities */}
012345| NOTE: Implementation detail supporting search page behavior.
012346| src/components/SearchForm.tsx:1167:                   <fieldset className="space-y-3">
012347| NOTE: Tailwind classes define layout and styling.
012348| src/components/SearchForm.tsx:1168:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
012349| NOTE: Tailwind classes define layout and styling.
012350| src/components/SearchForm.tsx:1169:                       Amenities
012351| NOTE: Implementation detail supporting search page behavior.
012352| src/components/SearchForm.tsx:1170:                     </legend>
012353| NOTE: JSX markup for search UI.
012354| src/components/SearchForm.tsx:1171:                     <div
012355| NOTE: JSX markup for search UI.
012356| src/components/SearchForm.tsx:1172:                       className="flex flex-wrap gap-2"
012357| NOTE: Tailwind classes define layout and styling.
012358| src/components/SearchForm.tsx:1173:                       role="group"
012359| NOTE: Implementation detail supporting search page behavior.
012360| src/components/SearchForm.tsx:1174:                       aria-label="Select amenities"
012361| NOTE: Accessibility attribute for screen readers.
012362| src/components/SearchForm.tsx:1175:                     >
012363| NOTE: Implementation detail supporting search page behavior.
012364| src/components/SearchForm.tsx:1176:                       {AMENITY_OPTIONS.map((amenity) => (
012365| NOTE: Implementation detail supporting search page behavior.
012366| src/components/SearchForm.tsx:1177:                         <Button
012367| NOTE: JSX markup for search UI.
012368| src/components/SearchForm.tsx:1178:                           key={amenity}
012369| NOTE: Implementation detail supporting search page behavior.
012370| src/components/SearchForm.tsx:1179:                           type="button"
012371| NOTE: Implementation detail supporting search page behavior.
012372| src/components/SearchForm.tsx:1180:                           variant="filter"
012373| NOTE: Implementation detail supporting search page behavior.
012374| src/components/SearchForm.tsx:1181:                           onClick={() => toggleAmenity(amenity)}
012375| NOTE: Implementation detail supporting search page behavior.
012376| src/components/SearchForm.tsx:1182:                           data-active={batchedFilters.amenities.includes(
012377| NOTE: Implementation detail supporting search page behavior.
012378| src/components/SearchForm.tsx:1183:                             amenity,
012379| NOTE: Implementation detail supporting search page behavior.
012380| src/components/SearchForm.tsx:1184:                           )}
012381| NOTE: Implementation detail supporting search page behavior.
012382| src/components/SearchForm.tsx:1185:                           aria-pressed={batchedFilters.amenities.includes(
012383| NOTE: Accessibility attribute for screen readers.
012384| src/components/SearchForm.tsx:1186:                             amenity,
012385| NOTE: Implementation detail supporting search page behavior.
012386| src/components/SearchForm.tsx:1187:                           )}
012387| NOTE: Implementation detail supporting search page behavior.
012388| src/components/SearchForm.tsx:1188:                           className={`rounded-full h-auto py-2 px-3 text-sm font-medium transition-all duration-200 ${batchedFilters.amenities.includes(amenity) ? "scale-[1.02]" : "hover:scale-[1.02]"}`}
012389| NOTE: Tailwind classes define layout and styling.
012390| src/components/SearchForm.tsx:1189:                         >
012391| NOTE: Implementation detail supporting search page behavior.
012392| src/components/SearchForm.tsx:1190:                           {amenity}
012393| NOTE: Implementation detail supporting search page behavior.
012394| src/components/SearchForm.tsx:1191:                           {batchedFilters.amenities.includes(amenity) && (
012395| NOTE: Implementation detail supporting search page behavior.
012396| src/components/SearchForm.tsx:1192:                             <X className="w-3.5 h-3.5 ml-1.5" />
012397| NOTE: Tailwind classes define layout and styling.
012398| src/components/SearchForm.tsx:1193:                           )}
012399| NOTE: Implementation detail supporting search page behavior.
012400| src/components/SearchForm.tsx:1194:                         </Button>
012401| NOTE: JSX markup for search UI.
012402| src/components/SearchForm.tsx:1195:                       ))}
012403| NOTE: Implementation detail supporting search page behavior.
012404| src/components/SearchForm.tsx:1196:                     </div>
012405| NOTE: JSX markup for search UI.
012406| src/components/SearchForm.tsx:1197:                   </fieldset>
012407| NOTE: JSX markup for search UI.
012408| src/components/SearchForm.tsx:1198: 
012409| NOTE: Blank line for visual separation.
012410| src/components/SearchForm.tsx:1199:                   {/* House Rules */}
012411| NOTE: Implementation detail supporting search page behavior.
012412| src/components/SearchForm.tsx:1200:                   <fieldset className="space-y-3">
012413| NOTE: Tailwind classes define layout and styling.
012414| src/components/SearchForm.tsx:1201:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
012415| NOTE: Tailwind classes define layout and styling.
012416| src/components/SearchForm.tsx:1202:                       House Rules
012417| NOTE: Implementation detail supporting search page behavior.
012418| src/components/SearchForm.tsx:1203:                     </legend>
012419| NOTE: JSX markup for search UI.
012420| src/components/SearchForm.tsx:1204:                     <div
012421| NOTE: JSX markup for search UI.
012422| src/components/SearchForm.tsx:1205:                       className="flex flex-wrap gap-2"
012423| NOTE: Tailwind classes define layout and styling.
012424| src/components/SearchForm.tsx:1206:                       role="group"
012425| NOTE: Implementation detail supporting search page behavior.
012426| src/components/SearchForm.tsx:1207:                       aria-label="Select house rules"
012427| NOTE: Accessibility attribute for screen readers.
012428| src/components/SearchForm.tsx:1208:                     >
012429| NOTE: Implementation detail supporting search page behavior.
012430| src/components/SearchForm.tsx:1209:                       {HOUSE_RULE_OPTIONS.map((rule) => (
012431| NOTE: Implementation detail supporting search page behavior.
012432| src/components/SearchForm.tsx:1210:                         <Button
012433| NOTE: JSX markup for search UI.
012434| src/components/SearchForm.tsx:1211:                           key={rule}
012435| NOTE: Implementation detail supporting search page behavior.
012436| src/components/SearchForm.tsx:1212:                           type="button"
012437| NOTE: Implementation detail supporting search page behavior.
012438| src/components/SearchForm.tsx:1213:                           variant="filter"
012439| NOTE: Implementation detail supporting search page behavior.
012440| src/components/SearchForm.tsx:1214:                           onClick={() => toggleHouseRule(rule)}
012441| NOTE: Implementation detail supporting search page behavior.
012442| src/components/SearchForm.tsx:1215:                           data-active={batchedFilters.houseRules.includes(rule)}
012443| NOTE: Implementation detail supporting search page behavior.
012444| src/components/SearchForm.tsx:1216:                           aria-pressed={batchedFilters.houseRules.includes(
012445| NOTE: Accessibility attribute for screen readers.
012446| src/components/SearchForm.tsx:1217:                             rule,
012447| NOTE: Implementation detail supporting search page behavior.
012448| src/components/SearchForm.tsx:1218:                           )}
012449| NOTE: Implementation detail supporting search page behavior.
012450| src/components/SearchForm.tsx:1219:                           className={`rounded-full h-auto py-2 px-3 text-sm font-medium transition-all duration-200 ${batchedFilters.houseRules.includes(rule) ? "scale-[1.02]" : "hover:scale-[1.02]"}`}
012451| NOTE: Tailwind classes define layout and styling.
012452| src/components/SearchForm.tsx:1220:                         >
012453| NOTE: Implementation detail supporting search page behavior.
012454| src/components/SearchForm.tsx:1221:                           {rule}
012455| NOTE: Implementation detail supporting search page behavior.
012456| src/components/SearchForm.tsx:1222:                           {batchedFilters.houseRules.includes(rule) && (
012457| NOTE: Implementation detail supporting search page behavior.
012458| src/components/SearchForm.tsx:1223:                             <X className="w-3.5 h-3.5 ml-1.5" />
012459| NOTE: Tailwind classes define layout and styling.
012460| src/components/SearchForm.tsx:1224:                           )}
012461| NOTE: Implementation detail supporting search page behavior.
012462| src/components/SearchForm.tsx:1225:                         </Button>
012463| NOTE: JSX markup for search UI.
012464| src/components/SearchForm.tsx:1226:                       ))}
012465| NOTE: Implementation detail supporting search page behavior.
012466| src/components/SearchForm.tsx:1227:                     </div>
012467| NOTE: JSX markup for search UI.
012468| src/components/SearchForm.tsx:1228:                   </fieldset>
012469| NOTE: JSX markup for search UI.
012470| src/components/SearchForm.tsx:1229: 
012471| NOTE: Blank line for visual separation.
012472| src/components/SearchForm.tsx:1230:                   {/* Languages */}
012473| NOTE: Implementation detail supporting search page behavior.
012474| src/components/SearchForm.tsx:1231:                   <fieldset className="space-y-3">
012475| NOTE: Tailwind classes define layout and styling.
012476| src/components/SearchForm.tsx:1232:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
012477| NOTE: Tailwind classes define layout and styling.
012478| src/components/SearchForm.tsx:1233:                       Can Communicate In
012479| NOTE: Implementation detail supporting search page behavior.
012480| src/components/SearchForm.tsx:1234:                     </legend>
012481| NOTE: JSX markup for search UI.
012482| src/components/SearchForm.tsx:1235:                     <p className="text-xs text-zinc-500 dark:text-zinc-400 -mt-1">
012483| NOTE: Tailwind classes define layout and styling.
012484| src/components/SearchForm.tsx:1236:                       Show listings where household speaks any of these
012485| NOTE: Implementation detail supporting search page behavior.
012486| src/components/SearchForm.tsx:1237:                     </p>
012487| NOTE: JSX markup for search UI.
012488| src/components/SearchForm.tsx:1238: 
012489| NOTE: Blank line for visual separation.
012490| src/components/SearchForm.tsx:1239:                     {/* Selected languages shown at top */}
012491| NOTE: Implementation detail supporting search page behavior.
012492| src/components/SearchForm.tsx:1240:                     {batchedFilters.languages.length > 0 && (
012493| NOTE: Implementation detail supporting search page behavior.
012494| src/components/SearchForm.tsx:1241:                       <div
012495| NOTE: JSX markup for search UI.
012496| src/components/SearchForm.tsx:1242:                         className="flex flex-wrap gap-2 pb-2 border-b border-zinc-200 dark:border-zinc-700"
012497| NOTE: Tailwind classes define layout and styling.
012498| src/components/SearchForm.tsx:1243:                         role="group"
012499| NOTE: Implementation detail supporting search page behavior.
012500| src/components/SearchForm.tsx:1244:                         aria-label="Selected languages"
012501| NOTE: Accessibility attribute for screen readers.
012502| src/components/SearchForm.tsx:1245:                       >
012503| NOTE: Implementation detail supporting search page behavior.
012504| src/components/SearchForm.tsx:1246:                         {batchedFilters.languages.map((code) => (
012505| NOTE: Implementation detail supporting search page behavior.
012506| src/components/SearchForm.tsx:1247:                           <Button
012507| NOTE: JSX markup for search UI.
012508| src/components/SearchForm.tsx:1248:                             key={code}
012509| NOTE: Implementation detail supporting search page behavior.
012510| src/components/SearchForm.tsx:1249:                             type="button"
012511| NOTE: Implementation detail supporting search page behavior.
012512| src/components/SearchForm.tsx:1250:                             variant="filter"
012513| NOTE: Implementation detail supporting search page behavior.
012514| src/components/SearchForm.tsx:1251:                             onClick={() => toggleLanguage(code)}
012515| NOTE: Implementation detail supporting search page behavior.
012516| src/components/SearchForm.tsx:1252:                             data-active={true}
012517| NOTE: Implementation detail supporting search page behavior.
012518| src/components/SearchForm.tsx:1253:                             aria-pressed={true}
012519| NOTE: Accessibility attribute for screen readers.
012520| src/components/SearchForm.tsx:1254:                             className="rounded-full h-auto py-2 px-3 text-sm font-medium"
012521| NOTE: Tailwind classes define layout and styling.
012522| src/components/SearchForm.tsx:1255:                           >
012523| NOTE: Implementation detail supporting search page behavior.
012524| src/components/SearchForm.tsx:1256:                             {getLanguageName(code)}
012525| NOTE: Implementation detail supporting search page behavior.
012526| src/components/SearchForm.tsx:1257:                             <X className="w-3.5 h-3.5 ml-1.5" />
012527| NOTE: Tailwind classes define layout and styling.
012528| src/components/SearchForm.tsx:1258:                           </Button>
012529| NOTE: JSX markup for search UI.
012530| src/components/SearchForm.tsx:1259:                         ))}
012531| NOTE: Implementation detail supporting search page behavior.
012532| src/components/SearchForm.tsx:1260:                       </div>
012533| NOTE: JSX markup for search UI.
012534| src/components/SearchForm.tsx:1261:                     )}
012535| NOTE: Implementation detail supporting search page behavior.
012536| src/components/SearchForm.tsx:1262: 
012537| NOTE: Blank line for visual separation.
012538| src/components/SearchForm.tsx:1263:                     {/* Search input */}
012539| NOTE: Implementation detail supporting search page behavior.
012540| src/components/SearchForm.tsx:1264:                     <Input
012541| NOTE: JSX markup for search UI.
012542| src/components/SearchForm.tsx:1265:                       type="text"
012543| NOTE: Implementation detail supporting search page behavior.
012544| src/components/SearchForm.tsx:1266:                       placeholder="Search languages..."
012545| NOTE: Implementation detail supporting search page behavior.
012546| src/components/SearchForm.tsx:1267:                       value={languageSearch}
012547| NOTE: Implementation detail supporting search page behavior.
012548| src/components/SearchForm.tsx:1268:                       onChange={(e) => setLanguageSearch(e.target.value)}
012549| NOTE: Implementation detail supporting search page behavior.
012550| src/components/SearchForm.tsx:1269:                       className="h-9"
012551| NOTE: Tailwind classes define layout and styling.
012552| src/components/SearchForm.tsx:1270:                     />
012553| NOTE: Implementation detail supporting search page behavior.
012554| src/components/SearchForm.tsx:1271: 
012555| NOTE: Blank line for visual separation.
012556| src/components/SearchForm.tsx:1272:                     {/* Language chips */}
012557| NOTE: Implementation detail supporting search page behavior.
012558| src/components/SearchForm.tsx:1273:                     <div
012559| NOTE: JSX markup for search UI.
012560| src/components/SearchForm.tsx:1274:                       className="flex flex-wrap gap-2 max-h-36 overflow-y-auto"
012561| NOTE: Tailwind classes define layout and styling.
012562| src/components/SearchForm.tsx:1275:                       role="group"
012563| NOTE: Implementation detail supporting search page behavior.
012564| src/components/SearchForm.tsx:1276:                       aria-label="Available languages"
012565| NOTE: Accessibility attribute for screen readers.
012566| src/components/SearchForm.tsx:1277:                     >
012567| NOTE: Implementation detail supporting search page behavior.
012568| src/components/SearchForm.tsx:1278:                       {filteredLanguages
012569| NOTE: Implementation detail supporting search page behavior.
012570| src/components/SearchForm.tsx:1279:                         .filter(
012571| NOTE: Implementation detail supporting search page behavior.
012572| src/components/SearchForm.tsx:1280:                           (code) => !batchedFilters.languages.includes(code),
012573| NOTE: Implementation detail supporting search page behavior.
012574| src/components/SearchForm.tsx:1281:                         )
012575| NOTE: Implementation detail supporting search page behavior.
012576| src/components/SearchForm.tsx:1282:                         .map((code) => (
012577| NOTE: Implementation detail supporting search page behavior.
012578| src/components/SearchForm.tsx:1283:                           <Button
012579| NOTE: JSX markup for search UI.
012580| src/components/SearchForm.tsx:1284:                             key={code}
012581| NOTE: Implementation detail supporting search page behavior.
012582| src/components/SearchForm.tsx:1285:                             type="button"
012583| NOTE: Implementation detail supporting search page behavior.
012584| src/components/SearchForm.tsx:1286:                             variant="filter"
012585| NOTE: Implementation detail supporting search page behavior.
012586| src/components/SearchForm.tsx:1287:                             onClick={() => toggleLanguage(code)}
012587| NOTE: Implementation detail supporting search page behavior.
012588| src/components/SearchForm.tsx:1288:                             data-active={false}
012589| NOTE: Implementation detail supporting search page behavior.
012590| src/components/SearchForm.tsx:1289:                             aria-pressed={false}
012591| NOTE: Accessibility attribute for screen readers.
012592| src/components/SearchForm.tsx:1290:                             className="rounded-full h-auto py-2 px-3 text-sm font-medium transition-all duration-200 hover:scale-[1.02]"
012593| NOTE: Tailwind classes define layout and styling.
012594| src/components/SearchForm.tsx:1291:                           >
012595| NOTE: Implementation detail supporting search page behavior.
012596| src/components/SearchForm.tsx:1292:                             {getLanguageName(code)}
012597| NOTE: Implementation detail supporting search page behavior.
012598| src/components/SearchForm.tsx:1293:                           </Button>
012599| NOTE: JSX markup for search UI.
012600| src/components/SearchForm.tsx:1294:                         ))}
012601| NOTE: Implementation detail supporting search page behavior.
012602| src/components/SearchForm.tsx:1295:                       {filteredLanguages.filter(
012603| NOTE: Implementation detail supporting search page behavior.
012604| src/components/SearchForm.tsx:1296:                         (code) => !batchedFilters.languages.includes(code),
012605| NOTE: Implementation detail supporting search page behavior.
012606| src/components/SearchForm.tsx:1297:                       ).length === 0 && (
012607| NOTE: Implementation detail supporting search page behavior.
012608| src/components/SearchForm.tsx:1298:                         <p className="text-sm text-zinc-500 dark:text-zinc-400">
012609| NOTE: Tailwind classes define layout and styling.
012610| src/components/SearchForm.tsx:1299:                           {languageSearch
012611| NOTE: Implementation detail supporting search page behavior.
012612| src/components/SearchForm.tsx:1300:                             ? "No languages found"
012613| NOTE: Implementation detail supporting search page behavior.
012614| src/components/SearchForm.tsx:1301:                             : "All languages selected"}
012615| NOTE: Implementation detail supporting search page behavior.
012616| src/components/SearchForm.tsx:1302:                         </p>
012617| NOTE: JSX markup for search UI.
012618| src/components/SearchForm.tsx:1303:                       )}
012619| NOTE: Implementation detail supporting search page behavior.
012620| src/components/SearchForm.tsx:1304:                     </div>
012621| NOTE: JSX markup for search UI.
012622| src/components/SearchForm.tsx:1305:                   </fieldset>
012623| NOTE: JSX markup for search UI.
012624| src/components/SearchForm.tsx:1306:                 </div>
012625| NOTE: JSX markup for search UI.
012626| src/components/SearchForm.tsx:1307: 
012627| NOTE: Blank line for visual separation.
012628| src/components/SearchForm.tsx:1308:                 {/* Drawer Footer with Apply/Reset */}
012629| NOTE: Implementation detail supporting search page behavior.
012630| src/components/SearchForm.tsx:1309:                 <FilterStickyFooter
012631| NOTE: JSX markup for search UI.
012632| src/components/SearchForm.tsx:1310:                   isDirty={filtersDirty}
012633| NOTE: Implementation detail supporting search page behavior.
012634| src/components/SearchForm.tsx:1311:                   changeCount={filtersChangeCount}
012635| NOTE: Implementation detail supporting search page behavior.
012636| src/components/SearchForm.tsx:1312:                   onApply={handleApplyFilters}
012637| NOTE: Implementation detail supporting search page behavior.
012638| src/components/SearchForm.tsx:1313:                   onReset={handleResetFilters}
012639| NOTE: Implementation detail supporting search page behavior.
012640| src/components/SearchForm.tsx:1314:                   pendingCount={pendingCount}
012641| NOTE: Implementation detail supporting search page behavior.
012642| src/components/SearchForm.tsx:1315:                   previousCount={previousCount}
012643| NOTE: Implementation detail supporting search page behavior.
012644| src/components/SearchForm.tsx:1316:                   baselineCount={baselineCount}
012645| NOTE: Implementation detail supporting search page behavior.
012646| src/components/SearchForm.tsx:1317:                   isCountLoading={isCountLoading}
012647| NOTE: Implementation detail supporting search page behavior.
012648| src/components/SearchForm.tsx:1318:                 />
012649| NOTE: Implementation detail supporting search page behavior.
012650| src/components/SearchForm.tsx:1319:               </div>
012651| NOTE: JSX markup for search UI.
012652| src/components/SearchForm.tsx:1320:             </FocusTrap>
012653| NOTE: JSX markup for search UI.
012654| src/components/SearchForm.tsx:1321:           </div>,
012655| NOTE: JSX markup for search UI.
012656| src/components/SearchForm.tsx:1322:           document.body,
012657| NOTE: Implementation detail supporting search page behavior.
012658| src/components/SearchForm.tsx:1323:         )}
012659| NOTE: Implementation detail supporting search page behavior.
012660| src/components/SearchForm.tsx:1324:     </div>
012661| NOTE: JSX markup for search UI.
012662| src/components/SearchForm.tsx:1325:   );
012663| NOTE: Implementation detail supporting search page behavior.
012664| src/components/SearchForm.tsx:1326: }
012665| NOTE: Implementation detail supporting search page behavior.
012666| FILE END: src/components/SearchForm.tsx
012667| 
012668| FILE START: src/components/SearchHeaderWrapper.tsx
012669| FILE ROLE: Collapsible mobile header wrapper for SearchForm.
012670| src/components/SearchHeaderWrapper.tsx:1: "use client";
012671| NOTE: Implementation detail supporting search page behavior.
012672| src/components/SearchHeaderWrapper.tsx:2: 
012673| NOTE: Blank line for visual separation.
012674| src/components/SearchHeaderWrapper.tsx:3: /**
012675| NOTE: Block comment line describing behavior or context.
012676| src/components/SearchHeaderWrapper.tsx:4:  * SearchHeaderWrapper - Manages collapsible header on mobile
012677| NOTE: Block comment line describing behavior or context.
012678| src/components/SearchHeaderWrapper.tsx:5:  *
012679| NOTE: Block comment line describing behavior or context.
012680| src/components/SearchHeaderWrapper.tsx:6:  * On mobile:
012681| NOTE: Block comment line describing behavior or context.
012682| src/components/SearchHeaderWrapper.tsx:7:  * - Shows full SearchForm when at top or manually expanded
012683| NOTE: Block comment line describing behavior or context.
012684| src/components/SearchHeaderWrapper.tsx:8:  * - Shows collapsed bar when scrolled down
012685| NOTE: Block comment line describing behavior or context.
012686| src/components/SearchHeaderWrapper.tsx:9:  * - Collapsed bar shows location summary and filter access
012687| NOTE: Block comment line describing behavior or context.
012688| src/components/SearchHeaderWrapper.tsx:10:  *
012689| NOTE: Block comment line describing behavior or context.
012690| src/components/SearchHeaderWrapper.tsx:11:  * On desktop:
012691| NOTE: Block comment line describing behavior or context.
012692| src/components/SearchHeaderWrapper.tsx:12:  * - Always shows full SearchForm
012693| NOTE: Block comment line describing behavior or context.
012694| src/components/SearchHeaderWrapper.tsx:13:  */
012695| NOTE: Block comment line describing behavior or context.
012696| src/components/SearchHeaderWrapper.tsx:14: 
012697| NOTE: Blank line for visual separation.
012698| src/components/SearchHeaderWrapper.tsx:15: import { Suspense } from "react";
012699| NOTE: Imports dependency for this module.
012700| src/components/SearchHeaderWrapper.tsx:16: import { useScrollHeader } from "@/hooks/useScrollHeader";
012701| NOTE: Imports dependency for this module.
012702| src/components/SearchHeaderWrapper.tsx:17: import { useMobileSearch } from "@/contexts/MobileSearchContext";
012703| NOTE: Imports dependency for this module.
012704| src/components/SearchHeaderWrapper.tsx:18: import CollapsedMobileSearch from "@/components/CollapsedMobileSearch";
012705| NOTE: Imports dependency for this module.
012706| src/components/SearchHeaderWrapper.tsx:19: import SearchForm from "@/components/SearchForm";
012707| NOTE: Imports dependency for this module.
012708| src/components/SearchHeaderWrapper.tsx:20: 
012709| NOTE: Blank line for visual separation.
012710| src/components/SearchHeaderWrapper.tsx:21: export default function SearchHeaderWrapper() {
012711| NOTE: Exports main component for this module.
012712| src/components/SearchHeaderWrapper.tsx:22:   const { isCollapsed } = useScrollHeader({ threshold: 80 });
012713| NOTE: Local declaration used by search logic or UI.
012714| src/components/SearchHeaderWrapper.tsx:23:   const { isExpanded, expand, openFilters } = useMobileSearch();
012715| NOTE: Local declaration used by search logic or UI.
012716| src/components/SearchHeaderWrapper.tsx:24: 
012717| NOTE: Blank line for visual separation.
012718| src/components/SearchHeaderWrapper.tsx:25:   // Show collapsed bar on mobile when scrolled and not manually expanded
012719| NOTE: Line comment documents intent or constraints.
012720| src/components/SearchHeaderWrapper.tsx:26:   const showCollapsed = isCollapsed && !isExpanded;
012721| NOTE: Local declaration used by search logic or UI.
012722| src/components/SearchHeaderWrapper.tsx:27: 
012723| NOTE: Blank line for visual separation.
012724| src/components/SearchHeaderWrapper.tsx:28:   return (
012725| NOTE: Return statement for component or helper output.
012726| src/components/SearchHeaderWrapper.tsx:29:     <>
012727| NOTE: JSX markup for search UI.
012728| src/components/SearchHeaderWrapper.tsx:30:       {/* Full search form - hidden on mobile when collapsed */}
012729| NOTE: Implementation detail supporting search page behavior.
012730| src/components/SearchHeaderWrapper.tsx:31:       <div
012731| NOTE: JSX markup for search UI.
012732| src/components/SearchHeaderWrapper.tsx:32:         className={`transition-all duration-300 ease-out ${
012733| NOTE: Tailwind classes define layout and styling.
012734| src/components/SearchHeaderWrapper.tsx:33:           showCollapsed ? "md:block hidden" : "block"
012735| NOTE: Implementation detail supporting search page behavior.
012736| src/components/SearchHeaderWrapper.tsx:34:         }`}
012737| NOTE: Implementation detail supporting search page behavior.
012738| src/components/SearchHeaderWrapper.tsx:35:       >
012739| NOTE: Implementation detail supporting search page behavior.
012740| src/components/SearchHeaderWrapper.tsx:36:         <div className="w-full max-w-[1920px] mx-auto px-3 sm:px-4 md:px-6 py-3 sm:py-4">
012741| NOTE: Tailwind classes define layout and styling.
012742| src/components/SearchHeaderWrapper.tsx:37:           <Suspense
012743| NOTE: JSX markup for search UI.
012744| src/components/SearchHeaderWrapper.tsx:38:             fallback={
012745| NOTE: Implementation detail supporting search page behavior.
012746| src/components/SearchHeaderWrapper.tsx:39:               <div className="h-14 sm:h-16 w-full bg-zinc-100 dark:bg-zinc-800 animate-pulse rounded-full" />
012747| NOTE: Tailwind classes define layout and styling.
012748| src/components/SearchHeaderWrapper.tsx:40:             }
012749| NOTE: Implementation detail supporting search page behavior.
012750| src/components/SearchHeaderWrapper.tsx:41:           >
012751| NOTE: Implementation detail supporting search page behavior.
012752| src/components/SearchHeaderWrapper.tsx:42:             <SearchForm />
012753| NOTE: JSX markup for search UI.
012754| src/components/SearchHeaderWrapper.tsx:43:           </Suspense>
012755| NOTE: JSX markup for search UI.
012756| src/components/SearchHeaderWrapper.tsx:44:         </div>
012757| NOTE: JSX markup for search UI.
012758| src/components/SearchHeaderWrapper.tsx:45:       </div>
012759| NOTE: JSX markup for search UI.
012760| src/components/SearchHeaderWrapper.tsx:46: 
012761| NOTE: Blank line for visual separation.
012762| src/components/SearchHeaderWrapper.tsx:47:       {/* Collapsed search bar - visible on mobile only when collapsed */}
012763| NOTE: Implementation detail supporting search page behavior.
012764| src/components/SearchHeaderWrapper.tsx:48:       <div
012765| NOTE: JSX markup for search UI.
012766| src/components/SearchHeaderWrapper.tsx:49:         className={`transition-all duration-300 ease-out ${
012767| NOTE: Tailwind classes define layout and styling.
012768| src/components/SearchHeaderWrapper.tsx:50:           showCollapsed ? "md:hidden block py-2" : "hidden"
012769| NOTE: Implementation detail supporting search page behavior.
012770| src/components/SearchHeaderWrapper.tsx:51:         }`}
012771| NOTE: Implementation detail supporting search page behavior.
012772| src/components/SearchHeaderWrapper.tsx:52:       >
012773| NOTE: Implementation detail supporting search page behavior.
012774| src/components/SearchHeaderWrapper.tsx:53:         <CollapsedMobileSearch onExpand={expand} onOpenFilters={openFilters} />
012775| NOTE: JSX markup for search UI.
012776| src/components/SearchHeaderWrapper.tsx:54:       </div>
012777| NOTE: JSX markup for search UI.
012778| src/components/SearchHeaderWrapper.tsx:55:     </>
012779| NOTE: JSX markup for search UI.
012780| src/components/SearchHeaderWrapper.tsx:56:   );
012781| NOTE: Implementation detail supporting search page behavior.
012782| src/components/SearchHeaderWrapper.tsx:57: }
012783| NOTE: Implementation detail supporting search page behavior.
012784| FILE END: src/components/SearchHeaderWrapper.tsx
012785| 
012786| FILE START: src/components/SearchLayoutView.tsx
012787| FILE ROLE: Client split-view controller for list/map and mobile toggles.
012788| src/components/SearchLayoutView.tsx:1: "use client";
012789| NOTE: Implementation detail supporting search page behavior.
012790| src/components/SearchLayoutView.tsx:2: 
012791| NOTE: Blank line for visual separation.
012792| src/components/SearchLayoutView.tsx:3: /**
012793| NOTE: Block comment line describing behavior or context.
012794| src/components/SearchLayoutView.tsx:4:  * SearchLayoutView - Layout-level view component for search page
012795| NOTE: Block comment line describing behavior or context.
012796| src/components/SearchLayoutView.tsx:5:  *
012797| NOTE: Block comment line describing behavior or context.
012798| src/components/SearchLayoutView.tsx:6:  * This component handles the mobile/desktop split view for the search page.
012799| NOTE: Block comment line describing behavior or context.
012800| src/components/SearchLayoutView.tsx:7:  * It's designed to work with the layout.tsx architecture where the map
012801| NOTE: Block comment line describing behavior or context.
012802| src/components/SearchLayoutView.tsx:8:  * is persistent and children (page content) can suspend independently.
012803| NOTE: Block comment line describing behavior or context.
012804| src/components/SearchLayoutView.tsx:9:  *
012805| NOTE: Block comment line describing behavior or context.
012806| src/components/SearchLayoutView.tsx:10:  * Cost optimization (Phase 1):
012807| NOTE: Block comment line describing behavior or context.
012808| src/components/SearchLayoutView.tsx:11:  * - Mobile defaults to list-only view (no map initialization)
012809| NOTE: Block comment line describing behavior or context.
012810| src/components/SearchLayoutView.tsx:12:  * - Desktop has "Hide map" toggle to opt out of map
012811| NOTE: Block comment line describing behavior or context.
012812| src/components/SearchLayoutView.tsx:13:  * - Map only loads when user chooses to see it
012813| NOTE: Block comment line describing behavior or context.
012814| src/components/SearchLayoutView.tsx:14:  * - Preference is persisted in localStorage
012815| NOTE: Block comment line describing behavior or context.
012816| src/components/SearchLayoutView.tsx:15:  *
012817| NOTE: Block comment line describing behavior or context.
012818| src/components/SearchLayoutView.tsx:16:  * Hydration race condition fix:
012819| NOTE: Block comment line describing behavior or context.
012820| src/components/SearchLayoutView.tsx:17:  * - During hydration (isLoading=true), showMap requests are queued
012821| NOTE: Block comment line describing behavior or context.
012822| src/components/SearchLayoutView.tsx:18:  * - After hydration completes, queued requests are executed
012823| NOTE: Block comment line describing behavior or context.
012824| src/components/SearchLayoutView.tsx:19:  * - This ensures "View on Map" button works even when clicked during hydration
012825| NOTE: Block comment line describing behavior or context.
012826| src/components/SearchLayoutView.tsx:20:  */
012827| NOTE: Block comment line describing behavior or context.
012828| src/components/SearchLayoutView.tsx:21: 
012829| NOTE: Blank line for visual separation.
012830| src/components/SearchLayoutView.tsx:22: import { Suspense, useRef, useEffect, useCallback } from "react";
012831| NOTE: Imports dependency for this module.
012832| src/components/SearchLayoutView.tsx:23: import { Map, List, X, MapIcon } from "lucide-react";
012833| NOTE: Imports dependency for this module.
012834| src/components/SearchLayoutView.tsx:24: import { cn } from "@/lib/utils";
012835| NOTE: Imports dependency for this module.
012836| src/components/SearchLayoutView.tsx:25: import { useMapPreference } from "@/hooks/useMapPreference";
012837| NOTE: Imports dependency for this module.
012838| src/components/SearchLayoutView.tsx:26: import { useMapMovedBanner } from "@/contexts/MapBoundsContext";
012839| NOTE: Imports dependency for this module.
012840| src/components/SearchLayoutView.tsx:27: import { useSearchTransitionSafe } from "@/contexts/SearchTransitionContext";
012841| NOTE: Imports dependency for this module.
012842| src/components/SearchLayoutView.tsx:28: import { MapMovedBanner } from "./map/MapMovedBanner";
012843| NOTE: Imports dependency for this module.
012844| src/components/SearchLayoutView.tsx:29: import { PendingFiltersBanner } from "./filters/PendingFiltersBanner";
012845| NOTE: Imports dependency for this module.
012846| src/components/SearchLayoutView.tsx:30: import { AppliedFilterChips } from "./filters/AppliedFilterChips";
012847| NOTE: Imports dependency for this module.
012848| src/components/SearchLayoutView.tsx:31: import PersistentMapWrapper from "./PersistentMapWrapper";
012849| NOTE: Imports dependency for this module.
012850| src/components/SearchLayoutView.tsx:32: import ListScrollBridge from "./listings/ListScrollBridge";
012851| NOTE: Imports dependency for this module.
012852| src/components/SearchLayoutView.tsx:33: import { SearchMapUIProvider } from "@/contexts/SearchMapUIContext";
012853| NOTE: Imports dependency for this module.
012854| src/components/SearchLayoutView.tsx:34: 
012855| NOTE: Blank line for visual separation.
012856| src/components/SearchLayoutView.tsx:35: interface SearchLayoutViewProps {
012857| NOTE: Type declaration for search data contracts.
012858| src/components/SearchLayoutView.tsx:36:   children: React.ReactNode;
012859| NOTE: Implementation detail supporting search page behavior.
012860| src/components/SearchLayoutView.tsx:37: }
012861| NOTE: Implementation detail supporting search page behavior.
012862| src/components/SearchLayoutView.tsx:38: 
012863| NOTE: Blank line for visual separation.
012864| src/components/SearchLayoutView.tsx:39: // Placeholder shown when map is hidden (desktop)
012865| NOTE: Line comment documents intent or constraints.
012866| src/components/SearchLayoutView.tsx:40: function MapPlaceholder({ onShowMap }: { onShowMap: () => void }) {
012867| NOTE: Defines a helper or component function.
012868| src/components/SearchLayoutView.tsx:41:   return (
012869| NOTE: Return statement for component or helper output.
012870| src/components/SearchLayoutView.tsx:42:     <div className="w-full h-full bg-zinc-50 dark:bg-zinc-900 flex items-center justify-center">
012871| NOTE: Tailwind classes define layout and styling.
012872| src/components/SearchLayoutView.tsx:43:       <button
012873| NOTE: JSX markup for search UI.
012874| src/components/SearchLayoutView.tsx:44:         onClick={onShowMap}
012875| NOTE: Implementation detail supporting search page behavior.
012876| src/components/SearchLayoutView.tsx:45:         className="flex flex-col items-center gap-3 p-6 rounded-2xl bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-sm hover:shadow-md hover:border-zinc-300 dark:hover:border-zinc-600 transition-all"
012877| NOTE: Tailwind classes define layout and styling.
012878| src/components/SearchLayoutView.tsx:46:       >
012879| NOTE: Implementation detail supporting search page behavior.
012880| src/components/SearchLayoutView.tsx:47:         <MapIcon className="w-10 h-10 text-zinc-400 dark:text-zinc-500" />
012881| NOTE: Tailwind classes define layout and styling.
012882| src/components/SearchLayoutView.tsx:48:         <span className="text-sm font-medium text-zinc-600 dark:text-zinc-400">
012883| NOTE: Tailwind classes define layout and styling.
012884| src/components/SearchLayoutView.tsx:49:           Show Map
012885| NOTE: Implementation detail supporting search page behavior.
012886| src/components/SearchLayoutView.tsx:50:         </span>
012887| NOTE: JSX markup for search UI.
012888| src/components/SearchLayoutView.tsx:51:       </button>
012889| NOTE: JSX markup for search UI.
012890| src/components/SearchLayoutView.tsx:52:     </div>
012891| NOTE: JSX markup for search UI.
012892| src/components/SearchLayoutView.tsx:53:   );
012893| NOTE: Implementation detail supporting search page behavior.
012894| src/components/SearchLayoutView.tsx:54: }
012895| NOTE: Implementation detail supporting search page behavior.
012896| src/components/SearchLayoutView.tsx:55: 
012897| NOTE: Blank line for visual separation.
012898| src/components/SearchLayoutView.tsx:56: // Loading fallback for map
012899| NOTE: Line comment documents intent or constraints.
012900| src/components/SearchLayoutView.tsx:57: function MapLoadingFallback() {
012901| NOTE: Defines a helper or component function.
012902| src/components/SearchLayoutView.tsx:58:   return (
012903| NOTE: Return statement for component or helper output.
012904| src/components/SearchLayoutView.tsx:59:     <div
012905| NOTE: JSX markup for search UI.
012906| src/components/SearchLayoutView.tsx:60:       className="w-full h-full bg-zinc-100 dark:bg-zinc-800 animate-pulse flex items-center justify-center"
012907| NOTE: Tailwind classes define layout and styling.
012908| src/components/SearchLayoutView.tsx:61:       data-testid="map-loading-fallback"
012909| NOTE: Implementation detail supporting search page behavior.
012910| src/components/SearchLayoutView.tsx:62:     >
012911| NOTE: Implementation detail supporting search page behavior.
012912| src/components/SearchLayoutView.tsx:63:       <div className="text-zinc-400 dark:text-zinc-500 text-sm">
012913| NOTE: Tailwind classes define layout and styling.
012914| src/components/SearchLayoutView.tsx:64:         Loading map...
012915| NOTE: Implementation detail supporting search page behavior.
012916| src/components/SearchLayoutView.tsx:65:       </div>
012917| NOTE: JSX markup for search UI.
012918| src/components/SearchLayoutView.tsx:66:     </div>
012919| NOTE: JSX markup for search UI.
012920| src/components/SearchLayoutView.tsx:67:   );
012921| NOTE: Implementation detail supporting search page behavior.
012922| src/components/SearchLayoutView.tsx:68: }
012923| NOTE: Implementation detail supporting search page behavior.
012924| src/components/SearchLayoutView.tsx:69: 
012925| NOTE: Blank line for visual separation.
012926| src/components/SearchLayoutView.tsx:70: /**
012927| NOTE: Block comment line describing behavior or context.
012928| src/components/SearchLayoutView.tsx:71:  * Small non-blocking badge shown during slow transitions.
012929| NOTE: Block comment line describing behavior or context.
012930| src/components/SearchLayoutView.tsx:72:  * Only appears after a delay to avoid flash for fast loads.
012931| NOTE: Block comment line describing behavior or context.
012932| src/components/SearchLayoutView.tsx:73:  */
012933| NOTE: Block comment line describing behavior or context.
012934| src/components/SearchLayoutView.tsx:74: function SlowTransitionBadge() {
012935| NOTE: Defines a helper or component function.
012936| src/components/SearchLayoutView.tsx:75:   return (
012937| NOTE: Return statement for component or helper output.
012938| src/components/SearchLayoutView.tsx:76:     <div
012939| NOTE: JSX markup for search UI.
012940| src/components/SearchLayoutView.tsx:77:       className="absolute top-4 left-1/2 -translate-x-1/2 z-10 pointer-events-none"
012941| NOTE: Tailwind classes define layout and styling.
012942| src/components/SearchLayoutView.tsx:78:       role="status"
012943| NOTE: Implementation detail supporting search page behavior.
012944| src/components/SearchLayoutView.tsx:79:       aria-live="polite"
012945| NOTE: Accessibility attribute for screen readers.
012946| src/components/SearchLayoutView.tsx:80:     >
012947| NOTE: Implementation detail supporting search page behavior.
012948| src/components/SearchLayoutView.tsx:81:       <span className="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-zinc-800 rounded-full shadow-md border border-zinc-200 dark:border-zinc-700 text-xs font-medium text-zinc-500 dark:text-zinc-400">
012949| NOTE: Tailwind classes define layout and styling.
012950| src/components/SearchLayoutView.tsx:82:         <span className="w-1.5 h-1.5 rounded-full bg-zinc-400 dark:bg-zinc-500 animate-pulse" />
012951| NOTE: Tailwind classes define layout and styling.
012952| src/components/SearchLayoutView.tsx:83:         Still loading...
012953| NOTE: Implementation detail supporting search page behavior.
012954| src/components/SearchLayoutView.tsx:84:       </span>
012955| NOTE: JSX markup for search UI.
012956| src/components/SearchLayoutView.tsx:85:     </div>
012957| NOTE: JSX markup for search UI.
012958| src/components/SearchLayoutView.tsx:86:   );
012959| NOTE: Implementation detail supporting search page behavior.
012960| src/components/SearchLayoutView.tsx:87: }
012961| NOTE: Implementation detail supporting search page behavior.
012962| src/components/SearchLayoutView.tsx:88: 
012963| NOTE: Blank line for visual separation.
012964| src/components/SearchLayoutView.tsx:89: export default function SearchLayoutView({ children }: SearchLayoutViewProps) {
012965| NOTE: Exports main component for this module.
012966| src/components/SearchLayoutView.tsx:90:   const {
012967| NOTE: Local declaration used by search logic or UI.
012968| src/components/SearchLayoutView.tsx:91:     shouldShowMap,
012969| NOTE: Implementation detail supporting search page behavior.
012970| src/components/SearchLayoutView.tsx:92:     shouldRenderMap,
012971| NOTE: Implementation detail supporting search page behavior.
012972| src/components/SearchLayoutView.tsx:93:     toggleMap,
012973| NOTE: Implementation detail supporting search page behavior.
012974| src/components/SearchLayoutView.tsx:94:     showMap,
012975| NOTE: Implementation detail supporting search page behavior.
012976| src/components/SearchLayoutView.tsx:95:     hideMap,
012977| NOTE: Implementation detail supporting search page behavior.
012978| src/components/SearchLayoutView.tsx:96:     isMobile,
012979| NOTE: Implementation detail supporting search page behavior.
012980| src/components/SearchLayoutView.tsx:97:     isLoading,
012981| NOTE: Implementation detail supporting search page behavior.
012982| src/components/SearchLayoutView.tsx:98:   } = useMapPreference();
012983| NOTE: Implementation detail supporting search page behavior.
012984| src/components/SearchLayoutView.tsx:99: 
012985| NOTE: Blank line for visual separation.
012986| src/components/SearchLayoutView.tsx:100:   const { showBanner, showLocationConflict, locationName, onSearch, onReset } =
012987| NOTE: Local declaration used by search logic or UI.
012988| src/components/SearchLayoutView.tsx:101:     useMapMovedBanner();
012989| NOTE: Implementation detail supporting search page behavior.
012990| src/components/SearchLayoutView.tsx:102:   const transitionContext = useSearchTransitionSafe();
012991| NOTE: Local declaration used by search logic or UI.
012992| src/components/SearchLayoutView.tsx:103:   const isPending = transitionContext?.isPending ?? false;
012993| NOTE: Local declaration used by search logic or UI.
012994| src/components/SearchLayoutView.tsx:104:   const isSlowTransition = transitionContext?.isSlowTransition ?? false;
012995| NOTE: Local declaration used by search logic or UI.
012996| src/components/SearchLayoutView.tsx:105: 
012997| NOTE: Blank line for visual separation.
012998| src/components/SearchLayoutView.tsx:106:   // Track pending showMap request during hydration
012999| NOTE: Line comment documents intent or constraints.
013000| src/components/SearchLayoutView.tsx:107:   // This ref persists across renders and is checked when hydration completes
013001| NOTE: Line comment documents intent or constraints.
013002| src/components/SearchLayoutView.tsx:108:   const pendingShowMapRef = useRef(false);
013003| NOTE: Uses ref for stable mutable storage between renders.
013004| src/components/SearchLayoutView.tsx:109: 
013005| NOTE: Blank line for visual separation.
013006| src/components/SearchLayoutView.tsx:110:   // Queued showMap function that works during hydration
013007| NOTE: Line comment documents intent or constraints.
013008| src/components/SearchLayoutView.tsx:111:   // Instead of being a no-op, it queues the request for later execution
013009| NOTE: Line comment documents intent or constraints.
013010| src/components/SearchLayoutView.tsx:112:   const queuedShowMap = useCallback(() => {
013011| NOTE: Memoizes callback to preserve references across renders.
013012| src/components/SearchLayoutView.tsx:113:     pendingShowMapRef.current = true;
013013| NOTE: Implementation detail supporting search page behavior.
013014| src/components/SearchLayoutView.tsx:114:   }, []);
013015| NOTE: Implementation detail supporting search page behavior.
013016| src/components/SearchLayoutView.tsx:115: 
013017| NOTE: Blank line for visual separation.
013018| src/components/SearchLayoutView.tsx:116:   // After hydration completes, execute any queued showMap requests
013019| NOTE: Line comment documents intent or constraints.
013020| src/components/SearchLayoutView.tsx:117:   // This effect runs when isLoading transitions from true to false
013021| NOTE: Line comment documents intent or constraints.
013022| src/components/SearchLayoutView.tsx:118:   useEffect(() => {
013023| NOTE: Defines side effect for syncing with external state.
013024| src/components/SearchLayoutView.tsx:119:     if (!isLoading && pendingShowMapRef.current) {
013025| NOTE: Conditional logic controlling rendering or flow.
013026| src/components/SearchLayoutView.tsx:120:       pendingShowMapRef.current = false;
013027| NOTE: Implementation detail supporting search page behavior.
013028| src/components/SearchLayoutView.tsx:121:       showMap();
013029| NOTE: Implementation detail supporting search page behavior.
013030| src/components/SearchLayoutView.tsx:122:     }
013031| NOTE: Implementation detail supporting search page behavior.
013032| src/components/SearchLayoutView.tsx:123:   }, [isLoading, showMap]);
013033| NOTE: Implementation detail supporting search page behavior.
013034| src/components/SearchLayoutView.tsx:124: 
013035| NOTE: Blank line for visual separation.
013036| src/components/SearchLayoutView.tsx:125:   // During hydration, show a neutral state to prevent flash
013037| NOTE: Line comment documents intent or constraints.
013038| src/components/SearchLayoutView.tsx:126:   // Wrap with provider (queued showMap) to maintain consistent context tree
013039| NOTE: Line comment documents intent or constraints.
013040| src/components/SearchLayoutView.tsx:127:   // Any showMap calls during this period will be queued and executed post-hydration
013041| NOTE: Line comment documents intent or constraints.
013042| src/components/SearchLayoutView.tsx:128:   if (isLoading) {
013043| NOTE: Conditional logic controlling rendering or flow.
013044| src/components/SearchLayoutView.tsx:129:     return (
013045| NOTE: Return statement for component or helper output.
013046| src/components/SearchLayoutView.tsx:130:       <SearchMapUIProvider showMap={queuedShowMap} shouldShowMap={false}>
013047| NOTE: JSX markup for search UI.
013048| src/components/SearchLayoutView.tsx:131:         <>
013049| NOTE: JSX markup for search UI.
013050| src/components/SearchLayoutView.tsx:132:           {/* Mobile: Show list by default during hydration */}
013051| NOTE: Implementation detail supporting search page behavior.
013052| src/components/SearchLayoutView.tsx:133:           <div className="md:hidden flex-1 flex overflow-hidden">
013053| NOTE: Tailwind classes define layout and styling.
013054| src/components/SearchLayoutView.tsx:134:             <div className="w-full h-full overflow-y-auto scrollbar-hide">
013055| NOTE: Tailwind classes define layout and styling.
013056| src/components/SearchLayoutView.tsx:135:               {children}
013057| NOTE: Implementation detail supporting search page behavior.
013058| src/components/SearchLayoutView.tsx:136:             </div>
013059| NOTE: JSX markup for search UI.
013060| src/components/SearchLayoutView.tsx:137:           </div>
013061| NOTE: JSX markup for search UI.
013062| src/components/SearchLayoutView.tsx:138: 
013063| NOTE: Blank line for visual separation.
013064| src/components/SearchLayoutView.tsx:139:           {/* Desktop: Show split view with loading placeholder during hydration */}
013065| NOTE: Implementation detail supporting search page behavior.
013066| src/components/SearchLayoutView.tsx:140:           <div className="hidden md:flex flex-1 overflow-hidden">
013067| NOTE: Tailwind classes define layout and styling.
013068| src/components/SearchLayoutView.tsx:141:             <div className="w-1/2 h-full overflow-y-auto scrollbar-hide">
013069| NOTE: Tailwind classes define layout and styling.
013070| src/components/SearchLayoutView.tsx:142:               {children}
013071| NOTE: Implementation detail supporting search page behavior.
013072| src/components/SearchLayoutView.tsx:143:             </div>
013073| NOTE: JSX markup for search UI.
013074| src/components/SearchLayoutView.tsx:144:             <div className="flex-1 relative border-l border-zinc-200 dark:border-zinc-800">
013075| NOTE: Tailwind classes define layout and styling.
013076| src/components/SearchLayoutView.tsx:145:               <MapLoadingFallback />
013077| NOTE: JSX markup for search UI.
013078| src/components/SearchLayoutView.tsx:146:             </div>
013079| NOTE: JSX markup for search UI.
013080| src/components/SearchLayoutView.tsx:147:           </div>
013081| NOTE: JSX markup for search UI.
013082| src/components/SearchLayoutView.tsx:148:         </>
013083| NOTE: JSX markup for search UI.
013084| src/components/SearchLayoutView.tsx:149:       </SearchMapUIProvider>
013085| NOTE: JSX markup for search UI.
013086| src/components/SearchLayoutView.tsx:150:     );
013087| NOTE: Implementation detail supporting search page behavior.
013088| src/components/SearchLayoutView.tsx:151:   }
013089| NOTE: Implementation detail supporting search page behavior.
013090| src/components/SearchLayoutView.tsx:152: 
013091| NOTE: Blank line for visual separation.
013092| src/components/SearchLayoutView.tsx:153:   return (
013093| NOTE: Return statement for component or helper output.
013094| src/components/SearchLayoutView.tsx:154:     <SearchMapUIProvider showMap={showMap} shouldShowMap={shouldShowMap}>
013095| NOTE: JSX markup for search UI.
013096| src/components/SearchLayoutView.tsx:155:       {/* Centralized scroll bridge - single owner of scroll-to-card behavior */}
013097| NOTE: Implementation detail supporting search page behavior.
013098| src/components/SearchLayoutView.tsx:156:       <ListScrollBridge />
013099| NOTE: JSX markup for search UI.
013100| src/components/SearchLayoutView.tsx:157: 
013101| NOTE: Blank line for visual separation.
013102| src/components/SearchLayoutView.tsx:158:       {/* Mobile View Toggle Button - Fixed at bottom */}
013103| NOTE: Implementation detail supporting search page behavior.
013104| src/components/SearchLayoutView.tsx:159:       <div className="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-50">
013105| NOTE: Tailwind classes define layout and styling.
013106| src/components/SearchLayoutView.tsx:160:         <button
013107| NOTE: JSX markup for search UI.
013108| src/components/SearchLayoutView.tsx:161:           onClick={toggleMap}
013109| NOTE: Implementation detail supporting search page behavior.
013110| src/components/SearchLayoutView.tsx:162:           className="flex items-center gap-2 px-5 py-3 bg-zinc-900 text-white rounded-full shadow-lg shadow-zinc-900/25 hover:bg-zinc-800 transition-colors touch-target"
013111| NOTE: Tailwind classes define layout and styling.
013112| src/components/SearchLayoutView.tsx:163:           aria-label={shouldShowMap ? "Show list view" : "Show map view"}
013113| NOTE: Accessibility attribute for screen readers.
013114| src/components/SearchLayoutView.tsx:164:         >
013115| NOTE: Implementation detail supporting search page behavior.
013116| src/components/SearchLayoutView.tsx:165:           {shouldShowMap ? (
013117| NOTE: Implementation detail supporting search page behavior.
013118| src/components/SearchLayoutView.tsx:166:             <>
013119| NOTE: JSX markup for search UI.
013120| src/components/SearchLayoutView.tsx:167:               <List className="w-5 h-5" />
013121| NOTE: Tailwind classes define layout and styling.
013122| src/components/SearchLayoutView.tsx:168:               <span className="text-sm font-medium">Show List</span>
013123| NOTE: Tailwind classes define layout and styling.
013124| src/components/SearchLayoutView.tsx:169:             </>
013125| NOTE: JSX markup for search UI.
013126| src/components/SearchLayoutView.tsx:170:           ) : (
013127| NOTE: Implementation detail supporting search page behavior.
013128| src/components/SearchLayoutView.tsx:171:             <>
013129| NOTE: JSX markup for search UI.
013130| src/components/SearchLayoutView.tsx:172:               <Map className="w-5 h-5" />
013131| NOTE: Tailwind classes define layout and styling.
013132| src/components/SearchLayoutView.tsx:173:               <span className="text-sm font-medium">Show Map</span>
013133| NOTE: Tailwind classes define layout and styling.
013134| src/components/SearchLayoutView.tsx:174:             </>
013135| NOTE: JSX markup for search UI.
013136| src/components/SearchLayoutView.tsx:175:           )}
013137| NOTE: Implementation detail supporting search page behavior.
013138| src/components/SearchLayoutView.tsx:176:         </button>
013139| NOTE: JSX markup for search UI.
013140| src/components/SearchLayoutView.tsx:177:       </div>
013141| NOTE: JSX markup for search UI.
013142| src/components/SearchLayoutView.tsx:178: 
013143| NOTE: Blank line for visual separation.
013144| src/components/SearchLayoutView.tsx:179:       {/* Mobile Views */}
013145| NOTE: Implementation detail supporting search page behavior.
013146| src/components/SearchLayoutView.tsx:180:       <div className="md:hidden flex-1 flex overflow-hidden">
013147| NOTE: Tailwind classes define layout and styling.
013148| src/components/SearchLayoutView.tsx:181:         {/* List View - shown when map is hidden */}
013149| NOTE: Implementation detail supporting search page behavior.
013150| src/components/SearchLayoutView.tsx:182:         {!shouldShowMap && (
013151| NOTE: Implementation detail supporting search page behavior.
013152| src/components/SearchLayoutView.tsx:183:           <div className="w-full h-full overflow-y-auto scrollbar-hide flex flex-col">
013153| NOTE: Tailwind classes define layout and styling.
013154| src/components/SearchLayoutView.tsx:184:             {/* Pending filters banner - shows when filters changed but not applied */}
013155| NOTE: Implementation detail supporting search page behavior.
013156| src/components/SearchLayoutView.tsx:185:             <PendingFiltersBanner />
013157| NOTE: JSX markup for search UI.
013158| src/components/SearchLayoutView.tsx:186:             {/* Applied filter chips - shows removable chips for active filters */}
013159| NOTE: Implementation detail supporting search page behavior.
013160| src/components/SearchLayoutView.tsx:187:             <AppliedFilterChips />
013161| NOTE: JSX markup for search UI.
013162| src/components/SearchLayoutView.tsx:188:             {/* Map moved banner - shows when user has panned map or location conflict */}
013163| NOTE: Implementation detail supporting search page behavior.
013164| src/components/SearchLayoutView.tsx:189:             {(showBanner || showLocationConflict) && (
013165| NOTE: Implementation detail supporting search page behavior.
013166| src/components/SearchLayoutView.tsx:190:               <MapMovedBanner
013167| NOTE: JSX markup for search UI.
013168| src/components/SearchLayoutView.tsx:191:                 variant="list"
013169| NOTE: Implementation detail supporting search page behavior.
013170| src/components/SearchLayoutView.tsx:192:                 onSearch={onSearch}
013171| NOTE: Implementation detail supporting search page behavior.
013172| src/components/SearchLayoutView.tsx:193:                 onReset={onReset}
013173| NOTE: Implementation detail supporting search page behavior.
013174| src/components/SearchLayoutView.tsx:194:                 isLocationConflict={showLocationConflict}
013175| NOTE: Implementation detail supporting search page behavior.
013176| src/components/SearchLayoutView.tsx:195:                 locationName={locationName}
013177| NOTE: Implementation detail supporting search page behavior.
013178| src/components/SearchLayoutView.tsx:196:               />
013179| NOTE: Implementation detail supporting search page behavior.
013180| src/components/SearchLayoutView.tsx:197:             )}
013181| NOTE: Implementation detail supporting search page behavior.
013182| src/components/SearchLayoutView.tsx:198:             <div
013183| NOTE: JSX markup for search UI.
013184| src/components/SearchLayoutView.tsx:199:               className={cn(
013185| NOTE: Tailwind classes define layout and styling.
013186| src/components/SearchLayoutView.tsx:200:                 "flex-1 relative transition-opacity duration-200",
013187| NOTE: Implementation detail supporting search page behavior.
013188| src/components/SearchLayoutView.tsx:201:                 isPending && "opacity-60 pointer-events-none",
013189| NOTE: Implementation detail supporting search page behavior.
013190| src/components/SearchLayoutView.tsx:202:               )}
013191| NOTE: Implementation detail supporting search page behavior.
013192| src/components/SearchLayoutView.tsx:203:               data-testid="search-results-container"
013193| NOTE: Implementation detail supporting search page behavior.
013194| src/components/SearchLayoutView.tsx:204:               aria-busy={isPending}
013195| NOTE: Accessibility attribute for screen readers.
013196| src/components/SearchLayoutView.tsx:205:             >
013197| NOTE: Implementation detail supporting search page behavior.
013198| src/components/SearchLayoutView.tsx:206:               {isSlowTransition && <SlowTransitionBadge />}
013199| NOTE: Implementation detail supporting search page behavior.
013200| src/components/SearchLayoutView.tsx:207:               {children}
013201| NOTE: Implementation detail supporting search page behavior.
013202| src/components/SearchLayoutView.tsx:208:             </div>
013203| NOTE: JSX markup for search UI.
013204| src/components/SearchLayoutView.tsx:209:           </div>
013205| NOTE: JSX markup for search UI.
013206| src/components/SearchLayoutView.tsx:210:         )}
013207| NOTE: Implementation detail supporting search page behavior.
013208| src/components/SearchLayoutView.tsx:211: 
013209| NOTE: Blank line for visual separation.
013210| src/components/SearchLayoutView.tsx:212:         {/* Map View - only rendered when user opts in */}
013211| NOTE: Implementation detail supporting search page behavior.
013212| src/components/SearchLayoutView.tsx:213:         {shouldShowMap && (
013213| NOTE: Implementation detail supporting search page behavior.
013214| src/components/SearchLayoutView.tsx:214:           <div className="w-full h-full">
013215| NOTE: Tailwind classes define layout and styling.
013216| src/components/SearchLayoutView.tsx:215:             <Suspense fallback={<MapLoadingFallback />}>
013217| NOTE: JSX markup for search UI.
013218| src/components/SearchLayoutView.tsx:216:               <PersistentMapWrapper shouldRenderMap={shouldRenderMap} />
013219| NOTE: JSX markup for search UI.
013220| src/components/SearchLayoutView.tsx:217:             </Suspense>
013221| NOTE: JSX markup for search UI.
013222| src/components/SearchLayoutView.tsx:218:           </div>
013223| NOTE: JSX markup for search UI.
013224| src/components/SearchLayoutView.tsx:219:         )}
013225| NOTE: Implementation detail supporting search page behavior.
013226| src/components/SearchLayoutView.tsx:220:       </div>
013227| NOTE: JSX markup for search UI.
013228| src/components/SearchLayoutView.tsx:221: 
013229| NOTE: Blank line for visual separation.
013230| src/components/SearchLayoutView.tsx:222:       {/* Desktop Split View */}
013231| NOTE: Implementation detail supporting search page behavior.
013232| src/components/SearchLayoutView.tsx:223:       <div className="hidden md:flex flex-1 overflow-hidden">
013233| NOTE: Tailwind classes define layout and styling.
013234| src/components/SearchLayoutView.tsx:224:         {/* Left Panel: List View (page content - can suspend) */}
013235| NOTE: Implementation detail supporting search page behavior.
013236| src/components/SearchLayoutView.tsx:225:         <div
013237| NOTE: JSX markup for search UI.
013238| src/components/SearchLayoutView.tsx:226:           className={`h-full overflow-y-auto scrollbar-hide transition-all duration-300 flex flex-col ${
013239| NOTE: Tailwind classes define layout and styling.
013240| src/components/SearchLayoutView.tsx:227:             shouldShowMap ? "w-1/2" : "w-full"
013241| NOTE: Implementation detail supporting search page behavior.
013242| src/components/SearchLayoutView.tsx:228:           }`}
013243| NOTE: Implementation detail supporting search page behavior.
013244| src/components/SearchLayoutView.tsx:229:         >
013245| NOTE: Implementation detail supporting search page behavior.
013246| src/components/SearchLayoutView.tsx:230:           {/* Pending filters banner - shows when filters changed but not applied */}
013247| NOTE: Implementation detail supporting search page behavior.
013248| src/components/SearchLayoutView.tsx:231:           <PendingFiltersBanner />
013249| NOTE: JSX markup for search UI.
013250| src/components/SearchLayoutView.tsx:232:           {/* Applied filter chips - shows removable chips for active filters */}
013251| NOTE: Implementation detail supporting search page behavior.
013252| src/components/SearchLayoutView.tsx:233:           <AppliedFilterChips />
013253| NOTE: JSX markup for search UI.
013254| src/components/SearchLayoutView.tsx:234:           {/* Map moved banner - shows when user has panned map or location conflict */}
013255| NOTE: Implementation detail supporting search page behavior.
013256| src/components/SearchLayoutView.tsx:235:           {(showBanner || showLocationConflict) && (
013257| NOTE: Implementation detail supporting search page behavior.
013258| src/components/SearchLayoutView.tsx:236:             <MapMovedBanner
013259| NOTE: JSX markup for search UI.
013260| src/components/SearchLayoutView.tsx:237:               variant="list"
013261| NOTE: Implementation detail supporting search page behavior.
013262| src/components/SearchLayoutView.tsx:238:               onSearch={onSearch}
013263| NOTE: Implementation detail supporting search page behavior.
013264| src/components/SearchLayoutView.tsx:239:               onReset={onReset}
013265| NOTE: Implementation detail supporting search page behavior.
013266| src/components/SearchLayoutView.tsx:240:               isLocationConflict={showLocationConflict}
013267| NOTE: Implementation detail supporting search page behavior.
013268| src/components/SearchLayoutView.tsx:241:               locationName={locationName}
013269| NOTE: Implementation detail supporting search page behavior.
013270| src/components/SearchLayoutView.tsx:242:             />
013271| NOTE: Implementation detail supporting search page behavior.
013272| src/components/SearchLayoutView.tsx:243:           )}
013273| NOTE: Implementation detail supporting search page behavior.
013274| src/components/SearchLayoutView.tsx:244:           <div
013275| NOTE: JSX markup for search UI.
013276| src/components/SearchLayoutView.tsx:245:             className={cn(
013277| NOTE: Tailwind classes define layout and styling.
013278| src/components/SearchLayoutView.tsx:246:               "flex-1 relative transition-opacity duration-200",
013279| NOTE: Implementation detail supporting search page behavior.
013280| src/components/SearchLayoutView.tsx:247:               isPending && "opacity-60 pointer-events-none",
013281| NOTE: Implementation detail supporting search page behavior.
013282| src/components/SearchLayoutView.tsx:248:             )}
013283| NOTE: Implementation detail supporting search page behavior.
013284| src/components/SearchLayoutView.tsx:249:             data-testid="search-results-container"
013285| NOTE: Implementation detail supporting search page behavior.
013286| src/components/SearchLayoutView.tsx:250:             aria-busy={isPending}
013287| NOTE: Accessibility attribute for screen readers.
013288| src/components/SearchLayoutView.tsx:251:           >
013289| NOTE: Implementation detail supporting search page behavior.
013290| src/components/SearchLayoutView.tsx:252:             {isSlowTransition && <SlowTransitionBadge />}
013291| NOTE: Implementation detail supporting search page behavior.
013292| src/components/SearchLayoutView.tsx:253:             {children}
013293| NOTE: Implementation detail supporting search page behavior.
013294| src/components/SearchLayoutView.tsx:254:           </div>
013295| NOTE: JSX markup for search UI.
013296| src/components/SearchLayoutView.tsx:255:         </div>
013297| NOTE: JSX markup for search UI.
013298| src/components/SearchLayoutView.tsx:256: 
013299| NOTE: Blank line for visual separation.
013300| src/components/SearchLayoutView.tsx:257:         {/* Right Panel: Map View (conditional) */}
013301| NOTE: Implementation detail supporting search page behavior.
013302| src/components/SearchLayoutView.tsx:258:         {shouldShowMap ? (
013303| NOTE: Implementation detail supporting search page behavior.
013304| src/components/SearchLayoutView.tsx:259:           <div className="flex-1 relative border-l border-zinc-200 dark:border-zinc-800">
013305| NOTE: Tailwind classes define layout and styling.
013306| src/components/SearchLayoutView.tsx:260:             {/* Hide Map button */}
013307| NOTE: Implementation detail supporting search page behavior.
013308| src/components/SearchLayoutView.tsx:261:             <button
013309| NOTE: JSX markup for search UI.
013310| src/components/SearchLayoutView.tsx:262:               onClick={hideMap}
013311| NOTE: Implementation detail supporting search page behavior.
013312| src/components/SearchLayoutView.tsx:263:               className="absolute top-3 right-3 z-10 flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-sm hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-colors text-sm font-medium text-zinc-600 dark:text-zinc-300"
013313| NOTE: Tailwind classes define layout and styling.
013314| src/components/SearchLayoutView.tsx:264:               aria-label="Hide map"
013315| NOTE: Accessibility attribute for screen readers.
013316| src/components/SearchLayoutView.tsx:265:             >
013317| NOTE: Implementation detail supporting search page behavior.
013318| src/components/SearchLayoutView.tsx:266:               <X className="w-4 h-4" />
013319| NOTE: Tailwind classes define layout and styling.
013320| src/components/SearchLayoutView.tsx:267:               <span>Hide map</span>
013321| NOTE: JSX markup for search UI.
013322| src/components/SearchLayoutView.tsx:268:             </button>
013323| NOTE: JSX markup for search UI.
013324| src/components/SearchLayoutView.tsx:269: 
013325| NOTE: Blank line for visual separation.
013326| src/components/SearchLayoutView.tsx:270:             <Suspense fallback={<MapLoadingFallback />}>
013327| NOTE: JSX markup for search UI.
013328| src/components/SearchLayoutView.tsx:271:               <PersistentMapWrapper shouldRenderMap={shouldRenderMap} />
013329| NOTE: JSX markup for search UI.
013330| src/components/SearchLayoutView.tsx:272:             </Suspense>
013331| NOTE: JSX markup for search UI.
013332| src/components/SearchLayoutView.tsx:273:           </div>
013333| NOTE: JSX markup for search UI.
013334| src/components/SearchLayoutView.tsx:274:         ) : (
013335| NOTE: Implementation detail supporting search page behavior.
013336| src/components/SearchLayoutView.tsx:275:           // Map hidden - show placeholder with "Show Map" button
013337| NOTE: Line comment documents intent or constraints.
013338| src/components/SearchLayoutView.tsx:276:           <div className="w-[400px] min-w-[400px] border-l border-zinc-200 dark:border-zinc-800">
013339| NOTE: Tailwind classes define layout and styling.
013340| src/components/SearchLayoutView.tsx:277:             <MapPlaceholder onShowMap={showMap} />
013341| NOTE: JSX markup for search UI.
013342| src/components/SearchLayoutView.tsx:278:           </div>
013343| NOTE: JSX markup for search UI.
013344| src/components/SearchLayoutView.tsx:279:         )}
013345| NOTE: Implementation detail supporting search page behavior.
013346| src/components/SearchLayoutView.tsx:280:       </div>
013347| NOTE: JSX markup for search UI.
013348| src/components/SearchLayoutView.tsx:281: 
013349| NOTE: Blank line for visual separation.
013350| src/components/SearchLayoutView.tsx:282:       {/* Desktop FAB when map is completely hidden - alternative to placeholder */}
013351| NOTE: Implementation detail supporting search page behavior.
013352| src/components/SearchLayoutView.tsx:283:       {!shouldShowMap && !isMobile && (
013353| NOTE: Implementation detail supporting search page behavior.
013354| src/components/SearchLayoutView.tsx:284:         <div className="fixed bottom-6 right-6 z-50 hidden md:block">
013355| NOTE: Tailwind classes define layout and styling.
013356| src/components/SearchLayoutView.tsx:285:           <button
013357| NOTE: JSX markup for search UI.
013358| src/components/SearchLayoutView.tsx:286:             onClick={showMap}
013359| NOTE: Implementation detail supporting search page behavior.
013360| src/components/SearchLayoutView.tsx:287:             className="flex items-center gap-2 px-4 py-3 bg-zinc-900 text-white rounded-full shadow-lg shadow-zinc-900/25 hover:bg-zinc-800 transition-colors"
013361| NOTE: Tailwind classes define layout and styling.
013362| src/components/SearchLayoutView.tsx:288:             aria-label="Show map"
013363| NOTE: Accessibility attribute for screen readers.
013364| src/components/SearchLayoutView.tsx:289:           >
013365| NOTE: Implementation detail supporting search page behavior.
013366| src/components/SearchLayoutView.tsx:290:             <Map className="w-5 h-5" />
013367| NOTE: Tailwind classes define layout and styling.
013368| src/components/SearchLayoutView.tsx:291:             <span className="text-sm font-medium">Show Map</span>
013369| NOTE: Tailwind classes define layout and styling.
013370| src/components/SearchLayoutView.tsx:292:           </button>
013371| NOTE: JSX markup for search UI.
013372| src/components/SearchLayoutView.tsx:293:         </div>
013373| NOTE: JSX markup for search UI.
013374| src/components/SearchLayoutView.tsx:294:       )}
013375| NOTE: Implementation detail supporting search page behavior.
013376| src/components/SearchLayoutView.tsx:295:     </SearchMapUIProvider>
013377| NOTE: JSX markup for search UI.
013378| src/components/SearchLayoutView.tsx:296:   );
013379| NOTE: Implementation detail supporting search page behavior.
013380| src/components/SearchLayoutView.tsx:297: }
013381| NOTE: Implementation detail supporting search page behavior.
013382| FILE END: src/components/SearchLayoutView.tsx
013383| 
013384| FILE START: src/components/SortSelect.tsx
013385| FILE ROLE: Auto-discovered dependency in search page graph.
013386| src/components/SortSelect.tsx:1: "use client";
013387| NOTE: Implementation detail supporting search page behavior.
013388| src/components/SortSelect.tsx:2: 
013389| NOTE: Blank line for visual separation.
013390| src/components/SortSelect.tsx:3: import { useState, useEffect } from "react";
013391| NOTE: Imports dependency for this module.
013392| src/components/SortSelect.tsx:4: import { useRouter, useSearchParams } from "next/navigation";
013393| NOTE: Imports dependency for this module.
013394| src/components/SortSelect.tsx:5: import { SortOption } from "@/lib/data";
013395| NOTE: Imports dependency for this module.
013396| src/components/SortSelect.tsx:6: import {
013397| NOTE: Imports dependency for this module.
013398| src/components/SortSelect.tsx:7:   Select,
013399| NOTE: Implementation detail supporting search page behavior.
013400| src/components/SortSelect.tsx:8:   SelectContent,
013401| NOTE: Implementation detail supporting search page behavior.
013402| src/components/SortSelect.tsx:9:   SelectItem,
013403| NOTE: Implementation detail supporting search page behavior.
013404| src/components/SortSelect.tsx:10:   SelectTrigger,
013405| NOTE: Implementation detail supporting search page behavior.
013406| src/components/SortSelect.tsx:11:   SelectValue,
013407| NOTE: Implementation detail supporting search page behavior.
013408| src/components/SortSelect.tsx:12: } from "@/components/ui/select";
013409| NOTE: Implementation detail supporting search page behavior.
013410| src/components/SortSelect.tsx:13: 
013411| NOTE: Blank line for visual separation.
013412| src/components/SortSelect.tsx:14: export const sortOptions: { value: SortOption; label: string }[] = [
013413| NOTE: Implementation detail supporting search page behavior.
013414| src/components/SortSelect.tsx:15:   { value: "recommended", label: "Recommended" },
013415| NOTE: Implementation detail supporting search page behavior.
013416| src/components/SortSelect.tsx:16:   { value: "price_asc", label: "Price: Low to High" },
013417| NOTE: Implementation detail supporting search page behavior.
013418| src/components/SortSelect.tsx:17:   { value: "price_desc", label: "Price: High to Low" },
013419| NOTE: Implementation detail supporting search page behavior.
013420| src/components/SortSelect.tsx:18:   { value: "newest", label: "Newest First" },
013421| NOTE: Implementation detail supporting search page behavior.
013422| src/components/SortSelect.tsx:19:   { value: "rating", label: "Top Rated" },
013423| NOTE: Implementation detail supporting search page behavior.
013424| src/components/SortSelect.tsx:20: ];
013425| NOTE: Implementation detail supporting search page behavior.
013426| src/components/SortSelect.tsx:21: 
013427| NOTE: Blank line for visual separation.
013428| src/components/SortSelect.tsx:22: interface SortSelectProps {
013429| NOTE: Type declaration for search data contracts.
013430| src/components/SortSelect.tsx:23:   currentSort: SortOption;
013431| NOTE: Implementation detail supporting search page behavior.
013432| src/components/SortSelect.tsx:24: }
013433| NOTE: Implementation detail supporting search page behavior.
013434| src/components/SortSelect.tsx:25: 
013435| NOTE: Blank line for visual separation.
013436| src/components/SortSelect.tsx:26: export default function SortSelect({ currentSort }: SortSelectProps) {
013437| NOTE: Exports main component for this module.
013438| src/components/SortSelect.tsx:27:   const [mounted, setMounted] = useState(false);
013439| NOTE: Initializes local state for search UI behavior.
013440| src/components/SortSelect.tsx:28:   const router = useRouter();
013441| NOTE: Local declaration used by search logic or UI.
013442| src/components/SortSelect.tsx:29:   const searchParams = useSearchParams();
013443| NOTE: Local declaration used by search logic or UI.
013444| src/components/SortSelect.tsx:30: 
013445| NOTE: Blank line for visual separation.
013446| src/components/SortSelect.tsx:31:   // Prevent hydration mismatch from Radix UI generating different IDs on server vs client
013447| NOTE: Line comment documents intent or constraints.
013448| src/components/SortSelect.tsx:32:   useEffect(() => {
013449| NOTE: Defines side effect for syncing with external state.
013450| src/components/SortSelect.tsx:33:     setMounted(true);
013451| NOTE: Implementation detail supporting search page behavior.
013452| src/components/SortSelect.tsx:34:   }, []);
013453| NOTE: Implementation detail supporting search page behavior.
013454| src/components/SortSelect.tsx:35: 
013455| NOTE: Blank line for visual separation.
013456| src/components/SortSelect.tsx:36:   const handleSortChange = (newSort: string) => {
013457| NOTE: Local declaration used by search logic or UI.
013458| src/components/SortSelect.tsx:37:     const params = new URLSearchParams(searchParams.toString());
013459| NOTE: Local declaration used by search logic or UI.
013460| src/components/SortSelect.tsx:38:     if (newSort === "recommended") {
013461| NOTE: Conditional logic controlling rendering or flow.
013462| src/components/SortSelect.tsx:39:       params.delete("sort");
013463| NOTE: Implementation detail supporting search page behavior.
013464| src/components/SortSelect.tsx:40:     } else {
013465| NOTE: Implementation detail supporting search page behavior.
013466| src/components/SortSelect.tsx:41:       params.set("sort", newSort);
013467| NOTE: Implementation detail supporting search page behavior.
013468| src/components/SortSelect.tsx:42:     }
013469| NOTE: Implementation detail supporting search page behavior.
013470| src/components/SortSelect.tsx:43:     // Reset to page 1 when sorting changes
013471| NOTE: Line comment documents intent or constraints.
013472| src/components/SortSelect.tsx:44:     params.delete("page");
013473| NOTE: Implementation detail supporting search page behavior.
013474| src/components/SortSelect.tsx:45:     router.push(`/search?${params.toString()}`);
013475| NOTE: Routing logic updates search URL state.
013476| src/components/SortSelect.tsx:46:   };
013477| NOTE: Implementation detail supporting search page behavior.
013478| src/components/SortSelect.tsx:47: 
013479| NOTE: Blank line for visual separation.
013480| src/components/SortSelect.tsx:48:   const currentLabel =
013481| NOTE: Local declaration used by search logic or UI.
013482| src/components/SortSelect.tsx:49:     sortOptions.find((opt) => opt.value === currentSort)?.label ||
013483| NOTE: Implementation detail supporting search page behavior.
013484| src/components/SortSelect.tsx:50:     "Recommended";
013485| NOTE: Implementation detail supporting search page behavior.
013486| src/components/SortSelect.tsx:51: 
013487| NOTE: Blank line for visual separation.
013488| src/components/SortSelect.tsx:52:   // Render placeholder during SSR to prevent hydration mismatch
013489| NOTE: Line comment documents intent or constraints.
013490| src/components/SortSelect.tsx:53:   if (!mounted) {
013491| NOTE: Conditional logic controlling rendering or flow.
013492| src/components/SortSelect.tsx:54:     return (
013493| NOTE: Return statement for component or helper output.
013494| src/components/SortSelect.tsx:55:       <div className="hidden md:flex items-center gap-2 text-xs font-medium text-zinc-500 dark:text-zinc-400">
013495| NOTE: Tailwind classes define layout and styling.
013496| src/components/SortSelect.tsx:56:         <span>Sort by:</span>
013497| NOTE: JSX markup for search UI.
013498| src/components/SortSelect.tsx:57:         <div className="h-9 min-w-[140px] px-3 py-1.5 text-zinc-900 dark:text-white font-semibold text-xs flex items-center">
013499| NOTE: Tailwind classes define layout and styling.
013500| src/components/SortSelect.tsx:58:           {currentLabel}
013501| NOTE: Implementation detail supporting search page behavior.
013502| src/components/SortSelect.tsx:59:         </div>
013503| NOTE: JSX markup for search UI.
013504| src/components/SortSelect.tsx:60:       </div>
013505| NOTE: JSX markup for search UI.
013506| src/components/SortSelect.tsx:61:     );
013507| NOTE: Implementation detail supporting search page behavior.
013508| src/components/SortSelect.tsx:62:   }
013509| NOTE: Implementation detail supporting search page behavior.
013510| src/components/SortSelect.tsx:63: 
013511| NOTE: Blank line for visual separation.
013512| src/components/SortSelect.tsx:64:   return (
013513| NOTE: Return statement for component or helper output.
013514| src/components/SortSelect.tsx:65:     <div className="hidden md:flex items-center gap-2 text-xs font-medium text-zinc-500 dark:text-zinc-400">
013515| NOTE: Tailwind classes define layout and styling.
013516| src/components/SortSelect.tsx:66:       <span>Sort by:</span>
013517| NOTE: JSX markup for search UI.
013518| src/components/SortSelect.tsx:67:       {/* FIX APPLIED: modal={false}
013519| NOTE: Implementation detail supporting search page behavior.
013520| src/components/SortSelect.tsx:68:                This prevents Radix from setting document.body.style.overflow = 'hidden'
013521| NOTE: Implementation detail supporting search page behavior.
013522| src/components/SortSelect.tsx:69:                which causes the layout shift/shake.
013523| NOTE: Implementation detail supporting search page behavior.
013524| src/components/SortSelect.tsx:70:             */}
013525| NOTE: Block comment line describing behavior or context.
013526| src/components/SortSelect.tsx:71:       <Select
013527| NOTE: JSX markup for search UI.
013528| src/components/SortSelect.tsx:72:         value={currentSort}
013529| NOTE: Implementation detail supporting search page behavior.
013530| src/components/SortSelect.tsx:73:         onValueChange={handleSortChange}
013531| NOTE: Implementation detail supporting search page behavior.
013532| src/components/SortSelect.tsx:74:         // @ts-expect-error - modal prop exists on Radix Select but TS defs may be outdated
013533| NOTE: Line comment documents intent or constraints.
013534| src/components/SortSelect.tsx:75:         modal={false}
013535| NOTE: Implementation detail supporting search page behavior.
013536| src/components/SortSelect.tsx:76:       >
013537| NOTE: Implementation detail supporting search page behavior.
013538| src/components/SortSelect.tsx:77:         <SelectTrigger className="h-9 w-auto min-w-[140px] border-none bg-transparent hover:bg-zinc-100 dark:hover:bg-zinc-800 px-3 py-1.5 text-zinc-900 dark:text-white font-semibold text-xs focus:ring-0">
013539| NOTE: Tailwind classes define layout and styling.
013540| src/components/SortSelect.tsx:78:           <SelectValue placeholder="Recommended">{currentLabel}</SelectValue>
013541| NOTE: JSX markup for search UI.
013542| src/components/SortSelect.tsx:79:         </SelectTrigger>
013543| NOTE: JSX markup for search UI.
013544| src/components/SortSelect.tsx:80:         <SelectContent>
013545| NOTE: JSX markup for search UI.
013546| src/components/SortSelect.tsx:81:           {sortOptions.map((option) => (
013547| NOTE: Implementation detail supporting search page behavior.
013548| src/components/SortSelect.tsx:82:             <SelectItem key={option.value} value={option.value}>
013549| NOTE: JSX markup for search UI.
013550| src/components/SortSelect.tsx:83:               {option.label}
013551| NOTE: Implementation detail supporting search page behavior.
013552| src/components/SortSelect.tsx:84:             </SelectItem>
013553| NOTE: JSX markup for search UI.
013554| src/components/SortSelect.tsx:85:           ))}
013555| NOTE: Implementation detail supporting search page behavior.
013556| src/components/SortSelect.tsx:86:         </SelectContent>
013557| NOTE: JSX markup for search UI.
013558| src/components/SortSelect.tsx:87:       </Select>
013559| NOTE: JSX markup for search UI.
013560| src/components/SortSelect.tsx:88:     </div>
013561| NOTE: JSX markup for search UI.
013562| src/components/SortSelect.tsx:89:   );
013563| NOTE: Implementation detail supporting search page behavior.
013564| src/components/SortSelect.tsx:90: }
013565| NOTE: Implementation detail supporting search page behavior.
013566| FILE END: src/components/SortSelect.tsx
013567| 
013568| FILE START: src/components/ZeroResultsSuggestions.tsx
013569| FILE ROLE: Auto-discovered dependency in search page graph.
013570| src/components/ZeroResultsSuggestions.tsx:1: "use client";
013571| NOTE: Implementation detail supporting search page behavior.
013572| src/components/ZeroResultsSuggestions.tsx:2: 
013573| NOTE: Blank line for visual separation.
013574| src/components/ZeroResultsSuggestions.tsx:3: import { useState, useTransition } from "react";
013575| NOTE: Imports dependency for this module.
013576| src/components/ZeroResultsSuggestions.tsx:4: import { useRouter, useSearchParams } from "next/navigation";
013577| NOTE: Imports dependency for this module.
013578| src/components/ZeroResultsSuggestions.tsx:5: import { Loader2, MapPin, Search } from "lucide-react";
013579| NOTE: Imports dependency for this module.
013580| src/components/ZeroResultsSuggestions.tsx:6: import type { FilterSuggestion, FilterParams } from "@/lib/data";
013581| NOTE: Imports dependency for this module.
013582| src/components/ZeroResultsSuggestions.tsx:7: import { getFilterSuggestions } from "@/app/actions/filter-suggestions";
013583| NOTE: Imports dependency for this module.
013584| src/components/ZeroResultsSuggestions.tsx:8: 
013585| NOTE: Blank line for visual separation.
013586| src/components/ZeroResultsSuggestions.tsx:9: interface ZeroResultsSuggestionsProps {
013587| NOTE: Type declaration for search data contracts.
013588| src/components/ZeroResultsSuggestions.tsx:10:   filterParams: FilterParams;
013589| NOTE: Implementation detail supporting search page behavior.
013590| src/components/ZeroResultsSuggestions.tsx:11:   query?: string;
013591| NOTE: Implementation detail supporting search page behavior.
013592| src/components/ZeroResultsSuggestions.tsx:12: }
013593| NOTE: Implementation detail supporting search page behavior.
013594| src/components/ZeroResultsSuggestions.tsx:13: 
013595| NOTE: Blank line for visual separation.
013596| src/components/ZeroResultsSuggestions.tsx:14: /**
013597| NOTE: Block comment line describing behavior or context.
013598| src/components/ZeroResultsSuggestions.tsx:15:  * Detect if there's a potential conflict between location query and map bounds.
013599| NOTE: Block comment line describing behavior or context.
013600| src/components/ZeroResultsSuggestions.tsx:16:  * This happens when user searches for a location, then pans the map elsewhere.
013601| NOTE: Block comment line describing behavior or context.
013602| src/components/ZeroResultsSuggestions.tsx:17:  */
013603| NOTE: Block comment line describing behavior or context.
013604| src/components/ZeroResultsSuggestions.tsx:18: function hasLocationBoundsConflict(filterParams: FilterParams): boolean {
013605| NOTE: Defines a helper or component function.
013606| src/components/ZeroResultsSuggestions.tsx:19:   // Conflict exists if both query AND bounds are set
013607| NOTE: Line comment documents intent or constraints.
013608| src/components/ZeroResultsSuggestions.tsx:20:   // The bounds might not contain the original search location
013609| NOTE: Line comment documents intent or constraints.
013610| src/components/ZeroResultsSuggestions.tsx:21:   return Boolean(filterParams.query && filterParams.bounds);
013611| NOTE: Return statement for component or helper output.
013612| src/components/ZeroResultsSuggestions.tsx:22: }
013613| NOTE: Implementation detail supporting search page behavior.
013614| src/components/ZeroResultsSuggestions.tsx:23: 
013615| NOTE: Blank line for visual separation.
013616| src/components/ZeroResultsSuggestions.tsx:24: export default function ZeroResultsSuggestions({
013617| NOTE: Exports main component for this module.
013618| src/components/ZeroResultsSuggestions.tsx:25:   filterParams,
013619| NOTE: Implementation detail supporting search page behavior.
013620| src/components/ZeroResultsSuggestions.tsx:26:   query,
013621| NOTE: Implementation detail supporting search page behavior.
013622| src/components/ZeroResultsSuggestions.tsx:27: }: ZeroResultsSuggestionsProps) {
013623| NOTE: Implementation detail supporting search page behavior.
013624| src/components/ZeroResultsSuggestions.tsx:28:   const router = useRouter();
013625| NOTE: Local declaration used by search logic or UI.
013626| src/components/ZeroResultsSuggestions.tsx:29:   const searchParams = useSearchParams();
013627| NOTE: Local declaration used by search logic or UI.
013628| src/components/ZeroResultsSuggestions.tsx:30:   const [suggestions, setSuggestions] = useState<FilterSuggestion[] | null>(
013629| NOTE: Initializes local state for search UI behavior.
013630| src/components/ZeroResultsSuggestions.tsx:31:     null,
013631| NOTE: Implementation detail supporting search page behavior.
013632| src/components/ZeroResultsSuggestions.tsx:32:   );
013633| NOTE: Implementation detail supporting search page behavior.
013634| src/components/ZeroResultsSuggestions.tsx:33:   const [isPending, startTransition] = useTransition();
013635| NOTE: Local declaration used by search logic or UI.
013636| src/components/ZeroResultsSuggestions.tsx:34:   const [hasLoaded, setHasLoaded] = useState(false);
013637| NOTE: Initializes local state for search UI behavior.
013638| src/components/ZeroResultsSuggestions.tsx:35: 
013639| NOTE: Blank line for visual separation.
013640| src/components/ZeroResultsSuggestions.tsx:36:   // Detect location/bounds conflict
013641| NOTE: Line comment documents intent or constraints.
013642| src/components/ZeroResultsSuggestions.tsx:37:   const hasConflict = hasLocationBoundsConflict(filterParams);
013643| NOTE: Local declaration used by search logic or UI.
013644| src/components/ZeroResultsSuggestions.tsx:38: 
013645| NOTE: Blank line for visual separation.
013646| src/components/ZeroResultsSuggestions.tsx:39:   const handleShowSuggestions = () => {
013647| NOTE: Local declaration used by search logic or UI.
013648| src/components/ZeroResultsSuggestions.tsx:40:     startTransition(async () => {
013649| NOTE: Implementation detail supporting search page behavior.
013650| src/components/ZeroResultsSuggestions.tsx:41:       const result = await getFilterSuggestions(filterParams);
013651| NOTE: Local declaration used by search logic or UI.
013652| src/components/ZeroResultsSuggestions.tsx:42:       setSuggestions(result);
013653| NOTE: Implementation detail supporting search page behavior.
013654| src/components/ZeroResultsSuggestions.tsx:43:       setHasLoaded(true);
013655| NOTE: Implementation detail supporting search page behavior.
013656| src/components/ZeroResultsSuggestions.tsx:44:     });
013657| NOTE: Implementation detail supporting search page behavior.
013658| src/components/ZeroResultsSuggestions.tsx:45:   };
013659| NOTE: Implementation detail supporting search page behavior.
013660| src/components/ZeroResultsSuggestions.tsx:46: 
013661| NOTE: Blank line for visual separation.
013662| src/components/ZeroResultsSuggestions.tsx:47:   const handleRemoveFilter = (filter: string) => {
013663| NOTE: Local declaration used by search logic or UI.
013664| src/components/ZeroResultsSuggestions.tsx:48:     const params = new URLSearchParams(searchParams.toString());
013665| NOTE: Local declaration used by search logic or UI.
013666| src/components/ZeroResultsSuggestions.tsx:49: 
013667| NOTE: Blank line for visual separation.
013668| src/components/ZeroResultsSuggestions.tsx:50:     switch (filter) {
013669| NOTE: Implementation detail supporting search page behavior.
013670| src/components/ZeroResultsSuggestions.tsx:51:       case "maxPrice":
013671| NOTE: Implementation detail supporting search page behavior.
013672| src/components/ZeroResultsSuggestions.tsx:52:         params.delete("maxPrice");
013673| NOTE: Implementation detail supporting search page behavior.
013674| src/components/ZeroResultsSuggestions.tsx:53:         break;
013675| NOTE: Implementation detail supporting search page behavior.
013676| src/components/ZeroResultsSuggestions.tsx:54:       case "minPrice":
013677| NOTE: Implementation detail supporting search page behavior.
013678| src/components/ZeroResultsSuggestions.tsx:55:         params.delete("minPrice");
013679| NOTE: Implementation detail supporting search page behavior.
013680| src/components/ZeroResultsSuggestions.tsx:56:         break;
013681| NOTE: Implementation detail supporting search page behavior.
013682| src/components/ZeroResultsSuggestions.tsx:57:       case "amenities":
013683| NOTE: Implementation detail supporting search page behavior.
013684| src/components/ZeroResultsSuggestions.tsx:58:         params.delete("amenities");
013685| NOTE: Implementation detail supporting search page behavior.
013686| src/components/ZeroResultsSuggestions.tsx:59:         break;
013687| NOTE: Implementation detail supporting search page behavior.
013688| src/components/ZeroResultsSuggestions.tsx:60:       case "houseRules":
013689| NOTE: Implementation detail supporting search page behavior.
013690| src/components/ZeroResultsSuggestions.tsx:61:         params.delete("houseRules");
013691| NOTE: Implementation detail supporting search page behavior.
013692| src/components/ZeroResultsSuggestions.tsx:62:         break;
013693| NOTE: Implementation detail supporting search page behavior.
013694| src/components/ZeroResultsSuggestions.tsx:63:       case "roomType":
013695| NOTE: Implementation detail supporting search page behavior.
013696| src/components/ZeroResultsSuggestions.tsx:64:         params.delete("roomType");
013697| NOTE: Implementation detail supporting search page behavior.
013698| src/components/ZeroResultsSuggestions.tsx:65:         break;
013699| NOTE: Implementation detail supporting search page behavior.
013700| src/components/ZeroResultsSuggestions.tsx:66:       case "leaseDuration":
013701| NOTE: Implementation detail supporting search page behavior.
013702| src/components/ZeroResultsSuggestions.tsx:67:         params.delete("leaseDuration");
013703| NOTE: Implementation detail supporting search page behavior.
013704| src/components/ZeroResultsSuggestions.tsx:68:         break;
013705| NOTE: Implementation detail supporting search page behavior.
013706| src/components/ZeroResultsSuggestions.tsx:69:       case "location":
013707| NOTE: Implementation detail supporting search page behavior.
013708| src/components/ZeroResultsSuggestions.tsx:70:         params.delete("lat");
013709| NOTE: Implementation detail supporting search page behavior.
013710| src/components/ZeroResultsSuggestions.tsx:71:         params.delete("lng");
013711| NOTE: Implementation detail supporting search page behavior.
013712| src/components/ZeroResultsSuggestions.tsx:72:         params.delete("minLat");
013713| NOTE: Implementation detail supporting search page behavior.
013714| src/components/ZeroResultsSuggestions.tsx:73:         params.delete("maxLat");
013715| NOTE: Implementation detail supporting search page behavior.
013716| src/components/ZeroResultsSuggestions.tsx:74:         params.delete("minLng");
013717| NOTE: Implementation detail supporting search page behavior.
013718| src/components/ZeroResultsSuggestions.tsx:75:         params.delete("maxLng");
013719| NOTE: Implementation detail supporting search page behavior.
013720| src/components/ZeroResultsSuggestions.tsx:76:         break;
013721| NOTE: Implementation detail supporting search page behavior.
013722| src/components/ZeroResultsSuggestions.tsx:77:     }
013723| NOTE: Implementation detail supporting search page behavior.
013724| src/components/ZeroResultsSuggestions.tsx:78: 
013725| NOTE: Blank line for visual separation.
013726| src/components/ZeroResultsSuggestions.tsx:79:     // Reset to page 1 when modifying filters
013727| NOTE: Line comment documents intent or constraints.
013728| src/components/ZeroResultsSuggestions.tsx:80:     params.delete("page");
013729| NOTE: Implementation detail supporting search page behavior.
013730| src/components/ZeroResultsSuggestions.tsx:81: 
013731| NOTE: Blank line for visual separation.
013732| src/components/ZeroResultsSuggestions.tsx:82:     router.push(`/search?${params.toString()}`);
013733| NOTE: Routing logic updates search URL state.
013734| src/components/ZeroResultsSuggestions.tsx:83:   };
013735| NOTE: Implementation detail supporting search page behavior.
013736| src/components/ZeroResultsSuggestions.tsx:84: 
013737| NOTE: Blank line for visual separation.
013738| src/components/ZeroResultsSuggestions.tsx:85:   const handleClearAll = () => {
013739| NOTE: Local declaration used by search logic or UI.
013740| src/components/ZeroResultsSuggestions.tsx:86:     router.push("/search");
013741| NOTE: Routing logic updates search URL state.
013742| src/components/ZeroResultsSuggestions.tsx:87:   };
013743| NOTE: Implementation detail supporting search page behavior.
013744| src/components/ZeroResultsSuggestions.tsx:88: 
013745| NOTE: Blank line for visual separation.
013746| src/components/ZeroResultsSuggestions.tsx:89:   // Handle conflict resolution: search in current map area (clear query, keep bounds)
013747| NOTE: Line comment documents intent or constraints.
013748| src/components/ZeroResultsSuggestions.tsx:90:   const handleSearchInMapArea = () => {
013749| NOTE: Local declaration used by search logic or UI.
013750| src/components/ZeroResultsSuggestions.tsx:91:     const params = new URLSearchParams(searchParams.toString());
013751| NOTE: Local declaration used by search logic or UI.
013752| src/components/ZeroResultsSuggestions.tsx:92:     params.delete("q");
013753| NOTE: Implementation detail supporting search page behavior.
013754| src/components/ZeroResultsSuggestions.tsx:93:     params.delete("lat");
013755| NOTE: Implementation detail supporting search page behavior.
013756| src/components/ZeroResultsSuggestions.tsx:94:     params.delete("lng");
013757| NOTE: Implementation detail supporting search page behavior.
013758| src/components/ZeroResultsSuggestions.tsx:95:     params.delete("page");
013759| NOTE: Implementation detail supporting search page behavior.
013760| src/components/ZeroResultsSuggestions.tsx:96:     router.push(`/search?${params.toString()}`);
013761| NOTE: Routing logic updates search URL state.
013762| src/components/ZeroResultsSuggestions.tsx:97:   };
013763| NOTE: Implementation detail supporting search page behavior.
013764| src/components/ZeroResultsSuggestions.tsx:98: 
013765| NOTE: Blank line for visual separation.
013766| src/components/ZeroResultsSuggestions.tsx:99:   // Handle conflict resolution: search for location (clear bounds, keep query)
013767| NOTE: Line comment documents intent or constraints.
013768| src/components/ZeroResultsSuggestions.tsx:100:   const handleSearchForLocation = () => {
013769| NOTE: Local declaration used by search logic or UI.
013770| src/components/ZeroResultsSuggestions.tsx:101:     const params = new URLSearchParams(searchParams.toString());
013771| NOTE: Local declaration used by search logic or UI.
013772| src/components/ZeroResultsSuggestions.tsx:102:     params.delete("minLat");
013773| NOTE: Implementation detail supporting search page behavior.
013774| src/components/ZeroResultsSuggestions.tsx:103:     params.delete("maxLat");
013775| NOTE: Implementation detail supporting search page behavior.
013776| src/components/ZeroResultsSuggestions.tsx:104:     params.delete("minLng");
013777| NOTE: Implementation detail supporting search page behavior.
013778| src/components/ZeroResultsSuggestions.tsx:105:     params.delete("maxLng");
013779| NOTE: Implementation detail supporting search page behavior.
013780| src/components/ZeroResultsSuggestions.tsx:106:     params.delete("page");
013781| NOTE: Implementation detail supporting search page behavior.
013782| src/components/ZeroResultsSuggestions.tsx:107:     router.push(`/search?${params.toString()}`);
013783| NOTE: Routing logic updates search URL state.
013784| src/components/ZeroResultsSuggestions.tsx:108:   };
013785| NOTE: Implementation detail supporting search page behavior.
013786| src/components/ZeroResultsSuggestions.tsx:109: 
013787| NOTE: Blank line for visual separation.
013788| src/components/ZeroResultsSuggestions.tsx:110:   // Show "Get suggestions" button if not loaded yet
013789| NOTE: Line comment documents intent or constraints.
013790| src/components/ZeroResultsSuggestions.tsx:111:   if (!hasLoaded) {
013791| NOTE: Conditional logic controlling rendering or flow.
013792| src/components/ZeroResultsSuggestions.tsx:112:     return (
013793| NOTE: Return statement for component or helper output.
013794| src/components/ZeroResultsSuggestions.tsx:113:       <div className="text-center py-4">
013795| NOTE: Tailwind classes define layout and styling.
013796| src/components/ZeroResultsSuggestions.tsx:114:         <p className="text-zinc-500 dark:text-zinc-400 text-sm">
013797| NOTE: Tailwind classes define layout and styling.
013798| src/components/ZeroResultsSuggestions.tsx:115:           No listings match your criteria{query ? ` for "${query}"` : ""}.
013799| NOTE: Implementation detail supporting search page behavior.
013800| src/components/ZeroResultsSuggestions.tsx:116:         </p>
013801| NOTE: JSX markup for search UI.
013802| src/components/ZeroResultsSuggestions.tsx:117: 
013803| NOTE: Blank line for visual separation.
013804| src/components/ZeroResultsSuggestions.tsx:118:         {/* Show conflict resolution options if location/bounds conflict detected */}
013805| NOTE: Implementation detail supporting search page behavior.
013806| src/components/ZeroResultsSuggestions.tsx:119:         {hasConflict && (
013807| NOTE: Implementation detail supporting search page behavior.
013808| src/components/ZeroResultsSuggestions.tsx:120:           <div className="mt-4 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl">
013809| NOTE: Tailwind classes define layout and styling.
013810| src/components/ZeroResultsSuggestions.tsx:121:             <p className="text-sm text-amber-800 dark:text-amber-300 font-medium mb-3">
013811| NOTE: Tailwind classes define layout and styling.
013812| src/components/ZeroResultsSuggestions.tsx:122:               Your search location and map area don&apos;t match
013813| NOTE: Implementation detail supporting search page behavior.
013814| src/components/ZeroResultsSuggestions.tsx:123:             </p>
013815| NOTE: JSX markup for search UI.
013816| src/components/ZeroResultsSuggestions.tsx:124:             <div className="flex flex-col sm:flex-row gap-2 justify-center">
013817| NOTE: Tailwind classes define layout and styling.
013818| src/components/ZeroResultsSuggestions.tsx:125:               <button
013819| NOTE: JSX markup for search UI.
013820| src/components/ZeroResultsSuggestions.tsx:126:                 onClick={handleSearchInMapArea}
013821| NOTE: Implementation detail supporting search page behavior.
013822| src/components/ZeroResultsSuggestions.tsx:127:                 className="inline-flex items-center justify-center gap-2 px-4 py-2 bg-white dark:bg-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-700 border border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-lg text-sm font-medium transition-colors min-h-[44px]"
013823| NOTE: Tailwind classes define layout and styling.
013824| src/components/ZeroResultsSuggestions.tsx:128:               >
013825| NOTE: Implementation detail supporting search page behavior.
013826| src/components/ZeroResultsSuggestions.tsx:129:                 <MapPin className="w-4 h-4" />
013827| NOTE: Tailwind classes define layout and styling.
013828| src/components/ZeroResultsSuggestions.tsx:130:                 Search in map area
013829| NOTE: Implementation detail supporting search page behavior.
013830| src/components/ZeroResultsSuggestions.tsx:131:               </button>
013831| NOTE: JSX markup for search UI.
013832| src/components/ZeroResultsSuggestions.tsx:132:               <button
013833| NOTE: JSX markup for search UI.
013834| src/components/ZeroResultsSuggestions.tsx:133:                 onClick={handleSearchForLocation}
013835| NOTE: Implementation detail supporting search page behavior.
013836| src/components/ZeroResultsSuggestions.tsx:134:                 className="inline-flex items-center justify-center gap-2 px-4 py-2 bg-white dark:bg-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-700 border border-zinc-200 dark:border-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-lg text-sm font-medium transition-colors min-h-[44px]"
013837| NOTE: Tailwind classes define layout and styling.
013838| src/components/ZeroResultsSuggestions.tsx:135:               >
013839| NOTE: Implementation detail supporting search page behavior.
013840| src/components/ZeroResultsSuggestions.tsx:136:                 <Search className="w-4 h-4" />
013841| NOTE: Tailwind classes define layout and styling.
013842| src/components/ZeroResultsSuggestions.tsx:137:                 Search for &quot;{filterParams.query}&quot;
013843| NOTE: Implementation detail supporting search page behavior.
013844| src/components/ZeroResultsSuggestions.tsx:138:               </button>
013845| NOTE: JSX markup for search UI.
013846| src/components/ZeroResultsSuggestions.tsx:139:             </div>
013847| NOTE: JSX markup for search UI.
013848| src/components/ZeroResultsSuggestions.tsx:140:           </div>
013849| NOTE: JSX markup for search UI.
013850| src/components/ZeroResultsSuggestions.tsx:141:         )}
013851| NOTE: Implementation detail supporting search page behavior.
013852| src/components/ZeroResultsSuggestions.tsx:142: 
013853| NOTE: Blank line for visual separation.
013854| src/components/ZeroResultsSuggestions.tsx:143:         <button
013855| NOTE: JSX markup for search UI.
013856| src/components/ZeroResultsSuggestions.tsx:144:           onClick={handleShowSuggestions}
013857| NOTE: Implementation detail supporting search page behavior.
013858| src/components/ZeroResultsSuggestions.tsx:145:           disabled={isPending}
013859| NOTE: Implementation detail supporting search page behavior.
013860| src/components/ZeroResultsSuggestions.tsx:146:           className="mt-3 px-4 py-2 min-h-[44px] bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300 rounded-lg text-sm font-medium transition-colors inline-flex items-center gap-2 disabled:opacity-50"
013861| NOTE: Tailwind classes define layout and styling.
013862| src/components/ZeroResultsSuggestions.tsx:147:         >
013863| NOTE: Implementation detail supporting search page behavior.
013864| src/components/ZeroResultsSuggestions.tsx:148:           {isPending ? (
013865| NOTE: Implementation detail supporting search page behavior.
013866| src/components/ZeroResultsSuggestions.tsx:149:             <>
013867| NOTE: JSX markup for search UI.
013868| src/components/ZeroResultsSuggestions.tsx:150:               <Loader2 className="w-4 h-4 animate-spin" />
013869| NOTE: Tailwind classes define layout and styling.
013870| src/components/ZeroResultsSuggestions.tsx:151:               Analyzing...
013871| NOTE: Implementation detail supporting search page behavior.
013872| src/components/ZeroResultsSuggestions.tsx:152:             </>
013873| NOTE: JSX markup for search UI.
013874| src/components/ZeroResultsSuggestions.tsx:153:           ) : (
013875| NOTE: Implementation detail supporting search page behavior.
013876| src/components/ZeroResultsSuggestions.tsx:154:             "Show more suggestions"
013877| NOTE: Implementation detail supporting search page behavior.
013878| src/components/ZeroResultsSuggestions.tsx:155:           )}
013879| NOTE: Implementation detail supporting search page behavior.
013880| src/components/ZeroResultsSuggestions.tsx:156:         </button>
013881| NOTE: JSX markup for search UI.
013882| src/components/ZeroResultsSuggestions.tsx:157:       </div>
013883| NOTE: JSX markup for search UI.
013884| src/components/ZeroResultsSuggestions.tsx:158:     );
013885| NOTE: Implementation detail supporting search page behavior.
013886| src/components/ZeroResultsSuggestions.tsx:159:   }
013887| NOTE: Implementation detail supporting search page behavior.
013888| src/components/ZeroResultsSuggestions.tsx:160: 
013889| NOTE: Blank line for visual separation.
013890| src/components/ZeroResultsSuggestions.tsx:161:   // After loading, if no suggestions found
013891| NOTE: Line comment documents intent or constraints.
013892| src/components/ZeroResultsSuggestions.tsx:162:   if (!suggestions || suggestions.length === 0) {
013893| NOTE: Conditional logic controlling rendering or flow.
013894| src/components/ZeroResultsSuggestions.tsx:163:     return (
013895| NOTE: Return statement for component or helper output.
013896| src/components/ZeroResultsSuggestions.tsx:164:       <div className="text-center py-4">
013897| NOTE: Tailwind classes define layout and styling.
013898| src/components/ZeroResultsSuggestions.tsx:165:         <p className="text-zinc-500 dark:text-zinc-400 text-sm">
013899| NOTE: Tailwind classes define layout and styling.
013900| src/components/ZeroResultsSuggestions.tsx:166:           No listings match your criteria{query ? ` for "${query}"` : ""}.
013901| NOTE: Implementation detail supporting search page behavior.
013902| src/components/ZeroResultsSuggestions.tsx:167:         </p>
013903| NOTE: JSX markup for search UI.
013904| src/components/ZeroResultsSuggestions.tsx:168:         <p className="text-zinc-400 dark:text-zinc-500 text-sm mt-1">
013905| NOTE: Tailwind classes define layout and styling.
013906| src/components/ZeroResultsSuggestions.tsx:169:           Try a different location or remove all filters.
013907| NOTE: Implementation detail supporting search page behavior.
013908| src/components/ZeroResultsSuggestions.tsx:170:         </p>
013909| NOTE: JSX markup for search UI.
013910| src/components/ZeroResultsSuggestions.tsx:171:       </div>
013911| NOTE: JSX markup for search UI.
013912| src/components/ZeroResultsSuggestions.tsx:172:     );
013913| NOTE: Implementation detail supporting search page behavior.
013914| src/components/ZeroResultsSuggestions.tsx:173:   }
013915| NOTE: Implementation detail supporting search page behavior.
013916| src/components/ZeroResultsSuggestions.tsx:174: 
013917| NOTE: Blank line for visual separation.
013918| src/components/ZeroResultsSuggestions.tsx:175:   return (
013919| NOTE: Return statement for component or helper output.
013920| src/components/ZeroResultsSuggestions.tsx:176:     <div className="mt-4 p-4 bg-zinc-50 dark:bg-zinc-900 rounded-xl border border-zinc-100 dark:border-zinc-800">
013921| NOTE: Tailwind classes define layout and styling.
013922| src/components/ZeroResultsSuggestions.tsx:177:       <p className="text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-3">
013923| NOTE: Tailwind classes define layout and styling.
013924| src/components/ZeroResultsSuggestions.tsx:178:         Try adjusting your filters:
013925| NOTE: Implementation detail supporting search page behavior.
013926| src/components/ZeroResultsSuggestions.tsx:179:       </p>
013927| NOTE: JSX markup for search UI.
013928| src/components/ZeroResultsSuggestions.tsx:180:       <ul className="space-y-2">
013929| NOTE: Tailwind classes define layout and styling.
013930| src/components/ZeroResultsSuggestions.tsx:181:         {suggestions.slice(0, 3).map((item) => (
013931| NOTE: Implementation detail supporting search page behavior.
013932| src/components/ZeroResultsSuggestions.tsx:182:           <li key={item.filter}>
013933| NOTE: JSX markup for search UI.
013934| src/components/ZeroResultsSuggestions.tsx:183:             <button
013935| NOTE: JSX markup for search UI.
013936| src/components/ZeroResultsSuggestions.tsx:184:               onClick={() => handleRemoveFilter(item.filter)}
013937| NOTE: Implementation detail supporting search page behavior.
013938| src/components/ZeroResultsSuggestions.tsx:185:               className={`w-full text-left px-3 py-2 min-h-[44px] rounded-lg transition-all group ${
013939| NOTE: Tailwind classes define layout and styling.
013940| src/components/ZeroResultsSuggestions.tsx:186:                 item.isMostImpactful
013941| NOTE: Implementation detail supporting search page behavior.
013942| src/components/ZeroResultsSuggestions.tsx:187:                   ? "bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 hover:bg-emerald-100 dark:hover:bg-emerald-900/30"
013943| NOTE: Implementation detail supporting search page behavior.
013944| src/components/ZeroResultsSuggestions.tsx:188:                   : "hover:bg-white dark:hover:bg-zinc-800 border border-transparent hover:border-zinc-200 dark:hover:border-zinc-700"
013945| NOTE: Implementation detail supporting search page behavior.
013946| src/components/ZeroResultsSuggestions.tsx:189:               }`}
013947| NOTE: Implementation detail supporting search page behavior.
013948| src/components/ZeroResultsSuggestions.tsx:190:             >
013949| NOTE: Implementation detail supporting search page behavior.
013950| src/components/ZeroResultsSuggestions.tsx:191:               {item.isMostImpactful && (
013951| NOTE: Implementation detail supporting search page behavior.
013952| src/components/ZeroResultsSuggestions.tsx:192:                 <span className="inline-block text-xs font-semibold text-emerald-700 dark:text-emerald-400 mb-1">
013953| NOTE: Tailwind classes define layout and styling.
013954| src/components/ZeroResultsSuggestions.tsx:193:                   Best option
013955| NOTE: Implementation detail supporting search page behavior.
013956| src/components/ZeroResultsSuggestions.tsx:194:                 </span>
013957| NOTE: JSX markup for search UI.
013958| src/components/ZeroResultsSuggestions.tsx:195:               )}
013959| NOTE: Implementation detail supporting search page behavior.
013960| src/components/ZeroResultsSuggestions.tsx:196:               <span
013961| NOTE: JSX markup for search UI.
013962| src/components/ZeroResultsSuggestions.tsx:197:                 className={`text-sm block ${
013963| NOTE: Tailwind classes define layout and styling.
013964| src/components/ZeroResultsSuggestions.tsx:198:                   item.isMostImpactful
013965| NOTE: Implementation detail supporting search page behavior.
013966| src/components/ZeroResultsSuggestions.tsx:199:                     ? "text-emerald-800 dark:text-emerald-300 font-medium"
013967| NOTE: Implementation detail supporting search page behavior.
013968| src/components/ZeroResultsSuggestions.tsx:200:                     : "text-zinc-600 dark:text-zinc-400 group-hover:text-zinc-900 dark:group-hover:text-white"
013969| NOTE: Implementation detail supporting search page behavior.
013970| src/components/ZeroResultsSuggestions.tsx:201:                 }`}
013971| NOTE: Implementation detail supporting search page behavior.
013972| src/components/ZeroResultsSuggestions.tsx:202:               >
013973| NOTE: Implementation detail supporting search page behavior.
013974| src/components/ZeroResultsSuggestions.tsx:203:                 {item.suggestion}
013975| NOTE: Implementation detail supporting search page behavior.
013976| src/components/ZeroResultsSuggestions.tsx:204:               </span>
013977| NOTE: JSX markup for search UI.
013978| src/components/ZeroResultsSuggestions.tsx:205:               <span
013979| NOTE: JSX markup for search UI.
013980| src/components/ZeroResultsSuggestions.tsx:206:                 className={`block text-xs mt-0.5 ${
013981| NOTE: Tailwind classes define layout and styling.
013982| src/components/ZeroResultsSuggestions.tsx:207:                   item.isMostImpactful
013983| NOTE: Implementation detail supporting search page behavior.
013984| src/components/ZeroResultsSuggestions.tsx:208:                     ? "text-emerald-600 dark:text-emerald-500"
013985| NOTE: Implementation detail supporting search page behavior.
013986| src/components/ZeroResultsSuggestions.tsx:209:                     : "text-zinc-400 dark:text-zinc-500"
013987| NOTE: Implementation detail supporting search page behavior.
013988| src/components/ZeroResultsSuggestions.tsx:210:                 }`}
013989| NOTE: Implementation detail supporting search page behavior.
013990| src/components/ZeroResultsSuggestions.tsx:211:               >
013991| NOTE: Implementation detail supporting search page behavior.
013992| src/components/ZeroResultsSuggestions.tsx:212:                 Remove: {item.label}
013993| NOTE: Implementation detail supporting search page behavior.
013994| src/components/ZeroResultsSuggestions.tsx:213:               </span>
013995| NOTE: JSX markup for search UI.
013996| src/components/ZeroResultsSuggestions.tsx:214:             </button>
013997| NOTE: JSX markup for search UI.
013998| src/components/ZeroResultsSuggestions.tsx:215:           </li>
013999| NOTE: JSX markup for search UI.
014000| src/components/ZeroResultsSuggestions.tsx:216:         ))}
014001| NOTE: Implementation detail supporting search page behavior.
014002| src/components/ZeroResultsSuggestions.tsx:217:       </ul>
014003| NOTE: JSX markup for search UI.
014004| src/components/ZeroResultsSuggestions.tsx:218:       {suggestions.length > 3 && (
014005| NOTE: Implementation detail supporting search page behavior.
014006| src/components/ZeroResultsSuggestions.tsx:219:         <p className="text-xs text-zinc-400 dark:text-zinc-500 mt-3 text-center">
014007| NOTE: Tailwind classes define layout and styling.
014008| src/components/ZeroResultsSuggestions.tsx:220:           +{suggestions.length - 3} more suggestion
014009| NOTE: Implementation detail supporting search page behavior.
014010| src/components/ZeroResultsSuggestions.tsx:221:           {suggestions.length - 3 > 1 ? "s" : ""}
014011| NOTE: Implementation detail supporting search page behavior.
014012| src/components/ZeroResultsSuggestions.tsx:222:         </p>
014013| NOTE: JSX markup for search UI.
014014| src/components/ZeroResultsSuggestions.tsx:223:       )}
014015| NOTE: Implementation detail supporting search page behavior.
014016| src/components/ZeroResultsSuggestions.tsx:224:       <div className="mt-4 pt-3 border-t border-zinc-200 dark:border-zinc-700">
014017| NOTE: Tailwind classes define layout and styling.
014018| src/components/ZeroResultsSuggestions.tsx:225:         <button
014019| NOTE: JSX markup for search UI.
014020| src/components/ZeroResultsSuggestions.tsx:226:           onClick={handleClearAll}
014021| NOTE: Implementation detail supporting search page behavior.
014022| src/components/ZeroResultsSuggestions.tsx:227:           className="w-full text-center text-sm font-medium min-h-[44px] text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors"
014023| NOTE: Tailwind classes define layout and styling.
014024| src/components/ZeroResultsSuggestions.tsx:228:         >
014025| NOTE: Implementation detail supporting search page behavior.
014026| src/components/ZeroResultsSuggestions.tsx:229:           Clear all filters
014027| NOTE: Implementation detail supporting search page behavior.
014028| src/components/ZeroResultsSuggestions.tsx:230:         </button>
014029| NOTE: JSX markup for search UI.
014030| src/components/ZeroResultsSuggestions.tsx:231:       </div>
014031| NOTE: JSX markup for search UI.
014032| src/components/ZeroResultsSuggestions.tsx:232:     </div>
014033| NOTE: JSX markup for search UI.
014034| src/components/ZeroResultsSuggestions.tsx:233:   );
014035| NOTE: Implementation detail supporting search page behavior.
014036| src/components/ZeroResultsSuggestions.tsx:234: }
014037| NOTE: Implementation detail supporting search page behavior.
014038| FILE END: src/components/ZeroResultsSuggestions.tsx
014039| 
014040| FILE START: src/components/filters/AppliedFilterChips.tsx
014041| FILE ROLE: Auto-discovered dependency in search page graph.
014042| src/components/filters/AppliedFilterChips.tsx:1: "use client";
014043| NOTE: Implementation detail supporting search page behavior.
014044| src/components/filters/AppliedFilterChips.tsx:2: 
014045| NOTE: Blank line for visual separation.
014046| src/components/filters/AppliedFilterChips.tsx:3: /**
014047| NOTE: Block comment line describing behavior or context.
014048| src/components/filters/AppliedFilterChips.tsx:4:  * AppliedFilterChips - Container for displaying applied filter chips
014049| NOTE: Block comment line describing behavior or context.
014050| src/components/filters/AppliedFilterChips.tsx:5:  *
014051| NOTE: Block comment line describing behavior or context.
014052| src/components/filters/AppliedFilterChips.tsx:6:  * Reads committed filter state from the URL and displays each filter
014053| NOTE: Block comment line describing behavior or context.
014054| src/components/filters/AppliedFilterChips.tsx:7:  * as a removable chip. Includes horizontal scrolling on mobile with
014055| NOTE: Block comment line describing behavior or context.
014056| src/components/filters/AppliedFilterChips.tsx:8:  * fade edges and a "Clear All" button when multiple filters are active.
014057| NOTE: Block comment line describing behavior or context.
014058| src/components/filters/AppliedFilterChips.tsx:9:  */
014059| NOTE: Block comment line describing behavior or context.
014060| src/components/filters/AppliedFilterChips.tsx:10: 
014061| NOTE: Blank line for visual separation.
014062| src/components/filters/AppliedFilterChips.tsx:11: import { useSearchParams, useRouter, usePathname } from "next/navigation";
014063| NOTE: Imports dependency for this module.
014064| src/components/filters/AppliedFilterChips.tsx:12: import { useTransition } from "react";
014065| NOTE: Imports dependency for this module.
014066| src/components/filters/AppliedFilterChips.tsx:13: import { X } from "lucide-react";
014067| NOTE: Imports dependency for this module.
014068| src/components/filters/AppliedFilterChips.tsx:14: import { FilterChipWithImpact } from "./FilterChipWithImpact";
014069| NOTE: Imports dependency for this module.
014070| src/components/filters/AppliedFilterChips.tsx:15: import {
014071| NOTE: Imports dependency for this module.
014072| src/components/filters/AppliedFilterChips.tsx:16:   urlToFilterChips,
014073| NOTE: Implementation detail supporting search page behavior.
014074| src/components/filters/AppliedFilterChips.tsx:17:   removeFilterFromUrl,
014075| NOTE: Implementation detail supporting search page behavior.
014076| src/components/filters/AppliedFilterChips.tsx:18:   clearAllFilters,
014077| NOTE: Implementation detail supporting search page behavior.
014078| src/components/filters/AppliedFilterChips.tsx:19:   type FilterChipData,
014079| NOTE: Type declaration for search data contracts.
014080| src/components/filters/AppliedFilterChips.tsx:20: } from "./filter-chip-utils";
014081| NOTE: Implementation detail supporting search page behavior.
014082| src/components/filters/AppliedFilterChips.tsx:21: 
014083| NOTE: Blank line for visual separation.
014084| src/components/filters/AppliedFilterChips.tsx:22: export interface AppliedFilterChipsProps {
014085| NOTE: Implementation detail supporting search page behavior.
014086| src/components/filters/AppliedFilterChips.tsx:23:   /** Current result count (for calculating impact delta on hover) */
014087| NOTE: Block comment line describing behavior or context.
014088| src/components/filters/AppliedFilterChips.tsx:24:   currentCount?: number | null;
014089| NOTE: Implementation detail supporting search page behavior.
014090| src/components/filters/AppliedFilterChips.tsx:25: }
014091| NOTE: Implementation detail supporting search page behavior.
014092| src/components/filters/AppliedFilterChips.tsx:26: 
014093| NOTE: Blank line for visual separation.
014094| src/components/filters/AppliedFilterChips.tsx:27: export function AppliedFilterChips({
014095| NOTE: Exports helper or component function.
014096| src/components/filters/AppliedFilterChips.tsx:28:   currentCount = null,
014097| NOTE: Implementation detail supporting search page behavior.
014098| src/components/filters/AppliedFilterChips.tsx:29: }: AppliedFilterChipsProps = {}) {
014099| NOTE: Implementation detail supporting search page behavior.
014100| src/components/filters/AppliedFilterChips.tsx:30:   const searchParams = useSearchParams();
014101| NOTE: Local declaration used by search logic or UI.
014102| src/components/filters/AppliedFilterChips.tsx:31:   const router = useRouter();
014103| NOTE: Local declaration used by search logic or UI.
014104| src/components/filters/AppliedFilterChips.tsx:32:   const pathname = usePathname();
014105| NOTE: Local declaration used by search logic or UI.
014106| src/components/filters/AppliedFilterChips.tsx:33:   const [isPending, startTransition] = useTransition();
014107| NOTE: Local declaration used by search logic or UI.
014108| src/components/filters/AppliedFilterChips.tsx:34: 
014109| NOTE: Blank line for visual separation.
014110| src/components/filters/AppliedFilterChips.tsx:35:   const chips = urlToFilterChips(searchParams);
014111| NOTE: Local declaration used by search logic or UI.
014112| src/components/filters/AppliedFilterChips.tsx:36: 
014113| NOTE: Blank line for visual separation.
014114| src/components/filters/AppliedFilterChips.tsx:37:   // Don't render if no chips
014115| NOTE: Line comment documents intent or constraints.
014116| src/components/filters/AppliedFilterChips.tsx:38:   if (chips.length === 0) {
014117| NOTE: Conditional logic controlling rendering or flow.
014118| src/components/filters/AppliedFilterChips.tsx:39:     return null;
014119| NOTE: Return statement for component or helper output.
014120| src/components/filters/AppliedFilterChips.tsx:40:   }
014121| NOTE: Implementation detail supporting search page behavior.
014122| src/components/filters/AppliedFilterChips.tsx:41: 
014123| NOTE: Blank line for visual separation.
014124| src/components/filters/AppliedFilterChips.tsx:42:   const handleRemove = (chip: FilterChipData) => {
014125| NOTE: Local declaration used by search logic or UI.
014126| src/components/filters/AppliedFilterChips.tsx:43:     const newQuery = removeFilterFromUrl(searchParams, chip);
014127| NOTE: Local declaration used by search logic or UI.
014128| src/components/filters/AppliedFilterChips.tsx:44:     startTransition(() => {
014129| NOTE: Implementation detail supporting search page behavior.
014130| src/components/filters/AppliedFilterChips.tsx:45:       router.push(`${pathname}${newQuery ? `?${newQuery}` : ""}`);
014131| NOTE: Routing logic updates search URL state.
014132| src/components/filters/AppliedFilterChips.tsx:46:     });
014133| NOTE: Implementation detail supporting search page behavior.
014134| src/components/filters/AppliedFilterChips.tsx:47:   };
014135| NOTE: Implementation detail supporting search page behavior.
014136| src/components/filters/AppliedFilterChips.tsx:48: 
014137| NOTE: Blank line for visual separation.
014138| src/components/filters/AppliedFilterChips.tsx:49:   const handleClearAll = () => {
014139| NOTE: Local declaration used by search logic or UI.
014140| src/components/filters/AppliedFilterChips.tsx:50:     const newQuery = clearAllFilters(searchParams);
014141| NOTE: Local declaration used by search logic or UI.
014142| src/components/filters/AppliedFilterChips.tsx:51:     startTransition(() => {
014143| NOTE: Implementation detail supporting search page behavior.
014144| src/components/filters/AppliedFilterChips.tsx:52:       router.push(`${pathname}${newQuery ? `?${newQuery}` : ""}`);
014145| NOTE: Routing logic updates search URL state.
014146| src/components/filters/AppliedFilterChips.tsx:53:     });
014147| NOTE: Implementation detail supporting search page behavior.
014148| src/components/filters/AppliedFilterChips.tsx:54:   };
014149| NOTE: Implementation detail supporting search page behavior.
014150| src/components/filters/AppliedFilterChips.tsx:55: 
014151| NOTE: Blank line for visual separation.
014152| src/components/filters/AppliedFilterChips.tsx:56:   return (
014153| NOTE: Return statement for component or helper output.
014154| src/components/filters/AppliedFilterChips.tsx:57:     <div
014155| NOTE: JSX markup for search UI.
014156| src/components/filters/AppliedFilterChips.tsx:58:       className="relative px-4 py-2 border-b border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-950"
014157| NOTE: Tailwind classes define layout and styling.
014158| src/components/filters/AppliedFilterChips.tsx:59:       role="region"
014159| NOTE: Implementation detail supporting search page behavior.
014160| src/components/filters/AppliedFilterChips.tsx:60:       aria-label="Applied filters"
014161| NOTE: Accessibility attribute for screen readers.
014162| src/components/filters/AppliedFilterChips.tsx:61:     >
014163| NOTE: Implementation detail supporting search page behavior.
014164| src/components/filters/AppliedFilterChips.tsx:62:       {/* Horizontal scrolling container */}
014165| NOTE: Implementation detail supporting search page behavior.
014166| src/components/filters/AppliedFilterChips.tsx:63:       <div className="flex items-center gap-2 overflow-x-auto scrollbar-hide">
014167| NOTE: Tailwind classes define layout and styling.
014168| src/components/filters/AppliedFilterChips.tsx:64:         {/* Filter chips */}
014169| NOTE: Implementation detail supporting search page behavior.
014170| src/components/filters/AppliedFilterChips.tsx:65:         <div className="flex items-center gap-2 flex-nowrap">
014171| NOTE: Tailwind classes define layout and styling.
014172| src/components/filters/AppliedFilterChips.tsx:66:           {chips.map((chip) => (
014173| NOTE: Implementation detail supporting search page behavior.
014174| src/components/filters/AppliedFilterChips.tsx:67:             <FilterChipWithImpact
014175| NOTE: JSX markup for search UI.
014176| src/components/filters/AppliedFilterChips.tsx:68:               key={chip.id}
014177| NOTE: Implementation detail supporting search page behavior.
014178| src/components/filters/AppliedFilterChips.tsx:69:               chip={chip}
014179| NOTE: Implementation detail supporting search page behavior.
014180| src/components/filters/AppliedFilterChips.tsx:70:               onRemove={() => handleRemove(chip)}
014181| NOTE: Implementation detail supporting search page behavior.
014182| src/components/filters/AppliedFilterChips.tsx:71:               isRemoving={isPending}
014183| NOTE: Implementation detail supporting search page behavior.
014184| src/components/filters/AppliedFilterChips.tsx:72:               currentCount={currentCount}
014185| NOTE: Implementation detail supporting search page behavior.
014186| src/components/filters/AppliedFilterChips.tsx:73:             />
014187| NOTE: Implementation detail supporting search page behavior.
014188| src/components/filters/AppliedFilterChips.tsx:74:           ))}
014189| NOTE: Implementation detail supporting search page behavior.
014190| src/components/filters/AppliedFilterChips.tsx:75:         </div>
014191| NOTE: JSX markup for search UI.
014192| src/components/filters/AppliedFilterChips.tsx:76: 
014193| NOTE: Blank line for visual separation.
014194| src/components/filters/AppliedFilterChips.tsx:77:         {/* Clear All button - only show when multiple filters */}
014195| NOTE: Implementation detail supporting search page behavior.
014196| src/components/filters/AppliedFilterChips.tsx:78:         {chips.length > 1 && (
014197| NOTE: Implementation detail supporting search page behavior.
014198| src/components/filters/AppliedFilterChips.tsx:79:           <button
014199| NOTE: JSX markup for search UI.
014200| src/components/filters/AppliedFilterChips.tsx:80:             type="button"
014201| NOTE: Implementation detail supporting search page behavior.
014202| src/components/filters/AppliedFilterChips.tsx:81:             onClick={handleClearAll}
014203| NOTE: Implementation detail supporting search page behavior.
014204| src/components/filters/AppliedFilterChips.tsx:82:             disabled={isPending}
014205| NOTE: Implementation detail supporting search page behavior.
014206| src/components/filters/AppliedFilterChips.tsx:83:             className="flex-shrink-0 flex items-center gap-1.5 px-3 py-1.5 min-h-[44px] text-sm font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
014207| NOTE: Tailwind classes define layout and styling.
014208| src/components/filters/AppliedFilterChips.tsx:84:             aria-label="Clear all filters"
014209| NOTE: Accessibility attribute for screen readers.
014210| src/components/filters/AppliedFilterChips.tsx:85:           >
014211| NOTE: Implementation detail supporting search page behavior.
014212| src/components/filters/AppliedFilterChips.tsx:86:             <X className="w-3.5 h-3.5" aria-hidden="true" />
014213| NOTE: Tailwind classes define layout and styling.
014214| src/components/filters/AppliedFilterChips.tsx:87:             <span>Clear all</span>
014215| NOTE: JSX markup for search UI.
014216| src/components/filters/AppliedFilterChips.tsx:88:           </button>
014217| NOTE: JSX markup for search UI.
014218| src/components/filters/AppliedFilterChips.tsx:89:         )}
014219| NOTE: Implementation detail supporting search page behavior.
014220| src/components/filters/AppliedFilterChips.tsx:90:       </div>
014221| NOTE: JSX markup for search UI.
014222| src/components/filters/AppliedFilterChips.tsx:91: 
014223| NOTE: Blank line for visual separation.
014224| src/components/filters/AppliedFilterChips.tsx:92:       {/* Left fade edge (visible when scrolled) */}
014225| NOTE: Implementation detail supporting search page behavior.
014226| src/components/filters/AppliedFilterChips.tsx:93:       <div
014227| NOTE: JSX markup for search UI.
014228| src/components/filters/AppliedFilterChips.tsx:94:         className="absolute left-0 top-0 bottom-0 w-4 bg-gradient-to-r from-white dark:from-zinc-950 to-transparent pointer-events-none opacity-0 md:hidden"
014229| NOTE: Tailwind classes define layout and styling.
014230| src/components/filters/AppliedFilterChips.tsx:95:         aria-hidden="true"
014231| NOTE: Accessibility attribute for screen readers.
014232| src/components/filters/AppliedFilterChips.tsx:96:       />
014233| NOTE: Implementation detail supporting search page behavior.
014234| src/components/filters/AppliedFilterChips.tsx:97: 
014235| NOTE: Blank line for visual separation.
014236| src/components/filters/AppliedFilterChips.tsx:98:       {/* Right fade edge (visible when content overflows) */}
014237| NOTE: Implementation detail supporting search page behavior.
014238| src/components/filters/AppliedFilterChips.tsx:99:       <div
014239| NOTE: JSX markup for search UI.
014240| src/components/filters/AppliedFilterChips.tsx:100:         className="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white dark:from-zinc-950 to-transparent pointer-events-none md:hidden"
014241| NOTE: Tailwind classes define layout and styling.
014242| src/components/filters/AppliedFilterChips.tsx:101:         aria-hidden="true"
014243| NOTE: Accessibility attribute for screen readers.
014244| src/components/filters/AppliedFilterChips.tsx:102:       />
014245| NOTE: Implementation detail supporting search page behavior.
014246| src/components/filters/AppliedFilterChips.tsx:103:     </div>
014247| NOTE: JSX markup for search UI.
014248| src/components/filters/AppliedFilterChips.tsx:104:   );
014249| NOTE: Implementation detail supporting search page behavior.
014250| src/components/filters/AppliedFilterChips.tsx:105: }
014251| NOTE: Implementation detail supporting search page behavior.
014252| FILE END: src/components/filters/AppliedFilterChips.tsx
014253| 
014254| FILE START: src/components/filters/FilterChip.tsx
014255| FILE ROLE: Auto-discovered dependency in search page graph.
014256| src/components/filters/FilterChip.tsx:1: "use client";
014257| NOTE: Implementation detail supporting search page behavior.
014258| src/components/filters/FilterChip.tsx:2: 
014259| NOTE: Blank line for visual separation.
014260| src/components/filters/FilterChip.tsx:3: /**
014261| NOTE: Block comment line describing behavior or context.
014262| src/components/filters/FilterChip.tsx:4:  * FilterChip - Individual removable filter chip
014263| NOTE: Block comment line describing behavior or context.
014264| src/components/filters/FilterChip.tsx:5:  *
014265| NOTE: Block comment line describing behavior or context.
014266| src/components/filters/FilterChip.tsx:6:  * Displays a filter value as a pill-shaped chip with a remove button.
014267| NOTE: Block comment line describing behavior or context.
014268| src/components/filters/FilterChip.tsx:7:  * Fully keyboard accessible with proper ARIA labels.
014269| NOTE: Block comment line describing behavior or context.
014270| src/components/filters/FilterChip.tsx:8:  * Optionally shows impact count badge on hover ("+N" more results).
014271| NOTE: Block comment line describing behavior or context.
014272| src/components/filters/FilterChip.tsx:9:  */
014273| NOTE: Block comment line describing behavior or context.
014274| src/components/filters/FilterChip.tsx:10: 
014275| NOTE: Blank line for visual separation.
014276| src/components/filters/FilterChip.tsx:11: import { X } from "lucide-react";
014277| NOTE: Imports dependency for this module.
014278| src/components/filters/FilterChip.tsx:12: import { clsx, type ClassValue } from "clsx";
014279| NOTE: Imports dependency for this module.
014280| src/components/filters/FilterChip.tsx:13: import { twMerge } from "tailwind-merge";
014281| NOTE: Imports dependency for this module.
014282| src/components/filters/FilterChip.tsx:14: 
014283| NOTE: Blank line for visual separation.
014284| src/components/filters/FilterChip.tsx:15: function cn(...inputs: ClassValue[]) {
014285| NOTE: Defines a helper or component function.
014286| src/components/filters/FilterChip.tsx:16:   return twMerge(clsx(inputs));
014287| NOTE: Return statement for component or helper output.
014288| src/components/filters/FilterChip.tsx:17: }
014289| NOTE: Implementation detail supporting search page behavior.
014290| src/components/filters/FilterChip.tsx:18: 
014291| NOTE: Blank line for visual separation.
014292| src/components/filters/FilterChip.tsx:19: export interface FilterChipProps {
014293| NOTE: Implementation detail supporting search page behavior.
014294| src/components/filters/FilterChip.tsx:20:   /** Display label shown on the chip */
014295| NOTE: Block comment line describing behavior or context.
014296| src/components/filters/FilterChip.tsx:21:   label: string;
014297| NOTE: Implementation detail supporting search page behavior.
014298| src/components/filters/FilterChip.tsx:22:   /** Called when the chip is removed */
014299| NOTE: Block comment line describing behavior or context.
014300| src/components/filters/FilterChip.tsx:23:   onRemove: () => void;
014301| NOTE: Implementation detail supporting search page behavior.
014302| src/components/filters/FilterChip.tsx:24:   /** Whether removal is in progress */
014303| NOTE: Block comment line describing behavior or context.
014304| src/components/filters/FilterChip.tsx:25:   isRemoving?: boolean;
014305| NOTE: Implementation detail supporting search page behavior.
014306| src/components/filters/FilterChip.tsx:26:   /** Impact count delta when removing (e.g., "+22") */
014307| NOTE: Block comment line describing behavior or context.
014308| src/components/filters/FilterChip.tsx:27:   impactDelta?: string | null;
014309| NOTE: Implementation detail supporting search page behavior.
014310| src/components/filters/FilterChip.tsx:28:   /** Whether impact count is loading */
014311| NOTE: Block comment line describing behavior or context.
014312| src/components/filters/FilterChip.tsx:29:   isImpactLoading?: boolean;
014313| NOTE: Implementation detail supporting search page behavior.
014314| src/components/filters/FilterChip.tsx:30:   /** Called when chip is hovered */
014315| NOTE: Block comment line describing behavior or context.
014316| src/components/filters/FilterChip.tsx:31:   onHoverStart?: () => void;
014317| NOTE: Implementation detail supporting search page behavior.
014318| src/components/filters/FilterChip.tsx:32:   /** Called when chip stops being hovered */
014319| NOTE: Block comment line describing behavior or context.
014320| src/components/filters/FilterChip.tsx:33:   onHoverEnd?: () => void;
014321| NOTE: Implementation detail supporting search page behavior.
014322| src/components/filters/FilterChip.tsx:34:   /** Additional class names */
014323| NOTE: Block comment line describing behavior or context.
014324| src/components/filters/FilterChip.tsx:35:   className?: string;
014325| NOTE: Implementation detail supporting search page behavior.
014326| src/components/filters/FilterChip.tsx:36: }
014327| NOTE: Implementation detail supporting search page behavior.
014328| src/components/filters/FilterChip.tsx:37: 
014329| NOTE: Blank line for visual separation.
014330| src/components/filters/FilterChip.tsx:38: export function FilterChip({
014331| NOTE: Exports helper or component function.
014332| src/components/filters/FilterChip.tsx:39:   label,
014333| NOTE: Implementation detail supporting search page behavior.
014334| src/components/filters/FilterChip.tsx:40:   onRemove,
014335| NOTE: Implementation detail supporting search page behavior.
014336| src/components/filters/FilterChip.tsx:41:   isRemoving = false,
014337| NOTE: Implementation detail supporting search page behavior.
014338| src/components/filters/FilterChip.tsx:42:   impactDelta,
014339| NOTE: Implementation detail supporting search page behavior.
014340| src/components/filters/FilterChip.tsx:43:   isImpactLoading,
014341| NOTE: Implementation detail supporting search page behavior.
014342| src/components/filters/FilterChip.tsx:44:   onHoverStart,
014343| NOTE: Implementation detail supporting search page behavior.
014344| src/components/filters/FilterChip.tsx:45:   onHoverEnd,
014345| NOTE: Implementation detail supporting search page behavior.
014346| src/components/filters/FilterChip.tsx:46:   className,
014347| NOTE: Implementation detail supporting search page behavior.
014348| src/components/filters/FilterChip.tsx:47: }: FilterChipProps) {
014349| NOTE: Implementation detail supporting search page behavior.
014350| src/components/filters/FilterChip.tsx:48:   const handleKeyDown = (e: React.KeyboardEvent) => {
014351| NOTE: Local declaration used by search logic or UI.
014352| src/components/filters/FilterChip.tsx:49:     if (e.key === "Enter" || e.key === " ") {
014353| NOTE: Conditional logic controlling rendering or flow.
014354| src/components/filters/FilterChip.tsx:50:       e.preventDefault();
014355| NOTE: Implementation detail supporting search page behavior.
014356| src/components/filters/FilterChip.tsx:51:       onRemove();
014357| NOTE: Implementation detail supporting search page behavior.
014358| src/components/filters/FilterChip.tsx:52:     }
014359| NOTE: Implementation detail supporting search page behavior.
014360| src/components/filters/FilterChip.tsx:53:   };
014361| NOTE: Implementation detail supporting search page behavior.
014362| src/components/filters/FilterChip.tsx:54: 
014363| NOTE: Blank line for visual separation.
014364| src/components/filters/FilterChip.tsx:55:   return (
014365| NOTE: Return statement for component or helper output.
014366| src/components/filters/FilterChip.tsx:56:     <span
014367| NOTE: JSX markup for search UI.
014368| src/components/filters/FilterChip.tsx:57:       className={cn(
014369| NOTE: Tailwind classes define layout and styling.
014370| src/components/filters/FilterChip.tsx:58:         "inline-flex items-center gap-1.5 px-3 py-1.5",
014371| NOTE: Implementation detail supporting search page behavior.
014372| src/components/filters/FilterChip.tsx:59:         "bg-zinc-100 dark:bg-zinc-800",
014373| NOTE: Implementation detail supporting search page behavior.
014374| src/components/filters/FilterChip.tsx:60:         "text-sm text-zinc-700 dark:text-zinc-300",
014375| NOTE: Implementation detail supporting search page behavior.
014376| src/components/filters/FilterChip.tsx:61:         "rounded-full",
014377| NOTE: Implementation detail supporting search page behavior.
014378| src/components/filters/FilterChip.tsx:62:         "transition-colors duration-150",
014379| NOTE: Implementation detail supporting search page behavior.
014380| src/components/filters/FilterChip.tsx:63:         "group/chip",
014381| NOTE: Implementation detail supporting search page behavior.
014382| src/components/filters/FilterChip.tsx:64:         isRemoving && "opacity-50",
014383| NOTE: Implementation detail supporting search page behavior.
014384| src/components/filters/FilterChip.tsx:65:         className,
014385| NOTE: Implementation detail supporting search page behavior.
014386| src/components/filters/FilterChip.tsx:66:       )}
014387| NOTE: Implementation detail supporting search page behavior.
014388| src/components/filters/FilterChip.tsx:67:       onMouseEnter={onHoverStart}
014389| NOTE: Implementation detail supporting search page behavior.
014390| src/components/filters/FilterChip.tsx:68:       onMouseLeave={onHoverEnd}
014391| NOTE: Implementation detail supporting search page behavior.
014392| src/components/filters/FilterChip.tsx:69:     >
014393| NOTE: Implementation detail supporting search page behavior.
014394| src/components/filters/FilterChip.tsx:70:       <span className="max-w-[200px] truncate">{label}</span>
014395| NOTE: Tailwind classes define layout and styling.
014396| src/components/filters/FilterChip.tsx:71: 
014397| NOTE: Blank line for visual separation.
014398| src/components/filters/FilterChip.tsx:72:       {/* Impact count badge - shows on hover when data is available */}
014399| NOTE: Implementation detail supporting search page behavior.
014400| src/components/filters/FilterChip.tsx:73:       {(impactDelta || isImpactLoading) && (
014401| NOTE: Implementation detail supporting search page behavior.
014402| src/components/filters/FilterChip.tsx:74:         <span
014403| NOTE: JSX markup for search UI.
014404| src/components/filters/FilterChip.tsx:75:           className={cn(
014405| NOTE: Tailwind classes define layout and styling.
014406| src/components/filters/FilterChip.tsx:76:             "inline-flex items-center justify-center",
014407| NOTE: Implementation detail supporting search page behavior.
014408| src/components/filters/FilterChip.tsx:77:             "min-w-[1.25rem] px-1 py-0.5",
014409| NOTE: Implementation detail supporting search page behavior.
014410| src/components/filters/FilterChip.tsx:78:             "text-2xs font-semibold",
014411| NOTE: Implementation detail supporting search page behavior.
014412| src/components/filters/FilterChip.tsx:79:             "rounded-full",
014413| NOTE: Implementation detail supporting search page behavior.
014414| src/components/filters/FilterChip.tsx:80:             "bg-emerald-100 dark:bg-emerald-900/50",
014415| NOTE: Implementation detail supporting search page behavior.
014416| src/components/filters/FilterChip.tsx:81:             "text-emerald-700 dark:text-emerald-300",
014417| NOTE: Implementation detail supporting search page behavior.
014418| src/components/filters/FilterChip.tsx:82:             "opacity-0 group-hover/chip:opacity-100",
014419| NOTE: Implementation detail supporting search page behavior.
014420| src/components/filters/FilterChip.tsx:83:             "transition-opacity duration-150",
014421| NOTE: Implementation detail supporting search page behavior.
014422| src/components/filters/FilterChip.tsx:84:           )}
014423| NOTE: Implementation detail supporting search page behavior.
014424| src/components/filters/FilterChip.tsx:85:           aria-label={
014425| NOTE: Accessibility attribute for screen readers.
014426| src/components/filters/FilterChip.tsx:86:             impactDelta
014427| NOTE: Implementation detail supporting search page behavior.
014428| src/components/filters/FilterChip.tsx:87:               ? `Removing this filter adds ${impactDelta} more results`
014429| NOTE: Implementation detail supporting search page behavior.
014430| src/components/filters/FilterChip.tsx:88:               : "Loading impact count"
014431| NOTE: Implementation detail supporting search page behavior.
014432| src/components/filters/FilterChip.tsx:89:           }
014433| NOTE: Implementation detail supporting search page behavior.
014434| src/components/filters/FilterChip.tsx:90:         >
014435| NOTE: Implementation detail supporting search page behavior.
014436| src/components/filters/FilterChip.tsx:91:           {isImpactLoading ? (
014437| NOTE: Implementation detail supporting search page behavior.
014438| src/components/filters/FilterChip.tsx:92:             <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse" />
014439| NOTE: Tailwind classes define layout and styling.
014440| src/components/filters/FilterChip.tsx:93:           ) : (
014441| NOTE: Implementation detail supporting search page behavior.
014442| src/components/filters/FilterChip.tsx:94:             impactDelta
014443| NOTE: Implementation detail supporting search page behavior.
014444| src/components/filters/FilterChip.tsx:95:           )}
014445| NOTE: Implementation detail supporting search page behavior.
014446| src/components/filters/FilterChip.tsx:96:         </span>
014447| NOTE: JSX markup for search UI.
014448| src/components/filters/FilterChip.tsx:97:       )}
014449| NOTE: Implementation detail supporting search page behavior.
014450| src/components/filters/FilterChip.tsx:98: 
014451| NOTE: Blank line for visual separation.
014452| src/components/filters/FilterChip.tsx:99:       <button
014453| NOTE: JSX markup for search UI.
014454| src/components/filters/FilterChip.tsx:100:         type="button"
014455| NOTE: Implementation detail supporting search page behavior.
014456| src/components/filters/FilterChip.tsx:101:         onClick={onRemove}
014457| NOTE: Implementation detail supporting search page behavior.
014458| src/components/filters/FilterChip.tsx:102:         onKeyDown={handleKeyDown}
014459| NOTE: Implementation detail supporting search page behavior.
014460| src/components/filters/FilterChip.tsx:103:         disabled={isRemoving}
014461| NOTE: Implementation detail supporting search page behavior.
014462| src/components/filters/FilterChip.tsx:104:         className={cn(
014463| NOTE: Tailwind classes define layout and styling.
014464| src/components/filters/FilterChip.tsx:105:           // Visual appearance: compact rounded button
014465| NOTE: Line comment documents intent or constraints.
014466| src/components/filters/FilterChip.tsx:106:           "relative flex items-center justify-center",
014467| NOTE: Implementation detail supporting search page behavior.
014468| src/components/filters/FilterChip.tsx:107:           "w-4 h-4 rounded-full",
014469| NOTE: Implementation detail supporting search page behavior.
014470| src/components/filters/FilterChip.tsx:108:           "text-zinc-500 dark:text-zinc-400",
014471| NOTE: Implementation detail supporting search page behavior.
014472| src/components/filters/FilterChip.tsx:109:           "hover:bg-zinc-200 dark:hover:bg-zinc-700",
014473| NOTE: Implementation detail supporting search page behavior.
014474| src/components/filters/FilterChip.tsx:110:           "hover:text-zinc-700 dark:hover:text-zinc-200",
014475| NOTE: Implementation detail supporting search page behavior.
014476| src/components/filters/FilterChip.tsx:111:           "focus:outline-none focus-visible:ring-2 focus-visible:ring-zinc-400",
014477| NOTE: Implementation detail supporting search page behavior.
014478| src/components/filters/FilterChip.tsx:112:           "transition-colors duration-150",
014479| NOTE: Implementation detail supporting search page behavior.
014480| src/components/filters/FilterChip.tsx:113:           "disabled:opacity-50 disabled:cursor-not-allowed",
014481| NOTE: Implementation detail supporting search page behavior.
014482| src/components/filters/FilterChip.tsx:114:           // WCAG: 44x44px minimum touch target via pseudo-element (16px + 14px*2 = 44px)
014483| NOTE: Line comment documents intent or constraints.
014484| src/components/filters/FilterChip.tsx:115:           "before:absolute before:inset-0 before:-m-[14px] before:content-['']",
014485| NOTE: Implementation detail supporting search page behavior.
014486| src/components/filters/FilterChip.tsx:116:         )}
014487| NOTE: Implementation detail supporting search page behavior.
014488| src/components/filters/FilterChip.tsx:117:         aria-label={`Remove filter: ${label}`}
014489| NOTE: Accessibility attribute for screen readers.
014490| src/components/filters/FilterChip.tsx:118:       >
014491| NOTE: Implementation detail supporting search page behavior.
014492| src/components/filters/FilterChip.tsx:119:         <X className="w-3 h-3" aria-hidden="true" />
014493| NOTE: Tailwind classes define layout and styling.
014494| src/components/filters/FilterChip.tsx:120:       </button>
014495| NOTE: JSX markup for search UI.
014496| src/components/filters/FilterChip.tsx:121:     </span>
014497| NOTE: JSX markup for search UI.
014498| src/components/filters/FilterChip.tsx:122:   );
014499| NOTE: Implementation detail supporting search page behavior.
014500| src/components/filters/FilterChip.tsx:123: }
014501| NOTE: Implementation detail supporting search page behavior.
014502| FILE END: src/components/filters/FilterChip.tsx
014503| 
014504| FILE START: src/components/filters/FilterChipWithImpact.tsx
014505| FILE ROLE: Auto-discovered dependency in search page graph.
014506| src/components/filters/FilterChipWithImpact.tsx:1: "use client";
014507| NOTE: Implementation detail supporting search page behavior.
014508| src/components/filters/FilterChipWithImpact.tsx:2: 
014509| NOTE: Blank line for visual separation.
014510| src/components/filters/FilterChipWithImpact.tsx:3: /**
014511| NOTE: Block comment line describing behavior or context.
014512| src/components/filters/FilterChipWithImpact.tsx:4:  * FilterChipWithImpact - Filter chip with lazy-loaded impact count
014513| NOTE: Block comment line describing behavior or context.
014514| src/components/filters/FilterChipWithImpact.tsx:5:  *
014515| NOTE: Block comment line describing behavior or context.
014516| src/components/filters/FilterChipWithImpact.tsx:6:  * Wraps FilterChip and adds hover-triggered impact count fetching.
014517| NOTE: Block comment line describing behavior or context.
014518| src/components/filters/FilterChipWithImpact.tsx:7:  * Shows "+N" badge indicating how many more results would appear
014519| NOTE: Block comment line describing behavior or context.
014520| src/components/filters/FilterChipWithImpact.tsx:8:  * if this filter were removed.
014521| NOTE: Block comment line describing behavior or context.
014522| src/components/filters/FilterChipWithImpact.tsx:9:  */
014523| NOTE: Block comment line describing behavior or context.
014524| src/components/filters/FilterChipWithImpact.tsx:10: 
014525| NOTE: Blank line for visual separation.
014526| src/components/filters/FilterChipWithImpact.tsx:11: import { useState } from "react";
014527| NOTE: Imports dependency for this module.
014528| src/components/filters/FilterChipWithImpact.tsx:12: import { useSearchParams } from "next/navigation";
014529| NOTE: Imports dependency for this module.
014530| src/components/filters/FilterChipWithImpact.tsx:13: import { FilterChip } from "./FilterChip";
014531| NOTE: Imports dependency for this module.
014532| src/components/filters/FilterChipWithImpact.tsx:14: import { useFilterImpactCount } from "@/hooks/useFilterImpactCount";
014533| NOTE: Imports dependency for this module.
014534| src/components/filters/FilterChipWithImpact.tsx:15: import type { FilterChipData } from "./filter-chip-utils";
014535| NOTE: Imports dependency for this module.
014536| src/components/filters/FilterChipWithImpact.tsx:16: 
014537| NOTE: Blank line for visual separation.
014538| src/components/filters/FilterChipWithImpact.tsx:17: export interface FilterChipWithImpactProps {
014539| NOTE: Implementation detail supporting search page behavior.
014540| src/components/filters/FilterChipWithImpact.tsx:18:   /** The filter chip data */
014541| NOTE: Block comment line describing behavior or context.
014542| src/components/filters/FilterChipWithImpact.tsx:19:   chip: FilterChipData;
014543| NOTE: Implementation detail supporting search page behavior.
014544| src/components/filters/FilterChipWithImpact.tsx:20:   /** Called when the chip is removed */
014545| NOTE: Block comment line describing behavior or context.
014546| src/components/filters/FilterChipWithImpact.tsx:21:   onRemove: () => void;
014547| NOTE: Implementation detail supporting search page behavior.
014548| src/components/filters/FilterChipWithImpact.tsx:22:   /** Whether removal is in progress */
014549| NOTE: Block comment line describing behavior or context.
014550| src/components/filters/FilterChipWithImpact.tsx:23:   isRemoving?: boolean;
014551| NOTE: Implementation detail supporting search page behavior.
014552| src/components/filters/FilterChipWithImpact.tsx:24:   /** Current result count (for calculating delta) */
014553| NOTE: Block comment line describing behavior or context.
014554| src/components/filters/FilterChipWithImpact.tsx:25:   currentCount?: number | null;
014555| NOTE: Implementation detail supporting search page behavior.
014556| src/components/filters/FilterChipWithImpact.tsx:26: }
014557| NOTE: Implementation detail supporting search page behavior.
014558| src/components/filters/FilterChipWithImpact.tsx:27: 
014559| NOTE: Blank line for visual separation.
014560| src/components/filters/FilterChipWithImpact.tsx:28: export function FilterChipWithImpact({
014561| NOTE: Exports helper or component function.
014562| src/components/filters/FilterChipWithImpact.tsx:29:   chip,
014563| NOTE: Implementation detail supporting search page behavior.
014564| src/components/filters/FilterChipWithImpact.tsx:30:   onRemove,
014565| NOTE: Implementation detail supporting search page behavior.
014566| src/components/filters/FilterChipWithImpact.tsx:31:   isRemoving = false,
014567| NOTE: Implementation detail supporting search page behavior.
014568| src/components/filters/FilterChipWithImpact.tsx:32:   currentCount = null,
014569| NOTE: Implementation detail supporting search page behavior.
014570| src/components/filters/FilterChipWithImpact.tsx:33: }: FilterChipWithImpactProps) {
014571| NOTE: Implementation detail supporting search page behavior.
014572| src/components/filters/FilterChipWithImpact.tsx:34:   const searchParams = useSearchParams();
014573| NOTE: Local declaration used by search logic or UI.
014574| src/components/filters/FilterChipWithImpact.tsx:35:   const [isHovering, setIsHovering] = useState(false);
014575| NOTE: Initializes local state for search UI behavior.
014576| src/components/filters/FilterChipWithImpact.tsx:36: 
014577| NOTE: Blank line for visual separation.
014578| src/components/filters/FilterChipWithImpact.tsx:37:   const { formattedDelta, isLoading } = useFilterImpactCount({
014579| NOTE: Local declaration used by search logic or UI.
014580| src/components/filters/FilterChipWithImpact.tsx:38:     searchParams,
014581| NOTE: Implementation detail supporting search page behavior.
014582| src/components/filters/FilterChipWithImpact.tsx:39:     chip,
014583| NOTE: Implementation detail supporting search page behavior.
014584| src/components/filters/FilterChipWithImpact.tsx:40:     isHovering,
014585| NOTE: Implementation detail supporting search page behavior.
014586| src/components/filters/FilterChipWithImpact.tsx:41:     currentCount,
014587| NOTE: Implementation detail supporting search page behavior.
014588| src/components/filters/FilterChipWithImpact.tsx:42:   });
014589| NOTE: Implementation detail supporting search page behavior.
014590| src/components/filters/FilterChipWithImpact.tsx:43: 
014591| NOTE: Blank line for visual separation.
014592| src/components/filters/FilterChipWithImpact.tsx:44:   return (
014593| NOTE: Return statement for component or helper output.
014594| src/components/filters/FilterChipWithImpact.tsx:45:     <FilterChip
014595| NOTE: JSX markup for search UI.
014596| src/components/filters/FilterChipWithImpact.tsx:46:       label={chip.label}
014597| NOTE: Implementation detail supporting search page behavior.
014598| src/components/filters/FilterChipWithImpact.tsx:47:       onRemove={onRemove}
014599| NOTE: Implementation detail supporting search page behavior.
014600| src/components/filters/FilterChipWithImpact.tsx:48:       isRemoving={isRemoving}
014601| NOTE: Implementation detail supporting search page behavior.
014602| src/components/filters/FilterChipWithImpact.tsx:49:       impactDelta={formattedDelta}
014603| NOTE: Implementation detail supporting search page behavior.
014604| src/components/filters/FilterChipWithImpact.tsx:50:       isImpactLoading={isLoading}
014605| NOTE: Implementation detail supporting search page behavior.
014606| src/components/filters/FilterChipWithImpact.tsx:51:       onHoverStart={() => setIsHovering(true)}
014607| NOTE: Implementation detail supporting search page behavior.
014608| src/components/filters/FilterChipWithImpact.tsx:52:       onHoverEnd={() => setIsHovering(false)}
014609| NOTE: Implementation detail supporting search page behavior.
014610| src/components/filters/FilterChipWithImpact.tsx:53:     />
014611| NOTE: Implementation detail supporting search page behavior.
014612| src/components/filters/FilterChipWithImpact.tsx:54:   );
014613| NOTE: Implementation detail supporting search page behavior.
014614| src/components/filters/FilterChipWithImpact.tsx:55: }
014615| NOTE: Implementation detail supporting search page behavior.
014616| FILE END: src/components/filters/FilterChipWithImpact.tsx
014617| 
014618| FILE START: src/components/filters/FilterStickyFooter.tsx
014619| FILE ROLE: Auto-discovered dependency in search page graph.
014620| src/components/filters/FilterStickyFooter.tsx:1: "use client";
014621| NOTE: Implementation detail supporting search page behavior.
014622| src/components/filters/FilterStickyFooter.tsx:2: 
014623| NOTE: Blank line for visual separation.
014624| src/components/filters/FilterStickyFooter.tsx:3: /**
014625| NOTE: Block comment line describing behavior or context.
014626| src/components/filters/FilterStickyFooter.tsx:4:  * FilterStickyFooter - Sticky footer for filter drawer
014627| NOTE: Block comment line describing behavior or context.
014628| src/components/filters/FilterStickyFooter.tsx:5:  *
014629| NOTE: Block comment line describing behavior or context.
014630| src/components/filters/FilterStickyFooter.tsx:6:  * Shows Apply and Reset buttons when batched filters have pending changes.
014631| NOTE: Block comment line describing behavior or context.
014632| src/components/filters/FilterStickyFooter.tsx:7:  * Appears at the bottom of the filter drawer, fixed in place.
014633| NOTE: Block comment line describing behavior or context.
014634| src/components/filters/FilterStickyFooter.tsx:8:  *
014635| NOTE: Block comment line describing behavior or context.
014636| src/components/filters/FilterStickyFooter.tsx:9:  * When pendingCount is provided, shows "Show X listings" instead of "Apply (N)".
014637| NOTE: Block comment line describing behavior or context.
014638| src/components/filters/FilterStickyFooter.tsx:10:  */
014639| NOTE: Block comment line describing behavior or context.
014640| src/components/filters/FilterStickyFooter.tsx:11: 
014641| NOTE: Blank line for visual separation.
014642| src/components/filters/FilterStickyFooter.tsx:12: import { Button } from "@/components/ui/button";
014643| NOTE: Imports dependency for this module.
014644| src/components/filters/FilterStickyFooter.tsx:13: import { RotateCcw, Loader2 } from "lucide-react";
014645| NOTE: Imports dependency for this module.
014646| src/components/filters/FilterStickyFooter.tsx:14: 
014647| NOTE: Blank line for visual separation.
014648| src/components/filters/FilterStickyFooter.tsx:15: interface FilterStickyFooterProps {
014649| NOTE: Type declaration for search data contracts.
014650| src/components/filters/FilterStickyFooter.tsx:16:   /** Whether there are pending changes */
014651| NOTE: Block comment line describing behavior or context.
014652| src/components/filters/FilterStickyFooter.tsx:17:   isDirty: boolean;
014653| NOTE: Implementation detail supporting search page behavior.
014654| src/components/filters/FilterStickyFooter.tsx:18:   /** Number of changed filters */
014655| NOTE: Block comment line describing behavior or context.
014656| src/components/filters/FilterStickyFooter.tsx:19:   changeCount: number;
014657| NOTE: Implementation detail supporting search page behavior.
014658| src/components/filters/FilterStickyFooter.tsx:20:   /** Handler for apply button */
014659| NOTE: Block comment line describing behavior or context.
014660| src/components/filters/FilterStickyFooter.tsx:21:   onApply: () => void;
014661| NOTE: Implementation detail supporting search page behavior.
014662| src/components/filters/FilterStickyFooter.tsx:22:   /** Handler for reset button */
014663| NOTE: Block comment line describing behavior or context.
014664| src/components/filters/FilterStickyFooter.tsx:23:   onReset: () => void;
014665| NOTE: Implementation detail supporting search page behavior.
014666| src/components/filters/FilterStickyFooter.tsx:24:   /** Whether apply is in progress */
014667| NOTE: Block comment line describing behavior or context.
014668| src/components/filters/FilterStickyFooter.tsx:25:   isApplying?: boolean;
014669| NOTE: Implementation detail supporting search page behavior.
014670| src/components/filters/FilterStickyFooter.tsx:26:   /** Count of listings matching pending filters (null = 100+) */
014671| NOTE: Block comment line describing behavior or context.
014672| src/components/filters/FilterStickyFooter.tsx:27:   pendingCount?: number | null;
014673| NOTE: Implementation detail supporting search page behavior.
014674| src/components/filters/FilterStickyFooter.tsx:28:   /** Previous count before current loading (for optimistic UI) */
014675| NOTE: Block comment line describing behavior or context.
014676| src/components/filters/FilterStickyFooter.tsx:29:   previousCount?: number | null;
014677| NOTE: Implementation detail supporting search page behavior.
014678| src/components/filters/FilterStickyFooter.tsx:30:   /** Baseline count from committed filters (for delta calculation) */
014679| NOTE: Block comment line describing behavior or context.
014680| src/components/filters/FilterStickyFooter.tsx:31:   baselineCount?: number | null;
014681| NOTE: Implementation detail supporting search page behavior.
014682| src/components/filters/FilterStickyFooter.tsx:32:   /** Whether count is being fetched */
014683| NOTE: Block comment line describing behavior or context.
014684| src/components/filters/FilterStickyFooter.tsx:33:   isCountLoading?: boolean;
014685| NOTE: Implementation detail supporting search page behavior.
014686| src/components/filters/FilterStickyFooter.tsx:34: }
014687| NOTE: Implementation detail supporting search page behavior.
014688| src/components/filters/FilterStickyFooter.tsx:35: 
014689| NOTE: Blank line for visual separation.
014690| src/components/filters/FilterStickyFooter.tsx:36: export function FilterStickyFooter({
014691| NOTE: Exports helper or component function.
014692| src/components/filters/FilterStickyFooter.tsx:37:   isDirty,
014693| NOTE: Implementation detail supporting search page behavior.
014694| src/components/filters/FilterStickyFooter.tsx:38:   changeCount,
014695| NOTE: Implementation detail supporting search page behavior.
014696| src/components/filters/FilterStickyFooter.tsx:39:   onApply,
014697| NOTE: Implementation detail supporting search page behavior.
014698| src/components/filters/FilterStickyFooter.tsx:40:   onReset,
014699| NOTE: Implementation detail supporting search page behavior.
014700| src/components/filters/FilterStickyFooter.tsx:41:   isApplying = false,
014701| NOTE: Implementation detail supporting search page behavior.
014702| src/components/filters/FilterStickyFooter.tsx:42:   pendingCount,
014703| NOTE: Implementation detail supporting search page behavior.
014704| src/components/filters/FilterStickyFooter.tsx:43:   previousCount,
014705| NOTE: Implementation detail supporting search page behavior.
014706| src/components/filters/FilterStickyFooter.tsx:44:   baselineCount,
014707| NOTE: Implementation detail supporting search page behavior.
014708| src/components/filters/FilterStickyFooter.tsx:45:   isCountLoading = false,
014709| NOTE: Implementation detail supporting search page behavior.
014710| src/components/filters/FilterStickyFooter.tsx:46: }: FilterStickyFooterProps) {
014711| NOTE: Implementation detail supporting search page behavior.
014712| src/components/filters/FilterStickyFooter.tsx:47:   // Calculate delta between pending and baseline count
014713| NOTE: Line comment documents intent or constraints.
014714| src/components/filters/FilterStickyFooter.tsx:48:   const getDelta = (): { value: number; display: string } | null => {
014715| NOTE: Local declaration used by search logic or UI.
014716| src/components/filters/FilterStickyFooter.tsx:49:     if (
014717| NOTE: Conditional logic controlling rendering or flow.
014718| src/components/filters/FilterStickyFooter.tsx:50:       pendingCount === undefined ||
014719| NOTE: Implementation detail supporting search page behavior.
014720| src/components/filters/FilterStickyFooter.tsx:51:       pendingCount === null ||
014721| NOTE: Implementation detail supporting search page behavior.
014722| src/components/filters/FilterStickyFooter.tsx:52:       baselineCount === undefined ||
014723| NOTE: Implementation detail supporting search page behavior.
014724| src/components/filters/FilterStickyFooter.tsx:53:       baselineCount === null
014725| NOTE: Implementation detail supporting search page behavior.
014726| src/components/filters/FilterStickyFooter.tsx:54:     ) {
014727| NOTE: Implementation detail supporting search page behavior.
014728| src/components/filters/FilterStickyFooter.tsx:55:       return null;
014729| NOTE: Return statement for component or helper output.
014730| src/components/filters/FilterStickyFooter.tsx:56:     }
014731| NOTE: Implementation detail supporting search page behavior.
014732| src/components/filters/FilterStickyFooter.tsx:57:     const delta = pendingCount - baselineCount;
014733| NOTE: Local declaration used by search logic or UI.
014734| src/components/filters/FilterStickyFooter.tsx:58:     if (delta === 0) return null;
014735| NOTE: Conditional logic controlling rendering or flow.
014736| src/components/filters/FilterStickyFooter.tsx:59:     return {
014737| NOTE: Return statement for component or helper output.
014738| src/components/filters/FilterStickyFooter.tsx:60:       value: delta,
014739| NOTE: Implementation detail supporting search page behavior.
014740| src/components/filters/FilterStickyFooter.tsx:61:       display: delta > 0 ? `+${delta}` : `${delta}`,
014741| NOTE: Implementation detail supporting search page behavior.
014742| src/components/filters/FilterStickyFooter.tsx:62:     };
014743| NOTE: Implementation detail supporting search page behavior.
014744| src/components/filters/FilterStickyFooter.tsx:63:   };
014745| NOTE: Implementation detail supporting search page behavior.
014746| src/components/filters/FilterStickyFooter.tsx:64: 
014747| NOTE: Blank line for visual separation.
014748| src/components/filters/FilterStickyFooter.tsx:65:   const delta = !isCountLoading ? getDelta() : null;
014749| NOTE: Local declaration used by search logic or UI.
014750| src/components/filters/FilterStickyFooter.tsx:66: 
014751| NOTE: Blank line for visual separation.
014752| src/components/filters/FilterStickyFooter.tsx:67:   // Determine button text based on count state
014753| NOTE: Line comment documents intent or constraints.
014754| src/components/filters/FilterStickyFooter.tsx:68:   const getButtonText = () => {
014755| NOTE: Local declaration used by search logic or UI.
014756| src/components/filters/FilterStickyFooter.tsx:69:     if (isApplying) {
014757| NOTE: Conditional logic controlling rendering or flow.
014758| src/components/filters/FilterStickyFooter.tsx:70:       return "Applying...";
014759| NOTE: Return statement for component or helper output.
014760| src/components/filters/FilterStickyFooter.tsx:71:     }
014761| NOTE: Implementation detail supporting search page behavior.
014762| src/components/filters/FilterStickyFooter.tsx:72: 
014763| NOTE: Blank line for visual separation.
014764| src/components/filters/FilterStickyFooter.tsx:73:     // If we have count info, show "Show X listings" format
014765| NOTE: Line comment documents intent or constraints.
014766| src/components/filters/FilterStickyFooter.tsx:74:     if (isDirty && pendingCount !== undefined) {
014767| NOTE: Conditional logic controlling rendering or flow.
014768| src/components/filters/FilterStickyFooter.tsx:75:       if (isCountLoading) {
014769| NOTE: Conditional logic controlling rendering or flow.
014770| src/components/filters/FilterStickyFooter.tsx:76:         // Optimistic UI: show previous count with "(updating...)" suffix
014771| NOTE: Line comment documents intent or constraints.
014772| src/components/filters/FilterStickyFooter.tsx:77:         if (previousCount !== undefined && previousCount !== null) {
014773| NOTE: Conditional logic controlling rendering or flow.
014774| src/components/filters/FilterStickyFooter.tsx:78:           return (
014775| NOTE: Return statement for component or helper output.
014776| src/components/filters/FilterStickyFooter.tsx:79:             <>
014777| NOTE: JSX markup for search UI.
014778| src/components/filters/FilterStickyFooter.tsx:80:               <Loader2 className="w-4 h-4 animate-spin mr-1.5" />
014779| NOTE: Tailwind classes define layout and styling.
014780| src/components/filters/FilterStickyFooter.tsx:81:               Show{" "}
014781| NOTE: Implementation detail supporting search page behavior.
014782| src/components/filters/FilterStickyFooter.tsx:82:               {previousCount === 1
014783| NOTE: Implementation detail supporting search page behavior.
014784| src/components/filters/FilterStickyFooter.tsx:83:                 ? "1 listing"
014785| NOTE: Implementation detail supporting search page behavior.
014786| src/components/filters/FilterStickyFooter.tsx:84:                 : `${previousCount} listings`}{" "}
014787| NOTE: Implementation detail supporting search page behavior.
014788| src/components/filters/FilterStickyFooter.tsx:85:               <span className="text-xs opacity-70">(updating...)</span>
014789| NOTE: Tailwind classes define layout and styling.
014790| src/components/filters/FilterStickyFooter.tsx:86:             </>
014791| NOTE: JSX markup for search UI.
014792| src/components/filters/FilterStickyFooter.tsx:87:           );
014793| NOTE: Implementation detail supporting search page behavior.
014794| src/components/filters/FilterStickyFooter.tsx:88:         }
014795| NOTE: Implementation detail supporting search page behavior.
014796| src/components/filters/FilterStickyFooter.tsx:89:         // No previous count - show generic loading
014797| NOTE: Line comment documents intent or constraints.
014798| src/components/filters/FilterStickyFooter.tsx:90:         return (
014799| NOTE: Return statement for component or helper output.
014800| src/components/filters/FilterStickyFooter.tsx:91:           <>
014801| NOTE: JSX markup for search UI.
014802| src/components/filters/FilterStickyFooter.tsx:92:             <Loader2 className="w-4 h-4 animate-spin mr-1.5" />
014803| NOTE: Tailwind classes define layout and styling.
014804| src/components/filters/FilterStickyFooter.tsx:93:             Show listings
014805| NOTE: Implementation detail supporting search page behavior.
014806| src/components/filters/FilterStickyFooter.tsx:94:           </>
014807| NOTE: JSX markup for search UI.
014808| src/components/filters/FilterStickyFooter.tsx:95:         );
014809| NOTE: Implementation detail supporting search page behavior.
014810| src/components/filters/FilterStickyFooter.tsx:96:       }
014811| NOTE: Implementation detail supporting search page behavior.
014812| src/components/filters/FilterStickyFooter.tsx:97:       if (pendingCount === null) {
014813| NOTE: Conditional logic controlling rendering or flow.
014814| src/components/filters/FilterStickyFooter.tsx:98:         return "Show 100+ listings";
014815| NOTE: Return statement for component or helper output.
014816| src/components/filters/FilterStickyFooter.tsx:99:       }
014817| NOTE: Implementation detail supporting search page behavior.
014818| src/components/filters/FilterStickyFooter.tsx:100:       if (pendingCount === 0) {
014819| NOTE: Conditional logic controlling rendering or flow.
014820| src/components/filters/FilterStickyFooter.tsx:101:         return (
014821| NOTE: Return statement for component or helper output.
014822| src/components/filters/FilterStickyFooter.tsx:102:           <span className="flex items-center gap-1.5">
014823| NOTE: Tailwind classes define layout and styling.
014824| src/components/filters/FilterStickyFooter.tsx:103:             <span>No listings found</span>
014825| NOTE: JSX markup for search UI.
014826| src/components/filters/FilterStickyFooter.tsx:104:             <span className="text-xs bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-1.5 py-0.5 rounded">
014827| NOTE: Tailwind classes define layout and styling.
014828| src/components/filters/FilterStickyFooter.tsx:105:               Try adjusting filters
014829| NOTE: Implementation detail supporting search page behavior.
014830| src/components/filters/FilterStickyFooter.tsx:106:             </span>
014831| NOTE: JSX markup for search UI.
014832| src/components/filters/FilterStickyFooter.tsx:107:           </span>
014833| NOTE: JSX markup for search UI.
014834| src/components/filters/FilterStickyFooter.tsx:108:         );
014835| NOTE: Implementation detail supporting search page behavior.
014836| src/components/filters/FilterStickyFooter.tsx:109:       }
014837| NOTE: Implementation detail supporting search page behavior.
014838| src/components/filters/FilterStickyFooter.tsx:110:       // Show count with delta if available
014839| NOTE: Line comment documents intent or constraints.
014840| src/components/filters/FilterStickyFooter.tsx:111:       const countText =
014841| NOTE: Local declaration used by search logic or UI.
014842| src/components/filters/FilterStickyFooter.tsx:112:         pendingCount === 1 ? "1 listing" : `${pendingCount} listings`;
014843| NOTE: Implementation detail supporting search page behavior.
014844| src/components/filters/FilterStickyFooter.tsx:113:       if (delta) {
014845| NOTE: Conditional logic controlling rendering or flow.
014846| src/components/filters/FilterStickyFooter.tsx:114:         return (
014847| NOTE: Return statement for component or helper output.
014848| src/components/filters/FilterStickyFooter.tsx:115:           <span className="flex items-center gap-1.5">
014849| NOTE: Tailwind classes define layout and styling.
014850| src/components/filters/FilterStickyFooter.tsx:116:             <span>Show {countText}</span>
014851| NOTE: JSX markup for search UI.
014852| src/components/filters/FilterStickyFooter.tsx:117:             <span
014853| NOTE: JSX markup for search UI.
014854| src/components/filters/FilterStickyFooter.tsx:118:               className={`text-xs font-medium px-1.5 py-0.5 rounded ${
014855| NOTE: Tailwind classes define layout and styling.
014856| src/components/filters/FilterStickyFooter.tsx:119:                 delta.value > 0
014857| NOTE: Implementation detail supporting search page behavior.
014858| src/components/filters/FilterStickyFooter.tsx:120:                   ? "bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300"
014859| NOTE: Implementation detail supporting search page behavior.
014860| src/components/filters/FilterStickyFooter.tsx:121:                   : "bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300"
014861| NOTE: Implementation detail supporting search page behavior.
014862| src/components/filters/FilterStickyFooter.tsx:122:               }`}
014863| NOTE: Implementation detail supporting search page behavior.
014864| src/components/filters/FilterStickyFooter.tsx:123:             >
014865| NOTE: Implementation detail supporting search page behavior.
014866| src/components/filters/FilterStickyFooter.tsx:124:               {delta.display}
014867| NOTE: Implementation detail supporting search page behavior.
014868| src/components/filters/FilterStickyFooter.tsx:125:             </span>
014869| NOTE: JSX markup for search UI.
014870| src/components/filters/FilterStickyFooter.tsx:126:           </span>
014871| NOTE: JSX markup for search UI.
014872| src/components/filters/FilterStickyFooter.tsx:127:         );
014873| NOTE: Implementation detail supporting search page behavior.
014874| src/components/filters/FilterStickyFooter.tsx:128:       }
014875| NOTE: Implementation detail supporting search page behavior.
014876| src/components/filters/FilterStickyFooter.tsx:129:       return `Show ${countText}`;
014877| NOTE: Return statement for component or helper output.
014878| src/components/filters/FilterStickyFooter.tsx:130:     }
014879| NOTE: Implementation detail supporting search page behavior.
014880| src/components/filters/FilterStickyFooter.tsx:131: 
014881| NOTE: Blank line for visual separation.
014882| src/components/filters/FilterStickyFooter.tsx:132:     // Fallback to original "Apply (N)" format
014883| NOTE: Line comment documents intent or constraints.
014884| src/components/filters/FilterStickyFooter.tsx:133:     if (isDirty && changeCount > 0) {
014885| NOTE: Conditional logic controlling rendering or flow.
014886| src/components/filters/FilterStickyFooter.tsx:134:       return `Apply (${changeCount})`;
014887| NOTE: Return statement for component or helper output.
014888| src/components/filters/FilterStickyFooter.tsx:135:     }
014889| NOTE: Implementation detail supporting search page behavior.
014890| src/components/filters/FilterStickyFooter.tsx:136: 
014891| NOTE: Blank line for visual separation.
014892| src/components/filters/FilterStickyFooter.tsx:137:     return "Apply";
014893| NOTE: Return statement for component or helper output.
014894| src/components/filters/FilterStickyFooter.tsx:138:   };
014895| NOTE: Implementation detail supporting search page behavior.
014896| src/components/filters/FilterStickyFooter.tsx:139: 
014897| NOTE: Blank line for visual separation.
014898| src/components/filters/FilterStickyFooter.tsx:140:   // Determine aria-label based on count state
014899| NOTE: Line comment documents intent or constraints.
014900| src/components/filters/FilterStickyFooter.tsx:141:   const getAriaLabel = () => {
014901| NOTE: Local declaration used by search logic or UI.
014902| src/components/filters/FilterStickyFooter.tsx:142:     if (pendingCount !== undefined && isDirty) {
014903| NOTE: Conditional logic controlling rendering or flow.
014904| src/components/filters/FilterStickyFooter.tsx:143:       if (isCountLoading) {
014905| NOTE: Conditional logic controlling rendering or flow.
014906| src/components/filters/FilterStickyFooter.tsx:144:         return "Loading listing count";
014907| NOTE: Return statement for component or helper output.
014908| src/components/filters/FilterStickyFooter.tsx:145:       }
014909| NOTE: Implementation detail supporting search page behavior.
014910| src/components/filters/FilterStickyFooter.tsx:146:       if (pendingCount === null) {
014911| NOTE: Conditional logic controlling rendering or flow.
014912| src/components/filters/FilterStickyFooter.tsx:147:         return "Show more than 100 listings";
014913| NOTE: Return statement for component or helper output.
014914| src/components/filters/FilterStickyFooter.tsx:148:       }
014915| NOTE: Implementation detail supporting search page behavior.
014916| src/components/filters/FilterStickyFooter.tsx:149:       if (pendingCount === 0) {
014917| NOTE: Conditional logic controlling rendering or flow.
014918| src/components/filters/FilterStickyFooter.tsx:150:         return "No listings match these filters";
014919| NOTE: Return statement for component or helper output.
014920| src/components/filters/FilterStickyFooter.tsx:151:       }
014921| NOTE: Implementation detail supporting search page behavior.
014922| src/components/filters/FilterStickyFooter.tsx:152:       return `Show ${pendingCount} listing${pendingCount === 1 ? "" : "s"}`;
014923| NOTE: Return statement for component or helper output.
014924| src/components/filters/FilterStickyFooter.tsx:153:     }
014925| NOTE: Implementation detail supporting search page behavior.
014926| src/components/filters/FilterStickyFooter.tsx:154: 
014927| NOTE: Blank line for visual separation.
014928| src/components/filters/FilterStickyFooter.tsx:155:     if (changeCount > 0) {
014929| NOTE: Conditional logic controlling rendering or flow.
014930| src/components/filters/FilterStickyFooter.tsx:156:       return `Apply ${changeCount} filter ${changeCount === 1 ? "change" : "changes"}`;
014931| NOTE: Return statement for component or helper output.
014932| src/components/filters/FilterStickyFooter.tsx:157:     }
014933| NOTE: Implementation detail supporting search page behavior.
014934| src/components/filters/FilterStickyFooter.tsx:158: 
014935| NOTE: Blank line for visual separation.
014936| src/components/filters/FilterStickyFooter.tsx:159:     return "Apply filters";
014937| NOTE: Return statement for component or helper output.
014938| src/components/filters/FilterStickyFooter.tsx:160:   };
014939| NOTE: Implementation detail supporting search page behavior.
014940| src/components/filters/FilterStickyFooter.tsx:161: 
014941| NOTE: Blank line for visual separation.
014942| src/components/filters/FilterStickyFooter.tsx:162:   return (
014943| NOTE: Return statement for component or helper output.
014944| src/components/filters/FilterStickyFooter.tsx:163:     <div className="sticky bottom-0 left-0 right-0 bg-white dark:bg-zinc-900 border-t border-zinc-200 dark:border-zinc-700 p-4 flex items-center gap-3 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
014945| NOTE: Tailwind classes define layout and styling.
014946| src/components/filters/FilterStickyFooter.tsx:164:       <Button
014947| NOTE: JSX markup for search UI.
014948| src/components/filters/FilterStickyFooter.tsx:165:         variant="outline"
014949| NOTE: Implementation detail supporting search page behavior.
014950| src/components/filters/FilterStickyFooter.tsx:166:         size="sm"
014951| NOTE: Implementation detail supporting search page behavior.
014952| src/components/filters/FilterStickyFooter.tsx:167:         onClick={onReset}
014953| NOTE: Implementation detail supporting search page behavior.
014954| src/components/filters/FilterStickyFooter.tsx:168:         disabled={!isDirty || isApplying}
014955| NOTE: Implementation detail supporting search page behavior.
014956| src/components/filters/FilterStickyFooter.tsx:169:         className="flex items-center gap-1.5"
014957| NOTE: Tailwind classes define layout and styling.
014958| src/components/filters/FilterStickyFooter.tsx:170:         aria-label="Reset filters to last applied state"
014959| NOTE: Accessibility attribute for screen readers.
014960| src/components/filters/FilterStickyFooter.tsx:171:       >
014961| NOTE: Implementation detail supporting search page behavior.
014962| src/components/filters/FilterStickyFooter.tsx:172:         <RotateCcw className="w-4 h-4" />
014963| NOTE: Tailwind classes define layout and styling.
014964| src/components/filters/FilterStickyFooter.tsx:173:         <span>Reset</span>
014965| NOTE: JSX markup for search UI.
014966| src/components/filters/FilterStickyFooter.tsx:174:       </Button>
014967| NOTE: JSX markup for search UI.
014968| src/components/filters/FilterStickyFooter.tsx:175: 
014969| NOTE: Blank line for visual separation.
014970| src/components/filters/FilterStickyFooter.tsx:176:       <Button
014971| NOTE: JSX markup for search UI.
014972| src/components/filters/FilterStickyFooter.tsx:177:         variant="primary"
014973| NOTE: Implementation detail supporting search page behavior.
014974| src/components/filters/FilterStickyFooter.tsx:178:         size="sm"
014975| NOTE: Implementation detail supporting search page behavior.
014976| src/components/filters/FilterStickyFooter.tsx:179:         onClick={onApply}
014977| NOTE: Implementation detail supporting search page behavior.
014978| src/components/filters/FilterStickyFooter.tsx:180:         disabled={!isDirty || isApplying}
014979| NOTE: Implementation detail supporting search page behavior.
014980| src/components/filters/FilterStickyFooter.tsx:181:         className="flex-1 flex items-center justify-center"
014981| NOTE: Tailwind classes define layout and styling.
014982| src/components/filters/FilterStickyFooter.tsx:182:         aria-label={getAriaLabel()}
014983| NOTE: Accessibility attribute for screen readers.
014984| src/components/filters/FilterStickyFooter.tsx:183:       >
014985| NOTE: Implementation detail supporting search page behavior.
014986| src/components/filters/FilterStickyFooter.tsx:184:         {getButtonText()}
014987| NOTE: Implementation detail supporting search page behavior.
014988| src/components/filters/FilterStickyFooter.tsx:185:       </Button>
014989| NOTE: JSX markup for search UI.
014990| src/components/filters/FilterStickyFooter.tsx:186:     </div>
014991| NOTE: JSX markup for search UI.
014992| src/components/filters/FilterStickyFooter.tsx:187:   );
014993| NOTE: Implementation detail supporting search page behavior.
014994| src/components/filters/FilterStickyFooter.tsx:188: }
014995| NOTE: Implementation detail supporting search page behavior.
014996| FILE END: src/components/filters/FilterStickyFooter.tsx
014997| 
014998| FILE START: src/components/filters/PendingFiltersBanner.tsx
014999| FILE ROLE: Auto-discovered dependency in search page graph.
015000| src/components/filters/PendingFiltersBanner.tsx:1: "use client";
015001| NOTE: Implementation detail supporting search page behavior.
015002| src/components/filters/PendingFiltersBanner.tsx:2: 
015003| NOTE: Blank line for visual separation.
015004| src/components/filters/PendingFiltersBanner.tsx:3: /**
015005| NOTE: Block comment line describing behavior or context.
015006| src/components/filters/PendingFiltersBanner.tsx:4:  * PendingFiltersBanner - Shows when filters have pending changes
015007| NOTE: Block comment line describing behavior or context.
015008| src/components/filters/PendingFiltersBanner.tsx:5:  *
015009| NOTE: Block comment line describing behavior or context.
015010| src/components/filters/PendingFiltersBanner.tsx:6:  * This banner appears above the results list when the user has changed filters
015011| NOTE: Block comment line describing behavior or context.
015012| src/components/filters/PendingFiltersBanner.tsx:7:  * but hasn't applied them yet (and the filter drawer is closed).
015013| NOTE: Block comment line describing behavior or context.
015014| src/components/filters/PendingFiltersBanner.tsx:8:  * It provides a clear visual indicator and a way to open the filter drawer.
015015| NOTE: Block comment line describing behavior or context.
015016| src/components/filters/PendingFiltersBanner.tsx:9:  */
015017| NOTE: Block comment line describing behavior or context.
015018| src/components/filters/PendingFiltersBanner.tsx:10: 
015019| NOTE: Blank line for visual separation.
015020| src/components/filters/PendingFiltersBanner.tsx:11: import { SlidersHorizontal } from "lucide-react";
015021| NOTE: Imports dependency for this module.
015022| src/components/filters/PendingFiltersBanner.tsx:12: import { Button } from "@/components/ui/button";
015023| NOTE: Imports dependency for this module.
015024| src/components/filters/PendingFiltersBanner.tsx:13: import { useFilterStateSafe } from "@/contexts/FilterStateContext";
015025| NOTE: Imports dependency for this module.
015026| src/components/filters/PendingFiltersBanner.tsx:14: 
015027| NOTE: Blank line for visual separation.
015028| src/components/filters/PendingFiltersBanner.tsx:15: export function PendingFiltersBanner() {
015029| NOTE: Exports helper or component function.
015030| src/components/filters/PendingFiltersBanner.tsx:16:   const filterState = useFilterStateSafe();
015031| NOTE: Local declaration used by search logic or UI.
015032| src/components/filters/PendingFiltersBanner.tsx:17: 
015033| NOTE: Blank line for visual separation.
015034| src/components/filters/PendingFiltersBanner.tsx:18:   // Don't render if context not available, not dirty, or drawer is open
015035| NOTE: Line comment documents intent or constraints.
015036| src/components/filters/PendingFiltersBanner.tsx:19:   if (!filterState || !filterState.isDirty || filterState.isDrawerOpen) {
015037| NOTE: Conditional logic controlling rendering or flow.
015038| src/components/filters/PendingFiltersBanner.tsx:20:     return null;
015039| NOTE: Return statement for component or helper output.
015040| src/components/filters/PendingFiltersBanner.tsx:21:   }
015041| NOTE: Implementation detail supporting search page behavior.
015042| src/components/filters/PendingFiltersBanner.tsx:22: 
015043| NOTE: Blank line for visual separation.
015044| src/components/filters/PendingFiltersBanner.tsx:23:   const { changeCount, openDrawer } = filterState;
015045| NOTE: Local declaration used by search logic or UI.
015046| src/components/filters/PendingFiltersBanner.tsx:24: 
015047| NOTE: Blank line for visual separation.
015048| src/components/filters/PendingFiltersBanner.tsx:25:   return (
015049| NOTE: Return statement for component or helper output.
015050| src/components/filters/PendingFiltersBanner.tsx:26:     <div
015051| NOTE: JSX markup for search UI.
015052| src/components/filters/PendingFiltersBanner.tsx:27:       className="bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800 px-4 py-3"
015053| NOTE: Tailwind classes define layout and styling.
015054| src/components/filters/PendingFiltersBanner.tsx:28:       role="status"
015055| NOTE: Implementation detail supporting search page behavior.
015056| src/components/filters/PendingFiltersBanner.tsx:29:       aria-live="polite"
015057| NOTE: Accessibility attribute for screen readers.
015058| src/components/filters/PendingFiltersBanner.tsx:30:     >
015059| NOTE: Implementation detail supporting search page behavior.
015060| src/components/filters/PendingFiltersBanner.tsx:31:       <div className="max-w-7xl mx-auto flex items-center justify-between gap-4">
015061| NOTE: Tailwind classes define layout and styling.
015062| src/components/filters/PendingFiltersBanner.tsx:32:         <div className="flex items-center gap-2 text-sm text-amber-800 dark:text-amber-300">
015063| NOTE: Tailwind classes define layout and styling.
015064| src/components/filters/PendingFiltersBanner.tsx:33:           <SlidersHorizontal className="w-4 h-4 flex-shrink-0" />
015065| NOTE: Tailwind classes define layout and styling.
015066| src/components/filters/PendingFiltersBanner.tsx:34:           <span>
015067| NOTE: JSX markup for search UI.
015068| src/components/filters/PendingFiltersBanner.tsx:35:             <span className="font-medium">
015069| NOTE: Tailwind classes define layout and styling.
015070| src/components/filters/PendingFiltersBanner.tsx:36:               {changeCount} filter {changeCount === 1 ? "change" : "changes"}
015071| NOTE: Implementation detail supporting search page behavior.
015072| src/components/filters/PendingFiltersBanner.tsx:37:             </span>
015073| NOTE: JSX markup for search UI.
015074| src/components/filters/PendingFiltersBanner.tsx:38:             {" \u2014 "}
015075| NOTE: Implementation detail supporting search page behavior.
015076| src/components/filters/PendingFiltersBanner.tsx:39:             <span className="text-amber-700 dark:text-amber-400">
015077| NOTE: Tailwind classes define layout and styling.
015078| src/components/filters/PendingFiltersBanner.tsx:40:               Apply to update results
015079| NOTE: Implementation detail supporting search page behavior.
015080| src/components/filters/PendingFiltersBanner.tsx:41:             </span>
015081| NOTE: JSX markup for search UI.
015082| src/components/filters/PendingFiltersBanner.tsx:42:           </span>
015083| NOTE: JSX markup for search UI.
015084| src/components/filters/PendingFiltersBanner.tsx:43:         </div>
015085| NOTE: JSX markup for search UI.
015086| src/components/filters/PendingFiltersBanner.tsx:44: 
015087| NOTE: Blank line for visual separation.
015088| src/components/filters/PendingFiltersBanner.tsx:45:         <Button
015089| NOTE: JSX markup for search UI.
015090| src/components/filters/PendingFiltersBanner.tsx:46:           variant="outline"
015091| NOTE: Implementation detail supporting search page behavior.
015092| src/components/filters/PendingFiltersBanner.tsx:47:           size="sm"
015093| NOTE: Implementation detail supporting search page behavior.
015094| src/components/filters/PendingFiltersBanner.tsx:48:           onClick={openDrawer}
015095| NOTE: Implementation detail supporting search page behavior.
015096| src/components/filters/PendingFiltersBanner.tsx:49:           className="flex-shrink-0 border-amber-300 dark:border-amber-700 bg-white dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 hover:bg-amber-100 dark:hover:bg-amber-900/50 hover:border-amber-400 dark:hover:border-amber-600"
015097| NOTE: Tailwind classes define layout and styling.
015098| src/components/filters/PendingFiltersBanner.tsx:50:         >
015099| NOTE: Implementation detail supporting search page behavior.
015100| src/components/filters/PendingFiltersBanner.tsx:51:           View filters
015101| NOTE: Implementation detail supporting search page behavior.
015102| src/components/filters/PendingFiltersBanner.tsx:52:           {changeCount > 0 && (
015103| NOTE: Implementation detail supporting search page behavior.
015104| src/components/filters/PendingFiltersBanner.tsx:53:             <span className="ml-1.5 inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-semibold rounded-full bg-amber-600 dark:bg-amber-500 text-white">
015105| NOTE: Tailwind classes define layout and styling.
015106| src/components/filters/PendingFiltersBanner.tsx:54:               {changeCount}
015107| NOTE: Implementation detail supporting search page behavior.
015108| src/components/filters/PendingFiltersBanner.tsx:55:             </span>
015109| NOTE: JSX markup for search UI.
015110| src/components/filters/PendingFiltersBanner.tsx:56:           )}
015111| NOTE: Implementation detail supporting search page behavior.
015112| src/components/filters/PendingFiltersBanner.tsx:57:         </Button>
015113| NOTE: JSX markup for search UI.
015114| src/components/filters/PendingFiltersBanner.tsx:58:       </div>
015115| NOTE: JSX markup for search UI.
015116| src/components/filters/PendingFiltersBanner.tsx:59:     </div>
015117| NOTE: JSX markup for search UI.
015118| src/components/filters/PendingFiltersBanner.tsx:60:   );
015119| NOTE: Implementation detail supporting search page behavior.
015120| src/components/filters/PendingFiltersBanner.tsx:61: }
015121| NOTE: Implementation detail supporting search page behavior.
015122| FILE END: src/components/filters/PendingFiltersBanner.tsx
015123| 
015124| FILE START: src/components/filters/filter-chip-utils.ts
015125| FILE ROLE: Auto-discovered dependency in search page graph.
015126| src/components/filters/filter-chip-utils.ts:1: /**
015127| NOTE: Block comment line describing behavior or context.
015128| src/components/filters/filter-chip-utils.ts:2:  * Filter Chip Utilities
015129| NOTE: Block comment line describing behavior or context.
015130| src/components/filters/filter-chip-utils.ts:3:  *
015131| NOTE: Block comment line describing behavior or context.
015132| src/components/filters/filter-chip-utils.ts:4:  * Pure utility functions for converting URL search params to displayable
015133| NOTE: Block comment line describing behavior or context.
015134| src/components/filters/filter-chip-utils.ts:5:  * filter chips and manipulating filter state.
015135| NOTE: Block comment line describing behavior or context.
015136| src/components/filters/filter-chip-utils.ts:6:  */
015137| NOTE: Block comment line describing behavior or context.
015138| src/components/filters/filter-chip-utils.ts:7: 
015139| NOTE: Blank line for visual separation.
015140| src/components/filters/filter-chip-utils.ts:8: import { getLanguageName } from "@/lib/languages";
015141| NOTE: Imports dependency for this module.
015142| src/components/filters/filter-chip-utils.ts:9: import { getPriceParam } from "@/lib/search-params";
015143| NOTE: Imports dependency for this module.
015144| src/components/filters/filter-chip-utils.ts:10: 
015145| NOTE: Blank line for visual separation.
015146| src/components/filters/filter-chip-utils.ts:11: /**
015147| NOTE: Block comment line describing behavior or context.
015148| src/components/filters/filter-chip-utils.ts:12:  * Represents a single filter chip that can be displayed and removed
015149| NOTE: Block comment line describing behavior or context.
015150| src/components/filters/filter-chip-utils.ts:13:  */
015151| NOTE: Block comment line describing behavior or context.
015152| src/components/filters/filter-chip-utils.ts:14: export interface FilterChipData {
015153| NOTE: Implementation detail supporting search page behavior.
015154| src/components/filters/filter-chip-utils.ts:15:   /** Unique identifier for the chip (param key or param:value for arrays) */
015155| NOTE: Block comment line describing behavior or context.
015156| src/components/filters/filter-chip-utils.ts:16:   id: string;
015157| NOTE: Implementation detail supporting search page behavior.
015158| src/components/filters/filter-chip-utils.ts:17:   /** Display label shown to the user */
015159| NOTE: Block comment line describing behavior or context.
015160| src/components/filters/filter-chip-utils.ts:18:   label: string;
015161| NOTE: Implementation detail supporting search page behavior.
015162| src/components/filters/filter-chip-utils.ts:19:   /** URL parameter key this chip represents */
015163| NOTE: Block comment line describing behavior or context.
015164| src/components/filters/filter-chip-utils.ts:20:   paramKey: string;
015165| NOTE: Implementation detail supporting search page behavior.
015166| src/components/filters/filter-chip-utils.ts:21:   /** Value to remove (for array params like amenities) */
015167| NOTE: Block comment line describing behavior or context.
015168| src/components/filters/filter-chip-utils.ts:22:   paramValue?: string;
015169| NOTE: Implementation detail supporting search page behavior.
015170| src/components/filters/filter-chip-utils.ts:23: }
015171| NOTE: Implementation detail supporting search page behavior.
015172| src/components/filters/filter-chip-utils.ts:24: 
015173| NOTE: Blank line for visual separation.
015174| src/components/filters/filter-chip-utils.ts:25: /**
015175| NOTE: Block comment line describing behavior or context.
015176| src/components/filters/filter-chip-utils.ts:26:  * Parameters that should be preserved when clearing filters.
015177| NOTE: Block comment line describing behavior or context.
015178| src/components/filters/filter-chip-utils.ts:27:  * These represent search context, not removable filter chips.
015179| NOTE: Block comment line describing behavior or context.
015180| src/components/filters/filter-chip-utils.ts:28:  */
015181| NOTE: Block comment line describing behavior or context.
015182| src/components/filters/filter-chip-utils.ts:29: const PRESERVED_PARAMS = [
015183| NOTE: Local declaration used by search logic or UI.
015184| src/components/filters/filter-chip-utils.ts:30:   "q",
015185| NOTE: Implementation detail supporting search page behavior.
015186| src/components/filters/filter-chip-utils.ts:31:   "lat",
015187| NOTE: Implementation detail supporting search page behavior.
015188| src/components/filters/filter-chip-utils.ts:32:   "lng",
015189| NOTE: Implementation detail supporting search page behavior.
015190| src/components/filters/filter-chip-utils.ts:33:   "minLat",
015191| NOTE: Implementation detail supporting search page behavior.
015192| src/components/filters/filter-chip-utils.ts:34:   "maxLat",
015193| NOTE: Implementation detail supporting search page behavior.
015194| src/components/filters/filter-chip-utils.ts:35:   "minLng",
015195| NOTE: Implementation detail supporting search page behavior.
015196| src/components/filters/filter-chip-utils.ts:36:   "maxLng",
015197| NOTE: Implementation detail supporting search page behavior.
015198| src/components/filters/filter-chip-utils.ts:37:   "sort",
015199| NOTE: Implementation detail supporting search page behavior.
015200| src/components/filters/filter-chip-utils.ts:38: ] as const;
015201| NOTE: Implementation detail supporting search page behavior.
015202| src/components/filters/filter-chip-utils.ts:39: 
015203| NOTE: Blank line for visual separation.
015204| src/components/filters/filter-chip-utils.ts:40: /**
015205| NOTE: Block comment line describing behavior or context.
015206| src/components/filters/filter-chip-utils.ts:41:  * Parameters that are UI state, not filters - should be ignored for chips.
015207| NOTE: Block comment line describing behavior or context.
015208| src/components/filters/filter-chip-utils.ts:42:  * Kept for documentation; prefixed to avoid unused variable warnings.
015209| NOTE: Block comment line describing behavior or context.
015210| src/components/filters/filter-chip-utils.ts:43:  */
015211| NOTE: Block comment line describing behavior or context.
015212| src/components/filters/filter-chip-utils.ts:44: const _UI_STATE_PARAMS = ["page", "view", "drawerOpen"] as const;
015213| NOTE: Local declaration used by search logic or UI.
015214| src/components/filters/filter-chip-utils.ts:45: 
015215| NOTE: Blank line for visual separation.
015216| src/components/filters/filter-chip-utils.ts:46: /**
015217| NOTE: Block comment line describing behavior or context.
015218| src/components/filters/filter-chip-utils.ts:47:  * Parameters that represent filter state (eligible for chips).
015219| NOTE: Block comment line describing behavior or context.
015220| src/components/filters/filter-chip-utils.ts:48:  * Used for reference; prefixed to avoid unused variable warnings.
015221| NOTE: Block comment line describing behavior or context.
015222| src/components/filters/filter-chip-utils.ts:49:  */
015223| NOTE: Block comment line describing behavior or context.
015224| src/components/filters/filter-chip-utils.ts:50: const _FILTER_PARAMS = [
015225| NOTE: Local declaration used by search logic or UI.
015226| src/components/filters/filter-chip-utils.ts:51:   "minPrice",
015227| NOTE: Implementation detail supporting search page behavior.
015228| src/components/filters/filter-chip-utils.ts:52:   "maxPrice",
015229| NOTE: Implementation detail supporting search page behavior.
015230| src/components/filters/filter-chip-utils.ts:53:   "amenities",
015231| NOTE: Implementation detail supporting search page behavior.
015232| src/components/filters/filter-chip-utils.ts:54:   "houseRules",
015233| NOTE: Implementation detail supporting search page behavior.
015234| src/components/filters/filter-chip-utils.ts:55:   "languages",
015235| NOTE: Implementation detail supporting search page behavior.
015236| src/components/filters/filter-chip-utils.ts:56:   "roomType",
015237| NOTE: Implementation detail supporting search page behavior.
015238| src/components/filters/filter-chip-utils.ts:57:   "leaseDuration",
015239| NOTE: Implementation detail supporting search page behavior.
015240| src/components/filters/filter-chip-utils.ts:58:   "moveInDate",
015241| NOTE: Implementation detail supporting search page behavior.
015242| src/components/filters/filter-chip-utils.ts:59:   "nearMatches",
015243| NOTE: Implementation detail supporting search page behavior.
015244| src/components/filters/filter-chip-utils.ts:60: ] as const;
015245| NOTE: Implementation detail supporting search page behavior.
015246| src/components/filters/filter-chip-utils.ts:61: 
015247| NOTE: Blank line for visual separation.
015248| src/components/filters/filter-chip-utils.ts:62: type _FilterParamKey = (typeof _FILTER_PARAMS)[number];
015249| NOTE: Type declaration for search data contracts.
015250| src/components/filters/filter-chip-utils.ts:63: 
015251| NOTE: Blank line for visual separation.
015252| src/components/filters/filter-chip-utils.ts:64: /**
015253| NOTE: Block comment line describing behavior or context.
015254| src/components/filters/filter-chip-utils.ts:65:  * Format a price value for display
015255| NOTE: Block comment line describing behavior or context.
015256| src/components/filters/filter-chip-utils.ts:66:  */
015257| NOTE: Block comment line describing behavior or context.
015258| src/components/filters/filter-chip-utils.ts:67: function formatPrice(value: string): string {
015259| NOTE: Defines a helper or component function.
015260| src/components/filters/filter-chip-utils.ts:68:   const num = parseInt(value, 10);
015261| NOTE: Local declaration used by search logic or UI.
015262| src/components/filters/filter-chip-utils.ts:69:   if (isNaN(num)) return value;
015263| NOTE: Conditional logic controlling rendering or flow.
015264| src/components/filters/filter-chip-utils.ts:70:   return `$${num.toLocaleString()}`;
015265| NOTE: Return statement for component or helper output.
015266| src/components/filters/filter-chip-utils.ts:71: }
015267| NOTE: Implementation detail supporting search page behavior.
015268| src/components/filters/filter-chip-utils.ts:72: 
015269| NOTE: Blank line for visual separation.
015270| src/components/filters/filter-chip-utils.ts:73: /**
015271| NOTE: Block comment line describing behavior or context.
015272| src/components/filters/filter-chip-utils.ts:74:  * Format a date string (YYYY-MM-DD) for display
015273| NOTE: Block comment line describing behavior or context.
015274| src/components/filters/filter-chip-utils.ts:75:  */
015275| NOTE: Block comment line describing behavior or context.
015276| src/components/filters/filter-chip-utils.ts:76: function formatDate(dateStr: string): string {
015277| NOTE: Defines a helper or component function.
015278| src/components/filters/filter-chip-utils.ts:77:   const date = new Date(dateStr + "T00:00:00");
015279| NOTE: Local declaration used by search logic or UI.
015280| src/components/filters/filter-chip-utils.ts:78:   if (isNaN(date.getTime())) return dateStr;
015281| NOTE: Conditional logic controlling rendering or flow.
015282| src/components/filters/filter-chip-utils.ts:79:   return date.toLocaleDateString("en-US", {
015283| NOTE: Return statement for component or helper output.
015284| src/components/filters/filter-chip-utils.ts:80:     month: "short",
015285| NOTE: Implementation detail supporting search page behavior.
015286| src/components/filters/filter-chip-utils.ts:81:     day: "numeric",
015287| NOTE: Implementation detail supporting search page behavior.
015288| src/components/filters/filter-chip-utils.ts:82:     year: "numeric",
015289| NOTE: Implementation detail supporting search page behavior.
015290| src/components/filters/filter-chip-utils.ts:83:   });
015291| NOTE: Implementation detail supporting search page behavior.
015292| src/components/filters/filter-chip-utils.ts:84: }
015293| NOTE: Implementation detail supporting search page behavior.
015294| src/components/filters/filter-chip-utils.ts:85: 
015295| NOTE: Blank line for visual separation.
015296| src/components/filters/filter-chip-utils.ts:86: /**
015297| NOTE: Block comment line describing behavior or context.
015298| src/components/filters/filter-chip-utils.ts:87:  * Convert URLSearchParams to an array of filter chips
015299| NOTE: Block comment line describing behavior or context.
015300| src/components/filters/filter-chip-utils.ts:88:  */
015301| NOTE: Block comment line describing behavior or context.
015302| src/components/filters/filter-chip-utils.ts:89: export function urlToFilterChips(
015303| NOTE: Exports helper or component function.
015304| src/components/filters/filter-chip-utils.ts:90:   searchParams: URLSearchParams,
015305| NOTE: Implementation detail supporting search page behavior.
015306| src/components/filters/filter-chip-utils.ts:91: ): FilterChipData[] {
015307| NOTE: Implementation detail supporting search page behavior.
015308| src/components/filters/filter-chip-utils.ts:92:   const chips: FilterChipData[] = [];
015309| NOTE: Local declaration used by search logic or UI.
015310| src/components/filters/filter-chip-utils.ts:93: 
015311| NOTE: Blank line for visual separation.
015312| src/components/filters/filter-chip-utils.ts:94:   // Price range handling - combine min and max into one chip if both present
015313| NOTE: Line comment documents intent or constraints.
015314| src/components/filters/filter-chip-utils.ts:95:   // getPriceParam handles budget aliases (minBudget/maxBudget) with canonical precedence
015315| NOTE: Line comment documents intent or constraints.
015316| src/components/filters/filter-chip-utils.ts:96:   const minPrice = getPriceParam(searchParams, "min");
015317| NOTE: Local declaration used by search logic or UI.
015318| src/components/filters/filter-chip-utils.ts:97:   const maxPrice = getPriceParam(searchParams, "max");
015319| NOTE: Local declaration used by search logic or UI.
015320| src/components/filters/filter-chip-utils.ts:98: 
015321| NOTE: Blank line for visual separation.
015322| src/components/filters/filter-chip-utils.ts:99:   if (minPrice && maxPrice) {
015323| NOTE: Conditional logic controlling rendering or flow.
015324| src/components/filters/filter-chip-utils.ts:100:     chips.push({
015325| NOTE: Implementation detail supporting search page behavior.
015326| src/components/filters/filter-chip-utils.ts:101:       id: "price-range",
015327| NOTE: Implementation detail supporting search page behavior.
015328| src/components/filters/filter-chip-utils.ts:102:       label: `${formatPrice(minPrice)} - ${formatPrice(maxPrice)}`,
015329| NOTE: Implementation detail supporting search page behavior.
015330| src/components/filters/filter-chip-utils.ts:103:       paramKey: "price-range", // Special key for combined price
015331| NOTE: Implementation detail supporting search page behavior.
015332| src/components/filters/filter-chip-utils.ts:104:     });
015333| NOTE: Implementation detail supporting search page behavior.
015334| src/components/filters/filter-chip-utils.ts:105:   } else if (minPrice) {
015335| NOTE: Implementation detail supporting search page behavior.
015336| src/components/filters/filter-chip-utils.ts:106:     chips.push({
015337| NOTE: Implementation detail supporting search page behavior.
015338| src/components/filters/filter-chip-utils.ts:107:       id: "minPrice",
015339| NOTE: Implementation detail supporting search page behavior.
015340| src/components/filters/filter-chip-utils.ts:108:       label: `Min ${formatPrice(minPrice)}`,
015341| NOTE: Implementation detail supporting search page behavior.
015342| src/components/filters/filter-chip-utils.ts:109:       paramKey: "minPrice",
015343| NOTE: Implementation detail supporting search page behavior.
015344| src/components/filters/filter-chip-utils.ts:110:     });
015345| NOTE: Implementation detail supporting search page behavior.
015346| src/components/filters/filter-chip-utils.ts:111:   } else if (maxPrice) {
015347| NOTE: Implementation detail supporting search page behavior.
015348| src/components/filters/filter-chip-utils.ts:112:     chips.push({
015349| NOTE: Implementation detail supporting search page behavior.
015350| src/components/filters/filter-chip-utils.ts:113:       id: "maxPrice",
015351| NOTE: Implementation detail supporting search page behavior.
015352| src/components/filters/filter-chip-utils.ts:114:       label: `Max ${formatPrice(maxPrice)}`,
015353| NOTE: Implementation detail supporting search page behavior.
015354| src/components/filters/filter-chip-utils.ts:115:       paramKey: "maxPrice",
015355| NOTE: Implementation detail supporting search page behavior.
015356| src/components/filters/filter-chip-utils.ts:116:     });
015357| NOTE: Implementation detail supporting search page behavior.
015358| src/components/filters/filter-chip-utils.ts:117:   }
015359| NOTE: Implementation detail supporting search page behavior.
015360| src/components/filters/filter-chip-utils.ts:118: 
015361| NOTE: Blank line for visual separation.
015362| src/components/filters/filter-chip-utils.ts:119:   // Move-in date
015363| NOTE: Line comment documents intent or constraints.
015364| src/components/filters/filter-chip-utils.ts:120:   const moveInDate = searchParams.get("moveInDate");
015365| NOTE: Local declaration used by search logic or UI.
015366| src/components/filters/filter-chip-utils.ts:121:   if (moveInDate) {
015367| NOTE: Conditional logic controlling rendering or flow.
015368| src/components/filters/filter-chip-utils.ts:122:     chips.push({
015369| NOTE: Implementation detail supporting search page behavior.
015370| src/components/filters/filter-chip-utils.ts:123:       id: "moveInDate",
015371| NOTE: Implementation detail supporting search page behavior.
015372| src/components/filters/filter-chip-utils.ts:124:       label: `Move-in: ${formatDate(moveInDate)}`,
015373| NOTE: Implementation detail supporting search page behavior.
015374| src/components/filters/filter-chip-utils.ts:125:       paramKey: "moveInDate",
015375| NOTE: Implementation detail supporting search page behavior.
015376| src/components/filters/filter-chip-utils.ts:126:     });
015377| NOTE: Implementation detail supporting search page behavior.
015378| src/components/filters/filter-chip-utils.ts:127:   }
015379| NOTE: Implementation detail supporting search page behavior.
015380| src/components/filters/filter-chip-utils.ts:128: 
015381| NOTE: Blank line for visual separation.
015382| src/components/filters/filter-chip-utils.ts:129:   // Room type
015383| NOTE: Line comment documents intent or constraints.
015384| src/components/filters/filter-chip-utils.ts:130:   const roomType = searchParams.get("roomType");
015385| NOTE: Local declaration used by search logic or UI.
015386| src/components/filters/filter-chip-utils.ts:131:   if (roomType) {
015387| NOTE: Conditional logic controlling rendering or flow.
015388| src/components/filters/filter-chip-utils.ts:132:     chips.push({
015389| NOTE: Implementation detail supporting search page behavior.
015390| src/components/filters/filter-chip-utils.ts:133:       id: "roomType",
015391| NOTE: Implementation detail supporting search page behavior.
015392| src/components/filters/filter-chip-utils.ts:134:       label: roomType,
015393| NOTE: Implementation detail supporting search page behavior.
015394| src/components/filters/filter-chip-utils.ts:135:       paramKey: "roomType",
015395| NOTE: Implementation detail supporting search page behavior.
015396| src/components/filters/filter-chip-utils.ts:136:     });
015397| NOTE: Implementation detail supporting search page behavior.
015398| src/components/filters/filter-chip-utils.ts:137:   }
015399| NOTE: Implementation detail supporting search page behavior.
015400| src/components/filters/filter-chip-utils.ts:138: 
015401| NOTE: Blank line for visual separation.
015402| src/components/filters/filter-chip-utils.ts:139:   // Lease duration
015403| NOTE: Line comment documents intent or constraints.
015404| src/components/filters/filter-chip-utils.ts:140:   const leaseDuration = searchParams.get("leaseDuration");
015405| NOTE: Local declaration used by search logic or UI.
015406| src/components/filters/filter-chip-utils.ts:141:   if (leaseDuration) {
015407| NOTE: Conditional logic controlling rendering or flow.
015408| src/components/filters/filter-chip-utils.ts:142:     chips.push({
015409| NOTE: Implementation detail supporting search page behavior.
015410| src/components/filters/filter-chip-utils.ts:143:       id: "leaseDuration",
015411| NOTE: Implementation detail supporting search page behavior.
015412| src/components/filters/filter-chip-utils.ts:144:       label: leaseDuration,
015413| NOTE: Implementation detail supporting search page behavior.
015414| src/components/filters/filter-chip-utils.ts:145:       paramKey: "leaseDuration",
015415| NOTE: Implementation detail supporting search page behavior.
015416| src/components/filters/filter-chip-utils.ts:146:     });
015417| NOTE: Implementation detail supporting search page behavior.
015418| src/components/filters/filter-chip-utils.ts:147:   }
015419| NOTE: Implementation detail supporting search page behavior.
015420| src/components/filters/filter-chip-utils.ts:148: 
015421| NOTE: Blank line for visual separation.
015422| src/components/filters/filter-chip-utils.ts:149:   // Amenities - one chip per amenity
015423| NOTE: Line comment documents intent or constraints.
015424| src/components/filters/filter-chip-utils.ts:150:   const amenities = searchParams.get("amenities");
015425| NOTE: Local declaration used by search logic or UI.
015426| src/components/filters/filter-chip-utils.ts:151:   if (amenities) {
015427| NOTE: Conditional logic controlling rendering or flow.
015428| src/components/filters/filter-chip-utils.ts:152:     const amenityList = amenities.split(",").filter(Boolean);
015429| NOTE: Local declaration used by search logic or UI.
015430| src/components/filters/filter-chip-utils.ts:153:     for (const amenity of amenityList) {
015431| NOTE: Implementation detail supporting search page behavior.
015432| src/components/filters/filter-chip-utils.ts:154:       chips.push({
015433| NOTE: Implementation detail supporting search page behavior.
015434| src/components/filters/filter-chip-utils.ts:155:         id: `amenities:${amenity}`,
015435| NOTE: Implementation detail supporting search page behavior.
015436| src/components/filters/filter-chip-utils.ts:156:         label: amenity,
015437| NOTE: Implementation detail supporting search page behavior.
015438| src/components/filters/filter-chip-utils.ts:157:         paramKey: "amenities",
015439| NOTE: Implementation detail supporting search page behavior.
015440| src/components/filters/filter-chip-utils.ts:158:         paramValue: amenity,
015441| NOTE: Implementation detail supporting search page behavior.
015442| src/components/filters/filter-chip-utils.ts:159:       });
015443| NOTE: Implementation detail supporting search page behavior.
015444| src/components/filters/filter-chip-utils.ts:160:     }
015445| NOTE: Implementation detail supporting search page behavior.
015446| src/components/filters/filter-chip-utils.ts:161:   }
015447| NOTE: Implementation detail supporting search page behavior.
015448| src/components/filters/filter-chip-utils.ts:162: 
015449| NOTE: Blank line for visual separation.
015450| src/components/filters/filter-chip-utils.ts:163:   // House rules - one chip per rule
015451| NOTE: Line comment documents intent or constraints.
015452| src/components/filters/filter-chip-utils.ts:164:   const houseRules = searchParams.get("houseRules");
015453| NOTE: Local declaration used by search logic or UI.
015454| src/components/filters/filter-chip-utils.ts:165:   if (houseRules) {
015455| NOTE: Conditional logic controlling rendering or flow.
015456| src/components/filters/filter-chip-utils.ts:166:     const ruleList = houseRules.split(",").filter(Boolean);
015457| NOTE: Local declaration used by search logic or UI.
015458| src/components/filters/filter-chip-utils.ts:167:     for (const rule of ruleList) {
015459| NOTE: Implementation detail supporting search page behavior.
015460| src/components/filters/filter-chip-utils.ts:168:       chips.push({
015461| NOTE: Implementation detail supporting search page behavior.
015462| src/components/filters/filter-chip-utils.ts:169:         id: `houseRules:${rule}`,
015463| NOTE: Implementation detail supporting search page behavior.
015464| src/components/filters/filter-chip-utils.ts:170:         label: rule,
015465| NOTE: Implementation detail supporting search page behavior.
015466| src/components/filters/filter-chip-utils.ts:171:         paramKey: "houseRules",
015467| NOTE: Implementation detail supporting search page behavior.
015468| src/components/filters/filter-chip-utils.ts:172:         paramValue: rule,
015469| NOTE: Implementation detail supporting search page behavior.
015470| src/components/filters/filter-chip-utils.ts:173:       });
015471| NOTE: Implementation detail supporting search page behavior.
015472| src/components/filters/filter-chip-utils.ts:174:     }
015473| NOTE: Implementation detail supporting search page behavior.
015474| src/components/filters/filter-chip-utils.ts:175:   }
015475| NOTE: Implementation detail supporting search page behavior.
015476| src/components/filters/filter-chip-utils.ts:176: 
015477| NOTE: Blank line for visual separation.
015478| src/components/filters/filter-chip-utils.ts:177:   // Languages - one chip per language, convert code to display name
015479| NOTE: Line comment documents intent or constraints.
015480| src/components/filters/filter-chip-utils.ts:178:   const languages = searchParams.get("languages");
015481| NOTE: Local declaration used by search logic or UI.
015482| src/components/filters/filter-chip-utils.ts:179:   if (languages) {
015483| NOTE: Conditional logic controlling rendering or flow.
015484| src/components/filters/filter-chip-utils.ts:180:     const langList = languages.split(",").filter(Boolean);
015485| NOTE: Local declaration used by search logic or UI.
015486| src/components/filters/filter-chip-utils.ts:181:     for (const lang of langList) {
015487| NOTE: Implementation detail supporting search page behavior.
015488| src/components/filters/filter-chip-utils.ts:182:       chips.push({
015489| NOTE: Implementation detail supporting search page behavior.
015490| src/components/filters/filter-chip-utils.ts:183:         id: `languages:${lang}`,
015491| NOTE: Implementation detail supporting search page behavior.
015492| src/components/filters/filter-chip-utils.ts:184:         label: getLanguageName(lang),
015493| NOTE: Implementation detail supporting search page behavior.
015494| src/components/filters/filter-chip-utils.ts:185:         paramKey: "languages",
015495| NOTE: Implementation detail supporting search page behavior.
015496| src/components/filters/filter-chip-utils.ts:186:         paramValue: lang,
015497| NOTE: Implementation detail supporting search page behavior.
015498| src/components/filters/filter-chip-utils.ts:187:       });
015499| NOTE: Implementation detail supporting search page behavior.
015500| src/components/filters/filter-chip-utils.ts:188:     }
015501| NOTE: Implementation detail supporting search page behavior.
015502| src/components/filters/filter-chip-utils.ts:189:   }
015503| NOTE: Implementation detail supporting search page behavior.
015504| src/components/filters/filter-chip-utils.ts:190: 
015505| NOTE: Blank line for visual separation.
015506| src/components/filters/filter-chip-utils.ts:191:   // Near matches toggle
015507| NOTE: Line comment documents intent or constraints.
015508| src/components/filters/filter-chip-utils.ts:192:   const nearMatches = searchParams.get("nearMatches");
015509| NOTE: Local declaration used by search logic or UI.
015510| src/components/filters/filter-chip-utils.ts:193:   if (nearMatches === "1") {
015511| NOTE: Conditional logic controlling rendering or flow.
015512| src/components/filters/filter-chip-utils.ts:194:     chips.push({
015513| NOTE: Implementation detail supporting search page behavior.
015514| src/components/filters/filter-chip-utils.ts:195:       id: "nearMatches",
015515| NOTE: Implementation detail supporting search page behavior.
015516| src/components/filters/filter-chip-utils.ts:196:       label: "Near matches",
015517| NOTE: Implementation detail supporting search page behavior.
015518| src/components/filters/filter-chip-utils.ts:197:       paramKey: "nearMatches",
015519| NOTE: Implementation detail supporting search page behavior.
015520| src/components/filters/filter-chip-utils.ts:198:     });
015521| NOTE: Implementation detail supporting search page behavior.
015522| src/components/filters/filter-chip-utils.ts:199:   }
015523| NOTE: Implementation detail supporting search page behavior.
015524| src/components/filters/filter-chip-utils.ts:200: 
015525| NOTE: Blank line for visual separation.
015526| src/components/filters/filter-chip-utils.ts:201:   return chips;
015527| NOTE: Return statement for component or helper output.
015528| src/components/filters/filter-chip-utils.ts:202: }
015529| NOTE: Implementation detail supporting search page behavior.
015530| src/components/filters/filter-chip-utils.ts:203: 
015531| NOTE: Blank line for visual separation.
015532| src/components/filters/filter-chip-utils.ts:204: /**
015533| NOTE: Block comment line describing behavior or context.
015534| src/components/filters/filter-chip-utils.ts:205:  * Remove a filter from the URL, returning the new query string
015535| NOTE: Block comment line describing behavior or context.
015536| src/components/filters/filter-chip-utils.ts:206:  */
015537| NOTE: Block comment line describing behavior or context.
015538| src/components/filters/filter-chip-utils.ts:207: export function removeFilterFromUrl(
015539| NOTE: Exports helper or component function.
015540| src/components/filters/filter-chip-utils.ts:208:   searchParams: URLSearchParams,
015541| NOTE: Implementation detail supporting search page behavior.
015542| src/components/filters/filter-chip-utils.ts:209:   chip: FilterChipData,
015543| NOTE: Implementation detail supporting search page behavior.
015544| src/components/filters/filter-chip-utils.ts:210: ): string {
015545| NOTE: Implementation detail supporting search page behavior.
015546| src/components/filters/filter-chip-utils.ts:211:   const newParams = new URLSearchParams(searchParams);
015547| NOTE: Local declaration used by search logic or UI.
015548| src/components/filters/filter-chip-utils.ts:212: 
015549| NOTE: Blank line for visual separation.
015550| src/components/filters/filter-chip-utils.ts:213:   // Handle combined price range (includes budget aliases)
015551| NOTE: Line comment documents intent or constraints.
015552| src/components/filters/filter-chip-utils.ts:214:   if (chip.paramKey === "price-range") {
015553| NOTE: Conditional logic controlling rendering or flow.
015554| src/components/filters/filter-chip-utils.ts:215:     newParams.delete("minPrice");
015555| NOTE: Implementation detail supporting search page behavior.
015556| src/components/filters/filter-chip-utils.ts:216:     newParams.delete("maxPrice");
015557| NOTE: Implementation detail supporting search page behavior.
015558| src/components/filters/filter-chip-utils.ts:217:     newParams.delete("minBudget");
015559| NOTE: Implementation detail supporting search page behavior.
015560| src/components/filters/filter-chip-utils.ts:218:     newParams.delete("maxBudget");
015561| NOTE: Implementation detail supporting search page behavior.
015562| src/components/filters/filter-chip-utils.ts:219:   }
015563| NOTE: Implementation detail supporting search page behavior.
015564| src/components/filters/filter-chip-utils.ts:220:   // Handle array params (amenities, houseRules, languages)
015565| NOTE: Line comment documents intent or constraints.
015566| src/components/filters/filter-chip-utils.ts:221:   else if (chip.paramValue) {
015567| NOTE: Implementation detail supporting search page behavior.
015568| src/components/filters/filter-chip-utils.ts:222:     const currentValue = newParams.get(chip.paramKey);
015569| NOTE: Local declaration used by search logic or UI.
015570| src/components/filters/filter-chip-utils.ts:223:     if (currentValue) {
015571| NOTE: Conditional logic controlling rendering or flow.
015572| src/components/filters/filter-chip-utils.ts:224:       const values = currentValue.split(",").filter(Boolean);
015573| NOTE: Local declaration used by search logic or UI.
015574| src/components/filters/filter-chip-utils.ts:225:       const newValues = values.filter((v) => v !== chip.paramValue);
015575| NOTE: Local declaration used by search logic or UI.
015576| src/components/filters/filter-chip-utils.ts:226:       if (newValues.length > 0) {
015577| NOTE: Conditional logic controlling rendering or flow.
015578| src/components/filters/filter-chip-utils.ts:227:         newParams.set(chip.paramKey, newValues.join(","));
015579| NOTE: Implementation detail supporting search page behavior.
015580| src/components/filters/filter-chip-utils.ts:228:       } else {
015581| NOTE: Implementation detail supporting search page behavior.
015582| src/components/filters/filter-chip-utils.ts:229:         newParams.delete(chip.paramKey);
015583| NOTE: Implementation detail supporting search page behavior.
015584| src/components/filters/filter-chip-utils.ts:230:       }
015585| NOTE: Implementation detail supporting search page behavior.
015586| src/components/filters/filter-chip-utils.ts:231:     }
015587| NOTE: Implementation detail supporting search page behavior.
015588| src/components/filters/filter-chip-utils.ts:232:   }
015589| NOTE: Implementation detail supporting search page behavior.
015590| src/components/filters/filter-chip-utils.ts:233:   // Handle simple params
015591| NOTE: Line comment documents intent or constraints.
015592| src/components/filters/filter-chip-utils.ts:234:   else {
015593| NOTE: Implementation detail supporting search page behavior.
015594| src/components/filters/filter-chip-utils.ts:235:     newParams.delete(chip.paramKey);
015595| NOTE: Implementation detail supporting search page behavior.
015596| src/components/filters/filter-chip-utils.ts:236:   }
015597| NOTE: Implementation detail supporting search page behavior.
015598| src/components/filters/filter-chip-utils.ts:237: 
015599| NOTE: Blank line for visual separation.
015600| src/components/filters/filter-chip-utils.ts:238:   // Reset to page 1 when filters change
015601| NOTE: Line comment documents intent or constraints.
015602| src/components/filters/filter-chip-utils.ts:239:   newParams.delete("page");
015603| NOTE: Implementation detail supporting search page behavior.
015604| src/components/filters/filter-chip-utils.ts:240: 
015605| NOTE: Blank line for visual separation.
015606| src/components/filters/filter-chip-utils.ts:241:   return newParams.toString();
015607| NOTE: Return statement for component or helper output.
015608| src/components/filters/filter-chip-utils.ts:242: }
015609| NOTE: Implementation detail supporting search page behavior.
015610| src/components/filters/filter-chip-utils.ts:243: 
015611| NOTE: Blank line for visual separation.
015612| src/components/filters/filter-chip-utils.ts:244: /**
015613| NOTE: Block comment line describing behavior or context.
015614| src/components/filters/filter-chip-utils.ts:245:  * Clear all filters, preserving location and sort params.
015615| NOTE: Block comment line describing behavior or context.
015616| src/components/filters/filter-chip-utils.ts:246:  * Returns the new query string.
015617| NOTE: Block comment line describing behavior or context.
015618| src/components/filters/filter-chip-utils.ts:247:  */
015619| NOTE: Block comment line describing behavior or context.
015620| src/components/filters/filter-chip-utils.ts:248: export function clearAllFilters(searchParams: URLSearchParams): string {
015621| NOTE: Exports helper or component function.
015622| src/components/filters/filter-chip-utils.ts:249:   const newParams = new URLSearchParams();
015623| NOTE: Local declaration used by search logic or UI.
015624| src/components/filters/filter-chip-utils.ts:250: 
015625| NOTE: Blank line for visual separation.
015626| src/components/filters/filter-chip-utils.ts:251:   // Preserve location and sort params
015627| NOTE: Line comment documents intent or constraints.
015628| src/components/filters/filter-chip-utils.ts:252:   for (const key of PRESERVED_PARAMS) {
015629| NOTE: Implementation detail supporting search page behavior.
015630| src/components/filters/filter-chip-utils.ts:253:     const value = searchParams.get(key);
015631| NOTE: Local declaration used by search logic or UI.
015632| src/components/filters/filter-chip-utils.ts:254:     if (value) {
015633| NOTE: Conditional logic controlling rendering or flow.
015634| src/components/filters/filter-chip-utils.ts:255:       newParams.set(key, value);
015635| NOTE: Implementation detail supporting search page behavior.
015636| src/components/filters/filter-chip-utils.ts:256:     }
015637| NOTE: Implementation detail supporting search page behavior.
015638| src/components/filters/filter-chip-utils.ts:257:   }
015639| NOTE: Implementation detail supporting search page behavior.
015640| src/components/filters/filter-chip-utils.ts:258: 
015641| NOTE: Blank line for visual separation.
015642| src/components/filters/filter-chip-utils.ts:259:   return newParams.toString();
015643| NOTE: Return statement for component or helper output.
015644| src/components/filters/filter-chip-utils.ts:260: }
015645| NOTE: Implementation detail supporting search page behavior.
015646| src/components/filters/filter-chip-utils.ts:261: 
015647| NOTE: Blank line for visual separation.
015648| src/components/filters/filter-chip-utils.ts:262: /**
015649| NOTE: Block comment line describing behavior or context.
015650| src/components/filters/filter-chip-utils.ts:263:  * Check if there are any filter chips to display
015651| NOTE: Block comment line describing behavior or context.
015652| src/components/filters/filter-chip-utils.ts:264:  */
015653| NOTE: Block comment line describing behavior or context.
015654| src/components/filters/filter-chip-utils.ts:265: export function hasFilterChips(searchParams: URLSearchParams): boolean {
015655| NOTE: Exports helper or component function.
015656| src/components/filters/filter-chip-utils.ts:266:   return urlToFilterChips(searchParams).length > 0;
015657| NOTE: Return statement for component or helper output.
015658| src/components/filters/filter-chip-utils.ts:267: }
015659| NOTE: Implementation detail supporting search page behavior.
015660| FILE END: src/components/filters/filter-chip-utils.ts
015661| 
015662| FILE START: src/components/listings/ListScrollBridge.tsx
015663| FILE ROLE: Auto-discovered dependency in search page graph.
015664| src/components/listings/ListScrollBridge.tsx:1: "use client";
015665| NOTE: Implementation detail supporting search page behavior.
015666| src/components/listings/ListScrollBridge.tsx:2: 
015667| NOTE: Blank line for visual separation.
015668| src/components/listings/ListScrollBridge.tsx:3: /**
015669| NOTE: Block comment line describing behavior or context.
015670| src/components/listings/ListScrollBridge.tsx:4:  * ListScrollBridge - Centralized scroll handler for list-map sync
015671| NOTE: Block comment line describing behavior or context.
015672| src/components/listings/ListScrollBridge.tsx:5:  *
015673| NOTE: Block comment line describing behavior or context.
015674| src/components/listings/ListScrollBridge.tsx:6:  * SINGLE OWNER of scroll-to-card behavior. When a map marker is clicked,
015675| NOTE: Block comment line describing behavior or context.
015676| src/components/listings/ListScrollBridge.tsx:7:  * the scrollRequest is consumed here, not in individual ListingCard components.
015677| NOTE: Block comment line describing behavior or context.
015678| src/components/listings/ListScrollBridge.tsx:8:  *
015679| NOTE: Block comment line describing behavior or context.
015680| src/components/listings/ListScrollBridge.tsx:9:  * Key behaviors:
015681| NOTE: Block comment line describing behavior or context.
015682| src/components/listings/ListScrollBridge.tsx:10:  * 1. Listens to scrollRequest from ListingFocusContext
015683| NOTE: Block comment line describing behavior or context.
015684| src/components/listings/ListScrollBridge.tsx:11:  * 2. Finds the target card via data-testid (fallback to data-listing-id)
015685| NOTE: Block comment line describing behavior or context.
015686| src/components/listings/ListScrollBridge.tsx:12:  * 3. Scrolls to it using smooth scrollIntoView
015687| NOTE: Block comment line describing behavior or context.
015688| src/components/listings/ListScrollBridge.tsx:13:  * 4. Only acks AFTER scroll is triggered
015689| NOTE: Block comment line describing behavior or context.
015690| src/components/listings/ListScrollBridge.tsx:14:  * 5. If element not found, does NOT ack (allows retry on next render)
015691| NOTE: Block comment line describing behavior or context.
015692| src/components/listings/ListScrollBridge.tsx:15:  */
015693| NOTE: Block comment line describing behavior or context.
015694| src/components/listings/ListScrollBridge.tsx:16: 
015695| NOTE: Blank line for visual separation.
015696| src/components/listings/ListScrollBridge.tsx:17: import { useEffect, useRef } from "react";
015697| NOTE: Imports dependency for this module.
015698| src/components/listings/ListScrollBridge.tsx:18: import { useListingFocus } from "@/contexts/ListingFocusContext";
015699| NOTE: Imports dependency for this module.
015700| src/components/listings/ListScrollBridge.tsx:19: 
015701| NOTE: Blank line for visual separation.
015702| src/components/listings/ListScrollBridge.tsx:20: export default function ListScrollBridge() {
015703| NOTE: Exports main component for this module.
015704| src/components/listings/ListScrollBridge.tsx:21:   const { scrollRequest, ackScrollTo } = useListingFocus();
015705| NOTE: Local declaration used by search logic or UI.
015706| src/components/listings/ListScrollBridge.tsx:22:   const lastProcessedNonce = useRef<number | null>(null);
015707| NOTE: Uses ref for stable mutable storage between renders.
015708| src/components/listings/ListScrollBridge.tsx:23: 
015709| NOTE: Blank line for visual separation.
015710| src/components/listings/ListScrollBridge.tsx:24:   useEffect(() => {
015711| NOTE: Defines side effect for syncing with external state.
015712| src/components/listings/ListScrollBridge.tsx:25:     // Guard: No scroll request or already processed this nonce
015713| NOTE: Line comment documents intent or constraints.
015714| src/components/listings/ListScrollBridge.tsx:26:     if (!scrollRequest) return;
015715| NOTE: Conditional logic controlling rendering or flow.
015716| src/components/listings/ListScrollBridge.tsx:27:     if (scrollRequest.nonce === lastProcessedNonce.current) return;
015717| NOTE: Conditional logic controlling rendering or flow.
015718| src/components/listings/ListScrollBridge.tsx:28: 
015719| NOTE: Blank line for visual separation.
015720| src/components/listings/ListScrollBridge.tsx:29:     const { id, nonce } = scrollRequest;
015721| NOTE: Local declaration used by search logic or UI.
015722| src/components/listings/ListScrollBridge.tsx:30: 
015723| NOTE: Blank line for visual separation.
015724| src/components/listings/ListScrollBridge.tsx:31:     // Escape ID for safe use in CSS selectors (handles special characters)
015725| NOTE: Line comment documents intent or constraints.
015726| src/components/listings/ListScrollBridge.tsx:32:     const safeId =
015727| NOTE: Local declaration used by search logic or UI.
015728| src/components/listings/ListScrollBridge.tsx:33:       typeof CSS !== "undefined" && CSS.escape ? CSS.escape(id) : id;
015729| NOTE: Implementation detail supporting search page behavior.
015730| src/components/listings/ListScrollBridge.tsx:34: 
015731| NOTE: Blank line for visual separation.
015732| src/components/listings/ListScrollBridge.tsx:35:     // Find target card using data-testid (preferred) with fallback to data-listing-id
015733| NOTE: Line comment documents intent or constraints.
015734| src/components/listings/ListScrollBridge.tsx:36:     const targetCard =
015735| NOTE: Local declaration used by search logic or UI.
015736| src/components/listings/ListScrollBridge.tsx:37:       document.querySelector(`[data-testid="listing-card-${safeId}"]`) ??
015737| NOTE: Implementation detail supporting search page behavior.
015738| src/components/listings/ListScrollBridge.tsx:38:       document.querySelector(`[data-listing-id="${safeId}"]`);
015739| NOTE: Implementation detail supporting search page behavior.
015740| src/components/listings/ListScrollBridge.tsx:39: 
015741| NOTE: Blank line for visual separation.
015742| src/components/listings/ListScrollBridge.tsx:40:     // If element not found, do NOT ack - allow retry on next render
015743| NOTE: Line comment documents intent or constraints.
015744| src/components/listings/ListScrollBridge.tsx:41:     // (card may not be rendered yet due to virtualization or lazy loading)
015745| NOTE: Line comment documents intent or constraints.
015746| src/components/listings/ListScrollBridge.tsx:42:     if (!targetCard) {
015747| NOTE: Conditional logic controlling rendering or flow.
015748| src/components/listings/ListScrollBridge.tsx:43:       return;
015749| NOTE: Implementation detail supporting search page behavior.
015750| src/components/listings/ListScrollBridge.tsx:44:     }
015751| NOTE: Implementation detail supporting search page behavior.
015752| src/components/listings/ListScrollBridge.tsx:45: 
015753| NOTE: Blank line for visual separation.
015754| src/components/listings/ListScrollBridge.tsx:46:     // Element found - perform scroll
015755| NOTE: Line comment documents intent or constraints.
015756| src/components/listings/ListScrollBridge.tsx:47:     targetCard.scrollIntoView({
015757| NOTE: Implementation detail supporting search page behavior.
015758| src/components/listings/ListScrollBridge.tsx:48:       behavior: "smooth",
015759| NOTE: Implementation detail supporting search page behavior.
015760| src/components/listings/ListScrollBridge.tsx:49:       block: "nearest",
015761| NOTE: Implementation detail supporting search page behavior.
015762| src/components/listings/ListScrollBridge.tsx:50:     });
015763| NOTE: Implementation detail supporting search page behavior.
015764| src/components/listings/ListScrollBridge.tsx:51: 
015765| NOTE: Blank line for visual separation.
015766| src/components/listings/ListScrollBridge.tsx:52:     // Track nonce AFTER successful scroll to prevent double-processing
015767| NOTE: Line comment documents intent or constraints.
015768| src/components/listings/ListScrollBridge.tsx:53:     // This ensures "not mounted yet" cases can retry on next render
015769| NOTE: Line comment documents intent or constraints.
015770| src/components/listings/ListScrollBridge.tsx:54:     lastProcessedNonce.current = nonce;
015771| NOTE: Implementation detail supporting search page behavior.
015772| src/components/listings/ListScrollBridge.tsx:55: 
015773| NOTE: Blank line for visual separation.
015774| src/components/listings/ListScrollBridge.tsx:56:     // Acknowledge AFTER scroll triggers - clears scrollRequest in context
015775| NOTE: Line comment documents intent or constraints.
015776| src/components/listings/ListScrollBridge.tsx:57:     ackScrollTo(nonce);
015777| NOTE: Implementation detail supporting search page behavior.
015778| src/components/listings/ListScrollBridge.tsx:58:   }, [scrollRequest, ackScrollTo]);
015779| NOTE: Implementation detail supporting search page behavior.
015780| src/components/listings/ListScrollBridge.tsx:59: 
015781| NOTE: Blank line for visual separation.
015782| src/components/listings/ListScrollBridge.tsx:60:   // This component renders nothing - it's purely a side-effect bridge
015783| NOTE: Line comment documents intent or constraints.
015784| src/components/listings/ListScrollBridge.tsx:61:   return null;
015785| NOTE: Return statement for component or helper output.
015786| src/components/listings/ListScrollBridge.tsx:62: }
015787| NOTE: Implementation detail supporting search page behavior.
015788| FILE END: src/components/listings/ListScrollBridge.tsx
015789| 
015790| FILE START: src/components/listings/ListingCard.tsx
015791| FILE ROLE: Auto-discovered dependency in search page graph.
015792| src/components/listings/ListingCard.tsx:1: "use client";
015793| NOTE: Implementation detail supporting search page behavior.
015794| src/components/listings/ListingCard.tsx:2: 
015795| NOTE: Blank line for visual separation.
015796| src/components/listings/ListingCard.tsx:3: import { useState, useCallback } from "react";
015797| NOTE: Imports dependency for this module.
015798| src/components/listings/ListingCard.tsx:4: import Link from "next/link";
015799| NOTE: Imports dependency for this module.
015800| src/components/listings/ListingCard.tsx:5: import Image from "next/image";
015801| NOTE: Imports dependency for this module.
015802| src/components/listings/ListingCard.tsx:6: import { Star, Home, Globe, MapPin } from "lucide-react";
015803| NOTE: Imports dependency for this module.
015804| src/components/listings/ListingCard.tsx:7: import FavoriteButton from "../FavoriteButton";
015805| NOTE: Imports dependency for this module.
015806| src/components/listings/ListingCard.tsx:8: import ListingCardCarousel from "./ListingCardCarousel";
015807| NOTE: Imports dependency for this module.
015808| src/components/listings/ListingCard.tsx:9: import { cn } from "@/lib/utils";
015809| NOTE: Imports dependency for this module.
015810| src/components/listings/ListingCard.tsx:10: import { getLanguageName } from "@/lib/languages";
015811| NOTE: Imports dependency for this module.
015812| src/components/listings/ListingCard.tsx:11: import {
015813| NOTE: Imports dependency for this module.
015814| src/components/listings/ListingCard.tsx:12:   useListingFocus,
015815| NOTE: Implementation detail supporting search page behavior.
015816| src/components/listings/ListingCard.tsx:13:   useIsListingFocused,
015817| NOTE: Implementation detail supporting search page behavior.
015818| src/components/listings/ListingCard.tsx:14: } from "@/contexts/ListingFocusContext";
015819| NOTE: Implementation detail supporting search page behavior.
015820| src/components/listings/ListingCard.tsx:15: import { useSearchMapUI } from "@/contexts/SearchMapUIContext";
015821| NOTE: Imports dependency for this module.
015822| src/components/listings/ListingCard.tsx:16: 
015823| NOTE: Blank line for visual separation.
015824| src/components/listings/ListingCard.tsx:17: export interface Listing {
015825| NOTE: Implementation detail supporting search page behavior.
015826| src/components/listings/ListingCard.tsx:18:   id: string;
015827| NOTE: Implementation detail supporting search page behavior.
015828| src/components/listings/ListingCard.tsx:19:   title: string;
015829| NOTE: Implementation detail supporting search page behavior.
015830| src/components/listings/ListingCard.tsx:20:   price: number;
015831| NOTE: Implementation detail supporting search page behavior.
015832| src/components/listings/ListingCard.tsx:21:   description: string;
015833| NOTE: Implementation detail supporting search page behavior.
015834| src/components/listings/ListingCard.tsx:22:   location: {
015835| NOTE: Implementation detail supporting search page behavior.
015836| src/components/listings/ListingCard.tsx:23:     city: string;
015837| NOTE: Implementation detail supporting search page behavior.
015838| src/components/listings/ListingCard.tsx:24:     state: string;
015839| NOTE: Implementation detail supporting search page behavior.
015840| src/components/listings/ListingCard.tsx:25:   };
015841| NOTE: Implementation detail supporting search page behavior.
015842| src/components/listings/ListingCard.tsx:26:   amenities: string[];
015843| NOTE: Implementation detail supporting search page behavior.
015844| src/components/listings/ListingCard.tsx:27:   householdLanguages?: string[];
015845| NOTE: Implementation detail supporting search page behavior.
015846| src/components/listings/ListingCard.tsx:28:   availableSlots: number;
015847| NOTE: Implementation detail supporting search page behavior.
015848| src/components/listings/ListingCard.tsx:29:   images?: string[];
015849| NOTE: Implementation detail supporting search page behavior.
015850| src/components/listings/ListingCard.tsx:30:   avgRating?: number;
015851| NOTE: Implementation detail supporting search page behavior.
015852| src/components/listings/ListingCard.tsx:31:   reviewCount?: number;
015853| NOTE: Implementation detail supporting search page behavior.
015854| src/components/listings/ListingCard.tsx:32:   /** True if this listing is a near-match (slightly outside filter criteria) */
015855| NOTE: Block comment line describing behavior or context.
015856| src/components/listings/ListingCard.tsx:33:   isNearMatch?: boolean;
015857| NOTE: Implementation detail supporting search page behavior.
015858| src/components/listings/ListingCard.tsx:34: }
015859| NOTE: Implementation detail supporting search page behavior.
015860| src/components/listings/ListingCard.tsx:35: 
015861| NOTE: Blank line for visual separation.
015862| src/components/listings/ListingCard.tsx:36: // State abbreviation map
015863| NOTE: Line comment documents intent or constraints.
015864| src/components/listings/ListingCard.tsx:37: const STATE_ABBREVIATIONS: Record<string, string> = {
015865| NOTE: Local declaration used by search logic or UI.
015866| src/components/listings/ListingCard.tsx:38:   Alabama: "AL",
015867| NOTE: Implementation detail supporting search page behavior.
015868| src/components/listings/ListingCard.tsx:39:   Alaska: "AK",
015869| NOTE: Implementation detail supporting search page behavior.
015870| src/components/listings/ListingCard.tsx:40:   Arizona: "AZ",
015871| NOTE: Implementation detail supporting search page behavior.
015872| src/components/listings/ListingCard.tsx:41:   Arkansas: "AR",
015873| NOTE: Implementation detail supporting search page behavior.
015874| src/components/listings/ListingCard.tsx:42:   California: "CA",
015875| NOTE: Implementation detail supporting search page behavior.
015876| src/components/listings/ListingCard.tsx:43:   Colorado: "CO",
015877| NOTE: Implementation detail supporting search page behavior.
015878| src/components/listings/ListingCard.tsx:44:   Connecticut: "CT",
015879| NOTE: Implementation detail supporting search page behavior.
015880| src/components/listings/ListingCard.tsx:45:   Delaware: "DE",
015881| NOTE: Implementation detail supporting search page behavior.
015882| src/components/listings/ListingCard.tsx:46:   Florida: "FL",
015883| NOTE: Implementation detail supporting search page behavior.
015884| src/components/listings/ListingCard.tsx:47:   Georgia: "GA",
015885| NOTE: Implementation detail supporting search page behavior.
015886| src/components/listings/ListingCard.tsx:48:   Hawaii: "HI",
015887| NOTE: Implementation detail supporting search page behavior.
015888| src/components/listings/ListingCard.tsx:49:   Idaho: "ID",
015889| NOTE: Implementation detail supporting search page behavior.
015890| src/components/listings/ListingCard.tsx:50:   Illinois: "IL",
015891| NOTE: Implementation detail supporting search page behavior.
015892| src/components/listings/ListingCard.tsx:51:   Indiana: "IN",
015893| NOTE: Implementation detail supporting search page behavior.
015894| src/components/listings/ListingCard.tsx:52:   Iowa: "IA",
015895| NOTE: Implementation detail supporting search page behavior.
015896| src/components/listings/ListingCard.tsx:53:   Kansas: "KS",
015897| NOTE: Implementation detail supporting search page behavior.
015898| src/components/listings/ListingCard.tsx:54:   Kentucky: "KY",
015899| NOTE: Implementation detail supporting search page behavior.
015900| src/components/listings/ListingCard.tsx:55:   Louisiana: "LA",
015901| NOTE: Implementation detail supporting search page behavior.
015902| src/components/listings/ListingCard.tsx:56:   Maine: "ME",
015903| NOTE: Implementation detail supporting search page behavior.
015904| src/components/listings/ListingCard.tsx:57:   Maryland: "MD",
015905| NOTE: Implementation detail supporting search page behavior.
015906| src/components/listings/ListingCard.tsx:58:   Massachusetts: "MA",
015907| NOTE: Implementation detail supporting search page behavior.
015908| src/components/listings/ListingCard.tsx:59:   Michigan: "MI",
015909| NOTE: Implementation detail supporting search page behavior.
015910| src/components/listings/ListingCard.tsx:60:   Minnesota: "MN",
015911| NOTE: Implementation detail supporting search page behavior.
015912| src/components/listings/ListingCard.tsx:61:   Mississippi: "MS",
015913| NOTE: Implementation detail supporting search page behavior.
015914| src/components/listings/ListingCard.tsx:62:   Missouri: "MO",
015915| NOTE: Implementation detail supporting search page behavior.
015916| src/components/listings/ListingCard.tsx:63:   Montana: "MT",
015917| NOTE: Implementation detail supporting search page behavior.
015918| src/components/listings/ListingCard.tsx:64:   Nebraska: "NE",
015919| NOTE: Implementation detail supporting search page behavior.
015920| src/components/listings/ListingCard.tsx:65:   Nevada: "NV",
015921| NOTE: Implementation detail supporting search page behavior.
015922| src/components/listings/ListingCard.tsx:66:   "New Hampshire": "NH",
015923| NOTE: Implementation detail supporting search page behavior.
015924| src/components/listings/ListingCard.tsx:67:   "New Jersey": "NJ",
015925| NOTE: Implementation detail supporting search page behavior.
015926| src/components/listings/ListingCard.tsx:68:   "New Mexico": "NM",
015927| NOTE: Implementation detail supporting search page behavior.
015928| src/components/listings/ListingCard.tsx:69:   "New York": "NY",
015929| NOTE: Implementation detail supporting search page behavior.
015930| src/components/listings/ListingCard.tsx:70:   "North Carolina": "NC",
015931| NOTE: Implementation detail supporting search page behavior.
015932| src/components/listings/ListingCard.tsx:71:   "North Dakota": "ND",
015933| NOTE: Implementation detail supporting search page behavior.
015934| src/components/listings/ListingCard.tsx:72:   Ohio: "OH",
015935| NOTE: Implementation detail supporting search page behavior.
015936| src/components/listings/ListingCard.tsx:73:   Oklahoma: "OK",
015937| NOTE: Implementation detail supporting search page behavior.
015938| src/components/listings/ListingCard.tsx:74:   Oregon: "OR",
015939| NOTE: Implementation detail supporting search page behavior.
015940| src/components/listings/ListingCard.tsx:75:   Pennsylvania: "PA",
015941| NOTE: Implementation detail supporting search page behavior.
015942| src/components/listings/ListingCard.tsx:76:   "Rhode Island": "RI",
015943| NOTE: Implementation detail supporting search page behavior.
015944| src/components/listings/ListingCard.tsx:77:   "South Carolina": "SC",
015945| NOTE: Implementation detail supporting search page behavior.
015946| src/components/listings/ListingCard.tsx:78:   "South Dakota": "SD",
015947| NOTE: Implementation detail supporting search page behavior.
015948| src/components/listings/ListingCard.tsx:79:   Tennessee: "TN",
015949| NOTE: Implementation detail supporting search page behavior.
015950| src/components/listings/ListingCard.tsx:80:   Texas: "TX",
015951| NOTE: Implementation detail supporting search page behavior.
015952| src/components/listings/ListingCard.tsx:81:   Utah: "UT",
015953| NOTE: Implementation detail supporting search page behavior.
015954| src/components/listings/ListingCard.tsx:82:   Vermont: "VT",
015955| NOTE: Implementation detail supporting search page behavior.
015956| src/components/listings/ListingCard.tsx:83:   Virginia: "VA",
015957| NOTE: Implementation detail supporting search page behavior.
015958| src/components/listings/ListingCard.tsx:84:   Washington: "WA",
015959| NOTE: Implementation detail supporting search page behavior.
015960| src/components/listings/ListingCard.tsx:85:   "West Virginia": "WV",
015961| NOTE: Implementation detail supporting search page behavior.
015962| src/components/listings/ListingCard.tsx:86:   Wisconsin: "WI",
015963| NOTE: Implementation detail supporting search page behavior.
015964| src/components/listings/ListingCard.tsx:87:   Wyoming: "WY",
015965| NOTE: Implementation detail supporting search page behavior.
015966| src/components/listings/ListingCard.tsx:88: };
015967| NOTE: Implementation detail supporting search page behavior.
015968| src/components/listings/ListingCard.tsx:89: 
015969| NOTE: Blank line for visual separation.
015970| src/components/listings/ListingCard.tsx:90: // Format location to avoid redundancy (e.g., "Irving, TX" not "Irving, TX, TX")
015971| NOTE: Line comment documents intent or constraints.
015972| src/components/listings/ListingCard.tsx:91: function formatLocation(city: string, state: string): string {
015973| NOTE: Defines a helper or component function.
015974| src/components/listings/ListingCard.tsx:92:   // Convert state to abbreviation if it's a full name
015975| NOTE: Line comment documents intent or constraints.
015976| src/components/listings/ListingCard.tsx:93:   const stateAbbr =
015977| NOTE: Local declaration used by search logic or UI.
015978| src/components/listings/ListingCard.tsx:94:     state.length === 2
015979| NOTE: Implementation detail supporting search page behavior.
015980| src/components/listings/ListingCard.tsx:95:       ? state.toUpperCase()
015981| NOTE: Implementation detail supporting search page behavior.
015982| src/components/listings/ListingCard.tsx:96:       : STATE_ABBREVIATIONS[state] || state;
015983| NOTE: Implementation detail supporting search page behavior.
015984| src/components/listings/ListingCard.tsx:97: 
015985| NOTE: Blank line for visual separation.
015986| src/components/listings/ListingCard.tsx:98:   // Clean city - remove any trailing state abbreviation if it matches
015987| NOTE: Line comment documents intent or constraints.
015988| src/components/listings/ListingCard.tsx:99:   let cleanCity = city.trim();
015989| NOTE: Local declaration used by search logic or UI.
015990| src/components/listings/ListingCard.tsx:100: 
015991| NOTE: Blank line for visual separation.
015992| src/components/listings/ListingCard.tsx:101:   // Check if city already ends with the state abbreviation (e.g., "Irving, TX")
015993| NOTE: Line comment documents intent or constraints.
015994| src/components/listings/ListingCard.tsx:102:   const cityParts = cleanCity.split(",").map((p) => p.trim());
015995| NOTE: Local declaration used by search logic or UI.
015996| src/components/listings/ListingCard.tsx:103:   if (cityParts.length > 1) {
015997| NOTE: Conditional logic controlling rendering or flow.
015998| src/components/listings/ListingCard.tsx:104:     const lastPart = cityParts[cityParts.length - 1].toUpperCase();
015999| NOTE: Local declaration used by search logic or UI.
016000| src/components/listings/ListingCard.tsx:105:     // If the last part is the same as state or its abbreviation, remove it
016001| NOTE: Line comment documents intent or constraints.
016002| src/components/listings/ListingCard.tsx:106:     if (
016003| NOTE: Conditional logic controlling rendering or flow.
016004| src/components/listings/ListingCard.tsx:107:       lastPart === stateAbbr ||
016005| NOTE: Implementation detail supporting search page behavior.
016006| src/components/listings/ListingCard.tsx:108:       lastPart === state.toUpperCase() ||
016007| NOTE: Implementation detail supporting search page behavior.
016008| src/components/listings/ListingCard.tsx:109:       STATE_ABBREVIATIONS[lastPart] === stateAbbr
016009| NOTE: Implementation detail supporting search page behavior.
016010| src/components/listings/ListingCard.tsx:110:     ) {
016011| NOTE: Implementation detail supporting search page behavior.
016012| src/components/listings/ListingCard.tsx:111:       cleanCity = cityParts.slice(0, -1).join(", ");
016013| NOTE: Implementation detail supporting search page behavior.
016014| src/components/listings/ListingCard.tsx:112:     }
016015| NOTE: Implementation detail supporting search page behavior.
016016| src/components/listings/ListingCard.tsx:113:   }
016017| NOTE: Implementation detail supporting search page behavior.
016018| src/components/listings/ListingCard.tsx:114: 
016019| NOTE: Blank line for visual separation.
016020| src/components/listings/ListingCard.tsx:115:   return `${cleanCity}, ${stateAbbr}`;
016021| NOTE: Return statement for component or helper output.
016022| src/components/listings/ListingCard.tsx:116: }
016023| NOTE: Implementation detail supporting search page behavior.
016024| src/components/listings/ListingCard.tsx:117: 
016025| NOTE: Blank line for visual separation.
016026| src/components/listings/ListingCard.tsx:118: // Placeholder images for when listing has no images
016027| NOTE: Line comment documents intent or constraints.
016028| src/components/listings/ListingCard.tsx:119: const PLACEHOLDER_IMAGES = [
016029| NOTE: Local declaration used by search logic or UI.
016030| src/components/listings/ListingCard.tsx:120:   "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=800&q=80",
016031| NOTE: Implementation detail supporting search page behavior.
016032| src/components/listings/ListingCard.tsx:121:   "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&w=800&q=80",
016033| NOTE: Implementation detail supporting search page behavior.
016034| src/components/listings/ListingCard.tsx:122:   "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80",
016035| NOTE: Implementation detail supporting search page behavior.
016036| src/components/listings/ListingCard.tsx:123:   "https://images.unsplash.com/photo-1484154218962-a1c002085d2f?auto=format&fit=crop&w=800&q=80",
016037| NOTE: Implementation detail supporting search page behavior.
016038| src/components/listings/ListingCard.tsx:124:   "https://images.unsplash.com/photo-1502005229766-528352261b79?auto=format&fit=crop&w=800&q=80",
016039| NOTE: Implementation detail supporting search page behavior.
016040| src/components/listings/ListingCard.tsx:125:   "https://images.unsplash.com/photo-1505691938895-1758d7feb511?auto=format&fit=crop&w=800&q=80",
016041| NOTE: Implementation detail supporting search page behavior.
016042| src/components/listings/ListingCard.tsx:126: ];
016043| NOTE: Implementation detail supporting search page behavior.
016044| src/components/listings/ListingCard.tsx:127: 
016045| NOTE: Blank line for visual separation.
016046| src/components/listings/ListingCard.tsx:128: // Format price with thousand separators for better readability
016047| NOTE: Line comment documents intent or constraints.
016048| src/components/listings/ListingCard.tsx:129: function formatPrice(price: number): string {
016049| NOTE: Defines a helper or component function.
016050| src/components/listings/ListingCard.tsx:130:   // Handle edge cases
016051| NOTE: Line comment documents intent or constraints.
016052| src/components/listings/ListingCard.tsx:131:   if (price === 0) return "Free";
016053| NOTE: Conditional logic controlling rendering or flow.
016054| src/components/listings/ListingCard.tsx:132:   if (price < 0) return "$0";
016055| NOTE: Conditional logic controlling rendering or flow.
016056| src/components/listings/ListingCard.tsx:133:   if (!Number.isFinite(price)) return "$0";
016057| NOTE: Conditional logic controlling rendering or flow.
016058| src/components/listings/ListingCard.tsx:134:   // Use locale string for proper formatting with commas
016059| NOTE: Line comment documents intent or constraints.
016060| src/components/listings/ListingCard.tsx:135:   return `$${price.toLocaleString("en-US", { maximumFractionDigits: 0 })}`;
016061| NOTE: Return statement for component or helper output.
016062| src/components/listings/ListingCard.tsx:136: }
016063| NOTE: Implementation detail supporting search page behavior.
016064| src/components/listings/ListingCard.tsx:137: 
016065| NOTE: Blank line for visual separation.
016066| src/components/listings/ListingCard.tsx:138: interface ListingCardProps {
016067| NOTE: Type declaration for search data contracts.
016068| src/components/listings/ListingCard.tsx:139:   listing: Listing;
016069| NOTE: Implementation detail supporting search page behavior.
016070| src/components/listings/ListingCard.tsx:140:   isSaved?: boolean;
016071| NOTE: Implementation detail supporting search page behavior.
016072| src/components/listings/ListingCard.tsx:141:   className?: string;
016073| NOTE: Implementation detail supporting search page behavior.
016074| src/components/listings/ListingCard.tsx:142: }
016075| NOTE: Implementation detail supporting search page behavior.
016076| src/components/listings/ListingCard.tsx:143: 
016077| NOTE: Blank line for visual separation.
016078| src/components/listings/ListingCard.tsx:144: export default function ListingCard({
016079| NOTE: Exports main component for this module.
016080| src/components/listings/ListingCard.tsx:145:   listing,
016081| NOTE: Implementation detail supporting search page behavior.
016082| src/components/listings/ListingCard.tsx:146:   isSaved,
016083| NOTE: Implementation detail supporting search page behavior.
016084| src/components/listings/ListingCard.tsx:147:   className,
016085| NOTE: Implementation detail supporting search page behavior.
016086| src/components/listings/ListingCard.tsx:148: }: ListingCardProps) {
016087| NOTE: Implementation detail supporting search page behavior.
016088| src/components/listings/ListingCard.tsx:149:   const [imageError, setImageError] = useState(false);
016089| NOTE: Initializes local state for search UI behavior.
016090| src/components/listings/ListingCard.tsx:150:   const { setHovered, setActive } = useListingFocus();
016091| NOTE: Local declaration used by search logic or UI.
016092| src/components/listings/ListingCard.tsx:151:   const { isFocused } = useIsListingFocused(listing.id);
016093| NOTE: Local declaration used by search logic or UI.
016094| src/components/listings/ListingCard.tsx:152:   const { focusListingOnMap, dismiss } = useSearchMapUI();
016095| NOTE: Local declaration used by search logic or UI.
016096| src/components/listings/ListingCard.tsx:153: 
016097| NOTE: Blank line for visual separation.
016098| src/components/listings/ListingCard.tsx:154:   // Memoized hover handlers to prevent cascade re-renders
016099| NOTE: Line comment documents intent or constraints.
016100| src/components/listings/ListingCard.tsx:155:   const handleMouseEnter = useCallback(() => {
016101| NOTE: Memoizes callback to preserve references across renders.
016102| src/components/listings/ListingCard.tsx:156:     setHovered(listing.id);
016103| NOTE: Implementation detail supporting search page behavior.
016104| src/components/listings/ListingCard.tsx:157:   }, [setHovered, listing.id]);
016105| NOTE: Implementation detail supporting search page behavior.
016106| src/components/listings/ListingCard.tsx:158: 
016107| NOTE: Blank line for visual separation.
016108| src/components/listings/ListingCard.tsx:159:   const handleMouseLeave = useCallback(() => {
016109| NOTE: Memoizes callback to preserve references across renders.
016110| src/components/listings/ListingCard.tsx:160:     setHovered(null);
016111| NOTE: Implementation detail supporting search page behavior.
016112| src/components/listings/ListingCard.tsx:161:   }, [setHovered]);
016113| NOTE: Implementation detail supporting search page behavior.
016114| src/components/listings/ListingCard.tsx:162: 
016115| NOTE: Blank line for visual separation.
016116| src/components/listings/ListingCard.tsx:163:   // "View on map" button handlers
016117| NOTE: Line comment documents intent or constraints.
016118| src/components/listings/ListingCard.tsx:164:   const handleViewOnMap = useCallback(
016119| NOTE: Memoizes callback to preserve references across renders.
016120| src/components/listings/ListingCard.tsx:165:     (e: React.MouseEvent) => {
016121| NOTE: Implementation detail supporting search page behavior.
016122| src/components/listings/ListingCard.tsx:166:       e.preventDefault();
016123| NOTE: Implementation detail supporting search page behavior.
016124| src/components/listings/ListingCard.tsx:167:       e.stopPropagation();
016125| NOTE: Implementation detail supporting search page behavior.
016126| src/components/listings/ListingCard.tsx:168:       setActive(listing.id); // Set active immediately (user initiated from card)
016127| NOTE: Implementation detail supporting search page behavior.
016128| src/components/listings/ListingCard.tsx:169:       focusListingOnMap(listing.id);
016129| NOTE: Implementation detail supporting search page behavior.
016130| src/components/listings/ListingCard.tsx:170:     },
016131| NOTE: Implementation detail supporting search page behavior.
016132| src/components/listings/ListingCard.tsx:171:     [focusListingOnMap, setActive, listing.id],
016133| NOTE: Implementation detail supporting search page behavior.
016134| src/components/listings/ListingCard.tsx:172:   );
016135| NOTE: Implementation detail supporting search page behavior.
016136| src/components/listings/ListingCard.tsx:173: 
016137| NOTE: Blank line for visual separation.
016138| src/components/listings/ListingCard.tsx:174:   const handleViewOnMapKeyDown = useCallback(
016139| NOTE: Memoizes callback to preserve references across renders.
016140| src/components/listings/ListingCard.tsx:175:     (e: React.KeyboardEvent) => {
016141| NOTE: Implementation detail supporting search page behavior.
016142| src/components/listings/ListingCard.tsx:176:       if (e.key === "Enter" || e.key === " ") {
016143| NOTE: Conditional logic controlling rendering or flow.
016144| src/components/listings/ListingCard.tsx:177:         e.preventDefault();
016145| NOTE: Implementation detail supporting search page behavior.
016146| src/components/listings/ListingCard.tsx:178:         e.stopPropagation();
016147| NOTE: Implementation detail supporting search page behavior.
016148| src/components/listings/ListingCard.tsx:179:         setActive(listing.id); // Set active immediately (user initiated from card)
016149| NOTE: Implementation detail supporting search page behavior.
016150| src/components/listings/ListingCard.tsx:180:         focusListingOnMap(listing.id);
016151| NOTE: Implementation detail supporting search page behavior.
016152| src/components/listings/ListingCard.tsx:181:       }
016153| NOTE: Implementation detail supporting search page behavior.
016154| src/components/listings/ListingCard.tsx:182:     },
016155| NOTE: Implementation detail supporting search page behavior.
016156| src/components/listings/ListingCard.tsx:183:     [focusListingOnMap, setActive, listing.id],
016157| NOTE: Implementation detail supporting search page behavior.
016158| src/components/listings/ListingCard.tsx:184:   );
016159| NOTE: Implementation detail supporting search page behavior.
016160| src/components/listings/ListingCard.tsx:185: 
016161| NOTE: Blank line for visual separation.
016162| src/components/listings/ListingCard.tsx:186:   // Use listing's first image if available, otherwise use placeholder
016163| NOTE: Line comment documents intent or constraints.
016164| src/components/listings/ListingCard.tsx:187:   const hasListingImage =
016165| NOTE: Local declaration used by search logic or UI.
016166| src/components/listings/ListingCard.tsx:188:     listing.images && listing.images.length > 0 && listing.images[0];
016167| NOTE: Implementation detail supporting search page behavior.
016168| src/components/listings/ListingCard.tsx:189:   const placeholderIndex =
016169| NOTE: Local declaration used by search logic or UI.
016170| src/components/listings/ListingCard.tsx:190:     listing.id.split("").reduce((acc, char) => acc + char.charCodeAt(0), 0) %
016171| NOTE: Implementation detail supporting search page behavior.
016172| src/components/listings/ListingCard.tsx:191:     PLACEHOLDER_IMAGES.length;
016173| NOTE: Implementation detail supporting search page behavior.
016174| src/components/listings/ListingCard.tsx:192:   const imageUrl =
016175| NOTE: Local declaration used by search logic or UI.
016176| src/components/listings/ListingCard.tsx:193:     hasListingImage && !imageError
016177| NOTE: Implementation detail supporting search page behavior.
016178| src/components/listings/ListingCard.tsx:194:       ? listing.images![0]
016179| NOTE: Implementation detail supporting search page behavior.
016180| src/components/listings/ListingCard.tsx:195:       : PLACEHOLDER_IMAGES[placeholderIndex];
016181| NOTE: Implementation detail supporting search page behavior.
016182| src/components/listings/ListingCard.tsx:196:   const showImagePlaceholder = !hasListingImage || imageError;
016183| NOTE: Local declaration used by search logic or UI.
016184| src/components/listings/ListingCard.tsx:197: 
016185| NOTE: Blank line for visual separation.
016186| src/components/listings/ListingCard.tsx:198:   const isAvailable = listing.availableSlots > 0;
016187| NOTE: Local declaration used by search logic or UI.
016188| src/components/listings/ListingCard.tsx:199: 
016189| NOTE: Blank line for visual separation.
016190| src/components/listings/ListingCard.tsx:200:   // Fallback for empty/null titles
016191| NOTE: Line comment documents intent or constraints.
016192| src/components/listings/ListingCard.tsx:201:   const displayTitle = listing.title?.trim() || "Untitled Listing";
016193| NOTE: Local declaration used by search logic or UI.
016194| src/components/listings/ListingCard.tsx:202: 
016195| NOTE: Blank line for visual separation.
016196| src/components/listings/ListingCard.tsx:203:   return (
016197| NOTE: Return statement for component or helper output.
016198| src/components/listings/ListingCard.tsx:204:     <Link
016199| NOTE: JSX markup for search UI.
016200| src/components/listings/ListingCard.tsx:205:       href={`/listings/${listing.id}`}
016201| NOTE: Implementation detail supporting search page behavior.
016202| src/components/listings/ListingCard.tsx:206:       data-listing-id={listing.id}
016203| NOTE: Implementation detail supporting search page behavior.
016204| src/components/listings/ListingCard.tsx:207:       data-testid={`listing-card-${listing.id}`}
016205| NOTE: Implementation detail supporting search page behavior.
016206| src/components/listings/ListingCard.tsx:208:       data-active={isFocused ? "true" : "false"}
016207| NOTE: Implementation detail supporting search page behavior.
016208| src/components/listings/ListingCard.tsx:209:       onClick={dismiss}
016209| NOTE: Implementation detail supporting search page behavior.
016210| src/components/listings/ListingCard.tsx:210:       onMouseEnter={handleMouseEnter}
016211| NOTE: Implementation detail supporting search page behavior.
016212| src/components/listings/ListingCard.tsx:211:       onMouseLeave={handleMouseLeave}
016213| NOTE: Implementation detail supporting search page behavior.
016214| src/components/listings/ListingCard.tsx:212:       className={cn(
016215| NOTE: Tailwind classes define layout and styling.
016216| src/components/listings/ListingCard.tsx:213:         "block group focus:outline-none focus-visible:ring-2 focus-visible:ring-zinc-900 dark:focus-visible:ring-zinc-400 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-zinc-950 rounded-xl",
016217| NOTE: Implementation detail supporting search page behavior.
016218| src/components/listings/ListingCard.tsx:214:         isFocused &&
016219| NOTE: Implementation detail supporting search page behavior.
016220| src/components/listings/ListingCard.tsx:215:           "ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-zinc-950",
016221| NOTE: Implementation detail supporting search page behavior.
016222| src/components/listings/ListingCard.tsx:216:         className,
016223| NOTE: Implementation detail supporting search page behavior.
016224| src/components/listings/ListingCard.tsx:217:       )}
016225| NOTE: Implementation detail supporting search page behavior.
016226| src/components/listings/ListingCard.tsx:218:     >
016227| NOTE: Implementation detail supporting search page behavior.
016228| src/components/listings/ListingCard.tsx:219:       <div
016229| NOTE: JSX markup for search UI.
016230| src/components/listings/ListingCard.tsx:220:         className={cn(
016231| NOTE: Tailwind classes define layout and styling.
016232| src/components/listings/ListingCard.tsx:221:           "relative bg-white dark:bg-zinc-900 flex flex-col rounded-xl border overflow-hidden transition-all duration-normal hover:-translate-y-0.5 hover:shadow-lg",
016233| NOTE: Implementation detail supporting search page behavior.
016234| src/components/listings/ListingCard.tsx:222:           listing.isNearMatch
016235| NOTE: Implementation detail supporting search page behavior.
016236| src/components/listings/ListingCard.tsx:223:             ? "border-dashed border-2 border-amber-400 dark:border-amber-500 hover:border-amber-500 dark:hover:border-amber-400"
016237| NOTE: Implementation detail supporting search page behavior.
016238| src/components/listings/ListingCard.tsx:224:             : "border-zinc-200/60 dark:border-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700",
016239| NOTE: Implementation detail supporting search page behavior.
016240| src/components/listings/ListingCard.tsx:225:         )}
016241| NOTE: Implementation detail supporting search page behavior.
016242| src/components/listings/ListingCard.tsx:226:       >
016243| NOTE: Implementation detail supporting search page behavior.
016244| src/components/listings/ListingCard.tsx:227:         {/* Image Area */}
016245| NOTE: Implementation detail supporting search page behavior.
016246| src/components/listings/ListingCard.tsx:228:         <div className="relative aspect-[4/3] overflow-hidden bg-zinc-100 dark:bg-zinc-800">
016247| NOTE: Tailwind classes define layout and styling.
016248| src/components/listings/ListingCard.tsx:229:           {/* Carousel for multiple images, single image otherwise */}
016249| NOTE: Implementation detail supporting search page behavior.
016250| src/components/listings/ListingCard.tsx:230:           {hasListingImage && !imageError && listing.images!.length > 1 ? (
016251| NOTE: Implementation detail supporting search page behavior.
016252| src/components/listings/ListingCard.tsx:231:             <ListingCardCarousel
016253| NOTE: JSX markup for search UI.
016254| src/components/listings/ListingCard.tsx:232:               images={listing.images!}
016255| NOTE: Implementation detail supporting search page behavior.
016256| src/components/listings/ListingCard.tsx:233:               alt={displayTitle}
016257| NOTE: Implementation detail supporting search page behavior.
016258| src/components/listings/ListingCard.tsx:234:               maxImages={5}
016259| NOTE: Implementation detail supporting search page behavior.
016260| src/components/listings/ListingCard.tsx:235:               onImageError={() => setImageError(true)}
016261| NOTE: Implementation detail supporting search page behavior.
016262| src/components/listings/ListingCard.tsx:236:             />
016263| NOTE: Implementation detail supporting search page behavior.
016264| src/components/listings/ListingCard.tsx:237:           ) : (
016265| NOTE: Implementation detail supporting search page behavior.
016266| src/components/listings/ListingCard.tsx:238:             <Image
016267| NOTE: JSX markup for search UI.
016268| src/components/listings/ListingCard.tsx:239:               src={imageUrl}
016269| NOTE: Implementation detail supporting search page behavior.
016270| src/components/listings/ListingCard.tsx:240:               alt={displayTitle}
016271| NOTE: Implementation detail supporting search page behavior.
016272| src/components/listings/ListingCard.tsx:241:               fill
016273| NOTE: Implementation detail supporting search page behavior.
016274| src/components/listings/ListingCard.tsx:242:               className="object-cover group-hover:scale-105 transition-transform duration-normal ease-out"
016275| NOTE: Tailwind classes define layout and styling.
016276| src/components/listings/ListingCard.tsx:243:               sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
016277| NOTE: Implementation detail supporting search page behavior.
016278| src/components/listings/ListingCard.tsx:244:               onError={() => setImageError(true)}
016279| NOTE: Implementation detail supporting search page behavior.
016280| src/components/listings/ListingCard.tsx:245:               loading="lazy"
016281| NOTE: Implementation detail supporting search page behavior.
016282| src/components/listings/ListingCard.tsx:246:             />
016283| NOTE: Implementation detail supporting search page behavior.
016284| src/components/listings/ListingCard.tsx:247:           )}
016285| NOTE: Implementation detail supporting search page behavior.
016286| src/components/listings/ListingCard.tsx:248: 
016287| NOTE: Blank line for visual separation.
016288| src/components/listings/ListingCard.tsx:249:           {/* Empty state overlay - Intentional waiting state */}
016289| NOTE: Implementation detail supporting search page behavior.
016290| src/components/listings/ListingCard.tsx:250:           {showImagePlaceholder && (
016291| NOTE: Implementation detail supporting search page behavior.
016292| src/components/listings/ListingCard.tsx:251:             <div className="absolute inset-0 bg-gradient-to-br from-zinc-100 to-zinc-150 dark:from-zinc-800 dark:to-zinc-850 flex flex-col items-center justify-center">
016293| NOTE: Tailwind classes define layout and styling.
016294| src/components/listings/ListingCard.tsx:252:               <div className="w-14 h-14 rounded-2xl bg-zinc-200/80 dark:bg-zinc-700/80 flex items-center justify-center mb-2">
016295| NOTE: Tailwind classes define layout and styling.
016296| src/components/listings/ListingCard.tsx:253:                 <Home
016297| NOTE: JSX markup for search UI.
016298| src/components/listings/ListingCard.tsx:254:                   className="w-7 h-7 text-zinc-400 dark:text-zinc-500"
016299| NOTE: Tailwind classes define layout and styling.
016300| src/components/listings/ListingCard.tsx:255:                   strokeWidth={1.5}
016301| NOTE: Implementation detail supporting search page behavior.
016302| src/components/listings/ListingCard.tsx:256:                   fill="currentColor"
016303| NOTE: Implementation detail supporting search page behavior.
016304| src/components/listings/ListingCard.tsx:257:                   fillOpacity={0.1}
016305| NOTE: Implementation detail supporting search page behavior.
016306| src/components/listings/ListingCard.tsx:258:                 />
016307| NOTE: Implementation detail supporting search page behavior.
016308| src/components/listings/ListingCard.tsx:259:               </div>
016309| NOTE: JSX markup for search UI.
016310| src/components/listings/ListingCard.tsx:260:               <span className="text-xs text-zinc-400 dark:text-zinc-500 font-medium uppercase tracking-wider">
016311| NOTE: Tailwind classes define layout and styling.
016312| src/components/listings/ListingCard.tsx:261:                 No Photos
016313| NOTE: Implementation detail supporting search page behavior.
016314| src/components/listings/ListingCard.tsx:262:               </span>
016315| NOTE: JSX markup for search UI.
016316| src/components/listings/ListingCard.tsx:263:             </div>
016317| NOTE: JSX markup for search UI.
016318| src/components/listings/ListingCard.tsx:264:           )}
016319| NOTE: Implementation detail supporting search page behavior.
016320| src/components/listings/ListingCard.tsx:265: 
016321| NOTE: Blank line for visual separation.
016322| src/components/listings/ListingCard.tsx:266:           {/* Favorite Button */}
016323| NOTE: Implementation detail supporting search page behavior.
016324| src/components/listings/ListingCard.tsx:267:           <div className="absolute top-3 right-3 z-10">
016325| NOTE: Tailwind classes define layout and styling.
016326| src/components/listings/ListingCard.tsx:268:             <FavoriteButton listingId={listing.id} initialIsSaved={isSaved} />
016327| NOTE: JSX markup for search UI.
016328| src/components/listings/ListingCard.tsx:269:           </div>
016329| NOTE: JSX markup for search UI.
016330| src/components/listings/ListingCard.tsx:270: 
016331| NOTE: Blank line for visual separation.
016332| src/components/listings/ListingCard.tsx:271:           {/* Availability Badge - Inside image with glassmorphism */}
016333| NOTE: Implementation detail supporting search page behavior.
016334| src/components/listings/ListingCard.tsx:272:           <div className="absolute top-3 left-3 z-10 flex items-center gap-1.5">
016335| NOTE: Tailwind classes define layout and styling.
016336| src/components/listings/ListingCard.tsx:273:             <span
016337| NOTE: JSX markup for search UI.
016338| src/components/listings/ListingCard.tsx:274:               className={cn(
016339| NOTE: Tailwind classes define layout and styling.
016340| src/components/listings/ListingCard.tsx:275:                 "inline-flex items-center px-2.5 py-1 rounded-md text-2xs font-bold uppercase tracking-wide shadow-sm",
016341| NOTE: Implementation detail supporting search page behavior.
016342| src/components/listings/ListingCard.tsx:276:                 isAvailable
016343| NOTE: Implementation detail supporting search page behavior.
016344| src/components/listings/ListingCard.tsx:277:                   ? "bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white shadow-black/5"
016345| NOTE: Implementation detail supporting search page behavior.
016346| src/components/listings/ListingCard.tsx:278:                   : "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900",
016347| NOTE: Implementation detail supporting search page behavior.
016348| src/components/listings/ListingCard.tsx:279:               )}
016349| NOTE: Implementation detail supporting search page behavior.
016350| src/components/listings/ListingCard.tsx:280:             >
016351| NOTE: Implementation detail supporting search page behavior.
016352| src/components/listings/ListingCard.tsx:281:               {isAvailable ? "Available" : "Filled"}
016353| NOTE: Implementation detail supporting search page behavior.
016354| src/components/listings/ListingCard.tsx:282:             </span>
016355| NOTE: JSX markup for search UI.
016356| src/components/listings/ListingCard.tsx:283:             {/* Near-match indicator */}
016357| NOTE: Implementation detail supporting search page behavior.
016358| src/components/listings/ListingCard.tsx:284:             {listing.isNearMatch && (
016359| NOTE: Implementation detail supporting search page behavior.
016360| src/components/listings/ListingCard.tsx:285:               <span
016361| NOTE: JSX markup for search UI.
016362| src/components/listings/ListingCard.tsx:286:                 className="inline-flex items-center px-2 py-1 rounded-md text-2xs font-medium bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300 shadow-sm"
016363| NOTE: Tailwind classes define layout and styling.
016364| src/components/listings/ListingCard.tsx:287:                 title="This listing is slightly outside your filter criteria"
016365| NOTE: Implementation detail supporting search page behavior.
016366| src/components/listings/ListingCard.tsx:288:               >
016367| NOTE: Implementation detail supporting search page behavior.
016368| src/components/listings/ListingCard.tsx:289:                 ~Near match
016369| NOTE: Implementation detail supporting search page behavior.
016370| src/components/listings/ListingCard.tsx:290:               </span>
016371| NOTE: JSX markup for search UI.
016372| src/components/listings/ListingCard.tsx:291:             )}
016373| NOTE: Implementation detail supporting search page behavior.
016374| src/components/listings/ListingCard.tsx:292:           </div>
016375| NOTE: JSX markup for search UI.
016376| src/components/listings/ListingCard.tsx:293: 
016377| NOTE: Blank line for visual separation.
016378| src/components/listings/ListingCard.tsx:294:           {/* View on Map button */}
016379| NOTE: Implementation detail supporting search page behavior.
016380| src/components/listings/ListingCard.tsx:295:           <button
016381| NOTE: JSX markup for search UI.
016382| src/components/listings/ListingCard.tsx:296:             type="button"
016383| NOTE: Implementation detail supporting search page behavior.
016384| src/components/listings/ListingCard.tsx:297:             onClick={handleViewOnMap}
016385| NOTE: Implementation detail supporting search page behavior.
016386| src/components/listings/ListingCard.tsx:298:             onKeyDown={handleViewOnMapKeyDown}
016387| NOTE: Implementation detail supporting search page behavior.
016388| src/components/listings/ListingCard.tsx:299:             data-testid={`view-on-map-${listing.id}`}
016389| NOTE: Implementation detail supporting search page behavior.
016390| src/components/listings/ListingCard.tsx:300:             className="absolute bottom-3 right-3 z-10 flex items-center gap-1.5 px-2.5 py-1.5
016391| NOTE: Tailwind classes define layout and styling.
016392| src/components/listings/ListingCard.tsx:301:                        bg-white/90 dark:bg-zinc-800/90 backdrop-blur-sm
016393| NOTE: Implementation detail supporting search page behavior.
016394| src/components/listings/ListingCard.tsx:302:                        rounded-lg shadow-sm border border-zinc-200/60 dark:border-zinc-700/60
016395| NOTE: Implementation detail supporting search page behavior.
016396| src/components/listings/ListingCard.tsx:303:                        text-xs font-medium text-zinc-700 dark:text-zinc-300
016397| NOTE: Implementation detail supporting search page behavior.
016398| src/components/listings/ListingCard.tsx:304:                        hover:bg-white dark:hover:bg-zinc-800
016399| NOTE: Implementation detail supporting search page behavior.
016400| src/components/listings/ListingCard.tsx:305:                        hover:border-zinc-300 dark:hover:border-zinc-600
016401| NOTE: Implementation detail supporting search page behavior.
016402| src/components/listings/ListingCard.tsx:306:                        transition-all duration-150
016403| NOTE: Implementation detail supporting search page behavior.
016404| src/components/listings/ListingCard.tsx:307:                        focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
016405| NOTE: Implementation detail supporting search page behavior.
016406| src/components/listings/ListingCard.tsx:308:             aria-label={`View ${displayTitle} on map`}
016407| NOTE: Accessibility attribute for screen readers.
016408| src/components/listings/ListingCard.tsx:309:           >
016409| NOTE: Implementation detail supporting search page behavior.
016410| src/components/listings/ListingCard.tsx:310:             <MapPin className="w-3.5 h-3.5" />
016411| NOTE: Tailwind classes define layout and styling.
016412| src/components/listings/ListingCard.tsx:311:             <span className="hidden sm:inline">Map</span>
016413| NOTE: Tailwind classes define layout and styling.
016414| src/components/listings/ListingCard.tsx:312:           </button>
016415| NOTE: JSX markup for search UI.
016416| src/components/listings/ListingCard.tsx:313:         </div>
016417| NOTE: JSX markup for search UI.
016418| src/components/listings/ListingCard.tsx:314: 
016419| NOTE: Blank line for visual separation.
016420| src/components/listings/ListingCard.tsx:315:         {/* Content Area */}
016421| NOTE: Implementation detail supporting search page behavior.
016422| src/components/listings/ListingCard.tsx:316:         <div className="flex flex-col flex-1 p-4">
016423| NOTE: Tailwind classes define layout and styling.
016424| src/components/listings/ListingCard.tsx:317:           {/* Title Row with Rating */}
016425| NOTE: Implementation detail supporting search page behavior.
016426| src/components/listings/ListingCard.tsx:318:           <div className="flex justify-between items-start gap-3 mb-0.5">
016427| NOTE: Tailwind classes define layout and styling.
016428| src/components/listings/ListingCard.tsx:319:             <h3
016429| NOTE: JSX markup for search UI.
016430| src/components/listings/ListingCard.tsx:320:               className="font-semibold text-sm text-zinc-900 dark:text-white line-clamp-1 leading-snug"
016431| NOTE: Tailwind classes define layout and styling.
016432| src/components/listings/ListingCard.tsx:321:               title={displayTitle}
016433| NOTE: Implementation detail supporting search page behavior.
016434| src/components/listings/ListingCard.tsx:322:             >
016435| NOTE: Implementation detail supporting search page behavior.
016436| src/components/listings/ListingCard.tsx:323:               {displayTitle}
016437| NOTE: Implementation detail supporting search page behavior.
016438| src/components/listings/ListingCard.tsx:324:             </h3>
016439| NOTE: JSX markup for search UI.
016440| src/components/listings/ListingCard.tsx:325:             {listing.reviewCount &&
016441| NOTE: Implementation detail supporting search page behavior.
016442| src/components/listings/ListingCard.tsx:326:             listing.reviewCount > 0 &&
016443| NOTE: Implementation detail supporting search page behavior.
016444| src/components/listings/ListingCard.tsx:327:             listing.avgRating ? (
016445| NOTE: Implementation detail supporting search page behavior.
016446| src/components/listings/ListingCard.tsx:328:               <div
016447| NOTE: JSX markup for search UI.
016448| src/components/listings/ListingCard.tsx:329:                 className="flex items-center gap-1 flex-shrink-0"
016449| NOTE: Tailwind classes define layout and styling.
016450| src/components/listings/ListingCard.tsx:330:                 aria-label={`Rating ${listing.avgRating.toFixed(1)} out of 5`}
016451| NOTE: Accessibility attribute for screen readers.
016452| src/components/listings/ListingCard.tsx:331:               >
016453| NOTE: Implementation detail supporting search page behavior.
016454| src/components/listings/ListingCard.tsx:332:                 <Star className="w-3.5 h-3.5 text-amber-400 fill-amber-400" />
016455| NOTE: Tailwind classes define layout and styling.
016456| src/components/listings/ListingCard.tsx:333:                 <span className="text-xs text-zinc-600 dark:text-zinc-400 font-medium">
016457| NOTE: Tailwind classes define layout and styling.
016458| src/components/listings/ListingCard.tsx:334:                   {listing.avgRating.toFixed(1)}
016459| NOTE: Implementation detail supporting search page behavior.
016460| src/components/listings/ListingCard.tsx:335:                 </span>
016461| NOTE: JSX markup for search UI.
016462| src/components/listings/ListingCard.tsx:336:               </div>
016463| NOTE: JSX markup for search UI.
016464| src/components/listings/ListingCard.tsx:337:             ) : (
016465| NOTE: Implementation detail supporting search page behavior.
016466| src/components/listings/ListingCard.tsx:338:               <span className="text-2xs uppercase font-bold text-zinc-400 dark:text-zinc-500 flex-shrink-0 tracking-wide">
016467| NOTE: Tailwind classes define layout and styling.
016468| src/components/listings/ListingCard.tsx:339:                 New
016469| NOTE: Implementation detail supporting search page behavior.
016470| src/components/listings/ListingCard.tsx:340:               </span>
016471| NOTE: JSX markup for search UI.
016472| src/components/listings/ListingCard.tsx:341:             )}
016473| NOTE: Implementation detail supporting search page behavior.
016474| src/components/listings/ListingCard.tsx:342:           </div>
016475| NOTE: JSX markup for search UI.
016476| src/components/listings/ListingCard.tsx:343: 
016477| NOTE: Blank line for visual separation.
016478| src/components/listings/ListingCard.tsx:344:           {/* Location - Tight spacing with title */}
016479| NOTE: Implementation detail supporting search page behavior.
016480| src/components/listings/ListingCard.tsx:345:           <p className="text-xs text-zinc-500 dark:text-zinc-400 mb-3">
016481| NOTE: Tailwind classes define layout and styling.
016482| src/components/listings/ListingCard.tsx:346:             {formatLocation(listing.location.city, listing.location.state)}
016483| NOTE: Implementation detail supporting search page behavior.
016484| src/components/listings/ListingCard.tsx:347:           </p>
016485| NOTE: JSX markup for search UI.
016486| src/components/listings/ListingCard.tsx:348: 
016487| NOTE: Blank line for visual separation.
016488| src/components/listings/ListingCard.tsx:349:           {/* Amenities */}
016489| NOTE: Implementation detail supporting search page behavior.
016490| src/components/listings/ListingCard.tsx:350:           <div className="flex flex-wrap gap-1.5 mb-2">
016491| NOTE: Tailwind classes define layout and styling.
016492| src/components/listings/ListingCard.tsx:351:             {listing.amenities.slice(0, 3).map((amenity, i) => (
016493| NOTE: Implementation detail supporting search page behavior.
016494| src/components/listings/ListingCard.tsx:352:               <span
016495| NOTE: JSX markup for search UI.
016496| src/components/listings/ListingCard.tsx:353:                 key={i}
016497| NOTE: Implementation detail supporting search page behavior.
016498| src/components/listings/ListingCard.tsx:354:                 className="text-2xs bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 px-2 py-0.5 rounded font-medium border border-zinc-200 dark:border-zinc-700"
016499| NOTE: Tailwind classes define layout and styling.
016500| src/components/listings/ListingCard.tsx:355:               >
016501| NOTE: Implementation detail supporting search page behavior.
016502| src/components/listings/ListingCard.tsx:356:                 {amenity}
016503| NOTE: Implementation detail supporting search page behavior.
016504| src/components/listings/ListingCard.tsx:357:               </span>
016505| NOTE: JSX markup for search UI.
016506| src/components/listings/ListingCard.tsx:358:             ))}
016507| NOTE: Implementation detail supporting search page behavior.
016508| src/components/listings/ListingCard.tsx:359:           </div>
016509| NOTE: JSX markup for search UI.
016510| src/components/listings/ListingCard.tsx:360: 
016511| NOTE: Blank line for visual separation.
016512| src/components/listings/ListingCard.tsx:361:           {/* Languages spoken */}
016513| NOTE: Implementation detail supporting search page behavior.
016514| src/components/listings/ListingCard.tsx:362:           {listing.householdLanguages &&
016515| NOTE: Implementation detail supporting search page behavior.
016516| src/components/listings/ListingCard.tsx:363:             listing.householdLanguages.length > 0 && (
016517| NOTE: Implementation detail supporting search page behavior.
016518| src/components/listings/ListingCard.tsx:364:               <div className="flex flex-wrap items-center gap-1.5 mb-4">
016519| NOTE: Tailwind classes define layout and styling.
016520| src/components/listings/ListingCard.tsx:365:                 <Globe className="w-3.5 h-3.5 text-blue-500 dark:text-blue-400 flex-shrink-0" />
016521| NOTE: Tailwind classes define layout and styling.
016522| src/components/listings/ListingCard.tsx:366:                 {listing.householdLanguages.slice(0, 2).map((code, i) => (
016523| NOTE: Implementation detail supporting search page behavior.
016524| src/components/listings/ListingCard.tsx:367:                   <span
016525| NOTE: JSX markup for search UI.
016526| src/components/listings/ListingCard.tsx:368:                     key={i}
016527| NOTE: Implementation detail supporting search page behavior.
016528| src/components/listings/ListingCard.tsx:369:                     className="text-2xs bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded font-medium"
016529| NOTE: Tailwind classes define layout and styling.
016530| src/components/listings/ListingCard.tsx:370:                   >
016531| NOTE: Implementation detail supporting search page behavior.
016532| src/components/listings/ListingCard.tsx:371:                     {getLanguageName(code)}
016533| NOTE: Implementation detail supporting search page behavior.
016534| src/components/listings/ListingCard.tsx:372:                   </span>
016535| NOTE: JSX markup for search UI.
016536| src/components/listings/ListingCard.tsx:373:                 ))}
016537| NOTE: Implementation detail supporting search page behavior.
016538| src/components/listings/ListingCard.tsx:374:                 {listing.householdLanguages.length > 2 && (
016539| NOTE: Implementation detail supporting search page behavior.
016540| src/components/listings/ListingCard.tsx:375:                   <span className="text-2xs text-zinc-400 dark:text-zinc-500">
016541| NOTE: Tailwind classes define layout and styling.
016542| src/components/listings/ListingCard.tsx:376:                     +{listing.householdLanguages.length - 2}
016543| NOTE: Implementation detail supporting search page behavior.
016544| src/components/listings/ListingCard.tsx:377:                   </span>
016545| NOTE: JSX markup for search UI.
016546| src/components/listings/ListingCard.tsx:378:                 )}
016547| NOTE: Implementation detail supporting search page behavior.
016548| src/components/listings/ListingCard.tsx:379:               </div>
016549| NOTE: JSX markup for search UI.
016550| src/components/listings/ListingCard.tsx:380:             )}
016551| NOTE: Implementation detail supporting search page behavior.
016552| src/components/listings/ListingCard.tsx:381: 
016553| NOTE: Blank line for visual separation.
016554| src/components/listings/ListingCard.tsx:382:           {/* Price Row - Clean, no button */}
016555| NOTE: Implementation detail supporting search page behavior.
016556| src/components/listings/ListingCard.tsx:383:           <div className="mt-auto">
016557| NOTE: Tailwind classes define layout and styling.
016558| src/components/listings/ListingCard.tsx:384:             <div className="flex items-baseline">
016559| NOTE: Tailwind classes define layout and styling.
016560| src/components/listings/ListingCard.tsx:385:               <span
016561| NOTE: JSX markup for search UI.
016562| src/components/listings/ListingCard.tsx:386:                 className="font-bold text-xl text-zinc-900 dark:text-white tracking-tight"
016563| NOTE: Tailwind classes define layout and styling.
016564| src/components/listings/ListingCard.tsx:387:                 data-testid="listing-price"
016565| NOTE: Implementation detail supporting search page behavior.
016566| src/components/listings/ListingCard.tsx:388:                 data-price={listing.price}
016567| NOTE: Implementation detail supporting search page behavior.
016568| src/components/listings/ListingCard.tsx:389:               >
016569| NOTE: Implementation detail supporting search page behavior.
016570| src/components/listings/ListingCard.tsx:390:                 {formatPrice(listing.price)}
016571| NOTE: Implementation detail supporting search page behavior.
016572| src/components/listings/ListingCard.tsx:391:               </span>
016573| NOTE: JSX markup for search UI.
016574| src/components/listings/ListingCard.tsx:392:               {listing.price > 0 && (
016575| NOTE: Implementation detail supporting search page behavior.
016576| src/components/listings/ListingCard.tsx:393:                 <span className="text-zinc-400 dark:text-zinc-500 text-sm ml-0.5">
016577| NOTE: Tailwind classes define layout and styling.
016578| src/components/listings/ListingCard.tsx:394:                   /mo
016579| NOTE: Implementation detail supporting search page behavior.
016580| src/components/listings/ListingCard.tsx:395:                 </span>
016581| NOTE: JSX markup for search UI.
016582| src/components/listings/ListingCard.tsx:396:               )}
016583| NOTE: Implementation detail supporting search page behavior.
016584| src/components/listings/ListingCard.tsx:397:             </div>
016585| NOTE: JSX markup for search UI.
016586| src/components/listings/ListingCard.tsx:398:           </div>
016587| NOTE: JSX markup for search UI.
016588| src/components/listings/ListingCard.tsx:399:         </div>
016589| NOTE: JSX markup for search UI.
016590| src/components/listings/ListingCard.tsx:400:       </div>
016591| NOTE: JSX markup for search UI.
016592| src/components/listings/ListingCard.tsx:401:     </Link>
016593| NOTE: JSX markup for search UI.
016594| src/components/listings/ListingCard.tsx:402:   );
016595| NOTE: Implementation detail supporting search page behavior.
016596| src/components/listings/ListingCard.tsx:403: }
016597| NOTE: Implementation detail supporting search page behavior.
016598| FILE END: src/components/listings/ListingCard.tsx
016599| 
016600| FILE START: src/components/listings/ListingCardCarousel.tsx
016601| FILE ROLE: Auto-discovered dependency in search page graph.
016602| src/components/listings/ListingCardCarousel.tsx:1: "use client";
016603| NOTE: Implementation detail supporting search page behavior.
016604| src/components/listings/ListingCardCarousel.tsx:2: 
016605| NOTE: Blank line for visual separation.
016606| src/components/listings/ListingCardCarousel.tsx:3: /**
016607| NOTE: Block comment line describing behavior or context.
016608| src/components/listings/ListingCardCarousel.tsx:4:  * ListingCardCarousel - Image carousel for listing cards
016609| NOTE: Block comment line describing behavior or context.
016610| src/components/listings/ListingCardCarousel.tsx:5:  *
016611| NOTE: Block comment line describing behavior or context.
016612| src/components/listings/ListingCardCarousel.tsx:6:  * Features:
016613| NOTE: Block comment line describing behavior or context.
016614| src/components/listings/ListingCardCarousel.tsx:7:  * - CSS scroll-snap based (no external library)
016615| NOTE: Block comment line describing behavior or context.
016616| src/components/listings/ListingCardCarousel.tsx:8:  * - Lazy loading for non-visible images
016617| NOTE: Block comment line describing behavior or context.
016618| src/components/listings/ListingCardCarousel.tsx:9:  * - Controls appear on hover (desktop) or always visible (mobile)
016619| NOTE: Block comment line describing behavior or context.
016620| src/components/listings/ListingCardCarousel.tsx:10:  * - Keyboard navigation when focused
016621| NOTE: Block comment line describing behavior or context.
016622| src/components/listings/ListingCardCarousel.tsx:11:  * - A11y: aria-labels, live region for index
016623| NOTE: Block comment line describing behavior or context.
016624| src/components/listings/ListingCardCarousel.tsx:12:  */
016625| NOTE: Block comment line describing behavior or context.
016626| src/components/listings/ListingCardCarousel.tsx:13: 
016627| NOTE: Blank line for visual separation.
016628| src/components/listings/ListingCardCarousel.tsx:14: import { useState, useRef, useCallback, useEffect } from "react";
016629| NOTE: Imports dependency for this module.
016630| src/components/listings/ListingCardCarousel.tsx:15: import Image from "next/image";
016631| NOTE: Imports dependency for this module.
016632| src/components/listings/ListingCardCarousel.tsx:16: import { ChevronLeft, ChevronRight } from "lucide-react";
016633| NOTE: Imports dependency for this module.
016634| src/components/listings/ListingCardCarousel.tsx:17: import { cn } from "@/lib/utils";
016635| NOTE: Imports dependency for this module.
016636| src/components/listings/ListingCardCarousel.tsx:18: 
016637| NOTE: Blank line for visual separation.
016638| src/components/listings/ListingCardCarousel.tsx:19: interface ListingCardCarouselProps {
016639| NOTE: Type declaration for search data contracts.
016640| src/components/listings/ListingCardCarousel.tsx:20:   images: string[];
016641| NOTE: Implementation detail supporting search page behavior.
016642| src/components/listings/ListingCardCarousel.tsx:21:   alt: string;
016643| NOTE: Implementation detail supporting search page behavior.
016644| src/components/listings/ListingCardCarousel.tsx:22:   /** Maximum images to display (default: 5) */
016645| NOTE: Block comment line describing behavior or context.
016646| src/components/listings/ListingCardCarousel.tsx:23:   maxImages?: number;
016647| NOTE: Implementation detail supporting search page behavior.
016648| src/components/listings/ListingCardCarousel.tsx:24:   /** Called when image fails to load */
016649| NOTE: Block comment line describing behavior or context.
016650| src/components/listings/ListingCardCarousel.tsx:25:   onImageError?: () => void;
016651| NOTE: Implementation detail supporting search page behavior.
016652| src/components/listings/ListingCardCarousel.tsx:26: }
016653| NOTE: Implementation detail supporting search page behavior.
016654| src/components/listings/ListingCardCarousel.tsx:27: 
016655| NOTE: Blank line for visual separation.
016656| src/components/listings/ListingCardCarousel.tsx:28: export default function ListingCardCarousel({
016657| NOTE: Exports main component for this module.
016658| src/components/listings/ListingCardCarousel.tsx:29:   images,
016659| NOTE: Implementation detail supporting search page behavior.
016660| src/components/listings/ListingCardCarousel.tsx:30:   alt,
016661| NOTE: Implementation detail supporting search page behavior.
016662| src/components/listings/ListingCardCarousel.tsx:31:   maxImages = 5,
016663| NOTE: Implementation detail supporting search page behavior.
016664| src/components/listings/ListingCardCarousel.tsx:32:   onImageError,
016665| NOTE: Implementation detail supporting search page behavior.
016666| src/components/listings/ListingCardCarousel.tsx:33: }: ListingCardCarouselProps) {
016667| NOTE: Implementation detail supporting search page behavior.
016668| src/components/listings/ListingCardCarousel.tsx:34:   // Limit images to maxImages
016669| NOTE: Line comment documents intent or constraints.
016670| src/components/listings/ListingCardCarousel.tsx:35:   const displayImages = images.slice(0, maxImages);
016671| NOTE: Local declaration used by search logic or UI.
016672| src/components/listings/ListingCardCarousel.tsx:36:   const totalImages = displayImages.length;
016673| NOTE: Local declaration used by search logic or UI.
016674| src/components/listings/ListingCardCarousel.tsx:37: 
016675| NOTE: Blank line for visual separation.
016676| src/components/listings/ListingCardCarousel.tsx:38:   const [currentIndex, setCurrentIndex] = useState(0);
016677| NOTE: Initializes local state for search UI behavior.
016678| src/components/listings/ListingCardCarousel.tsx:39:   const [isInteracting, setIsInteracting] = useState(false);
016679| NOTE: Initializes local state for search UI behavior.
016680| src/components/listings/ListingCardCarousel.tsx:40:   // Initialize with first two images if available (no useEffect needed)
016681| NOTE: Line comment documents intent or constraints.
016682| src/components/listings/ListingCardCarousel.tsx:41:   const [loadedImages, setLoadedImages] = useState<Set<number>>(
016683| NOTE: Initializes local state for search UI behavior.
016684| src/components/listings/ListingCardCarousel.tsx:42:     () => new Set(totalImages > 1 ? [0, 1] : [0]),
016685| NOTE: Implementation detail supporting search page behavior.
016686| src/components/listings/ListingCardCarousel.tsx:43:   );
016687| NOTE: Implementation detail supporting search page behavior.
016688| src/components/listings/ListingCardCarousel.tsx:44:   const scrollContainerRef = useRef<HTMLDivElement>(null);
016689| NOTE: Uses ref for stable mutable storage between renders.
016690| src/components/listings/ListingCardCarousel.tsx:45:   const interactionTimeoutRef = useRef<NodeJS.Timeout | null>(null);
016691| NOTE: Uses ref for stable mutable storage between renders.
016692| src/components/listings/ListingCardCarousel.tsx:46: 
016693| NOTE: Blank line for visual separation.
016694| src/components/listings/ListingCardCarousel.tsx:47:   // Track scroll position to update current index
016695| NOTE: Line comment documents intent or constraints.
016696| src/components/listings/ListingCardCarousel.tsx:48:   const handleScroll = useCallback(() => {
016697| NOTE: Memoizes callback to preserve references across renders.
016698| src/components/listings/ListingCardCarousel.tsx:49:     if (!scrollContainerRef.current) return;
016699| NOTE: Conditional logic controlling rendering or flow.
016700| src/components/listings/ListingCardCarousel.tsx:50:     const container = scrollContainerRef.current;
016701| NOTE: Local declaration used by search logic or UI.
016702| src/components/listings/ListingCardCarousel.tsx:51:     const scrollLeft = container.scrollLeft;
016703| NOTE: Local declaration used by search logic or UI.
016704| src/components/listings/ListingCardCarousel.tsx:52:     const itemWidth = container.offsetWidth;
016705| NOTE: Local declaration used by search logic or UI.
016706| src/components/listings/ListingCardCarousel.tsx:53:     const newIndex = Math.round(scrollLeft / itemWidth);
016707| NOTE: Local declaration used by search logic or UI.
016708| src/components/listings/ListingCardCarousel.tsx:54:     setCurrentIndex(Math.min(Math.max(0, newIndex), totalImages - 1));
016709| NOTE: Implementation detail supporting search page behavior.
016710| src/components/listings/ListingCardCarousel.tsx:55:   }, [totalImages]);
016711| NOTE: Implementation detail supporting search page behavior.
016712| src/components/listings/ListingCardCarousel.tsx:56: 
016713| NOTE: Blank line for visual separation.
016714| src/components/listings/ListingCardCarousel.tsx:57:   // Scroll to specific index
016715| NOTE: Line comment documents intent or constraints.
016716| src/components/listings/ListingCardCarousel.tsx:58:   const scrollToIndex = useCallback(
016717| NOTE: Memoizes callback to preserve references across renders.
016718| src/components/listings/ListingCardCarousel.tsx:59:     (index: number) => {
016719| NOTE: Implementation detail supporting search page behavior.
016720| src/components/listings/ListingCardCarousel.tsx:60:       if (!scrollContainerRef.current) return;
016721| NOTE: Conditional logic controlling rendering or flow.
016722| src/components/listings/ListingCardCarousel.tsx:61:       const container = scrollContainerRef.current;
016723| NOTE: Local declaration used by search logic or UI.
016724| src/components/listings/ListingCardCarousel.tsx:62:       const targetIndex = Math.min(Math.max(0, index), totalImages - 1);
016725| NOTE: Local declaration used by search logic or UI.
016726| src/components/listings/ListingCardCarousel.tsx:63:       container.scrollTo({
016727| NOTE: Implementation detail supporting search page behavior.
016728| src/components/listings/ListingCardCarousel.tsx:64:         left: targetIndex * container.offsetWidth,
016729| NOTE: Implementation detail supporting search page behavior.
016730| src/components/listings/ListingCardCarousel.tsx:65:         behavior: "smooth",
016731| NOTE: Implementation detail supporting search page behavior.
016732| src/components/listings/ListingCardCarousel.tsx:66:       });
016733| NOTE: Implementation detail supporting search page behavior.
016734| src/components/listings/ListingCardCarousel.tsx:67:       setCurrentIndex(targetIndex);
016735| NOTE: Implementation detail supporting search page behavior.
016736| src/components/listings/ListingCardCarousel.tsx:68: 
016737| NOTE: Blank line for visual separation.
016738| src/components/listings/ListingCardCarousel.tsx:69:       // Preload adjacent images
016739| NOTE: Line comment documents intent or constraints.
016740| src/components/listings/ListingCardCarousel.tsx:70:       setLoadedImages((prev) => {
016741| NOTE: Implementation detail supporting search page behavior.
016742| src/components/listings/ListingCardCarousel.tsx:71:         const newSet = new Set(prev);
016743| NOTE: Local declaration used by search logic or UI.
016744| src/components/listings/ListingCardCarousel.tsx:72:         newSet.add(targetIndex);
016745| NOTE: Implementation detail supporting search page behavior.
016746| src/components/listings/ListingCardCarousel.tsx:73:         if (targetIndex > 0) newSet.add(targetIndex - 1);
016747| NOTE: Conditional logic controlling rendering or flow.
016748| src/components/listings/ListingCardCarousel.tsx:74:         if (targetIndex < totalImages - 1) newSet.add(targetIndex + 1);
016749| NOTE: Conditional logic controlling rendering or flow.
016750| src/components/listings/ListingCardCarousel.tsx:75:         return newSet;
016751| NOTE: Return statement for component or helper output.
016752| src/components/listings/ListingCardCarousel.tsx:76:       });
016753| NOTE: Implementation detail supporting search page behavior.
016754| src/components/listings/ListingCardCarousel.tsx:77:     },
016755| NOTE: Implementation detail supporting search page behavior.
016756| src/components/listings/ListingCardCarousel.tsx:78:     [totalImages],
016757| NOTE: Implementation detail supporting search page behavior.
016758| src/components/listings/ListingCardCarousel.tsx:79:   );
016759| NOTE: Implementation detail supporting search page behavior.
016760| src/components/listings/ListingCardCarousel.tsx:80: 
016761| NOTE: Blank line for visual separation.
016762| src/components/listings/ListingCardCarousel.tsx:81:   // Navigate prev/next
016763| NOTE: Line comment documents intent or constraints.
016764| src/components/listings/ListingCardCarousel.tsx:82:   const goToPrev = useCallback(
016765| NOTE: Memoizes callback to preserve references across renders.
016766| src/components/listings/ListingCardCarousel.tsx:83:     (e: React.MouseEvent) => {
016767| NOTE: Implementation detail supporting search page behavior.
016768| src/components/listings/ListingCardCarousel.tsx:84:       e.preventDefault();
016769| NOTE: Implementation detail supporting search page behavior.
016770| src/components/listings/ListingCardCarousel.tsx:85:       e.stopPropagation();
016771| NOTE: Implementation detail supporting search page behavior.
016772| src/components/listings/ListingCardCarousel.tsx:86:       scrollToIndex(currentIndex - 1);
016773| NOTE: Implementation detail supporting search page behavior.
016774| src/components/listings/ListingCardCarousel.tsx:87:     },
016775| NOTE: Implementation detail supporting search page behavior.
016776| src/components/listings/ListingCardCarousel.tsx:88:     [currentIndex, scrollToIndex],
016777| NOTE: Implementation detail supporting search page behavior.
016778| src/components/listings/ListingCardCarousel.tsx:89:   );
016779| NOTE: Implementation detail supporting search page behavior.
016780| src/components/listings/ListingCardCarousel.tsx:90: 
016781| NOTE: Blank line for visual separation.
016782| src/components/listings/ListingCardCarousel.tsx:91:   const goToNext = useCallback(
016783| NOTE: Memoizes callback to preserve references across renders.
016784| src/components/listings/ListingCardCarousel.tsx:92:     (e: React.MouseEvent) => {
016785| NOTE: Implementation detail supporting search page behavior.
016786| src/components/listings/ListingCardCarousel.tsx:93:       e.preventDefault();
016787| NOTE: Implementation detail supporting search page behavior.
016788| src/components/listings/ListingCardCarousel.tsx:94:       e.stopPropagation();
016789| NOTE: Implementation detail supporting search page behavior.
016790| src/components/listings/ListingCardCarousel.tsx:95:       scrollToIndex(currentIndex + 1);
016791| NOTE: Implementation detail supporting search page behavior.
016792| src/components/listings/ListingCardCarousel.tsx:96:     },
016793| NOTE: Implementation detail supporting search page behavior.
016794| src/components/listings/ListingCardCarousel.tsx:97:     [currentIndex, scrollToIndex],
016795| NOTE: Implementation detail supporting search page behavior.
016796| src/components/listings/ListingCardCarousel.tsx:98:   );
016797| NOTE: Implementation detail supporting search page behavior.
016798| src/components/listings/ListingCardCarousel.tsx:99: 
016799| NOTE: Blank line for visual separation.
016800| src/components/listings/ListingCardCarousel.tsx:100:   // Handle keyboard navigation
016801| NOTE: Line comment documents intent or constraints.
016802| src/components/listings/ListingCardCarousel.tsx:101:   const handleKeyDown = useCallback(
016803| NOTE: Memoizes callback to preserve references across renders.
016804| src/components/listings/ListingCardCarousel.tsx:102:     (e: React.KeyboardEvent) => {
016805| NOTE: Implementation detail supporting search page behavior.
016806| src/components/listings/ListingCardCarousel.tsx:103:       if (e.key === "ArrowLeft") {
016807| NOTE: Conditional logic controlling rendering or flow.
016808| src/components/listings/ListingCardCarousel.tsx:104:         e.preventDefault();
016809| NOTE: Implementation detail supporting search page behavior.
016810| src/components/listings/ListingCardCarousel.tsx:105:         scrollToIndex(currentIndex - 1);
016811| NOTE: Implementation detail supporting search page behavior.
016812| src/components/listings/ListingCardCarousel.tsx:106:       } else if (e.key === "ArrowRight") {
016813| NOTE: Implementation detail supporting search page behavior.
016814| src/components/listings/ListingCardCarousel.tsx:107:         e.preventDefault();
016815| NOTE: Implementation detail supporting search page behavior.
016816| src/components/listings/ListingCardCarousel.tsx:108:         scrollToIndex(currentIndex + 1);
016817| NOTE: Implementation detail supporting search page behavior.
016818| src/components/listings/ListingCardCarousel.tsx:109:       }
016819| NOTE: Implementation detail supporting search page behavior.
016820| src/components/listings/ListingCardCarousel.tsx:110:     },
016821| NOTE: Implementation detail supporting search page behavior.
016822| src/components/listings/ListingCardCarousel.tsx:111:     [currentIndex, scrollToIndex],
016823| NOTE: Implementation detail supporting search page behavior.
016824| src/components/listings/ListingCardCarousel.tsx:112:   );
016825| NOTE: Implementation detail supporting search page behavior.
016826| src/components/listings/ListingCardCarousel.tsx:113: 
016827| NOTE: Blank line for visual separation.
016828| src/components/listings/ListingCardCarousel.tsx:114:   // Show controls on interaction (hover/touch)
016829| NOTE: Line comment documents intent or constraints.
016830| src/components/listings/ListingCardCarousel.tsx:115:   const handleInteractionStart = useCallback(() => {
016831| NOTE: Memoizes callback to preserve references across renders.
016832| src/components/listings/ListingCardCarousel.tsx:116:     setIsInteracting(true);
016833| NOTE: Implementation detail supporting search page behavior.
016834| src/components/listings/ListingCardCarousel.tsx:117:     // Clear any pending hide timeout
016835| NOTE: Line comment documents intent or constraints.
016836| src/components/listings/ListingCardCarousel.tsx:118:     if (interactionTimeoutRef.current) {
016837| NOTE: Conditional logic controlling rendering or flow.
016838| src/components/listings/ListingCardCarousel.tsx:119:       clearTimeout(interactionTimeoutRef.current);
016839| NOTE: Implementation detail supporting search page behavior.
016840| src/components/listings/ListingCardCarousel.tsx:120:       interactionTimeoutRef.current = null;
016841| NOTE: Implementation detail supporting search page behavior.
016842| src/components/listings/ListingCardCarousel.tsx:121:     }
016843| NOTE: Implementation detail supporting search page behavior.
016844| src/components/listings/ListingCardCarousel.tsx:122:   }, []);
016845| NOTE: Implementation detail supporting search page behavior.
016846| src/components/listings/ListingCardCarousel.tsx:123: 
016847| NOTE: Blank line for visual separation.
016848| src/components/listings/ListingCardCarousel.tsx:124:   const handleInteractionEnd = useCallback(() => {
016849| NOTE: Memoizes callback to preserve references across renders.
016850| src/components/listings/ListingCardCarousel.tsx:125:     // Delay hiding controls to allow clicking
016851| NOTE: Line comment documents intent or constraints.
016852| src/components/listings/ListingCardCarousel.tsx:126:     interactionTimeoutRef.current = setTimeout(() => {
016853| NOTE: Implementation detail supporting search page behavior.
016854| src/components/listings/ListingCardCarousel.tsx:127:       setIsInteracting(false);
016855| NOTE: Implementation detail supporting search page behavior.
016856| src/components/listings/ListingCardCarousel.tsx:128:     }, 150);
016857| NOTE: Implementation detail supporting search page behavior.
016858| src/components/listings/ListingCardCarousel.tsx:129:   }, []);
016859| NOTE: Implementation detail supporting search page behavior.
016860| src/components/listings/ListingCardCarousel.tsx:130: 
016861| NOTE: Blank line for visual separation.
016862| src/components/listings/ListingCardCarousel.tsx:131:   // Cleanup timeout on unmount
016863| NOTE: Line comment documents intent or constraints.
016864| src/components/listings/ListingCardCarousel.tsx:132:   useEffect(() => {
016865| NOTE: Defines side effect for syncing with external state.
016866| src/components/listings/ListingCardCarousel.tsx:133:     return () => {
016867| NOTE: Return statement for component or helper output.
016868| src/components/listings/ListingCardCarousel.tsx:134:       if (interactionTimeoutRef.current) {
016869| NOTE: Conditional logic controlling rendering or flow.
016870| src/components/listings/ListingCardCarousel.tsx:135:         clearTimeout(interactionTimeoutRef.current);
016871| NOTE: Implementation detail supporting search page behavior.
016872| src/components/listings/ListingCardCarousel.tsx:136:       }
016873| NOTE: Implementation detail supporting search page behavior.
016874| src/components/listings/ListingCardCarousel.tsx:137:     };
016875| NOTE: Implementation detail supporting search page behavior.
016876| src/components/listings/ListingCardCarousel.tsx:138:   }, []);
016877| NOTE: Implementation detail supporting search page behavior.
016878| src/components/listings/ListingCardCarousel.tsx:139: 
016879| NOTE: Blank line for visual separation.
016880| src/components/listings/ListingCardCarousel.tsx:140:   // Single image - no carousel needed
016881| NOTE: Line comment documents intent or constraints.
016882| src/components/listings/ListingCardCarousel.tsx:141:   if (totalImages <= 1) {
016883| NOTE: Conditional logic controlling rendering or flow.
016884| src/components/listings/ListingCardCarousel.tsx:142:     return (
016885| NOTE: Return statement for component or helper output.
016886| src/components/listings/ListingCardCarousel.tsx:143:       <Image
016887| NOTE: JSX markup for search UI.
016888| src/components/listings/ListingCardCarousel.tsx:144:         src={displayImages[0]}
016889| NOTE: Implementation detail supporting search page behavior.
016890| src/components/listings/ListingCardCarousel.tsx:145:         alt={alt}
016891| NOTE: Implementation detail supporting search page behavior.
016892| src/components/listings/ListingCardCarousel.tsx:146:         fill
016893| NOTE: Implementation detail supporting search page behavior.
016894| src/components/listings/ListingCardCarousel.tsx:147:         className="object-cover group-hover:scale-105 transition-transform duration-normal ease-out"
016895| NOTE: Tailwind classes define layout and styling.
016896| src/components/listings/ListingCardCarousel.tsx:148:         sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
016897| NOTE: Implementation detail supporting search page behavior.
016898| src/components/listings/ListingCardCarousel.tsx:149:         onError={onImageError}
016899| NOTE: Implementation detail supporting search page behavior.
016900| src/components/listings/ListingCardCarousel.tsx:150:         loading="lazy"
016901| NOTE: Implementation detail supporting search page behavior.
016902| src/components/listings/ListingCardCarousel.tsx:151:       />
016903| NOTE: Implementation detail supporting search page behavior.
016904| src/components/listings/ListingCardCarousel.tsx:152:     );
016905| NOTE: Implementation detail supporting search page behavior.
016906| src/components/listings/ListingCardCarousel.tsx:153:   }
016907| NOTE: Implementation detail supporting search page behavior.
016908| src/components/listings/ListingCardCarousel.tsx:154: 
016909| NOTE: Blank line for visual separation.
016910| src/components/listings/ListingCardCarousel.tsx:155:   return (
016911| NOTE: Return statement for component or helper output.
016912| src/components/listings/ListingCardCarousel.tsx:156:     <div
016913| NOTE: JSX markup for search UI.
016914| src/components/listings/ListingCardCarousel.tsx:157:       className="relative w-full h-full"
016915| NOTE: Tailwind classes define layout and styling.
016916| src/components/listings/ListingCardCarousel.tsx:158:       onMouseEnter={handleInteractionStart}
016917| NOTE: Implementation detail supporting search page behavior.
016918| src/components/listings/ListingCardCarousel.tsx:159:       onMouseLeave={handleInteractionEnd}
016919| NOTE: Implementation detail supporting search page behavior.
016920| src/components/listings/ListingCardCarousel.tsx:160:       onTouchStart={handleInteractionStart}
016921| NOTE: Implementation detail supporting search page behavior.
016922| src/components/listings/ListingCardCarousel.tsx:161:       onTouchEnd={handleInteractionEnd}
016923| NOTE: Implementation detail supporting search page behavior.
016924| src/components/listings/ListingCardCarousel.tsx:162:       onKeyDown={handleKeyDown}
016925| NOTE: Implementation detail supporting search page behavior.
016926| src/components/listings/ListingCardCarousel.tsx:163:       tabIndex={0}
016927| NOTE: Implementation detail supporting search page behavior.
016928| src/components/listings/ListingCardCarousel.tsx:164:       role="region"
016929| NOTE: Implementation detail supporting search page behavior.
016930| src/components/listings/ListingCardCarousel.tsx:165:       aria-label={`Image carousel for ${alt}`}
016931| NOTE: Accessibility attribute for screen readers.
016932| src/components/listings/ListingCardCarousel.tsx:166:       aria-roledescription="carousel"
016933| NOTE: Accessibility attribute for screen readers.
016934| src/components/listings/ListingCardCarousel.tsx:167:     >
016935| NOTE: Implementation detail supporting search page behavior.
016936| src/components/listings/ListingCardCarousel.tsx:168:       {/* Scroll container */}
016937| NOTE: Implementation detail supporting search page behavior.
016938| src/components/listings/ListingCardCarousel.tsx:169:       <div
016939| NOTE: JSX markup for search UI.
016940| src/components/listings/ListingCardCarousel.tsx:170:         ref={scrollContainerRef}
016941| NOTE: Implementation detail supporting search page behavior.
016942| src/components/listings/ListingCardCarousel.tsx:171:         className="flex w-full h-full snap-x snap-mandatory overflow-x-auto scrollbar-hide"
016943| NOTE: Tailwind classes define layout and styling.
016944| src/components/listings/ListingCardCarousel.tsx:172:         onScroll={handleScroll}
016945| NOTE: Implementation detail supporting search page behavior.
016946| src/components/listings/ListingCardCarousel.tsx:173:         style={{ scrollSnapType: "x mandatory" }}
016947| NOTE: Implementation detail supporting search page behavior.
016948| src/components/listings/ListingCardCarousel.tsx:174:       >
016949| NOTE: Implementation detail supporting search page behavior.
016950| src/components/listings/ListingCardCarousel.tsx:175:         {displayImages.map((src, index) => (
016951| NOTE: Implementation detail supporting search page behavior.
016952| src/components/listings/ListingCardCarousel.tsx:176:           <div
016953| NOTE: JSX markup for search UI.
016954| src/components/listings/ListingCardCarousel.tsx:177:             key={index}
016955| NOTE: Implementation detail supporting search page behavior.
016956| src/components/listings/ListingCardCarousel.tsx:178:             className="relative shrink-0 w-full h-full snap-center"
016957| NOTE: Tailwind classes define layout and styling.
016958| src/components/listings/ListingCardCarousel.tsx:179:             role="group"
016959| NOTE: Implementation detail supporting search page behavior.
016960| src/components/listings/ListingCardCarousel.tsx:180:             aria-roledescription="slide"
016961| NOTE: Accessibility attribute for screen readers.
016962| src/components/listings/ListingCardCarousel.tsx:181:             aria-label={`Image ${index + 1} of ${totalImages}`}
016963| NOTE: Accessibility attribute for screen readers.
016964| src/components/listings/ListingCardCarousel.tsx:182:           >
016965| NOTE: Implementation detail supporting search page behavior.
016966| src/components/listings/ListingCardCarousel.tsx:183:             {/* Only load images that are visible or adjacent */}
016967| NOTE: Implementation detail supporting search page behavior.
016968| src/components/listings/ListingCardCarousel.tsx:184:             {loadedImages.has(index) || Math.abs(index - currentIndex) <= 1 ? (
016969| NOTE: Implementation detail supporting search page behavior.
016970| src/components/listings/ListingCardCarousel.tsx:185:               <Image
016971| NOTE: JSX markup for search UI.
016972| src/components/listings/ListingCardCarousel.tsx:186:                 src={src}
016973| NOTE: Implementation detail supporting search page behavior.
016974| src/components/listings/ListingCardCarousel.tsx:187:                 alt={`${alt} - Image ${index + 1}`}
016975| NOTE: Implementation detail supporting search page behavior.
016976| src/components/listings/ListingCardCarousel.tsx:188:                 fill
016977| NOTE: Implementation detail supporting search page behavior.
016978| src/components/listings/ListingCardCarousel.tsx:189:                 className="object-cover"
016979| NOTE: Tailwind classes define layout and styling.
016980| src/components/listings/ListingCardCarousel.tsx:190:                 sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
016981| NOTE: Implementation detail supporting search page behavior.
016982| src/components/listings/ListingCardCarousel.tsx:191:                 onError={index === 0 ? onImageError : undefined}
016983| NOTE: Implementation detail supporting search page behavior.
016984| src/components/listings/ListingCardCarousel.tsx:192:                 loading={index === 0 ? "eager" : "lazy"}
016985| NOTE: Implementation detail supporting search page behavior.
016986| src/components/listings/ListingCardCarousel.tsx:193:                 priority={index === 0}
016987| NOTE: Implementation detail supporting search page behavior.
016988| src/components/listings/ListingCardCarousel.tsx:194:               />
016989| NOTE: Implementation detail supporting search page behavior.
016990| src/components/listings/ListingCardCarousel.tsx:195:             ) : (
016991| NOTE: Implementation detail supporting search page behavior.
016992| src/components/listings/ListingCardCarousel.tsx:196:               <div className="w-full h-full bg-zinc-200 dark:bg-zinc-700 animate-pulse" />
016993| NOTE: Tailwind classes define layout and styling.
016994| src/components/listings/ListingCardCarousel.tsx:197:             )}
016995| NOTE: Implementation detail supporting search page behavior.
016996| src/components/listings/ListingCardCarousel.tsx:198:           </div>
016997| NOTE: JSX markup for search UI.
016998| src/components/listings/ListingCardCarousel.tsx:199:         ))}
016999| NOTE: Implementation detail supporting search page behavior.
017000| src/components/listings/ListingCardCarousel.tsx:200:       </div>
017001| NOTE: JSX markup for search UI.
017002| src/components/listings/ListingCardCarousel.tsx:201: 
017003| NOTE: Blank line for visual separation.
017004| src/components/listings/ListingCardCarousel.tsx:202:       {/* Navigation buttons - visible on hover/touch */}
017005| NOTE: Implementation detail supporting search page behavior.
017006| src/components/listings/ListingCardCarousel.tsx:203:       <div
017007| NOTE: JSX markup for search UI.
017008| src/components/listings/ListingCardCarousel.tsx:204:         className={cn(
017009| NOTE: Tailwind classes define layout and styling.
017010| src/components/listings/ListingCardCarousel.tsx:205:           "absolute inset-0 pointer-events-none transition-opacity duration-200",
017011| NOTE: Implementation detail supporting search page behavior.
017012| src/components/listings/ListingCardCarousel.tsx:206:           isInteracting ? "opacity-100" : "opacity-0",
017013| NOTE: Implementation detail supporting search page behavior.
017014| src/components/listings/ListingCardCarousel.tsx:207:         )}
017015| NOTE: Implementation detail supporting search page behavior.
017016| src/components/listings/ListingCardCarousel.tsx:208:       >
017017| NOTE: Implementation detail supporting search page behavior.
017018| src/components/listings/ListingCardCarousel.tsx:209:         {/* Previous button */}
017019| NOTE: Implementation detail supporting search page behavior.
017020| src/components/listings/ListingCardCarousel.tsx:210:         {currentIndex > 0 && (
017021| NOTE: Implementation detail supporting search page behavior.
017022| src/components/listings/ListingCardCarousel.tsx:211:           <button
017023| NOTE: JSX markup for search UI.
017024| src/components/listings/ListingCardCarousel.tsx:212:             type="button"
017025| NOTE: Implementation detail supporting search page behavior.
017026| src/components/listings/ListingCardCarousel.tsx:213:             onClick={goToPrev}
017027| NOTE: Implementation detail supporting search page behavior.
017028| src/components/listings/ListingCardCarousel.tsx:214:             className="absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/90 dark:bg-zinc-800/90 shadow-md flex items-center justify-center pointer-events-auto hover:bg-white dark:hover:bg-zinc-700 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
017029| NOTE: Tailwind classes define layout and styling.
017030| src/components/listings/ListingCardCarousel.tsx:215:             aria-label="Previous image"
017031| NOTE: Accessibility attribute for screen readers.
017032| src/components/listings/ListingCardCarousel.tsx:216:           >
017033| NOTE: Implementation detail supporting search page behavior.
017034| src/components/listings/ListingCardCarousel.tsx:217:             <ChevronLeft className="w-5 h-5 text-zinc-700 dark:text-zinc-200" />
017035| NOTE: Tailwind classes define layout and styling.
017036| src/components/listings/ListingCardCarousel.tsx:218:           </button>
017037| NOTE: JSX markup for search UI.
017038| src/components/listings/ListingCardCarousel.tsx:219:         )}
017039| NOTE: Implementation detail supporting search page behavior.
017040| src/components/listings/ListingCardCarousel.tsx:220: 
017041| NOTE: Blank line for visual separation.
017042| src/components/listings/ListingCardCarousel.tsx:221:         {/* Next button */}
017043| NOTE: Implementation detail supporting search page behavior.
017044| src/components/listings/ListingCardCarousel.tsx:222:         {currentIndex < totalImages - 1 && (
017045| NOTE: Implementation detail supporting search page behavior.
017046| src/components/listings/ListingCardCarousel.tsx:223:           <button
017047| NOTE: JSX markup for search UI.
017048| src/components/listings/ListingCardCarousel.tsx:224:             type="button"
017049| NOTE: Implementation detail supporting search page behavior.
017050| src/components/listings/ListingCardCarousel.tsx:225:             onClick={goToNext}
017051| NOTE: Implementation detail supporting search page behavior.
017052| src/components/listings/ListingCardCarousel.tsx:226:             className="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/90 dark:bg-zinc-800/90 shadow-md flex items-center justify-center pointer-events-auto hover:bg-white dark:hover:bg-zinc-700 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
017053| NOTE: Tailwind classes define layout and styling.
017054| src/components/listings/ListingCardCarousel.tsx:227:             aria-label="Next image"
017055| NOTE: Accessibility attribute for screen readers.
017056| src/components/listings/ListingCardCarousel.tsx:228:           >
017057| NOTE: Implementation detail supporting search page behavior.
017058| src/components/listings/ListingCardCarousel.tsx:229:             <ChevronRight className="w-5 h-5 text-zinc-700 dark:text-zinc-200" />
017059| NOTE: Tailwind classes define layout and styling.
017060| src/components/listings/ListingCardCarousel.tsx:230:           </button>
017061| NOTE: JSX markup for search UI.
017062| src/components/listings/ListingCardCarousel.tsx:231:         )}
017063| NOTE: Implementation detail supporting search page behavior.
017064| src/components/listings/ListingCardCarousel.tsx:232:       </div>
017065| NOTE: JSX markup for search UI.
017066| src/components/listings/ListingCardCarousel.tsx:233: 
017067| NOTE: Blank line for visual separation.
017068| src/components/listings/ListingCardCarousel.tsx:234:       {/* Dots indicator */}
017069| NOTE: Implementation detail supporting search page behavior.
017070| src/components/listings/ListingCardCarousel.tsx:235:       <div
017071| NOTE: JSX markup for search UI.
017072| src/components/listings/ListingCardCarousel.tsx:236:         className="absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5 z-10"
017073| NOTE: Tailwind classes define layout and styling.
017074| src/components/listings/ListingCardCarousel.tsx:237:         role="tablist"
017075| NOTE: Implementation detail supporting search page behavior.
017076| src/components/listings/ListingCardCarousel.tsx:238:         aria-label="Image navigation"
017077| NOTE: Accessibility attribute for screen readers.
017078| src/components/listings/ListingCardCarousel.tsx:239:       >
017079| NOTE: Implementation detail supporting search page behavior.
017080| src/components/listings/ListingCardCarousel.tsx:240:         {displayImages.map((_, index) => (
017081| NOTE: Implementation detail supporting search page behavior.
017082| src/components/listings/ListingCardCarousel.tsx:241:           <button
017083| NOTE: JSX markup for search UI.
017084| src/components/listings/ListingCardCarousel.tsx:242:             key={index}
017085| NOTE: Implementation detail supporting search page behavior.
017086| src/components/listings/ListingCardCarousel.tsx:243:             type="button"
017087| NOTE: Implementation detail supporting search page behavior.
017088| src/components/listings/ListingCardCarousel.tsx:244:             onClick={(e) => {
017089| NOTE: Implementation detail supporting search page behavior.
017090| src/components/listings/ListingCardCarousel.tsx:245:               e.preventDefault();
017091| NOTE: Implementation detail supporting search page behavior.
017092| src/components/listings/ListingCardCarousel.tsx:246:               e.stopPropagation();
017093| NOTE: Implementation detail supporting search page behavior.
017094| src/components/listings/ListingCardCarousel.tsx:247:               scrollToIndex(index);
017095| NOTE: Implementation detail supporting search page behavior.
017096| src/components/listings/ListingCardCarousel.tsx:248:             }}
017097| NOTE: Implementation detail supporting search page behavior.
017098| src/components/listings/ListingCardCarousel.tsx:249:             className={cn(
017099| NOTE: Tailwind classes define layout and styling.
017100| src/components/listings/ListingCardCarousel.tsx:250:               "w-1.5 h-1.5 rounded-full transition-all duration-200",
017101| NOTE: Implementation detail supporting search page behavior.
017102| src/components/listings/ListingCardCarousel.tsx:251:               index === currentIndex
017103| NOTE: Implementation detail supporting search page behavior.
017104| src/components/listings/ListingCardCarousel.tsx:252:                 ? "bg-white w-3 shadow-sm"
017105| NOTE: Implementation detail supporting search page behavior.
017106| src/components/listings/ListingCardCarousel.tsx:253:                 : "bg-white/60 hover:bg-white/80",
017107| NOTE: Implementation detail supporting search page behavior.
017108| src/components/listings/ListingCardCarousel.tsx:254:             )}
017109| NOTE: Implementation detail supporting search page behavior.
017110| src/components/listings/ListingCardCarousel.tsx:255:             role="tab"
017111| NOTE: Implementation detail supporting search page behavior.
017112| src/components/listings/ListingCardCarousel.tsx:256:             aria-selected={index === currentIndex}
017113| NOTE: Accessibility attribute for screen readers.
017114| src/components/listings/ListingCardCarousel.tsx:257:             aria-label={`Go to image ${index + 1}`}
017115| NOTE: Accessibility attribute for screen readers.
017116| src/components/listings/ListingCardCarousel.tsx:258:           />
017117| NOTE: Implementation detail supporting search page behavior.
017118| src/components/listings/ListingCardCarousel.tsx:259:         ))}
017119| NOTE: Implementation detail supporting search page behavior.
017120| src/components/listings/ListingCardCarousel.tsx:260:       </div>
017121| NOTE: JSX markup for search UI.
017122| src/components/listings/ListingCardCarousel.tsx:261: 
017123| NOTE: Blank line for visual separation.
017124| src/components/listings/ListingCardCarousel.tsx:262:       {/* Live region for screen readers */}
017125| NOTE: Implementation detail supporting search page behavior.
017126| src/components/listings/ListingCardCarousel.tsx:263:       <div className="sr-only" aria-live="polite" aria-atomic="true">
017127| NOTE: Tailwind classes define layout and styling.
017128| src/components/listings/ListingCardCarousel.tsx:264:         Image {currentIndex + 1} of {totalImages}
017129| NOTE: Implementation detail supporting search page behavior.
017130| src/components/listings/ListingCardCarousel.tsx:265:       </div>
017131| NOTE: JSX markup for search UI.
017132| src/components/listings/ListingCardCarousel.tsx:266:     </div>
017133| NOTE: JSX markup for search UI.
017134| src/components/listings/ListingCardCarousel.tsx:267:   );
017135| NOTE: Implementation detail supporting search page behavior.
017136| src/components/listings/ListingCardCarousel.tsx:268: }
017137| NOTE: Implementation detail supporting search page behavior.
017138| FILE END: src/components/listings/ListingCardCarousel.tsx
017139| 
017140| FILE START: src/components/listings/NearMatchSeparator.tsx
017141| FILE ROLE: Auto-discovered dependency in search page graph.
017142| src/components/listings/NearMatchSeparator.tsx:1: "use client";
017143| NOTE: Implementation detail supporting search page behavior.
017144| src/components/listings/NearMatchSeparator.tsx:2: 
017145| NOTE: Blank line for visual separation.
017146| src/components/listings/NearMatchSeparator.tsx:3: import { AlertCircle } from "lucide-react";
017147| NOTE: Imports dependency for this module.
017148| src/components/listings/NearMatchSeparator.tsx:4: 
017149| NOTE: Blank line for visual separation.
017150| src/components/listings/NearMatchSeparator.tsx:5: interface NearMatchSeparatorProps {
017151| NOTE: Type declaration for search data contracts.
017152| src/components/listings/NearMatchSeparator.tsx:6:   nearMatchCount: number;
017153| NOTE: Implementation detail supporting search page behavior.
017154| src/components/listings/NearMatchSeparator.tsx:7: }
017155| NOTE: Implementation detail supporting search page behavior.
017156| src/components/listings/NearMatchSeparator.tsx:8: 
017157| NOTE: Blank line for visual separation.
017158| src/components/listings/NearMatchSeparator.tsx:9: /**
017159| NOTE: Block comment line describing behavior or context.
017160| src/components/listings/NearMatchSeparator.tsx:10:  * Visual separator between exact matches and near-match listings.
017161| NOTE: Block comment line describing behavior or context.
017162| src/components/listings/NearMatchSeparator.tsx:11:  * Displays a header explaining that the following listings are
017163| NOTE: Block comment line describing behavior or context.
017164| src/components/listings/NearMatchSeparator.tsx:12:  * slightly outside the user's filter criteria.
017165| NOTE: Block comment line describing behavior or context.
017166| src/components/listings/NearMatchSeparator.tsx:13:  */
017167| NOTE: Block comment line describing behavior or context.
017168| src/components/listings/NearMatchSeparator.tsx:14: export default function NearMatchSeparator({
017169| NOTE: Exports main component for this module.
017170| src/components/listings/NearMatchSeparator.tsx:15:   nearMatchCount,
017171| NOTE: Implementation detail supporting search page behavior.
017172| src/components/listings/NearMatchSeparator.tsx:16: }: NearMatchSeparatorProps) {
017173| NOTE: Implementation detail supporting search page behavior.
017174| src/components/listings/NearMatchSeparator.tsx:17:   return (
017175| NOTE: Return statement for component or helper output.
017176| src/components/listings/NearMatchSeparator.tsx:18:     <div
017177| NOTE: JSX markup for search UI.
017178| src/components/listings/NearMatchSeparator.tsx:19:       className="col-span-full flex items-center gap-3 py-4 my-2"
017179| NOTE: Tailwind classes define layout and styling.
017180| src/components/listings/NearMatchSeparator.tsx:20:       role="separator"
017181| NOTE: Implementation detail supporting search page behavior.
017182| src/components/listings/NearMatchSeparator.tsx:21:       aria-label={`${nearMatchCount} near match ${nearMatchCount === 1 ? "listing" : "listings"}`}
017183| NOTE: Accessibility attribute for screen readers.
017184| src/components/listings/NearMatchSeparator.tsx:22:     >
017185| NOTE: Implementation detail supporting search page behavior.
017186| src/components/listings/NearMatchSeparator.tsx:23:       {/* Decorative line */}
017187| NOTE: Implementation detail supporting search page behavior.
017188| src/components/listings/NearMatchSeparator.tsx:24:       <div className="flex-1 border-t-2 border-dashed border-amber-300 dark:border-amber-600" />
017189| NOTE: Tailwind classes define layout and styling.
017190| src/components/listings/NearMatchSeparator.tsx:25: 
017191| NOTE: Blank line for visual separation.
017192| src/components/listings/NearMatchSeparator.tsx:26:       {/* Badge */}
017193| NOTE: Implementation detail supporting search page behavior.
017194| src/components/listings/NearMatchSeparator.tsx:27:       <div className="flex items-center gap-2 px-4 py-2 rounded-full bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700">
017195| NOTE: Tailwind classes define layout and styling.
017196| src/components/listings/NearMatchSeparator.tsx:28:         <AlertCircle className="w-4 h-4 text-amber-600 dark:text-amber-400" />
017197| NOTE: Tailwind classes define layout and styling.
017198| src/components/listings/NearMatchSeparator.tsx:29:         <span className="text-sm font-medium text-amber-700 dark:text-amber-300">
017199| NOTE: Tailwind classes define layout and styling.
017200| src/components/listings/NearMatchSeparator.tsx:30:           {nearMatchCount} near {nearMatchCount === 1 ? "match" : "matches"}
017201| NOTE: Implementation detail supporting search page behavior.
017202| src/components/listings/NearMatchSeparator.tsx:31:         </span>
017203| NOTE: JSX markup for search UI.
017204| src/components/listings/NearMatchSeparator.tsx:32:       </div>
017205| NOTE: JSX markup for search UI.
017206| src/components/listings/NearMatchSeparator.tsx:33: 
017207| NOTE: Blank line for visual separation.
017208| src/components/listings/NearMatchSeparator.tsx:34:       {/* Decorative line */}
017209| NOTE: Implementation detail supporting search page behavior.
017210| src/components/listings/NearMatchSeparator.tsx:35:       <div className="flex-1 border-t-2 border-dashed border-amber-300 dark:border-amber-600" />
017211| NOTE: Tailwind classes define layout and styling.
017212| src/components/listings/NearMatchSeparator.tsx:36:     </div>
017213| NOTE: JSX markup for search UI.
017214| src/components/listings/NearMatchSeparator.tsx:37:   );
017215| NOTE: Implementation detail supporting search page behavior.
017216| src/components/listings/NearMatchSeparator.tsx:38: }
017217| NOTE: Implementation detail supporting search page behavior.
017218| FILE END: src/components/listings/NearMatchSeparator.tsx
017219| 
017220| FILE START: src/components/map/MapMovedBanner.tsx
017221| FILE ROLE: Auto-discovered dependency in search page graph.
017222| src/components/map/MapMovedBanner.tsx:1: "use client";
017223| NOTE: Implementation detail supporting search page behavior.
017224| src/components/map/MapMovedBanner.tsx:2: 
017225| NOTE: Blank line for visual separation.
017226| src/components/map/MapMovedBanner.tsx:3: /**
017227| NOTE: Block comment line describing behavior or context.
017228| src/components/map/MapMovedBanner.tsx:4:  * MapMovedBanner - Reusable banner shown when map bounds differ from search results
017229| NOTE: Block comment line describing behavior or context.
017230| src/components/map/MapMovedBanner.tsx:5:  *
017231| NOTE: Block comment line describing behavior or context.
017232| src/components/map/MapMovedBanner.tsx:6:  * Shows in two variants:
017233| NOTE: Block comment line describing behavior or context.
017234| src/components/map/MapMovedBanner.tsx:7:  * - 'map': Floating overlay on the map (centered, pill-shaped)
017235| NOTE: Block comment line describing behavior or context.
017236| src/components/map/MapMovedBanner.tsx:8:  * - 'list': Inline banner above list results (full-width, subtle)
017237| NOTE: Block comment line describing behavior or context.
017238| src/components/map/MapMovedBanner.tsx:9:  *
017239| NOTE: Block comment line describing behavior or context.
017240| src/components/map/MapMovedBanner.tsx:10:  * Supports two modes:
017241| NOTE: Block comment line describing behavior or context.
017242| src/components/map/MapMovedBanner.tsx:11:  * - Regular: Map moved, results not updated
017243| NOTE: Block comment line describing behavior or context.
017244| src/components/map/MapMovedBanner.tsx:12:  * - Location conflict: Map panned away from search location
017245| NOTE: Block comment line describing behavior or context.
017246| src/components/map/MapMovedBanner.tsx:13:  *
017247| NOTE: Block comment line describing behavior or context.
017248| src/components/map/MapMovedBanner.tsx:14:  * Design inspired by Google Maps "Search this area" pattern.
017249| NOTE: Block comment line describing behavior or context.
017250| src/components/map/MapMovedBanner.tsx:15:  */
017251| NOTE: Block comment line describing behavior or context.
017252| src/components/map/MapMovedBanner.tsx:16: 
017253| NOTE: Blank line for visual separation.
017254| src/components/map/MapMovedBanner.tsx:17: import { MapPin, RotateCcw, AlertTriangle } from "lucide-react";
017255| NOTE: Imports dependency for this module.
017256| src/components/map/MapMovedBanner.tsx:18: 
017257| NOTE: Blank line for visual separation.
017258| src/components/map/MapMovedBanner.tsx:19: interface MapMovedBannerProps {
017259| NOTE: Type declaration for search data contracts.
017260| src/components/map/MapMovedBanner.tsx:20:   /** Display variant */
017261| NOTE: Block comment line describing behavior or context.
017262| src/components/map/MapMovedBanner.tsx:21:   variant: "map" | "list";
017263| NOTE: Implementation detail supporting search page behavior.
017264| src/components/map/MapMovedBanner.tsx:22:   /** Handler for "Search this area" action */
017265| NOTE: Block comment line describing behavior or context.
017266| src/components/map/MapMovedBanner.tsx:23:   onSearch: () => void;
017267| NOTE: Implementation detail supporting search page behavior.
017268| src/components/map/MapMovedBanner.tsx:24:   /** Handler for "Reset view" action */
017269| NOTE: Block comment line describing behavior or context.
017270| src/components/map/MapMovedBanner.tsx:25:   onReset: () => void;
017271| NOTE: Implementation detail supporting search page behavior.
017272| src/components/map/MapMovedBanner.tsx:26:   /** Whether this is a location conflict (map panned away from search location) */
017273| NOTE: Block comment line describing behavior or context.
017274| src/components/map/MapMovedBanner.tsx:27:   isLocationConflict?: boolean;
017275| NOTE: Implementation detail supporting search page behavior.
017276| src/components/map/MapMovedBanner.tsx:28:   /** The location name (for conflict message) */
017277| NOTE: Block comment line describing behavior or context.
017278| src/components/map/MapMovedBanner.tsx:29:   locationName?: string | null;
017279| NOTE: Implementation detail supporting search page behavior.
017280| src/components/map/MapMovedBanner.tsx:30: }
017281| NOTE: Implementation detail supporting search page behavior.
017282| src/components/map/MapMovedBanner.tsx:31: 
017283| NOTE: Blank line for visual separation.
017284| src/components/map/MapMovedBanner.tsx:32: export function MapMovedBanner({
017285| NOTE: Exports helper or component function.
017286| src/components/map/MapMovedBanner.tsx:33:   variant,
017287| NOTE: Implementation detail supporting search page behavior.
017288| src/components/map/MapMovedBanner.tsx:34:   onSearch,
017289| NOTE: Implementation detail supporting search page behavior.
017290| src/components/map/MapMovedBanner.tsx:35:   onReset,
017291| NOTE: Implementation detail supporting search page behavior.
017292| src/components/map/MapMovedBanner.tsx:36:   isLocationConflict = false,
017293| NOTE: Implementation detail supporting search page behavior.
017294| src/components/map/MapMovedBanner.tsx:37:   locationName,
017295| NOTE: Implementation detail supporting search page behavior.
017296| src/components/map/MapMovedBanner.tsx:38: }: MapMovedBannerProps) {
017297| NOTE: Implementation detail supporting search page behavior.
017298| src/components/map/MapMovedBanner.tsx:39:   // Determine display text based on conflict state
017299| NOTE: Line comment documents intent or constraints.
017300| src/components/map/MapMovedBanner.tsx:40:   const displayLocationName = locationName || "your search";
017301| NOTE: Local declaration used by search logic or UI.
017302| src/components/map/MapMovedBanner.tsx:41:   const conflictMessage = `Map doesn't include "${displayLocationName}"`;
017303| NOTE: Local declaration used by search logic or UI.
017304| src/components/map/MapMovedBanner.tsx:42:   const regularMessage = "Map moved \u2014 results not updated";
017305| NOTE: Local declaration used by search logic or UI.
017306| src/components/map/MapMovedBanner.tsx:43:   const resetLabel = isLocationConflict
017307| NOTE: Local declaration used by search logic or UI.
017308| src/components/map/MapMovedBanner.tsx:44:     ? `Back to ${displayLocationName}`
017309| NOTE: Implementation detail supporting search page behavior.
017310| src/components/map/MapMovedBanner.tsx:45:     : "Reset map view";
017311| NOTE: Implementation detail supporting search page behavior.
017312| src/components/map/MapMovedBanner.tsx:46: 
017313| NOTE: Blank line for visual separation.
017314| src/components/map/MapMovedBanner.tsx:47:   if (variant === "map") {
017315| NOTE: Conditional logic controlling rendering or flow.
017316| src/components/map/MapMovedBanner.tsx:48:     // Location conflict variant - more prominent styling
017317| NOTE: Line comment documents intent or constraints.
017318| src/components/map/MapMovedBanner.tsx:49:     if (isLocationConflict) {
017319| NOTE: Conditional logic controlling rendering or flow.
017320| src/components/map/MapMovedBanner.tsx:50:       return (
017321| NOTE: Return statement for component or helper output.
017322| src/components/map/MapMovedBanner.tsx:51:         <div className="absolute top-16 left-1/2 -translate-x-1/2 z-10">
017323| NOTE: Tailwind classes define layout and styling.
017324| src/components/map/MapMovedBanner.tsx:52:           <div className="flex flex-col items-center gap-2 bg-white dark:bg-zinc-900 rounded-xl shadow-lg px-4 py-3 border border-amber-200 dark:border-amber-800/50">
017325| NOTE: Tailwind classes define layout and styling.
017326| src/components/map/MapMovedBanner.tsx:53:             <div className="flex items-center gap-2 text-sm text-amber-700 dark:text-amber-300">
017327| NOTE: Tailwind classes define layout and styling.
017328| src/components/map/MapMovedBanner.tsx:54:               <AlertTriangle className="w-4 h-4" />
017329| NOTE: Tailwind classes define layout and styling.
017330| src/components/map/MapMovedBanner.tsx:55:               <span className="font-medium">{conflictMessage}</span>
017331| NOTE: Tailwind classes define layout and styling.
017332| src/components/map/MapMovedBanner.tsx:56:             </div>
017333| NOTE: JSX markup for search UI.
017334| src/components/map/MapMovedBanner.tsx:57:             <div className="flex items-center gap-2">
017335| NOTE: Tailwind classes define layout and styling.
017336| src/components/map/MapMovedBanner.tsx:58:               <button
017337| NOTE: JSX markup for search UI.
017338| src/components/map/MapMovedBanner.tsx:59:                 onClick={onSearch}
017339| NOTE: Implementation detail supporting search page behavior.
017340| src/components/map/MapMovedBanner.tsx:60:                 className="px-3 py-1.5 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-full text-xs font-medium shadow hover:bg-zinc-800 dark:hover:bg-zinc-100 transition-colors"
017341| NOTE: Tailwind classes define layout and styling.
017342| src/components/map/MapMovedBanner.tsx:61:               >
017343| NOTE: Implementation detail supporting search page behavior.
017344| src/components/map/MapMovedBanner.tsx:62:                 Search in map area
017345| NOTE: Implementation detail supporting search page behavior.
017346| src/components/map/MapMovedBanner.tsx:63:               </button>
017347| NOTE: JSX markup for search UI.
017348| src/components/map/MapMovedBanner.tsx:64:               <button
017349| NOTE: JSX markup for search UI.
017350| src/components/map/MapMovedBanner.tsx:65:                 onClick={onReset}
017351| NOTE: Implementation detail supporting search page behavior.
017352| src/components/map/MapMovedBanner.tsx:66:                 className="px-3 py-1.5 bg-amber-100 dark:bg-amber-900/50 text-amber-800 dark:text-amber-200 rounded-full text-xs font-medium hover:bg-amber-200 dark:hover:bg-amber-800/50 transition-colors"
017353| NOTE: Tailwind classes define layout and styling.
017354| src/components/map/MapMovedBanner.tsx:67:               >
017355| NOTE: Implementation detail supporting search page behavior.
017356| src/components/map/MapMovedBanner.tsx:68:                 {resetLabel}
017357| NOTE: Implementation detail supporting search page behavior.
017358| src/components/map/MapMovedBanner.tsx:69:               </button>
017359| NOTE: JSX markup for search UI.
017360| src/components/map/MapMovedBanner.tsx:70:             </div>
017361| NOTE: JSX markup for search UI.
017362| src/components/map/MapMovedBanner.tsx:71:           </div>
017363| NOTE: JSX markup for search UI.
017364| src/components/map/MapMovedBanner.tsx:72:         </div>
017365| NOTE: JSX markup for search UI.
017366| src/components/map/MapMovedBanner.tsx:73:       );
017367| NOTE: Implementation detail supporting search page behavior.
017368| src/components/map/MapMovedBanner.tsx:74:     }
017369| NOTE: Implementation detail supporting search page behavior.
017370| src/components/map/MapMovedBanner.tsx:75: 
017371| NOTE: Blank line for visual separation.
017372| src/components/map/MapMovedBanner.tsx:76:     // Regular map variant - floating overlay
017373| NOTE: Line comment documents intent or constraints.
017374| src/components/map/MapMovedBanner.tsx:77:     return (
017375| NOTE: Return statement for component or helper output.
017376| src/components/map/MapMovedBanner.tsx:78:       <div className="absolute top-16 left-1/2 -translate-x-1/2 flex items-center gap-2 z-10">
017377| NOTE: Tailwind classes define layout and styling.
017378| src/components/map/MapMovedBanner.tsx:79:         <button
017379| NOTE: JSX markup for search UI.
017380| src/components/map/MapMovedBanner.tsx:80:           onClick={onSearch}
017381| NOTE: Implementation detail supporting search page behavior.
017382| src/components/map/MapMovedBanner.tsx:81:           className="px-4 py-2 bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 rounded-full text-sm font-medium shadow-lg hover:bg-zinc-800 dark:hover:bg-zinc-100 transition-colors"
017383| NOTE: Tailwind classes define layout and styling.
017384| src/components/map/MapMovedBanner.tsx:82:         >
017385| NOTE: Implementation detail supporting search page behavior.
017386| src/components/map/MapMovedBanner.tsx:83:           Search this area
017387| NOTE: Implementation detail supporting search page behavior.
017388| src/components/map/MapMovedBanner.tsx:84:         </button>
017389| NOTE: JSX markup for search UI.
017390| src/components/map/MapMovedBanner.tsx:85:         <button
017391| NOTE: JSX markup for search UI.
017392| src/components/map/MapMovedBanner.tsx:86:           onClick={onReset}
017393| NOTE: Implementation detail supporting search page behavior.
017394| src/components/map/MapMovedBanner.tsx:87:           className="px-3 py-2 bg-white dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 rounded-full text-xs shadow border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-colors"
017395| NOTE: Tailwind classes define layout and styling.
017396| src/components/map/MapMovedBanner.tsx:88:           aria-label="Reset map view"
017397| NOTE: Accessibility attribute for screen readers.
017398| src/components/map/MapMovedBanner.tsx:89:         >
017399| NOTE: Implementation detail supporting search page behavior.
017400| src/components/map/MapMovedBanner.tsx:90:           Reset
017401| NOTE: Implementation detail supporting search page behavior.
017402| src/components/map/MapMovedBanner.tsx:91:         </button>
017403| NOTE: JSX markup for search UI.
017404| src/components/map/MapMovedBanner.tsx:92:       </div>
017405| NOTE: JSX markup for search UI.
017406| src/components/map/MapMovedBanner.tsx:93:     );
017407| NOTE: Implementation detail supporting search page behavior.
017408| src/components/map/MapMovedBanner.tsx:94:   }
017409| NOTE: Implementation detail supporting search page behavior.
017410| src/components/map/MapMovedBanner.tsx:95: 
017411| NOTE: Blank line for visual separation.
017412| src/components/map/MapMovedBanner.tsx:96:   // List variant - inline banner above results
017413| NOTE: Line comment documents intent or constraints.
017414| src/components/map/MapMovedBanner.tsx:97:   // Location conflict gets amber/warning styling (same as regular but with different message)
017415| NOTE: Line comment documents intent or constraints.
017416| src/components/map/MapMovedBanner.tsx:98:   const Icon = isLocationConflict ? AlertTriangle : MapPin;
017417| NOTE: Local declaration used by search logic or UI.
017418| src/components/map/MapMovedBanner.tsx:99:   const message = isLocationConflict ? conflictMessage : regularMessage;
017419| NOTE: Local declaration used by search logic or UI.
017420| src/components/map/MapMovedBanner.tsx:100: 
017421| NOTE: Blank line for visual separation.
017422| src/components/map/MapMovedBanner.tsx:101:   return (
017423| NOTE: Return statement for component or helper output.
017424| src/components/map/MapMovedBanner.tsx:102:     <div className="flex items-center justify-between gap-3 px-4 py-2.5 bg-amber-50 dark:bg-amber-950/30 border-b border-amber-200 dark:border-amber-800/50">
017425| NOTE: Tailwind classes define layout and styling.
017426| src/components/map/MapMovedBanner.tsx:103:       <div className="flex items-center gap-2 text-sm text-amber-800 dark:text-amber-200">
017427| NOTE: Tailwind classes define layout and styling.
017428| src/components/map/MapMovedBanner.tsx:104:         <Icon className="w-4 h-4 flex-shrink-0" />
017429| NOTE: Tailwind classes define layout and styling.
017430| src/components/map/MapMovedBanner.tsx:105:         <span>{message}</span>
017431| NOTE: JSX markup for search UI.
017432| src/components/map/MapMovedBanner.tsx:106:       </div>
017433| NOTE: JSX markup for search UI.
017434| src/components/map/MapMovedBanner.tsx:107:       <div className="flex items-center gap-2">
017435| NOTE: Tailwind classes define layout and styling.
017436| src/components/map/MapMovedBanner.tsx:108:         <button
017437| NOTE: JSX markup for search UI.
017438| src/components/map/MapMovedBanner.tsx:109:           onClick={onSearch}
017439| NOTE: Implementation detail supporting search page behavior.
017440| src/components/map/MapMovedBanner.tsx:110:           className="px-3 py-1.5 bg-amber-600 hover:bg-amber-700 dark:bg-amber-500 dark:hover:bg-amber-400 text-white dark:text-amber-950 rounded-md text-xs font-medium transition-colors"
017441| NOTE: Tailwind classes define layout and styling.
017442| src/components/map/MapMovedBanner.tsx:111:         >
017443| NOTE: Implementation detail supporting search page behavior.
017444| src/components/map/MapMovedBanner.tsx:112:           {isLocationConflict ? "Search in map area" : "Search this area"}
017445| NOTE: Implementation detail supporting search page behavior.
017446| src/components/map/MapMovedBanner.tsx:113:         </button>
017447| NOTE: JSX markup for search UI.
017448| src/components/map/MapMovedBanner.tsx:114:         <button
017449| NOTE: JSX markup for search UI.
017450| src/components/map/MapMovedBanner.tsx:115:           onClick={onReset}
017451| NOTE: Implementation detail supporting search page behavior.
017452| src/components/map/MapMovedBanner.tsx:116:           className="p-1.5 text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/50 rounded-md transition-colors flex items-center gap-1"
017453| NOTE: Tailwind classes define layout and styling.
017454| src/components/map/MapMovedBanner.tsx:117:           aria-label={resetLabel}
017455| NOTE: Accessibility attribute for screen readers.
017456| src/components/map/MapMovedBanner.tsx:118:           title={resetLabel}
017457| NOTE: Implementation detail supporting search page behavior.
017458| src/components/map/MapMovedBanner.tsx:119:         >
017459| NOTE: Implementation detail supporting search page behavior.
017460| src/components/map/MapMovedBanner.tsx:120:           <RotateCcw className="w-4 h-4" />
017461| NOTE: Tailwind classes define layout and styling.
017462| src/components/map/MapMovedBanner.tsx:121:           {isLocationConflict && (
017463| NOTE: Implementation detail supporting search page behavior.
017464| src/components/map/MapMovedBanner.tsx:122:             <span className="text-xs font-medium max-w-[100px] truncate">
017465| NOTE: Tailwind classes define layout and styling.
017466| src/components/map/MapMovedBanner.tsx:123:               {displayLocationName}
017467| NOTE: Implementation detail supporting search page behavior.
017468| src/components/map/MapMovedBanner.tsx:124:             </span>
017469| NOTE: JSX markup for search UI.
017470| src/components/map/MapMovedBanner.tsx:125:           )}
017471| NOTE: Implementation detail supporting search page behavior.
017472| src/components/map/MapMovedBanner.tsx:126:         </button>
017473| NOTE: JSX markup for search UI.
017474| src/components/map/MapMovedBanner.tsx:127:       </div>
017475| NOTE: JSX markup for search UI.
017476| src/components/map/MapMovedBanner.tsx:128:     </div>
017477| NOTE: JSX markup for search UI.
017478| src/components/map/MapMovedBanner.tsx:129:   );
017479| NOTE: Implementation detail supporting search page behavior.
017480| src/components/map/MapMovedBanner.tsx:130: }
017481| NOTE: Implementation detail supporting search page behavior.
017482| FILE END: src/components/map/MapMovedBanner.tsx
017483| 
017484| FILE START: src/components/map/StackedListingPopup.tsx
017485| FILE ROLE: Auto-discovered dependency in search page graph.
017486| src/components/map/StackedListingPopup.tsx:1: "use client";
017487| NOTE: Implementation detail supporting search page behavior.
017488| src/components/map/StackedListingPopup.tsx:2: 
017489| NOTE: Blank line for visual separation.
017490| src/components/map/StackedListingPopup.tsx:3: /**
017491| NOTE: Block comment line describing behavior or context.
017492| src/components/map/StackedListingPopup.tsx:4:  * StackedListingPopup - Popup for showing multiple listings at the same location
017493| NOTE: Block comment line describing behavior or context.
017494| src/components/map/StackedListingPopup.tsx:5:  *
017495| NOTE: Block comment line describing behavior or context.
017496| src/components/map/StackedListingPopup.tsx:6:  * When multiple listings share the same coordinates, clicking the stacked marker
017497| NOTE: Block comment line describing behavior or context.
017498| src/components/map/StackedListingPopup.tsx:7:  * opens this popup showing all listings at that location in a scrollable list.
017499| NOTE: Block comment line describing behavior or context.
017500| src/components/map/StackedListingPopup.tsx:8:  */
017501| NOTE: Block comment line describing behavior or context.
017502| src/components/map/StackedListingPopup.tsx:9: 
017503| NOTE: Blank line for visual separation.
017504| src/components/map/StackedListingPopup.tsx:10: import { Popup } from "react-map-gl";
017505| NOTE: Imports dependency for this module.
017506| src/components/map/StackedListingPopup.tsx:11: import Link from "next/link";
017507| NOTE: Imports dependency for this module.
017508| src/components/map/StackedListingPopup.tsx:12: import Image from "next/image";
017509| NOTE: Imports dependency for this module.
017510| src/components/map/StackedListingPopup.tsx:13: import { X, Home, ChevronRight } from "lucide-react";
017511| NOTE: Imports dependency for this module.
017512| src/components/map/StackedListingPopup.tsx:14: import { Button } from "@/components/ui/button";
017513| NOTE: Imports dependency for this module.
017514| src/components/map/StackedListingPopup.tsx:15: import { useListingFocus } from "@/contexts/ListingFocusContext";
017515| NOTE: Imports dependency for this module.
017516| src/components/map/StackedListingPopup.tsx:16: import type { ListingGroup } from "@/lib/maps/marker-utils";
017517| NOTE: Imports dependency for this module.
017518| src/components/map/StackedListingPopup.tsx:17: 
017519| NOTE: Blank line for visual separation.
017520| src/components/map/StackedListingPopup.tsx:18: interface StackedListingPopupProps {
017521| NOTE: Type declaration for search data contracts.
017522| src/components/map/StackedListingPopup.tsx:19:   /** Group of listings at this location */
017523| NOTE: Block comment line describing behavior or context.
017524| src/components/map/StackedListingPopup.tsx:20:   group: ListingGroup;
017525| NOTE: Implementation detail supporting search page behavior.
017526| src/components/map/StackedListingPopup.tsx:21:   /** Callback when popup should close */
017527| NOTE: Block comment line describing behavior or context.
017528| src/components/map/StackedListingPopup.tsx:22:   onClose: () => void;
017529| NOTE: Implementation detail supporting search page behavior.
017530| src/components/map/StackedListingPopup.tsx:23:   /** Whether dark mode is active */
017531| NOTE: Block comment line describing behavior or context.
017532| src/components/map/StackedListingPopup.tsx:24:   isDarkMode: boolean;
017533| NOTE: Implementation detail supporting search page behavior.
017534| src/components/map/StackedListingPopup.tsx:25: }
017535| NOTE: Implementation detail supporting search page behavior.
017536| src/components/map/StackedListingPopup.tsx:26: 
017537| NOTE: Blank line for visual separation.
017538| src/components/map/StackedListingPopup.tsx:27: export function StackedListingPopup({
017539| NOTE: Exports helper or component function.
017540| src/components/map/StackedListingPopup.tsx:28:   group,
017541| NOTE: Implementation detail supporting search page behavior.
017542| src/components/map/StackedListingPopup.tsx:29:   onClose,
017543| NOTE: Implementation detail supporting search page behavior.
017544| src/components/map/StackedListingPopup.tsx:30:   isDarkMode,
017545| NOTE: Implementation detail supporting search page behavior.
017546| src/components/map/StackedListingPopup.tsx:31: }: StackedListingPopupProps) {
017547| NOTE: Implementation detail supporting search page behavior.
017548| src/components/map/StackedListingPopup.tsx:32:   const { setHovered, setActive, requestScrollTo } = useListingFocus();
017549| NOTE: Local declaration used by search logic or UI.
017550| src/components/map/StackedListingPopup.tsx:33: 
017551| NOTE: Blank line for visual separation.
017552| src/components/map/StackedListingPopup.tsx:34:   // NOTE: ESC key handling is centralized in Map.tsx to coordinate with selection clearing
017553| NOTE: Line comment documents intent or constraints.
017554| src/components/map/StackedListingPopup.tsx:35: 
017555| NOTE: Blank line for visual separation.
017556| src/components/map/StackedListingPopup.tsx:36:   return (
017557| NOTE: Return statement for component or helper output.
017558| src/components/map/StackedListingPopup.tsx:37:     <Popup
017559| NOTE: JSX markup for search UI.
017560| src/components/map/StackedListingPopup.tsx:38:       longitude={group.lng}
017561| NOTE: Implementation detail supporting search page behavior.
017562| src/components/map/StackedListingPopup.tsx:39:       latitude={group.lat}
017563| NOTE: Implementation detail supporting search page behavior.
017564| src/components/map/StackedListingPopup.tsx:40:       anchor="top"
017565| NOTE: Implementation detail supporting search page behavior.
017566| src/components/map/StackedListingPopup.tsx:41:       onClose={onClose}
017567| NOTE: Implementation detail supporting search page behavior.
017568| src/components/map/StackedListingPopup.tsx:42:       closeOnClick={false}
017569| NOTE: Implementation detail supporting search page behavior.
017570| src/components/map/StackedListingPopup.tsx:43:       maxWidth="320px"
017571| NOTE: Implementation detail supporting search page behavior.
017572| src/components/map/StackedListingPopup.tsx:44:       className={`z-50 [&_.mapboxgl-popup-content]:rounded-xl [&_.mapboxgl-popup-content]:p-0 [&_.mapboxgl-popup-content]:!bg-transparent [&_.mapboxgl-popup-content]:!shadow-none [&_.mapboxgl-popup-close-button]:hidden ${
017573| NOTE: Tailwind classes define layout and styling.
017574| src/components/map/StackedListingPopup.tsx:45:         isDarkMode
017575| NOTE: Implementation detail supporting search page behavior.
017576| src/components/map/StackedListingPopup.tsx:46:           ? "[&_.mapboxgl-popup-tip]:border-t-zinc-900"
017577| NOTE: Implementation detail supporting search page behavior.
017578| src/components/map/StackedListingPopup.tsx:47:           : "[&_.mapboxgl-popup-tip]:border-t-white"
017579| NOTE: Implementation detail supporting search page behavior.
017580| src/components/map/StackedListingPopup.tsx:48:       }`}
017581| NOTE: Implementation detail supporting search page behavior.
017582| src/components/map/StackedListingPopup.tsx:49:     >
017583| NOTE: Implementation detail supporting search page behavior.
017584| src/components/map/StackedListingPopup.tsx:50:       <div
017585| NOTE: JSX markup for search UI.
017586| src/components/map/StackedListingPopup.tsx:51:         data-testid="stacked-popup"
017587| NOTE: Implementation detail supporting search page behavior.
017588| src/components/map/StackedListingPopup.tsx:52:         className={`w-[300px] overflow-hidden rounded-xl ${
017589| NOTE: Tailwind classes define layout and styling.
017590| src/components/map/StackedListingPopup.tsx:53:           isDarkMode
017591| NOTE: Implementation detail supporting search page behavior.
017592| src/components/map/StackedListingPopup.tsx:54:             ? "bg-zinc-900 shadow-[0_10px_40px_-10px_rgba(0,0,0,0.5)]"
017593| NOTE: Implementation detail supporting search page behavior.
017594| src/components/map/StackedListingPopup.tsx:55:             : "bg-white shadow-[0_10px_40px_-10px_rgba(0,0,0,0.15)]"
017595| NOTE: Implementation detail supporting search page behavior.
017596| src/components/map/StackedListingPopup.tsx:56:         }`}
017597| NOTE: Implementation detail supporting search page behavior.
017598| src/components/map/StackedListingPopup.tsx:57:       >
017599| NOTE: Implementation detail supporting search page behavior.
017600| src/components/map/StackedListingPopup.tsx:58:         {/* Header with count and close button */}
017601| NOTE: Implementation detail supporting search page behavior.
017602| src/components/map/StackedListingPopup.tsx:59:         <div
017603| NOTE: JSX markup for search UI.
017604| src/components/map/StackedListingPopup.tsx:60:           className={`px-3 py-2.5 flex items-center justify-between border-b ${
017605| NOTE: Tailwind classes define layout and styling.
017606| src/components/map/StackedListingPopup.tsx:61:             isDarkMode ? "border-zinc-800" : "border-zinc-100"
017607| NOTE: Implementation detail supporting search page behavior.
017608| src/components/map/StackedListingPopup.tsx:62:           }`}
017609| NOTE: Implementation detail supporting search page behavior.
017610| src/components/map/StackedListingPopup.tsx:63:         >
017611| NOTE: Implementation detail supporting search page behavior.
017612| src/components/map/StackedListingPopup.tsx:64:           <span
017613| NOTE: JSX markup for search UI.
017614| src/components/map/StackedListingPopup.tsx:65:             className={`text-sm font-medium ${
017615| NOTE: Tailwind classes define layout and styling.
017616| src/components/map/StackedListingPopup.tsx:66:               isDarkMode ? "text-zinc-300" : "text-zinc-600"
017617| NOTE: Implementation detail supporting search page behavior.
017618| src/components/map/StackedListingPopup.tsx:67:             }`}
017619| NOTE: Implementation detail supporting search page behavior.
017620| src/components/map/StackedListingPopup.tsx:68:           >
017621| NOTE: Implementation detail supporting search page behavior.
017622| src/components/map/StackedListingPopup.tsx:69:             {group.listings.length} listings at this location
017623| NOTE: Implementation detail supporting search page behavior.
017624| src/components/map/StackedListingPopup.tsx:70:           </span>
017625| NOTE: JSX markup for search UI.
017626| src/components/map/StackedListingPopup.tsx:71:           <Button
017627| NOTE: JSX markup for search UI.
017628| src/components/map/StackedListingPopup.tsx:72:             variant="ghost"
017629| NOTE: Implementation detail supporting search page behavior.
017630| src/components/map/StackedListingPopup.tsx:73:             size="icon"
017631| NOTE: Implementation detail supporting search page behavior.
017632| src/components/map/StackedListingPopup.tsx:74:             onClick={onClose}
017633| NOTE: Implementation detail supporting search page behavior.
017634| src/components/map/StackedListingPopup.tsx:75:             className={`w-7 h-7 rounded-full ${
017635| NOTE: Tailwind classes define layout and styling.
017636| src/components/map/StackedListingPopup.tsx:76:               isDarkMode
017637| NOTE: Implementation detail supporting search page behavior.
017638| src/components/map/StackedListingPopup.tsx:77:                 ? "hover:bg-zinc-800 text-zinc-400 hover:text-white"
017639| NOTE: Implementation detail supporting search page behavior.
017640| src/components/map/StackedListingPopup.tsx:78:                 : "hover:bg-zinc-100 text-zinc-500 hover:text-zinc-900"
017641| NOTE: Implementation detail supporting search page behavior.
017642| src/components/map/StackedListingPopup.tsx:79:             }`}
017643| NOTE: Implementation detail supporting search page behavior.
017644| src/components/map/StackedListingPopup.tsx:80:             aria-label="Close popup"
017645| NOTE: Accessibility attribute for screen readers.
017646| src/components/map/StackedListingPopup.tsx:81:           >
017647| NOTE: Implementation detail supporting search page behavior.
017648| src/components/map/StackedListingPopup.tsx:82:             <X className="w-4 h-4" />
017649| NOTE: Tailwind classes define layout and styling.
017650| src/components/map/StackedListingPopup.tsx:83:           </Button>
017651| NOTE: JSX markup for search UI.
017652| src/components/map/StackedListingPopup.tsx:84:         </div>
017653| NOTE: JSX markup for search UI.
017654| src/components/map/StackedListingPopup.tsx:85: 
017655| NOTE: Blank line for visual separation.
017656| src/components/map/StackedListingPopup.tsx:86:         {/* Scrollable listing cards */}
017657| NOTE: Implementation detail supporting search page behavior.
017658| src/components/map/StackedListingPopup.tsx:87:         <div className="max-h-64 overflow-y-auto">
017659| NOTE: Tailwind classes define layout and styling.
017660| src/components/map/StackedListingPopup.tsx:88:           {group.listings.map((listing) => (
017661| NOTE: Implementation detail supporting search page behavior.
017662| src/components/map/StackedListingPopup.tsx:89:             <div
017663| NOTE: JSX markup for search UI.
017664| src/components/map/StackedListingPopup.tsx:90:               key={listing.id}
017665| NOTE: Implementation detail supporting search page behavior.
017666| src/components/map/StackedListingPopup.tsx:91:               data-testid={`stacked-popup-item-${listing.id}`}
017667| NOTE: Implementation detail supporting search page behavior.
017668| src/components/map/StackedListingPopup.tsx:92:               role="button"
017669| NOTE: Implementation detail supporting search page behavior.
017670| src/components/map/StackedListingPopup.tsx:93:               tabIndex={0}
017671| NOTE: Implementation detail supporting search page behavior.
017672| src/components/map/StackedListingPopup.tsx:94:               onMouseEnter={() => setHovered(listing.id)}
017673| NOTE: Implementation detail supporting search page behavior.
017674| src/components/map/StackedListingPopup.tsx:95:               onMouseLeave={() => setHovered(null)}
017675| NOTE: Implementation detail supporting search page behavior.
017676| src/components/map/StackedListingPopup.tsx:96:               onFocus={() => setHovered(listing.id)}
017677| NOTE: Implementation detail supporting search page behavior.
017678| src/components/map/StackedListingPopup.tsx:97:               onBlur={() => setHovered(null)}
017679| NOTE: Implementation detail supporting search page behavior.
017680| src/components/map/StackedListingPopup.tsx:98:               onClick={() => {
017681| NOTE: Implementation detail supporting search page behavior.
017682| src/components/map/StackedListingPopup.tsx:99:                 setActive(listing.id);
017683| NOTE: Implementation detail supporting search page behavior.
017684| src/components/map/StackedListingPopup.tsx:100:                 requestScrollTo(listing.id);
017685| NOTE: Implementation detail supporting search page behavior.
017686| src/components/map/StackedListingPopup.tsx:101:                 onClose();
017687| NOTE: Implementation detail supporting search page behavior.
017688| src/components/map/StackedListingPopup.tsx:102:               }}
017689| NOTE: Implementation detail supporting search page behavior.
017690| src/components/map/StackedListingPopup.tsx:103:               onKeyDown={(e) => {
017691| NOTE: Implementation detail supporting search page behavior.
017692| src/components/map/StackedListingPopup.tsx:104:                 if (e.key === "Enter" || e.key === " ") {
017693| NOTE: Conditional logic controlling rendering or flow.
017694| src/components/map/StackedListingPopup.tsx:105:                   e.preventDefault();
017695| NOTE: Implementation detail supporting search page behavior.
017696| src/components/map/StackedListingPopup.tsx:106:                   setActive(listing.id);
017697| NOTE: Implementation detail supporting search page behavior.
017698| src/components/map/StackedListingPopup.tsx:107:                   requestScrollTo(listing.id);
017699| NOTE: Implementation detail supporting search page behavior.
017700| src/components/map/StackedListingPopup.tsx:108:                   onClose();
017701| NOTE: Implementation detail supporting search page behavior.
017702| src/components/map/StackedListingPopup.tsx:109:                 }
017703| NOTE: Implementation detail supporting search page behavior.
017704| src/components/map/StackedListingPopup.tsx:110:               }}
017705| NOTE: Implementation detail supporting search page behavior.
017706| src/components/map/StackedListingPopup.tsx:111:               className={`flex gap-3 p-3 transition-colors cursor-pointer ${
017707| NOTE: Tailwind classes define layout and styling.
017708| src/components/map/StackedListingPopup.tsx:112:                 isDarkMode
017709| NOTE: Implementation detail supporting search page behavior.
017710| src/components/map/StackedListingPopup.tsx:113:                   ? "hover:bg-zinc-800 border-b border-zinc-800 last:border-b-0"
017711| NOTE: Implementation detail supporting search page behavior.
017712| src/components/map/StackedListingPopup.tsx:114:                   : "hover:bg-zinc-50 border-b border-zinc-100 last:border-b-0"
017713| NOTE: Implementation detail supporting search page behavior.
017714| src/components/map/StackedListingPopup.tsx:115:               }`}
017715| NOTE: Implementation detail supporting search page behavior.
017716| src/components/map/StackedListingPopup.tsx:116:             >
017717| NOTE: Implementation detail supporting search page behavior.
017718| src/components/map/StackedListingPopup.tsx:117:               {/* Thumbnail */}
017719| NOTE: Implementation detail supporting search page behavior.
017720| src/components/map/StackedListingPopup.tsx:118:               <div
017721| NOTE: JSX markup for search UI.
017722| src/components/map/StackedListingPopup.tsx:119:                 className={`relative w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 ${
017723| NOTE: Tailwind classes define layout and styling.
017724| src/components/map/StackedListingPopup.tsx:120:                   isDarkMode ? "bg-zinc-800" : "bg-zinc-100"
017725| NOTE: Implementation detail supporting search page behavior.
017726| src/components/map/StackedListingPopup.tsx:121:                 }`}
017727| NOTE: Implementation detail supporting search page behavior.
017728| src/components/map/StackedListingPopup.tsx:122:               >
017729| NOTE: Implementation detail supporting search page behavior.
017730| src/components/map/StackedListingPopup.tsx:123:                 {listing.images?.[0] ? (
017731| NOTE: Implementation detail supporting search page behavior.
017732| src/components/map/StackedListingPopup.tsx:124:                   <Image
017733| NOTE: JSX markup for search UI.
017734| src/components/map/StackedListingPopup.tsx:125:                     src={listing.images[0]}
017735| NOTE: Implementation detail supporting search page behavior.
017736| src/components/map/StackedListingPopup.tsx:126:                     alt={listing.title}
017737| NOTE: Implementation detail supporting search page behavior.
017738| src/components/map/StackedListingPopup.tsx:127:                     fill
017739| NOTE: Implementation detail supporting search page behavior.
017740| src/components/map/StackedListingPopup.tsx:128:                     sizes="64px"
017741| NOTE: Implementation detail supporting search page behavior.
017742| src/components/map/StackedListingPopup.tsx:129:                     className="object-cover"
017743| NOTE: Tailwind classes define layout and styling.
017744| src/components/map/StackedListingPopup.tsx:130:                   />
017745| NOTE: Implementation detail supporting search page behavior.
017746| src/components/map/StackedListingPopup.tsx:131:                 ) : (
017747| NOTE: Implementation detail supporting search page behavior.
017748| src/components/map/StackedListingPopup.tsx:132:                   <div className="w-full h-full flex items-center justify-center">
017749| NOTE: Tailwind classes define layout and styling.
017750| src/components/map/StackedListingPopup.tsx:133:                     <Home
017751| NOTE: JSX markup for search UI.
017752| src/components/map/StackedListingPopup.tsx:134:                       className={`w-6 h-6 ${
017753| NOTE: Tailwind classes define layout and styling.
017754| src/components/map/StackedListingPopup.tsx:135:                         isDarkMode ? "text-zinc-600" : "text-zinc-300"
017755| NOTE: Implementation detail supporting search page behavior.
017756| src/components/map/StackedListingPopup.tsx:136:                       }`}
017757| NOTE: Implementation detail supporting search page behavior.
017758| src/components/map/StackedListingPopup.tsx:137:                     />
017759| NOTE: Implementation detail supporting search page behavior.
017760| src/components/map/StackedListingPopup.tsx:138:                   </div>
017761| NOTE: JSX markup for search UI.
017762| src/components/map/StackedListingPopup.tsx:139:                 )}
017763| NOTE: Implementation detail supporting search page behavior.
017764| src/components/map/StackedListingPopup.tsx:140:               </div>
017765| NOTE: JSX markup for search UI.
017766| src/components/map/StackedListingPopup.tsx:141: 
017767| NOTE: Blank line for visual separation.
017768| src/components/map/StackedListingPopup.tsx:142:               {/* Listing info */}
017769| NOTE: Implementation detail supporting search page behavior.
017770| src/components/map/StackedListingPopup.tsx:143:               <div className="flex-1 min-w-0">
017771| NOTE: Tailwind classes define layout and styling.
017772| src/components/map/StackedListingPopup.tsx:144:                 <h4
017773| NOTE: JSX markup for search UI.
017774| src/components/map/StackedListingPopup.tsx:145:                   className={`font-medium text-sm truncate ${
017775| NOTE: Tailwind classes define layout and styling.
017776| src/components/map/StackedListingPopup.tsx:146:                     isDarkMode ? "text-white" : "text-zinc-900"
017777| NOTE: Implementation detail supporting search page behavior.
017778| src/components/map/StackedListingPopup.tsx:147:                   }`}
017779| NOTE: Implementation detail supporting search page behavior.
017780| src/components/map/StackedListingPopup.tsx:148:                 >
017781| NOTE: Implementation detail supporting search page behavior.
017782| src/components/map/StackedListingPopup.tsx:149:                   {listing.title}
017783| NOTE: Implementation detail supporting search page behavior.
017784| src/components/map/StackedListingPopup.tsx:150:                 </h4>
017785| NOTE: JSX markup for search UI.
017786| src/components/map/StackedListingPopup.tsx:151:                 <p className="mt-0.5">
017787| NOTE: Tailwind classes define layout and styling.
017788| src/components/map/StackedListingPopup.tsx:152:                   <span
017789| NOTE: JSX markup for search UI.
017790| src/components/map/StackedListingPopup.tsx:153:                     className={`font-bold ${
017791| NOTE: Tailwind classes define layout and styling.
017792| src/components/map/StackedListingPopup.tsx:154:                       isDarkMode ? "text-white" : "text-zinc-900"
017793| NOTE: Implementation detail supporting search page behavior.
017794| src/components/map/StackedListingPopup.tsx:155:                     }`}
017795| NOTE: Implementation detail supporting search page behavior.
017796| src/components/map/StackedListingPopup.tsx:156:                   >
017797| NOTE: Implementation detail supporting search page behavior.
017798| src/components/map/StackedListingPopup.tsx:157:                     ${listing.price}
017799| NOTE: Implementation detail supporting search page behavior.
017800| src/components/map/StackedListingPopup.tsx:158:                   </span>
017801| NOTE: JSX markup for search UI.
017802| src/components/map/StackedListingPopup.tsx:159:                   <span
017803| NOTE: JSX markup for search UI.
017804| src/components/map/StackedListingPopup.tsx:160:                     className={`text-sm ${
017805| NOTE: Tailwind classes define layout and styling.
017806| src/components/map/StackedListingPopup.tsx:161:                       isDarkMode ? "text-zinc-400" : "text-zinc-500"
017807| NOTE: Implementation detail supporting search page behavior.
017808| src/components/map/StackedListingPopup.tsx:162:                     }`}
017809| NOTE: Implementation detail supporting search page behavior.
017810| src/components/map/StackedListingPopup.tsx:163:                   >
017811| NOTE: Implementation detail supporting search page behavior.
017812| src/components/map/StackedListingPopup.tsx:164:                     /mo
017813| NOTE: Implementation detail supporting search page behavior.
017814| src/components/map/StackedListingPopup.tsx:165:                   </span>
017815| NOTE: JSX markup for search UI.
017816| src/components/map/StackedListingPopup.tsx:166:                 </p>
017817| NOTE: JSX markup for search UI.
017818| src/components/map/StackedListingPopup.tsx:167:                 <span
017819| NOTE: JSX markup for search UI.
017820| src/components/map/StackedListingPopup.tsx:168:                   className={`text-xs ${
017821| NOTE: Tailwind classes define layout and styling.
017822| src/components/map/StackedListingPopup.tsx:169:                     isDarkMode ? "text-zinc-500" : "text-zinc-400"
017823| NOTE: Implementation detail supporting search page behavior.
017824| src/components/map/StackedListingPopup.tsx:170:                   }`}
017825| NOTE: Implementation detail supporting search page behavior.
017826| src/components/map/StackedListingPopup.tsx:171:                 >
017827| NOTE: Implementation detail supporting search page behavior.
017828| src/components/map/StackedListingPopup.tsx:172:                   {listing.availableSlots}{" "}
017829| NOTE: Implementation detail supporting search page behavior.
017830| src/components/map/StackedListingPopup.tsx:173:                   {listing.availableSlots === 1 ? "spot" : "spots"} available
017831| NOTE: Implementation detail supporting search page behavior.
017832| src/components/map/StackedListingPopup.tsx:174:                 </span>
017833| NOTE: JSX markup for search UI.
017834| src/components/map/StackedListingPopup.tsx:175:               </div>
017835| NOTE: JSX markup for search UI.
017836| src/components/map/StackedListingPopup.tsx:176: 
017837| NOTE: Blank line for visual separation.
017838| src/components/map/StackedListingPopup.tsx:177:               {/* Arrow icon for navigation (stops propagation) */}
017839| NOTE: Implementation detail supporting search page behavior.
017840| src/components/map/StackedListingPopup.tsx:178:               <Link
017841| NOTE: JSX markup for search UI.
017842| src/components/map/StackedListingPopup.tsx:179:                 href={`/listings/${listing.id}`}
017843| NOTE: Implementation detail supporting search page behavior.
017844| src/components/map/StackedListingPopup.tsx:180:                 data-testid={`stacked-popup-open-${listing.id}`}
017845| NOTE: Implementation detail supporting search page behavior.
017846| src/components/map/StackedListingPopup.tsx:181:                 onClick={(e) => e.stopPropagation()}
017847| NOTE: Implementation detail supporting search page behavior.
017848| src/components/map/StackedListingPopup.tsx:182:                 className={`flex-shrink-0 self-center p-1.5 rounded-full transition-colors ${
017849| NOTE: Tailwind classes define layout and styling.
017850| src/components/map/StackedListingPopup.tsx:183:                   isDarkMode
017851| NOTE: Implementation detail supporting search page behavior.
017852| src/components/map/StackedListingPopup.tsx:184:                     ? "hover:bg-zinc-700 text-zinc-400 hover:text-white"
017853| NOTE: Implementation detail supporting search page behavior.
017854| src/components/map/StackedListingPopup.tsx:185:                     : "hover:bg-zinc-200 text-zinc-400 hover:text-zinc-900"
017855| NOTE: Implementation detail supporting search page behavior.
017856| src/components/map/StackedListingPopup.tsx:186:                 }`}
017857| NOTE: Implementation detail supporting search page behavior.
017858| src/components/map/StackedListingPopup.tsx:187:                 aria-label={`Open ${listing.title} details`}
017859| NOTE: Accessibility attribute for screen readers.
017860| src/components/map/StackedListingPopup.tsx:188:               >
017861| NOTE: Implementation detail supporting search page behavior.
017862| src/components/map/StackedListingPopup.tsx:189:                 <ChevronRight className="w-5 h-5" />
017863| NOTE: Tailwind classes define layout and styling.
017864| src/components/map/StackedListingPopup.tsx:190:               </Link>
017865| NOTE: JSX markup for search UI.
017866| src/components/map/StackedListingPopup.tsx:191:             </div>
017867| NOTE: JSX markup for search UI.
017868| src/components/map/StackedListingPopup.tsx:192:           ))}
017869| NOTE: Implementation detail supporting search page behavior.
017870| src/components/map/StackedListingPopup.tsx:193:         </div>
017871| NOTE: JSX markup for search UI.
017872| src/components/map/StackedListingPopup.tsx:194:       </div>
017873| NOTE: JSX markup for search UI.
017874| src/components/map/StackedListingPopup.tsx:195:     </Popup>
017875| NOTE: JSX markup for search UI.
017876| src/components/map/StackedListingPopup.tsx:196:   );
017877| NOTE: Implementation detail supporting search page behavior.
017878| src/components/map/StackedListingPopup.tsx:197: }
017879| NOTE: Implementation detail supporting search page behavior.
017880| FILE END: src/components/map/StackedListingPopup.tsx
017881| 
017882| FILE START: src/components/search/V2MapDataSetter.tsx
017883| FILE ROLE: Auto-discovered dependency in search page graph.
017884| src/components/search/V2MapDataSetter.tsx:1: "use client";
017885| NOTE: Implementation detail supporting search page behavior.
017886| src/components/search/V2MapDataSetter.tsx:2: 
017887| NOTE: Blank line for visual separation.
017888| src/components/search/V2MapDataSetter.tsx:3: import { useEffect } from "react";
017889| NOTE: Imports dependency for this module.
017890| src/components/search/V2MapDataSetter.tsx:4: import { useSearchV2Data, V2MapData } from "@/contexts/SearchV2DataContext";
017891| NOTE: Imports dependency for this module.
017892| src/components/search/V2MapDataSetter.tsx:5: 
017893| NOTE: Blank line for visual separation.
017894| src/components/search/V2MapDataSetter.tsx:6: interface V2MapDataSetterProps {
017895| NOTE: Type declaration for search data contracts.
017896| src/components/search/V2MapDataSetter.tsx:7:   /** V2 map data to inject into context */
017897| NOTE: Block comment line describing behavior or context.
017898| src/components/search/V2MapDataSetter.tsx:8:   data: V2MapData;
017899| NOTE: Implementation detail supporting search page behavior.
017900| src/components/search/V2MapDataSetter.tsx:9: }
017901| NOTE: Implementation detail supporting search page behavior.
017902| src/components/search/V2MapDataSetter.tsx:10: 
017903| NOTE: Blank line for visual separation.
017904| src/components/search/V2MapDataSetter.tsx:11: /**
017905| NOTE: Block comment line describing behavior or context.
017906| src/components/search/V2MapDataSetter.tsx:12:  * Client component that injects v2 map data into SearchV2DataContext.
017907| NOTE: Block comment line describing behavior or context.
017908| src/components/search/V2MapDataSetter.tsx:13:  *
017909| NOTE: Block comment line describing behavior or context.
017910| src/components/search/V2MapDataSetter.tsx:14:  * Rendered by page.tsx when v2 mode is enabled. Runs on mount to set
017911| NOTE: Block comment line describing behavior or context.
017912| src/components/search/V2MapDataSetter.tsx:15:  * context data before PersistentMapWrapper reads it.
017913| NOTE: Block comment line describing behavior or context.
017914| src/components/search/V2MapDataSetter.tsx:16:  *
017915| NOTE: Block comment line describing behavior or context.
017916| src/components/search/V2MapDataSetter.tsx:17:  * This enables sibling component data sharing:
017917| NOTE: Block comment line describing behavior or context.
017918| src/components/search/V2MapDataSetter.tsx:18:  * page.tsx \u2192 V2MapDataSetter \u2192 context \u2192 PersistentMapWrapper
017919| NOTE: Block comment line describing behavior or context.
017920| src/components/search/V2MapDataSetter.tsx:19:  */
017921| NOTE: Block comment line describing behavior or context.
017922| src/components/search/V2MapDataSetter.tsx:20: export function V2MapDataSetter({ data }: V2MapDataSetterProps) {
017923| NOTE: Exports helper or component function.
017924| src/components/search/V2MapDataSetter.tsx:21:   const { setV2MapData, setIsV2Enabled } = useSearchV2Data();
017925| NOTE: Local declaration used by search logic or UI.
017926| src/components/search/V2MapDataSetter.tsx:22: 
017927| NOTE: Blank line for visual separation.
017928| src/components/search/V2MapDataSetter.tsx:23:   useEffect(() => {
017929| NOTE: Defines side effect for syncing with external state.
017930| src/components/search/V2MapDataSetter.tsx:24:     // Mark v2 as enabled so PersistentMapWrapper knows to wait/skip fetch
017931| NOTE: Line comment documents intent or constraints.
017932| src/components/search/V2MapDataSetter.tsx:25:     setIsV2Enabled(true);
017933| NOTE: Implementation detail supporting search page behavior.
017934| src/components/search/V2MapDataSetter.tsx:26:     // Set the map data for PersistentMapWrapper to consume
017935| NOTE: Line comment documents intent or constraints.
017936| src/components/search/V2MapDataSetter.tsx:27:     setV2MapData(data);
017937| NOTE: Implementation detail supporting search page behavior.
017938| src/components/search/V2MapDataSetter.tsx:28: 
017939| NOTE: Blank line for visual separation.
017940| src/components/search/V2MapDataSetter.tsx:29:     // NOTE: Cleanup intentionally removed to prevent race condition.
017941| NOTE: Line comment documents intent or constraints.
017942| src/components/search/V2MapDataSetter.tsx:30:     // When URL changes (e.g., "search as I move"), React's effect cleanup
017943| NOTE: Line comment documents intent or constraints.
017944| src/components/search/V2MapDataSetter.tsx:31:     // would set v2MapData to null BEFORE new data arrives, causing markers
017945| NOTE: Line comment documents intent or constraints.
017946| src/components/search/V2MapDataSetter.tsx:32:     // to briefly disappear. Let new data overwrite old data instead.
017947| NOTE: Line comment documents intent or constraints.
017948| src/components/search/V2MapDataSetter.tsx:33:     // Cleanup for leaving /search entirely is handled by layout unmount.
017949| NOTE: Line comment documents intent or constraints.
017950| src/components/search/V2MapDataSetter.tsx:34:   }, [data, setV2MapData, setIsV2Enabled]);
017951| NOTE: Implementation detail supporting search page behavior.
017952| src/components/search/V2MapDataSetter.tsx:35: 
017953| NOTE: Blank line for visual separation.
017954| src/components/search/V2MapDataSetter.tsx:36:   // Renders nothing - just sets context
017955| NOTE: Line comment documents intent or constraints.
017956| src/components/search/V2MapDataSetter.tsx:37:   return null;
017957| NOTE: Return statement for component or helper output.
017958| src/components/search/V2MapDataSetter.tsx:38: }
017959| NOTE: Implementation detail supporting search page behavior.
017960| FILE END: src/components/search/V2MapDataSetter.tsx
017961| 
017962| FILE START: src/components/skeletons/PageSkeleton.tsx
017963| FILE ROLE: Auto-discovered dependency in search page graph.
017964| src/components/skeletons/PageSkeleton.tsx:1: import { Skeleton, TextSkeleton, CardSkeleton } from "./Skeleton";
017965| NOTE: Imports dependency for this module.
017966| src/components/skeletons/PageSkeleton.tsx:2: 
017967| NOTE: Blank line for visual separation.
017968| src/components/skeletons/PageSkeleton.tsx:3: export function PageSkeleton() {
017969| NOTE: Exports helper or component function.
017970| src/components/skeletons/PageSkeleton.tsx:4:   return (
017971| NOTE: Return statement for component or helper output.
017972| src/components/skeletons/PageSkeleton.tsx:5:     <div
017973| NOTE: JSX markup for search UI.
017974| src/components/skeletons/PageSkeleton.tsx:6:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
017975| NOTE: Tailwind classes define layout and styling.
017976| src/components/skeletons/PageSkeleton.tsx:7:       aria-busy="true"
017977| NOTE: Accessibility attribute for screen readers.
017978| src/components/skeletons/PageSkeleton.tsx:8:       aria-label="Loading page content"
017979| NOTE: Accessibility attribute for screen readers.
017980| src/components/skeletons/PageSkeleton.tsx:9:     >
017981| NOTE: Implementation detail supporting search page behavior.
017982| src/components/skeletons/PageSkeleton.tsx:10:       {/* Header skeleton */}
017983| NOTE: Implementation detail supporting search page behavior.
017984| src/components/skeletons/PageSkeleton.tsx:11:       <header className="border-b border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 px-4 py-3">
017985| NOTE: Tailwind classes define layout and styling.
017986| src/components/skeletons/PageSkeleton.tsx:12:         <div className="mx-auto flex max-w-7xl items-center justify-between">
017987| NOTE: Tailwind classes define layout and styling.
017988| src/components/skeletons/PageSkeleton.tsx:13:           <Skeleton variant="rounded" width={120} height={32} />
017989| NOTE: JSX markup for search UI.
017990| src/components/skeletons/PageSkeleton.tsx:14:           <div className="flex items-center gap-4">
017991| NOTE: Tailwind classes define layout and styling.
017992| src/components/skeletons/PageSkeleton.tsx:15:             <Skeleton variant="text" width={80} />
017993| NOTE: JSX markup for search UI.
017994| src/components/skeletons/PageSkeleton.tsx:16:             <Skeleton variant="text" width={80} />
017995| NOTE: JSX markup for search UI.
017996| src/components/skeletons/PageSkeleton.tsx:17:             <Skeleton variant="circular" width={36} height={36} />
017997| NOTE: JSX markup for search UI.
017998| src/components/skeletons/PageSkeleton.tsx:18:           </div>
017999| NOTE: JSX markup for search UI.
018000| src/components/skeletons/PageSkeleton.tsx:19:         </div>
018001| NOTE: JSX markup for search UI.
018002| src/components/skeletons/PageSkeleton.tsx:20:       </header>
018003| NOTE: JSX markup for search UI.
018004| src/components/skeletons/PageSkeleton.tsx:21: 
018005| NOTE: Blank line for visual separation.
018006| src/components/skeletons/PageSkeleton.tsx:22:       {/* Main content skeleton */}
018007| NOTE: Implementation detail supporting search page behavior.
018008| src/components/skeletons/PageSkeleton.tsx:23:       <main className="mx-auto max-w-7xl px-4 py-8">
018009| NOTE: Tailwind classes define layout and styling.
018010| src/components/skeletons/PageSkeleton.tsx:24:         {/* Title section */}
018011| NOTE: Implementation detail supporting search page behavior.
018012| src/components/skeletons/PageSkeleton.tsx:25:         <div className="mb-8">
018013| NOTE: Tailwind classes define layout and styling.
018014| src/components/skeletons/PageSkeleton.tsx:26:           <Skeleton variant="text" width={300} height={32} className="mb-2" />
018015| NOTE: Tailwind classes define layout and styling.
018016| src/components/skeletons/PageSkeleton.tsx:27:           <Skeleton variant="text" width={400} height={20} />
018017| NOTE: JSX markup for search UI.
018018| src/components/skeletons/PageSkeleton.tsx:28:         </div>
018019| NOTE: JSX markup for search UI.
018020| src/components/skeletons/PageSkeleton.tsx:29: 
018021| NOTE: Blank line for visual separation.
018022| src/components/skeletons/PageSkeleton.tsx:30:         {/* Content grid */}
018023| NOTE: Implementation detail supporting search page behavior.
018024| src/components/skeletons/PageSkeleton.tsx:31:         <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
018025| NOTE: Tailwind classes define layout and styling.
018026| src/components/skeletons/PageSkeleton.tsx:32:           {Array.from({ length: 6 }).map((_, i) => (
018027| NOTE: Implementation detail supporting search page behavior.
018028| src/components/skeletons/PageSkeleton.tsx:33:             <CardSkeleton key={i} />
018029| NOTE: JSX markup for search UI.
018030| src/components/skeletons/PageSkeleton.tsx:34:           ))}
018031| NOTE: Implementation detail supporting search page behavior.
018032| src/components/skeletons/PageSkeleton.tsx:35:         </div>
018033| NOTE: JSX markup for search UI.
018034| src/components/skeletons/PageSkeleton.tsx:36:       </main>
018035| NOTE: JSX markup for search UI.
018036| src/components/skeletons/PageSkeleton.tsx:37:     </div>
018037| NOTE: JSX markup for search UI.
018038| src/components/skeletons/PageSkeleton.tsx:38:   );
018039| NOTE: Implementation detail supporting search page behavior.
018040| src/components/skeletons/PageSkeleton.tsx:39: }
018041| NOTE: Implementation detail supporting search page behavior.
018042| src/components/skeletons/PageSkeleton.tsx:40: 
018043| NOTE: Blank line for visual separation.
018044| src/components/skeletons/PageSkeleton.tsx:41: export function DashboardSkeleton() {
018045| NOTE: Exports helper or component function.
018046| src/components/skeletons/PageSkeleton.tsx:42:   return (
018047| NOTE: Return statement for component or helper output.
018048| src/components/skeletons/PageSkeleton.tsx:43:     <div
018049| NOTE: JSX markup for search UI.
018050| src/components/skeletons/PageSkeleton.tsx:44:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018051| NOTE: Tailwind classes define layout and styling.
018052| src/components/skeletons/PageSkeleton.tsx:45:       aria-busy="true"
018053| NOTE: Accessibility attribute for screen readers.
018054| src/components/skeletons/PageSkeleton.tsx:46:       aria-label="Loading dashboard"
018055| NOTE: Accessibility attribute for screen readers.
018056| src/components/skeletons/PageSkeleton.tsx:47:     >
018057| NOTE: Implementation detail supporting search page behavior.
018058| src/components/skeletons/PageSkeleton.tsx:48:       {/* Sidebar skeleton */}
018059| NOTE: Implementation detail supporting search page behavior.
018060| src/components/skeletons/PageSkeleton.tsx:49:       <aside className="fixed left-0 top-0 hidden h-full w-64 border-r border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4 lg:block">
018061| NOTE: Tailwind classes define layout and styling.
018062| src/components/skeletons/PageSkeleton.tsx:50:         <Skeleton variant="rounded" width={140} height={32} className="mb-8" />
018063| NOTE: Tailwind classes define layout and styling.
018064| src/components/skeletons/PageSkeleton.tsx:51:         <nav className="space-y-2">
018065| NOTE: Tailwind classes define layout and styling.
018066| src/components/skeletons/PageSkeleton.tsx:52:           {Array.from({ length: 6 }).map((_, i) => (
018067| NOTE: Implementation detail supporting search page behavior.
018068| src/components/skeletons/PageSkeleton.tsx:53:             <Skeleton key={i} variant="rounded" height={40} />
018069| NOTE: JSX markup for search UI.
018070| src/components/skeletons/PageSkeleton.tsx:54:           ))}
018071| NOTE: Implementation detail supporting search page behavior.
018072| src/components/skeletons/PageSkeleton.tsx:55:         </nav>
018073| NOTE: JSX markup for search UI.
018074| src/components/skeletons/PageSkeleton.tsx:56:       </aside>
018075| NOTE: JSX markup for search UI.
018076| src/components/skeletons/PageSkeleton.tsx:57: 
018077| NOTE: Blank line for visual separation.
018078| src/components/skeletons/PageSkeleton.tsx:58:       {/* Main content */}
018079| NOTE: Implementation detail supporting search page behavior.
018080| src/components/skeletons/PageSkeleton.tsx:59:       <div className="lg:ml-64">
018081| NOTE: Tailwind classes define layout and styling.
018082| src/components/skeletons/PageSkeleton.tsx:60:         {/* Header */}
018083| NOTE: Implementation detail supporting search page behavior.
018084| src/components/skeletons/PageSkeleton.tsx:61:         <header className="border-b border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 px-6 py-4">
018085| NOTE: Tailwind classes define layout and styling.
018086| src/components/skeletons/PageSkeleton.tsx:62:           <div className="flex items-center justify-between">
018087| NOTE: Tailwind classes define layout and styling.
018088| src/components/skeletons/PageSkeleton.tsx:63:             <Skeleton variant="text" width={200} height={28} />
018089| NOTE: JSX markup for search UI.
018090| src/components/skeletons/PageSkeleton.tsx:64:             <div className="flex items-center gap-4">
018091| NOTE: Tailwind classes define layout and styling.
018092| src/components/skeletons/PageSkeleton.tsx:65:               <Skeleton variant="rounded" width={200} height={36} />
018093| NOTE: JSX markup for search UI.
018094| src/components/skeletons/PageSkeleton.tsx:66:               <Skeleton variant="circular" width={36} height={36} />
018095| NOTE: JSX markup for search UI.
018096| src/components/skeletons/PageSkeleton.tsx:67:             </div>
018097| NOTE: JSX markup for search UI.
018098| src/components/skeletons/PageSkeleton.tsx:68:           </div>
018099| NOTE: JSX markup for search UI.
018100| src/components/skeletons/PageSkeleton.tsx:69:         </header>
018101| NOTE: JSX markup for search UI.
018102| src/components/skeletons/PageSkeleton.tsx:70: 
018103| NOTE: Blank line for visual separation.
018104| src/components/skeletons/PageSkeleton.tsx:71:         {/* Stats row */}
018105| NOTE: Implementation detail supporting search page behavior.
018106| src/components/skeletons/PageSkeleton.tsx:72:         <div className="grid gap-4 p-6 md:grid-cols-4">
018107| NOTE: Tailwind classes define layout and styling.
018108| src/components/skeletons/PageSkeleton.tsx:73:           {Array.from({ length: 4 }).map((_, i) => (
018109| NOTE: Implementation detail supporting search page behavior.
018110| src/components/skeletons/PageSkeleton.tsx:74:             <div
018111| NOTE: JSX markup for search UI.
018112| src/components/skeletons/PageSkeleton.tsx:75:               key={i}
018113| NOTE: Implementation detail supporting search page behavior.
018114| src/components/skeletons/PageSkeleton.tsx:76:               className="rounded-lg border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4"
018115| NOTE: Tailwind classes define layout and styling.
018116| src/components/skeletons/PageSkeleton.tsx:77:             >
018117| NOTE: Implementation detail supporting search page behavior.
018118| src/components/skeletons/PageSkeleton.tsx:78:               <Skeleton
018119| NOTE: JSX markup for search UI.
018120| src/components/skeletons/PageSkeleton.tsx:79:                 variant="text"
018121| NOTE: Implementation detail supporting search page behavior.
018122| src/components/skeletons/PageSkeleton.tsx:80:                 width={80}
018123| NOTE: Implementation detail supporting search page behavior.
018124| src/components/skeletons/PageSkeleton.tsx:81:                 height={14}
018125| NOTE: Implementation detail supporting search page behavior.
018126| src/components/skeletons/PageSkeleton.tsx:82:                 className="mb-2"
018127| NOTE: Tailwind classes define layout and styling.
018128| src/components/skeletons/PageSkeleton.tsx:83:               />
018129| NOTE: Implementation detail supporting search page behavior.
018130| src/components/skeletons/PageSkeleton.tsx:84:               <Skeleton variant="text" width={120} height={32} />
018131| NOTE: JSX markup for search UI.
018132| src/components/skeletons/PageSkeleton.tsx:85:             </div>
018133| NOTE: JSX markup for search UI.
018134| src/components/skeletons/PageSkeleton.tsx:86:           ))}
018135| NOTE: Implementation detail supporting search page behavior.
018136| src/components/skeletons/PageSkeleton.tsx:87:         </div>
018137| NOTE: JSX markup for search UI.
018138| src/components/skeletons/PageSkeleton.tsx:88: 
018139| NOTE: Blank line for visual separation.
018140| src/components/skeletons/PageSkeleton.tsx:89:         {/* Table skeleton */}
018141| NOTE: Implementation detail supporting search page behavior.
018142| src/components/skeletons/PageSkeleton.tsx:90:         <div className="mx-6 rounded-lg border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800">
018143| NOTE: Tailwind classes define layout and styling.
018144| src/components/skeletons/PageSkeleton.tsx:91:           <div className="border-b border-zinc-200 dark:border-zinc-700 p-4">
018145| NOTE: Tailwind classes define layout and styling.
018146| src/components/skeletons/PageSkeleton.tsx:92:             <Skeleton variant="text" width={150} height={24} />
018147| NOTE: JSX markup for search UI.
018148| src/components/skeletons/PageSkeleton.tsx:93:           </div>
018149| NOTE: JSX markup for search UI.
018150| src/components/skeletons/PageSkeleton.tsx:94:           <div className="p-4">
018151| NOTE: Tailwind classes define layout and styling.
018152| src/components/skeletons/PageSkeleton.tsx:95:             <TextSkeleton lines={8} />
018153| NOTE: JSX markup for search UI.
018154| src/components/skeletons/PageSkeleton.tsx:96:           </div>
018155| NOTE: JSX markup for search UI.
018156| src/components/skeletons/PageSkeleton.tsx:97:         </div>
018157| NOTE: JSX markup for search UI.
018158| src/components/skeletons/PageSkeleton.tsx:98:       </div>
018159| NOTE: JSX markup for search UI.
018160| src/components/skeletons/PageSkeleton.tsx:99:     </div>
018161| NOTE: JSX markup for search UI.
018162| src/components/skeletons/PageSkeleton.tsx:100:   );
018163| NOTE: Implementation detail supporting search page behavior.
018164| src/components/skeletons/PageSkeleton.tsx:101: }
018165| NOTE: Implementation detail supporting search page behavior.
018166| src/components/skeletons/PageSkeleton.tsx:102: 
018167| NOTE: Blank line for visual separation.
018168| src/components/skeletons/PageSkeleton.tsx:103: export function ProfileSkeleton() {
018169| NOTE: Exports helper or component function.
018170| src/components/skeletons/PageSkeleton.tsx:104:   return (
018171| NOTE: Return statement for component or helper output.
018172| src/components/skeletons/PageSkeleton.tsx:105:     <div
018173| NOTE: JSX markup for search UI.
018174| src/components/skeletons/PageSkeleton.tsx:106:       className="mx-auto max-w-2xl p-6"
018175| NOTE: Tailwind classes define layout and styling.
018176| src/components/skeletons/PageSkeleton.tsx:107:       aria-busy="true"
018177| NOTE: Accessibility attribute for screen readers.
018178| src/components/skeletons/PageSkeleton.tsx:108:       aria-label="Loading profile"
018179| NOTE: Accessibility attribute for screen readers.
018180| src/components/skeletons/PageSkeleton.tsx:109:     >
018181| NOTE: Implementation detail supporting search page behavior.
018182| src/components/skeletons/PageSkeleton.tsx:110:       {/* Profile header */}
018183| NOTE: Implementation detail supporting search page behavior.
018184| src/components/skeletons/PageSkeleton.tsx:111:       <div className="mb-8 flex items-center gap-6">
018185| NOTE: Tailwind classes define layout and styling.
018186| src/components/skeletons/PageSkeleton.tsx:112:         <Skeleton variant="circular" width={96} height={96} />
018187| NOTE: JSX markup for search UI.
018188| src/components/skeletons/PageSkeleton.tsx:113:         <div className="flex-1 space-y-2">
018189| NOTE: Tailwind classes define layout and styling.
018190| src/components/skeletons/PageSkeleton.tsx:114:           <Skeleton variant="text" width={200} height={28} />
018191| NOTE: JSX markup for search UI.
018192| src/components/skeletons/PageSkeleton.tsx:115:           <Skeleton variant="text" width={150} height={18} />
018193| NOTE: JSX markup for search UI.
018194| src/components/skeletons/PageSkeleton.tsx:116:           <Skeleton variant="text" width={100} height={14} />
018195| NOTE: JSX markup for search UI.
018196| src/components/skeletons/PageSkeleton.tsx:117:         </div>
018197| NOTE: JSX markup for search UI.
018198| src/components/skeletons/PageSkeleton.tsx:118:       </div>
018199| NOTE: JSX markup for search UI.
018200| src/components/skeletons/PageSkeleton.tsx:119: 
018201| NOTE: Blank line for visual separation.
018202| src/components/skeletons/PageSkeleton.tsx:120:       {/* Profile sections */}
018203| NOTE: Implementation detail supporting search page behavior.
018204| src/components/skeletons/PageSkeleton.tsx:121:       <div className="space-y-6">
018205| NOTE: Tailwind classes define layout and styling.
018206| src/components/skeletons/PageSkeleton.tsx:122:         {Array.from({ length: 3 }).map((_, i) => (
018207| NOTE: Implementation detail supporting search page behavior.
018208| src/components/skeletons/PageSkeleton.tsx:123:           <section
018209| NOTE: JSX markup for search UI.
018210| src/components/skeletons/PageSkeleton.tsx:124:             key={i}
018211| NOTE: Implementation detail supporting search page behavior.
018212| src/components/skeletons/PageSkeleton.tsx:125:             className="rounded-lg border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4"
018213| NOTE: Tailwind classes define layout and styling.
018214| src/components/skeletons/PageSkeleton.tsx:126:           >
018215| NOTE: Implementation detail supporting search page behavior.
018216| src/components/skeletons/PageSkeleton.tsx:127:             <Skeleton variant="text" width={120} height={20} className="mb-4" />
018217| NOTE: Tailwind classes define layout and styling.
018218| src/components/skeletons/PageSkeleton.tsx:128:             <TextSkeleton lines={4} />
018219| NOTE: JSX markup for search UI.
018220| src/components/skeletons/PageSkeleton.tsx:129:           </section>
018221| NOTE: JSX markup for search UI.
018222| src/components/skeletons/PageSkeleton.tsx:130:         ))}
018223| NOTE: Implementation detail supporting search page behavior.
018224| src/components/skeletons/PageSkeleton.tsx:131:       </div>
018225| NOTE: JSX markup for search UI.
018226| src/components/skeletons/PageSkeleton.tsx:132:     </div>
018227| NOTE: JSX markup for search UI.
018228| src/components/skeletons/PageSkeleton.tsx:133:   );
018229| NOTE: Implementation detail supporting search page behavior.
018230| src/components/skeletons/PageSkeleton.tsx:134: }
018231| NOTE: Implementation detail supporting search page behavior.
018232| src/components/skeletons/PageSkeleton.tsx:135: 
018233| NOTE: Blank line for visual separation.
018234| src/components/skeletons/PageSkeleton.tsx:136: export function FormSkeleton() {
018235| NOTE: Exports helper or component function.
018236| src/components/skeletons/PageSkeleton.tsx:137:   return (
018237| NOTE: Return statement for component or helper output.
018238| src/components/skeletons/PageSkeleton.tsx:138:     <div
018239| NOTE: JSX markup for search UI.
018240| src/components/skeletons/PageSkeleton.tsx:139:       className="mx-auto max-w-md p-6"
018241| NOTE: Tailwind classes define layout and styling.
018242| src/components/skeletons/PageSkeleton.tsx:140:       aria-busy="true"
018243| NOTE: Accessibility attribute for screen readers.
018244| src/components/skeletons/PageSkeleton.tsx:141:       aria-label="Loading form"
018245| NOTE: Accessibility attribute for screen readers.
018246| src/components/skeletons/PageSkeleton.tsx:142:     >
018247| NOTE: Implementation detail supporting search page behavior.
018248| src/components/skeletons/PageSkeleton.tsx:143:       <Skeleton variant="text" width={200} height={28} className="mb-6" />
018249| NOTE: Tailwind classes define layout and styling.
018250| src/components/skeletons/PageSkeleton.tsx:144: 
018251| NOTE: Blank line for visual separation.
018252| src/components/skeletons/PageSkeleton.tsx:145:       <div className="space-y-4">
018253| NOTE: Tailwind classes define layout and styling.
018254| src/components/skeletons/PageSkeleton.tsx:146:         {Array.from({ length: 4 }).map((_, i) => (
018255| NOTE: Implementation detail supporting search page behavior.
018256| src/components/skeletons/PageSkeleton.tsx:147:           <div key={i}>
018257| NOTE: JSX markup for search UI.
018258| src/components/skeletons/PageSkeleton.tsx:148:             <Skeleton variant="text" width={100} height={14} className="mb-2" />
018259| NOTE: Tailwind classes define layout and styling.
018260| src/components/skeletons/PageSkeleton.tsx:149:             <Skeleton variant="rounded" height={40} />
018261| NOTE: JSX markup for search UI.
018262| src/components/skeletons/PageSkeleton.tsx:150:           </div>
018263| NOTE: JSX markup for search UI.
018264| src/components/skeletons/PageSkeleton.tsx:151:         ))}
018265| NOTE: Implementation detail supporting search page behavior.
018266| src/components/skeletons/PageSkeleton.tsx:152: 
018267| NOTE: Blank line for visual separation.
018268| src/components/skeletons/PageSkeleton.tsx:153:         <Skeleton variant="rounded" height={44} className="mt-6" />
018269| NOTE: Tailwind classes define layout and styling.
018270| src/components/skeletons/PageSkeleton.tsx:154:       </div>
018271| NOTE: JSX markup for search UI.
018272| src/components/skeletons/PageSkeleton.tsx:155:     </div>
018273| NOTE: JSX markup for search UI.
018274| src/components/skeletons/PageSkeleton.tsx:156:   );
018275| NOTE: Implementation detail supporting search page behavior.
018276| src/components/skeletons/PageSkeleton.tsx:157: }
018277| NOTE: Implementation detail supporting search page behavior.
018278| src/components/skeletons/PageSkeleton.tsx:158: 
018279| NOTE: Blank line for visual separation.
018280| src/components/skeletons/PageSkeleton.tsx:159: export function ListingSkeleton() {
018281| NOTE: Exports helper or component function.
018282| src/components/skeletons/PageSkeleton.tsx:160:   return (
018283| NOTE: Return statement for component or helper output.
018284| src/components/skeletons/PageSkeleton.tsx:161:     <div className="rounded-lg border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 overflow-hidden">
018285| NOTE: Tailwind classes define layout and styling.
018286| src/components/skeletons/PageSkeleton.tsx:162:       <Skeleton variant="rectangular" height={200} />
018287| NOTE: JSX markup for search UI.
018288| src/components/skeletons/PageSkeleton.tsx:163:       <div className="p-4 space-y-3">
018289| NOTE: Tailwind classes define layout and styling.
018290| src/components/skeletons/PageSkeleton.tsx:164:         <Skeleton variant="text" width="80%" height={20} />
018291| NOTE: JSX markup for search UI.
018292| src/components/skeletons/PageSkeleton.tsx:165:         <Skeleton variant="text" width="60%" height={16} />
018293| NOTE: JSX markup for search UI.
018294| src/components/skeletons/PageSkeleton.tsx:166:         <div className="flex justify-between items-center pt-2">
018295| NOTE: Tailwind classes define layout and styling.
018296| src/components/skeletons/PageSkeleton.tsx:167:           <Skeleton variant="text" width={80} height={24} />
018297| NOTE: JSX markup for search UI.
018298| src/components/skeletons/PageSkeleton.tsx:168:           <Skeleton variant="rounded" width={100} height={32} />
018299| NOTE: JSX markup for search UI.
018300| src/components/skeletons/PageSkeleton.tsx:169:         </div>
018301| NOTE: JSX markup for search UI.
018302| src/components/skeletons/PageSkeleton.tsx:170:       </div>
018303| NOTE: JSX markup for search UI.
018304| src/components/skeletons/PageSkeleton.tsx:171:     </div>
018305| NOTE: JSX markup for search UI.
018306| src/components/skeletons/PageSkeleton.tsx:172:   );
018307| NOTE: Implementation detail supporting search page behavior.
018308| src/components/skeletons/PageSkeleton.tsx:173: }
018309| NOTE: Implementation detail supporting search page behavior.
018310| src/components/skeletons/PageSkeleton.tsx:174: 
018311| NOTE: Blank line for visual separation.
018312| src/components/skeletons/PageSkeleton.tsx:175: export function ListingGridSkeleton({ count = 6 }: { count?: number }) {
018313| NOTE: Exports helper or component function.
018314| src/components/skeletons/PageSkeleton.tsx:176:   return (
018315| NOTE: Return statement for component or helper output.
018316| src/components/skeletons/PageSkeleton.tsx:177:     <div
018317| NOTE: JSX markup for search UI.
018318| src/components/skeletons/PageSkeleton.tsx:178:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018319| NOTE: Tailwind classes define layout and styling.
018320| src/components/skeletons/PageSkeleton.tsx:179:       aria-busy="true"
018321| NOTE: Accessibility attribute for screen readers.
018322| src/components/skeletons/PageSkeleton.tsx:180:       aria-label="Loading listings"
018323| NOTE: Accessibility attribute for screen readers.
018324| src/components/skeletons/PageSkeleton.tsx:181:     >
018325| NOTE: Implementation detail supporting search page behavior.
018326| src/components/skeletons/PageSkeleton.tsx:182:       <main className="mx-auto max-w-7xl px-4 py-8">
018327| NOTE: Tailwind classes define layout and styling.
018328| src/components/skeletons/PageSkeleton.tsx:183:         <div className="mb-8">
018329| NOTE: Tailwind classes define layout and styling.
018330| src/components/skeletons/PageSkeleton.tsx:184:           <Skeleton variant="text" width={250} height={32} className="mb-2" />
018331| NOTE: Tailwind classes define layout and styling.
018332| src/components/skeletons/PageSkeleton.tsx:185:           <Skeleton variant="text" width={180} height={18} />
018333| NOTE: JSX markup for search UI.
018334| src/components/skeletons/PageSkeleton.tsx:186:         </div>
018335| NOTE: JSX markup for search UI.
018336| src/components/skeletons/PageSkeleton.tsx:187:         <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
018337| NOTE: Tailwind classes define layout and styling.
018338| src/components/skeletons/PageSkeleton.tsx:188:           {Array.from({ length: count }).map((_, i) => (
018339| NOTE: Implementation detail supporting search page behavior.
018340| src/components/skeletons/PageSkeleton.tsx:189:             <ListingSkeleton key={i} />
018341| NOTE: JSX markup for search UI.
018342| src/components/skeletons/PageSkeleton.tsx:190:           ))}
018343| NOTE: Implementation detail supporting search page behavior.
018344| src/components/skeletons/PageSkeleton.tsx:191:         </div>
018345| NOTE: JSX markup for search UI.
018346| src/components/skeletons/PageSkeleton.tsx:192:       </main>
018347| NOTE: JSX markup for search UI.
018348| src/components/skeletons/PageSkeleton.tsx:193:     </div>
018349| NOTE: JSX markup for search UI.
018350| src/components/skeletons/PageSkeleton.tsx:194:   );
018351| NOTE: Implementation detail supporting search page behavior.
018352| src/components/skeletons/PageSkeleton.tsx:195: }
018353| NOTE: Implementation detail supporting search page behavior.
018354| src/components/skeletons/PageSkeleton.tsx:196: 
018355| NOTE: Blank line for visual separation.
018356| src/components/skeletons/PageSkeleton.tsx:197: export function SearchResultsSkeleton({ count = 6 }: { count?: number }) {
018357| NOTE: Exports helper or component function.
018358| src/components/skeletons/PageSkeleton.tsx:198:   return (
018359| NOTE: Return statement for component or helper output.
018360| src/components/skeletons/PageSkeleton.tsx:199:     <div
018361| NOTE: JSX markup for search UI.
018362| src/components/skeletons/PageSkeleton.tsx:200:       className="h-screen flex flex-col bg-white dark:bg-zinc-950 overflow-hidden pt-20"
018363| NOTE: Tailwind classes define layout and styling.
018364| src/components/skeletons/PageSkeleton.tsx:201:       aria-busy="true"
018365| NOTE: Accessibility attribute for screen readers.
018366| src/components/skeletons/PageSkeleton.tsx:202:       aria-label="Loading search results"
018367| NOTE: Accessibility attribute for screen readers.
018368| src/components/skeletons/PageSkeleton.tsx:203:     >
018369| NOTE: Implementation detail supporting search page behavior.
018370| src/components/skeletons/PageSkeleton.tsx:204:       {/* Search Header Skeleton */}
018371| NOTE: Implementation detail supporting search page behavior.
018372| src/components/skeletons/PageSkeleton.tsx:205:       <header className="w-full bg-white/80 dark:bg-zinc-900/80 backdrop-blur-xl border-b border-zinc-100 dark:border-zinc-800">
018373| NOTE: Tailwind classes define layout and styling.
018374| src/components/skeletons/PageSkeleton.tsx:206:         <div className="w-full max-w-[1920px] mx-auto px-3 sm:px-4 md:px-6 py-3 sm:py-4">
018375| NOTE: Tailwind classes define layout and styling.
018376| src/components/skeletons/PageSkeleton.tsx:207:           <Skeleton
018377| NOTE: JSX markup for search UI.
018378| src/components/skeletons/PageSkeleton.tsx:208:             variant="rounded"
018379| NOTE: Implementation detail supporting search page behavior.
018380| src/components/skeletons/PageSkeleton.tsx:209:             height={56}
018381| NOTE: Implementation detail supporting search page behavior.
018382| src/components/skeletons/PageSkeleton.tsx:210:             className="w-full max-w-2xl mx-auto"
018383| NOTE: Tailwind classes define layout and styling.
018384| src/components/skeletons/PageSkeleton.tsx:211:           />
018385| NOTE: Implementation detail supporting search page behavior.
018386| src/components/skeletons/PageSkeleton.tsx:212:         </div>
018387| NOTE: JSX markup for search UI.
018388| src/components/skeletons/PageSkeleton.tsx:213:       </header>
018389| NOTE: JSX markup for search UI.
018390| src/components/skeletons/PageSkeleton.tsx:214: 
018391| NOTE: Blank line for visual separation.
018392| src/components/skeletons/PageSkeleton.tsx:215:       {/* Results Skeleton */}
018393| NOTE: Implementation detail supporting search page behavior.
018394| src/components/skeletons/PageSkeleton.tsx:216:       <div className="flex-1 overflow-auto">
018395| NOTE: Tailwind classes define layout and styling.
018396| src/components/skeletons/PageSkeleton.tsx:217:         <div className="px-4 sm:px-6 py-4 sm:py-6 max-w-[840px] mx-auto pb-24 md:pb-6">
018397| NOTE: Tailwind classes define layout and styling.
018398| src/components/skeletons/PageSkeleton.tsx:218:           {/* Header */}
018399| NOTE: Implementation detail supporting search page behavior.
018400| src/components/skeletons/PageSkeleton.tsx:219:           <div className="flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6">
018401| NOTE: Tailwind classes define layout and styling.
018402| src/components/skeletons/PageSkeleton.tsx:220:             <div>
018403| NOTE: JSX markup for search UI.
018404| src/components/skeletons/PageSkeleton.tsx:221:               <Skeleton
018405| NOTE: JSX markup for search UI.
018406| src/components/skeletons/PageSkeleton.tsx:222:                 variant="text"
018407| NOTE: Implementation detail supporting search page behavior.
018408| src/components/skeletons/PageSkeleton.tsx:223:                 width={180}
018409| NOTE: Implementation detail supporting search page behavior.
018410| src/components/skeletons/PageSkeleton.tsx:224:                 height={24}
018411| NOTE: Implementation detail supporting search page behavior.
018412| src/components/skeletons/PageSkeleton.tsx:225:                 className="mb-2"
018413| NOTE: Tailwind classes define layout and styling.
018414| src/components/skeletons/PageSkeleton.tsx:226:               />
018415| NOTE: Implementation detail supporting search page behavior.
018416| src/components/skeletons/PageSkeleton.tsx:227:               <Skeleton variant="text" width={220} height={16} />
018417| NOTE: JSX markup for search UI.
018418| src/components/skeletons/PageSkeleton.tsx:228:             </div>
018419| NOTE: JSX markup for search UI.
018420| src/components/skeletons/PageSkeleton.tsx:229:             <div className="flex items-center gap-2 sm:gap-3">
018421| NOTE: Tailwind classes define layout and styling.
018422| src/components/skeletons/PageSkeleton.tsx:230:               <Skeleton variant="rounded" width={100} height={36} />
018423| NOTE: JSX markup for search UI.
018424| src/components/skeletons/PageSkeleton.tsx:231:               <Skeleton variant="rounded" width={120} height={36} />
018425| NOTE: JSX markup for search UI.
018426| src/components/skeletons/PageSkeleton.tsx:232:             </div>
018427| NOTE: JSX markup for search UI.
018428| src/components/skeletons/PageSkeleton.tsx:233:           </div>
018429| NOTE: JSX markup for search UI.
018430| src/components/skeletons/PageSkeleton.tsx:234: 
018431| NOTE: Blank line for visual separation.
018432| src/components/skeletons/PageSkeleton.tsx:235:           {/* Listing Cards Grid */}
018433| NOTE: Implementation detail supporting search page behavior.
018434| src/components/skeletons/PageSkeleton.tsx:236:           <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-x-6 sm:gap-y-8">
018435| NOTE: Tailwind classes define layout and styling.
018436| src/components/skeletons/PageSkeleton.tsx:237:             {Array.from({ length: count }).map((_, i) => (
018437| NOTE: Implementation detail supporting search page behavior.
018438| src/components/skeletons/PageSkeleton.tsx:238:               <div
018439| NOTE: JSX markup for search UI.
018440| src/components/skeletons/PageSkeleton.tsx:239:                 key={i}
018441| NOTE: Implementation detail supporting search page behavior.
018442| src/components/skeletons/PageSkeleton.tsx:240:                 className="bg-white dark:bg-zinc-900 rounded-xl border border-zinc-200/60 dark:border-zinc-800 overflow-hidden"
018443| NOTE: Tailwind classes define layout and styling.
018444| src/components/skeletons/PageSkeleton.tsx:241:               >
018445| NOTE: Implementation detail supporting search page behavior.
018446| src/components/skeletons/PageSkeleton.tsx:242:                 <Skeleton
018447| NOTE: JSX markup for search UI.
018448| src/components/skeletons/PageSkeleton.tsx:243:                   variant="rectangular"
018449| NOTE: Implementation detail supporting search page behavior.
018450| src/components/skeletons/PageSkeleton.tsx:244:                   className="aspect-[4/3] w-full"
018451| NOTE: Tailwind classes define layout and styling.
018452| src/components/skeletons/PageSkeleton.tsx:245:                 />
018453| NOTE: Implementation detail supporting search page behavior.
018454| src/components/skeletons/PageSkeleton.tsx:246:                 <div className="p-4">
018455| NOTE: Tailwind classes define layout and styling.
018456| src/components/skeletons/PageSkeleton.tsx:247:                   <div className="flex justify-between items-start gap-3 mb-1">
018457| NOTE: Tailwind classes define layout and styling.
018458| src/components/skeletons/PageSkeleton.tsx:248:                     <Skeleton variant="text" width="70%" height={18} />
018459| NOTE: JSX markup for search UI.
018460| src/components/skeletons/PageSkeleton.tsx:249:                     <Skeleton variant="text" width={40} height={16} />
018461| NOTE: JSX markup for search UI.
018462| src/components/skeletons/PageSkeleton.tsx:250:                   </div>
018463| NOTE: JSX markup for search UI.
018464| src/components/skeletons/PageSkeleton.tsx:251:                   <Skeleton
018465| NOTE: JSX markup for search UI.
018466| src/components/skeletons/PageSkeleton.tsx:252:                     variant="text"
018467| NOTE: Implementation detail supporting search page behavior.
018468| src/components/skeletons/PageSkeleton.tsx:253:                     width="45%"
018469| NOTE: Implementation detail supporting search page behavior.
018470| src/components/skeletons/PageSkeleton.tsx:254:                     height={14}
018471| NOTE: Implementation detail supporting search page behavior.
018472| src/components/skeletons/PageSkeleton.tsx:255:                     className="mb-3"
018473| NOTE: Tailwind classes define layout and styling.
018474| src/components/skeletons/PageSkeleton.tsx:256:                   />
018475| NOTE: Implementation detail supporting search page behavior.
018476| src/components/skeletons/PageSkeleton.tsx:257:                   <div className="flex gap-1.5 mb-4">
018477| NOTE: Tailwind classes define layout and styling.
018478| src/components/skeletons/PageSkeleton.tsx:258:                     <Skeleton variant="rounded" width={60} height={20} />
018479| NOTE: JSX markup for search UI.
018480| src/components/skeletons/PageSkeleton.tsx:259:                     <Skeleton variant="rounded" width={50} height={20} />
018481| NOTE: JSX markup for search UI.
018482| src/components/skeletons/PageSkeleton.tsx:260:                     <Skeleton variant="rounded" width={45} height={20} />
018483| NOTE: JSX markup for search UI.
018484| src/components/skeletons/PageSkeleton.tsx:261:                   </div>
018485| NOTE: JSX markup for search UI.
018486| src/components/skeletons/PageSkeleton.tsx:262:                   <Skeleton variant="text" width={80} height={24} />
018487| NOTE: JSX markup for search UI.
018488| src/components/skeletons/PageSkeleton.tsx:263:                 </div>
018489| NOTE: JSX markup for search UI.
018490| src/components/skeletons/PageSkeleton.tsx:264:               </div>
018491| NOTE: JSX markup for search UI.
018492| src/components/skeletons/PageSkeleton.tsx:265:             ))}
018493| NOTE: Implementation detail supporting search page behavior.
018494| src/components/skeletons/PageSkeleton.tsx:266:           </div>
018495| NOTE: JSX markup for search UI.
018496| src/components/skeletons/PageSkeleton.tsx:267:         </div>
018497| NOTE: JSX markup for search UI.
018498| src/components/skeletons/PageSkeleton.tsx:268:       </div>
018499| NOTE: JSX markup for search UI.
018500| src/components/skeletons/PageSkeleton.tsx:269:     </div>
018501| NOTE: JSX markup for search UI.
018502| src/components/skeletons/PageSkeleton.tsx:270:   );
018503| NOTE: Implementation detail supporting search page behavior.
018504| src/components/skeletons/PageSkeleton.tsx:271: }
018505| NOTE: Implementation detail supporting search page behavior.
018506| src/components/skeletons/PageSkeleton.tsx:272: 
018507| NOTE: Blank line for visual separation.
018508| src/components/skeletons/PageSkeleton.tsx:273: export function MessageListSkeleton() {
018509| NOTE: Exports helper or component function.
018510| src/components/skeletons/PageSkeleton.tsx:274:   return (
018511| NOTE: Return statement for component or helper output.
018512| src/components/skeletons/PageSkeleton.tsx:275:     <div
018513| NOTE: JSX markup for search UI.
018514| src/components/skeletons/PageSkeleton.tsx:276:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018515| NOTE: Tailwind classes define layout and styling.
018516| src/components/skeletons/PageSkeleton.tsx:277:       aria-busy="true"
018517| NOTE: Accessibility attribute for screen readers.
018518| src/components/skeletons/PageSkeleton.tsx:278:       aria-label="Loading messages"
018519| NOTE: Accessibility attribute for screen readers.
018520| src/components/skeletons/PageSkeleton.tsx:279:     >
018521| NOTE: Implementation detail supporting search page behavior.
018522| src/components/skeletons/PageSkeleton.tsx:280:       <main className="mx-auto max-w-4xl px-4 py-8">
018523| NOTE: Tailwind classes define layout and styling.
018524| src/components/skeletons/PageSkeleton.tsx:281:         <div className="mb-6">
018525| NOTE: Tailwind classes define layout and styling.
018526| src/components/skeletons/PageSkeleton.tsx:282:           <Skeleton variant="text" width={200} height={32} className="mb-2" />
018527| NOTE: Tailwind classes define layout and styling.
018528| src/components/skeletons/PageSkeleton.tsx:283:         </div>
018529| NOTE: JSX markup for search UI.
018530| src/components/skeletons/PageSkeleton.tsx:284:         <div className="space-y-3">
018531| NOTE: Tailwind classes define layout and styling.
018532| src/components/skeletons/PageSkeleton.tsx:285:           {Array.from({ length: 8 }).map((_, i) => (
018533| NOTE: Implementation detail supporting search page behavior.
018534| src/components/skeletons/PageSkeleton.tsx:286:             <div
018535| NOTE: JSX markup for search UI.
018536| src/components/skeletons/PageSkeleton.tsx:287:               key={i}
018537| NOTE: Implementation detail supporting search page behavior.
018538| src/components/skeletons/PageSkeleton.tsx:288:               className="flex items-center gap-4 p-4 bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700"
018539| NOTE: Tailwind classes define layout and styling.
018540| src/components/skeletons/PageSkeleton.tsx:289:             >
018541| NOTE: Implementation detail supporting search page behavior.
018542| src/components/skeletons/PageSkeleton.tsx:290:               <Skeleton variant="circular" width={48} height={48} />
018543| NOTE: JSX markup for search UI.
018544| src/components/skeletons/PageSkeleton.tsx:291:               <div className="flex-1 space-y-2">
018545| NOTE: Tailwind classes define layout and styling.
018546| src/components/skeletons/PageSkeleton.tsx:292:                 <Skeleton variant="text" width="40%" height={18} />
018547| NOTE: JSX markup for search UI.
018548| src/components/skeletons/PageSkeleton.tsx:293:                 <Skeleton variant="text" width="70%" height={14} />
018549| NOTE: JSX markup for search UI.
018550| src/components/skeletons/PageSkeleton.tsx:294:               </div>
018551| NOTE: JSX markup for search UI.
018552| src/components/skeletons/PageSkeleton.tsx:295:               <Skeleton variant="text" width={60} height={12} />
018553| NOTE: JSX markup for search UI.
018554| src/components/skeletons/PageSkeleton.tsx:296:             </div>
018555| NOTE: JSX markup for search UI.
018556| src/components/skeletons/PageSkeleton.tsx:297:           ))}
018557| NOTE: Implementation detail supporting search page behavior.
018558| src/components/skeletons/PageSkeleton.tsx:298:         </div>
018559| NOTE: JSX markup for search UI.
018560| src/components/skeletons/PageSkeleton.tsx:299:       </main>
018561| NOTE: JSX markup for search UI.
018562| src/components/skeletons/PageSkeleton.tsx:300:     </div>
018563| NOTE: JSX markup for search UI.
018564| src/components/skeletons/PageSkeleton.tsx:301:   );
018565| NOTE: Implementation detail supporting search page behavior.
018566| src/components/skeletons/PageSkeleton.tsx:302: }
018567| NOTE: Implementation detail supporting search page behavior.
018568| src/components/skeletons/PageSkeleton.tsx:303: 
018569| NOTE: Blank line for visual separation.
018570| src/components/skeletons/PageSkeleton.tsx:304: export function ChatSkeleton() {
018571| NOTE: Exports helper or component function.
018572| src/components/skeletons/PageSkeleton.tsx:305:   return (
018573| NOTE: Return statement for component or helper output.
018574| src/components/skeletons/PageSkeleton.tsx:306:     <div
018575| NOTE: JSX markup for search UI.
018576| src/components/skeletons/PageSkeleton.tsx:307:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018577| NOTE: Tailwind classes define layout and styling.
018578| src/components/skeletons/PageSkeleton.tsx:308:       aria-busy="true"
018579| NOTE: Accessibility attribute for screen readers.
018580| src/components/skeletons/PageSkeleton.tsx:309:       aria-label="Loading chat"
018581| NOTE: Accessibility attribute for screen readers.
018582| src/components/skeletons/PageSkeleton.tsx:310:     >
018583| NOTE: Implementation detail supporting search page behavior.
018584| src/components/skeletons/PageSkeleton.tsx:311:       <main className="mx-auto max-w-4xl px-4 py-8">
018585| NOTE: Tailwind classes define layout and styling.
018586| src/components/skeletons/PageSkeleton.tsx:312:         <div className="bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700 overflow-hidden">
018587| NOTE: Tailwind classes define layout and styling.
018588| src/components/skeletons/PageSkeleton.tsx:313:           {/* Chat header */}
018589| NOTE: Implementation detail supporting search page behavior.
018590| src/components/skeletons/PageSkeleton.tsx:314:           <div className="flex items-center gap-4 p-4 border-b border-zinc-200 dark:border-zinc-700">
018591| NOTE: Tailwind classes define layout and styling.
018592| src/components/skeletons/PageSkeleton.tsx:315:             <Skeleton variant="circular" width={40} height={40} />
018593| NOTE: JSX markup for search UI.
018594| src/components/skeletons/PageSkeleton.tsx:316:             <div className="space-y-1">
018595| NOTE: Tailwind classes define layout and styling.
018596| src/components/skeletons/PageSkeleton.tsx:317:               <Skeleton variant="text" width={150} height={18} />
018597| NOTE: JSX markup for search UI.
018598| src/components/skeletons/PageSkeleton.tsx:318:               <Skeleton variant="text" width={100} height={12} />
018599| NOTE: JSX markup for search UI.
018600| src/components/skeletons/PageSkeleton.tsx:319:             </div>
018601| NOTE: JSX markup for search UI.
018602| src/components/skeletons/PageSkeleton.tsx:320:           </div>
018603| NOTE: JSX markup for search UI.
018604| src/components/skeletons/PageSkeleton.tsx:321:           {/* Messages */}
018605| NOTE: Implementation detail supporting search page behavior.
018606| src/components/skeletons/PageSkeleton.tsx:322:           <div className="p-4 space-y-4 h-96">
018607| NOTE: Tailwind classes define layout and styling.
018608| src/components/skeletons/PageSkeleton.tsx:323:             {Array.from({ length: 5 }).map((_, i) => (
018609| NOTE: Implementation detail supporting search page behavior.
018610| src/components/skeletons/PageSkeleton.tsx:324:               <div
018611| NOTE: JSX markup for search UI.
018612| src/components/skeletons/PageSkeleton.tsx:325:                 key={i}
018613| NOTE: Implementation detail supporting search page behavior.
018614| src/components/skeletons/PageSkeleton.tsx:326:                 className={`flex ${i % 2 === 0 ? "justify-start" : "justify-end"}`}
018615| NOTE: Tailwind classes define layout and styling.
018616| src/components/skeletons/PageSkeleton.tsx:327:               >
018617| NOTE: Implementation detail supporting search page behavior.
018618| src/components/skeletons/PageSkeleton.tsx:328:                 <Skeleton
018619| NOTE: JSX markup for search UI.
018620| src/components/skeletons/PageSkeleton.tsx:329:                   variant="rounded"
018621| NOTE: Implementation detail supporting search page behavior.
018622| src/components/skeletons/PageSkeleton.tsx:330:                   width={200 + (i % 3) * 50}
018623| NOTE: Implementation detail supporting search page behavior.
018624| src/components/skeletons/PageSkeleton.tsx:331:                   height={40}
018625| NOTE: Implementation detail supporting search page behavior.
018626| src/components/skeletons/PageSkeleton.tsx:332:                 />
018627| NOTE: Implementation detail supporting search page behavior.
018628| src/components/skeletons/PageSkeleton.tsx:333:               </div>
018629| NOTE: JSX markup for search UI.
018630| src/components/skeletons/PageSkeleton.tsx:334:             ))}
018631| NOTE: Implementation detail supporting search page behavior.
018632| src/components/skeletons/PageSkeleton.tsx:335:           </div>
018633| NOTE: JSX markup for search UI.
018634| src/components/skeletons/PageSkeleton.tsx:336:           {/* Input */}
018635| NOTE: Implementation detail supporting search page behavior.
018636| src/components/skeletons/PageSkeleton.tsx:337:           <div className="p-4 border-t border-zinc-200 dark:border-zinc-700">
018637| NOTE: Tailwind classes define layout and styling.
018638| src/components/skeletons/PageSkeleton.tsx:338:             <Skeleton variant="rounded" height={44} />
018639| NOTE: JSX markup for search UI.
018640| src/components/skeletons/PageSkeleton.tsx:339:           </div>
018641| NOTE: JSX markup for search UI.
018642| src/components/skeletons/PageSkeleton.tsx:340:         </div>
018643| NOTE: JSX markup for search UI.
018644| src/components/skeletons/PageSkeleton.tsx:341:       </main>
018645| NOTE: JSX markup for search UI.
018646| src/components/skeletons/PageSkeleton.tsx:342:     </div>
018647| NOTE: JSX markup for search UI.
018648| src/components/skeletons/PageSkeleton.tsx:343:   );
018649| NOTE: Implementation detail supporting search page behavior.
018650| src/components/skeletons/PageSkeleton.tsx:344: }
018651| NOTE: Implementation detail supporting search page behavior.
018652| src/components/skeletons/PageSkeleton.tsx:345: 
018653| NOTE: Blank line for visual separation.
018654| src/components/skeletons/PageSkeleton.tsx:346: export function AdminTableSkeleton() {
018655| NOTE: Exports helper or component function.
018656| src/components/skeletons/PageSkeleton.tsx:347:   return (
018657| NOTE: Return statement for component or helper output.
018658| src/components/skeletons/PageSkeleton.tsx:348:     <div
018659| NOTE: JSX markup for search UI.
018660| src/components/skeletons/PageSkeleton.tsx:349:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018661| NOTE: Tailwind classes define layout and styling.
018662| src/components/skeletons/PageSkeleton.tsx:350:       aria-busy="true"
018663| NOTE: Accessibility attribute for screen readers.
018664| src/components/skeletons/PageSkeleton.tsx:351:       aria-label="Loading admin data"
018665| NOTE: Accessibility attribute for screen readers.
018666| src/components/skeletons/PageSkeleton.tsx:352:     >
018667| NOTE: Implementation detail supporting search page behavior.
018668| src/components/skeletons/PageSkeleton.tsx:353:       <main className="mx-auto max-w-7xl px-4 py-8">
018669| NOTE: Tailwind classes define layout and styling.
018670| src/components/skeletons/PageSkeleton.tsx:354:         <div className="mb-6 flex items-center justify-between">
018671| NOTE: Tailwind classes define layout and styling.
018672| src/components/skeletons/PageSkeleton.tsx:355:           <Skeleton variant="text" width={200} height={32} />
018673| NOTE: JSX markup for search UI.
018674| src/components/skeletons/PageSkeleton.tsx:356:           <Skeleton variant="rounded" width={120} height={40} />
018675| NOTE: JSX markup for search UI.
018676| src/components/skeletons/PageSkeleton.tsx:357:         </div>
018677| NOTE: JSX markup for search UI.
018678| src/components/skeletons/PageSkeleton.tsx:358:         <div className="bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700 overflow-hidden">
018679| NOTE: Tailwind classes define layout and styling.
018680| src/components/skeletons/PageSkeleton.tsx:359:           {/* Table header */}
018681| NOTE: Implementation detail supporting search page behavior.
018682| src/components/skeletons/PageSkeleton.tsx:360:           <div className="grid grid-cols-5 gap-4 p-4 border-b border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-900">
018683| NOTE: Tailwind classes define layout and styling.
018684| src/components/skeletons/PageSkeleton.tsx:361:             {Array.from({ length: 5 }).map((_, i) => (
018685| NOTE: Implementation detail supporting search page behavior.
018686| src/components/skeletons/PageSkeleton.tsx:362:               <Skeleton key={i} variant="text" width="80%" height={14} />
018687| NOTE: JSX markup for search UI.
018688| src/components/skeletons/PageSkeleton.tsx:363:             ))}
018689| NOTE: Implementation detail supporting search page behavior.
018690| src/components/skeletons/PageSkeleton.tsx:364:           </div>
018691| NOTE: JSX markup for search UI.
018692| src/components/skeletons/PageSkeleton.tsx:365:           {/* Table rows */}
018693| NOTE: Implementation detail supporting search page behavior.
018694| src/components/skeletons/PageSkeleton.tsx:366:           {Array.from({ length: 10 }).map((_, i) => (
018695| NOTE: Implementation detail supporting search page behavior.
018696| src/components/skeletons/PageSkeleton.tsx:367:             <div
018697| NOTE: JSX markup for search UI.
018698| src/components/skeletons/PageSkeleton.tsx:368:               key={i}
018699| NOTE: Implementation detail supporting search page behavior.
018700| src/components/skeletons/PageSkeleton.tsx:369:               className="grid grid-cols-5 gap-4 p-4 border-b border-zinc-100 dark:border-zinc-800"
018701| NOTE: Tailwind classes define layout and styling.
018702| src/components/skeletons/PageSkeleton.tsx:370:             >
018703| NOTE: Implementation detail supporting search page behavior.
018704| src/components/skeletons/PageSkeleton.tsx:371:               {Array.from({ length: 5 }).map((_, j) => (
018705| NOTE: Implementation detail supporting search page behavior.
018706| src/components/skeletons/PageSkeleton.tsx:372:                 <Skeleton
018707| NOTE: JSX markup for search UI.
018708| src/components/skeletons/PageSkeleton.tsx:373:                   key={j}
018709| NOTE: Implementation detail supporting search page behavior.
018710| src/components/skeletons/PageSkeleton.tsx:374:                   variant="text"
018711| NOTE: Implementation detail supporting search page behavior.
018712| src/components/skeletons/PageSkeleton.tsx:375:                   width={`${60 + j * 10}%`}
018713| NOTE: Implementation detail supporting search page behavior.
018714| src/components/skeletons/PageSkeleton.tsx:376:                   height={16}
018715| NOTE: Implementation detail supporting search page behavior.
018716| src/components/skeletons/PageSkeleton.tsx:377:                 />
018717| NOTE: Implementation detail supporting search page behavior.
018718| src/components/skeletons/PageSkeleton.tsx:378:               ))}
018719| NOTE: Implementation detail supporting search page behavior.
018720| src/components/skeletons/PageSkeleton.tsx:379:             </div>
018721| NOTE: JSX markup for search UI.
018722| src/components/skeletons/PageSkeleton.tsx:380:           ))}
018723| NOTE: Implementation detail supporting search page behavior.
018724| src/components/skeletons/PageSkeleton.tsx:381:         </div>
018725| NOTE: JSX markup for search UI.
018726| src/components/skeletons/PageSkeleton.tsx:382:       </main>
018727| NOTE: JSX markup for search UI.
018728| src/components/skeletons/PageSkeleton.tsx:383:     </div>
018729| NOTE: JSX markup for search UI.
018730| src/components/skeletons/PageSkeleton.tsx:384:   );
018731| NOTE: Implementation detail supporting search page behavior.
018732| src/components/skeletons/PageSkeleton.tsx:385: }
018733| NOTE: Implementation detail supporting search page behavior.
018734| src/components/skeletons/PageSkeleton.tsx:386: 
018735| NOTE: Blank line for visual separation.
018736| src/components/skeletons/PageSkeleton.tsx:387: export function BookingsSkeleton() {
018737| NOTE: Exports helper or component function.
018738| src/components/skeletons/PageSkeleton.tsx:388:   return (
018739| NOTE: Return statement for component or helper output.
018740| src/components/skeletons/PageSkeleton.tsx:389:     <div
018741| NOTE: JSX markup for search UI.
018742| src/components/skeletons/PageSkeleton.tsx:390:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018743| NOTE: Tailwind classes define layout and styling.
018744| src/components/skeletons/PageSkeleton.tsx:391:       aria-busy="true"
018745| NOTE: Accessibility attribute for screen readers.
018746| src/components/skeletons/PageSkeleton.tsx:392:       aria-label="Loading bookings"
018747| NOTE: Accessibility attribute for screen readers.
018748| src/components/skeletons/PageSkeleton.tsx:393:     >
018749| NOTE: Implementation detail supporting search page behavior.
018750| src/components/skeletons/PageSkeleton.tsx:394:       <main className="mx-auto max-w-4xl px-4 py-8">
018751| NOTE: Tailwind classes define layout and styling.
018752| src/components/skeletons/PageSkeleton.tsx:395:         <div className="mb-6">
018753| NOTE: Tailwind classes define layout and styling.
018754| src/components/skeletons/PageSkeleton.tsx:396:           <Skeleton variant="text" width={180} height={32} className="mb-2" />
018755| NOTE: Tailwind classes define layout and styling.
018756| src/components/skeletons/PageSkeleton.tsx:397:         </div>
018757| NOTE: JSX markup for search UI.
018758| src/components/skeletons/PageSkeleton.tsx:398:         <div className="space-y-4">
018759| NOTE: Tailwind classes define layout and styling.
018760| src/components/skeletons/PageSkeleton.tsx:399:           {Array.from({ length: 5 }).map((_, i) => (
018761| NOTE: Implementation detail supporting search page behavior.
018762| src/components/skeletons/PageSkeleton.tsx:400:             <div
018763| NOTE: JSX markup for search UI.
018764| src/components/skeletons/PageSkeleton.tsx:401:               key={i}
018765| NOTE: Implementation detail supporting search page behavior.
018766| src/components/skeletons/PageSkeleton.tsx:402:               className="flex gap-4 p-4 bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700"
018767| NOTE: Tailwind classes define layout and styling.
018768| src/components/skeletons/PageSkeleton.tsx:403:             >
018769| NOTE: Implementation detail supporting search page behavior.
018770| src/components/skeletons/PageSkeleton.tsx:404:               <Skeleton variant="rounded" width={120} height={80} />
018771| NOTE: JSX markup for search UI.
018772| src/components/skeletons/PageSkeleton.tsx:405:               <div className="flex-1 space-y-2">
018773| NOTE: Tailwind classes define layout and styling.
018774| src/components/skeletons/PageSkeleton.tsx:406:                 <Skeleton variant="text" width="60%" height={20} />
018775| NOTE: JSX markup for search UI.
018776| src/components/skeletons/PageSkeleton.tsx:407:                 <Skeleton variant="text" width="40%" height={14} />
018777| NOTE: JSX markup for search UI.
018778| src/components/skeletons/PageSkeleton.tsx:408:                 <Skeleton variant="text" width="30%" height={14} />
018779| NOTE: JSX markup for search UI.
018780| src/components/skeletons/PageSkeleton.tsx:409:               </div>
018781| NOTE: JSX markup for search UI.
018782| src/components/skeletons/PageSkeleton.tsx:410:               <div className="text-right space-y-2">
018783| NOTE: Tailwind classes define layout and styling.
018784| src/components/skeletons/PageSkeleton.tsx:411:                 <Skeleton variant="text" width={80} height={20} />
018785| NOTE: JSX markup for search UI.
018786| src/components/skeletons/PageSkeleton.tsx:412:                 <Skeleton variant="rounded" width={100} height={32} />
018787| NOTE: JSX markup for search UI.
018788| src/components/skeletons/PageSkeleton.tsx:413:               </div>
018789| NOTE: JSX markup for search UI.
018790| src/components/skeletons/PageSkeleton.tsx:414:             </div>
018791| NOTE: JSX markup for search UI.
018792| src/components/skeletons/PageSkeleton.tsx:415:           ))}
018793| NOTE: Implementation detail supporting search page behavior.
018794| src/components/skeletons/PageSkeleton.tsx:416:         </div>
018795| NOTE: JSX markup for search UI.
018796| src/components/skeletons/PageSkeleton.tsx:417:       </main>
018797| NOTE: JSX markup for search UI.
018798| src/components/skeletons/PageSkeleton.tsx:418:     </div>
018799| NOTE: JSX markup for search UI.
018800| src/components/skeletons/PageSkeleton.tsx:419:   );
018801| NOTE: Implementation detail supporting search page behavior.
018802| src/components/skeletons/PageSkeleton.tsx:420: }
018803| NOTE: Implementation detail supporting search page behavior.
018804| src/components/skeletons/PageSkeleton.tsx:421: 
018805| NOTE: Blank line for visual separation.
018806| src/components/skeletons/PageSkeleton.tsx:422: export function SettingsSkeleton() {
018807| NOTE: Exports helper or component function.
018808| src/components/skeletons/PageSkeleton.tsx:423:   return (
018809| NOTE: Return statement for component or helper output.
018810| src/components/skeletons/PageSkeleton.tsx:424:     <div
018811| NOTE: JSX markup for search UI.
018812| src/components/skeletons/PageSkeleton.tsx:425:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018813| NOTE: Tailwind classes define layout and styling.
018814| src/components/skeletons/PageSkeleton.tsx:426:       aria-busy="true"
018815| NOTE: Accessibility attribute for screen readers.
018816| src/components/skeletons/PageSkeleton.tsx:427:       aria-label="Loading settings"
018817| NOTE: Accessibility attribute for screen readers.
018818| src/components/skeletons/PageSkeleton.tsx:428:     >
018819| NOTE: Implementation detail supporting search page behavior.
018820| src/components/skeletons/PageSkeleton.tsx:429:       <main className="mx-auto max-w-2xl px-4 py-8">
018821| NOTE: Tailwind classes define layout and styling.
018822| src/components/skeletons/PageSkeleton.tsx:430:         <div className="mb-8">
018823| NOTE: Tailwind classes define layout and styling.
018824| src/components/skeletons/PageSkeleton.tsx:431:           <Skeleton variant="text" width={150} height={32} />
018825| NOTE: JSX markup for search UI.
018826| src/components/skeletons/PageSkeleton.tsx:432:         </div>
018827| NOTE: JSX markup for search UI.
018828| src/components/skeletons/PageSkeleton.tsx:433:         <div className="space-y-6">
018829| NOTE: Tailwind classes define layout and styling.
018830| src/components/skeletons/PageSkeleton.tsx:434:           {Array.from({ length: 4 }).map((_, i) => (
018831| NOTE: Implementation detail supporting search page behavior.
018832| src/components/skeletons/PageSkeleton.tsx:435:             <section
018833| NOTE: JSX markup for search UI.
018834| src/components/skeletons/PageSkeleton.tsx:436:               key={i}
018835| NOTE: Implementation detail supporting search page behavior.
018836| src/components/skeletons/PageSkeleton.tsx:437:               className="bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700 p-6"
018837| NOTE: Tailwind classes define layout and styling.
018838| src/components/skeletons/PageSkeleton.tsx:438:             >
018839| NOTE: Implementation detail supporting search page behavior.
018840| src/components/skeletons/PageSkeleton.tsx:439:               <Skeleton
018841| NOTE: JSX markup for search UI.
018842| src/components/skeletons/PageSkeleton.tsx:440:                 variant="text"
018843| NOTE: Implementation detail supporting search page behavior.
018844| src/components/skeletons/PageSkeleton.tsx:441:                 width={140}
018845| NOTE: Implementation detail supporting search page behavior.
018846| src/components/skeletons/PageSkeleton.tsx:442:                 height={20}
018847| NOTE: Implementation detail supporting search page behavior.
018848| src/components/skeletons/PageSkeleton.tsx:443:                 className="mb-4"
018849| NOTE: Tailwind classes define layout and styling.
018850| src/components/skeletons/PageSkeleton.tsx:444:               />
018851| NOTE: Implementation detail supporting search page behavior.
018852| src/components/skeletons/PageSkeleton.tsx:445:               <div className="space-y-4">
018853| NOTE: Tailwind classes define layout and styling.
018854| src/components/skeletons/PageSkeleton.tsx:446:                 {Array.from({ length: 3 }).map((_, j) => (
018855| NOTE: Implementation detail supporting search page behavior.
018856| src/components/skeletons/PageSkeleton.tsx:447:                   <div key={j} className="flex items-center justify-between">
018857| NOTE: Tailwind classes define layout and styling.
018858| src/components/skeletons/PageSkeleton.tsx:448:                     <div className="space-y-1">
018859| NOTE: Tailwind classes define layout and styling.
018860| src/components/skeletons/PageSkeleton.tsx:449:                       <Skeleton variant="text" width={120} height={16} />
018861| NOTE: JSX markup for search UI.
018862| src/components/skeletons/PageSkeleton.tsx:450:                       <Skeleton variant="text" width={200} height={12} />
018863| NOTE: JSX markup for search UI.
018864| src/components/skeletons/PageSkeleton.tsx:451:                     </div>
018865| NOTE: JSX markup for search UI.
018866| src/components/skeletons/PageSkeleton.tsx:452:                     <Skeleton variant="rounded" width={44} height={24} />
018867| NOTE: JSX markup for search UI.
018868| src/components/skeletons/PageSkeleton.tsx:453:                   </div>
018869| NOTE: JSX markup for search UI.
018870| src/components/skeletons/PageSkeleton.tsx:454:                 ))}
018871| NOTE: Implementation detail supporting search page behavior.
018872| src/components/skeletons/PageSkeleton.tsx:455:               </div>
018873| NOTE: JSX markup for search UI.
018874| src/components/skeletons/PageSkeleton.tsx:456:             </section>
018875| NOTE: JSX markup for search UI.
018876| src/components/skeletons/PageSkeleton.tsx:457:           ))}
018877| NOTE: Implementation detail supporting search page behavior.
018878| src/components/skeletons/PageSkeleton.tsx:458:         </div>
018879| NOTE: JSX markup for search UI.
018880| src/components/skeletons/PageSkeleton.tsx:459:       </main>
018881| NOTE: JSX markup for search UI.
018882| src/components/skeletons/PageSkeleton.tsx:460:     </div>
018883| NOTE: JSX markup for search UI.
018884| src/components/skeletons/PageSkeleton.tsx:461:   );
018885| NOTE: Implementation detail supporting search page behavior.
018886| src/components/skeletons/PageSkeleton.tsx:462: }
018887| NOTE: Implementation detail supporting search page behavior.
018888| src/components/skeletons/PageSkeleton.tsx:463: 
018889| NOTE: Blank line for visual separation.
018890| src/components/skeletons/PageSkeleton.tsx:464: export function SavedSearchesSkeleton() {
018891| NOTE: Exports helper or component function.
018892| src/components/skeletons/PageSkeleton.tsx:465:   return (
018893| NOTE: Return statement for component or helper output.
018894| src/components/skeletons/PageSkeleton.tsx:466:     <div
018895| NOTE: JSX markup for search UI.
018896| src/components/skeletons/PageSkeleton.tsx:467:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018897| NOTE: Tailwind classes define layout and styling.
018898| src/components/skeletons/PageSkeleton.tsx:468:       aria-busy="true"
018899| NOTE: Accessibility attribute for screen readers.
018900| src/components/skeletons/PageSkeleton.tsx:469:       aria-label="Loading saved searches"
018901| NOTE: Accessibility attribute for screen readers.
018902| src/components/skeletons/PageSkeleton.tsx:470:     >
018903| NOTE: Implementation detail supporting search page behavior.
018904| src/components/skeletons/PageSkeleton.tsx:471:       <main className="mx-auto max-w-4xl px-4 py-8">
018905| NOTE: Tailwind classes define layout and styling.
018906| src/components/skeletons/PageSkeleton.tsx:472:         <div className="mb-6">
018907| NOTE: Tailwind classes define layout and styling.
018908| src/components/skeletons/PageSkeleton.tsx:473:           <Skeleton variant="text" width={200} height={32} className="mb-2" />
018909| NOTE: Tailwind classes define layout and styling.
018910| src/components/skeletons/PageSkeleton.tsx:474:         </div>
018911| NOTE: JSX markup for search UI.
018912| src/components/skeletons/PageSkeleton.tsx:475:         <div className="space-y-3">
018913| NOTE: Tailwind classes define layout and styling.
018914| src/components/skeletons/PageSkeleton.tsx:476:           {Array.from({ length: 6 }).map((_, i) => (
018915| NOTE: Implementation detail supporting search page behavior.
018916| src/components/skeletons/PageSkeleton.tsx:477:             <div
018917| NOTE: JSX markup for search UI.
018918| src/components/skeletons/PageSkeleton.tsx:478:               key={i}
018919| NOTE: Implementation detail supporting search page behavior.
018920| src/components/skeletons/PageSkeleton.tsx:479:               className="flex items-center justify-between p-4 bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700"
018921| NOTE: Tailwind classes define layout and styling.
018922| src/components/skeletons/PageSkeleton.tsx:480:             >
018923| NOTE: Implementation detail supporting search page behavior.
018924| src/components/skeletons/PageSkeleton.tsx:481:               <div className="space-y-2">
018925| NOTE: Tailwind classes define layout and styling.
018926| src/components/skeletons/PageSkeleton.tsx:482:                 <Skeleton variant="text" width={180} height={18} />
018927| NOTE: JSX markup for search UI.
018928| src/components/skeletons/PageSkeleton.tsx:483:                 <Skeleton variant="text" width={250} height={14} />
018929| NOTE: JSX markup for search UI.
018930| src/components/skeletons/PageSkeleton.tsx:484:               </div>
018931| NOTE: JSX markup for search UI.
018932| src/components/skeletons/PageSkeleton.tsx:485:               <div className="flex items-center gap-2">
018933| NOTE: Tailwind classes define layout and styling.
018934| src/components/skeletons/PageSkeleton.tsx:486:                 <Skeleton variant="rounded" width={80} height={32} />
018935| NOTE: JSX markup for search UI.
018936| src/components/skeletons/PageSkeleton.tsx:487:                 <Skeleton variant="circular" width={32} height={32} />
018937| NOTE: JSX markup for search UI.
018938| src/components/skeletons/PageSkeleton.tsx:488:               </div>
018939| NOTE: JSX markup for search UI.
018940| src/components/skeletons/PageSkeleton.tsx:489:             </div>
018941| NOTE: JSX markup for search UI.
018942| src/components/skeletons/PageSkeleton.tsx:490:           ))}
018943| NOTE: Implementation detail supporting search page behavior.
018944| src/components/skeletons/PageSkeleton.tsx:491:         </div>
018945| NOTE: JSX markup for search UI.
018946| src/components/skeletons/PageSkeleton.tsx:492:       </main>
018947| NOTE: JSX markup for search UI.
018948| src/components/skeletons/PageSkeleton.tsx:493:     </div>
018949| NOTE: JSX markup for search UI.
018950| src/components/skeletons/PageSkeleton.tsx:494:   );
018951| NOTE: Implementation detail supporting search page behavior.
018952| src/components/skeletons/PageSkeleton.tsx:495: }
018953| NOTE: Implementation detail supporting search page behavior.
018954| src/components/skeletons/PageSkeleton.tsx:496: 
018955| NOTE: Blank line for visual separation.
018956| src/components/skeletons/PageSkeleton.tsx:497: export function NotificationsSkeleton() {
018957| NOTE: Exports helper or component function.
018958| src/components/skeletons/PageSkeleton.tsx:498:   return (
018959| NOTE: Return statement for component or helper output.
018960| src/components/skeletons/PageSkeleton.tsx:499:     <div
018961| NOTE: JSX markup for search UI.
018962| src/components/skeletons/PageSkeleton.tsx:500:       className="min-h-screen bg-zinc-50 dark:bg-zinc-900"
018963| NOTE: Tailwind classes define layout and styling.
018964| src/components/skeletons/PageSkeleton.tsx:501:       aria-busy="true"
018965| NOTE: Accessibility attribute for screen readers.
018966| src/components/skeletons/PageSkeleton.tsx:502:       aria-label="Loading notifications"
018967| NOTE: Accessibility attribute for screen readers.
018968| src/components/skeletons/PageSkeleton.tsx:503:     >
018969| NOTE: Implementation detail supporting search page behavior.
018970| src/components/skeletons/PageSkeleton.tsx:504:       <main className="mx-auto max-w-2xl px-4 py-8">
018971| NOTE: Tailwind classes define layout and styling.
018972| src/components/skeletons/PageSkeleton.tsx:505:         <div className="mb-6">
018973| NOTE: Tailwind classes define layout and styling.
018974| src/components/skeletons/PageSkeleton.tsx:506:           <Skeleton variant="text" width={180} height={32} />
018975| NOTE: JSX markup for search UI.
018976| src/components/skeletons/PageSkeleton.tsx:507:         </div>
018977| NOTE: JSX markup for search UI.
018978| src/components/skeletons/PageSkeleton.tsx:508:         <div className="space-y-2">
018979| NOTE: Tailwind classes define layout and styling.
018980| src/components/skeletons/PageSkeleton.tsx:509:           {Array.from({ length: 10 }).map((_, i) => (
018981| NOTE: Implementation detail supporting search page behavior.
018982| src/components/skeletons/PageSkeleton.tsx:510:             <div
018983| NOTE: JSX markup for search UI.
018984| src/components/skeletons/PageSkeleton.tsx:511:               key={i}
018985| NOTE: Implementation detail supporting search page behavior.
018986| src/components/skeletons/PageSkeleton.tsx:512:               className="flex items-start gap-3 p-4 bg-white dark:bg-zinc-800 rounded-lg border border-zinc-200 dark:border-zinc-700"
018987| NOTE: Tailwind classes define layout and styling.
018988| src/components/skeletons/PageSkeleton.tsx:513:             >
018989| NOTE: Implementation detail supporting search page behavior.
018990| src/components/skeletons/PageSkeleton.tsx:514:               <Skeleton variant="circular" width={40} height={40} />
018991| NOTE: JSX markup for search UI.
018992| src/components/skeletons/PageSkeleton.tsx:515:               <div className="flex-1 space-y-2">
018993| NOTE: Tailwind classes define layout and styling.
018994| src/components/skeletons/PageSkeleton.tsx:516:                 <Skeleton variant="text" width="80%" height={16} />
018995| NOTE: JSX markup for search UI.
018996| src/components/skeletons/PageSkeleton.tsx:517:                 <Skeleton variant="text" width="60%" height={14} />
018997| NOTE: JSX markup for search UI.
018998| src/components/skeletons/PageSkeleton.tsx:518:               </div>
018999| NOTE: JSX markup for search UI.
019000| src/components/skeletons/PageSkeleton.tsx:519:               <Skeleton variant="text" width={50} height={12} />
019001| NOTE: JSX markup for search UI.
019002| src/components/skeletons/PageSkeleton.tsx:520:             </div>
019003| NOTE: JSX markup for search UI.
019004| src/components/skeletons/PageSkeleton.tsx:521:           ))}
019005| NOTE: Implementation detail supporting search page behavior.
019006| src/components/skeletons/PageSkeleton.tsx:522:         </div>
019007| NOTE: JSX markup for search UI.
019008| src/components/skeletons/PageSkeleton.tsx:523:       </main>
019009| NOTE: JSX markup for search UI.
019010| src/components/skeletons/PageSkeleton.tsx:524:     </div>
019011| NOTE: JSX markup for search UI.
019012| src/components/skeletons/PageSkeleton.tsx:525:   );
019013| NOTE: Implementation detail supporting search page behavior.
019014| src/components/skeletons/PageSkeleton.tsx:526: }
019015| NOTE: Implementation detail supporting search page behavior.
019016| FILE END: src/components/skeletons/PageSkeleton.tsx
019017| 
019018| FILE START: src/components/skeletons/Skeleton.tsx
019019| FILE ROLE: Auto-discovered dependency in search page graph.
019020| src/components/skeletons/Skeleton.tsx:1: import { type HTMLAttributes } from "react";
019021| NOTE: Imports dependency for this module.
019022| src/components/skeletons/Skeleton.tsx:2: 
019023| NOTE: Blank line for visual separation.
019024| src/components/skeletons/Skeleton.tsx:3: interface SkeletonProps extends HTMLAttributes<HTMLDivElement> {
019025| NOTE: Type declaration for search data contracts.
019026| src/components/skeletons/Skeleton.tsx:4:   variant?: "text" | "circular" | "rectangular" | "rounded";
019027| NOTE: Implementation detail supporting search page behavior.
019028| src/components/skeletons/Skeleton.tsx:5:   width?: string | number;
019029| NOTE: Implementation detail supporting search page behavior.
019030| src/components/skeletons/Skeleton.tsx:6:   height?: string | number;
019031| NOTE: Implementation detail supporting search page behavior.
019032| src/components/skeletons/Skeleton.tsx:7:   animation?: "pulse" | "shimmer" | "none";
019033| NOTE: Implementation detail supporting search page behavior.
019034| src/components/skeletons/Skeleton.tsx:8: }
019035| NOTE: Implementation detail supporting search page behavior.
019036| src/components/skeletons/Skeleton.tsx:9: 
019037| NOTE: Blank line for visual separation.
019038| src/components/skeletons/Skeleton.tsx:10: export function Skeleton({
019039| NOTE: Exports helper or component function.
019040| src/components/skeletons/Skeleton.tsx:11:   variant = "text",
019041| NOTE: Implementation detail supporting search page behavior.
019042| src/components/skeletons/Skeleton.tsx:12:   width,
019043| NOTE: Implementation detail supporting search page behavior.
019044| src/components/skeletons/Skeleton.tsx:13:   height,
019045| NOTE: Implementation detail supporting search page behavior.
019046| src/components/skeletons/Skeleton.tsx:14:   animation = "pulse",
019047| NOTE: Implementation detail supporting search page behavior.
019048| src/components/skeletons/Skeleton.tsx:15:   className = "",
019049| NOTE: Implementation detail supporting search page behavior.
019050| src/components/skeletons/Skeleton.tsx:16:   style,
019051| NOTE: Implementation detail supporting search page behavior.
019052| src/components/skeletons/Skeleton.tsx:17:   ...props
019053| NOTE: Implementation detail supporting search page behavior.
019054| src/components/skeletons/Skeleton.tsx:18: }: SkeletonProps) {
019055| NOTE: Implementation detail supporting search page behavior.
019056| src/components/skeletons/Skeleton.tsx:19:   const baseClasses = "bg-zinc-200 dark:bg-zinc-700 ";
019057| NOTE: Local declaration used by search logic or UI.
019058| src/components/skeletons/Skeleton.tsx:20: 
019059| NOTE: Blank line for visual separation.
019060| src/components/skeletons/Skeleton.tsx:21:   const variantClasses = {
019061| NOTE: Local declaration used by search logic or UI.
019062| src/components/skeletons/Skeleton.tsx:22:     text: "rounded h-4 w-full",
019063| NOTE: Implementation detail supporting search page behavior.
019064| src/components/skeletons/Skeleton.tsx:23:     circular: "rounded-full",
019065| NOTE: Implementation detail supporting search page behavior.
019066| src/components/skeletons/Skeleton.tsx:24:     rectangular: "",
019067| NOTE: Implementation detail supporting search page behavior.
019068| src/components/skeletons/Skeleton.tsx:25:     rounded: "rounded-lg",
019069| NOTE: Implementation detail supporting search page behavior.
019070| src/components/skeletons/Skeleton.tsx:26:   };
019071| NOTE: Implementation detail supporting search page behavior.
019072| src/components/skeletons/Skeleton.tsx:27: 
019073| NOTE: Blank line for visual separation.
019074| src/components/skeletons/Skeleton.tsx:28:   const animationClasses = {
019075| NOTE: Local declaration used by search logic or UI.
019076| src/components/skeletons/Skeleton.tsx:29:     pulse: "animate-pulse",
019077| NOTE: Implementation detail supporting search page behavior.
019078| src/components/skeletons/Skeleton.tsx:30:     shimmer:
019079| NOTE: Implementation detail supporting search page behavior.
019080| src/components/skeletons/Skeleton.tsx:31:       "animate-shimmer bg-gradient-to-r from-zinc-200 via-zinc-100 to-zinc-200 dark:from-zinc-700 dark:via-zinc-600 dark:to-zinc-700 bg-[length:200%_100%]",
019081| NOTE: Implementation detail supporting search page behavior.
019082| src/components/skeletons/Skeleton.tsx:32:     none: "",
019083| NOTE: Implementation detail supporting search page behavior.
019084| src/components/skeletons/Skeleton.tsx:33:   };
019085| NOTE: Implementation detail supporting search page behavior.
019086| src/components/skeletons/Skeleton.tsx:34: 
019087| NOTE: Blank line for visual separation.
019088| src/components/skeletons/Skeleton.tsx:35:   const computedStyle = {
019089| NOTE: Local declaration used by search logic or UI.
019090| src/components/skeletons/Skeleton.tsx:36:     width: typeof width === "number" ? `${width}px` : width,
019091| NOTE: Implementation detail supporting search page behavior.
019092| src/components/skeletons/Skeleton.tsx:37:     height: typeof height === "number" ? `${height}px` : height,
019093| NOTE: Implementation detail supporting search page behavior.
019094| src/components/skeletons/Skeleton.tsx:38:     ...style,
019095| NOTE: Implementation detail supporting search page behavior.
019096| src/components/skeletons/Skeleton.tsx:39:   };
019097| NOTE: Implementation detail supporting search page behavior.
019098| src/components/skeletons/Skeleton.tsx:40: 
019099| NOTE: Blank line for visual separation.
019100| src/components/skeletons/Skeleton.tsx:41:   return (
019101| NOTE: Return statement for component or helper output.
019102| src/components/skeletons/Skeleton.tsx:42:     <div
019103| NOTE: JSX markup for search UI.
019104| src/components/skeletons/Skeleton.tsx:43:       className={`${baseClasses} ${variantClasses[variant]} ${animationClasses[animation]} ${className}`}
019105| NOTE: Tailwind classes define layout and styling.
019106| src/components/skeletons/Skeleton.tsx:44:       style={computedStyle}
019107| NOTE: Implementation detail supporting search page behavior.
019108| src/components/skeletons/Skeleton.tsx:45:       aria-hidden="true"
019109| NOTE: Accessibility attribute for screen readers.
019110| src/components/skeletons/Skeleton.tsx:46:       role="presentation"
019111| NOTE: Implementation detail supporting search page behavior.
019112| src/components/skeletons/Skeleton.tsx:47:       {...props}
019113| NOTE: Implementation detail supporting search page behavior.
019114| src/components/skeletons/Skeleton.tsx:48:     />
019115| NOTE: Implementation detail supporting search page behavior.
019116| src/components/skeletons/Skeleton.tsx:49:   );
019117| NOTE: Implementation detail supporting search page behavior.
019118| src/components/skeletons/Skeleton.tsx:50: }
019119| NOTE: Implementation detail supporting search page behavior.
019120| src/components/skeletons/Skeleton.tsx:51: 
019121| NOTE: Blank line for visual separation.
019122| src/components/skeletons/Skeleton.tsx:52: // Convenience components for common skeleton patterns
019123| NOTE: Line comment documents intent or constraints.
019124| src/components/skeletons/Skeleton.tsx:53: export function TextSkeleton({
019125| NOTE: Exports helper or component function.
019126| src/components/skeletons/Skeleton.tsx:54:   lines = 3,
019127| NOTE: Implementation detail supporting search page behavior.
019128| src/components/skeletons/Skeleton.tsx:55:   className = "",
019129| NOTE: Implementation detail supporting search page behavior.
019130| src/components/skeletons/Skeleton.tsx:56: }: {
019131| NOTE: Implementation detail supporting search page behavior.
019132| src/components/skeletons/Skeleton.tsx:57:   lines?: number;
019133| NOTE: Implementation detail supporting search page behavior.
019134| src/components/skeletons/Skeleton.tsx:58:   className?: string;
019135| NOTE: Implementation detail supporting search page behavior.
019136| src/components/skeletons/Skeleton.tsx:59: }) {
019137| NOTE: Implementation detail supporting search page behavior.
019138| src/components/skeletons/Skeleton.tsx:60:   return (
019139| NOTE: Return statement for component or helper output.
019140| src/components/skeletons/Skeleton.tsx:61:     <div
019141| NOTE: JSX markup for search UI.
019142| src/components/skeletons/Skeleton.tsx:62:       className={`space-y-2 ${className}`}
019143| NOTE: Tailwind classes define layout and styling.
019144| src/components/skeletons/Skeleton.tsx:63:       aria-hidden="true"
019145| NOTE: Accessibility attribute for screen readers.
019146| src/components/skeletons/Skeleton.tsx:64:       role="presentation"
019147| NOTE: Implementation detail supporting search page behavior.
019148| src/components/skeletons/Skeleton.tsx:65:     >
019149| NOTE: Implementation detail supporting search page behavior.
019150| src/components/skeletons/Skeleton.tsx:66:       {Array.from({ length: lines }).map((_, i) => (
019151| NOTE: Implementation detail supporting search page behavior.
019152| src/components/skeletons/Skeleton.tsx:67:         <Skeleton
019153| NOTE: JSX markup for search UI.
019154| src/components/skeletons/Skeleton.tsx:68:           key={i}
019155| NOTE: Implementation detail supporting search page behavior.
019156| src/components/skeletons/Skeleton.tsx:69:           variant="text"
019157| NOTE: Implementation detail supporting search page behavior.
019158| src/components/skeletons/Skeleton.tsx:70:           width={i === lines - 1 ? "75%" : "100%"}
019159| NOTE: Implementation detail supporting search page behavior.
019160| src/components/skeletons/Skeleton.tsx:71:         />
019161| NOTE: Implementation detail supporting search page behavior.
019162| src/components/skeletons/Skeleton.tsx:72:       ))}
019163| NOTE: Implementation detail supporting search page behavior.
019164| src/components/skeletons/Skeleton.tsx:73:     </div>
019165| NOTE: JSX markup for search UI.
019166| src/components/skeletons/Skeleton.tsx:74:   );
019167| NOTE: Implementation detail supporting search page behavior.
019168| src/components/skeletons/Skeleton.tsx:75: }
019169| NOTE: Implementation detail supporting search page behavior.
019170| src/components/skeletons/Skeleton.tsx:76: 
019171| NOTE: Blank line for visual separation.
019172| src/components/skeletons/Skeleton.tsx:77: export function AvatarSkeleton({ size = 40 }: { size?: number }) {
019173| NOTE: Exports helper or component function.
019174| src/components/skeletons/Skeleton.tsx:78:   return <Skeleton variant="circular" width={size} height={size} />;
019175| NOTE: Return statement for component or helper output.
019176| src/components/skeletons/Skeleton.tsx:79: }
019177| NOTE: Implementation detail supporting search page behavior.
019178| src/components/skeletons/Skeleton.tsx:80: 
019179| NOTE: Blank line for visual separation.
019180| src/components/skeletons/Skeleton.tsx:81: export function CardSkeleton({ className = "" }: { className?: string }) {
019181| NOTE: Exports helper or component function.
019182| src/components/skeletons/Skeleton.tsx:82:   return (
019183| NOTE: Return statement for component or helper output.
019184| src/components/skeletons/Skeleton.tsx:83:     <div
019185| NOTE: JSX markup for search UI.
019186| src/components/skeletons/Skeleton.tsx:84:       className={`rounded-lg border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 p-4 ${className}`}
019187| NOTE: Tailwind classes define layout and styling.
019188| src/components/skeletons/Skeleton.tsx:85:       aria-hidden="true"
019189| NOTE: Accessibility attribute for screen readers.
019190| src/components/skeletons/Skeleton.tsx:86:       role="presentation"
019191| NOTE: Implementation detail supporting search page behavior.
019192| src/components/skeletons/Skeleton.tsx:87:     >
019193| NOTE: Implementation detail supporting search page behavior.
019194| src/components/skeletons/Skeleton.tsx:88:       <div className="flex items-center gap-3 mb-4">
019195| NOTE: Tailwind classes define layout and styling.
019196| src/components/skeletons/Skeleton.tsx:89:         <AvatarSkeleton />
019197| NOTE: JSX markup for search UI.
019198| src/components/skeletons/Skeleton.tsx:90:         <div className="flex-1 space-y-2">
019199| NOTE: Tailwind classes define layout and styling.
019200| src/components/skeletons/Skeleton.tsx:91:           <Skeleton variant="text" width="60%" />
019201| NOTE: JSX markup for search UI.
019202| src/components/skeletons/Skeleton.tsx:92:           <Skeleton variant="text" width="40%" height={12} />
019203| NOTE: JSX markup for search UI.
019204| src/components/skeletons/Skeleton.tsx:93:         </div>
019205| NOTE: JSX markup for search UI.
019206| src/components/skeletons/Skeleton.tsx:94:       </div>
019207| NOTE: JSX markup for search UI.
019208| src/components/skeletons/Skeleton.tsx:95:       <Skeleton variant="rounded" height={160} className="mb-4" />
019209| NOTE: Tailwind classes define layout and styling.
019210| src/components/skeletons/Skeleton.tsx:96:       <TextSkeleton lines={2} />
019211| NOTE: JSX markup for search UI.
019212| src/components/skeletons/Skeleton.tsx:97:     </div>
019213| NOTE: JSX markup for search UI.
019214| src/components/skeletons/Skeleton.tsx:98:   );
019215| NOTE: Implementation detail supporting search page behavior.
019216| src/components/skeletons/Skeleton.tsx:99: }
019217| NOTE: Implementation detail supporting search page behavior.
019218| src/components/skeletons/Skeleton.tsx:100: 
019219| NOTE: Blank line for visual separation.
019220| src/components/skeletons/Skeleton.tsx:101: export function ListItemSkeleton({ className = "" }: { className?: string }) {
019221| NOTE: Exports helper or component function.
019222| src/components/skeletons/Skeleton.tsx:102:   return (
019223| NOTE: Return statement for component or helper output.
019224| src/components/skeletons/Skeleton.tsx:103:     <div
019225| NOTE: JSX markup for search UI.
019226| src/components/skeletons/Skeleton.tsx:104:       className={`flex items-center gap-3 p-3 ${className}`}
019227| NOTE: Tailwind classes define layout and styling.
019228| src/components/skeletons/Skeleton.tsx:105:       aria-hidden="true"
019229| NOTE: Accessibility attribute for screen readers.
019230| src/components/skeletons/Skeleton.tsx:106:       role="presentation"
019231| NOTE: Implementation detail supporting search page behavior.
019232| src/components/skeletons/Skeleton.tsx:107:     >
019233| NOTE: Implementation detail supporting search page behavior.
019234| src/components/skeletons/Skeleton.tsx:108:       <AvatarSkeleton size={32} />
019235| NOTE: JSX markup for search UI.
019236| src/components/skeletons/Skeleton.tsx:109:       <div className="flex-1 space-y-2">
019237| NOTE: Tailwind classes define layout and styling.
019238| src/components/skeletons/Skeleton.tsx:110:         <Skeleton variant="text" width="70%" />
019239| NOTE: JSX markup for search UI.
019240| src/components/skeletons/Skeleton.tsx:111:         <Skeleton variant="text" width="50%" height={12} />
019241| NOTE: JSX markup for search UI.
019242| src/components/skeletons/Skeleton.tsx:112:       </div>
019243| NOTE: JSX markup for search UI.
019244| src/components/skeletons/Skeleton.tsx:113:     </div>
019245| NOTE: JSX markup for search UI.
019246| src/components/skeletons/Skeleton.tsx:114:   );
019247| NOTE: Implementation detail supporting search page behavior.
019248| src/components/skeletons/Skeleton.tsx:115: }
019249| NOTE: Implementation detail supporting search page behavior.
019250| src/components/skeletons/Skeleton.tsx:116: 
019251| NOTE: Blank line for visual separation.
019252| src/components/skeletons/Skeleton.tsx:117: // Deterministic widths to avoid Math.random() during render
019253| NOTE: Line comment documents intent or constraints.
019254| src/components/skeletons/Skeleton.tsx:118: const SKELETON_WIDTHS = [75, 60, 85, 70, 65, 80, 72, 68, 78, 62];
019255| NOTE: Local declaration used by search logic or UI.
019256| src/components/skeletons/Skeleton.tsx:119: 
019257| NOTE: Blank line for visual separation.
019258| src/components/skeletons/Skeleton.tsx:120: export function TableRowSkeleton({
019259| NOTE: Exports helper or component function.
019260| src/components/skeletons/Skeleton.tsx:121:   columns = 4,
019261| NOTE: Implementation detail supporting search page behavior.
019262| src/components/skeletons/Skeleton.tsx:122:   className = "",
019263| NOTE: Implementation detail supporting search page behavior.
019264| src/components/skeletons/Skeleton.tsx:123: }: {
019265| NOTE: Implementation detail supporting search page behavior.
019266| src/components/skeletons/Skeleton.tsx:124:   columns?: number;
019267| NOTE: Implementation detail supporting search page behavior.
019268| src/components/skeletons/Skeleton.tsx:125:   className?: string;
019269| NOTE: Implementation detail supporting search page behavior.
019270| src/components/skeletons/Skeleton.tsx:126: }) {
019271| NOTE: Implementation detail supporting search page behavior.
019272| src/components/skeletons/Skeleton.tsx:127:   return (
019273| NOTE: Return statement for component or helper output.
019274| src/components/skeletons/Skeleton.tsx:128:     <tr className={className} aria-hidden="true" role="presentation">
019275| NOTE: Tailwind classes define layout and styling.
019276| src/components/skeletons/Skeleton.tsx:129:       {Array.from({ length: columns }).map((_, i) => (
019277| NOTE: Implementation detail supporting search page behavior.
019278| src/components/skeletons/Skeleton.tsx:130:         <td key={i} className="p-3">
019279| NOTE: Tailwind classes define layout and styling.
019280| src/components/skeletons/Skeleton.tsx:131:           <Skeleton
019281| NOTE: JSX markup for search UI.
019282| src/components/skeletons/Skeleton.tsx:132:             variant="text"
019283| NOTE: Implementation detail supporting search page behavior.
019284| src/components/skeletons/Skeleton.tsx:133:             width={`${SKELETON_WIDTHS[i % SKELETON_WIDTHS.length]}%`}
019285| NOTE: Implementation detail supporting search page behavior.
019286| src/components/skeletons/Skeleton.tsx:134:           />
019287| NOTE: Implementation detail supporting search page behavior.
019288| src/components/skeletons/Skeleton.tsx:135:         </td>
019289| NOTE: JSX markup for search UI.
019290| src/components/skeletons/Skeleton.tsx:136:       ))}
019291| NOTE: Implementation detail supporting search page behavior.
019292| src/components/skeletons/Skeleton.tsx:137:     </tr>
019293| NOTE: JSX markup for search UI.
019294| src/components/skeletons/Skeleton.tsx:138:   );
019295| NOTE: Implementation detail supporting search page behavior.
019296| src/components/skeletons/Skeleton.tsx:139: }
019297| NOTE: Implementation detail supporting search page behavior.
019298| src/components/skeletons/Skeleton.tsx:140: 
019299| NOTE: Blank line for visual separation.
019300| src/components/skeletons/Skeleton.tsx:141: export function ImageSkeleton({
019301| NOTE: Exports helper or component function.
019302| src/components/skeletons/Skeleton.tsx:142:   width = "100%",
019303| NOTE: Implementation detail supporting search page behavior.
019304| src/components/skeletons/Skeleton.tsx:143:   height = 200,
019305| NOTE: Implementation detail supporting search page behavior.
019306| src/components/skeletons/Skeleton.tsx:144:   className = "",
019307| NOTE: Implementation detail supporting search page behavior.
019308| src/components/skeletons/Skeleton.tsx:145: }: {
019309| NOTE: Implementation detail supporting search page behavior.
019310| src/components/skeletons/Skeleton.tsx:146:   width?: string | number;
019311| NOTE: Implementation detail supporting search page behavior.
019312| src/components/skeletons/Skeleton.tsx:147:   height?: string | number;
019313| NOTE: Implementation detail supporting search page behavior.
019314| src/components/skeletons/Skeleton.tsx:148:   className?: string;
019315| NOTE: Implementation detail supporting search page behavior.
019316| src/components/skeletons/Skeleton.tsx:149: }) {
019317| NOTE: Implementation detail supporting search page behavior.
019318| src/components/skeletons/Skeleton.tsx:150:   return (
019319| NOTE: Return statement for component or helper output.
019320| src/components/skeletons/Skeleton.tsx:151:     <Skeleton
019321| NOTE: JSX markup for search UI.
019322| src/components/skeletons/Skeleton.tsx:152:       variant="rounded"
019323| NOTE: Implementation detail supporting search page behavior.
019324| src/components/skeletons/Skeleton.tsx:153:       width={width}
019325| NOTE: Implementation detail supporting search page behavior.
019326| src/components/skeletons/Skeleton.tsx:154:       height={height}
019327| NOTE: Implementation detail supporting search page behavior.
019328| src/components/skeletons/Skeleton.tsx:155:       className={className}
019329| NOTE: Tailwind classes define layout and styling.
019330| src/components/skeletons/Skeleton.tsx:156:     />
019331| NOTE: Implementation detail supporting search page behavior.
019332| src/components/skeletons/Skeleton.tsx:157:   );
019333| NOTE: Implementation detail supporting search page behavior.
019334| src/components/skeletons/Skeleton.tsx:158: }
019335| NOTE: Implementation detail supporting search page behavior.
019336| FILE END: src/components/skeletons/Skeleton.tsx
019337| 
019338| FILE START: src/components/ui/FocusTrap.tsx
019339| FILE ROLE: Auto-discovered dependency in search page graph.
019340| src/components/ui/FocusTrap.tsx:1: "use client";
019341| NOTE: Implementation detail supporting search page behavior.
019342| src/components/ui/FocusTrap.tsx:2: 
019343| NOTE: Blank line for visual separation.
019344| src/components/ui/FocusTrap.tsx:3: import { useEffect, useRef, type ReactNode } from "react";
019345| NOTE: Imports dependency for this module.
019346| src/components/ui/FocusTrap.tsx:4: 
019347| NOTE: Blank line for visual separation.
019348| src/components/ui/FocusTrap.tsx:5: interface FocusTrapProps {
019349| NOTE: Type declaration for search data contracts.
019350| src/components/ui/FocusTrap.tsx:6:   children: ReactNode;
019351| NOTE: Implementation detail supporting search page behavior.
019352| src/components/ui/FocusTrap.tsx:7:   active?: boolean;
019353| NOTE: Implementation detail supporting search page behavior.
019354| src/components/ui/FocusTrap.tsx:8:   returnFocus?: boolean;
019355| NOTE: Implementation detail supporting search page behavior.
019356| src/components/ui/FocusTrap.tsx:9: }
019357| NOTE: Implementation detail supporting search page behavior.
019358| src/components/ui/FocusTrap.tsx:10: 
019359| NOTE: Blank line for visual separation.
019360| src/components/ui/FocusTrap.tsx:11: const FOCUSABLE_SELECTORS = [
019361| NOTE: Local declaration used by search logic or UI.
019362| src/components/ui/FocusTrap.tsx:12:   "a[href]",
019363| NOTE: Implementation detail supporting search page behavior.
019364| src/components/ui/FocusTrap.tsx:13:   "button:not([disabled])",
019365| NOTE: Implementation detail supporting search page behavior.
019366| src/components/ui/FocusTrap.tsx:14:   "input:not([disabled])",
019367| NOTE: Implementation detail supporting search page behavior.
019368| src/components/ui/FocusTrap.tsx:15:   "select:not([disabled])",
019369| NOTE: Implementation detail supporting search page behavior.
019370| src/components/ui/FocusTrap.tsx:16:   "textarea:not([disabled])",
019371| NOTE: Implementation detail supporting search page behavior.
019372| src/components/ui/FocusTrap.tsx:17:   "[tabindex]:not([tabindex='-1'])",
019373| NOTE: Implementation detail supporting search page behavior.
019374| src/components/ui/FocusTrap.tsx:18:   "audio[controls]",
019375| NOTE: Implementation detail supporting search page behavior.
019376| src/components/ui/FocusTrap.tsx:19:   "video[controls]",
019377| NOTE: Implementation detail supporting search page behavior.
019378| src/components/ui/FocusTrap.tsx:20:   "[contenteditable]:not([contenteditable='false'])",
019379| NOTE: Implementation detail supporting search page behavior.
019380| src/components/ui/FocusTrap.tsx:21: ].join(", ");
019381| NOTE: Implementation detail supporting search page behavior.
019382| src/components/ui/FocusTrap.tsx:22: 
019383| NOTE: Blank line for visual separation.
019384| src/components/ui/FocusTrap.tsx:23: export function FocusTrap({
019385| NOTE: Exports helper or component function.
019386| src/components/ui/FocusTrap.tsx:24:   children,
019387| NOTE: Implementation detail supporting search page behavior.
019388| src/components/ui/FocusTrap.tsx:25:   active = true,
019389| NOTE: Implementation detail supporting search page behavior.
019390| src/components/ui/FocusTrap.tsx:26:   returnFocus = true,
019391| NOTE: Implementation detail supporting search page behavior.
019392| src/components/ui/FocusTrap.tsx:27: }: FocusTrapProps) {
019393| NOTE: Implementation detail supporting search page behavior.
019394| src/components/ui/FocusTrap.tsx:28:   const containerRef = useRef<HTMLDivElement>(null);
019395| NOTE: Uses ref for stable mutable storage between renders.
019396| src/components/ui/FocusTrap.tsx:29:   const previousActiveElement = useRef<HTMLElement | null>(null);
019397| NOTE: Uses ref for stable mutable storage between renders.
019398| src/components/ui/FocusTrap.tsx:30: 
019399| NOTE: Blank line for visual separation.
019400| src/components/ui/FocusTrap.tsx:31:   useEffect(() => {
019401| NOTE: Defines side effect for syncing with external state.
019402| src/components/ui/FocusTrap.tsx:32:     if (!active) return;
019403| NOTE: Conditional logic controlling rendering or flow.
019404| src/components/ui/FocusTrap.tsx:33: 
019405| NOTE: Blank line for visual separation.
019406| src/components/ui/FocusTrap.tsx:34:     // Store the previously focused element
019407| NOTE: Line comment documents intent or constraints.
019408| src/components/ui/FocusTrap.tsx:35:     previousActiveElement.current = document.activeElement as HTMLElement;
019409| NOTE: Implementation detail supporting search page behavior.
019410| src/components/ui/FocusTrap.tsx:36: 
019411| NOTE: Blank line for visual separation.
019412| src/components/ui/FocusTrap.tsx:37:     const container = containerRef.current;
019413| NOTE: Local declaration used by search logic or UI.
019414| src/components/ui/FocusTrap.tsx:38:     if (!container) return;
019415| NOTE: Conditional logic controlling rendering or flow.
019416| src/components/ui/FocusTrap.tsx:39: 
019417| NOTE: Blank line for visual separation.
019418| src/components/ui/FocusTrap.tsx:40:     // Focus the first focusable element
019419| NOTE: Line comment documents intent or constraints.
019420| src/components/ui/FocusTrap.tsx:41:     const focusableElements =
019421| NOTE: Local declaration used by search logic or UI.
019422| src/components/ui/FocusTrap.tsx:42:       container.querySelectorAll<HTMLElement>(FOCUSABLE_SELECTORS);
019423| NOTE: Implementation detail supporting search page behavior.
019424| src/components/ui/FocusTrap.tsx:43:     if (focusableElements.length > 0) {
019425| NOTE: Conditional logic controlling rendering or flow.
019426| src/components/ui/FocusTrap.tsx:44:       focusableElements[0].focus();
019427| NOTE: Implementation detail supporting search page behavior.
019428| src/components/ui/FocusTrap.tsx:45:     }
019429| NOTE: Implementation detail supporting search page behavior.
019430| src/components/ui/FocusTrap.tsx:46: 
019431| NOTE: Blank line for visual separation.
019432| src/components/ui/FocusTrap.tsx:47:     const handleKeyDown = (event: KeyboardEvent) => {
019433| NOTE: Local declaration used by search logic or UI.
019434| src/components/ui/FocusTrap.tsx:48:       if (event.key !== "Tab") return;
019435| NOTE: Conditional logic controlling rendering or flow.
019436| src/components/ui/FocusTrap.tsx:49: 
019437| NOTE: Blank line for visual separation.
019438| src/components/ui/FocusTrap.tsx:50:       const focusableElements =
019439| NOTE: Local declaration used by search logic or UI.
019440| src/components/ui/FocusTrap.tsx:51:         container.querySelectorAll<HTMLElement>(FOCUSABLE_SELECTORS);
019441| NOTE: Implementation detail supporting search page behavior.
019442| src/components/ui/FocusTrap.tsx:52:       if (focusableElements.length === 0) return;
019443| NOTE: Conditional logic controlling rendering or flow.
019444| src/components/ui/FocusTrap.tsx:53: 
019445| NOTE: Blank line for visual separation.
019446| src/components/ui/FocusTrap.tsx:54:       const firstElement = focusableElements[0];
019447| NOTE: Local declaration used by search logic or UI.
019448| src/components/ui/FocusTrap.tsx:55:       const lastElement = focusableElements[focusableElements.length - 1];
019449| NOTE: Local declaration used by search logic or UI.
019450| src/components/ui/FocusTrap.tsx:56: 
019451| NOTE: Blank line for visual separation.
019452| src/components/ui/FocusTrap.tsx:57:       if (event.shiftKey) {
019453| NOTE: Conditional logic controlling rendering or flow.
019454| src/components/ui/FocusTrap.tsx:58:         // Shift + Tab
019455| NOTE: Line comment documents intent or constraints.
019456| src/components/ui/FocusTrap.tsx:59:         if (document.activeElement === firstElement) {
019457| NOTE: Conditional logic controlling rendering or flow.
019458| src/components/ui/FocusTrap.tsx:60:           event.preventDefault();
019459| NOTE: Implementation detail supporting search page behavior.
019460| src/components/ui/FocusTrap.tsx:61:           lastElement.focus();
019461| NOTE: Implementation detail supporting search page behavior.
019462| src/components/ui/FocusTrap.tsx:62:         }
019463| NOTE: Implementation detail supporting search page behavior.
019464| src/components/ui/FocusTrap.tsx:63:       } else {
019465| NOTE: Implementation detail supporting search page behavior.
019466| src/components/ui/FocusTrap.tsx:64:         // Tab
019467| NOTE: Line comment documents intent or constraints.
019468| src/components/ui/FocusTrap.tsx:65:         if (document.activeElement === lastElement) {
019469| NOTE: Conditional logic controlling rendering or flow.
019470| src/components/ui/FocusTrap.tsx:66:           event.preventDefault();
019471| NOTE: Implementation detail supporting search page behavior.
019472| src/components/ui/FocusTrap.tsx:67:           firstElement.focus();
019473| NOTE: Implementation detail supporting search page behavior.
019474| src/components/ui/FocusTrap.tsx:68:         }
019475| NOTE: Implementation detail supporting search page behavior.
019476| src/components/ui/FocusTrap.tsx:69:       }
019477| NOTE: Implementation detail supporting search page behavior.
019478| src/components/ui/FocusTrap.tsx:70:     };
019479| NOTE: Implementation detail supporting search page behavior.
019480| src/components/ui/FocusTrap.tsx:71: 
019481| NOTE: Blank line for visual separation.
019482| src/components/ui/FocusTrap.tsx:72:     document.addEventListener("keydown", handleKeyDown);
019483| NOTE: Implementation detail supporting search page behavior.
019484| src/components/ui/FocusTrap.tsx:73: 
019485| NOTE: Blank line for visual separation.
019486| src/components/ui/FocusTrap.tsx:74:     return () => {
019487| NOTE: Return statement for component or helper output.
019488| src/components/ui/FocusTrap.tsx:75:       document.removeEventListener("keydown", handleKeyDown);
019489| NOTE: Implementation detail supporting search page behavior.
019490| src/components/ui/FocusTrap.tsx:76: 
019491| NOTE: Blank line for visual separation.
019492| src/components/ui/FocusTrap.tsx:77:       // Return focus to the previously focused element
019493| NOTE: Line comment documents intent or constraints.
019494| src/components/ui/FocusTrap.tsx:78:       if (returnFocus && previousActiveElement.current) {
019495| NOTE: Conditional logic controlling rendering or flow.
019496| src/components/ui/FocusTrap.tsx:79:         previousActiveElement.current.focus();
019497| NOTE: Implementation detail supporting search page behavior.
019498| src/components/ui/FocusTrap.tsx:80:       }
019499| NOTE: Implementation detail supporting search page behavior.
019500| src/components/ui/FocusTrap.tsx:81:     };
019501| NOTE: Implementation detail supporting search page behavior.
019502| src/components/ui/FocusTrap.tsx:82:   }, [active, returnFocus]);
019503| NOTE: Implementation detail supporting search page behavior.
019504| src/components/ui/FocusTrap.tsx:83: 
019505| NOTE: Blank line for visual separation.
019506| src/components/ui/FocusTrap.tsx:84:   return (
019507| NOTE: Return statement for component or helper output.
019508| src/components/ui/FocusTrap.tsx:85:     <div ref={containerRef} role="dialog" aria-modal="true">
019509| NOTE: Accessibility attribute for screen readers.
019510| src/components/ui/FocusTrap.tsx:86:       {children}
019511| NOTE: Implementation detail supporting search page behavior.
019512| src/components/ui/FocusTrap.tsx:87:     </div>
019513| NOTE: JSX markup for search UI.
019514| src/components/ui/FocusTrap.tsx:88:   );
019515| NOTE: Implementation detail supporting search page behavior.
019516| src/components/ui/FocusTrap.tsx:89: }
019517| NOTE: Implementation detail supporting search page behavior.
019518| FILE END: src/components/ui/FocusTrap.tsx
019519| 
019520| FILE START: src/components/ui/button.tsx
019521| FILE ROLE: Auto-discovered dependency in search page graph.
019522| src/components/ui/button.tsx:1: import * as React from "react";
019523| NOTE: Imports dependency for this module.
019524| src/components/ui/button.tsx:2: import { Slot } from "@radix-ui/react-slot";
019525| NOTE: Imports dependency for this module.
019526| src/components/ui/button.tsx:3: import { clsx, type ClassValue } from "clsx";
019527| NOTE: Imports dependency for this module.
019528| src/components/ui/button.tsx:4: import { twMerge } from "tailwind-merge";
019529| NOTE: Imports dependency for this module.
019530| src/components/ui/button.tsx:5: 
019531| NOTE: Blank line for visual separation.
019532| src/components/ui/button.tsx:6: function cn(...inputs: ClassValue[]) {
019533| NOTE: Defines a helper or component function.
019534| src/components/ui/button.tsx:7:   return twMerge(clsx(inputs));
019535| NOTE: Return statement for component or helper output.
019536| src/components/ui/button.tsx:8: }
019537| NOTE: Implementation detail supporting search page behavior.
019538| src/components/ui/button.tsx:9: 
019539| NOTE: Blank line for visual separation.
019540| src/components/ui/button.tsx:10: const variantClasses = {
019541| NOTE: Local declaration used by search logic or UI.
019542| src/components/ui/button.tsx:11:   primary:
019543| NOTE: Implementation detail supporting search page behavior.
019544| src/components/ui/button.tsx:12:     "bg-zinc-900 text-white hover:bg-zinc-800 shadow-sm hover:shadow-md focus-visible:ring-zinc-900/20 dark:bg-white dark:text-zinc-900 dark:hover:bg-zinc-100 dark:focus-visible:ring-zinc-400/20",
019545| NOTE: Implementation detail supporting search page behavior.
019546| src/components/ui/button.tsx:13:   outline:
019547| NOTE: Implementation detail supporting search page behavior.
019548| src/components/ui/button.tsx:14:     "border border-zinc-200 bg-transparent hover:bg-zinc-50 text-zinc-900 focus-visible:ring-zinc-900/20 dark:border-zinc-700 dark:text-white dark:hover:bg-zinc-800 dark:focus-visible:ring-zinc-400/20",
019549| NOTE: Implementation detail supporting search page behavior.
019550| src/components/ui/button.tsx:15:   ghost:
019551| NOTE: Implementation detail supporting search page behavior.
019552| src/components/ui/button.tsx:16:     "text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100 focus-visible:ring-zinc-900/20 dark:text-zinc-400 dark:hover:text-white dark:hover:bg-zinc-800 dark:focus-visible:ring-zinc-400/20",
019553| NOTE: Implementation detail supporting search page behavior.
019554| src/components/ui/button.tsx:17:   white:
019555| NOTE: Implementation detail supporting search page behavior.
019556| src/components/ui/button.tsx:18:     "bg-white text-zinc-900 hover:bg-zinc-50 shadow-sm border border-zinc-100 focus-visible:ring-zinc-900/20 dark:bg-zinc-800 dark:text-white dark:hover:bg-zinc-700 dark:border-zinc-700 dark:focus-visible:ring-zinc-400/20",
019557| NOTE: Implementation detail supporting search page behavior.
019558| src/components/ui/button.tsx:19:   destructive:
019559| NOTE: Implementation detail supporting search page behavior.
019560| src/components/ui/button.tsx:20:     "bg-red-600 text-white hover:bg-red-700 shadow-sm focus-visible:ring-red-600/20",
019561| NOTE: Implementation detail supporting search page behavior.
019562| src/components/ui/button.tsx:21:   success:
019563| NOTE: Implementation detail supporting search page behavior.
019564| src/components/ui/button.tsx:22:     "bg-green-600 text-white hover:bg-green-700 shadow-sm focus-visible:ring-green-600/20",
019565| NOTE: Implementation detail supporting search page behavior.
019566| src/components/ui/button.tsx:23:   warning:
019567| NOTE: Implementation detail supporting search page behavior.
019568| src/components/ui/button.tsx:24:     "bg-amber-500 text-white hover:bg-amber-600 shadow-sm focus-visible:ring-amber-500/20",
019569| NOTE: Implementation detail supporting search page behavior.
019570| src/components/ui/button.tsx:25:   filter:
019571| NOTE: Implementation detail supporting search page behavior.
019572| src/components/ui/button.tsx:26:     "border border-zinc-200 bg-white text-zinc-600 hover:bg-zinc-50 data-[active=true]:bg-zinc-900 data-[active=true]:text-white data-[active=true]:border-zinc-900 focus-visible:ring-zinc-900/20 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-700 dark:data-[active=true]:bg-white dark:data-[active=true]:text-zinc-900 dark:data-[active=true]:border-white dark:focus-visible:ring-zinc-400/20",
019573| NOTE: Implementation detail supporting search page behavior.
019574| src/components/ui/button.tsx:27: };
019575| NOTE: Implementation detail supporting search page behavior.
019576| src/components/ui/button.tsx:28: 
019577| NOTE: Blank line for visual separation.
019578| src/components/ui/button.tsx:29: const sizeClasses = {
019579| NOTE: Local declaration used by search logic or UI.
019580| src/components/ui/button.tsx:30:   default: "h-10 px-4 py-2 text-sm",
019581| NOTE: Implementation detail supporting search page behavior.
019582| src/components/ui/button.tsx:31:   sm: "h-9 px-3 text-xs",
019583| NOTE: Implementation detail supporting search page behavior.
019584| src/components/ui/button.tsx:32:   lg: "h-12 sm:h-14 px-6 sm:px-10 text-sm sm:text-base",
019585| NOTE: Implementation detail supporting search page behavior.
019586| src/components/ui/button.tsx:33:   icon: "h-10 w-10 p-0",
019587| NOTE: Implementation detail supporting search page behavior.
019588| src/components/ui/button.tsx:34: };
019589| NOTE: Implementation detail supporting search page behavior.
019590| src/components/ui/button.tsx:35: 
019591| NOTE: Blank line for visual separation.
019592| src/components/ui/button.tsx:36: const baseClasses =
019593| NOTE: Local declaration used by search logic or UI.
019594| src/components/ui/button.tsx:37:   "inline-flex items-center justify-center rounded-full font-medium transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none active:scale-[0.98]";
019595| NOTE: Implementation detail supporting search page behavior.
019596| src/components/ui/button.tsx:38: 
019597| NOTE: Blank line for visual separation.
019598| src/components/ui/button.tsx:39: export interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
019599| NOTE: Implementation detail supporting search page behavior.
019600| src/components/ui/button.tsx:40:   asChild?: boolean;
019601| NOTE: Implementation detail supporting search page behavior.
019602| src/components/ui/button.tsx:41:   variant?: keyof typeof variantClasses;
019603| NOTE: Implementation detail supporting search page behavior.
019604| src/components/ui/button.tsx:42:   size?: keyof typeof sizeClasses;
019605| NOTE: Implementation detail supporting search page behavior.
019606| src/components/ui/button.tsx:43: }
019607| NOTE: Implementation detail supporting search page behavior.
019608| src/components/ui/button.tsx:44: 
019609| NOTE: Blank line for visual separation.
019610| src/components/ui/button.tsx:45: export function buttonVariants({
019611| NOTE: Exports helper or component function.
019612| src/components/ui/button.tsx:46:   variant = "primary",
019613| NOTE: Implementation detail supporting search page behavior.
019614| src/components/ui/button.tsx:47:   size = "default",
019615| NOTE: Implementation detail supporting search page behavior.
019616| src/components/ui/button.tsx:48:   className = "",
019617| NOTE: Implementation detail supporting search page behavior.
019618| src/components/ui/button.tsx:49: }: {
019619| NOTE: Implementation detail supporting search page behavior.
019620| src/components/ui/button.tsx:50:   variant?: keyof typeof variantClasses;
019621| NOTE: Implementation detail supporting search page behavior.
019622| src/components/ui/button.tsx:51:   size?: keyof typeof sizeClasses;
019623| NOTE: Implementation detail supporting search page behavior.
019624| src/components/ui/button.tsx:52:   className?: string;
019625| NOTE: Implementation detail supporting search page behavior.
019626| src/components/ui/button.tsx:53: } = {}) {
019627| NOTE: Implementation detail supporting search page behavior.
019628| src/components/ui/button.tsx:54:   return cn(baseClasses, variantClasses[variant], sizeClasses[size], className);
019629| NOTE: Return statement for component or helper output.
019630| src/components/ui/button.tsx:55: }
019631| NOTE: Implementation detail supporting search page behavior.
019632| src/components/ui/button.tsx:56: 
019633| NOTE: Blank line for visual separation.
019634| src/components/ui/button.tsx:57: const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
019635| NOTE: Local declaration used by search logic or UI.
019636| src/components/ui/button.tsx:58:   (
019637| NOTE: Implementation detail supporting search page behavior.
019638| src/components/ui/button.tsx:59:     {
019639| NOTE: Implementation detail supporting search page behavior.
019640| src/components/ui/button.tsx:60:       className,
019641| NOTE: Implementation detail supporting search page behavior.
019642| src/components/ui/button.tsx:61:       variant = "primary",
019643| NOTE: Implementation detail supporting search page behavior.
019644| src/components/ui/button.tsx:62:       size = "default",
019645| NOTE: Implementation detail supporting search page behavior.
019646| src/components/ui/button.tsx:63:       asChild = false,
019647| NOTE: Implementation detail supporting search page behavior.
019648| src/components/ui/button.tsx:64:       ...props
019649| NOTE: Implementation detail supporting search page behavior.
019650| src/components/ui/button.tsx:65:     },
019651| NOTE: Implementation detail supporting search page behavior.
019652| src/components/ui/button.tsx:66:     ref,
019653| NOTE: Implementation detail supporting search page behavior.
019654| src/components/ui/button.tsx:67:   ) => {
019655| NOTE: Implementation detail supporting search page behavior.
019656| src/components/ui/button.tsx:68:     const Comp = asChild ? Slot : "button";
019657| NOTE: Local declaration used by search logic or UI.
019658| src/components/ui/button.tsx:69:     return (
019659| NOTE: Return statement for component or helper output.
019660| src/components/ui/button.tsx:70:       <Comp
019661| NOTE: JSX markup for search UI.
019662| src/components/ui/button.tsx:71:         className={buttonVariants({ variant, size, className })}
019663| NOTE: Tailwind classes define layout and styling.
019664| src/components/ui/button.tsx:72:         ref={ref}
019665| NOTE: Implementation detail supporting search page behavior.
019666| src/components/ui/button.tsx:73:         {...props}
019667| NOTE: Implementation detail supporting search page behavior.
019668| src/components/ui/button.tsx:74:       />
019669| NOTE: Implementation detail supporting search page behavior.
019670| src/components/ui/button.tsx:75:     );
019671| NOTE: Implementation detail supporting search page behavior.
019672| src/components/ui/button.tsx:76:   },
019673| NOTE: Implementation detail supporting search page behavior.
019674| src/components/ui/button.tsx:77: );
019675| NOTE: Implementation detail supporting search page behavior.
019676| src/components/ui/button.tsx:78: Button.displayName = "Button";
019677| NOTE: Implementation detail supporting search page behavior.
019678| src/components/ui/button.tsx:79: 
019679| NOTE: Blank line for visual separation.
019680| src/components/ui/button.tsx:80: export { Button };
019681| NOTE: Implementation detail supporting search page behavior.
019682| FILE END: src/components/ui/button.tsx
019683| 
019684| FILE START: src/components/ui/checkbox.tsx
019685| FILE ROLE: Auto-discovered dependency in search page graph.
019686| src/components/ui/checkbox.tsx:1: "use client";
019687| NOTE: Implementation detail supporting search page behavior.
019688| src/components/ui/checkbox.tsx:2: 
019689| NOTE: Blank line for visual separation.
019690| src/components/ui/checkbox.tsx:3: import * as React from "react";
019691| NOTE: Imports dependency for this module.
019692| src/components/ui/checkbox.tsx:4: import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
019693| NOTE: Imports dependency for this module.
019694| src/components/ui/checkbox.tsx:5: import { Check } from "lucide-react";
019695| NOTE: Imports dependency for this module.
019696| src/components/ui/checkbox.tsx:6: 
019697| NOTE: Blank line for visual separation.
019698| src/components/ui/checkbox.tsx:7: import { cn } from "@/lib/utils";
019699| NOTE: Imports dependency for this module.
019700| src/components/ui/checkbox.tsx:8: 
019701| NOTE: Blank line for visual separation.
019702| src/components/ui/checkbox.tsx:9: const Checkbox = React.forwardRef<
019703| NOTE: Local declaration used by search logic or UI.
019704| src/components/ui/checkbox.tsx:10:   React.ElementRef<typeof CheckboxPrimitive.Root>,
019705| NOTE: Implementation detail supporting search page behavior.
019706| src/components/ui/checkbox.tsx:11:   React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
019707| NOTE: Implementation detail supporting search page behavior.
019708| src/components/ui/checkbox.tsx:12: >(({ className, ...props }, ref) => (
019709| NOTE: Implementation detail supporting search page behavior.
019710| src/components/ui/checkbox.tsx:13:   <CheckboxPrimitive.Root
019711| NOTE: JSX markup for search UI.
019712| src/components/ui/checkbox.tsx:14:     ref={ref}
019713| NOTE: Implementation detail supporting search page behavior.
019714| src/components/ui/checkbox.tsx:15:     className={cn(
019715| NOTE: Tailwind classes define layout and styling.
019716| src/components/ui/checkbox.tsx:16:       "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
019717| NOTE: Implementation detail supporting search page behavior.
019718| src/components/ui/checkbox.tsx:17:       className,
019719| NOTE: Implementation detail supporting search page behavior.
019720| src/components/ui/checkbox.tsx:18:     )}
019721| NOTE: Implementation detail supporting search page behavior.
019722| src/components/ui/checkbox.tsx:19:     {...props}
019723| NOTE: Implementation detail supporting search page behavior.
019724| src/components/ui/checkbox.tsx:20:   >
019725| NOTE: Implementation detail supporting search page behavior.
019726| src/components/ui/checkbox.tsx:21:     <CheckboxPrimitive.Indicator
019727| NOTE: JSX markup for search UI.
019728| src/components/ui/checkbox.tsx:22:       className={cn("flex items-center justify-center text-current")}
019729| NOTE: Tailwind classes define layout and styling.
019730| src/components/ui/checkbox.tsx:23:     >
019731| NOTE: Implementation detail supporting search page behavior.
019732| src/components/ui/checkbox.tsx:24:       <Check className="h-4 w-4" />
019733| NOTE: Tailwind classes define layout and styling.
019734| src/components/ui/checkbox.tsx:25:     </CheckboxPrimitive.Indicator>
019735| NOTE: JSX markup for search UI.
019736| src/components/ui/checkbox.tsx:26:   </CheckboxPrimitive.Root>
019737| NOTE: JSX markup for search UI.
019738| src/components/ui/checkbox.tsx:27: ));
019739| NOTE: Implementation detail supporting search page behavior.
019740| src/components/ui/checkbox.tsx:28: Checkbox.displayName = CheckboxPrimitive.Root.displayName;
019741| NOTE: Implementation detail supporting search page behavior.
019742| src/components/ui/checkbox.tsx:29: 
019743| NOTE: Blank line for visual separation.
019744| src/components/ui/checkbox.tsx:30: export { Checkbox };
019745| NOTE: Implementation detail supporting search page behavior.
019746| FILE END: src/components/ui/checkbox.tsx
019747| 
019748| FILE START: src/components/ui/date-picker.tsx
019749| FILE ROLE: Auto-discovered dependency in search page graph.
019750| src/components/ui/date-picker.tsx:1: "use client";
019751| NOTE: Implementation detail supporting search page behavior.
019752| src/components/ui/date-picker.tsx:2: 
019753| NOTE: Blank line for visual separation.
019754| src/components/ui/date-picker.tsx:3: import * as React from "react";
019755| NOTE: Imports dependency for this module.
019756| src/components/ui/date-picker.tsx:4: import * as Popover from "@radix-ui/react-popover";
019757| NOTE: Imports dependency for this module.
019758| src/components/ui/date-picker.tsx:5: import { ChevronLeft, ChevronRight, Calendar, X } from "lucide-react";
019759| NOTE: Imports dependency for this module.
019760| src/components/ui/date-picker.tsx:6: import { cn, parseLocalDate } from "@/lib/utils";
019761| NOTE: Imports dependency for this module.
019762| src/components/ui/date-picker.tsx:7: 
019763| NOTE: Blank line for visual separation.
019764| src/components/ui/date-picker.tsx:8: interface DatePickerProps {
019765| NOTE: Type declaration for search data contracts.
019766| src/components/ui/date-picker.tsx:9:   value?: string;
019767| NOTE: Implementation detail supporting search page behavior.
019768| src/components/ui/date-picker.tsx:10:   onChange: (date: string) => void;
019769| NOTE: Implementation detail supporting search page behavior.
019770| src/components/ui/date-picker.tsx:11:   placeholder?: string;
019771| NOTE: Implementation detail supporting search page behavior.
019772| src/components/ui/date-picker.tsx:12:   minDate?: string;
019773| NOTE: Implementation detail supporting search page behavior.
019774| src/components/ui/date-picker.tsx:13:   className?: string;
019775| NOTE: Implementation detail supporting search page behavior.
019776| src/components/ui/date-picker.tsx:14:   id?: string;
019777| NOTE: Implementation detail supporting search page behavior.
019778| src/components/ui/date-picker.tsx:15: }
019779| NOTE: Implementation detail supporting search page behavior.
019780| src/components/ui/date-picker.tsx:16: 
019781| NOTE: Blank line for visual separation.
019782| src/components/ui/date-picker.tsx:17: const DAYS = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
019783| NOTE: Local declaration used by search logic or UI.
019784| src/components/ui/date-picker.tsx:18: const MONTHS = [
019785| NOTE: Local declaration used by search logic or UI.
019786| src/components/ui/date-picker.tsx:19:   "January",
019787| NOTE: Implementation detail supporting search page behavior.
019788| src/components/ui/date-picker.tsx:20:   "February",
019789| NOTE: Implementation detail supporting search page behavior.
019790| src/components/ui/date-picker.tsx:21:   "March",
019791| NOTE: Implementation detail supporting search page behavior.
019792| src/components/ui/date-picker.tsx:22:   "April",
019793| NOTE: Implementation detail supporting search page behavior.
019794| src/components/ui/date-picker.tsx:23:   "May",
019795| NOTE: Implementation detail supporting search page behavior.
019796| src/components/ui/date-picker.tsx:24:   "June",
019797| NOTE: Implementation detail supporting search page behavior.
019798| src/components/ui/date-picker.tsx:25:   "July",
019799| NOTE: Implementation detail supporting search page behavior.
019800| src/components/ui/date-picker.tsx:26:   "August",
019801| NOTE: Implementation detail supporting search page behavior.
019802| src/components/ui/date-picker.tsx:27:   "September",
019803| NOTE: Implementation detail supporting search page behavior.
019804| src/components/ui/date-picker.tsx:28:   "October",
019805| NOTE: Implementation detail supporting search page behavior.
019806| src/components/ui/date-picker.tsx:29:   "November",
019807| NOTE: Implementation detail supporting search page behavior.
019808| src/components/ui/date-picker.tsx:30:   "December",
019809| NOTE: Implementation detail supporting search page behavior.
019810| src/components/ui/date-picker.tsx:31: ];
019811| NOTE: Implementation detail supporting search page behavior.
019812| src/components/ui/date-picker.tsx:32: 
019813| NOTE: Blank line for visual separation.
019814| src/components/ui/date-picker.tsx:33: export function DatePicker({
019815| NOTE: Exports helper or component function.
019816| src/components/ui/date-picker.tsx:34:   value,
019817| NOTE: Implementation detail supporting search page behavior.
019818| src/components/ui/date-picker.tsx:35:   onChange,
019819| NOTE: Implementation detail supporting search page behavior.
019820| src/components/ui/date-picker.tsx:36:   placeholder = "Select date",
019821| NOTE: Implementation detail supporting search page behavior.
019822| src/components/ui/date-picker.tsx:37:   minDate,
019823| NOTE: Implementation detail supporting search page behavior.
019824| src/components/ui/date-picker.tsx:38:   className,
019825| NOTE: Implementation detail supporting search page behavior.
019826| src/components/ui/date-picker.tsx:39:   id,
019827| NOTE: Implementation detail supporting search page behavior.
019828| src/components/ui/date-picker.tsx:40: }: DatePickerProps) {
019829| NOTE: Implementation detail supporting search page behavior.
019830| src/components/ui/date-picker.tsx:41:   const [mounted, setMounted] = React.useState(false);
019831| NOTE: Initializes local state for search UI behavior.
019832| src/components/ui/date-picker.tsx:42:   const [open, setOpen] = React.useState(false);
019833| NOTE: Initializes local state for search UI behavior.
019834| src/components/ui/date-picker.tsx:43:   const [viewDate, setViewDate] = React.useState(() => {
019835| NOTE: Initializes local state for search UI behavior.
019836| src/components/ui/date-picker.tsx:44:     if (value) {
019837| NOTE: Conditional logic controlling rendering or flow.
019838| src/components/ui/date-picker.tsx:45:       return parseLocalDate(value);
019839| NOTE: Return statement for component or helper output.
019840| src/components/ui/date-picker.tsx:46:     }
019841| NOTE: Implementation detail supporting search page behavior.
019842| src/components/ui/date-picker.tsx:47:     return new Date();
019843| NOTE: Return statement for component or helper output.
019844| src/components/ui/date-picker.tsx:48:   });
019845| NOTE: Implementation detail supporting search page behavior.
019846| src/components/ui/date-picker.tsx:49: 
019847| NOTE: Blank line for visual separation.
019848| src/components/ui/date-picker.tsx:50:   // Prevent hydration mismatch by only rendering Popover on client
019849| NOTE: Line comment documents intent or constraints.
019850| src/components/ui/date-picker.tsx:51:   React.useEffect(() => {
019851| NOTE: Defines side effect for syncing with external state.
019852| src/components/ui/date-picker.tsx:52:     setMounted(true);
019853| NOTE: Implementation detail supporting search page behavior.
019854| src/components/ui/date-picker.tsx:53:   }, []);
019855| NOTE: Implementation detail supporting search page behavior.
019856| src/components/ui/date-picker.tsx:54: 
019857| NOTE: Blank line for visual separation.
019858| src/components/ui/date-picker.tsx:55:   const selectedDate = value ? parseLocalDate(value) : null;
019859| NOTE: Local declaration used by search logic or UI.
019860| src/components/ui/date-picker.tsx:56:   const today = new Date();
019861| NOTE: Local declaration used by search logic or UI.
019862| src/components/ui/date-picker.tsx:57:   today.setHours(0, 0, 0, 0);
019863| NOTE: Implementation detail supporting search page behavior.
019864| src/components/ui/date-picker.tsx:58: 
019865| NOTE: Blank line for visual separation.
019866| src/components/ui/date-picker.tsx:59:   const minDateObj = minDate ? parseLocalDate(minDate) : null;
019867| NOTE: Local declaration used by search logic or UI.
019868| src/components/ui/date-picker.tsx:60:   if (minDateObj) {
019869| NOTE: Conditional logic controlling rendering or flow.
019870| src/components/ui/date-picker.tsx:61:     minDateObj.setHours(0, 0, 0, 0);
019871| NOTE: Implementation detail supporting search page behavior.
019872| src/components/ui/date-picker.tsx:62:   }
019873| NOTE: Implementation detail supporting search page behavior.
019874| src/components/ui/date-picker.tsx:63: 
019875| NOTE: Blank line for visual separation.
019876| src/components/ui/date-picker.tsx:64:   // Get days in month
019877| NOTE: Line comment documents intent or constraints.
019878| src/components/ui/date-picker.tsx:65:   const getDaysInMonth = (year: number, month: number) => {
019879| NOTE: Local declaration used by search logic or UI.
019880| src/components/ui/date-picker.tsx:66:     return new Date(year, month + 1, 0).getDate();
019881| NOTE: Return statement for component or helper output.
019882| src/components/ui/date-picker.tsx:67:   };
019883| NOTE: Implementation detail supporting search page behavior.
019884| src/components/ui/date-picker.tsx:68: 
019885| NOTE: Blank line for visual separation.
019886| src/components/ui/date-picker.tsx:69:   // Get first day of month (0 = Sunday)
019887| NOTE: Line comment documents intent or constraints.
019888| src/components/ui/date-picker.tsx:70:   const getFirstDayOfMonth = (year: number, month: number) => {
019889| NOTE: Local declaration used by search logic or UI.
019890| src/components/ui/date-picker.tsx:71:     return new Date(year, month, 1).getDay();
019891| NOTE: Return statement for component or helper output.
019892| src/components/ui/date-picker.tsx:72:   };
019893| NOTE: Implementation detail supporting search page behavior.
019894| src/components/ui/date-picker.tsx:73: 
019895| NOTE: Blank line for visual separation.
019896| src/components/ui/date-picker.tsx:74:   // Generate calendar days
019897| NOTE: Line comment documents intent or constraints.
019898| src/components/ui/date-picker.tsx:75:   const generateCalendarDays = () => {
019899| NOTE: Local declaration used by search logic or UI.
019900| src/components/ui/date-picker.tsx:76:     const year = viewDate.getFullYear();
019901| NOTE: Local declaration used by search logic or UI.
019902| src/components/ui/date-picker.tsx:77:     const month = viewDate.getMonth();
019903| NOTE: Local declaration used by search logic or UI.
019904| src/components/ui/date-picker.tsx:78:     const daysInMonth = getDaysInMonth(year, month);
019905| NOTE: Local declaration used by search logic or UI.
019906| src/components/ui/date-picker.tsx:79:     const firstDay = getFirstDayOfMonth(year, month);
019907| NOTE: Local declaration used by search logic or UI.
019908| src/components/ui/date-picker.tsx:80:     const daysInPrevMonth = getDaysInMonth(year, month - 1);
019909| NOTE: Local declaration used by search logic or UI.
019910| src/components/ui/date-picker.tsx:81: 
019911| NOTE: Blank line for visual separation.
019912| src/components/ui/date-picker.tsx:82:     const days: Array<{
019913| NOTE: Local declaration used by search logic or UI.
019914| src/components/ui/date-picker.tsx:83:       date: Date;
019915| NOTE: Implementation detail supporting search page behavior.
019916| src/components/ui/date-picker.tsx:84:       isCurrentMonth: boolean;
019917| NOTE: Implementation detail supporting search page behavior.
019918| src/components/ui/date-picker.tsx:85:       isDisabled: boolean;
019919| NOTE: Implementation detail supporting search page behavior.
019920| src/components/ui/date-picker.tsx:86:     }> = [];
019921| NOTE: Implementation detail supporting search page behavior.
019922| src/components/ui/date-picker.tsx:87: 
019923| NOTE: Blank line for visual separation.
019924| src/components/ui/date-picker.tsx:88:     // Previous month days
019925| NOTE: Line comment documents intent or constraints.
019926| src/components/ui/date-picker.tsx:89:     for (let i = firstDay - 1; i >= 0; i--) {
019927| NOTE: Implementation detail supporting search page behavior.
019928| src/components/ui/date-picker.tsx:90:       const date = new Date(year, month - 1, daysInPrevMonth - i);
019929| NOTE: Local declaration used by search logic or UI.
019930| src/components/ui/date-picker.tsx:91:       days.push({
019931| NOTE: Implementation detail supporting search page behavior.
019932| src/components/ui/date-picker.tsx:92:         date,
019933| NOTE: Implementation detail supporting search page behavior.
019934| src/components/ui/date-picker.tsx:93:         isCurrentMonth: false,
019935| NOTE: Implementation detail supporting search page behavior.
019936| src/components/ui/date-picker.tsx:94:         isDisabled: minDateObj ? date < minDateObj : false,
019937| NOTE: Implementation detail supporting search page behavior.
019938| src/components/ui/date-picker.tsx:95:       });
019939| NOTE: Implementation detail supporting search page behavior.
019940| src/components/ui/date-picker.tsx:96:     }
019941| NOTE: Implementation detail supporting search page behavior.
019942| src/components/ui/date-picker.tsx:97: 
019943| NOTE: Blank line for visual separation.
019944| src/components/ui/date-picker.tsx:98:     // Current month days
019945| NOTE: Line comment documents intent or constraints.
019946| src/components/ui/date-picker.tsx:99:     for (let i = 1; i <= daysInMonth; i++) {
019947| NOTE: Implementation detail supporting search page behavior.
019948| src/components/ui/date-picker.tsx:100:       const date = new Date(year, month, i);
019949| NOTE: Local declaration used by search logic or UI.
019950| src/components/ui/date-picker.tsx:101:       days.push({
019951| NOTE: Implementation detail supporting search page behavior.
019952| src/components/ui/date-picker.tsx:102:         date,
019953| NOTE: Implementation detail supporting search page behavior.
019954| src/components/ui/date-picker.tsx:103:         isCurrentMonth: true,
019955| NOTE: Implementation detail supporting search page behavior.
019956| src/components/ui/date-picker.tsx:104:         isDisabled: minDateObj ? date < minDateObj : false,
019957| NOTE: Implementation detail supporting search page behavior.
019958| src/components/ui/date-picker.tsx:105:       });
019959| NOTE: Implementation detail supporting search page behavior.
019960| src/components/ui/date-picker.tsx:106:     }
019961| NOTE: Implementation detail supporting search page behavior.
019962| src/components/ui/date-picker.tsx:107: 
019963| NOTE: Blank line for visual separation.
019964| src/components/ui/date-picker.tsx:108:     // Next month days to fill the grid
019965| NOTE: Line comment documents intent or constraints.
019966| src/components/ui/date-picker.tsx:109:     const remainingDays = 42 - days.length; // 6 rows * 7 days
019967| NOTE: Local declaration used by search logic or UI.
019968| src/components/ui/date-picker.tsx:110:     for (let i = 1; i <= remainingDays; i++) {
019969| NOTE: Implementation detail supporting search page behavior.
019970| src/components/ui/date-picker.tsx:111:       const date = new Date(year, month + 1, i);
019971| NOTE: Local declaration used by search logic or UI.
019972| src/components/ui/date-picker.tsx:112:       days.push({
019973| NOTE: Implementation detail supporting search page behavior.
019974| src/components/ui/date-picker.tsx:113:         date,
019975| NOTE: Implementation detail supporting search page behavior.
019976| src/components/ui/date-picker.tsx:114:         isCurrentMonth: false,
019977| NOTE: Implementation detail supporting search page behavior.
019978| src/components/ui/date-picker.tsx:115:         isDisabled: minDateObj ? date < minDateObj : false,
019979| NOTE: Implementation detail supporting search page behavior.
019980| src/components/ui/date-picker.tsx:116:       });
019981| NOTE: Implementation detail supporting search page behavior.
019982| src/components/ui/date-picker.tsx:117:     }
019983| NOTE: Implementation detail supporting search page behavior.
019984| src/components/ui/date-picker.tsx:118: 
019985| NOTE: Blank line for visual separation.
019986| src/components/ui/date-picker.tsx:119:     return days;
019987| NOTE: Return statement for component or helper output.
019988| src/components/ui/date-picker.tsx:120:   };
019989| NOTE: Implementation detail supporting search page behavior.
019990| src/components/ui/date-picker.tsx:121: 
019991| NOTE: Blank line for visual separation.
019992| src/components/ui/date-picker.tsx:122:   const handleDateSelect = (date: Date) => {
019993| NOTE: Local declaration used by search logic or UI.
019994| src/components/ui/date-picker.tsx:123:     // Use local date parts to avoid timezone conversion issues with toISOString()
019995| NOTE: Line comment documents intent or constraints.
019996| src/components/ui/date-picker.tsx:124:     const year = date.getFullYear();
019997| NOTE: Local declaration used by search logic or UI.
019998| src/components/ui/date-picker.tsx:125:     const month = String(date.getMonth() + 1).padStart(2, "0");
019999| NOTE: Local declaration used by search logic or UI.
020000| src/components/ui/date-picker.tsx:126:     const day = String(date.getDate()).padStart(2, "0");
020001| NOTE: Local declaration used by search logic or UI.
020002| src/components/ui/date-picker.tsx:127:     const formattedDate = `${year}-${month}-${day}`;
020003| NOTE: Local declaration used by search logic or UI.
020004| src/components/ui/date-picker.tsx:128:     onChange(formattedDate);
020005| NOTE: Implementation detail supporting search page behavior.
020006| src/components/ui/date-picker.tsx:129:     setOpen(false);
020007| NOTE: Implementation detail supporting search page behavior.
020008| src/components/ui/date-picker.tsx:130:   };
020009| NOTE: Implementation detail supporting search page behavior.
020010| src/components/ui/date-picker.tsx:131: 
020011| NOTE: Blank line for visual separation.
020012| src/components/ui/date-picker.tsx:132:   const handlePrevMonth = () => {
020013| NOTE: Local declaration used by search logic or UI.
020014| src/components/ui/date-picker.tsx:133:     setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1));
020015| NOTE: Implementation detail supporting search page behavior.
020016| src/components/ui/date-picker.tsx:134:   };
020017| NOTE: Implementation detail supporting search page behavior.
020018| src/components/ui/date-picker.tsx:135: 
020019| NOTE: Blank line for visual separation.
020020| src/components/ui/date-picker.tsx:136:   const handleNextMonth = () => {
020021| NOTE: Local declaration used by search logic or UI.
020022| src/components/ui/date-picker.tsx:137:     setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1));
020023| NOTE: Implementation detail supporting search page behavior.
020024| src/components/ui/date-picker.tsx:138:   };
020025| NOTE: Implementation detail supporting search page behavior.
020026| src/components/ui/date-picker.tsx:139: 
020027| NOTE: Blank line for visual separation.
020028| src/components/ui/date-picker.tsx:140:   const handleToday = () => {
020029| NOTE: Local declaration used by search logic or UI.
020030| src/components/ui/date-picker.tsx:141:     const todayDate = new Date();
020031| NOTE: Local declaration used by search logic or UI.
020032| src/components/ui/date-picker.tsx:142:     if (!minDateObj || todayDate >= minDateObj) {
020033| NOTE: Conditional logic controlling rendering or flow.
020034| src/components/ui/date-picker.tsx:143:       handleDateSelect(todayDate);
020035| NOTE: Implementation detail supporting search page behavior.
020036| src/components/ui/date-picker.tsx:144:     }
020037| NOTE: Implementation detail supporting search page behavior.
020038| src/components/ui/date-picker.tsx:145:     setViewDate(new Date());
020039| NOTE: Implementation detail supporting search page behavior.
020040| src/components/ui/date-picker.tsx:146:   };
020041| NOTE: Implementation detail supporting search page behavior.
020042| src/components/ui/date-picker.tsx:147: 
020043| NOTE: Blank line for visual separation.
020044| src/components/ui/date-picker.tsx:148:   const handleClear = () => {
020045| NOTE: Local declaration used by search logic or UI.
020046| src/components/ui/date-picker.tsx:149:     onChange("");
020047| NOTE: Implementation detail supporting search page behavior.
020048| src/components/ui/date-picker.tsx:150:     setOpen(false);
020049| NOTE: Implementation detail supporting search page behavior.
020050| src/components/ui/date-picker.tsx:151:   };
020051| NOTE: Implementation detail supporting search page behavior.
020052| src/components/ui/date-picker.tsx:152: 
020053| NOTE: Blank line for visual separation.
020054| src/components/ui/date-picker.tsx:153:   const formatDisplayDate = (dateStr: string) => {
020055| NOTE: Local declaration used by search logic or UI.
020056| src/components/ui/date-picker.tsx:154:     const date = parseLocalDate(dateStr);
020057| NOTE: Local declaration used by search logic or UI.
020058| src/components/ui/date-picker.tsx:155:     return date.toLocaleDateString("en-US", {
020059| NOTE: Return statement for component or helper output.
020060| src/components/ui/date-picker.tsx:156:       month: "short",
020061| NOTE: Implementation detail supporting search page behavior.
020062| src/components/ui/date-picker.tsx:157:       day: "numeric",
020063| NOTE: Implementation detail supporting search page behavior.
020064| src/components/ui/date-picker.tsx:158:       year: "numeric",
020065| NOTE: Implementation detail supporting search page behavior.
020066| src/components/ui/date-picker.tsx:159:     });
020067| NOTE: Implementation detail supporting search page behavior.
020068| src/components/ui/date-picker.tsx:160:   };
020069| NOTE: Implementation detail supporting search page behavior.
020070| src/components/ui/date-picker.tsx:161: 
020071| NOTE: Blank line for visual separation.
020072| src/components/ui/date-picker.tsx:162:   const isToday = (date: Date) => {
020073| NOTE: Local declaration used by search logic or UI.
020074| src/components/ui/date-picker.tsx:163:     return date.toDateString() === today.toDateString();
020075| NOTE: Return statement for component or helper output.
020076| src/components/ui/date-picker.tsx:164:   };
020077| NOTE: Implementation detail supporting search page behavior.
020078| src/components/ui/date-picker.tsx:165: 
020079| NOTE: Blank line for visual separation.
020080| src/components/ui/date-picker.tsx:166:   const isSelected = (date: Date) => {
020081| NOTE: Local declaration used by search logic or UI.
020082| src/components/ui/date-picker.tsx:167:     return selectedDate && date.toDateString() === selectedDate.toDateString();
020083| NOTE: Return statement for component or helper output.
020084| src/components/ui/date-picker.tsx:168:   };
020085| NOTE: Implementation detail supporting search page behavior.
020086| src/components/ui/date-picker.tsx:169: 
020087| NOTE: Blank line for visual separation.
020088| src/components/ui/date-picker.tsx:170:   const calendarDays = generateCalendarDays();
020089| NOTE: Local declaration used by search logic or UI.
020090| src/components/ui/date-picker.tsx:171: 
020091| NOTE: Blank line for visual separation.
020092| src/components/ui/date-picker.tsx:172:   // Render placeholder during SSR to prevent hydration mismatch
020093| NOTE: Line comment documents intent or constraints.
020094| src/components/ui/date-picker.tsx:173:   if (!mounted) {
020095| NOTE: Conditional logic controlling rendering or flow.
020096| src/components/ui/date-picker.tsx:174:     return (
020097| NOTE: Return statement for component or helper output.
020098| src/components/ui/date-picker.tsx:175:       <button
020099| NOTE: JSX markup for search UI.
020100| src/components/ui/date-picker.tsx:176:         type="button"
020101| NOTE: Implementation detail supporting search page behavior.
020102| src/components/ui/date-picker.tsx:177:         id={id}
020103| NOTE: Implementation detail supporting search page behavior.
020104| src/components/ui/date-picker.tsx:178:         className={cn(
020105| NOTE: Tailwind classes define layout and styling.
020106| src/components/ui/date-picker.tsx:179:           "w-full flex items-center justify-between gap-2 p-2.5 sm:p-3 rounded-xl",
020107| NOTE: Implementation detail supporting search page behavior.
020108| src/components/ui/date-picker.tsx:180:           "border border-zinc-200 dark:border-zinc-700",
020109| NOTE: Implementation detail supporting search page behavior.
020110| src/components/ui/date-picker.tsx:181:           "bg-white dark:bg-zinc-800",
020111| NOTE: Implementation detail supporting search page behavior.
020112| src/components/ui/date-picker.tsx:182:           "text-sm touch-target text-left",
020113| NOTE: Implementation detail supporting search page behavior.
020114| src/components/ui/date-picker.tsx:183:           className,
020115| NOTE: Implementation detail supporting search page behavior.
020116| src/components/ui/date-picker.tsx:184:         )}
020117| NOTE: Implementation detail supporting search page behavior.
020118| src/components/ui/date-picker.tsx:185:       >
020119| NOTE: Implementation detail supporting search page behavior.
020120| src/components/ui/date-picker.tsx:186:         <span
020121| NOTE: JSX markup for search UI.
020122| src/components/ui/date-picker.tsx:187:           className={cn(
020123| NOTE: Tailwind classes define layout and styling.
020124| src/components/ui/date-picker.tsx:188:             value
020125| NOTE: Implementation detail supporting search page behavior.
020126| src/components/ui/date-picker.tsx:189:               ? "text-zinc-900 dark:text-white"
020127| NOTE: Implementation detail supporting search page behavior.
020128| src/components/ui/date-picker.tsx:190:               : "text-zinc-400 dark:text-zinc-500",
020129| NOTE: Implementation detail supporting search page behavior.
020130| src/components/ui/date-picker.tsx:191:           )}
020131| NOTE: Implementation detail supporting search page behavior.
020132| src/components/ui/date-picker.tsx:192:         >
020133| NOTE: Implementation detail supporting search page behavior.
020134| src/components/ui/date-picker.tsx:193:           {value ? formatDisplayDate(value) : placeholder}
020135| NOTE: Implementation detail supporting search page behavior.
020136| src/components/ui/date-picker.tsx:194:         </span>
020137| NOTE: JSX markup for search UI.
020138| src/components/ui/date-picker.tsx:195:         <div className="flex items-center gap-1">
020139| NOTE: Tailwind classes define layout and styling.
020140| src/components/ui/date-picker.tsx:196:           {value && (
020141| NOTE: Implementation detail supporting search page behavior.
020142| src/components/ui/date-picker.tsx:197:             <span className="p-0.5">
020143| NOTE: Tailwind classes define layout and styling.
020144| src/components/ui/date-picker.tsx:198:               <X className="w-3.5 h-3.5 text-zinc-400" />
020145| NOTE: Tailwind classes define layout and styling.
020146| src/components/ui/date-picker.tsx:199:             </span>
020147| NOTE: JSX markup for search UI.
020148| src/components/ui/date-picker.tsx:200:           )}
020149| NOTE: Implementation detail supporting search page behavior.
020150| src/components/ui/date-picker.tsx:201:           <Calendar className="w-4 h-4 text-zinc-400" />
020151| NOTE: Tailwind classes define layout and styling.
020152| src/components/ui/date-picker.tsx:202:         </div>
020153| NOTE: JSX markup for search UI.
020154| src/components/ui/date-picker.tsx:203:       </button>
020155| NOTE: JSX markup for search UI.
020156| src/components/ui/date-picker.tsx:204:     );
020157| NOTE: Implementation detail supporting search page behavior.
020158| src/components/ui/date-picker.tsx:205:   }
020159| NOTE: Implementation detail supporting search page behavior.
020160| src/components/ui/date-picker.tsx:206: 
020161| NOTE: Blank line for visual separation.
020162| src/components/ui/date-picker.tsx:207:   return (
020163| NOTE: Return statement for component or helper output.
020164| src/components/ui/date-picker.tsx:208:     <Popover.Root open={open} onOpenChange={setOpen}>
020165| NOTE: JSX markup for search UI.
020166| src/components/ui/date-picker.tsx:209:       <Popover.Trigger
020167| NOTE: JSX markup for search UI.
020168| src/components/ui/date-picker.tsx:210:         type="button"
020169| NOTE: Implementation detail supporting search page behavior.
020170| src/components/ui/date-picker.tsx:211:         id={id}
020171| NOTE: Implementation detail supporting search page behavior.
020172| src/components/ui/date-picker.tsx:212:         className={cn(
020173| NOTE: Tailwind classes define layout and styling.
020174| src/components/ui/date-picker.tsx:213:           "w-full flex items-center justify-between gap-2 p-2.5 sm:p-3 rounded-xl",
020175| NOTE: Implementation detail supporting search page behavior.
020176| src/components/ui/date-picker.tsx:214:           "border border-zinc-200 dark:border-zinc-700",
020177| NOTE: Implementation detail supporting search page behavior.
020178| src/components/ui/date-picker.tsx:215:           "bg-white dark:bg-zinc-800",
020179| NOTE: Implementation detail supporting search page behavior.
020180| src/components/ui/date-picker.tsx:216:           "hover:border-zinc-300 dark:hover:border-zinc-600",
020181| NOTE: Implementation detail supporting search page behavior.
020182| src/components/ui/date-picker.tsx:217:           "focus:outline-none focus:ring-2 focus:ring-zinc-900/10 dark:focus:ring-zinc-400/20",
020183| NOTE: Implementation detail supporting search page behavior.
020184| src/components/ui/date-picker.tsx:218:           "transition-all duration-200",
020185| NOTE: Implementation detail supporting search page behavior.
020186| src/components/ui/date-picker.tsx:219:           "text-sm touch-target text-left",
020187| NOTE: Implementation detail supporting search page behavior.
020188| src/components/ui/date-picker.tsx:220:           className,
020189| NOTE: Implementation detail supporting search page behavior.
020190| src/components/ui/date-picker.tsx:221:         )}
020191| NOTE: Implementation detail supporting search page behavior.
020192| src/components/ui/date-picker.tsx:222:       >
020193| NOTE: Implementation detail supporting search page behavior.
020194| src/components/ui/date-picker.tsx:223:         <span
020195| NOTE: JSX markup for search UI.
020196| src/components/ui/date-picker.tsx:224:           className={cn(
020197| NOTE: Tailwind classes define layout and styling.
020198| src/components/ui/date-picker.tsx:225:             value
020199| NOTE: Implementation detail supporting search page behavior.
020200| src/components/ui/date-picker.tsx:226:               ? "text-zinc-900 dark:text-white"
020201| NOTE: Implementation detail supporting search page behavior.
020202| src/components/ui/date-picker.tsx:227:               : "text-zinc-400 dark:text-zinc-500",
020203| NOTE: Implementation detail supporting search page behavior.
020204| src/components/ui/date-picker.tsx:228:           )}
020205| NOTE: Implementation detail supporting search page behavior.
020206| src/components/ui/date-picker.tsx:229:         >
020207| NOTE: Implementation detail supporting search page behavior.
020208| src/components/ui/date-picker.tsx:230:           {value ? formatDisplayDate(value) : placeholder}
020209| NOTE: Implementation detail supporting search page behavior.
020210| src/components/ui/date-picker.tsx:231:         </span>
020211| NOTE: JSX markup for search UI.
020212| src/components/ui/date-picker.tsx:232:         <div className="flex items-center gap-1">
020213| NOTE: Tailwind classes define layout and styling.
020214| src/components/ui/date-picker.tsx:233:           {value && (
020215| NOTE: Implementation detail supporting search page behavior.
020216| src/components/ui/date-picker.tsx:234:             <span
020217| NOTE: JSX markup for search UI.
020218| src/components/ui/date-picker.tsx:235:               role="button"
020219| NOTE: Implementation detail supporting search page behavior.
020220| src/components/ui/date-picker.tsx:236:               tabIndex={0}
020221| NOTE: Implementation detail supporting search page behavior.
020222| src/components/ui/date-picker.tsx:237:               onClick={(e) => {
020223| NOTE: Implementation detail supporting search page behavior.
020224| src/components/ui/date-picker.tsx:238:                 e.stopPropagation();
020225| NOTE: Implementation detail supporting search page behavior.
020226| src/components/ui/date-picker.tsx:239:                 handleClear();
020227| NOTE: Implementation detail supporting search page behavior.
020228| src/components/ui/date-picker.tsx:240:               }}
020229| NOTE: Implementation detail supporting search page behavior.
020230| src/components/ui/date-picker.tsx:241:               onKeyDown={(e) => {
020231| NOTE: Implementation detail supporting search page behavior.
020232| src/components/ui/date-picker.tsx:242:                 if (e.key === "Enter" || e.key === " ") {
020233| NOTE: Conditional logic controlling rendering or flow.
020234| src/components/ui/date-picker.tsx:243:                   e.stopPropagation();
020235| NOTE: Implementation detail supporting search page behavior.
020236| src/components/ui/date-picker.tsx:244:                   handleClear();
020237| NOTE: Implementation detail supporting search page behavior.
020238| src/components/ui/date-picker.tsx:245:                 }
020239| NOTE: Implementation detail supporting search page behavior.
020240| src/components/ui/date-picker.tsx:246:               }}
020241| NOTE: Implementation detail supporting search page behavior.
020242| src/components/ui/date-picker.tsx:247:               className="p-0.5 hover:bg-zinc-100 dark:hover:bg-zinc-700 rounded transition-colors"
020243| NOTE: Tailwind classes define layout and styling.
020244| src/components/ui/date-picker.tsx:248:             >
020245| NOTE: Implementation detail supporting search page behavior.
020246| src/components/ui/date-picker.tsx:249:               <X className="w-3.5 h-3.5 text-zinc-400" />
020247| NOTE: Tailwind classes define layout and styling.
020248| src/components/ui/date-picker.tsx:250:             </span>
020249| NOTE: JSX markup for search UI.
020250| src/components/ui/date-picker.tsx:251:           )}
020251| NOTE: Implementation detail supporting search page behavior.
020252| src/components/ui/date-picker.tsx:252:           <Calendar className="w-4 h-4 text-zinc-400" />
020253| NOTE: Tailwind classes define layout and styling.
020254| src/components/ui/date-picker.tsx:253:         </div>
020255| NOTE: JSX markup for search UI.
020256| src/components/ui/date-picker.tsx:254:       </Popover.Trigger>
020257| NOTE: JSX markup for search UI.
020258| src/components/ui/date-picker.tsx:255: 
020259| NOTE: Blank line for visual separation.
020260| src/components/ui/date-picker.tsx:256:       <Popover.Portal>
020261| NOTE: JSX markup for search UI.
020262| src/components/ui/date-picker.tsx:257:         <Popover.Content
020263| NOTE: JSX markup for search UI.
020264| src/components/ui/date-picker.tsx:258:           className={cn(
020265| NOTE: Tailwind classes define layout and styling.
020266| src/components/ui/date-picker.tsx:259:             "z-popover p-4",
020267| NOTE: Implementation detail supporting search page behavior.
020268| src/components/ui/date-picker.tsx:260:             "bg-white/95 dark:bg-zinc-900/95 backdrop-blur-xl",
020269| NOTE: Implementation detail supporting search page behavior.
020270| src/components/ui/date-picker.tsx:261:             "rounded-xl",
020271| NOTE: Implementation detail supporting search page behavior.
020272| src/components/ui/date-picker.tsx:262:             "shadow-lg dark:shadow-xl",
020273| NOTE: Implementation detail supporting search page behavior.
020274| src/components/ui/date-picker.tsx:263:             "border border-zinc-200/80 dark:border-zinc-700/80",
020275| NOTE: Implementation detail supporting search page behavior.
020276| src/components/ui/date-picker.tsx:264:             "animate-in fade-in-0",
020277| NOTE: Implementation detail supporting search page behavior.
020278| src/components/ui/date-picker.tsx:265:             "data-[state=closed]:animate-out data-[state=closed]:fade-out-0",
020279| NOTE: Implementation detail supporting search page behavior.
020280| src/components/ui/date-picker.tsx:266:             "data-[side=bottom]:slide-in-from-top-2",
020281| NOTE: Implementation detail supporting search page behavior.
020282| src/components/ui/date-picker.tsx:267:             "data-[side=top]:slide-in-from-bottom-2",
020283| NOTE: Implementation detail supporting search page behavior.
020284| src/components/ui/date-picker.tsx:268:           )}
020285| NOTE: Implementation detail supporting search page behavior.
020286| src/components/ui/date-picker.tsx:269:           sideOffset={8}
020287| NOTE: Implementation detail supporting search page behavior.
020288| src/components/ui/date-picker.tsx:270:           align="start"
020289| NOTE: Implementation detail supporting search page behavior.
020290| src/components/ui/date-picker.tsx:271:         >
020291| NOTE: Implementation detail supporting search page behavior.
020292| src/components/ui/date-picker.tsx:272:           {/* Header */}
020293| NOTE: Implementation detail supporting search page behavior.
020294| src/components/ui/date-picker.tsx:273:           <div className="flex items-center justify-between mb-4">
020295| NOTE: Tailwind classes define layout and styling.
020296| src/components/ui/date-picker.tsx:274:             <button
020297| NOTE: JSX markup for search UI.
020298| src/components/ui/date-picker.tsx:275:               type="button"
020299| NOTE: Implementation detail supporting search page behavior.
020300| src/components/ui/date-picker.tsx:276:               onClick={handlePrevMonth}
020301| NOTE: Implementation detail supporting search page behavior.
020302| src/components/ui/date-picker.tsx:277:               className="p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-xl transition-colors"
020303| NOTE: Tailwind classes define layout and styling.
020304| src/components/ui/date-picker.tsx:278:               aria-label="Previous month"
020305| NOTE: Accessibility attribute for screen readers.
020306| src/components/ui/date-picker.tsx:279:             >
020307| NOTE: Implementation detail supporting search page behavior.
020308| src/components/ui/date-picker.tsx:280:               <ChevronLeft className="w-4 h-4 text-zinc-600 dark:text-zinc-400" />
020309| NOTE: Tailwind classes define layout and styling.
020310| src/components/ui/date-picker.tsx:281:             </button>
020311| NOTE: JSX markup for search UI.
020312| src/components/ui/date-picker.tsx:282:             <span className="text-sm font-semibold text-zinc-900 dark:text-white">
020313| NOTE: Tailwind classes define layout and styling.
020314| src/components/ui/date-picker.tsx:283:               {MONTHS[viewDate.getMonth()]} {viewDate.getFullYear()}
020315| NOTE: Implementation detail supporting search page behavior.
020316| src/components/ui/date-picker.tsx:284:             </span>
020317| NOTE: JSX markup for search UI.
020318| src/components/ui/date-picker.tsx:285:             <button
020319| NOTE: JSX markup for search UI.
020320| src/components/ui/date-picker.tsx:286:               type="button"
020321| NOTE: Implementation detail supporting search page behavior.
020322| src/components/ui/date-picker.tsx:287:               onClick={handleNextMonth}
020323| NOTE: Implementation detail supporting search page behavior.
020324| src/components/ui/date-picker.tsx:288:               className="p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-xl transition-colors"
020325| NOTE: Tailwind classes define layout and styling.
020326| src/components/ui/date-picker.tsx:289:               aria-label="Next month"
020327| NOTE: Accessibility attribute for screen readers.
020328| src/components/ui/date-picker.tsx:290:             >
020329| NOTE: Implementation detail supporting search page behavior.
020330| src/components/ui/date-picker.tsx:291:               <ChevronRight className="w-4 h-4 text-zinc-600 dark:text-zinc-400" />
020331| NOTE: Tailwind classes define layout and styling.
020332| src/components/ui/date-picker.tsx:292:             </button>
020333| NOTE: JSX markup for search UI.
020334| src/components/ui/date-picker.tsx:293:           </div>
020335| NOTE: JSX markup for search UI.
020336| src/components/ui/date-picker.tsx:294: 
020337| NOTE: Blank line for visual separation.
020338| src/components/ui/date-picker.tsx:295:           {/* Day headers */}
020339| NOTE: Implementation detail supporting search page behavior.
020340| src/components/ui/date-picker.tsx:296:           <div className="grid grid-cols-7 gap-1 mb-2">
020341| NOTE: Tailwind classes define layout and styling.
020342| src/components/ui/date-picker.tsx:297:             {DAYS.map((day) => (
020343| NOTE: Implementation detail supporting search page behavior.
020344| src/components/ui/date-picker.tsx:298:               <div
020345| NOTE: JSX markup for search UI.
020346| src/components/ui/date-picker.tsx:299:                 key={day}
020347| NOTE: Implementation detail supporting search page behavior.
020348| src/components/ui/date-picker.tsx:300:                 className="h-8 flex items-center justify-center text-xs font-medium text-zinc-500 dark:text-zinc-400"
020349| NOTE: Tailwind classes define layout and styling.
020350| src/components/ui/date-picker.tsx:301:               >
020351| NOTE: Implementation detail supporting search page behavior.
020352| src/components/ui/date-picker.tsx:302:                 {day}
020353| NOTE: Implementation detail supporting search page behavior.
020354| src/components/ui/date-picker.tsx:303:               </div>
020355| NOTE: JSX markup for search UI.
020356| src/components/ui/date-picker.tsx:304:             ))}
020357| NOTE: Implementation detail supporting search page behavior.
020358| src/components/ui/date-picker.tsx:305:           </div>
020359| NOTE: JSX markup for search UI.
020360| src/components/ui/date-picker.tsx:306: 
020361| NOTE: Blank line for visual separation.
020362| src/components/ui/date-picker.tsx:307:           {/* Calendar grid */}
020363| NOTE: Implementation detail supporting search page behavior.
020364| src/components/ui/date-picker.tsx:308:           <div className="grid grid-cols-7 gap-1">
020365| NOTE: Tailwind classes define layout and styling.
020366| src/components/ui/date-picker.tsx:309:             {calendarDays.map((day, index) => {
020367| NOTE: Implementation detail supporting search page behavior.
020368| src/components/ui/date-picker.tsx:310:               const selected = isSelected(day.date);
020369| NOTE: Local declaration used by search logic or UI.
020370| src/components/ui/date-picker.tsx:311:               const todayDate = isToday(day.date);
020371| NOTE: Local declaration used by search logic or UI.
020372| src/components/ui/date-picker.tsx:312: 
020373| NOTE: Blank line for visual separation.
020374| src/components/ui/date-picker.tsx:313:               return (
020375| NOTE: Return statement for component or helper output.
020376| src/components/ui/date-picker.tsx:314:                 <button
020377| NOTE: JSX markup for search UI.
020378| src/components/ui/date-picker.tsx:315:                   key={index}
020379| NOTE: Implementation detail supporting search page behavior.
020380| src/components/ui/date-picker.tsx:316:                   type="button"
020381| NOTE: Implementation detail supporting search page behavior.
020382| src/components/ui/date-picker.tsx:317:                   disabled={day.isDisabled}
020383| NOTE: Implementation detail supporting search page behavior.
020384| src/components/ui/date-picker.tsx:318:                   onClick={() => handleDateSelect(day.date)}
020385| NOTE: Implementation detail supporting search page behavior.
020386| src/components/ui/date-picker.tsx:319:                   className={cn(
020387| NOTE: Tailwind classes define layout and styling.
020388| src/components/ui/date-picker.tsx:320:                     "h-9 w-9 flex items-center justify-center text-sm rounded-xl transition-all duration-200",
020389| NOTE: Implementation detail supporting search page behavior.
020390| src/components/ui/date-picker.tsx:321:                     !day.isCurrentMonth && "text-zinc-300 dark:text-zinc-600",
020391| NOTE: Implementation detail supporting search page behavior.
020392| src/components/ui/date-picker.tsx:322:                     day.isCurrentMonth &&
020393| NOTE: Implementation detail supporting search page behavior.
020394| src/components/ui/date-picker.tsx:323:                       !selected &&
020395| NOTE: Implementation detail supporting search page behavior.
020396| src/components/ui/date-picker.tsx:324:                       !day.isDisabled &&
020397| NOTE: Implementation detail supporting search page behavior.
020398| src/components/ui/date-picker.tsx:325:                       "text-zinc-900 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800",
020399| NOTE: Implementation detail supporting search page behavior.
020400| src/components/ui/date-picker.tsx:326:                     day.isDisabled &&
020401| NOTE: Implementation detail supporting search page behavior.
020402| src/components/ui/date-picker.tsx:327:                       "text-zinc-300 dark:text-zinc-700 cursor-not-allowed",
020403| NOTE: Implementation detail supporting search page behavior.
020404| src/components/ui/date-picker.tsx:328:                     todayDate &&
020405| NOTE: Implementation detail supporting search page behavior.
020406| src/components/ui/date-picker.tsx:329:                       !selected &&
020407| NOTE: Implementation detail supporting search page behavior.
020408| src/components/ui/date-picker.tsx:330:                       "ring-2 ring-zinc-900/20 dark:ring-white/20",
020409| NOTE: Implementation detail supporting search page behavior.
020410| src/components/ui/date-picker.tsx:331:                     selected &&
020411| NOTE: Implementation detail supporting search page behavior.
020412| src/components/ui/date-picker.tsx:332:                       "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 font-medium",
020413| NOTE: Implementation detail supporting search page behavior.
020414| src/components/ui/date-picker.tsx:333:                   )}
020415| NOTE: Implementation detail supporting search page behavior.
020416| src/components/ui/date-picker.tsx:334:                 >
020417| NOTE: Implementation detail supporting search page behavior.
020418| src/components/ui/date-picker.tsx:335:                   {day.date.getDate()}
020419| NOTE: Implementation detail supporting search page behavior.
020420| src/components/ui/date-picker.tsx:336:                 </button>
020421| NOTE: JSX markup for search UI.
020422| src/components/ui/date-picker.tsx:337:               );
020423| NOTE: Implementation detail supporting search page behavior.
020424| src/components/ui/date-picker.tsx:338:             })}
020425| NOTE: Implementation detail supporting search page behavior.
020426| src/components/ui/date-picker.tsx:339:           </div>
020427| NOTE: JSX markup for search UI.
020428| src/components/ui/date-picker.tsx:340: 
020429| NOTE: Blank line for visual separation.
020430| src/components/ui/date-picker.tsx:341:           {/* Footer */}
020431| NOTE: Implementation detail supporting search page behavior.
020432| src/components/ui/date-picker.tsx:342:           <div className="flex items-center justify-between mt-4 pt-3 border-t border-zinc-100 dark:border-zinc-800">
020433| NOTE: Tailwind classes define layout and styling.
020434| src/components/ui/date-picker.tsx:343:             <button
020435| NOTE: JSX markup for search UI.
020436| src/components/ui/date-picker.tsx:344:               type="button"
020437| NOTE: Implementation detail supporting search page behavior.
020438| src/components/ui/date-picker.tsx:345:               onClick={handleClear}
020439| NOTE: Implementation detail supporting search page behavior.
020440| src/components/ui/date-picker.tsx:346:               className="text-sm font-medium text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors"
020441| NOTE: Tailwind classes define layout and styling.
020442| src/components/ui/date-picker.tsx:347:             >
020443| NOTE: Implementation detail supporting search page behavior.
020444| src/components/ui/date-picker.tsx:348:               Clear
020445| NOTE: Implementation detail supporting search page behavior.
020446| src/components/ui/date-picker.tsx:349:             </button>
020447| NOTE: JSX markup for search UI.
020448| src/components/ui/date-picker.tsx:350:             <button
020449| NOTE: JSX markup for search UI.
020450| src/components/ui/date-picker.tsx:351:               type="button"
020451| NOTE: Implementation detail supporting search page behavior.
020452| src/components/ui/date-picker.tsx:352:               onClick={handleToday}
020453| NOTE: Implementation detail supporting search page behavior.
020454| src/components/ui/date-picker.tsx:353:               className="text-sm font-medium text-zinc-900 dark:text-white hover:text-zinc-600 dark:hover:text-zinc-300 transition-colors"
020455| NOTE: Tailwind classes define layout and styling.
020456| src/components/ui/date-picker.tsx:354:             >
020457| NOTE: Implementation detail supporting search page behavior.
020458| src/components/ui/date-picker.tsx:355:               Today
020459| NOTE: Implementation detail supporting search page behavior.
020460| src/components/ui/date-picker.tsx:356:             </button>
020461| NOTE: JSX markup for search UI.
020462| src/components/ui/date-picker.tsx:357:           </div>
020463| NOTE: JSX markup for search UI.
020464| src/components/ui/date-picker.tsx:358:         </Popover.Content>
020465| NOTE: JSX markup for search UI.
020466| src/components/ui/date-picker.tsx:359:       </Popover.Portal>
020467| NOTE: JSX markup for search UI.
020468| src/components/ui/date-picker.tsx:360:     </Popover.Root>
020469| NOTE: JSX markup for search UI.
020470| src/components/ui/date-picker.tsx:361:   );
020471| NOTE: Implementation detail supporting search page behavior.
020472| src/components/ui/date-picker.tsx:362: }
020473| NOTE: Implementation detail supporting search page behavior.
020474| src/components/ui/date-picker.tsx:363: 
020475| NOTE: Blank line for visual separation.
020476| src/components/ui/date-picker.tsx:364: export default DatePicker;
020477| NOTE: Implementation detail supporting search page behavior.
020478| FILE END: src/components/ui/date-picker.tsx
020479| 
020480| FILE START: src/components/ui/input.tsx
020481| FILE ROLE: Auto-discovered dependency in search page graph.
020482| src/components/ui/input.tsx:1: import * as React from "react";
020483| NOTE: Imports dependency for this module.
020484| src/components/ui/input.tsx:2: 
020485| NOTE: Blank line for visual separation.
020486| src/components/ui/input.tsx:3: import { cn } from "@/lib/utils";
020487| NOTE: Imports dependency for this module.
020488| src/components/ui/input.tsx:4: 
020489| NOTE: Blank line for visual separation.
020490| src/components/ui/input.tsx:5: export type InputProps = React.InputHTMLAttributes<HTMLInputElement>;
020491| NOTE: Implementation detail supporting search page behavior.
020492| src/components/ui/input.tsx:6: 
020493| NOTE: Blank line for visual separation.
020494| src/components/ui/input.tsx:7: const Input = React.forwardRef<HTMLInputElement, InputProps>(
020495| NOTE: Local declaration used by search logic or UI.
020496| src/components/ui/input.tsx:8:   ({ className, type, ...props }, ref) => {
020497| NOTE: Implementation detail supporting search page behavior.
020498| src/components/ui/input.tsx:9:     return (
020499| NOTE: Return statement for component or helper output.
020500| src/components/ui/input.tsx:10:       <input
020501| NOTE: JSX markup for search UI.
020502| src/components/ui/input.tsx:11:         type={type}
020503| NOTE: Implementation detail supporting search page behavior.
020504| src/components/ui/input.tsx:12:         className={cn(
020505| NOTE: Tailwind classes define layout and styling.
020506| src/components/ui/input.tsx:13:           "w-full bg-zinc-50 hover:bg-zinc-100 focus:bg-white border border-zinc-200 rounded-xl px-4 py-3 sm:py-3.5 text-zinc-900 placeholder:text-zinc-400 outline-none focus-visible:ring-2 focus-visible:ring-zinc-900/10 focus:border-zinc-900 transition-all duration-200 disabled:cursor-not-allowed disabled:opacity-50 text-base touch-target dark:bg-zinc-800 dark:hover:bg-zinc-700 dark:focus:bg-zinc-900 dark:border-zinc-700 dark:text-white dark:placeholder:text-zinc-500 dark:focus-visible:ring-zinc-400/20 dark:focus:border-zinc-500",
020507| NOTE: Implementation detail supporting search page behavior.
020508| src/components/ui/input.tsx:14:           className,
020509| NOTE: Implementation detail supporting search page behavior.
020510| src/components/ui/input.tsx:15:         )}
020511| NOTE: Implementation detail supporting search page behavior.
020512| src/components/ui/input.tsx:16:         ref={ref}
020513| NOTE: Implementation detail supporting search page behavior.
020514| src/components/ui/input.tsx:17:         suppressHydrationWarning
020515| NOTE: Implementation detail supporting search page behavior.
020516| src/components/ui/input.tsx:18:         {...props}
020517| NOTE: Implementation detail supporting search page behavior.
020518| src/components/ui/input.tsx:19:       />
020519| NOTE: Implementation detail supporting search page behavior.
020520| src/components/ui/input.tsx:20:     );
020521| NOTE: Implementation detail supporting search page behavior.
020522| src/components/ui/input.tsx:21:   },
020523| NOTE: Implementation detail supporting search page behavior.
020524| src/components/ui/input.tsx:22: );
020525| NOTE: Implementation detail supporting search page behavior.
020526| src/components/ui/input.tsx:23: Input.displayName = "Input";
020527| NOTE: Implementation detail supporting search page behavior.
020528| src/components/ui/input.tsx:24: 
020529| NOTE: Blank line for visual separation.
020530| src/components/ui/input.tsx:25: export { Input };
020531| NOTE: Implementation detail supporting search page behavior.
020532| FILE END: src/components/ui/input.tsx
020533| 
020534| FILE START: src/components/ui/select.tsx
020535| FILE ROLE: Auto-discovered dependency in search page graph.
020536| src/components/ui/select.tsx:1: "use client";
020537| NOTE: Implementation detail supporting search page behavior.
020538| src/components/ui/select.tsx:2: 
020539| NOTE: Blank line for visual separation.
020540| src/components/ui/select.tsx:3: import * as React from "react";
020541| NOTE: Imports dependency for this module.
020542| src/components/ui/select.tsx:4: import * as SelectPrimitive from "@radix-ui/react-select";
020543| NOTE: Imports dependency for this module.
020544| src/components/ui/select.tsx:5: import { Check, ChevronDown, ChevronUp } from "lucide-react";
020545| NOTE: Imports dependency for this module.
020546| src/components/ui/select.tsx:6: 
020547| NOTE: Blank line for visual separation.
020548| src/components/ui/select.tsx:7: import { cn } from "@/lib/utils";
020549| NOTE: Imports dependency for this module.
020550| src/components/ui/select.tsx:8: 
020551| NOTE: Blank line for visual separation.
020552| src/components/ui/select.tsx:9: const Select = SelectPrimitive.Root;
020553| NOTE: Local declaration used by search logic or UI.
020554| src/components/ui/select.tsx:10: 
020555| NOTE: Blank line for visual separation.
020556| src/components/ui/select.tsx:11: const SelectGroup = SelectPrimitive.Group;
020557| NOTE: Local declaration used by search logic or UI.
020558| src/components/ui/select.tsx:12: 
020559| NOTE: Blank line for visual separation.
020560| src/components/ui/select.tsx:13: const SelectValue = SelectPrimitive.Value;
020561| NOTE: Local declaration used by search logic or UI.
020562| src/components/ui/select.tsx:14: 
020563| NOTE: Blank line for visual separation.
020564| src/components/ui/select.tsx:15: const SelectTrigger = React.forwardRef<
020565| NOTE: Local declaration used by search logic or UI.
020566| src/components/ui/select.tsx:16:   React.ElementRef<typeof SelectPrimitive.Trigger>,
020567| NOTE: Implementation detail supporting search page behavior.
020568| src/components/ui/select.tsx:17:   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
020569| NOTE: Implementation detail supporting search page behavior.
020570| src/components/ui/select.tsx:18: >(({ className, children, ...props }, ref) => (
020571| NOTE: Implementation detail supporting search page behavior.
020572| src/components/ui/select.tsx:19:   <SelectPrimitive.Trigger
020573| NOTE: JSX markup for search UI.
020574| src/components/ui/select.tsx:20:     ref={ref}
020575| NOTE: Implementation detail supporting search page behavior.
020576| src/components/ui/select.tsx:21:     className={cn(
020577| NOTE: Tailwind classes define layout and styling.
020578| src/components/ui/select.tsx:22:       "flex h-11 sm:h-12 w-full items-center justify-between",
020579| NOTE: Implementation detail supporting search page behavior.
020580| src/components/ui/select.tsx:23:       "rounded-xl border border-zinc-200 dark:border-zinc-700",
020581| NOTE: Implementation detail supporting search page behavior.
020582| src/components/ui/select.tsx:24:       "bg-white dark:bg-zinc-800",
020583| NOTE: Implementation detail supporting search page behavior.
020584| src/components/ui/select.tsx:25:       "px-3 py-2.5 sm:py-3 text-sm",
020585| NOTE: Implementation detail supporting search page behavior.
020586| src/components/ui/select.tsx:26:       "text-zinc-900 dark:text-white",
020587| NOTE: Implementation detail supporting search page behavior.
020588| src/components/ui/select.tsx:27:       "placeholder:text-zinc-400 dark:placeholder:text-zinc-500",
020589| NOTE: Implementation detail supporting search page behavior.
020590| src/components/ui/select.tsx:28:       "hover:border-zinc-300 dark:hover:border-zinc-600",
020591| NOTE: Implementation detail supporting search page behavior.
020592| src/components/ui/select.tsx:29:       "focus:outline-none focus:ring-2 focus:ring-zinc-900/10 dark:focus:ring-zinc-400/20",
020593| NOTE: Implementation detail supporting search page behavior.
020594| src/components/ui/select.tsx:30:       "disabled:cursor-not-allowed disabled:opacity-50",
020595| NOTE: Implementation detail supporting search page behavior.
020596| src/components/ui/select.tsx:31:       "transition-all duration-200",
020597| NOTE: Implementation detail supporting search page behavior.
020598| src/components/ui/select.tsx:32:       "[&>span]:line-clamp-1",
020599| NOTE: Implementation detail supporting search page behavior.
020600| src/components/ui/select.tsx:33:       className,
020601| NOTE: Implementation detail supporting search page behavior.
020602| src/components/ui/select.tsx:34:     )}
020603| NOTE: Implementation detail supporting search page behavior.
020604| src/components/ui/select.tsx:35:     {...props}
020605| NOTE: Implementation detail supporting search page behavior.
020606| src/components/ui/select.tsx:36:   >
020607| NOTE: Implementation detail supporting search page behavior.
020608| src/components/ui/select.tsx:37:     {children}
020609| NOTE: Implementation detail supporting search page behavior.
020610| src/components/ui/select.tsx:38:     <SelectPrimitive.Icon asChild>
020611| NOTE: JSX markup for search UI.
020612| src/components/ui/select.tsx:39:       <ChevronDown className="h-4 w-4 text-zinc-400 dark:text-zinc-500 transition-transform duration-200 group-data-[state=open]:rotate-180" />
020613| NOTE: Tailwind classes define layout and styling.
020614| src/components/ui/select.tsx:40:     </SelectPrimitive.Icon>
020615| NOTE: JSX markup for search UI.
020616| src/components/ui/select.tsx:41:   </SelectPrimitive.Trigger>
020617| NOTE: JSX markup for search UI.
020618| src/components/ui/select.tsx:42: ));
020619| NOTE: Implementation detail supporting search page behavior.
020620| src/components/ui/select.tsx:43: SelectTrigger.displayName = SelectPrimitive.Trigger.displayName;
020621| NOTE: Implementation detail supporting search page behavior.
020622| src/components/ui/select.tsx:44: 
020623| NOTE: Blank line for visual separation.
020624| src/components/ui/select.tsx:45: const SelectScrollUpButton = React.forwardRef<
020625| NOTE: Local declaration used by search logic or UI.
020626| src/components/ui/select.tsx:46:   React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
020627| NOTE: Implementation detail supporting search page behavior.
020628| src/components/ui/select.tsx:47:   React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
020629| NOTE: Implementation detail supporting search page behavior.
020630| src/components/ui/select.tsx:48: >(({ className, ...props }, ref) => (
020631| NOTE: Implementation detail supporting search page behavior.
020632| src/components/ui/select.tsx:49:   <SelectPrimitive.ScrollUpButton
020633| NOTE: JSX markup for search UI.
020634| src/components/ui/select.tsx:50:     ref={ref}
020635| NOTE: Implementation detail supporting search page behavior.
020636| src/components/ui/select.tsx:51:     className={cn(
020637| NOTE: Tailwind classes define layout and styling.
020638| src/components/ui/select.tsx:52:       "flex cursor-default items-center justify-center py-1",
020639| NOTE: Implementation detail supporting search page behavior.
020640| src/components/ui/select.tsx:53:       className,
020641| NOTE: Implementation detail supporting search page behavior.
020642| src/components/ui/select.tsx:54:     )}
020643| NOTE: Implementation detail supporting search page behavior.
020644| src/components/ui/select.tsx:55:     {...props}
020645| NOTE: Implementation detail supporting search page behavior.
020646| src/components/ui/select.tsx:56:   >
020647| NOTE: Implementation detail supporting search page behavior.
020648| src/components/ui/select.tsx:57:     <ChevronUp className="h-4 w-4" />
020649| NOTE: Tailwind classes define layout and styling.
020650| src/components/ui/select.tsx:58:   </SelectPrimitive.ScrollUpButton>
020651| NOTE: JSX markup for search UI.
020652| src/components/ui/select.tsx:59: ));
020653| NOTE: Implementation detail supporting search page behavior.
020654| src/components/ui/select.tsx:60: SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName;
020655| NOTE: Implementation detail supporting search page behavior.
020656| src/components/ui/select.tsx:61: 
020657| NOTE: Blank line for visual separation.
020658| src/components/ui/select.tsx:62: const SelectScrollDownButton = React.forwardRef<
020659| NOTE: Local declaration used by search logic or UI.
020660| src/components/ui/select.tsx:63:   React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
020661| NOTE: Implementation detail supporting search page behavior.
020662| src/components/ui/select.tsx:64:   React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
020663| NOTE: Implementation detail supporting search page behavior.
020664| src/components/ui/select.tsx:65: >(({ className, ...props }, ref) => (
020665| NOTE: Implementation detail supporting search page behavior.
020666| src/components/ui/select.tsx:66:   <SelectPrimitive.ScrollDownButton
020667| NOTE: JSX markup for search UI.
020668| src/components/ui/select.tsx:67:     ref={ref}
020669| NOTE: Implementation detail supporting search page behavior.
020670| src/components/ui/select.tsx:68:     className={cn(
020671| NOTE: Tailwind classes define layout and styling.
020672| src/components/ui/select.tsx:69:       "flex cursor-default items-center justify-center py-1",
020673| NOTE: Implementation detail supporting search page behavior.
020674| src/components/ui/select.tsx:70:       className,
020675| NOTE: Implementation detail supporting search page behavior.
020676| src/components/ui/select.tsx:71:     )}
020677| NOTE: Implementation detail supporting search page behavior.
020678| src/components/ui/select.tsx:72:     {...props}
020679| NOTE: Implementation detail supporting search page behavior.
020680| src/components/ui/select.tsx:73:   >
020681| NOTE: Implementation detail supporting search page behavior.
020682| src/components/ui/select.tsx:74:     <ChevronDown className="h-4 w-4" />
020683| NOTE: Tailwind classes define layout and styling.
020684| src/components/ui/select.tsx:75:   </SelectPrimitive.ScrollDownButton>
020685| NOTE: JSX markup for search UI.
020686| src/components/ui/select.tsx:76: ));
020687| NOTE: Implementation detail supporting search page behavior.
020688| src/components/ui/select.tsx:77: SelectScrollDownButton.displayName =
020689| NOTE: Implementation detail supporting search page behavior.
020690| src/components/ui/select.tsx:78:   SelectPrimitive.ScrollDownButton.displayName;
020691| NOTE: Implementation detail supporting search page behavior.
020692| src/components/ui/select.tsx:79: 
020693| NOTE: Blank line for visual separation.
020694| src/components/ui/select.tsx:80: const SelectContent = React.forwardRef<
020695| NOTE: Local declaration used by search logic or UI.
020696| src/components/ui/select.tsx:81:   React.ElementRef<typeof SelectPrimitive.Content>,
020697| NOTE: Implementation detail supporting search page behavior.
020698| src/components/ui/select.tsx:82:   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
020699| NOTE: Implementation detail supporting search page behavior.
020700| src/components/ui/select.tsx:83: >(({ className, children, position = "popper", ...props }, ref) => (
020701| NOTE: Implementation detail supporting search page behavior.
020702| src/components/ui/select.tsx:84:   <SelectPrimitive.Portal>
020703| NOTE: JSX markup for search UI.
020704| src/components/ui/select.tsx:85:     <SelectPrimitive.Content
020705| NOTE: JSX markup for search UI.
020706| src/components/ui/select.tsx:86:       ref={ref}
020707| NOTE: Implementation detail supporting search page behavior.
020708| src/components/ui/select.tsx:87:       className={cn(
020709| NOTE: Tailwind classes define layout and styling.
020710| src/components/ui/select.tsx:88:         "relative z-popover max-h-96 min-w-[8rem] overflow-hidden",
020711| NOTE: Implementation detail supporting search page behavior.
020712| src/components/ui/select.tsx:89:         "rounded-xl",
020713| NOTE: Implementation detail supporting search page behavior.
020714| src/components/ui/select.tsx:90:         "bg-white/95 dark:bg-zinc-900/95 backdrop-blur-xl",
020715| NOTE: Implementation detail supporting search page behavior.
020716| src/components/ui/select.tsx:91:         "border border-zinc-200/80 dark:border-zinc-700/80",
020717| NOTE: Implementation detail supporting search page behavior.
020718| src/components/ui/select.tsx:92:         "shadow-lg dark:shadow-xl",
020719| NOTE: Implementation detail supporting search page behavior.
020720| src/components/ui/select.tsx:93:         "text-zinc-900 dark:text-white",
020721| NOTE: Implementation detail supporting search page behavior.
020722| src/components/ui/select.tsx:94:         "data-[state=open]:animate-in data-[state=closed]:animate-out",
020723| NOTE: Implementation detail supporting search page behavior.
020724| src/components/ui/select.tsx:95:         "data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
020725| NOTE: Implementation detail supporting search page behavior.
020726| src/components/ui/select.tsx:96:         "data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2",
020727| NOTE: Implementation detail supporting search page behavior.
020728| src/components/ui/select.tsx:97:         "data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
020729| NOTE: Implementation detail supporting search page behavior.
020730| src/components/ui/select.tsx:98:         position === "popper" &&
020731| NOTE: Implementation detail supporting search page behavior.
020732| src/components/ui/select.tsx:99:           "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
020733| NOTE: Implementation detail supporting search page behavior.
020734| src/components/ui/select.tsx:100:         className,
020735| NOTE: Implementation detail supporting search page behavior.
020736| src/components/ui/select.tsx:101:       )}
020737| NOTE: Implementation detail supporting search page behavior.
020738| src/components/ui/select.tsx:102:       position={position}
020739| NOTE: Implementation detail supporting search page behavior.
020740| src/components/ui/select.tsx:103:       {...props}
020741| NOTE: Implementation detail supporting search page behavior.
020742| src/components/ui/select.tsx:104:     >
020743| NOTE: Implementation detail supporting search page behavior.
020744| src/components/ui/select.tsx:105:       <SelectScrollUpButton />
020745| NOTE: JSX markup for search UI.
020746| src/components/ui/select.tsx:106:       <SelectPrimitive.Viewport
020747| NOTE: JSX markup for search UI.
020748| src/components/ui/select.tsx:107:         className={cn(
020749| NOTE: Tailwind classes define layout and styling.
020750| src/components/ui/select.tsx:108:           "p-2",
020751| NOTE: Implementation detail supporting search page behavior.
020752| src/components/ui/select.tsx:109:           position === "popper" &&
020753| NOTE: Implementation detail supporting search page behavior.
020754| src/components/ui/select.tsx:110:             "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]",
020755| NOTE: Implementation detail supporting search page behavior.
020756| src/components/ui/select.tsx:111:         )}
020757| NOTE: Implementation detail supporting search page behavior.
020758| src/components/ui/select.tsx:112:       >
020759| NOTE: Implementation detail supporting search page behavior.
020760| src/components/ui/select.tsx:113:         {children}
020761| NOTE: Implementation detail supporting search page behavior.
020762| src/components/ui/select.tsx:114:       </SelectPrimitive.Viewport>
020763| NOTE: JSX markup for search UI.
020764| src/components/ui/select.tsx:115:       <SelectScrollDownButton />
020765| NOTE: JSX markup for search UI.
020766| src/components/ui/select.tsx:116:     </SelectPrimitive.Content>
020767| NOTE: JSX markup for search UI.
020768| src/components/ui/select.tsx:117:   </SelectPrimitive.Portal>
020769| NOTE: JSX markup for search UI.
020770| src/components/ui/select.tsx:118: ));
020771| NOTE: Implementation detail supporting search page behavior.
020772| src/components/ui/select.tsx:119: SelectContent.displayName = SelectPrimitive.Content.displayName;
020773| NOTE: Implementation detail supporting search page behavior.
020774| src/components/ui/select.tsx:120: 
020775| NOTE: Blank line for visual separation.
020776| src/components/ui/select.tsx:121: const SelectLabel = React.forwardRef<
020777| NOTE: Local declaration used by search logic or UI.
020778| src/components/ui/select.tsx:122:   React.ElementRef<typeof SelectPrimitive.Label>,
020779| NOTE: Implementation detail supporting search page behavior.
020780| src/components/ui/select.tsx:123:   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
020781| NOTE: Implementation detail supporting search page behavior.
020782| src/components/ui/select.tsx:124: >(({ className, ...props }, ref) => (
020783| NOTE: Implementation detail supporting search page behavior.
020784| src/components/ui/select.tsx:125:   <SelectPrimitive.Label
020785| NOTE: JSX markup for search UI.
020786| src/components/ui/select.tsx:126:     ref={ref}
020787| NOTE: Implementation detail supporting search page behavior.
020788| src/components/ui/select.tsx:127:     className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
020789| NOTE: Tailwind classes define layout and styling.
020790| src/components/ui/select.tsx:128:     {...props}
020791| NOTE: Implementation detail supporting search page behavior.
020792| src/components/ui/select.tsx:129:   />
020793| NOTE: Implementation detail supporting search page behavior.
020794| src/components/ui/select.tsx:130: ));
020795| NOTE: Implementation detail supporting search page behavior.
020796| src/components/ui/select.tsx:131: SelectLabel.displayName = SelectPrimitive.Label.displayName;
020797| NOTE: Implementation detail supporting search page behavior.
020798| src/components/ui/select.tsx:132: 
020799| NOTE: Blank line for visual separation.
020800| src/components/ui/select.tsx:133: const SelectItem = React.forwardRef<
020801| NOTE: Local declaration used by search logic or UI.
020802| src/components/ui/select.tsx:134:   React.ElementRef<typeof SelectPrimitive.Item>,
020803| NOTE: Implementation detail supporting search page behavior.
020804| src/components/ui/select.tsx:135:   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
020805| NOTE: Implementation detail supporting search page behavior.
020806| src/components/ui/select.tsx:136: >(({ className, children, ...props }, ref) => (
020807| NOTE: Implementation detail supporting search page behavior.
020808| src/components/ui/select.tsx:137:   <SelectPrimitive.Item
020809| NOTE: JSX markup for search UI.
020810| src/components/ui/select.tsx:138:     ref={ref}
020811| NOTE: Implementation detail supporting search page behavior.
020812| src/components/ui/select.tsx:139:     className={cn(
020813| NOTE: Tailwind classes define layout and styling.
020814| src/components/ui/select.tsx:140:       "relative flex w-full cursor-pointer select-none items-center",
020815| NOTE: Implementation detail supporting search page behavior.
020816| src/components/ui/select.tsx:141:       "rounded-xl py-2.5 pl-9 pr-3 text-sm",
020817| NOTE: Implementation detail supporting search page behavior.
020818| src/components/ui/select.tsx:142:       "text-zinc-700 dark:text-zinc-300",
020819| NOTE: Implementation detail supporting search page behavior.
020820| src/components/ui/select.tsx:143:       "outline-none transition-colors duration-150",
020821| NOTE: Implementation detail supporting search page behavior.
020822| src/components/ui/select.tsx:144:       "hover:bg-zinc-100/80 dark:hover:bg-zinc-800/80",
020823| NOTE: Implementation detail supporting search page behavior.
020824| src/components/ui/select.tsx:145:       "focus:bg-zinc-100 dark:focus:bg-zinc-800",
020825| NOTE: Implementation detail supporting search page behavior.
020826| src/components/ui/select.tsx:146:       "data-[state=checked]:text-zinc-900 dark:data-[state=checked]:text-white",
020827| NOTE: Implementation detail supporting search page behavior.
020828| src/components/ui/select.tsx:147:       "data-[state=checked]:font-medium",
020829| NOTE: Implementation detail supporting search page behavior.
020830| src/components/ui/select.tsx:148:       "data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
020831| NOTE: Implementation detail supporting search page behavior.
020832| src/components/ui/select.tsx:149:       className,
020833| NOTE: Implementation detail supporting search page behavior.
020834| src/components/ui/select.tsx:150:     )}
020835| NOTE: Implementation detail supporting search page behavior.
020836| src/components/ui/select.tsx:151:     {...props}
020837| NOTE: Implementation detail supporting search page behavior.
020838| src/components/ui/select.tsx:152:   >
020839| NOTE: Implementation detail supporting search page behavior.
020840| src/components/ui/select.tsx:153:     <span className="absolute left-3 flex h-4 w-4 items-center justify-center">
020841| NOTE: Tailwind classes define layout and styling.
020842| src/components/ui/select.tsx:154:       <SelectPrimitive.ItemIndicator>
020843| NOTE: JSX markup for search UI.
020844| src/components/ui/select.tsx:155:         <Check className="h-4 w-4 text-zinc-900 dark:text-white" />
020845| NOTE: Tailwind classes define layout and styling.
020846| src/components/ui/select.tsx:156:       </SelectPrimitive.ItemIndicator>
020847| NOTE: JSX markup for search UI.
020848| src/components/ui/select.tsx:157:     </span>
020849| NOTE: JSX markup for search UI.
020850| src/components/ui/select.tsx:158: 
020851| NOTE: Blank line for visual separation.
020852| src/components/ui/select.tsx:159:     <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
020853| NOTE: JSX markup for search UI.
020854| src/components/ui/select.tsx:160:   </SelectPrimitive.Item>
020855| NOTE: JSX markup for search UI.
020856| src/components/ui/select.tsx:161: ));
020857| NOTE: Implementation detail supporting search page behavior.
020858| src/components/ui/select.tsx:162: SelectItem.displayName = SelectPrimitive.Item.displayName;
020859| NOTE: Implementation detail supporting search page behavior.
020860| src/components/ui/select.tsx:163: 
020861| NOTE: Blank line for visual separation.
020862| src/components/ui/select.tsx:164: const SelectSeparator = React.forwardRef<
020863| NOTE: Local declaration used by search logic or UI.
020864| src/components/ui/select.tsx:165:   React.ElementRef<typeof SelectPrimitive.Separator>,
020865| NOTE: Implementation detail supporting search page behavior.
020866| src/components/ui/select.tsx:166:   React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
020867| NOTE: Implementation detail supporting search page behavior.
020868| src/components/ui/select.tsx:167: >(({ className, ...props }, ref) => (
020869| NOTE: Implementation detail supporting search page behavior.
020870| src/components/ui/select.tsx:168:   <SelectPrimitive.Separator
020871| NOTE: JSX markup for search UI.
020872| src/components/ui/select.tsx:169:     ref={ref}
020873| NOTE: Implementation detail supporting search page behavior.
020874| src/components/ui/select.tsx:170:     className={cn("-mx-1 my-1 h-px bg-muted", className)}
020875| NOTE: Tailwind classes define layout and styling.
020876| src/components/ui/select.tsx:171:     {...props}
020877| NOTE: Implementation detail supporting search page behavior.
020878| src/components/ui/select.tsx:172:   />
020879| NOTE: Implementation detail supporting search page behavior.
020880| src/components/ui/select.tsx:173: ));
020881| NOTE: Implementation detail supporting search page behavior.
020882| src/components/ui/select.tsx:174: SelectSeparator.displayName = SelectPrimitive.Separator.displayName;
020883| NOTE: Implementation detail supporting search page behavior.
020884| src/components/ui/select.tsx:175: 
020885| NOTE: Blank line for visual separation.
020886| src/components/ui/select.tsx:176: export {
020887| NOTE: Implementation detail supporting search page behavior.
020888| src/components/ui/select.tsx:177:   Select,
020889| NOTE: Implementation detail supporting search page behavior.
020890| src/components/ui/select.tsx:178:   SelectGroup,
020891| NOTE: Implementation detail supporting search page behavior.
020892| src/components/ui/select.tsx:179:   SelectValue,
020893| NOTE: Implementation detail supporting search page behavior.
020894| src/components/ui/select.tsx:180:   SelectTrigger,
020895| NOTE: Implementation detail supporting search page behavior.
020896| src/components/ui/select.tsx:181:   SelectContent,
020897| NOTE: Implementation detail supporting search page behavior.
020898| src/components/ui/select.tsx:182:   SelectLabel,
020899| NOTE: Implementation detail supporting search page behavior.
020900| src/components/ui/select.tsx:183:   SelectItem,
020901| NOTE: Implementation detail supporting search page behavior.
020902| src/components/ui/select.tsx:184:   SelectSeparator,
020903| NOTE: Implementation detail supporting search page behavior.
020904| src/components/ui/select.tsx:185:   SelectScrollUpButton,
020905| NOTE: Implementation detail supporting search page behavior.
020906| src/components/ui/select.tsx:186:   SelectScrollDownButton,
020907| NOTE: Implementation detail supporting search page behavior.
020908| src/components/ui/select.tsx:187: };
020909| NOTE: Implementation detail supporting search page behavior.
020910| FILE END: src/components/ui/select.tsx
020911| 
020912| FILE START: src/contexts/FilterStateContext.tsx
020913| FILE ROLE: Auto-discovered dependency in search page graph.
020914| src/contexts/FilterStateContext.tsx:1: "use client";
020915| NOTE: Implementation detail supporting search page behavior.
020916| src/contexts/FilterStateContext.tsx:2: 
020917| NOTE: Blank line for visual separation.
020918| src/contexts/FilterStateContext.tsx:3: /**
020919| NOTE: Block comment line describing behavior or context.
020920| src/contexts/FilterStateContext.tsx:4:  * FilterStateContext - Shares pending filter state across components
020921| NOTE: Block comment line describing behavior or context.
020922| src/contexts/FilterStateContext.tsx:5:  *
020923| NOTE: Block comment line describing behavior or context.
020924| src/contexts/FilterStateContext.tsx:6:  * This context allows components outside the filter drawer (like SearchLayoutView)
020925| NOTE: Block comment line describing behavior or context.
020926| src/contexts/FilterStateContext.tsx:7:  * to know when there are pending filter changes that haven't been applied yet.
020927| NOTE: Block comment line describing behavior or context.
020928| src/contexts/FilterStateContext.tsx:8:  * This enables showing a "Pending changes" banner above the results list.
020929| NOTE: Block comment line describing behavior or context.
020930| src/contexts/FilterStateContext.tsx:9:  */
020931| NOTE: Block comment line describing behavior or context.
020932| src/contexts/FilterStateContext.tsx:10: 
020933| NOTE: Blank line for visual separation.
020934| src/contexts/FilterStateContext.tsx:11: import {
020935| NOTE: Imports dependency for this module.
020936| src/contexts/FilterStateContext.tsx:12:   createContext,
020937| NOTE: Implementation detail supporting search page behavior.
020938| src/contexts/FilterStateContext.tsx:13:   useContext,
020939| NOTE: Implementation detail supporting search page behavior.
020940| src/contexts/FilterStateContext.tsx:14:   useState,
020941| NOTE: Initializes local state for search UI behavior.
020942| src/contexts/FilterStateContext.tsx:15:   useCallback,
020943| NOTE: Memoizes callback to preserve references across renders.
020944| src/contexts/FilterStateContext.tsx:16:   useRef,
020945| NOTE: Uses ref for stable mutable storage between renders.
020946| src/contexts/FilterStateContext.tsx:17:   useMemo,
020947| NOTE: Memoizes derived values to reduce re-render work.
020948| src/contexts/FilterStateContext.tsx:18: } from "react";
020949| NOTE: Implementation detail supporting search page behavior.
020950| src/contexts/FilterStateContext.tsx:19: 
020951| NOTE: Blank line for visual separation.
020952| src/contexts/FilterStateContext.tsx:20: interface FilterStateContextValue {
020953| NOTE: Type declaration for search data contracts.
020954| src/contexts/FilterStateContext.tsx:21:   /** Whether there are pending filter changes */
020955| NOTE: Block comment line describing behavior or context.
020956| src/contexts/FilterStateContext.tsx:22:   isDirty: boolean;
020957| NOTE: Implementation detail supporting search page behavior.
020958| src/contexts/FilterStateContext.tsx:23:   /** Number of pending filter changes */
020959| NOTE: Block comment line describing behavior or context.
020960| src/contexts/FilterStateContext.tsx:24:   changeCount: number;
020961| NOTE: Implementation detail supporting search page behavior.
020962| src/contexts/FilterStateContext.tsx:25:   /** Whether the filter drawer is currently open */
020963| NOTE: Block comment line describing behavior or context.
020964| src/contexts/FilterStateContext.tsx:26:   isDrawerOpen: boolean;
020965| NOTE: Implementation detail supporting search page behavior.
020966| src/contexts/FilterStateContext.tsx:27:   /** Update dirty state (called by SearchForm) */
020967| NOTE: Block comment line describing behavior or context.
020968| src/contexts/FilterStateContext.tsx:28:   setDirtyState: (isDirty: boolean, changeCount: number) => void;
020969| NOTE: Implementation detail supporting search page behavior.
020970| src/contexts/FilterStateContext.tsx:29:   /** Update drawer open state (called by SearchForm) */
020971| NOTE: Block comment line describing behavior or context.
020972| src/contexts/FilterStateContext.tsx:30:   setDrawerOpen: (isOpen: boolean) => void;
020973| NOTE: Implementation detail supporting search page behavior.
020974| src/contexts/FilterStateContext.tsx:31:   /** Callback to open the filter drawer (set by SearchForm) */
020975| NOTE: Block comment line describing behavior or context.
020976| src/contexts/FilterStateContext.tsx:32:   openDrawer: () => void;
020977| NOTE: Implementation detail supporting search page behavior.
020978| src/contexts/FilterStateContext.tsx:33:   /** Register the open drawer callback (called by SearchForm) */
020979| NOTE: Block comment line describing behavior or context.
020980| src/contexts/FilterStateContext.tsx:34:   registerOpenDrawer: (callback: () => void) => void;
020981| NOTE: Implementation detail supporting search page behavior.
020982| src/contexts/FilterStateContext.tsx:35: }
020983| NOTE: Implementation detail supporting search page behavior.
020984| src/contexts/FilterStateContext.tsx:36: 
020985| NOTE: Blank line for visual separation.
020986| src/contexts/FilterStateContext.tsx:37: const FilterStateContext = createContext<FilterStateContextValue | null>(null);
020987| NOTE: Local declaration used by search logic or UI.
020988| src/contexts/FilterStateContext.tsx:38: 
020989| NOTE: Blank line for visual separation.
020990| src/contexts/FilterStateContext.tsx:39: export function FilterStateProvider({
020991| NOTE: Exports helper or component function.
020992| src/contexts/FilterStateContext.tsx:40:   children,
020993| NOTE: Implementation detail supporting search page behavior.
020994| src/contexts/FilterStateContext.tsx:41: }: {
020995| NOTE: Implementation detail supporting search page behavior.
020996| src/contexts/FilterStateContext.tsx:42:   children: React.ReactNode;
020997| NOTE: Implementation detail supporting search page behavior.
020998| src/contexts/FilterStateContext.tsx:43: }) {
020999| NOTE: Implementation detail supporting search page behavior.
021000| src/contexts/FilterStateContext.tsx:44:   const [isDirty, setIsDirty] = useState(false);
021001| NOTE: Initializes local state for search UI behavior.
021002| src/contexts/FilterStateContext.tsx:45:   const [changeCount, setChangeCount] = useState(0);
021003| NOTE: Initializes local state for search UI behavior.
021004| src/contexts/FilterStateContext.tsx:46:   const [isDrawerOpen, setIsDrawerOpen] = useState(false);
021005| NOTE: Initializes local state for search UI behavior.
021006| src/contexts/FilterStateContext.tsx:47: 
021007| NOTE: Blank line for visual separation.
021008| src/contexts/FilterStateContext.tsx:48:   // Use ref for callback to avoid re-renders when registering
021009| NOTE: Line comment documents intent or constraints.
021010| src/contexts/FilterStateContext.tsx:49:   // This prevents infinite loops when SearchForm registers its callback
021011| NOTE: Line comment documents intent or constraints.
021012| src/contexts/FilterStateContext.tsx:50:   const openDrawerCallbackRef = useRef<() => void>(() => {});
021013| NOTE: Uses ref for stable mutable storage between renders.
021014| src/contexts/FilterStateContext.tsx:51: 
021015| NOTE: Blank line for visual separation.
021016| src/contexts/FilterStateContext.tsx:52:   const setDirtyState = useCallback((dirty: boolean, count: number) => {
021017| NOTE: Memoizes callback to preserve references across renders.
021018| src/contexts/FilterStateContext.tsx:53:     setIsDirty(dirty);
021019| NOTE: Implementation detail supporting search page behavior.
021020| src/contexts/FilterStateContext.tsx:54:     setChangeCount(count);
021021| NOTE: Implementation detail supporting search page behavior.
021022| src/contexts/FilterStateContext.tsx:55:   }, []);
021023| NOTE: Implementation detail supporting search page behavior.
021024| src/contexts/FilterStateContext.tsx:56: 
021025| NOTE: Blank line for visual separation.
021026| src/contexts/FilterStateContext.tsx:57:   const setDrawerOpen = useCallback((isOpen: boolean) => {
021027| NOTE: Memoizes callback to preserve references across renders.
021028| src/contexts/FilterStateContext.tsx:58:     setIsDrawerOpen(isOpen);
021029| NOTE: Implementation detail supporting search page behavior.
021030| src/contexts/FilterStateContext.tsx:59:   }, []);
021031| NOTE: Implementation detail supporting search page behavior.
021032| src/contexts/FilterStateContext.tsx:60: 
021033| NOTE: Blank line for visual separation.
021034| src/contexts/FilterStateContext.tsx:61:   // Use ref assignment instead of state to prevent re-renders
021035| NOTE: Line comment documents intent or constraints.
021036| src/contexts/FilterStateContext.tsx:62:   const registerOpenDrawer = useCallback((callback: () => void) => {
021037| NOTE: Memoizes callback to preserve references across renders.
021038| src/contexts/FilterStateContext.tsx:63:     openDrawerCallbackRef.current = callback;
021039| NOTE: Implementation detail supporting search page behavior.
021040| src/contexts/FilterStateContext.tsx:64:   }, []);
021041| NOTE: Implementation detail supporting search page behavior.
021042| src/contexts/FilterStateContext.tsx:65: 
021043| NOTE: Blank line for visual separation.
021044| src/contexts/FilterStateContext.tsx:66:   // Stable function that reads from ref
021045| NOTE: Line comment documents intent or constraints.
021046| src/contexts/FilterStateContext.tsx:67:   const openDrawer = useCallback(() => {
021047| NOTE: Memoizes callback to preserve references across renders.
021048| src/contexts/FilterStateContext.tsx:68:     openDrawerCallbackRef.current();
021049| NOTE: Implementation detail supporting search page behavior.
021050| src/contexts/FilterStateContext.tsx:69:   }, []);
021051| NOTE: Implementation detail supporting search page behavior.
021052| src/contexts/FilterStateContext.tsx:70: 
021053| NOTE: Blank line for visual separation.
021054| src/contexts/FilterStateContext.tsx:71:   // Memoize context value to prevent unnecessary re-renders of consumers
021055| NOTE: Line comment documents intent or constraints.
021056| src/contexts/FilterStateContext.tsx:72:   const contextValue = useMemo(
021057| NOTE: Memoizes derived values to reduce re-render work.
021058| src/contexts/FilterStateContext.tsx:73:     () => ({
021059| NOTE: Implementation detail supporting search page behavior.
021060| src/contexts/FilterStateContext.tsx:74:       isDirty,
021061| NOTE: Implementation detail supporting search page behavior.
021062| src/contexts/FilterStateContext.tsx:75:       changeCount,
021063| NOTE: Implementation detail supporting search page behavior.
021064| src/contexts/FilterStateContext.tsx:76:       isDrawerOpen,
021065| NOTE: Implementation detail supporting search page behavior.
021066| src/contexts/FilterStateContext.tsx:77:       setDirtyState,
021067| NOTE: Implementation detail supporting search page behavior.
021068| src/contexts/FilterStateContext.tsx:78:       setDrawerOpen,
021069| NOTE: Implementation detail supporting search page behavior.
021070| src/contexts/FilterStateContext.tsx:79:       openDrawer,
021071| NOTE: Implementation detail supporting search page behavior.
021072| src/contexts/FilterStateContext.tsx:80:       registerOpenDrawer,
021073| NOTE: Implementation detail supporting search page behavior.
021074| src/contexts/FilterStateContext.tsx:81:     }),
021075| NOTE: Implementation detail supporting search page behavior.
021076| src/contexts/FilterStateContext.tsx:82:     [
021077| NOTE: Implementation detail supporting search page behavior.
021078| src/contexts/FilterStateContext.tsx:83:       isDirty,
021079| NOTE: Implementation detail supporting search page behavior.
021080| src/contexts/FilterStateContext.tsx:84:       changeCount,
021081| NOTE: Implementation detail supporting search page behavior.
021082| src/contexts/FilterStateContext.tsx:85:       isDrawerOpen,
021083| NOTE: Implementation detail supporting search page behavior.
021084| src/contexts/FilterStateContext.tsx:86:       setDirtyState,
021085| NOTE: Implementation detail supporting search page behavior.
021086| src/contexts/FilterStateContext.tsx:87:       setDrawerOpen,
021087| NOTE: Implementation detail supporting search page behavior.
021088| src/contexts/FilterStateContext.tsx:88:       openDrawer,
021089| NOTE: Implementation detail supporting search page behavior.
021090| src/contexts/FilterStateContext.tsx:89:       registerOpenDrawer,
021091| NOTE: Implementation detail supporting search page behavior.
021092| src/contexts/FilterStateContext.tsx:90:     ],
021093| NOTE: Implementation detail supporting search page behavior.
021094| src/contexts/FilterStateContext.tsx:91:   );
021095| NOTE: Implementation detail supporting search page behavior.
021096| src/contexts/FilterStateContext.tsx:92: 
021097| NOTE: Blank line for visual separation.
021098| src/contexts/FilterStateContext.tsx:93:   return (
021099| NOTE: Return statement for component or helper output.
021100| src/contexts/FilterStateContext.tsx:94:     <FilterStateContext.Provider value={contextValue}>
021101| NOTE: JSX markup for search UI.
021102| src/contexts/FilterStateContext.tsx:95:       {children}
021103| NOTE: Implementation detail supporting search page behavior.
021104| src/contexts/FilterStateContext.tsx:96:     </FilterStateContext.Provider>
021105| NOTE: JSX markup for search UI.
021106| src/contexts/FilterStateContext.tsx:97:   );
021107| NOTE: Implementation detail supporting search page behavior.
021108| src/contexts/FilterStateContext.tsx:98: }
021109| NOTE: Implementation detail supporting search page behavior.
021110| src/contexts/FilterStateContext.tsx:99: 
021111| NOTE: Blank line for visual separation.
021112| src/contexts/FilterStateContext.tsx:100: /**
021113| NOTE: Block comment line describing behavior or context.
021114| src/contexts/FilterStateContext.tsx:101:  * Hook to access filter state context
021115| NOTE: Block comment line describing behavior or context.
021116| src/contexts/FilterStateContext.tsx:102:  * Returns null if used outside provider (safe fallback)
021117| NOTE: Block comment line describing behavior or context.
021118| src/contexts/FilterStateContext.tsx:103:  */
021119| NOTE: Block comment line describing behavior or context.
021120| src/contexts/FilterStateContext.tsx:104: export function useFilterStateSafe() {
021121| NOTE: Exports helper or component function.
021122| src/contexts/FilterStateContext.tsx:105:   return useContext(FilterStateContext);
021123| NOTE: Return statement for component or helper output.
021124| src/contexts/FilterStateContext.tsx:106: }
021125| NOTE: Implementation detail supporting search page behavior.
021126| src/contexts/FilterStateContext.tsx:107: 
021127| NOTE: Blank line for visual separation.
021128| src/contexts/FilterStateContext.tsx:108: /**
021129| NOTE: Block comment line describing behavior or context.
021130| src/contexts/FilterStateContext.tsx:109:  * Hook to access filter state context
021131| NOTE: Block comment line describing behavior or context.
021132| src/contexts/FilterStateContext.tsx:110:  * Throws if used outside provider
021133| NOTE: Block comment line describing behavior or context.
021134| src/contexts/FilterStateContext.tsx:111:  */
021135| NOTE: Block comment line describing behavior or context.
021136| src/contexts/FilterStateContext.tsx:112: export function useFilterState() {
021137| NOTE: Exports helper or component function.
021138| src/contexts/FilterStateContext.tsx:113:   const context = useContext(FilterStateContext);
021139| NOTE: Local declaration used by search logic or UI.
021140| src/contexts/FilterStateContext.tsx:114:   if (!context) {
021141| NOTE: Conditional logic controlling rendering or flow.
021142| src/contexts/FilterStateContext.tsx:115:     throw new Error("useFilterState must be used within FilterStateProvider");
021143| NOTE: Implementation detail supporting search page behavior.
021144| src/contexts/FilterStateContext.tsx:116:   }
021145| NOTE: Implementation detail supporting search page behavior.
021146| src/contexts/FilterStateContext.tsx:117:   return context;
021147| NOTE: Return statement for component or helper output.
021148| src/contexts/FilterStateContext.tsx:118: }
021149| NOTE: Implementation detail supporting search page behavior.
021150| FILE END: src/contexts/FilterStateContext.tsx
021151| 
021152| FILE START: src/contexts/ListingFocusContext.tsx
021153| FILE ROLE: Auto-discovered dependency in search page graph.
021154| src/contexts/ListingFocusContext.tsx:1: "use client";
021155| NOTE: Implementation detail supporting search page behavior.
021156| src/contexts/ListingFocusContext.tsx:2: 
021157| NOTE: Blank line for visual separation.
021158| src/contexts/ListingFocusContext.tsx:3: /**
021159| NOTE: Block comment line describing behavior or context.
021160| src/contexts/ListingFocusContext.tsx:4:  * ListingFocusContext - Shared state for list \u2194 map hover/selection sync
021161| NOTE: Block comment line describing behavior or context.
021162| src/contexts/ListingFocusContext.tsx:5:  *
021163| NOTE: Block comment line describing behavior or context.
021164| src/contexts/ListingFocusContext.tsx:6:  * This context enables the two-way mirror between listing cards and map markers:
021165| NOTE: Block comment line describing behavior or context.
021166| src/contexts/ListingFocusContext.tsx:7:  * 1. Hovering a card highlights the corresponding map marker
021167| NOTE: Block comment line describing behavior or context.
021168| src/contexts/ListingFocusContext.tsx:8:  * 2. Clicking a map marker scrolls to and highlights the card
021169| NOTE: Block comment line describing behavior or context.
021170| src/contexts/ListingFocusContext.tsx:9:  *
021171| NOTE: Block comment line describing behavior or context.
021172| src/contexts/ListingFocusContext.tsx:10:  * State:
021173| NOTE: Block comment line describing behavior or context.
021174| src/contexts/ListingFocusContext.tsx:11:  * - hoveredId: Listing being hovered (from either list or map)
021175| NOTE: Block comment line describing behavior or context.
021176| src/contexts/ListingFocusContext.tsx:12:  * - activeId: Listing actively selected (persistent, no auto-clear)
021177| NOTE: Block comment line describing behavior or context.
021178| src/contexts/ListingFocusContext.tsx:13:  * - scrollRequest: One-shot scroll command with nonce for deduplication
021179| NOTE: Block comment line describing behavior or context.
021180| src/contexts/ListingFocusContext.tsx:14:  */
021181| NOTE: Block comment line describing behavior or context.
021182| src/contexts/ListingFocusContext.tsx:15: 
021183| NOTE: Blank line for visual separation.
021184| src/contexts/ListingFocusContext.tsx:16: import {
021185| NOTE: Imports dependency for this module.
021186| src/contexts/ListingFocusContext.tsx:17:   createContext,
021187| NOTE: Implementation detail supporting search page behavior.
021188| src/contexts/ListingFocusContext.tsx:18:   useContext,
021189| NOTE: Implementation detail supporting search page behavior.
021190| src/contexts/ListingFocusContext.tsx:19:   useState,
021191| NOTE: Initializes local state for search UI behavior.
021192| src/contexts/ListingFocusContext.tsx:20:   useCallback,
021193| NOTE: Memoizes callback to preserve references across renders.
021194| src/contexts/ListingFocusContext.tsx:21:   useMemo,
021195| NOTE: Memoizes derived values to reduce re-render work.
021196| src/contexts/ListingFocusContext.tsx:22:   useRef,
021197| NOTE: Uses ref for stable mutable storage between renders.
021198| src/contexts/ListingFocusContext.tsx:23: } from "react";
021199| NOTE: Implementation detail supporting search page behavior.
021200| src/contexts/ListingFocusContext.tsx:24: 
021201| NOTE: Blank line for visual separation.
021202| src/contexts/ListingFocusContext.tsx:25: /** One-shot scroll request with nonce for deduplication */
021203| NOTE: Block comment line describing behavior or context.
021204| src/contexts/ListingFocusContext.tsx:26: export interface ScrollRequest {
021205| NOTE: Implementation detail supporting search page behavior.
021206| src/contexts/ListingFocusContext.tsx:27:   id: string;
021207| NOTE: Implementation detail supporting search page behavior.
021208| src/contexts/ListingFocusContext.tsx:28:   nonce: number;
021209| NOTE: Implementation detail supporting search page behavior.
021210| src/contexts/ListingFocusContext.tsx:29: }
021211| NOTE: Implementation detail supporting search page behavior.
021212| src/contexts/ListingFocusContext.tsx:30: 
021213| NOTE: Blank line for visual separation.
021214| src/contexts/ListingFocusContext.tsx:31: interface ListingFocusState {
021215| NOTE: Type declaration for search data contracts.
021216| src/contexts/ListingFocusContext.tsx:32:   /** ID of listing being hovered (null = none) */
021217| NOTE: Block comment line describing behavior or context.
021218| src/contexts/ListingFocusContext.tsx:33:   hoveredId: string | null;
021219| NOTE: Implementation detail supporting search page behavior.
021220| src/contexts/ListingFocusContext.tsx:34:   /** ID of listing actively selected (persistent until changed/cleared) */
021221| NOTE: Block comment line describing behavior or context.
021222| src/contexts/ListingFocusContext.tsx:35:   activeId: string | null;
021223| NOTE: Implementation detail supporting search page behavior.
021224| src/contexts/ListingFocusContext.tsx:36:   /** One-shot scroll command - consumer should ack after handling */
021225| NOTE: Block comment line describing behavior or context.
021226| src/contexts/ListingFocusContext.tsx:37:   scrollRequest: ScrollRequest | null;
021227| NOTE: Implementation detail supporting search page behavior.
021228| src/contexts/ListingFocusContext.tsx:38: }
021229| NOTE: Implementation detail supporting search page behavior.
021230| src/contexts/ListingFocusContext.tsx:39: 
021231| NOTE: Blank line for visual separation.
021232| src/contexts/ListingFocusContext.tsx:40: interface ListingFocusContextValue extends ListingFocusState {
021233| NOTE: Type declaration for search data contracts.
021234| src/contexts/ListingFocusContext.tsx:41:   /** Set hovered listing (from card or marker hover) */
021235| NOTE: Block comment line describing behavior or context.
021236| src/contexts/ListingFocusContext.tsx:42:   setHovered: (id: string | null) => void;
021237| NOTE: Implementation detail supporting search page behavior.
021238| src/contexts/ListingFocusContext.tsx:43:   /** Set active listing (persistent selection, no auto-clear) */
021239| NOTE: Block comment line describing behavior or context.
021240| src/contexts/ListingFocusContext.tsx:44:   setActive: (id: string | null) => void;
021241| NOTE: Implementation detail supporting search page behavior.
021242| src/contexts/ListingFocusContext.tsx:45:   /** Request scroll to a listing (fires one-shot command with nonce) */
021243| NOTE: Block comment line describing behavior or context.
021244| src/contexts/ListingFocusContext.tsx:46:   requestScrollTo: (id: string) => void;
021245| NOTE: Implementation detail supporting search page behavior.
021246| src/contexts/ListingFocusContext.tsx:47:   /** Acknowledge scroll request (clears only if nonce matches) */
021247| NOTE: Block comment line describing behavior or context.
021248| src/contexts/ListingFocusContext.tsx:48:   ackScrollTo: (nonce: number) => void;
021249| NOTE: Implementation detail supporting search page behavior.
021250| src/contexts/ListingFocusContext.tsx:49:   /** Clear all focus state (hovered + active + scrollRequest) */
021251| NOTE: Block comment line describing behavior or context.
021252| src/contexts/ListingFocusContext.tsx:50:   clearFocus: () => void;
021253| NOTE: Implementation detail supporting search page behavior.
021254| src/contexts/ListingFocusContext.tsx:51: }
021255| NOTE: Implementation detail supporting search page behavior.
021256| src/contexts/ListingFocusContext.tsx:52: 
021257| NOTE: Blank line for visual separation.
021258| src/contexts/ListingFocusContext.tsx:53: const ListingFocusContext = createContext<ListingFocusContextValue | null>(
021259| NOTE: Local declaration used by search logic or UI.
021260| src/contexts/ListingFocusContext.tsx:54:   null,
021261| NOTE: Implementation detail supporting search page behavior.
021262| src/contexts/ListingFocusContext.tsx:55: );
021263| NOTE: Implementation detail supporting search page behavior.
021264| src/contexts/ListingFocusContext.tsx:56: 
021265| NOTE: Blank line for visual separation.
021266| src/contexts/ListingFocusContext.tsx:57: /**
021267| NOTE: Block comment line describing behavior or context.
021268| src/contexts/ListingFocusContext.tsx:58:  * Stable fallback for SSR and when used outside provider.
021269| NOTE: Block comment line describing behavior or context.
021270| src/contexts/ListingFocusContext.tsx:59:  * This prevents the re-render cascade that occurs when returning
021271| NOTE: Block comment line describing behavior or context.
021272| src/contexts/ListingFocusContext.tsx:60:  * a new object from useListingFocus() on every call.
021273| NOTE: Block comment line describing behavior or context.
021274| src/contexts/ListingFocusContext.tsx:61:  */
021275| NOTE: Block comment line describing behavior or context.
021276| src/contexts/ListingFocusContext.tsx:62: const SSR_FALLBACK: ListingFocusContextValue = {
021277| NOTE: Local declaration used by search logic or UI.
021278| src/contexts/ListingFocusContext.tsx:63:   hoveredId: null,
021279| NOTE: Implementation detail supporting search page behavior.
021280| src/contexts/ListingFocusContext.tsx:64:   activeId: null,
021281| NOTE: Implementation detail supporting search page behavior.
021282| src/contexts/ListingFocusContext.tsx:65:   scrollRequest: null,
021283| NOTE: Implementation detail supporting search page behavior.
021284| src/contexts/ListingFocusContext.tsx:66:   setHovered: () => {},
021285| NOTE: Implementation detail supporting search page behavior.
021286| src/contexts/ListingFocusContext.tsx:67:   setActive: () => {},
021287| NOTE: Implementation detail supporting search page behavior.
021288| src/contexts/ListingFocusContext.tsx:68:   requestScrollTo: () => {},
021289| NOTE: Implementation detail supporting search page behavior.
021290| src/contexts/ListingFocusContext.tsx:69:   ackScrollTo: () => {},
021291| NOTE: Implementation detail supporting search page behavior.
021292| src/contexts/ListingFocusContext.tsx:70:   clearFocus: () => {},
021293| NOTE: Implementation detail supporting search page behavior.
021294| src/contexts/ListingFocusContext.tsx:71: };
021295| NOTE: Implementation detail supporting search page behavior.
021296| src/contexts/ListingFocusContext.tsx:72: 
021297| NOTE: Blank line for visual separation.
021298| src/contexts/ListingFocusContext.tsx:73: export function ListingFocusProvider({
021299| NOTE: Exports helper or component function.
021300| src/contexts/ListingFocusContext.tsx:74:   children,
021301| NOTE: Implementation detail supporting search page behavior.
021302| src/contexts/ListingFocusContext.tsx:75: }: {
021303| NOTE: Implementation detail supporting search page behavior.
021304| src/contexts/ListingFocusContext.tsx:76:   children: React.ReactNode;
021305| NOTE: Implementation detail supporting search page behavior.
021306| src/contexts/ListingFocusContext.tsx:77: }) {
021307| NOTE: Implementation detail supporting search page behavior.
021308| src/contexts/ListingFocusContext.tsx:78:   const [hoveredId, setHoveredId] = useState<string | null>(null);
021309| NOTE: Initializes local state for search UI behavior.
021310| src/contexts/ListingFocusContext.tsx:79:   const [activeId, setActiveId] = useState<string | null>(null);
021311| NOTE: Initializes local state for search UI behavior.
021312| src/contexts/ListingFocusContext.tsx:80:   const [scrollRequest, setScrollRequest] = useState<ScrollRequest | null>(
021313| NOTE: Initializes local state for search UI behavior.
021314| src/contexts/ListingFocusContext.tsx:81:     null,
021315| NOTE: Implementation detail supporting search page behavior.
021316| src/contexts/ListingFocusContext.tsx:82:   );
021317| NOTE: Implementation detail supporting search page behavior.
021318| src/contexts/ListingFocusContext.tsx:83: 
021319| NOTE: Blank line for visual separation.
021320| src/contexts/ListingFocusContext.tsx:84:   // Nonce counter for scroll requests - allows triggering scroll to same listing twice
021321| NOTE: Line comment documents intent or constraints.
021322| src/contexts/ListingFocusContext.tsx:85:   const nonceRef = useRef(0);
021323| NOTE: Uses ref for stable mutable storage between renders.
021324| src/contexts/ListingFocusContext.tsx:86: 
021325| NOTE: Blank line for visual separation.
021326| src/contexts/ListingFocusContext.tsx:87:   const setHovered = useCallback((id: string | null) => {
021327| NOTE: Memoizes callback to preserve references across renders.
021328| src/contexts/ListingFocusContext.tsx:88:     setHoveredId(id);
021329| NOTE: Implementation detail supporting search page behavior.
021330| src/contexts/ListingFocusContext.tsx:89:   }, []);
021331| NOTE: Implementation detail supporting search page behavior.
021332| src/contexts/ListingFocusContext.tsx:90: 
021333| NOTE: Blank line for visual separation.
021334| src/contexts/ListingFocusContext.tsx:91:   const setActive = useCallback((id: string | null) => {
021335| NOTE: Memoizes callback to preserve references across renders.
021336| src/contexts/ListingFocusContext.tsx:92:     setActiveId(id);
021337| NOTE: Implementation detail supporting search page behavior.
021338| src/contexts/ListingFocusContext.tsx:93:   }, []);
021339| NOTE: Implementation detail supporting search page behavior.
021340| src/contexts/ListingFocusContext.tsx:94: 
021341| NOTE: Blank line for visual separation.
021342| src/contexts/ListingFocusContext.tsx:95:   const requestScrollTo = useCallback((id: string) => {
021343| NOTE: Memoizes callback to preserve references across renders.
021344| src/contexts/ListingFocusContext.tsx:96:     nonceRef.current += 1;
021345| NOTE: Implementation detail supporting search page behavior.
021346| src/contexts/ListingFocusContext.tsx:97:     setScrollRequest({ id, nonce: nonceRef.current });
021347| NOTE: Implementation detail supporting search page behavior.
021348| src/contexts/ListingFocusContext.tsx:98:   }, []);
021349| NOTE: Implementation detail supporting search page behavior.
021350| src/contexts/ListingFocusContext.tsx:99: 
021351| NOTE: Blank line for visual separation.
021352| src/contexts/ListingFocusContext.tsx:100:   const ackScrollTo = useCallback((nonce: number) => {
021353| NOTE: Memoizes callback to preserve references across renders.
021354| src/contexts/ListingFocusContext.tsx:101:     setScrollRequest((current) => {
021355| NOTE: Implementation detail supporting search page behavior.
021356| src/contexts/ListingFocusContext.tsx:102:       if (current?.nonce === nonce) {
021357| NOTE: Conditional logic controlling rendering or flow.
021358| src/contexts/ListingFocusContext.tsx:103:         return null;
021359| NOTE: Return statement for component or helper output.
021360| src/contexts/ListingFocusContext.tsx:104:       }
021361| NOTE: Implementation detail supporting search page behavior.
021362| src/contexts/ListingFocusContext.tsx:105:       return current;
021363| NOTE: Return statement for component or helper output.
021364| src/contexts/ListingFocusContext.tsx:106:     });
021365| NOTE: Implementation detail supporting search page behavior.
021366| src/contexts/ListingFocusContext.tsx:107:   }, []);
021367| NOTE: Implementation detail supporting search page behavior.
021368| src/contexts/ListingFocusContext.tsx:108: 
021369| NOTE: Blank line for visual separation.
021370| src/contexts/ListingFocusContext.tsx:109:   const clearFocus = useCallback(() => {
021371| NOTE: Memoizes callback to preserve references across renders.
021372| src/contexts/ListingFocusContext.tsx:110:     setHoveredId(null);
021373| NOTE: Implementation detail supporting search page behavior.
021374| src/contexts/ListingFocusContext.tsx:111:     setActiveId(null);
021375| NOTE: Implementation detail supporting search page behavior.
021376| src/contexts/ListingFocusContext.tsx:112:     setScrollRequest(null);
021377| NOTE: Implementation detail supporting search page behavior.
021378| src/contexts/ListingFocusContext.tsx:113:   }, []);
021379| NOTE: Implementation detail supporting search page behavior.
021380| src/contexts/ListingFocusContext.tsx:114: 
021381| NOTE: Blank line for visual separation.
021382| src/contexts/ListingFocusContext.tsx:115:   const contextValue = useMemo(
021383| NOTE: Memoizes derived values to reduce re-render work.
021384| src/contexts/ListingFocusContext.tsx:116:     () => ({
021385| NOTE: Implementation detail supporting search page behavior.
021386| src/contexts/ListingFocusContext.tsx:117:       hoveredId,
021387| NOTE: Implementation detail supporting search page behavior.
021388| src/contexts/ListingFocusContext.tsx:118:       activeId,
021389| NOTE: Implementation detail supporting search page behavior.
021390| src/contexts/ListingFocusContext.tsx:119:       scrollRequest,
021391| NOTE: Implementation detail supporting search page behavior.
021392| src/contexts/ListingFocusContext.tsx:120:       setHovered,
021393| NOTE: Implementation detail supporting search page behavior.
021394| src/contexts/ListingFocusContext.tsx:121:       setActive,
021395| NOTE: Implementation detail supporting search page behavior.
021396| src/contexts/ListingFocusContext.tsx:122:       requestScrollTo,
021397| NOTE: Implementation detail supporting search page behavior.
021398| src/contexts/ListingFocusContext.tsx:123:       ackScrollTo,
021399| NOTE: Implementation detail supporting search page behavior.
021400| src/contexts/ListingFocusContext.tsx:124:       clearFocus,
021401| NOTE: Implementation detail supporting search page behavior.
021402| src/contexts/ListingFocusContext.tsx:125:     }),
021403| NOTE: Implementation detail supporting search page behavior.
021404| src/contexts/ListingFocusContext.tsx:126:     [
021405| NOTE: Implementation detail supporting search page behavior.
021406| src/contexts/ListingFocusContext.tsx:127:       hoveredId,
021407| NOTE: Implementation detail supporting search page behavior.
021408| src/contexts/ListingFocusContext.tsx:128:       activeId,
021409| NOTE: Implementation detail supporting search page behavior.
021410| src/contexts/ListingFocusContext.tsx:129:       scrollRequest,
021411| NOTE: Implementation detail supporting search page behavior.
021412| src/contexts/ListingFocusContext.tsx:130:       setHovered,
021413| NOTE: Implementation detail supporting search page behavior.
021414| src/contexts/ListingFocusContext.tsx:131:       setActive,
021415| NOTE: Implementation detail supporting search page behavior.
021416| src/contexts/ListingFocusContext.tsx:132:       requestScrollTo,
021417| NOTE: Implementation detail supporting search page behavior.
021418| src/contexts/ListingFocusContext.tsx:133:       ackScrollTo,
021419| NOTE: Implementation detail supporting search page behavior.
021420| src/contexts/ListingFocusContext.tsx:134:       clearFocus,
021421| NOTE: Implementation detail supporting search page behavior.
021422| src/contexts/ListingFocusContext.tsx:135:     ],
021423| NOTE: Implementation detail supporting search page behavior.
021424| src/contexts/ListingFocusContext.tsx:136:   );
021425| NOTE: Implementation detail supporting search page behavior.
021426| src/contexts/ListingFocusContext.tsx:137: 
021427| NOTE: Blank line for visual separation.
021428| src/contexts/ListingFocusContext.tsx:138:   return (
021429| NOTE: Return statement for component or helper output.
021430| src/contexts/ListingFocusContext.tsx:139:     <ListingFocusContext.Provider value={contextValue}>
021431| NOTE: JSX markup for search UI.
021432| src/contexts/ListingFocusContext.tsx:140:       {children}
021433| NOTE: Implementation detail supporting search page behavior.
021434| src/contexts/ListingFocusContext.tsx:141:     </ListingFocusContext.Provider>
021435| NOTE: JSX markup for search UI.
021436| src/contexts/ListingFocusContext.tsx:142:   );
021437| NOTE: Implementation detail supporting search page behavior.
021438| src/contexts/ListingFocusContext.tsx:143: }
021439| NOTE: Implementation detail supporting search page behavior.
021440| src/contexts/ListingFocusContext.tsx:144: 
021441| NOTE: Blank line for visual separation.
021442| src/contexts/ListingFocusContext.tsx:145: /**
021443| NOTE: Block comment line describing behavior or context.
021444| src/contexts/ListingFocusContext.tsx:146:  * Hook for components that need listing focus state
021445| NOTE: Block comment line describing behavior or context.
021446| src/contexts/ListingFocusContext.tsx:147:  * Returns stable SSR_FALLBACK when used outside provider (SSR)
021447| NOTE: Block comment line describing behavior or context.
021448| src/contexts/ListingFocusContext.tsx:148:  */
021449| NOTE: Block comment line describing behavior or context.
021450| src/contexts/ListingFocusContext.tsx:149: export function useListingFocus() {
021451| NOTE: Exports helper or component function.
021452| src/contexts/ListingFocusContext.tsx:150:   const context = useContext(ListingFocusContext);
021453| NOTE: Local declaration used by search logic or UI.
021454| src/contexts/ListingFocusContext.tsx:151:   return context ?? SSR_FALLBACK;
021455| NOTE: Return statement for component or helper output.
021456| src/contexts/ListingFocusContext.tsx:152: }
021457| NOTE: Implementation detail supporting search page behavior.
021458| src/contexts/ListingFocusContext.tsx:153: 
021459| NOTE: Blank line for visual separation.
021460| src/contexts/ListingFocusContext.tsx:154: /**
021461| NOTE: Block comment line describing behavior or context.
021462| src/contexts/ListingFocusContext.tsx:155:  * Hook for checking if a specific listing is focused
021463| NOTE: Block comment line describing behavior or context.
021464| src/contexts/ListingFocusContext.tsx:156:  * Memoized to prevent unnecessary re-renders in list items
021465| NOTE: Block comment line describing behavior or context.
021466| src/contexts/ListingFocusContext.tsx:157:  */
021467| NOTE: Block comment line describing behavior or context.
021468| src/contexts/ListingFocusContext.tsx:158: export function useIsListingFocused(listingId: string) {
021469| NOTE: Exports helper or component function.
021470| src/contexts/ListingFocusContext.tsx:159:   const { hoveredId, activeId } = useListingFocus();
021471| NOTE: Local declaration used by search logic or UI.
021472| src/contexts/ListingFocusContext.tsx:160:   return useMemo(
021473| NOTE: Memoizes derived values to reduce re-render work.
021474| src/contexts/ListingFocusContext.tsx:161:     () => ({
021475| NOTE: Implementation detail supporting search page behavior.
021476| src/contexts/ListingFocusContext.tsx:162:       isHovered: hoveredId === listingId,
021477| NOTE: Implementation detail supporting search page behavior.
021478| src/contexts/ListingFocusContext.tsx:163:       isActive: activeId === listingId,
021479| NOTE: Implementation detail supporting search page behavior.
021480| src/contexts/ListingFocusContext.tsx:164:       isFocused: hoveredId === listingId || activeId === listingId,
021481| NOTE: Implementation detail supporting search page behavior.
021482| src/contexts/ListingFocusContext.tsx:165:     }),
021483| NOTE: Implementation detail supporting search page behavior.
021484| src/contexts/ListingFocusContext.tsx:166:     [hoveredId, activeId, listingId],
021485| NOTE: Implementation detail supporting search page behavior.
021486| src/contexts/ListingFocusContext.tsx:167:   );
021487| NOTE: Implementation detail supporting search page behavior.
021488| src/contexts/ListingFocusContext.tsx:168: }
021489| NOTE: Implementation detail supporting search page behavior.
021490| FILE END: src/contexts/ListingFocusContext.tsx
021491| 
021492| FILE START: src/contexts/MapBoundsContext.tsx
021493| FILE ROLE: Auto-discovered dependency in search page graph.
021494| src/contexts/MapBoundsContext.tsx:1: "use client";
021495| NOTE: Implementation detail supporting search page behavior.
021496| src/contexts/MapBoundsContext.tsx:2: 
021497| NOTE: Blank line for visual separation.
021498| src/contexts/MapBoundsContext.tsx:3: /**
021499| NOTE: Block comment line describing behavior or context.
021500| src/contexts/MapBoundsContext.tsx:4:  * MapBoundsContext - Shared state for map bounds dirty tracking
021501| NOTE: Block comment line describing behavior or context.
021502| src/contexts/MapBoundsContext.tsx:5:  *
021503| NOTE: Block comment line describing behavior or context.
021504| src/contexts/MapBoundsContext.tsx:6:  * This context enables the "Map moved - results not updated" banner to show
021505| NOTE: Block comment line describing behavior or context.
021506| src/contexts/MapBoundsContext.tsx:7:  * in BOTH locations:
021507| NOTE: Block comment line describing behavior or context.
021508| src/contexts/MapBoundsContext.tsx:8:  * 1. On the map itself (floating overlay)
021509| NOTE: Block comment line describing behavior or context.
021510| src/contexts/MapBoundsContext.tsx:9:  * 2. Above the list results (inline banner)
021511| NOTE: Block comment line describing behavior or context.
021512| src/contexts/MapBoundsContext.tsx:10:  *
021513| NOTE: Block comment line describing behavior or context.
021514| src/contexts/MapBoundsContext.tsx:11:  * The Map component is the source of truth for:
021515| NOTE: Block comment line describing behavior or context.
021516| src/contexts/MapBoundsContext.tsx:12:  * - hasUserMoved: Whether user has manually panned/zoomed
021517| NOTE: Block comment line describing behavior or context.
021518| src/contexts/MapBoundsContext.tsx:13:  * - boundsDirty: Whether current map bounds differ from URL bounds
021519| NOTE: Block comment line describing behavior or context.
021520| src/contexts/MapBoundsContext.tsx:14:  * - searchAsMove: Whether auto-search on move is enabled
021521| NOTE: Block comment line describing behavior or context.
021522| src/contexts/MapBoundsContext.tsx:15:  * - locationConflict: Whether map has been panned away from search location
021523| NOTE: Block comment line describing behavior or context.
021524| src/contexts/MapBoundsContext.tsx:16:  *
021525| NOTE: Block comment line describing behavior or context.
021526| src/contexts/MapBoundsContext.tsx:17:  * SearchLayoutView consumes this to show the list banner.
021527| NOTE: Block comment line describing behavior or context.
021528| src/contexts/MapBoundsContext.tsx:18:  */
021529| NOTE: Block comment line describing behavior or context.
021530| src/contexts/MapBoundsContext.tsx:19: 
021531| NOTE: Blank line for visual separation.
021532| src/contexts/MapBoundsContext.tsx:20: import {
021533| NOTE: Imports dependency for this module.
021534| src/contexts/MapBoundsContext.tsx:21:   createContext,
021535| NOTE: Implementation detail supporting search page behavior.
021536| src/contexts/MapBoundsContext.tsx:22:   useContext,
021537| NOTE: Implementation detail supporting search page behavior.
021538| src/contexts/MapBoundsContext.tsx:23:   useState,
021539| NOTE: Initializes local state for search UI behavior.
021540| src/contexts/MapBoundsContext.tsx:24:   useCallback,
021541| NOTE: Memoizes callback to preserve references across renders.
021542| src/contexts/MapBoundsContext.tsx:25:   useMemo,
021543| NOTE: Memoizes derived values to reduce re-render work.
021544| src/contexts/MapBoundsContext.tsx:26: } from "react";
021545| NOTE: Implementation detail supporting search page behavior.
021546| src/contexts/MapBoundsContext.tsx:27: 
021547| NOTE: Blank line for visual separation.
021548| src/contexts/MapBoundsContext.tsx:28: /** Coordinates for map bounds */
021549| NOTE: Block comment line describing behavior or context.
021550| src/contexts/MapBoundsContext.tsx:29: export interface MapBoundsCoords {
021551| NOTE: Implementation detail supporting search page behavior.
021552| src/contexts/MapBoundsContext.tsx:30:   minLng: number;
021553| NOTE: Implementation detail supporting search page behavior.
021554| src/contexts/MapBoundsContext.tsx:31:   maxLng: number;
021555| NOTE: Implementation detail supporting search page behavior.
021556| src/contexts/MapBoundsContext.tsx:32:   minLat: number;
021557| NOTE: Implementation detail supporting search page behavior.
021558| src/contexts/MapBoundsContext.tsx:33:   maxLat: number;
021559| NOTE: Implementation detail supporting search page behavior.
021560| src/contexts/MapBoundsContext.tsx:34: }
021561| NOTE: Implementation detail supporting search page behavior.
021562| src/contexts/MapBoundsContext.tsx:35: 
021563| NOTE: Blank line for visual separation.
021564| src/contexts/MapBoundsContext.tsx:36: /** Coordinates for a point */
021565| NOTE: Block comment line describing behavior or context.
021566| src/contexts/MapBoundsContext.tsx:37: export interface PointCoords {
021567| NOTE: Implementation detail supporting search page behavior.
021568| src/contexts/MapBoundsContext.tsx:38:   lat: number;
021569| NOTE: Implementation detail supporting search page behavior.
021570| src/contexts/MapBoundsContext.tsx:39:   lng: number;
021571| NOTE: Implementation detail supporting search page behavior.
021572| src/contexts/MapBoundsContext.tsx:40: }
021573| NOTE: Implementation detail supporting search page behavior.
021574| src/contexts/MapBoundsContext.tsx:41: 
021575| NOTE: Blank line for visual separation.
021576| src/contexts/MapBoundsContext.tsx:42: interface MapBoundsState {
021577| NOTE: Type declaration for search data contracts.
021578| src/contexts/MapBoundsContext.tsx:43:   /** Whether user has manually moved the map (not programmatic flyTo) */
021579| NOTE: Block comment line describing behavior or context.
021580| src/contexts/MapBoundsContext.tsx:44:   hasUserMoved: boolean;
021581| NOTE: Implementation detail supporting search page behavior.
021582| src/contexts/MapBoundsContext.tsx:45:   /** Whether map bounds differ from URL bounds (results stale) */
021583| NOTE: Block comment line describing behavior or context.
021584| src/contexts/MapBoundsContext.tsx:46:   boundsDirty: boolean;
021585| NOTE: Implementation detail supporting search page behavior.
021586| src/contexts/MapBoundsContext.tsx:47:   /** Whether "search as I move" toggle is ON */
021587| NOTE: Block comment line describing behavior or context.
021588| src/contexts/MapBoundsContext.tsx:48:   searchAsMove: boolean;
021589| NOTE: Implementation detail supporting search page behavior.
021590| src/contexts/MapBoundsContext.tsx:49:   /** Original search location name (from q param) */
021591| NOTE: Block comment line describing behavior or context.
021592| src/contexts/MapBoundsContext.tsx:50:   searchLocationName: string | null;
021593| NOTE: Implementation detail supporting search page behavior.
021594| src/contexts/MapBoundsContext.tsx:51:   /** Original search location center coordinates */
021595| NOTE: Block comment line describing behavior or context.
021596| src/contexts/MapBoundsContext.tsx:52:   searchLocationCenter: PointCoords | null;
021597| NOTE: Implementation detail supporting search page behavior.
021598| src/contexts/MapBoundsContext.tsx:53:   /** Whether map viewport no longer contains the search location */
021599| NOTE: Block comment line describing behavior or context.
021600| src/contexts/MapBoundsContext.tsx:54:   locationConflict: boolean;
021601| NOTE: Implementation detail supporting search page behavior.
021602| src/contexts/MapBoundsContext.tsx:55:   /** Trigger search with current map bounds */
021603| NOTE: Block comment line describing behavior or context.
021604| src/contexts/MapBoundsContext.tsx:56:   searchCurrentArea: () => void;
021605| NOTE: Implementation detail supporting search page behavior.
021606| src/contexts/MapBoundsContext.tsx:57:   /** Reset map view to URL bounds */
021607| NOTE: Block comment line describing behavior or context.
021608| src/contexts/MapBoundsContext.tsx:58:   resetToUrlBounds: () => void;
021609| NOTE: Implementation detail supporting search page behavior.
021610| src/contexts/MapBoundsContext.tsx:59: }
021611| NOTE: Implementation detail supporting search page behavior.
021612| src/contexts/MapBoundsContext.tsx:60: 
021613| NOTE: Blank line for visual separation.
021614| src/contexts/MapBoundsContext.tsx:61: interface MapBoundsContextValue extends MapBoundsState {
021615| NOTE: Type declaration for search data contracts.
021616| src/contexts/MapBoundsContext.tsx:62:   /** Update hasUserMoved (called by Map) */
021617| NOTE: Block comment line describing behavior or context.
021618| src/contexts/MapBoundsContext.tsx:63:   setHasUserMoved: (value: boolean) => void;
021619| NOTE: Implementation detail supporting search page behavior.
021620| src/contexts/MapBoundsContext.tsx:64:   /** Update boundsDirty (called by Map) */
021621| NOTE: Block comment line describing behavior or context.
021622| src/contexts/MapBoundsContext.tsx:65:   setBoundsDirty: (value: boolean) => void;
021623| NOTE: Implementation detail supporting search page behavior.
021624| src/contexts/MapBoundsContext.tsx:66:   /** Update searchAsMove (called by Map) */
021625| NOTE: Block comment line describing behavior or context.
021626| src/contexts/MapBoundsContext.tsx:67:   setSearchAsMove: (value: boolean) => void;
021627| NOTE: Implementation detail supporting search page behavior.
021628| src/contexts/MapBoundsContext.tsx:68:   /** Update search location info (called when URL changes) */
021629| NOTE: Block comment line describing behavior or context.
021630| src/contexts/MapBoundsContext.tsx:69:   setSearchLocation: (name: string | null, center: PointCoords | null) => void;
021631| NOTE: Implementation detail supporting search page behavior.
021632| src/contexts/MapBoundsContext.tsx:70:   /** Update current map bounds (called by Map on moveend) */
021633| NOTE: Block comment line describing behavior or context.
021634| src/contexts/MapBoundsContext.tsx:71:   setCurrentMapBounds: (bounds: MapBoundsCoords | null) => void;
021635| NOTE: Implementation detail supporting search page behavior.
021636| src/contexts/MapBoundsContext.tsx:72:   /** Register search handler (called by Map) */
021637| NOTE: Block comment line describing behavior or context.
021638| src/contexts/MapBoundsContext.tsx:73:   setSearchHandler: (handler: () => void) => void;
021639| NOTE: Implementation detail supporting search page behavior.
021640| src/contexts/MapBoundsContext.tsx:74:   /** Register reset handler (called by Map) */
021641| NOTE: Block comment line describing behavior or context.
021642| src/contexts/MapBoundsContext.tsx:75:   setResetHandler: (handler: () => void) => void;
021643| NOTE: Implementation detail supporting search page behavior.
021644| src/contexts/MapBoundsContext.tsx:76: }
021645| NOTE: Implementation detail supporting search page behavior.
021646| src/contexts/MapBoundsContext.tsx:77: 
021647| NOTE: Blank line for visual separation.
021648| src/contexts/MapBoundsContext.tsx:78: const MapBoundsContext = createContext<MapBoundsContextValue | null>(null);
021649| NOTE: Local declaration used by search logic or UI.
021650| src/contexts/MapBoundsContext.tsx:79: 
021651| NOTE: Blank line for visual separation.
021652| src/contexts/MapBoundsContext.tsx:80: /**
021653| NOTE: Block comment line describing behavior or context.
021654| src/contexts/MapBoundsContext.tsx:81:  * Check if a point is within map bounds (with small padding for edge cases)
021655| NOTE: Block comment line describing behavior or context.
021656| src/contexts/MapBoundsContext.tsx:82:  */
021657| NOTE: Block comment line describing behavior or context.
021658| src/contexts/MapBoundsContext.tsx:83: function isPointInBounds(point: PointCoords, bounds: MapBoundsCoords): boolean {
021659| NOTE: Defines a helper or component function.
021660| src/contexts/MapBoundsContext.tsx:84:   return (
021661| NOTE: Return statement for component or helper output.
021662| src/contexts/MapBoundsContext.tsx:85:     point.lat >= bounds.minLat &&
021663| NOTE: Implementation detail supporting search page behavior.
021664| src/contexts/MapBoundsContext.tsx:86:     point.lat <= bounds.maxLat &&
021665| NOTE: Implementation detail supporting search page behavior.
021666| src/contexts/MapBoundsContext.tsx:87:     point.lng >= bounds.minLng &&
021667| NOTE: Implementation detail supporting search page behavior.
021668| src/contexts/MapBoundsContext.tsx:88:     point.lng <= bounds.maxLng
021669| NOTE: Implementation detail supporting search page behavior.
021670| src/contexts/MapBoundsContext.tsx:89:   );
021671| NOTE: Implementation detail supporting search page behavior.
021672| src/contexts/MapBoundsContext.tsx:90: }
021673| NOTE: Implementation detail supporting search page behavior.
021674| src/contexts/MapBoundsContext.tsx:91: 
021675| NOTE: Blank line for visual separation.
021676| src/contexts/MapBoundsContext.tsx:92: export function MapBoundsProvider({ children }: { children: React.ReactNode }) {
021677| NOTE: Exports helper or component function.
021678| src/contexts/MapBoundsContext.tsx:93:   const [hasUserMoved, setHasUserMoved] = useState(false);
021679| NOTE: Initializes local state for search UI behavior.
021680| src/contexts/MapBoundsContext.tsx:94:   const [boundsDirty, setBoundsDirty] = useState(false);
021681| NOTE: Initializes local state for search UI behavior.
021682| src/contexts/MapBoundsContext.tsx:95:   const [searchAsMove, setSearchAsMove] = useState(false);
021683| NOTE: Initializes local state for search UI behavior.
021684| src/contexts/MapBoundsContext.tsx:96:   const [searchLocationName, setSearchLocationName] = useState<string | null>(
021685| NOTE: Initializes local state for search UI behavior.
021686| src/contexts/MapBoundsContext.tsx:97:     null,
021687| NOTE: Implementation detail supporting search page behavior.
021688| src/contexts/MapBoundsContext.tsx:98:   );
021689| NOTE: Implementation detail supporting search page behavior.
021690| src/contexts/MapBoundsContext.tsx:99:   const [searchLocationCenter, setSearchLocationCenter] =
021691| NOTE: Local declaration used by search logic or UI.
021692| src/contexts/MapBoundsContext.tsx:100:     useState<PointCoords | null>(null);
021693| NOTE: Initializes local state for search UI behavior.
021694| src/contexts/MapBoundsContext.tsx:101:   const [currentMapBounds, setCurrentMapBoundsState] =
021695| NOTE: Local declaration used by search logic or UI.
021696| src/contexts/MapBoundsContext.tsx:102:     useState<MapBoundsCoords | null>(null);
021697| NOTE: Initializes local state for search UI behavior.
021698| src/contexts/MapBoundsContext.tsx:103:   const [searchHandler, setSearchHandlerState] = useState<(() => void) | null>(
021699| NOTE: Initializes local state for search UI behavior.
021700| src/contexts/MapBoundsContext.tsx:104:     null,
021701| NOTE: Implementation detail supporting search page behavior.
021702| src/contexts/MapBoundsContext.tsx:105:   );
021703| NOTE: Implementation detail supporting search page behavior.
021704| src/contexts/MapBoundsContext.tsx:106:   const [resetHandler, setResetHandlerState] = useState<(() => void) | null>(
021705| NOTE: Initializes local state for search UI behavior.
021706| src/contexts/MapBoundsContext.tsx:107:     null,
021707| NOTE: Implementation detail supporting search page behavior.
021708| src/contexts/MapBoundsContext.tsx:108:   );
021709| NOTE: Implementation detail supporting search page behavior.
021710| src/contexts/MapBoundsContext.tsx:109: 
021711| NOTE: Blank line for visual separation.
021712| src/contexts/MapBoundsContext.tsx:110:   const setSearchHandler = useCallback((handler: () => void) => {
021713| NOTE: Memoizes callback to preserve references across renders.
021714| src/contexts/MapBoundsContext.tsx:111:     setSearchHandlerState(() => handler);
021715| NOTE: Implementation detail supporting search page behavior.
021716| src/contexts/MapBoundsContext.tsx:112:   }, []);
021717| NOTE: Implementation detail supporting search page behavior.
021718| src/contexts/MapBoundsContext.tsx:113: 
021719| NOTE: Blank line for visual separation.
021720| src/contexts/MapBoundsContext.tsx:114:   const setResetHandler = useCallback((handler: () => void) => {
021721| NOTE: Memoizes callback to preserve references across renders.
021722| src/contexts/MapBoundsContext.tsx:115:     setResetHandlerState(() => handler);
021723| NOTE: Implementation detail supporting search page behavior.
021724| src/contexts/MapBoundsContext.tsx:116:   }, []);
021725| NOTE: Implementation detail supporting search page behavior.
021726| src/contexts/MapBoundsContext.tsx:117: 
021727| NOTE: Blank line for visual separation.
021728| src/contexts/MapBoundsContext.tsx:118:   const searchCurrentArea = useCallback(() => {
021729| NOTE: Memoizes callback to preserve references across renders.
021730| src/contexts/MapBoundsContext.tsx:119:     searchHandler?.();
021731| NOTE: Implementation detail supporting search page behavior.
021732| src/contexts/MapBoundsContext.tsx:120:   }, [searchHandler]);
021733| NOTE: Implementation detail supporting search page behavior.
021734| src/contexts/MapBoundsContext.tsx:121: 
021735| NOTE: Blank line for visual separation.
021736| src/contexts/MapBoundsContext.tsx:122:   const resetToUrlBounds = useCallback(() => {
021737| NOTE: Memoizes callback to preserve references across renders.
021738| src/contexts/MapBoundsContext.tsx:123:     resetHandler?.();
021739| NOTE: Implementation detail supporting search page behavior.
021740| src/contexts/MapBoundsContext.tsx:124:   }, [resetHandler]);
021741| NOTE: Implementation detail supporting search page behavior.
021742| src/contexts/MapBoundsContext.tsx:125: 
021743| NOTE: Blank line for visual separation.
021744| src/contexts/MapBoundsContext.tsx:126:   const setSearchLocation = useCallback(
021745| NOTE: Memoizes callback to preserve references across renders.
021746| src/contexts/MapBoundsContext.tsx:127:     (name: string | null, center: PointCoords | null) => {
021747| NOTE: Implementation detail supporting search page behavior.
021748| src/contexts/MapBoundsContext.tsx:128:       setSearchLocationName(name);
021749| NOTE: Implementation detail supporting search page behavior.
021750| src/contexts/MapBoundsContext.tsx:129:       setSearchLocationCenter(center);
021751| NOTE: Implementation detail supporting search page behavior.
021752| src/contexts/MapBoundsContext.tsx:130:     },
021753| NOTE: Implementation detail supporting search page behavior.
021754| src/contexts/MapBoundsContext.tsx:131:     [],
021755| NOTE: Implementation detail supporting search page behavior.
021756| src/contexts/MapBoundsContext.tsx:132:   );
021757| NOTE: Implementation detail supporting search page behavior.
021758| src/contexts/MapBoundsContext.tsx:133: 
021759| NOTE: Blank line for visual separation.
021760| src/contexts/MapBoundsContext.tsx:134:   const setCurrentMapBounds = useCallback((bounds: MapBoundsCoords | null) => {
021761| NOTE: Memoizes callback to preserve references across renders.
021762| src/contexts/MapBoundsContext.tsx:135:     setCurrentMapBoundsState(bounds);
021763| NOTE: Implementation detail supporting search page behavior.
021764| src/contexts/MapBoundsContext.tsx:136:   }, []);
021765| NOTE: Implementation detail supporting search page behavior.
021766| src/contexts/MapBoundsContext.tsx:137: 
021767| NOTE: Blank line for visual separation.
021768| src/contexts/MapBoundsContext.tsx:138:   // Compute whether there's a location conflict
021769| NOTE: Line comment documents intent or constraints.
021770| src/contexts/MapBoundsContext.tsx:139:   // (map panned away from search location center)
021771| NOTE: Line comment documents intent or constraints.
021772| src/contexts/MapBoundsContext.tsx:140:   const locationConflict = useMemo(() => {
021773| NOTE: Memoizes derived values to reduce re-render work.
021774| src/contexts/MapBoundsContext.tsx:141:     // No conflict if no search location or no current bounds
021775| NOTE: Line comment documents intent or constraints.
021776| src/contexts/MapBoundsContext.tsx:142:     if (!searchLocationCenter || !currentMapBounds) return false;
021777| NOTE: Conditional logic controlling rendering or flow.
021778| src/contexts/MapBoundsContext.tsx:143:     // No conflict if user hasn't manually moved the map
021779| NOTE: Line comment documents intent or constraints.
021780| src/contexts/MapBoundsContext.tsx:144:     if (!hasUserMoved) return false;
021781| NOTE: Conditional logic controlling rendering or flow.
021782| src/contexts/MapBoundsContext.tsx:145:     // Conflict if search center is outside current map viewport
021783| NOTE: Line comment documents intent or constraints.
021784| src/contexts/MapBoundsContext.tsx:146:     return !isPointInBounds(searchLocationCenter, currentMapBounds);
021785| NOTE: Return statement for component or helper output.
021786| src/contexts/MapBoundsContext.tsx:147:   }, [searchLocationCenter, currentMapBounds, hasUserMoved]);
021787| NOTE: Implementation detail supporting search page behavior.
021788| src/contexts/MapBoundsContext.tsx:148: 
021789| NOTE: Blank line for visual separation.
021790| src/contexts/MapBoundsContext.tsx:149:   // Memoize context value to prevent unnecessary re-renders
021791| NOTE: Line comment documents intent or constraints.
021792| src/contexts/MapBoundsContext.tsx:150:   // Without this, every state change creates a new object reference,
021793| NOTE: Line comment documents intent or constraints.
021794| src/contexts/MapBoundsContext.tsx:151:   // causing all consumers to re-render even if their specific values haven't changed
021795| NOTE: Line comment documents intent or constraints.
021796| src/contexts/MapBoundsContext.tsx:152:   const contextValue = useMemo(
021797| NOTE: Memoizes derived values to reduce re-render work.
021798| src/contexts/MapBoundsContext.tsx:153:     () => ({
021799| NOTE: Implementation detail supporting search page behavior.
021800| src/contexts/MapBoundsContext.tsx:154:       hasUserMoved,
021801| NOTE: Implementation detail supporting search page behavior.
021802| src/contexts/MapBoundsContext.tsx:155:       boundsDirty,
021803| NOTE: Implementation detail supporting search page behavior.
021804| src/contexts/MapBoundsContext.tsx:156:       searchAsMove,
021805| NOTE: Implementation detail supporting search page behavior.
021806| src/contexts/MapBoundsContext.tsx:157:       searchLocationName,
021807| NOTE: Implementation detail supporting search page behavior.
021808| src/contexts/MapBoundsContext.tsx:158:       searchLocationCenter,
021809| NOTE: Implementation detail supporting search page behavior.
021810| src/contexts/MapBoundsContext.tsx:159:       locationConflict,
021811| NOTE: Implementation detail supporting search page behavior.
021812| src/contexts/MapBoundsContext.tsx:160:       searchCurrentArea,
021813| NOTE: Implementation detail supporting search page behavior.
021814| src/contexts/MapBoundsContext.tsx:161:       resetToUrlBounds,
021815| NOTE: Implementation detail supporting search page behavior.
021816| src/contexts/MapBoundsContext.tsx:162:       setHasUserMoved,
021817| NOTE: Implementation detail supporting search page behavior.
021818| src/contexts/MapBoundsContext.tsx:163:       setBoundsDirty,
021819| NOTE: Implementation detail supporting search page behavior.
021820| src/contexts/MapBoundsContext.tsx:164:       setSearchAsMove,
021821| NOTE: Implementation detail supporting search page behavior.
021822| src/contexts/MapBoundsContext.tsx:165:       setSearchLocation,
021823| NOTE: Implementation detail supporting search page behavior.
021824| src/contexts/MapBoundsContext.tsx:166:       setCurrentMapBounds,
021825| NOTE: Implementation detail supporting search page behavior.
021826| src/contexts/MapBoundsContext.tsx:167:       setSearchHandler,
021827| NOTE: Implementation detail supporting search page behavior.
021828| src/contexts/MapBoundsContext.tsx:168:       setResetHandler,
021829| NOTE: Implementation detail supporting search page behavior.
021830| src/contexts/MapBoundsContext.tsx:169:     }),
021831| NOTE: Implementation detail supporting search page behavior.
021832| src/contexts/MapBoundsContext.tsx:170:     [
021833| NOTE: Implementation detail supporting search page behavior.
021834| src/contexts/MapBoundsContext.tsx:171:       hasUserMoved,
021835| NOTE: Implementation detail supporting search page behavior.
021836| src/contexts/MapBoundsContext.tsx:172:       boundsDirty,
021837| NOTE: Implementation detail supporting search page behavior.
021838| src/contexts/MapBoundsContext.tsx:173:       searchAsMove,
021839| NOTE: Implementation detail supporting search page behavior.
021840| src/contexts/MapBoundsContext.tsx:174:       searchLocationName,
021841| NOTE: Implementation detail supporting search page behavior.
021842| src/contexts/MapBoundsContext.tsx:175:       searchLocationCenter,
021843| NOTE: Implementation detail supporting search page behavior.
021844| src/contexts/MapBoundsContext.tsx:176:       locationConflict,
021845| NOTE: Implementation detail supporting search page behavior.
021846| src/contexts/MapBoundsContext.tsx:177:       searchCurrentArea,
021847| NOTE: Implementation detail supporting search page behavior.
021848| src/contexts/MapBoundsContext.tsx:178:       resetToUrlBounds,
021849| NOTE: Implementation detail supporting search page behavior.
021850| src/contexts/MapBoundsContext.tsx:179:       setSearchLocation,
021851| NOTE: Implementation detail supporting search page behavior.
021852| src/contexts/MapBoundsContext.tsx:180:       setCurrentMapBounds,
021853| NOTE: Implementation detail supporting search page behavior.
021854| src/contexts/MapBoundsContext.tsx:181:       // Note: setters from useState are stable, setSearchHandler/setResetHandler
021855| NOTE: Line comment documents intent or constraints.
021856| src/contexts/MapBoundsContext.tsx:182:       // have empty deps, so they don't need to be in the dependency array
021857| NOTE: Line comment documents intent or constraints.
021858| src/contexts/MapBoundsContext.tsx:183:     ],
021859| NOTE: Implementation detail supporting search page behavior.
021860| src/contexts/MapBoundsContext.tsx:184:   );
021861| NOTE: Implementation detail supporting search page behavior.
021862| src/contexts/MapBoundsContext.tsx:185: 
021863| NOTE: Blank line for visual separation.
021864| src/contexts/MapBoundsContext.tsx:186:   return (
021865| NOTE: Return statement for component or helper output.
021866| src/contexts/MapBoundsContext.tsx:187:     <MapBoundsContext.Provider value={contextValue}>
021867| NOTE: JSX markup for search UI.
021868| src/contexts/MapBoundsContext.tsx:188:       {children}
021869| NOTE: Implementation detail supporting search page behavior.
021870| src/contexts/MapBoundsContext.tsx:189:     </MapBoundsContext.Provider>
021871| NOTE: JSX markup for search UI.
021872| src/contexts/MapBoundsContext.tsx:190:   );
021873| NOTE: Implementation detail supporting search page behavior.
021874| src/contexts/MapBoundsContext.tsx:191: }
021875| NOTE: Implementation detail supporting search page behavior.
021876| src/contexts/MapBoundsContext.tsx:192: 
021877| NOTE: Blank line for visual separation.
021878| src/contexts/MapBoundsContext.tsx:193: export function useMapBounds() {
021879| NOTE: Exports helper or component function.
021880| src/contexts/MapBoundsContext.tsx:194:   const context = useContext(MapBoundsContext);
021881| NOTE: Local declaration used by search logic or UI.
021882| src/contexts/MapBoundsContext.tsx:195:   if (!context) {
021883| NOTE: Conditional logic controlling rendering or flow.
021884| src/contexts/MapBoundsContext.tsx:196:     // Return safe defaults when used outside provider (e.g., during SSR)
021885| NOTE: Line comment documents intent or constraints.
021886| src/contexts/MapBoundsContext.tsx:197:     return {
021887| NOTE: Return statement for component or helper output.
021888| src/contexts/MapBoundsContext.tsx:198:       hasUserMoved: false,
021889| NOTE: Implementation detail supporting search page behavior.
021890| src/contexts/MapBoundsContext.tsx:199:       boundsDirty: false,
021891| NOTE: Implementation detail supporting search page behavior.
021892| src/contexts/MapBoundsContext.tsx:200:       searchAsMove: false,
021893| NOTE: Implementation detail supporting search page behavior.
021894| src/contexts/MapBoundsContext.tsx:201:       searchLocationName: null,
021895| NOTE: Implementation detail supporting search page behavior.
021896| src/contexts/MapBoundsContext.tsx:202:       searchLocationCenter: null,
021897| NOTE: Implementation detail supporting search page behavior.
021898| src/contexts/MapBoundsContext.tsx:203:       locationConflict: false,
021899| NOTE: Implementation detail supporting search page behavior.
021900| src/contexts/MapBoundsContext.tsx:204:       searchCurrentArea: () => {},
021901| NOTE: Implementation detail supporting search page behavior.
021902| src/contexts/MapBoundsContext.tsx:205:       resetToUrlBounds: () => {},
021903| NOTE: Implementation detail supporting search page behavior.
021904| src/contexts/MapBoundsContext.tsx:206:       setHasUserMoved: () => {},
021905| NOTE: Implementation detail supporting search page behavior.
021906| src/contexts/MapBoundsContext.tsx:207:       setBoundsDirty: () => {},
021907| NOTE: Implementation detail supporting search page behavior.
021908| src/contexts/MapBoundsContext.tsx:208:       setSearchAsMove: () => {},
021909| NOTE: Implementation detail supporting search page behavior.
021910| src/contexts/MapBoundsContext.tsx:209:       setSearchLocation: () => {},
021911| NOTE: Implementation detail supporting search page behavior.
021912| src/contexts/MapBoundsContext.tsx:210:       setCurrentMapBounds: () => {},
021913| NOTE: Implementation detail supporting search page behavior.
021914| src/contexts/MapBoundsContext.tsx:211:       setSearchHandler: () => {},
021915| NOTE: Implementation detail supporting search page behavior.
021916| src/contexts/MapBoundsContext.tsx:212:       setResetHandler: () => {},
021917| NOTE: Implementation detail supporting search page behavior.
021918| src/contexts/MapBoundsContext.tsx:213:     };
021919| NOTE: Implementation detail supporting search page behavior.
021920| src/contexts/MapBoundsContext.tsx:214:   }
021921| NOTE: Implementation detail supporting search page behavior.
021922| src/contexts/MapBoundsContext.tsx:215:   return context;
021923| NOTE: Return statement for component or helper output.
021924| src/contexts/MapBoundsContext.tsx:216: }
021925| NOTE: Implementation detail supporting search page behavior.
021926| src/contexts/MapBoundsContext.tsx:217: 
021927| NOTE: Blank line for visual separation.
021928| src/contexts/MapBoundsContext.tsx:218: /**
021929| NOTE: Block comment line describing behavior or context.
021930| src/contexts/MapBoundsContext.tsx:219:  * Hook for checking if banner should be shown
021931| NOTE: Block comment line describing behavior or context.
021932| src/contexts/MapBoundsContext.tsx:220:  * Used by both Map (overlay) and SearchLayoutView (inline)
021933| NOTE: Block comment line describing behavior or context.
021934| src/contexts/MapBoundsContext.tsx:221:  */
021935| NOTE: Block comment line describing behavior or context.
021936| src/contexts/MapBoundsContext.tsx:222: export function useMapMovedBanner() {
021937| NOTE: Exports helper or component function.
021938| src/contexts/MapBoundsContext.tsx:223:   const {
021939| NOTE: Local declaration used by search logic or UI.
021940| src/contexts/MapBoundsContext.tsx:224:     hasUserMoved,
021941| NOTE: Implementation detail supporting search page behavior.
021942| src/contexts/MapBoundsContext.tsx:225:     boundsDirty,
021943| NOTE: Implementation detail supporting search page behavior.
021944| src/contexts/MapBoundsContext.tsx:226:     searchAsMove,
021945| NOTE: Implementation detail supporting search page behavior.
021946| src/contexts/MapBoundsContext.tsx:227:     locationConflict,
021947| NOTE: Implementation detail supporting search page behavior.
021948| src/contexts/MapBoundsContext.tsx:228:     searchLocationName,
021949| NOTE: Implementation detail supporting search page behavior.
021950| src/contexts/MapBoundsContext.tsx:229:     searchCurrentArea,
021951| NOTE: Implementation detail supporting search page behavior.
021952| src/contexts/MapBoundsContext.tsx:230:     resetToUrlBounds,
021953| NOTE: Implementation detail supporting search page behavior.
021954| src/contexts/MapBoundsContext.tsx:231:   } = useMapBounds();
021955| NOTE: Implementation detail supporting search page behavior.
021956| src/contexts/MapBoundsContext.tsx:232: 
021957| NOTE: Blank line for visual separation.
021958| src/contexts/MapBoundsContext.tsx:233:   // Show "results not updated" banner when bounds differ but location is still visible
021959| NOTE: Line comment documents intent or constraints.
021960| src/contexts/MapBoundsContext.tsx:234:   const showBanner = hasUserMoved && boundsDirty && !searchAsMove;
021961| NOTE: Local declaration used by search logic or UI.
021962| src/contexts/MapBoundsContext.tsx:235: 
021963| NOTE: Blank line for visual separation.
021964| src/contexts/MapBoundsContext.tsx:236:   // Show "location conflict" banner when map no longer contains search location
021965| NOTE: Line comment documents intent or constraints.
021966| src/contexts/MapBoundsContext.tsx:237:   // This takes priority over the regular bounds dirty banner
021967| NOTE: Line comment documents intent or constraints.
021968| src/contexts/MapBoundsContext.tsx:238:   const showLocationConflict = locationConflict && !searchAsMove;
021969| NOTE: Local declaration used by search logic or UI.
021970| src/contexts/MapBoundsContext.tsx:239: 
021971| NOTE: Blank line for visual separation.
021972| src/contexts/MapBoundsContext.tsx:240:   return {
021973| NOTE: Return statement for component or helper output.
021974| src/contexts/MapBoundsContext.tsx:241:     showBanner: showBanner && !showLocationConflict,
021975| NOTE: Implementation detail supporting search page behavior.
021976| src/contexts/MapBoundsContext.tsx:242:     showLocationConflict,
021977| NOTE: Implementation detail supporting search page behavior.
021978| src/contexts/MapBoundsContext.tsx:243:     locationName: searchLocationName,
021979| NOTE: Implementation detail supporting search page behavior.
021980| src/contexts/MapBoundsContext.tsx:244:     onSearch: searchCurrentArea,
021981| NOTE: Implementation detail supporting search page behavior.
021982| src/contexts/MapBoundsContext.tsx:245:     onReset: resetToUrlBounds,
021983| NOTE: Implementation detail supporting search page behavior.
021984| src/contexts/MapBoundsContext.tsx:246:   };
021985| NOTE: Implementation detail supporting search page behavior.
021986| src/contexts/MapBoundsContext.tsx:247: }
021987| NOTE: Implementation detail supporting search page behavior.
021988| FILE END: src/contexts/MapBoundsContext.tsx
021989| 
021990| FILE START: src/contexts/MobileSearchContext.tsx
021991| FILE ROLE: Auto-discovered dependency in search page graph.
021992| src/contexts/MobileSearchContext.tsx:1: "use client";
021993| NOTE: Implementation detail supporting search page behavior.
021994| src/contexts/MobileSearchContext.tsx:2: 
021995| NOTE: Blank line for visual separation.
021996| src/contexts/MobileSearchContext.tsx:3: /**
021997| NOTE: Block comment line describing behavior or context.
021998| src/contexts/MobileSearchContext.tsx:4:  * MobileSearchContext - Coordinates mobile search bar state
021999| NOTE: Block comment line describing behavior or context.
022000| src/contexts/MobileSearchContext.tsx:5:  *
022001| NOTE: Block comment line describing behavior or context.
022002| src/contexts/MobileSearchContext.tsx:6:  * Allows the layout to control the collapsed/expanded state of the
022003| NOTE: Block comment line describing behavior or context.
022004| src/contexts/MobileSearchContext.tsx:7:  * mobile search bar and provides callbacks to open the filter drawer.
022005| NOTE: Block comment line describing behavior or context.
022006| src/contexts/MobileSearchContext.tsx:8:  */
022007| NOTE: Block comment line describing behavior or context.
022008| src/contexts/MobileSearchContext.tsx:9: 
022009| NOTE: Blank line for visual separation.
022010| src/contexts/MobileSearchContext.tsx:10: import {
022011| NOTE: Imports dependency for this module.
022012| src/contexts/MobileSearchContext.tsx:11:   createContext,
022013| NOTE: Implementation detail supporting search page behavior.
022014| src/contexts/MobileSearchContext.tsx:12:   useContext,
022015| NOTE: Implementation detail supporting search page behavior.
022016| src/contexts/MobileSearchContext.tsx:13:   useState,
022017| NOTE: Initializes local state for search UI behavior.
022018| src/contexts/MobileSearchContext.tsx:14:   useCallback,
022019| NOTE: Memoizes callback to preserve references across renders.
022020| src/contexts/MobileSearchContext.tsx:15:   useMemo,
022021| NOTE: Memoizes derived values to reduce re-render work.
022022| src/contexts/MobileSearchContext.tsx:16:   useRef,
022023| NOTE: Uses ref for stable mutable storage between renders.
022024| src/contexts/MobileSearchContext.tsx:17: } from "react";
022025| NOTE: Implementation detail supporting search page behavior.
022026| src/contexts/MobileSearchContext.tsx:18: 
022027| NOTE: Blank line for visual separation.
022028| src/contexts/MobileSearchContext.tsx:19: interface MobileSearchContextValue {
022029| NOTE: Type declaration for search data contracts.
022030| src/contexts/MobileSearchContext.tsx:20:   /** Whether the search is forcibly expanded (overrides scroll collapse) */
022031| NOTE: Block comment line describing behavior or context.
022032| src/contexts/MobileSearchContext.tsx:21:   isExpanded: boolean;
022033| NOTE: Implementation detail supporting search page behavior.
022034| src/contexts/MobileSearchContext.tsx:22:   /** Expand the search bar */
022035| NOTE: Block comment line describing behavior or context.
022036| src/contexts/MobileSearchContext.tsx:23:   expand: () => void;
022037| NOTE: Implementation detail supporting search page behavior.
022038| src/contexts/MobileSearchContext.tsx:24:   /** Collapse the search bar (let scroll behavior take over) */
022039| NOTE: Block comment line describing behavior or context.
022040| src/contexts/MobileSearchContext.tsx:25:   collapse: () => void;
022041| NOTE: Implementation detail supporting search page behavior.
022042| src/contexts/MobileSearchContext.tsx:26:   /** Callback to open filter drawer (registered by SearchForm) */
022043| NOTE: Block comment line describing behavior or context.
022044| src/contexts/MobileSearchContext.tsx:27:   openFilters: () => void;
022045| NOTE: Implementation detail supporting search page behavior.
022046| src/contexts/MobileSearchContext.tsx:28:   /** Register the filter drawer opener (called by SearchForm) */
022047| NOTE: Block comment line describing behavior or context.
022048| src/contexts/MobileSearchContext.tsx:29:   registerOpenFilters: (handler: () => void) => void;
022049| NOTE: Implementation detail supporting search page behavior.
022050| src/contexts/MobileSearchContext.tsx:30: }
022051| NOTE: Implementation detail supporting search page behavior.
022052| src/contexts/MobileSearchContext.tsx:31: 
022053| NOTE: Blank line for visual separation.
022054| src/contexts/MobileSearchContext.tsx:32: const MobileSearchContext = createContext<MobileSearchContextValue | null>(
022055| NOTE: Local declaration used by search logic or UI.
022056| src/contexts/MobileSearchContext.tsx:33:   null,
022057| NOTE: Implementation detail supporting search page behavior.
022058| src/contexts/MobileSearchContext.tsx:34: );
022059| NOTE: Implementation detail supporting search page behavior.
022060| src/contexts/MobileSearchContext.tsx:35: 
022061| NOTE: Blank line for visual separation.
022062| src/contexts/MobileSearchContext.tsx:36: // Module-level stable fallback (created once, never changes)
022063| NOTE: Line comment documents intent or constraints.
022064| src/contexts/MobileSearchContext.tsx:37: // This prevents infinite re-render loops when useMobileSearch() is called
022065| NOTE: Line comment documents intent or constraints.
022066| src/contexts/MobileSearchContext.tsx:38: // outside the provider context - each call returns the same object reference
022067| NOTE: Line comment documents intent or constraints.
022068| src/contexts/MobileSearchContext.tsx:39: const FALLBACK_CONTEXT: MobileSearchContextValue = {
022069| NOTE: Local declaration used by search logic or UI.
022070| src/contexts/MobileSearchContext.tsx:40:   isExpanded: false,
022071| NOTE: Implementation detail supporting search page behavior.
022072| src/contexts/MobileSearchContext.tsx:41:   expand: () => {},
022073| NOTE: Implementation detail supporting search page behavior.
022074| src/contexts/MobileSearchContext.tsx:42:   collapse: () => {},
022075| NOTE: Implementation detail supporting search page behavior.
022076| src/contexts/MobileSearchContext.tsx:43:   openFilters: () => {},
022077| NOTE: Implementation detail supporting search page behavior.
022078| src/contexts/MobileSearchContext.tsx:44:   registerOpenFilters: () => {},
022079| NOTE: Implementation detail supporting search page behavior.
022080| src/contexts/MobileSearchContext.tsx:45: };
022081| NOTE: Implementation detail supporting search page behavior.
022082| src/contexts/MobileSearchContext.tsx:46: 
022083| NOTE: Blank line for visual separation.
022084| src/contexts/MobileSearchContext.tsx:47: export function MobileSearchProvider({
022085| NOTE: Exports helper or component function.
022086| src/contexts/MobileSearchContext.tsx:48:   children,
022087| NOTE: Implementation detail supporting search page behavior.
022088| src/contexts/MobileSearchContext.tsx:49: }: {
022089| NOTE: Implementation detail supporting search page behavior.
022090| src/contexts/MobileSearchContext.tsx:50:   children: React.ReactNode;
022091| NOTE: Implementation detail supporting search page behavior.
022092| src/contexts/MobileSearchContext.tsx:51: }) {
022093| NOTE: Implementation detail supporting search page behavior.
022094| src/contexts/MobileSearchContext.tsx:52:   const [isExpanded, setIsExpanded] = useState(false);
022095| NOTE: Initializes local state for search UI behavior.
022096| src/contexts/MobileSearchContext.tsx:53: 
022097| NOTE: Blank line for visual separation.
022098| src/contexts/MobileSearchContext.tsx:54:   // Use ref instead of state - updates don't cause re-renders!
022099| NOTE: Line comment documents intent or constraints.
022100| src/contexts/MobileSearchContext.tsx:55:   // This prevents the infinite loop caused by handler registration
022101| NOTE: Line comment documents intent or constraints.
022102| src/contexts/MobileSearchContext.tsx:56:   const openFiltersHandlerRef = useRef<(() => void) | null>(null);
022103| NOTE: Uses ref for stable mutable storage between renders.
022104| src/contexts/MobileSearchContext.tsx:57: 
022105| NOTE: Blank line for visual separation.
022106| src/contexts/MobileSearchContext.tsx:58:   const expand = useCallback(() => {
022107| NOTE: Memoizes callback to preserve references across renders.
022108| src/contexts/MobileSearchContext.tsx:59:     setIsExpanded(true);
022109| NOTE: Implementation detail supporting search page behavior.
022110| src/contexts/MobileSearchContext.tsx:60:     // Scroll to top smoothly when expanding
022111| NOTE: Line comment documents intent or constraints.
022112| src/contexts/MobileSearchContext.tsx:61:     window.scrollTo({ top: 0, behavior: "smooth" });
022113| NOTE: Implementation detail supporting search page behavior.
022114| src/contexts/MobileSearchContext.tsx:62:   }, []);
022115| NOTE: Implementation detail supporting search page behavior.
022116| src/contexts/MobileSearchContext.tsx:63: 
022117| NOTE: Blank line for visual separation.
022118| src/contexts/MobileSearchContext.tsx:64:   const collapse = useCallback(() => {
022119| NOTE: Memoizes callback to preserve references across renders.
022120| src/contexts/MobileSearchContext.tsx:65:     setIsExpanded(false);
022121| NOTE: Implementation detail supporting search page behavior.
022122| src/contexts/MobileSearchContext.tsx:66:   }, []);
022123| NOTE: Implementation detail supporting search page behavior.
022124| src/contexts/MobileSearchContext.tsx:67: 
022125| NOTE: Blank line for visual separation.
022126| src/contexts/MobileSearchContext.tsx:68:   // No dependency needed - ref is always current
022127| NOTE: Line comment documents intent or constraints.
022128| src/contexts/MobileSearchContext.tsx:69:   const openFilters = useCallback(() => {
022129| NOTE: Memoizes callback to preserve references across renders.
022130| src/contexts/MobileSearchContext.tsx:70:     openFiltersHandlerRef.current?.();
022131| NOTE: Implementation detail supporting search page behavior.
022132| src/contexts/MobileSearchContext.tsx:71:   }, []);
022133| NOTE: Implementation detail supporting search page behavior.
022134| src/contexts/MobileSearchContext.tsx:72: 
022135| NOTE: Blank line for visual separation.
022136| src/contexts/MobileSearchContext.tsx:73:   // No state update - just stores in ref (no re-render!)
022137| NOTE: Line comment documents intent or constraints.
022138| src/contexts/MobileSearchContext.tsx:74:   const registerOpenFilters = useCallback((handler: () => void) => {
022139| NOTE: Memoizes callback to preserve references across renders.
022140| src/contexts/MobileSearchContext.tsx:75:     openFiltersHandlerRef.current = handler;
022141| NOTE: Implementation detail supporting search page behavior.
022142| src/contexts/MobileSearchContext.tsx:76:   }, []);
022143| NOTE: Implementation detail supporting search page behavior.
022144| src/contexts/MobileSearchContext.tsx:77: 
022145| NOTE: Blank line for visual separation.
022146| src/contexts/MobileSearchContext.tsx:78:   const value = useMemo(
022147| NOTE: Memoizes derived values to reduce re-render work.
022148| src/contexts/MobileSearchContext.tsx:79:     () => ({
022149| NOTE: Implementation detail supporting search page behavior.
022150| src/contexts/MobileSearchContext.tsx:80:       isExpanded,
022151| NOTE: Implementation detail supporting search page behavior.
022152| src/contexts/MobileSearchContext.tsx:81:       expand,
022153| NOTE: Implementation detail supporting search page behavior.
022154| src/contexts/MobileSearchContext.tsx:82:       collapse,
022155| NOTE: Implementation detail supporting search page behavior.
022156| src/contexts/MobileSearchContext.tsx:83:       openFilters,
022157| NOTE: Implementation detail supporting search page behavior.
022158| src/contexts/MobileSearchContext.tsx:84:       registerOpenFilters,
022159| NOTE: Implementation detail supporting search page behavior.
022160| src/contexts/MobileSearchContext.tsx:85:     }),
022161| NOTE: Implementation detail supporting search page behavior.
022162| src/contexts/MobileSearchContext.tsx:86:     [isExpanded, expand, collapse, openFilters, registerOpenFilters],
022163| NOTE: Implementation detail supporting search page behavior.
022164| src/contexts/MobileSearchContext.tsx:87:   );
022165| NOTE: Implementation detail supporting search page behavior.
022166| src/contexts/MobileSearchContext.tsx:88: 
022167| NOTE: Blank line for visual separation.
022168| src/contexts/MobileSearchContext.tsx:89:   return (
022169| NOTE: Return statement for component or helper output.
022170| src/contexts/MobileSearchContext.tsx:90:     <MobileSearchContext.Provider value={value}>
022171| NOTE: JSX markup for search UI.
022172| src/contexts/MobileSearchContext.tsx:91:       {children}
022173| NOTE: Implementation detail supporting search page behavior.
022174| src/contexts/MobileSearchContext.tsx:92:     </MobileSearchContext.Provider>
022175| NOTE: JSX markup for search UI.
022176| src/contexts/MobileSearchContext.tsx:93:   );
022177| NOTE: Implementation detail supporting search page behavior.
022178| src/contexts/MobileSearchContext.tsx:94: }
022179| NOTE: Implementation detail supporting search page behavior.
022180| src/contexts/MobileSearchContext.tsx:95: 
022181| NOTE: Blank line for visual separation.
022182| src/contexts/MobileSearchContext.tsx:96: export function useMobileSearch(): MobileSearchContextValue {
022183| NOTE: Exports helper or component function.
022184| src/contexts/MobileSearchContext.tsx:97:   const context = useContext(MobileSearchContext);
022185| NOTE: Local declaration used by search logic or UI.
022186| src/contexts/MobileSearchContext.tsx:98:   // Return stable fallback when used outside provider
022187| NOTE: Line comment documents intent or constraints.
022188| src/contexts/MobileSearchContext.tsx:99:   // Using module-level constant prevents infinite re-render loops
022189| NOTE: Line comment documents intent or constraints.
022190| src/contexts/MobileSearchContext.tsx:100:   return context ?? FALLBACK_CONTEXT;
022191| NOTE: Return statement for component or helper output.
022192| src/contexts/MobileSearchContext.tsx:101: }
022193| NOTE: Implementation detail supporting search page behavior.
022194| FILE END: src/contexts/MobileSearchContext.tsx
022195| 
022196| FILE START: src/contexts/SearchMapUIContext.tsx
022197| FILE ROLE: Auto-discovered dependency in search page graph.
022198| src/contexts/SearchMapUIContext.tsx:1: "use client";
022199| NOTE: Implementation detail supporting search page behavior.
022200| src/contexts/SearchMapUIContext.tsx:2: 
022201| NOTE: Blank line for visual separation.
022202| src/contexts/SearchMapUIContext.tsx:3: /**
022203| NOTE: Block comment line describing behavior or context.
022204| src/contexts/SearchMapUIContext.tsx:4:  * SearchMapUIContext - Context for card-to-map focus coordination
022205| NOTE: Block comment line describing behavior or context.
022206| src/contexts/SearchMapUIContext.tsx:5:  *
022207| NOTE: Block comment line describing behavior or context.
022208| src/contexts/SearchMapUIContext.tsx:6:  * When a user clicks "View on map" on a ListingCard, this context:
022209| NOTE: Block comment line describing behavior or context.
022210| src/contexts/SearchMapUIContext.tsx:7:  * 1. Stores the pending focus request (listing ID + nonce)
022211| NOTE: Block comment line describing behavior or context.
022212| src/contexts/SearchMapUIContext.tsx:8:  * 2. Opens the map if hidden (calls showMap)
022213| NOTE: Block comment line describing behavior or context.
022214| src/contexts/SearchMapUIContext.tsx:9:  * 3. Map.tsx consumes the pending focus to flyTo + open popup
022215| NOTE: Block comment line describing behavior or context.
022216| src/contexts/SearchMapUIContext.tsx:10:  *
022217| NOTE: Block comment line describing behavior or context.
022218| src/contexts/SearchMapUIContext.tsx:11:  * Key design decisions:
022219| NOTE: Block comment line describing behavior or context.
022220| src/contexts/SearchMapUIContext.tsx:12:  * - No timeout: pendingFocus persists until acknowledged or replaced
022221| NOTE: Block comment line describing behavior or context.
022222| src/contexts/SearchMapUIContext.tsx:13:  * - Nonce deduplication: rapid clicks only honor the latest request
022223| NOTE: Block comment line describing behavior or context.
022224| src/contexts/SearchMapUIContext.tsx:14:  * - ListingCard owns setActive (user-initiated), Map only handles flyTo + popup
022225| NOTE: Block comment line describing behavior or context.
022226| src/contexts/SearchMapUIContext.tsx:15:  */
022227| NOTE: Block comment line describing behavior or context.
022228| src/contexts/SearchMapUIContext.tsx:16: 
022229| NOTE: Blank line for visual separation.
022230| src/contexts/SearchMapUIContext.tsx:17: import {
022231| NOTE: Imports dependency for this module.
022232| src/contexts/SearchMapUIContext.tsx:18:   createContext,
022233| NOTE: Implementation detail supporting search page behavior.
022234| src/contexts/SearchMapUIContext.tsx:19:   useContext,
022235| NOTE: Implementation detail supporting search page behavior.
022236| src/contexts/SearchMapUIContext.tsx:20:   useState,
022237| NOTE: Initializes local state for search UI behavior.
022238| src/contexts/SearchMapUIContext.tsx:21:   useCallback,
022239| NOTE: Memoizes callback to preserve references across renders.
022240| src/contexts/SearchMapUIContext.tsx:22:   useMemo,
022241| NOTE: Memoizes derived values to reduce re-render work.
022242| src/contexts/SearchMapUIContext.tsx:23:   useRef,
022243| NOTE: Uses ref for stable mutable storage between renders.
022244| src/contexts/SearchMapUIContext.tsx:24: } from "react";
022245| NOTE: Implementation detail supporting search page behavior.
022246| src/contexts/SearchMapUIContext.tsx:25: 
022247| NOTE: Blank line for visual separation.
022248| src/contexts/SearchMapUIContext.tsx:26: interface PendingMapFocus {
022249| NOTE: Type declaration for search data contracts.
022250| src/contexts/SearchMapUIContext.tsx:27:   listingId: string;
022251| NOTE: Implementation detail supporting search page behavior.
022252| src/contexts/SearchMapUIContext.tsx:28:   nonce: number;
022253| NOTE: Implementation detail supporting search page behavior.
022254| src/contexts/SearchMapUIContext.tsx:29: }
022255| NOTE: Implementation detail supporting search page behavior.
022256| src/contexts/SearchMapUIContext.tsx:30: 
022257| NOTE: Blank line for visual separation.
022258| src/contexts/SearchMapUIContext.tsx:31: interface SearchMapUIContextValue {
022259| NOTE: Type declaration for search data contracts.
022260| src/contexts/SearchMapUIContext.tsx:32:   pendingFocus: PendingMapFocus | null;
022261| NOTE: Implementation detail supporting search page behavior.
022262| src/contexts/SearchMapUIContext.tsx:33:   focusListingOnMap: (listingId: string) => void;
022263| NOTE: Implementation detail supporting search page behavior.
022264| src/contexts/SearchMapUIContext.tsx:34:   acknowledgeFocus: (nonce: number) => void;
022265| NOTE: Implementation detail supporting search page behavior.
022266| src/contexts/SearchMapUIContext.tsx:35:   clearPendingFocus: () => void;
022267| NOTE: Implementation detail supporting search page behavior.
022268| src/contexts/SearchMapUIContext.tsx:36:   /** Register a dismiss function (called by Map.tsx on mount) */
022269| NOTE: Block comment line describing behavior or context.
022270| src/contexts/SearchMapUIContext.tsx:37:   registerDismiss: (fn: () => void) => void;
022271| NOTE: Implementation detail supporting search page behavior.
022272| src/contexts/SearchMapUIContext.tsx:38:   /** Dismiss popups and clear selection (called by ListingCard before navigation) */
022273| NOTE: Block comment line describing behavior or context.
022274| src/contexts/SearchMapUIContext.tsx:39:   dismiss: () => void;
022275| NOTE: Implementation detail supporting search page behavior.
022276| src/contexts/SearchMapUIContext.tsx:40: }
022277| NOTE: Implementation detail supporting search page behavior.
022278| src/contexts/SearchMapUIContext.tsx:41: 
022279| NOTE: Blank line for visual separation.
022280| src/contexts/SearchMapUIContext.tsx:42: const SearchMapUIContext = createContext<SearchMapUIContextValue | null>(null);
022281| NOTE: Local declaration used by search logic or UI.
022282| src/contexts/SearchMapUIContext.tsx:43: 
022283| NOTE: Blank line for visual separation.
022284| src/contexts/SearchMapUIContext.tsx:44: interface SearchMapUIProviderProps {
022285| NOTE: Type declaration for search data contracts.
022286| src/contexts/SearchMapUIContext.tsx:45:   children: React.ReactNode;
022287| NOTE: Implementation detail supporting search page behavior.
022288| src/contexts/SearchMapUIContext.tsx:46:   showMap: () => void;
022289| NOTE: Implementation detail supporting search page behavior.
022290| src/contexts/SearchMapUIContext.tsx:47:   shouldShowMap: boolean;
022291| NOTE: Implementation detail supporting search page behavior.
022292| src/contexts/SearchMapUIContext.tsx:48: }
022293| NOTE: Implementation detail supporting search page behavior.
022294| src/contexts/SearchMapUIContext.tsx:49: 
022295| NOTE: Blank line for visual separation.
022296| src/contexts/SearchMapUIContext.tsx:50: export function SearchMapUIProvider({
022297| NOTE: Exports helper or component function.
022298| src/contexts/SearchMapUIContext.tsx:51:   children,
022299| NOTE: Implementation detail supporting search page behavior.
022300| src/contexts/SearchMapUIContext.tsx:52:   showMap,
022301| NOTE: Implementation detail supporting search page behavior.
022302| src/contexts/SearchMapUIContext.tsx:53:   shouldShowMap,
022303| NOTE: Implementation detail supporting search page behavior.
022304| src/contexts/SearchMapUIContext.tsx:54: }: SearchMapUIProviderProps) {
022305| NOTE: Implementation detail supporting search page behavior.
022306| src/contexts/SearchMapUIContext.tsx:55:   const [pendingFocus, setPendingFocus] = useState<PendingMapFocus | null>(
022307| NOTE: Initializes local state for search UI behavior.
022308| src/contexts/SearchMapUIContext.tsx:56:     null,
022309| NOTE: Implementation detail supporting search page behavior.
022310| src/contexts/SearchMapUIContext.tsx:57:   );
022311| NOTE: Implementation detail supporting search page behavior.
022312| src/contexts/SearchMapUIContext.tsx:58:   const nonceRef = useRef(0);
022313| NOTE: Uses ref for stable mutable storage between renders.
022314| src/contexts/SearchMapUIContext.tsx:59:   const dismissRef = useRef<(() => void) | null>(null);
022315| NOTE: Uses ref for stable mutable storage between renders.
022316| src/contexts/SearchMapUIContext.tsx:60: 
022317| NOTE: Blank line for visual separation.
022318| src/contexts/SearchMapUIContext.tsx:61:   const focusListingOnMap = useCallback(
022319| NOTE: Memoizes callback to preserve references across renders.
022320| src/contexts/SearchMapUIContext.tsx:62:     (listingId: string) => {
022321| NOTE: Implementation detail supporting search page behavior.
022322| src/contexts/SearchMapUIContext.tsx:63:       nonceRef.current += 1;
022323| NOTE: Implementation detail supporting search page behavior.
022324| src/contexts/SearchMapUIContext.tsx:64:       const nonce = nonceRef.current;
022325| NOTE: Local declaration used by search logic or UI.
022326| src/contexts/SearchMapUIContext.tsx:65: 
022327| NOTE: Blank line for visual separation.
022328| src/contexts/SearchMapUIContext.tsx:66:       // New focus replaces any previous pending focus (nonce deduplication)
022329| NOTE: Line comment documents intent or constraints.
022330| src/contexts/SearchMapUIContext.tsx:67:       setPendingFocus({ listingId, nonce });
022331| NOTE: Implementation detail supporting search page behavior.
022332| src/contexts/SearchMapUIContext.tsx:68: 
022333| NOTE: Blank line for visual separation.
022334| src/contexts/SearchMapUIContext.tsx:69:       if (!shouldShowMap) {
022335| NOTE: Conditional logic controlling rendering or flow.
022336| src/contexts/SearchMapUIContext.tsx:70:         showMap();
022337| NOTE: Implementation detail supporting search page behavior.
022338| src/contexts/SearchMapUIContext.tsx:71:       }
022339| NOTE: Implementation detail supporting search page behavior.
022340| src/contexts/SearchMapUIContext.tsx:72:     },
022341| NOTE: Implementation detail supporting search page behavior.
022342| src/contexts/SearchMapUIContext.tsx:73:     [showMap, shouldShowMap],
022343| NOTE: Implementation detail supporting search page behavior.
022344| src/contexts/SearchMapUIContext.tsx:74:   );
022345| NOTE: Implementation detail supporting search page behavior.
022346| src/contexts/SearchMapUIContext.tsx:75: 
022347| NOTE: Blank line for visual separation.
022348| src/contexts/SearchMapUIContext.tsx:76:   const acknowledgeFocus = useCallback((nonce: number) => {
022349| NOTE: Memoizes callback to preserve references across renders.
022350| src/contexts/SearchMapUIContext.tsx:77:     setPendingFocus((current) => (current?.nonce === nonce ? null : current));
022351| NOTE: Implementation detail supporting search page behavior.
022352| src/contexts/SearchMapUIContext.tsx:78:   }, []);
022353| NOTE: Implementation detail supporting search page behavior.
022354| src/contexts/SearchMapUIContext.tsx:79: 
022355| NOTE: Blank line for visual separation.
022356| src/contexts/SearchMapUIContext.tsx:80:   const clearPendingFocus = useCallback(() => {
022357| NOTE: Memoizes callback to preserve references across renders.
022358| src/contexts/SearchMapUIContext.tsx:81:     setPendingFocus(null);
022359| NOTE: Implementation detail supporting search page behavior.
022360| src/contexts/SearchMapUIContext.tsx:82:   }, []);
022361| NOTE: Implementation detail supporting search page behavior.
022362| src/contexts/SearchMapUIContext.tsx:83: 
022363| NOTE: Blank line for visual separation.
022364| src/contexts/SearchMapUIContext.tsx:84:   const registerDismiss = useCallback((fn: () => void) => {
022365| NOTE: Memoizes callback to preserve references across renders.
022366| src/contexts/SearchMapUIContext.tsx:85:     dismissRef.current = fn;
022367| NOTE: Implementation detail supporting search page behavior.
022368| src/contexts/SearchMapUIContext.tsx:86:   }, []);
022369| NOTE: Implementation detail supporting search page behavior.
022370| src/contexts/SearchMapUIContext.tsx:87: 
022371| NOTE: Blank line for visual separation.
022372| src/contexts/SearchMapUIContext.tsx:88:   const dismiss = useCallback(() => {
022373| NOTE: Memoizes callback to preserve references across renders.
022374| src/contexts/SearchMapUIContext.tsx:89:     dismissRef.current?.();
022375| NOTE: Implementation detail supporting search page behavior.
022376| src/contexts/SearchMapUIContext.tsx:90:   }, []);
022377| NOTE: Implementation detail supporting search page behavior.
022378| src/contexts/SearchMapUIContext.tsx:91: 
022379| NOTE: Blank line for visual separation.
022380| src/contexts/SearchMapUIContext.tsx:92:   const contextValue = useMemo(
022381| NOTE: Memoizes derived values to reduce re-render work.
022382| src/contexts/SearchMapUIContext.tsx:93:     () => ({
022383| NOTE: Implementation detail supporting search page behavior.
022384| src/contexts/SearchMapUIContext.tsx:94:       pendingFocus,
022385| NOTE: Implementation detail supporting search page behavior.
022386| src/contexts/SearchMapUIContext.tsx:95:       focusListingOnMap,
022387| NOTE: Implementation detail supporting search page behavior.
022388| src/contexts/SearchMapUIContext.tsx:96:       acknowledgeFocus,
022389| NOTE: Implementation detail supporting search page behavior.
022390| src/contexts/SearchMapUIContext.tsx:97:       clearPendingFocus,
022391| NOTE: Implementation detail supporting search page behavior.
022392| src/contexts/SearchMapUIContext.tsx:98:       registerDismiss,
022393| NOTE: Implementation detail supporting search page behavior.
022394| src/contexts/SearchMapUIContext.tsx:99:       dismiss,
022395| NOTE: Implementation detail supporting search page behavior.
022396| src/contexts/SearchMapUIContext.tsx:100:     }),
022397| NOTE: Implementation detail supporting search page behavior.
022398| src/contexts/SearchMapUIContext.tsx:101:     [
022399| NOTE: Implementation detail supporting search page behavior.
022400| src/contexts/SearchMapUIContext.tsx:102:       pendingFocus,
022401| NOTE: Implementation detail supporting search page behavior.
022402| src/contexts/SearchMapUIContext.tsx:103:       focusListingOnMap,
022403| NOTE: Implementation detail supporting search page behavior.
022404| src/contexts/SearchMapUIContext.tsx:104:       acknowledgeFocus,
022405| NOTE: Implementation detail supporting search page behavior.
022406| src/contexts/SearchMapUIContext.tsx:105:       clearPendingFocus,
022407| NOTE: Implementation detail supporting search page behavior.
022408| src/contexts/SearchMapUIContext.tsx:106:       registerDismiss,
022409| NOTE: Implementation detail supporting search page behavior.
022410| src/contexts/SearchMapUIContext.tsx:107:       dismiss,
022411| NOTE: Implementation detail supporting search page behavior.
022412| src/contexts/SearchMapUIContext.tsx:108:     ],
022413| NOTE: Implementation detail supporting search page behavior.
022414| src/contexts/SearchMapUIContext.tsx:109:   );
022415| NOTE: Implementation detail supporting search page behavior.
022416| src/contexts/SearchMapUIContext.tsx:110: 
022417| NOTE: Blank line for visual separation.
022418| src/contexts/SearchMapUIContext.tsx:111:   return (
022419| NOTE: Return statement for component or helper output.
022420| src/contexts/SearchMapUIContext.tsx:112:     <SearchMapUIContext.Provider value={contextValue}>
022421| NOTE: JSX markup for search UI.
022422| src/contexts/SearchMapUIContext.tsx:113:       {children}
022423| NOTE: Implementation detail supporting search page behavior.
022424| src/contexts/SearchMapUIContext.tsx:114:     </SearchMapUIContext.Provider>
022425| NOTE: JSX markup for search UI.
022426| src/contexts/SearchMapUIContext.tsx:115:   );
022427| NOTE: Implementation detail supporting search page behavior.
022428| src/contexts/SearchMapUIContext.tsx:116: }
022429| NOTE: Implementation detail supporting search page behavior.
022430| src/contexts/SearchMapUIContext.tsx:117: 
022431| NOTE: Blank line for visual separation.
022432| src/contexts/SearchMapUIContext.tsx:118: /**
022433| NOTE: Block comment line describing behavior or context.
022434| src/contexts/SearchMapUIContext.tsx:119:  * Hook for components that trigger map focus (e.g., ListingCard)
022435| NOTE: Block comment line describing behavior or context.
022436| src/contexts/SearchMapUIContext.tsx:120:  */
022437| NOTE: Block comment line describing behavior or context.
022438| src/contexts/SearchMapUIContext.tsx:121: export function useSearchMapUI() {
022439| NOTE: Exports helper or component function.
022440| src/contexts/SearchMapUIContext.tsx:122:   const context = useContext(SearchMapUIContext);
022441| NOTE: Local declaration used by search logic or UI.
022442| src/contexts/SearchMapUIContext.tsx:123:   if (!context) {
022443| NOTE: Conditional logic controlling rendering or flow.
022444| src/contexts/SearchMapUIContext.tsx:124:     // Return no-op when used outside provider (e.g., non-search pages)
022445| NOTE: Line comment documents intent or constraints.
022446| src/contexts/SearchMapUIContext.tsx:125:     return {
022447| NOTE: Return statement for component or helper output.
022448| src/contexts/SearchMapUIContext.tsx:126:       pendingFocus: null,
022449| NOTE: Implementation detail supporting search page behavior.
022450| src/contexts/SearchMapUIContext.tsx:127:       focusListingOnMap: () => {},
022451| NOTE: Implementation detail supporting search page behavior.
022452| src/contexts/SearchMapUIContext.tsx:128:       acknowledgeFocus: () => {},
022453| NOTE: Implementation detail supporting search page behavior.
022454| src/contexts/SearchMapUIContext.tsx:129:       clearPendingFocus: () => {},
022455| NOTE: Implementation detail supporting search page behavior.
022456| src/contexts/SearchMapUIContext.tsx:130:       registerDismiss: () => {},
022457| NOTE: Implementation detail supporting search page behavior.
022458| src/contexts/SearchMapUIContext.tsx:131:       dismiss: () => {},
022459| NOTE: Implementation detail supporting search page behavior.
022460| src/contexts/SearchMapUIContext.tsx:132:     };
022461| NOTE: Implementation detail supporting search page behavior.
022462| src/contexts/SearchMapUIContext.tsx:133:   }
022463| NOTE: Implementation detail supporting search page behavior.
022464| src/contexts/SearchMapUIContext.tsx:134:   return context;
022465| NOTE: Return statement for component or helper output.
022466| src/contexts/SearchMapUIContext.tsx:135: }
022467| NOTE: Implementation detail supporting search page behavior.
022468| src/contexts/SearchMapUIContext.tsx:136: 
022469| NOTE: Blank line for visual separation.
022470| src/contexts/SearchMapUIContext.tsx:137: /**
022471| NOTE: Block comment line describing behavior or context.
022472| src/contexts/SearchMapUIContext.tsx:138:  * Hook for Map.tsx to consume pending focus
022473| NOTE: Block comment line describing behavior or context.
022474| src/contexts/SearchMapUIContext.tsx:139:  */
022475| NOTE: Block comment line describing behavior or context.
022476| src/contexts/SearchMapUIContext.tsx:140: export function usePendingMapFocus() {
022477| NOTE: Exports helper or component function.
022478| src/contexts/SearchMapUIContext.tsx:141:   const { pendingFocus, acknowledgeFocus, clearPendingFocus } =
022479| NOTE: Local declaration used by search logic or UI.
022480| src/contexts/SearchMapUIContext.tsx:142:     useSearchMapUI();
022481| NOTE: Implementation detail supporting search page behavior.
022482| src/contexts/SearchMapUIContext.tsx:143:   return { pendingFocus, acknowledgeFocus, clearPendingFocus };
022483| NOTE: Return statement for component or helper output.
022484| src/contexts/SearchMapUIContext.tsx:144: }
022485| NOTE: Implementation detail supporting search page behavior.
022486| FILE END: src/contexts/SearchMapUIContext.tsx
022487| 
022488| FILE START: src/contexts/SearchTransitionContext.tsx
022489| FILE ROLE: Auto-discovered dependency in search page graph.
022490| src/contexts/SearchTransitionContext.tsx:1: "use client";
022491| NOTE: Implementation detail supporting search page behavior.
022492| src/contexts/SearchTransitionContext.tsx:2: 
022493| NOTE: Blank line for visual separation.
022494| src/contexts/SearchTransitionContext.tsx:3: /**
022495| NOTE: Block comment line describing behavior or context.
022496| src/contexts/SearchTransitionContext.tsx:4:  * SearchTransitionContext - Coordinates transitions across search components
022497| NOTE: Block comment line describing behavior or context.
022498| src/contexts/SearchTransitionContext.tsx:5:  *
022499| NOTE: Block comment line describing behavior or context.
022500| src/contexts/SearchTransitionContext.tsx:6:  * This context provides:
022501| NOTE: Block comment line describing behavior or context.
022502| src/contexts/SearchTransitionContext.tsx:7:  * - isPending: Whether a navigation/transition is in progress
022503| NOTE: Block comment line describing behavior or context.
022504| src/contexts/SearchTransitionContext.tsx:8:  * - startTransition: Wrapper for navigation calls to enable smooth transitions
022505| NOTE: Block comment line describing behavior or context.
022506| src/contexts/SearchTransitionContext.tsx:9:  *
022507| NOTE: Block comment line describing behavior or context.
022508| src/contexts/SearchTransitionContext.tsx:10:  * Benefits:
022509| NOTE: Block comment line describing behavior or context.
022510| src/contexts/SearchTransitionContext.tsx:11:  * - Keeps current results visible while new data loads
022511| NOTE: Block comment line describing behavior or context.
022512| src/contexts/SearchTransitionContext.tsx:12:  * - Shows loading overlay instead of full page flash
022513| NOTE: Block comment line describing behavior or context.
022514| src/contexts/SearchTransitionContext.tsx:13:  * - Preserves scroll position during filter changes
022515| NOTE: Block comment line describing behavior or context.
022516| src/contexts/SearchTransitionContext.tsx:14:  */
022517| NOTE: Block comment line describing behavior or context.
022518| src/contexts/SearchTransitionContext.tsx:15: 
022519| NOTE: Blank line for visual separation.
022520| src/contexts/SearchTransitionContext.tsx:16: import {
022521| NOTE: Imports dependency for this module.
022522| src/contexts/SearchTransitionContext.tsx:17:   createContext,
022523| NOTE: Implementation detail supporting search page behavior.
022524| src/contexts/SearchTransitionContext.tsx:18:   useContext,
022525| NOTE: Implementation detail supporting search page behavior.
022526| src/contexts/SearchTransitionContext.tsx:19:   useTransition,
022527| NOTE: Implementation detail supporting search page behavior.
022528| src/contexts/SearchTransitionContext.tsx:20:   useCallback,
022529| NOTE: Memoizes callback to preserve references across renders.
022530| src/contexts/SearchTransitionContext.tsx:21:   useState,
022531| NOTE: Initializes local state for search UI behavior.
022532| src/contexts/SearchTransitionContext.tsx:22:   useEffect,
022533| NOTE: Defines side effect for syncing with external state.
022534| src/contexts/SearchTransitionContext.tsx:23:   type ReactNode,
022535| NOTE: Type declaration for search data contracts.
022536| src/contexts/SearchTransitionContext.tsx:24:   type TransitionStartFunction,
022537| NOTE: Type declaration for search data contracts.
022538| src/contexts/SearchTransitionContext.tsx:25: } from "react";
022539| NOTE: Implementation detail supporting search page behavior.
022540| src/contexts/SearchTransitionContext.tsx:26: import { useRouter } from "next/navigation";
022541| NOTE: Imports dependency for this module.
022542| src/contexts/SearchTransitionContext.tsx:27: 
022543| NOTE: Blank line for visual separation.
022544| src/contexts/SearchTransitionContext.tsx:28: // Threshold for "slow" transition warning (6 seconds)
022545| NOTE: Line comment documents intent or constraints.
022546| src/contexts/SearchTransitionContext.tsx:29: const SLOW_TRANSITION_THRESHOLD_MS = 6000;
022547| NOTE: Local declaration used by search logic or UI.
022548| src/contexts/SearchTransitionContext.tsx:30: 
022549| NOTE: Blank line for visual separation.
022550| src/contexts/SearchTransitionContext.tsx:31: interface SearchTransitionContextValue {
022551| NOTE: Type declaration for search data contracts.
022552| src/contexts/SearchTransitionContext.tsx:32:   /** Whether a transition is currently in progress */
022553| NOTE: Block comment line describing behavior or context.
022554| src/contexts/SearchTransitionContext.tsx:33:   isPending: boolean;
022555| NOTE: Implementation detail supporting search page behavior.
022556| src/contexts/SearchTransitionContext.tsx:34:   /** Whether the transition has exceeded the slow threshold (6s) */
022557| NOTE: Block comment line describing behavior or context.
022558| src/contexts/SearchTransitionContext.tsx:35:   isSlowTransition: boolean;
022559| NOTE: Implementation detail supporting search page behavior.
022560| src/contexts/SearchTransitionContext.tsx:36:   /** Navigate to a URL within a transition (keeps old UI visible) */
022561| NOTE: Block comment line describing behavior or context.
022562| src/contexts/SearchTransitionContext.tsx:37:   navigateWithTransition: (url: string, options?: { scroll?: boolean }) => void;
022563| NOTE: Routing logic updates search URL state.
022564| src/contexts/SearchTransitionContext.tsx:38:   /** Raw startTransition for custom transition logic */
022565| NOTE: Block comment line describing behavior or context.
022566| src/contexts/SearchTransitionContext.tsx:39:   startTransition: TransitionStartFunction;
022567| NOTE: Implementation detail supporting search page behavior.
022568| src/contexts/SearchTransitionContext.tsx:40: }
022569| NOTE: Implementation detail supporting search page behavior.
022570| src/contexts/SearchTransitionContext.tsx:41: 
022571| NOTE: Blank line for visual separation.
022572| src/contexts/SearchTransitionContext.tsx:42: const SearchTransitionContext =
022573| NOTE: Local declaration used by search logic or UI.
022574| src/contexts/SearchTransitionContext.tsx:43:   createContext<SearchTransitionContextValue | null>(null);
022575| NOTE: Implementation detail supporting search page behavior.
022576| src/contexts/SearchTransitionContext.tsx:44: 
022577| NOTE: Blank line for visual separation.
022578| src/contexts/SearchTransitionContext.tsx:45: export function SearchTransitionProvider({
022579| NOTE: Exports helper or component function.
022580| src/contexts/SearchTransitionContext.tsx:46:   children,
022581| NOTE: Implementation detail supporting search page behavior.
022582| src/contexts/SearchTransitionContext.tsx:47: }: {
022583| NOTE: Implementation detail supporting search page behavior.
022584| src/contexts/SearchTransitionContext.tsx:48:   children: ReactNode;
022585| NOTE: Implementation detail supporting search page behavior.
022586| src/contexts/SearchTransitionContext.tsx:49: }) {
022587| NOTE: Implementation detail supporting search page behavior.
022588| src/contexts/SearchTransitionContext.tsx:50:   const [isPending, startTransition] = useTransition();
022589| NOTE: Local declaration used by search logic or UI.
022590| src/contexts/SearchTransitionContext.tsx:51:   const [isSlowTransition, setIsSlowTransition] = useState(false);
022591| NOTE: Initializes local state for search UI behavior.
022592| src/contexts/SearchTransitionContext.tsx:52:   const router = useRouter();
022593| NOTE: Local declaration used by search logic or UI.
022594| src/contexts/SearchTransitionContext.tsx:53: 
022595| NOTE: Blank line for visual separation.
022596| src/contexts/SearchTransitionContext.tsx:54:   // Track slow transitions (>6s)
022597| NOTE: Line comment documents intent or constraints.
022598| src/contexts/SearchTransitionContext.tsx:55:   useEffect(() => {
022599| NOTE: Defines side effect for syncing with external state.
022600| src/contexts/SearchTransitionContext.tsx:56:     if (!isPending) {
022601| NOTE: Conditional logic controlling rendering or flow.
022602| src/contexts/SearchTransitionContext.tsx:57:       // Reset when transition ends
022603| NOTE: Line comment documents intent or constraints.
022604| src/contexts/SearchTransitionContext.tsx:58:       setIsSlowTransition(false);
022605| NOTE: Implementation detail supporting search page behavior.
022606| src/contexts/SearchTransitionContext.tsx:59:       return;
022607| NOTE: Implementation detail supporting search page behavior.
022608| src/contexts/SearchTransitionContext.tsx:60:     }
022609| NOTE: Implementation detail supporting search page behavior.
022610| src/contexts/SearchTransitionContext.tsx:61: 
022611| NOTE: Blank line for visual separation.
022612| src/contexts/SearchTransitionContext.tsx:62:     // Set timeout to mark as slow after threshold
022613| NOTE: Line comment documents intent or constraints.
022614| src/contexts/SearchTransitionContext.tsx:63:     const timeout = setTimeout(() => {
022615| NOTE: Local declaration used by search logic or UI.
022616| src/contexts/SearchTransitionContext.tsx:64:       setIsSlowTransition(true);
022617| NOTE: Implementation detail supporting search page behavior.
022618| src/contexts/SearchTransitionContext.tsx:65:     }, SLOW_TRANSITION_THRESHOLD_MS);
022619| NOTE: Implementation detail supporting search page behavior.
022620| src/contexts/SearchTransitionContext.tsx:66: 
022621| NOTE: Blank line for visual separation.
022622| src/contexts/SearchTransitionContext.tsx:67:     return () => clearTimeout(timeout);
022623| NOTE: Return statement for component or helper output.
022624| src/contexts/SearchTransitionContext.tsx:68:   }, [isPending]);
022625| NOTE: Implementation detail supporting search page behavior.
022626| src/contexts/SearchTransitionContext.tsx:69: 
022627| NOTE: Blank line for visual separation.
022628| src/contexts/SearchTransitionContext.tsx:70:   const navigateWithTransition = useCallback(
022629| NOTE: Memoizes callback to preserve references across renders.
022630| src/contexts/SearchTransitionContext.tsx:71:     (url: string, options?: { scroll?: boolean }) => {
022631| NOTE: Implementation detail supporting search page behavior.
022632| src/contexts/SearchTransitionContext.tsx:72:       startTransition(() => {
022633| NOTE: Implementation detail supporting search page behavior.
022634| src/contexts/SearchTransitionContext.tsx:73:         // Default scroll: false to preserve scroll position
022635| NOTE: Line comment documents intent or constraints.
022636| src/contexts/SearchTransitionContext.tsx:74:         router.push(url, { scroll: options?.scroll ?? false });
022637| NOTE: Routing logic updates search URL state.
022638| src/contexts/SearchTransitionContext.tsx:75:       });
022639| NOTE: Implementation detail supporting search page behavior.
022640| src/contexts/SearchTransitionContext.tsx:76:     },
022641| NOTE: Implementation detail supporting search page behavior.
022642| src/contexts/SearchTransitionContext.tsx:77:     [router, startTransition],
022643| NOTE: Implementation detail supporting search page behavior.
022644| src/contexts/SearchTransitionContext.tsx:78:   );
022645| NOTE: Implementation detail supporting search page behavior.
022646| src/contexts/SearchTransitionContext.tsx:79: 
022647| NOTE: Blank line for visual separation.
022648| src/contexts/SearchTransitionContext.tsx:80:   return (
022649| NOTE: Return statement for component or helper output.
022650| src/contexts/SearchTransitionContext.tsx:81:     <SearchTransitionContext.Provider
022651| NOTE: JSX markup for search UI.
022652| src/contexts/SearchTransitionContext.tsx:82:       value={{
022653| NOTE: Implementation detail supporting search page behavior.
022654| src/contexts/SearchTransitionContext.tsx:83:         isPending,
022655| NOTE: Implementation detail supporting search page behavior.
022656| src/contexts/SearchTransitionContext.tsx:84:         isSlowTransition,
022657| NOTE: Implementation detail supporting search page behavior.
022658| src/contexts/SearchTransitionContext.tsx:85:         navigateWithTransition,
022659| NOTE: Routing logic updates search URL state.
022660| src/contexts/SearchTransitionContext.tsx:86:         startTransition,
022661| NOTE: Implementation detail supporting search page behavior.
022662| src/contexts/SearchTransitionContext.tsx:87:       }}
022663| NOTE: Implementation detail supporting search page behavior.
022664| src/contexts/SearchTransitionContext.tsx:88:     >
022665| NOTE: Implementation detail supporting search page behavior.
022666| src/contexts/SearchTransitionContext.tsx:89:       {children}
022667| NOTE: Implementation detail supporting search page behavior.
022668| src/contexts/SearchTransitionContext.tsx:90:     </SearchTransitionContext.Provider>
022669| NOTE: JSX markup for search UI.
022670| src/contexts/SearchTransitionContext.tsx:91:   );
022671| NOTE: Implementation detail supporting search page behavior.
022672| src/contexts/SearchTransitionContext.tsx:92: }
022673| NOTE: Implementation detail supporting search page behavior.
022674| src/contexts/SearchTransitionContext.tsx:93: 
022675| NOTE: Blank line for visual separation.
022676| src/contexts/SearchTransitionContext.tsx:94: /**
022677| NOTE: Block comment line describing behavior or context.
022678| src/contexts/SearchTransitionContext.tsx:95:  * Hook to access search transition state
022679| NOTE: Block comment line describing behavior or context.
022680| src/contexts/SearchTransitionContext.tsx:96:  * @throws Error if used outside SearchTransitionProvider
022681| NOTE: Block comment line describing behavior or context.
022682| src/contexts/SearchTransitionContext.tsx:97:  */
022683| NOTE: Block comment line describing behavior or context.
022684| src/contexts/SearchTransitionContext.tsx:98: export function useSearchTransition(): SearchTransitionContextValue {
022685| NOTE: Exports helper or component function.
022686| src/contexts/SearchTransitionContext.tsx:99:   const context = useContext(SearchTransitionContext);
022687| NOTE: Local declaration used by search logic or UI.
022688| src/contexts/SearchTransitionContext.tsx:100:   if (!context) {
022689| NOTE: Conditional logic controlling rendering or flow.
022690| src/contexts/SearchTransitionContext.tsx:101:     throw new Error(
022691| NOTE: Implementation detail supporting search page behavior.
022692| src/contexts/SearchTransitionContext.tsx:102:       "useSearchTransition must be used within SearchTransitionProvider",
022693| NOTE: Implementation detail supporting search page behavior.
022694| src/contexts/SearchTransitionContext.tsx:103:     );
022695| NOTE: Implementation detail supporting search page behavior.
022696| src/contexts/SearchTransitionContext.tsx:104:   }
022697| NOTE: Implementation detail supporting search page behavior.
022698| src/contexts/SearchTransitionContext.tsx:105:   return context;
022699| NOTE: Return statement for component or helper output.
022700| src/contexts/SearchTransitionContext.tsx:106: }
022701| NOTE: Implementation detail supporting search page behavior.
022702| src/contexts/SearchTransitionContext.tsx:107: 
022703| NOTE: Blank line for visual separation.
022704| src/contexts/SearchTransitionContext.tsx:108: /**
022705| NOTE: Block comment line describing behavior or context.
022706| src/contexts/SearchTransitionContext.tsx:109:  * Safe hook that returns null if outside provider
022707| NOTE: Block comment line describing behavior or context.
022708| src/contexts/SearchTransitionContext.tsx:110:  * Useful for components that may be rendered outside search context
022709| NOTE: Block comment line describing behavior or context.
022710| src/contexts/SearchTransitionContext.tsx:111:  */
022711| NOTE: Block comment line describing behavior or context.
022712| src/contexts/SearchTransitionContext.tsx:112: export function useSearchTransitionSafe(): SearchTransitionContextValue | null {
022713| NOTE: Exports helper or component function.
022714| src/contexts/SearchTransitionContext.tsx:113:   return useContext(SearchTransitionContext);
022715| NOTE: Return statement for component or helper output.
022716| src/contexts/SearchTransitionContext.tsx:114: }
022717| NOTE: Implementation detail supporting search page behavior.
022718| FILE END: src/contexts/SearchTransitionContext.tsx
022719| 
022720| FILE START: src/contexts/SearchV2DataContext.tsx
022721| FILE ROLE: Auto-discovered dependency in search page graph.
022722| src/contexts/SearchV2DataContext.tsx:1: "use client";
022723| NOTE: Implementation detail supporting search page behavior.
022724| src/contexts/SearchV2DataContext.tsx:2: 
022725| NOTE: Blank line for visual separation.
022726| src/contexts/SearchV2DataContext.tsx:3: import { createContext, useContext, useState, ReactNode } from "react";
022727| NOTE: Imports dependency for this module.
022728| src/contexts/SearchV2DataContext.tsx:4: import type {
022729| NOTE: Imports dependency for this module.
022730| src/contexts/SearchV2DataContext.tsx:5:   SearchV2GeoJSON,
022731| NOTE: Implementation detail supporting search page behavior.
022732| src/contexts/SearchV2DataContext.tsx:6:   SearchV2Pin,
022733| NOTE: Implementation detail supporting search page behavior.
022734| src/contexts/SearchV2DataContext.tsx:7:   SearchV2Mode,
022735| NOTE: Implementation detail supporting search page behavior.
022736| src/contexts/SearchV2DataContext.tsx:8: } from "@/lib/search/types";
022737| NOTE: Implementation detail supporting search page behavior.
022738| src/contexts/SearchV2DataContext.tsx:9: 
022739| NOTE: Blank line for visual separation.
022740| src/contexts/SearchV2DataContext.tsx:10: /**
022741| NOTE: Block comment line describing behavior or context.
022742| src/contexts/SearchV2DataContext.tsx:11:  * V2 map data passed from page.tsx to PersistentMapWrapper via context.
022743| NOTE: Block comment line describing behavior or context.
022744| src/contexts/SearchV2DataContext.tsx:12:  * This enables sibling component data sharing without prop drilling.
022745| NOTE: Block comment line describing behavior or context.
022746| src/contexts/SearchV2DataContext.tsx:13:  */
022747| NOTE: Block comment line describing behavior or context.
022748| src/contexts/SearchV2DataContext.tsx:14: export interface V2MapData {
022749| NOTE: Implementation detail supporting search page behavior.
022750| src/contexts/SearchV2DataContext.tsx:15:   /** GeoJSON FeatureCollection for Mapbox clustering (always present) */
022751| NOTE: Block comment line describing behavior or context.
022752| src/contexts/SearchV2DataContext.tsx:16:   geojson: SearchV2GeoJSON;
022753| NOTE: Implementation detail supporting search page behavior.
022754| src/contexts/SearchV2DataContext.tsx:17:   /** Tiered pins for sparse results (<50 listings) */
022755| NOTE: Block comment line describing behavior or context.
022756| src/contexts/SearchV2DataContext.tsx:18:   pins?: SearchV2Pin[];
022757| NOTE: Implementation detail supporting search page behavior.
022758| src/contexts/SearchV2DataContext.tsx:19:   /** Mode determines rendering strategy: 'geojson' for clustering, 'pins' for individual markers */
022759| NOTE: Block comment line describing behavior or context.
022760| src/contexts/SearchV2DataContext.tsx:20:   mode: SearchV2Mode;
022761| NOTE: Implementation detail supporting search page behavior.
022762| src/contexts/SearchV2DataContext.tsx:21: }
022763| NOTE: Implementation detail supporting search page behavior.
022764| src/contexts/SearchV2DataContext.tsx:22: 
022765| NOTE: Blank line for visual separation.
022766| src/contexts/SearchV2DataContext.tsx:23: interface SearchV2DataContextValue {
022767| NOTE: Type declaration for search data contracts.
022768| src/contexts/SearchV2DataContext.tsx:24:   /** V2 map data from unified search response, null when using v1 path */
022769| NOTE: Block comment line describing behavior or context.
022770| src/contexts/SearchV2DataContext.tsx:25:   v2MapData: V2MapData | null;
022771| NOTE: Implementation detail supporting search page behavior.
022772| src/contexts/SearchV2DataContext.tsx:26:   /** Set v2 map data (called by V2MapDataSetter on mount) */
022773| NOTE: Block comment line describing behavior or context.
022774| src/contexts/SearchV2DataContext.tsx:27:   setV2MapData: (data: V2MapData | null) => void;
022775| NOTE: Implementation detail supporting search page behavior.
022776| src/contexts/SearchV2DataContext.tsx:28:   /** Whether v2 mode is enabled (for race condition guard in PersistentMapWrapper) */
022777| NOTE: Block comment line describing behavior or context.
022778| src/contexts/SearchV2DataContext.tsx:29:   isV2Enabled: boolean;
022779| NOTE: Implementation detail supporting search page behavior.
022780| src/contexts/SearchV2DataContext.tsx:30:   /** Set v2 enabled state */
022781| NOTE: Block comment line describing behavior or context.
022782| src/contexts/SearchV2DataContext.tsx:31:   setIsV2Enabled: (enabled: boolean) => void;
022783| NOTE: Implementation detail supporting search page behavior.
022784| src/contexts/SearchV2DataContext.tsx:32: }
022785| NOTE: Implementation detail supporting search page behavior.
022786| src/contexts/SearchV2DataContext.tsx:33: 
022787| NOTE: Blank line for visual separation.
022788| src/contexts/SearchV2DataContext.tsx:34: const SearchV2DataContext = createContext<SearchV2DataContextValue>({
022789| NOTE: Local declaration used by search logic or UI.
022790| src/contexts/SearchV2DataContext.tsx:35:   v2MapData: null,
022791| NOTE: Implementation detail supporting search page behavior.
022792| src/contexts/SearchV2DataContext.tsx:36:   setV2MapData: () => {},
022793| NOTE: Implementation detail supporting search page behavior.
022794| src/contexts/SearchV2DataContext.tsx:37:   isV2Enabled: false,
022795| NOTE: Implementation detail supporting search page behavior.
022796| src/contexts/SearchV2DataContext.tsx:38:   setIsV2Enabled: () => {},
022797| NOTE: Implementation detail supporting search page behavior.
022798| src/contexts/SearchV2DataContext.tsx:39: });
022799| NOTE: Implementation detail supporting search page behavior.
022800| src/contexts/SearchV2DataContext.tsx:40: 
022801| NOTE: Blank line for visual separation.
022802| src/contexts/SearchV2DataContext.tsx:41: /**
022803| NOTE: Block comment line describing behavior or context.
022804| src/contexts/SearchV2DataContext.tsx:42:  * Provider for SearchV2Data context.
022805| NOTE: Block comment line describing behavior or context.
022806| src/contexts/SearchV2DataContext.tsx:43:  * Wraps SearchLayoutView in layout.tsx to enable data sharing between
022807| NOTE: Block comment line describing behavior or context.
022808| src/contexts/SearchV2DataContext.tsx:44:  * page.tsx (list) and PersistentMapWrapper (map) siblings.
022809| NOTE: Block comment line describing behavior or context.
022810| src/contexts/SearchV2DataContext.tsx:45:  */
022811| NOTE: Block comment line describing behavior or context.
022812| src/contexts/SearchV2DataContext.tsx:46: export function SearchV2DataProvider({ children }: { children: ReactNode }) {
022813| NOTE: Exports helper or component function.
022814| src/contexts/SearchV2DataContext.tsx:47:   const [v2MapData, setV2MapData] = useState<V2MapData | null>(null);
022815| NOTE: Initializes local state for search UI behavior.
022816| src/contexts/SearchV2DataContext.tsx:48:   const [isV2Enabled, setIsV2Enabled] = useState(false);
022817| NOTE: Initializes local state for search UI behavior.
022818| src/contexts/SearchV2DataContext.tsx:49: 
022819| NOTE: Blank line for visual separation.
022820| src/contexts/SearchV2DataContext.tsx:50:   return (
022821| NOTE: Return statement for component or helper output.
022822| src/contexts/SearchV2DataContext.tsx:51:     <SearchV2DataContext.Provider
022823| NOTE: JSX markup for search UI.
022824| src/contexts/SearchV2DataContext.tsx:52:       value={{ v2MapData, setV2MapData, isV2Enabled, setIsV2Enabled }}
022825| NOTE: Implementation detail supporting search page behavior.
022826| src/contexts/SearchV2DataContext.tsx:53:     >
022827| NOTE: Implementation detail supporting search page behavior.
022828| src/contexts/SearchV2DataContext.tsx:54:       {children}
022829| NOTE: Implementation detail supporting search page behavior.
022830| src/contexts/SearchV2DataContext.tsx:55:     </SearchV2DataContext.Provider>
022831| NOTE: JSX markup for search UI.
022832| src/contexts/SearchV2DataContext.tsx:56:   );
022833| NOTE: Implementation detail supporting search page behavior.
022834| src/contexts/SearchV2DataContext.tsx:57: }
022835| NOTE: Implementation detail supporting search page behavior.
022836| src/contexts/SearchV2DataContext.tsx:58: 
022837| NOTE: Blank line for visual separation.
022838| src/contexts/SearchV2DataContext.tsx:59: /**
022839| NOTE: Block comment line describing behavior or context.
022840| src/contexts/SearchV2DataContext.tsx:60:  * Hook to access SearchV2Data context.
022841| NOTE: Block comment line describing behavior or context.
022842| src/contexts/SearchV2DataContext.tsx:61:  * Used by:
022843| NOTE: Block comment line describing behavior or context.
022844| src/contexts/SearchV2DataContext.tsx:62:  * - V2MapDataSetter: to inject map data from page.tsx
022845| NOTE: Block comment line describing behavior or context.
022846| src/contexts/SearchV2DataContext.tsx:63:  * - PersistentMapWrapper: to read map data and skip v1 fetch
022847| NOTE: Block comment line describing behavior or context.
022848| src/contexts/SearchV2DataContext.tsx:64:  */
022849| NOTE: Block comment line describing behavior or context.
022850| src/contexts/SearchV2DataContext.tsx:65: export function useSearchV2Data() {
022851| NOTE: Exports helper or component function.
022852| src/contexts/SearchV2DataContext.tsx:66:   return useContext(SearchV2DataContext);
022853| NOTE: Return statement for component or helper output.
022854| src/contexts/SearchV2DataContext.tsx:67: }
022855| NOTE: Implementation detail supporting search page behavior.
022856| FILE END: src/contexts/SearchV2DataContext.tsx
022857| 
022858| FILE START: src/hooks/useBatchedFilters.ts
022859| FILE ROLE: Auto-discovered dependency in search page graph.
022860| src/hooks/useBatchedFilters.ts:1: "use client";
022861| NOTE: Implementation detail supporting search page behavior.
022862| src/hooks/useBatchedFilters.ts:2: 
022863| NOTE: Blank line for visual separation.
022864| src/hooks/useBatchedFilters.ts:3: /**
022865| NOTE: Block comment line describing behavior or context.
022866| src/hooks/useBatchedFilters.ts:4:  * useBatchedFilters - Batched filter state management
022867| NOTE: Block comment line describing behavior or context.
022868| src/hooks/useBatchedFilters.ts:5:  *
022869| NOTE: Block comment line describing behavior or context.
022870| src/hooks/useBatchedFilters.ts:6:  * This hook manages "pending" filter state that accumulates changes
022871| NOTE: Block comment line describing behavior or context.
022872| src/hooks/useBatchedFilters.ts:7:  * before applying them all at once. This reduces unnecessary fetches
022873| NOTE: Block comment line describing behavior or context.
022874| src/hooks/useBatchedFilters.ts:8:  * when users are adjusting multiple filters.
022875| NOTE: Block comment line describing behavior or context.
022876| src/hooks/useBatchedFilters.ts:9:  *
022877| NOTE: Block comment line describing behavior or context.
022878| src/hooks/useBatchedFilters.ts:10:  * Filter categories:
022879| NOTE: Block comment line describing behavior or context.
022880| src/hooks/useBatchedFilters.ts:11:  * - Instant (URL on change): sort, page, view mode
022881| NOTE: Block comment line describing behavior or context.
022882| src/hooks/useBatchedFilters.ts:12:  * - Batched (Apply button): price, amenities, rules, languages, room type, lease, date
022883| NOTE: Block comment line describing behavior or context.
022884| src/hooks/useBatchedFilters.ts:13:  */
022885| NOTE: Block comment line describing behavior or context.
022886| src/hooks/useBatchedFilters.ts:14: 
022887| NOTE: Blank line for visual separation.
022888| src/hooks/useBatchedFilters.ts:15: import { useState, useCallback, useMemo, useEffect } from "react";
022889| NOTE: Imports dependency for this module.
022890| src/hooks/useBatchedFilters.ts:16: import { useSearchParams } from "next/navigation";
022891| NOTE: Imports dependency for this module.
022892| src/hooks/useBatchedFilters.ts:17: import { getPriceParam } from "@/lib/search-params";
022893| NOTE: Imports dependency for this module.
022894| src/hooks/useBatchedFilters.ts:18: 
022895| NOTE: Blank line for visual separation.
022896| src/hooks/useBatchedFilters.ts:19: export interface BatchedFilterValues {
022897| NOTE: Implementation detail supporting search page behavior.
022898| src/hooks/useBatchedFilters.ts:20:   minPrice: string;
022899| NOTE: Implementation detail supporting search page behavior.
022900| src/hooks/useBatchedFilters.ts:21:   maxPrice: string;
022901| NOTE: Implementation detail supporting search page behavior.
022902| src/hooks/useBatchedFilters.ts:22:   amenities: string[];
022903| NOTE: Implementation detail supporting search page behavior.
022904| src/hooks/useBatchedFilters.ts:23:   houseRules: string[];
022905| NOTE: Implementation detail supporting search page behavior.
022906| src/hooks/useBatchedFilters.ts:24:   languages: string[];
022907| NOTE: Implementation detail supporting search page behavior.
022908| src/hooks/useBatchedFilters.ts:25:   roomType: string;
022909| NOTE: Implementation detail supporting search page behavior.
022910| src/hooks/useBatchedFilters.ts:26:   leaseDuration: string;
022911| NOTE: Implementation detail supporting search page behavior.
022912| src/hooks/useBatchedFilters.ts:27:   moveInDate: string;
022913| NOTE: Implementation detail supporting search page behavior.
022914| src/hooks/useBatchedFilters.ts:28: }
022915| NOTE: Implementation detail supporting search page behavior.
022916| src/hooks/useBatchedFilters.ts:29: 
022917| NOTE: Blank line for visual separation.
022918| src/hooks/useBatchedFilters.ts:30: export interface UseBatchedFiltersReturn {
022919| NOTE: Implementation detail supporting search page behavior.
022920| src/hooks/useBatchedFilters.ts:31:   /** Current pending state (local, not yet applied) */
022921| NOTE: Block comment line describing behavior or context.
022922| src/hooks/useBatchedFilters.ts:32:   pending: BatchedFilterValues;
022923| NOTE: Implementation detail supporting search page behavior.
022924| src/hooks/useBatchedFilters.ts:33:   /** Committed state (what's currently in the URL) */
022925| NOTE: Block comment line describing behavior or context.
022926| src/hooks/useBatchedFilters.ts:34:   committed: BatchedFilterValues;
022927| NOTE: Implementation detail supporting search page behavior.
022928| src/hooks/useBatchedFilters.ts:35:   /** Whether pending differs from committed */
022929| NOTE: Block comment line describing behavior or context.
022930| src/hooks/useBatchedFilters.ts:36:   isDirty: boolean;
022931| NOTE: Implementation detail supporting search page behavior.
022932| src/hooks/useBatchedFilters.ts:37:   /** Number of fields that have changed */
022933| NOTE: Block comment line describing behavior or context.
022934| src/hooks/useBatchedFilters.ts:38:   changeCount: number;
022935| NOTE: Implementation detail supporting search page behavior.
022936| src/hooks/useBatchedFilters.ts:39:   /** Apply pending changes (triggers URL update) */
022937| NOTE: Block comment line describing behavior or context.
022938| src/hooks/useBatchedFilters.ts:40:   apply: () => BatchedFilterValues;
022939| NOTE: Implementation detail supporting search page behavior.
022940| src/hooks/useBatchedFilters.ts:41:   /** Reset pending to match committed */
022941| NOTE: Block comment line describing behavior or context.
022942| src/hooks/useBatchedFilters.ts:42:   reset: () => void;
022943| NOTE: Implementation detail supporting search page behavior.
022944| src/hooks/useBatchedFilters.ts:43:   /** Update a specific field in pending state */
022945| NOTE: Block comment line describing behavior or context.
022946| src/hooks/useBatchedFilters.ts:44:   updateField: <K extends keyof BatchedFilterValues>(
022947| NOTE: Implementation detail supporting search page behavior.
022948| src/hooks/useBatchedFilters.ts:45:     field: K,
022949| NOTE: Implementation detail supporting search page behavior.
022950| src/hooks/useBatchedFilters.ts:46:     value: BatchedFilterValues[K],
022951| NOTE: Implementation detail supporting search page behavior.
022952| src/hooks/useBatchedFilters.ts:47:   ) => void;
022953| NOTE: Implementation detail supporting search page behavior.
022954| src/hooks/useBatchedFilters.ts:48:   /** Toggle an item in an array field (amenities, rules, languages) */
022955| NOTE: Block comment line describing behavior or context.
022956| src/hooks/useBatchedFilters.ts:49:   toggleArrayItem: (
022957| NOTE: Implementation detail supporting search page behavior.
022958| src/hooks/useBatchedFilters.ts:50:     field: "amenities" | "houseRules" | "languages",
022959| NOTE: Implementation detail supporting search page behavior.
022960| src/hooks/useBatchedFilters.ts:51:     item: string,
022961| NOTE: Implementation detail supporting search page behavior.
022962| src/hooks/useBatchedFilters.ts:52:   ) => void;
022963| NOTE: Implementation detail supporting search page behavior.
022964| src/hooks/useBatchedFilters.ts:53: }
022965| NOTE: Implementation detail supporting search page behavior.
022966| src/hooks/useBatchedFilters.ts:54: 
022967| NOTE: Blank line for visual separation.
022968| src/hooks/useBatchedFilters.ts:55: // Helper to parse array params from URL
022969| NOTE: Line comment documents intent or constraints.
022970| src/hooks/useBatchedFilters.ts:56: function parseArrayParam(searchParams: URLSearchParams, key: string): string[] {
022971| NOTE: Defines a helper or component function.
022972| src/hooks/useBatchedFilters.ts:57:   const values = searchParams.getAll(key);
022973| NOTE: Local declaration used by search logic or UI.
022974| src/hooks/useBatchedFilters.ts:58:   if (values.length === 0) return [];
022975| NOTE: Conditional logic controlling rendering or flow.
022976| src/hooks/useBatchedFilters.ts:59:   return values
022977| NOTE: Return statement for component or helper output.
022978| src/hooks/useBatchedFilters.ts:60:     .flatMap((value) => value.split(","))
022979| NOTE: Implementation detail supporting search page behavior.
022980| src/hooks/useBatchedFilters.ts:61:     .map((value) => value.trim())
022981| NOTE: Implementation detail supporting search page behavior.
022982| src/hooks/useBatchedFilters.ts:62:     .filter(Boolean);
022983| NOTE: Implementation detail supporting search page behavior.
022984| src/hooks/useBatchedFilters.ts:63: }
022985| NOTE: Implementation detail supporting search page behavior.
022986| src/hooks/useBatchedFilters.ts:64: 
022987| NOTE: Blank line for visual separation.
022988| src/hooks/useBatchedFilters.ts:65: // Helper to get string param
022989| NOTE: Line comment documents intent or constraints.
022990| src/hooks/useBatchedFilters.ts:66: function getStringParam(searchParams: URLSearchParams, key: string): string {
022991| NOTE: Defines a helper or component function.
022992| src/hooks/useBatchedFilters.ts:67:   return searchParams.get(key)?.trim() || "";
022993| NOTE: Return statement for component or helper output.
022994| src/hooks/useBatchedFilters.ts:68: }
022995| NOTE: Implementation detail supporting search page behavior.
022996| src/hooks/useBatchedFilters.ts:69: 
022997| NOTE: Blank line for visual separation.
022998| src/hooks/useBatchedFilters.ts:70: // Helper to count differences between two filter states
022999| NOTE: Line comment documents intent or constraints.
023000| src/hooks/useBatchedFilters.ts:71: function countDifferences(
023001| NOTE: Defines a helper or component function.
023002| src/hooks/useBatchedFilters.ts:72:   a: BatchedFilterValues,
023003| NOTE: Implementation detail supporting search page behavior.
023004| src/hooks/useBatchedFilters.ts:73:   b: BatchedFilterValues,
023005| NOTE: Implementation detail supporting search page behavior.
023006| src/hooks/useBatchedFilters.ts:74: ): number {
023007| NOTE: Implementation detail supporting search page behavior.
023008| src/hooks/useBatchedFilters.ts:75:   let count = 0;
023009| NOTE: Local declaration used by search logic or UI.
023010| src/hooks/useBatchedFilters.ts:76: 
023011| NOTE: Blank line for visual separation.
023012| src/hooks/useBatchedFilters.ts:77:   // String fields
023013| NOTE: Line comment documents intent or constraints.
023014| src/hooks/useBatchedFilters.ts:78:   if (a.minPrice !== b.minPrice) count++;
023015| NOTE: Conditional logic controlling rendering or flow.
023016| src/hooks/useBatchedFilters.ts:79:   if (a.maxPrice !== b.maxPrice) count++;
023017| NOTE: Conditional logic controlling rendering or flow.
023018| src/hooks/useBatchedFilters.ts:80:   if (a.roomType !== b.roomType) count++;
023019| NOTE: Conditional logic controlling rendering or flow.
023020| src/hooks/useBatchedFilters.ts:81:   if (a.leaseDuration !== b.leaseDuration) count++;
023021| NOTE: Conditional logic controlling rendering or flow.
023022| src/hooks/useBatchedFilters.ts:82:   if (a.moveInDate !== b.moveInDate) count++;
023023| NOTE: Conditional logic controlling rendering or flow.
023024| src/hooks/useBatchedFilters.ts:83: 
023025| NOTE: Blank line for visual separation.
023026| src/hooks/useBatchedFilters.ts:84:   // Array fields - count as 1 change per array that differs
023027| NOTE: Line comment documents intent or constraints.
023028| src/hooks/useBatchedFilters.ts:85:   const arraysEqual = (arr1: string[], arr2: string[]) =>
023029| NOTE: Local declaration used by search logic or UI.
023030| src/hooks/useBatchedFilters.ts:86:     arr1.length === arr2.length && arr1.every((v, i) => v === arr2[i]);
023031| NOTE: Implementation detail supporting search page behavior.
023032| src/hooks/useBatchedFilters.ts:87: 
023033| NOTE: Blank line for visual separation.
023034| src/hooks/useBatchedFilters.ts:88:   if (!arraysEqual([...a.amenities].sort(), [...b.amenities].sort())) count++;
023035| NOTE: Conditional logic controlling rendering or flow.
023036| src/hooks/useBatchedFilters.ts:89:   if (!arraysEqual([...a.houseRules].sort(), [...b.houseRules].sort())) count++;
023037| NOTE: Conditional logic controlling rendering or flow.
023038| src/hooks/useBatchedFilters.ts:90:   if (!arraysEqual([...a.languages].sort(), [...b.languages].sort())) count++;
023039| NOTE: Conditional logic controlling rendering or flow.
023040| src/hooks/useBatchedFilters.ts:91: 
023041| NOTE: Blank line for visual separation.
023042| src/hooks/useBatchedFilters.ts:92:   return count;
023043| NOTE: Return statement for component or helper output.
023044| src/hooks/useBatchedFilters.ts:93: }
023045| NOTE: Implementation detail supporting search page behavior.
023046| src/hooks/useBatchedFilters.ts:94: 
023047| NOTE: Blank line for visual separation.
023048| src/hooks/useBatchedFilters.ts:95: // Check if two filter states are equal
023049| NOTE: Line comment documents intent or constraints.
023050| src/hooks/useBatchedFilters.ts:96: function areFiltersEqual(
023051| NOTE: Defines a helper or component function.
023052| src/hooks/useBatchedFilters.ts:97:   a: BatchedFilterValues,
023053| NOTE: Implementation detail supporting search page behavior.
023054| src/hooks/useBatchedFilters.ts:98:   b: BatchedFilterValues,
023055| NOTE: Implementation detail supporting search page behavior.
023056| src/hooks/useBatchedFilters.ts:99: ): boolean {
023057| NOTE: Implementation detail supporting search page behavior.
023058| src/hooks/useBatchedFilters.ts:100:   return countDifferences(a, b) === 0;
023059| NOTE: Return statement for component or helper output.
023060| src/hooks/useBatchedFilters.ts:101: }
023061| NOTE: Implementation detail supporting search page behavior.
023062| src/hooks/useBatchedFilters.ts:102: 
023063| NOTE: Blank line for visual separation.
023064| src/hooks/useBatchedFilters.ts:103: const DEFAULT_FILTERS: BatchedFilterValues = {
023065| NOTE: Local declaration used by search logic or UI.
023066| src/hooks/useBatchedFilters.ts:104:   minPrice: "",
023067| NOTE: Implementation detail supporting search page behavior.
023068| src/hooks/useBatchedFilters.ts:105:   maxPrice: "",
023069| NOTE: Implementation detail supporting search page behavior.
023070| src/hooks/useBatchedFilters.ts:106:   amenities: [],
023071| NOTE: Implementation detail supporting search page behavior.
023072| src/hooks/useBatchedFilters.ts:107:   houseRules: [],
023073| NOTE: Implementation detail supporting search page behavior.
023074| src/hooks/useBatchedFilters.ts:108:   languages: [],
023075| NOTE: Implementation detail supporting search page behavior.
023076| src/hooks/useBatchedFilters.ts:109:   roomType: "",
023077| NOTE: Implementation detail supporting search page behavior.
023078| src/hooks/useBatchedFilters.ts:110:   leaseDuration: "",
023079| NOTE: Implementation detail supporting search page behavior.
023080| src/hooks/useBatchedFilters.ts:111:   moveInDate: "",
023081| NOTE: Implementation detail supporting search page behavior.
023082| src/hooks/useBatchedFilters.ts:112: };
023083| NOTE: Implementation detail supporting search page behavior.
023084| src/hooks/useBatchedFilters.ts:113: 
023085| NOTE: Blank line for visual separation.
023086| src/hooks/useBatchedFilters.ts:114: export function useBatchedFilters(): UseBatchedFiltersReturn {
023087| NOTE: Exports helper or component function.
023088| src/hooks/useBatchedFilters.ts:115:   const searchParams = useSearchParams();
023089| NOTE: Local declaration used by search logic or UI.
023090| src/hooks/useBatchedFilters.ts:116: 
023091| NOTE: Blank line for visual separation.
023092| src/hooks/useBatchedFilters.ts:117:   // Use string representation for stable dependency (avoids infinite loops with unstable searchParams refs)
023093| NOTE: Line comment documents intent or constraints.
023094| src/hooks/useBatchedFilters.ts:118:   const searchParamsString = searchParams.toString();
023095| NOTE: Local declaration used by search logic or UI.
023096| src/hooks/useBatchedFilters.ts:119: 
023097| NOTE: Blank line for visual separation.
023098| src/hooks/useBatchedFilters.ts:120:   // Parse committed state from URL
023099| NOTE: Line comment documents intent or constraints.
023100| src/hooks/useBatchedFilters.ts:121:   // Use getPriceParam to support budget aliases (minBudget/maxBudget)
023101| NOTE: Line comment documents intent or constraints.
023102| src/hooks/useBatchedFilters.ts:122:   const committed = useMemo<BatchedFilterValues>(() => {
023103| NOTE: Memoizes derived values to reduce re-render work.
023104| src/hooks/useBatchedFilters.ts:123:     const params = new URLSearchParams(searchParamsString);
023105| NOTE: Local declaration used by search logic or UI.
023106| src/hooks/useBatchedFilters.ts:124:     return {
023107| NOTE: Return statement for component or helper output.
023108| src/hooks/useBatchedFilters.ts:125:       minPrice: getPriceParam(params, "min")?.trim() || "",
023109| NOTE: Implementation detail supporting search page behavior.
023110| src/hooks/useBatchedFilters.ts:126:       maxPrice: getPriceParam(params, "max")?.trim() || "",
023111| NOTE: Implementation detail supporting search page behavior.
023112| src/hooks/useBatchedFilters.ts:127:       amenities: parseArrayParam(params, "amenities"),
023113| NOTE: Implementation detail supporting search page behavior.
023114| src/hooks/useBatchedFilters.ts:128:       houseRules: parseArrayParam(params, "houseRules"),
023115| NOTE: Implementation detail supporting search page behavior.
023116| src/hooks/useBatchedFilters.ts:129:       languages: parseArrayParam(params, "languages"),
023117| NOTE: Implementation detail supporting search page behavior.
023118| src/hooks/useBatchedFilters.ts:130:       roomType: getStringParam(params, "roomType"),
023119| NOTE: Implementation detail supporting search page behavior.
023120| src/hooks/useBatchedFilters.ts:131:       leaseDuration: getStringParam(params, "leaseDuration"),
023121| NOTE: Implementation detail supporting search page behavior.
023122| src/hooks/useBatchedFilters.ts:132:       moveInDate: getStringParam(params, "moveInDate"),
023123| NOTE: Implementation detail supporting search page behavior.
023124| src/hooks/useBatchedFilters.ts:133:     };
023125| NOTE: Implementation detail supporting search page behavior.
023126| src/hooks/useBatchedFilters.ts:134:   }, [searchParamsString]);
023127| NOTE: Implementation detail supporting search page behavior.
023128| src/hooks/useBatchedFilters.ts:135: 
023129| NOTE: Blank line for visual separation.
023130| src/hooks/useBatchedFilters.ts:136:   // Pending state (local changes not yet applied)
023131| NOTE: Line comment documents intent or constraints.
023132| src/hooks/useBatchedFilters.ts:137:   const [pending, setPending] = useState<BatchedFilterValues>(committed);
023133| NOTE: Initializes local state for search UI behavior.
023134| src/hooks/useBatchedFilters.ts:138: 
023135| NOTE: Blank line for visual separation.
023136| src/hooks/useBatchedFilters.ts:139:   // Sync pending with committed when URL changes (e.g., external navigation)
023137| NOTE: Line comment documents intent or constraints.
023138| src/hooks/useBatchedFilters.ts:140:   // Use functional update to compare actual values, not object references
023139| NOTE: Line comment documents intent or constraints.
023140| src/hooks/useBatchedFilters.ts:141:   useEffect(() => {
023141| NOTE: Defines side effect for syncing with external state.
023142| src/hooks/useBatchedFilters.ts:142:     setPending((currentPending) => {
023143| NOTE: Implementation detail supporting search page behavior.
023144| src/hooks/useBatchedFilters.ts:143:       // Only update if values actually differ to prevent unnecessary re-renders
023145| NOTE: Line comment documents intent or constraints.
023146| src/hooks/useBatchedFilters.ts:144:       if (areFiltersEqual(currentPending, committed)) {
023147| NOTE: Conditional logic controlling rendering or flow.
023148| src/hooks/useBatchedFilters.ts:145:         return currentPending;
023149| NOTE: Return statement for component or helper output.
023150| src/hooks/useBatchedFilters.ts:146:       }
023151| NOTE: Implementation detail supporting search page behavior.
023152| src/hooks/useBatchedFilters.ts:147:       return committed;
023153| NOTE: Return statement for component or helper output.
023154| src/hooks/useBatchedFilters.ts:148:     });
023155| NOTE: Implementation detail supporting search page behavior.
023156| src/hooks/useBatchedFilters.ts:149:   }, [committed]);
023157| NOTE: Implementation detail supporting search page behavior.
023158| src/hooks/useBatchedFilters.ts:150: 
023159| NOTE: Blank line for visual separation.
023160| src/hooks/useBatchedFilters.ts:151:   // Calculate if dirty
023161| NOTE: Line comment documents intent or constraints.
023162| src/hooks/useBatchedFilters.ts:152:   const isDirty = useMemo(
023163| NOTE: Memoizes derived values to reduce re-render work.
023164| src/hooks/useBatchedFilters.ts:153:     () => !areFiltersEqual(pending, committed),
023165| NOTE: Implementation detail supporting search page behavior.
023166| src/hooks/useBatchedFilters.ts:154:     [pending, committed],
023167| NOTE: Implementation detail supporting search page behavior.
023168| src/hooks/useBatchedFilters.ts:155:   );
023169| NOTE: Implementation detail supporting search page behavior.
023170| src/hooks/useBatchedFilters.ts:156: 
023171| NOTE: Blank line for visual separation.
023172| src/hooks/useBatchedFilters.ts:157:   // Count changes
023173| NOTE: Line comment documents intent or constraints.
023174| src/hooks/useBatchedFilters.ts:158:   const changeCount = useMemo(
023175| NOTE: Memoizes derived values to reduce re-render work.
023176| src/hooks/useBatchedFilters.ts:159:     () => countDifferences(pending, committed),
023177| NOTE: Implementation detail supporting search page behavior.
023178| src/hooks/useBatchedFilters.ts:160:     [pending, committed],
023179| NOTE: Implementation detail supporting search page behavior.
023180| src/hooks/useBatchedFilters.ts:161:   );
023181| NOTE: Implementation detail supporting search page behavior.
023182| src/hooks/useBatchedFilters.ts:162: 
023183| NOTE: Blank line for visual separation.
023184| src/hooks/useBatchedFilters.ts:163:   // Update a single field
023185| NOTE: Line comment documents intent or constraints.
023186| src/hooks/useBatchedFilters.ts:164:   const updateField = useCallback(
023187| NOTE: Memoizes callback to preserve references across renders.
023188| src/hooks/useBatchedFilters.ts:165:     <K extends keyof BatchedFilterValues>(
023189| NOTE: JSX markup for search UI.
023190| src/hooks/useBatchedFilters.ts:166:       field: K,
023191| NOTE: Implementation detail supporting search page behavior.
023192| src/hooks/useBatchedFilters.ts:167:       value: BatchedFilterValues[K],
023193| NOTE: Implementation detail supporting search page behavior.
023194| src/hooks/useBatchedFilters.ts:168:     ) => {
023195| NOTE: Implementation detail supporting search page behavior.
023196| src/hooks/useBatchedFilters.ts:169:       setPending((prev) => ({
023197| NOTE: Implementation detail supporting search page behavior.
023198| src/hooks/useBatchedFilters.ts:170:         ...prev,
023199| NOTE: Implementation detail supporting search page behavior.
023200| src/hooks/useBatchedFilters.ts:171:         [field]: value,
023201| NOTE: Implementation detail supporting search page behavior.
023202| src/hooks/useBatchedFilters.ts:172:       }));
023203| NOTE: Implementation detail supporting search page behavior.
023204| src/hooks/useBatchedFilters.ts:173:     },
023205| NOTE: Implementation detail supporting search page behavior.
023206| src/hooks/useBatchedFilters.ts:174:     [],
023207| NOTE: Implementation detail supporting search page behavior.
023208| src/hooks/useBatchedFilters.ts:175:   );
023209| NOTE: Implementation detail supporting search page behavior.
023210| src/hooks/useBatchedFilters.ts:176: 
023211| NOTE: Blank line for visual separation.
023212| src/hooks/useBatchedFilters.ts:177:   // Toggle item in array field
023213| NOTE: Line comment documents intent or constraints.
023214| src/hooks/useBatchedFilters.ts:178:   const toggleArrayItem = useCallback(
023215| NOTE: Memoizes callback to preserve references across renders.
023216| src/hooks/useBatchedFilters.ts:179:     (field: "amenities" | "houseRules" | "languages", item: string) => {
023217| NOTE: Implementation detail supporting search page behavior.
023218| src/hooks/useBatchedFilters.ts:180:       setPending((prev) => {
023219| NOTE: Implementation detail supporting search page behavior.
023220| src/hooks/useBatchedFilters.ts:181:         const current = prev[field];
023221| NOTE: Local declaration used by search logic or UI.
023222| src/hooks/useBatchedFilters.ts:182:         const updated = current.includes(item)
023223| NOTE: Local declaration used by search logic or UI.
023224| src/hooks/useBatchedFilters.ts:183:           ? current.filter((i) => i !== item)
023225| NOTE: Implementation detail supporting search page behavior.
023226| src/hooks/useBatchedFilters.ts:184:           : [...current, item];
023227| NOTE: Implementation detail supporting search page behavior.
023228| src/hooks/useBatchedFilters.ts:185:         return {
023229| NOTE: Return statement for component or helper output.
023230| src/hooks/useBatchedFilters.ts:186:           ...prev,
023231| NOTE: Implementation detail supporting search page behavior.
023232| src/hooks/useBatchedFilters.ts:187:           [field]: updated,
023233| NOTE: Implementation detail supporting search page behavior.
023234| src/hooks/useBatchedFilters.ts:188:         };
023235| NOTE: Implementation detail supporting search page behavior.
023236| src/hooks/useBatchedFilters.ts:189:       });
023237| NOTE: Implementation detail supporting search page behavior.
023238| src/hooks/useBatchedFilters.ts:190:     },
023239| NOTE: Implementation detail supporting search page behavior.
023240| src/hooks/useBatchedFilters.ts:191:     [],
023241| NOTE: Implementation detail supporting search page behavior.
023242| src/hooks/useBatchedFilters.ts:192:   );
023243| NOTE: Implementation detail supporting search page behavior.
023244| src/hooks/useBatchedFilters.ts:193: 
023245| NOTE: Blank line for visual separation.
023246| src/hooks/useBatchedFilters.ts:194:   // Apply pending changes - returns the values for the caller to use
023247| NOTE: Line comment documents intent or constraints.
023248| src/hooks/useBatchedFilters.ts:195:   const apply = useCallback(() => {
023249| NOTE: Memoizes callback to preserve references across renders.
023250| src/hooks/useBatchedFilters.ts:196:     // Return the pending values so caller can construct URL
023251| NOTE: Line comment documents intent or constraints.
023252| src/hooks/useBatchedFilters.ts:197:     return { ...pending };
023253| NOTE: Return statement for component or helper output.
023254| src/hooks/useBatchedFilters.ts:198:   }, [pending]);
023255| NOTE: Implementation detail supporting search page behavior.
023256| src/hooks/useBatchedFilters.ts:199: 
023257| NOTE: Blank line for visual separation.
023258| src/hooks/useBatchedFilters.ts:200:   // Reset pending to committed
023259| NOTE: Line comment documents intent or constraints.
023260| src/hooks/useBatchedFilters.ts:201:   const reset = useCallback(() => {
023261| NOTE: Memoizes callback to preserve references across renders.
023262| src/hooks/useBatchedFilters.ts:202:     setPending(committed);
023263| NOTE: Implementation detail supporting search page behavior.
023264| src/hooks/useBatchedFilters.ts:203:   }, [committed]);
023265| NOTE: Implementation detail supporting search page behavior.
023266| src/hooks/useBatchedFilters.ts:204: 
023267| NOTE: Blank line for visual separation.
023268| src/hooks/useBatchedFilters.ts:205:   return {
023269| NOTE: Return statement for component or helper output.
023270| src/hooks/useBatchedFilters.ts:206:     pending,
023271| NOTE: Implementation detail supporting search page behavior.
023272| src/hooks/useBatchedFilters.ts:207:     committed,
023273| NOTE: Implementation detail supporting search page behavior.
023274| src/hooks/useBatchedFilters.ts:208:     isDirty,
023275| NOTE: Implementation detail supporting search page behavior.
023276| src/hooks/useBatchedFilters.ts:209:     changeCount,
023277| NOTE: Implementation detail supporting search page behavior.
023278| src/hooks/useBatchedFilters.ts:210:     apply,
023279| NOTE: Implementation detail supporting search page behavior.
023280| src/hooks/useBatchedFilters.ts:211:     reset,
023281| NOTE: Implementation detail supporting search page behavior.
023282| src/hooks/useBatchedFilters.ts:212:     updateField,
023283| NOTE: Implementation detail supporting search page behavior.
023284| src/hooks/useBatchedFilters.ts:213:     toggleArrayItem,
023285| NOTE: Implementation detail supporting search page behavior.
023286| src/hooks/useBatchedFilters.ts:214:   };
023287| NOTE: Implementation detail supporting search page behavior.
023288| src/hooks/useBatchedFilters.ts:215: }
023289| NOTE: Implementation detail supporting search page behavior.
023290| FILE END: src/hooks/useBatchedFilters.ts
023291| 
023292| FILE START: src/hooks/useDebouncedFilterCount.ts
023293| FILE ROLE: Auto-discovered dependency in search page graph.
023294| src/hooks/useDebouncedFilterCount.ts:1: "use client";
023295| NOTE: Implementation detail supporting search page behavior.
023296| src/hooks/useDebouncedFilterCount.ts:2: 
023297| NOTE: Blank line for visual separation.
023298| src/hooks/useDebouncedFilterCount.ts:3: /**
023299| NOTE: Block comment line describing behavior or context.
023300| src/hooks/useDebouncedFilterCount.ts:4:  * useDebouncedFilterCount - Debounced listing count fetcher
023301| NOTE: Block comment line describing behavior or context.
023302| src/hooks/useDebouncedFilterCount.ts:5:  *
023303| NOTE: Block comment line describing behavior or context.
023304| src/hooks/useDebouncedFilterCount.ts:6:  * Fetches listing counts from the /api/search-count endpoint
023305| NOTE: Block comment line describing behavior or context.
023306| src/hooks/useDebouncedFilterCount.ts:7:  * with debouncing, caching, and abort handling for the
023307| NOTE: Block comment line describing behavior or context.
023308| src/hooks/useDebouncedFilterCount.ts:8:  * filter drawer "Show X listings" button.
023309| NOTE: Block comment line describing behavior or context.
023310| src/hooks/useDebouncedFilterCount.ts:9:  *
023311| NOTE: Block comment line describing behavior or context.
023312| src/hooks/useDebouncedFilterCount.ts:10:  * Key behaviors:
023313| NOTE: Block comment line describing behavior or context.
023314| src/hooks/useDebouncedFilterCount.ts:11:  * - Only fetches when drawer is open AND filters are dirty
023315| NOTE: Block comment line describing behavior or context.
023316| src/hooks/useDebouncedFilterCount.ts:12:  * - Debounces requests by 300ms to avoid excessive API calls
023317| NOTE: Block comment line describing behavior or context.
023318| src/hooks/useDebouncedFilterCount.ts:13:  * - Cancels in-flight requests when filters change
023319| NOTE: Block comment line describing behavior or context.
023320| src/hooks/useDebouncedFilterCount.ts:14:  * - Caches results with 30s TTL to avoid redundant fetches
023321| NOTE: Block comment line describing behavior or context.
023322| src/hooks/useDebouncedFilterCount.ts:15:  * - Uses current URL bounds (committed), not pending map bounds
023323| NOTE: Block comment line describing behavior or context.
023324| src/hooks/useDebouncedFilterCount.ts:16:  */
023325| NOTE: Block comment line describing behavior or context.
023326| src/hooks/useDebouncedFilterCount.ts:17: 
023327| NOTE: Blank line for visual separation.
023328| src/hooks/useDebouncedFilterCount.ts:18: import { useState, useEffect, useRef, useCallback, useMemo } from "react";
023329| NOTE: Imports dependency for this module.
023330| src/hooks/useDebouncedFilterCount.ts:19: import { useSearchParams } from "next/navigation";
023331| NOTE: Imports dependency for this module.
023332| src/hooks/useDebouncedFilterCount.ts:20: import type { BatchedFilterValues } from "./useBatchedFilters";
023333| NOTE: Imports dependency for this module.
023334| src/hooks/useDebouncedFilterCount.ts:21: 
023335| NOTE: Blank line for visual separation.
023336| src/hooks/useDebouncedFilterCount.ts:22: // Cache entry with expiration
023337| NOTE: Line comment documents intent or constraints.
023338| src/hooks/useDebouncedFilterCount.ts:23: interface CacheEntry {
023339| NOTE: Type declaration for search data contracts.
023340| src/hooks/useDebouncedFilterCount.ts:24:   count: number | null;
023341| NOTE: Implementation detail supporting search page behavior.
023342| src/hooks/useDebouncedFilterCount.ts:25:   expiresAt: number;
023343| NOTE: Implementation detail supporting search page behavior.
023344| src/hooks/useDebouncedFilterCount.ts:26: }
023345| NOTE: Implementation detail supporting search page behavior.
023346| src/hooks/useDebouncedFilterCount.ts:27: 
023347| NOTE: Blank line for visual separation.
023348| src/hooks/useDebouncedFilterCount.ts:28: // Simple in-memory cache with TTL
023349| NOTE: Line comment documents intent or constraints.
023350| src/hooks/useDebouncedFilterCount.ts:29: const countCache = new Map<string, CacheEntry>();
023351| NOTE: Local declaration used by search logic or UI.
023352| src/hooks/useDebouncedFilterCount.ts:30: const CACHE_TTL_MS = 30_000; // 30 seconds
023353| NOTE: Local declaration used by search logic or UI.
023354| src/hooks/useDebouncedFilterCount.ts:31: 
023355| NOTE: Blank line for visual separation.
023356| src/hooks/useDebouncedFilterCount.ts:32: // Debounce delay
023357| NOTE: Line comment documents intent or constraints.
023358| src/hooks/useDebouncedFilterCount.ts:33: const DEBOUNCE_MS = 300;
023359| NOTE: Local declaration used by search logic or UI.
023360| src/hooks/useDebouncedFilterCount.ts:34: 
023361| NOTE: Blank line for visual separation.
023362| src/hooks/useDebouncedFilterCount.ts:35: export interface UseDebouncedFilterCountOptions {
023363| NOTE: Implementation detail supporting search page behavior.
023364| src/hooks/useDebouncedFilterCount.ts:36:   /** Pending filter values (not yet applied) */
023365| NOTE: Block comment line describing behavior or context.
023366| src/hooks/useDebouncedFilterCount.ts:37:   pending: BatchedFilterValues;
023367| NOTE: Implementation detail supporting search page behavior.
023368| src/hooks/useDebouncedFilterCount.ts:38:   /** Whether filters have changed from URL */
023369| NOTE: Block comment line describing behavior or context.
023370| src/hooks/useDebouncedFilterCount.ts:39:   isDirty: boolean;
023371| NOTE: Implementation detail supporting search page behavior.
023372| src/hooks/useDebouncedFilterCount.ts:40:   /** Whether the filter drawer is open */
023373| NOTE: Block comment line describing behavior or context.
023374| src/hooks/useDebouncedFilterCount.ts:41:   isDrawerOpen: boolean;
023375| NOTE: Implementation detail supporting search page behavior.
023376| src/hooks/useDebouncedFilterCount.ts:42: }
023377| NOTE: Implementation detail supporting search page behavior.
023378| src/hooks/useDebouncedFilterCount.ts:43: 
023379| NOTE: Blank line for visual separation.
023380| src/hooks/useDebouncedFilterCount.ts:44: export interface UseDebouncedFilterCountReturn {
023381| NOTE: Implementation detail supporting search page behavior.
023382| src/hooks/useDebouncedFilterCount.ts:45:   /** The count of matching listings (null = 100+) */
023383| NOTE: Block comment line describing behavior or context.
023384| src/hooks/useDebouncedFilterCount.ts:46:   count: number | null;
023385| NOTE: Implementation detail supporting search page behavior.
023386| src/hooks/useDebouncedFilterCount.ts:47:   /** Previous count before current loading (for optimistic UI) */
023387| NOTE: Block comment line describing behavior or context.
023388| src/hooks/useDebouncedFilterCount.ts:48:   previousCount: number | null;
023389| NOTE: Implementation detail supporting search page behavior.
023390| src/hooks/useDebouncedFilterCount.ts:49:   /** Baseline count from committed filters (for delta calculation) */
023391| NOTE: Block comment line describing behavior or context.
023392| src/hooks/useDebouncedFilterCount.ts:50:   baselineCount: number | null;
023393| NOTE: Implementation detail supporting search page behavior.
023394| src/hooks/useDebouncedFilterCount.ts:51:   /** Whether a count request is in progress */
023395| NOTE: Block comment line describing behavior or context.
023396| src/hooks/useDebouncedFilterCount.ts:52:   isLoading: boolean;
023397| NOTE: Implementation detail supporting search page behavior.
023398| src/hooks/useDebouncedFilterCount.ts:53:   /** Human-readable count string for button */
023399| NOTE: Block comment line describing behavior or context.
023400| src/hooks/useDebouncedFilterCount.ts:54:   formattedCount: string;
023401| NOTE: Implementation detail supporting search page behavior.
023402| src/hooks/useDebouncedFilterCount.ts:55: }
023403| NOTE: Implementation detail supporting search page behavior.
023404| src/hooks/useDebouncedFilterCount.ts:56: 
023405| NOTE: Blank line for visual separation.
023406| src/hooks/useDebouncedFilterCount.ts:57: /**
023407| NOTE: Block comment line describing behavior or context.
023408| src/hooks/useDebouncedFilterCount.ts:58:  * Generate cache key from filter params and URL bounds
023409| NOTE: Block comment line describing behavior or context.
023410| src/hooks/useDebouncedFilterCount.ts:59:  */
023411| NOTE: Block comment line describing behavior or context.
023412| src/hooks/useDebouncedFilterCount.ts:60: function generateCacheKey(
023413| NOTE: Defines a helper or component function.
023414| src/hooks/useDebouncedFilterCount.ts:61:   pending: BatchedFilterValues,
023415| NOTE: Implementation detail supporting search page behavior.
023416| src/hooks/useDebouncedFilterCount.ts:62:   searchParams: URLSearchParams,
023417| NOTE: Implementation detail supporting search page behavior.
023418| src/hooks/useDebouncedFilterCount.ts:63: ): string {
023419| NOTE: Implementation detail supporting search page behavior.
023420| src/hooks/useDebouncedFilterCount.ts:64:   // Build key from pending filters
023421| NOTE: Line comment documents intent or constraints.
023422| src/hooks/useDebouncedFilterCount.ts:65:   const filterParts = [
023423| NOTE: Local declaration used by search logic or UI.
023424| src/hooks/useDebouncedFilterCount.ts:66:     `minPrice=${pending.minPrice}`,
023425| NOTE: Implementation detail supporting search page behavior.
023426| src/hooks/useDebouncedFilterCount.ts:67:     `maxPrice=${pending.maxPrice}`,
023427| NOTE: Implementation detail supporting search page behavior.
023428| src/hooks/useDebouncedFilterCount.ts:68:     `roomType=${pending.roomType}`,
023429| NOTE: Implementation detail supporting search page behavior.
023430| src/hooks/useDebouncedFilterCount.ts:69:     `leaseDuration=${pending.leaseDuration}`,
023431| NOTE: Implementation detail supporting search page behavior.
023432| src/hooks/useDebouncedFilterCount.ts:70:     `moveInDate=${pending.moveInDate}`,
023433| NOTE: Implementation detail supporting search page behavior.
023434| src/hooks/useDebouncedFilterCount.ts:71:     `amenities=${[...pending.amenities].sort().join(",")}`,
023435| NOTE: Implementation detail supporting search page behavior.
023436| src/hooks/useDebouncedFilterCount.ts:72:     `houseRules=${[...pending.houseRules].sort().join(",")}`,
023437| NOTE: Implementation detail supporting search page behavior.
023438| src/hooks/useDebouncedFilterCount.ts:73:     `languages=${[...pending.languages].sort().join(",")}`,
023439| NOTE: Implementation detail supporting search page behavior.
023440| src/hooks/useDebouncedFilterCount.ts:74:   ];
023441| NOTE: Implementation detail supporting search page behavior.
023442| src/hooks/useDebouncedFilterCount.ts:75: 
023443| NOTE: Blank line for visual separation.
023444| src/hooks/useDebouncedFilterCount.ts:76:   // Add committed bounds from URL (these don't change with pending filters)
023445| NOTE: Line comment documents intent or constraints.
023446| src/hooks/useDebouncedFilterCount.ts:77:   const boundsParts = [
023447| NOTE: Local declaration used by search logic or UI.
023448| src/hooks/useDebouncedFilterCount.ts:78:     `minLat=${searchParams.get("minLat") || ""}`,
023449| NOTE: Implementation detail supporting search page behavior.
023450| src/hooks/useDebouncedFilterCount.ts:79:     `maxLat=${searchParams.get("maxLat") || ""}`,
023451| NOTE: Implementation detail supporting search page behavior.
023452| src/hooks/useDebouncedFilterCount.ts:80:     `minLng=${searchParams.get("minLng") || ""}`,
023453| NOTE: Implementation detail supporting search page behavior.
023454| src/hooks/useDebouncedFilterCount.ts:81:     `maxLng=${searchParams.get("maxLng") || ""}`,
023455| NOTE: Implementation detail supporting search page behavior.
023456| src/hooks/useDebouncedFilterCount.ts:82:     `lat=${searchParams.get("lat") || ""}`,
023457| NOTE: Implementation detail supporting search page behavior.
023458| src/hooks/useDebouncedFilterCount.ts:83:     `lng=${searchParams.get("lng") || ""}`,
023459| NOTE: Implementation detail supporting search page behavior.
023460| src/hooks/useDebouncedFilterCount.ts:84:     `q=${searchParams.get("q") || ""}`,
023461| NOTE: Implementation detail supporting search page behavior.
023462| src/hooks/useDebouncedFilterCount.ts:85:   ];
023463| NOTE: Implementation detail supporting search page behavior.
023464| src/hooks/useDebouncedFilterCount.ts:86: 
023465| NOTE: Blank line for visual separation.
023466| src/hooks/useDebouncedFilterCount.ts:87:   return [...filterParts, ...boundsParts].join("&");
023467| NOTE: Return statement for component or helper output.
023468| src/hooks/useDebouncedFilterCount.ts:88: }
023469| NOTE: Implementation detail supporting search page behavior.
023470| src/hooks/useDebouncedFilterCount.ts:89: 
023471| NOTE: Blank line for visual separation.
023472| src/hooks/useDebouncedFilterCount.ts:90: /**
023473| NOTE: Block comment line describing behavior or context.
023474| src/hooks/useDebouncedFilterCount.ts:91:  * Build URL search params for count request
023475| NOTE: Block comment line describing behavior or context.
023476| src/hooks/useDebouncedFilterCount.ts:92:  */
023477| NOTE: Block comment line describing behavior or context.
023478| src/hooks/useDebouncedFilterCount.ts:93: function buildCountUrl(
023479| NOTE: Defines a helper or component function.
023480| src/hooks/useDebouncedFilterCount.ts:94:   pending: BatchedFilterValues,
023481| NOTE: Implementation detail supporting search page behavior.
023482| src/hooks/useDebouncedFilterCount.ts:95:   searchParams: URLSearchParams,
023483| NOTE: Implementation detail supporting search page behavior.
023484| src/hooks/useDebouncedFilterCount.ts:96: ): string {
023485| NOTE: Implementation detail supporting search page behavior.
023486| src/hooks/useDebouncedFilterCount.ts:97:   const params = new URLSearchParams();
023487| NOTE: Local declaration used by search logic or UI.
023488| src/hooks/useDebouncedFilterCount.ts:98: 
023489| NOTE: Blank line for visual separation.
023490| src/hooks/useDebouncedFilterCount.ts:99:   // Add pending filter values
023491| NOTE: Line comment documents intent or constraints.
023492| src/hooks/useDebouncedFilterCount.ts:100:   if (pending.minPrice) params.set("minPrice", pending.minPrice);
023493| NOTE: Conditional logic controlling rendering or flow.
023494| src/hooks/useDebouncedFilterCount.ts:101:   if (pending.maxPrice) params.set("maxPrice", pending.maxPrice);
023495| NOTE: Conditional logic controlling rendering or flow.
023496| src/hooks/useDebouncedFilterCount.ts:102:   if (pending.roomType) params.set("roomType", pending.roomType);
023497| NOTE: Conditional logic controlling rendering or flow.
023498| src/hooks/useDebouncedFilterCount.ts:103:   if (pending.leaseDuration) params.set("leaseDuration", pending.leaseDuration);
023499| NOTE: Conditional logic controlling rendering or flow.
023500| src/hooks/useDebouncedFilterCount.ts:104:   if (pending.moveInDate) params.set("moveInDate", pending.moveInDate);
023501| NOTE: Conditional logic controlling rendering or flow.
023502| src/hooks/useDebouncedFilterCount.ts:105:   if (pending.amenities.length > 0) {
023503| NOTE: Conditional logic controlling rendering or flow.
023504| src/hooks/useDebouncedFilterCount.ts:106:     params.set("amenities", pending.amenities.join(","));
023505| NOTE: Implementation detail supporting search page behavior.
023506| src/hooks/useDebouncedFilterCount.ts:107:   }
023507| NOTE: Implementation detail supporting search page behavior.
023508| src/hooks/useDebouncedFilterCount.ts:108:   if (pending.houseRules.length > 0) {
023509| NOTE: Conditional logic controlling rendering or flow.
023510| src/hooks/useDebouncedFilterCount.ts:109:     params.set("houseRules", pending.houseRules.join(","));
023511| NOTE: Implementation detail supporting search page behavior.
023512| src/hooks/useDebouncedFilterCount.ts:110:   }
023513| NOTE: Implementation detail supporting search page behavior.
023514| src/hooks/useDebouncedFilterCount.ts:111:   if (pending.languages.length > 0) {
023515| NOTE: Conditional logic controlling rendering or flow.
023516| src/hooks/useDebouncedFilterCount.ts:112:     params.set("languages", pending.languages.join(","));
023517| NOTE: Implementation detail supporting search page behavior.
023518| src/hooks/useDebouncedFilterCount.ts:113:   }
023519| NOTE: Implementation detail supporting search page behavior.
023520| src/hooks/useDebouncedFilterCount.ts:114: 
023521| NOTE: Blank line for visual separation.
023522| src/hooks/useDebouncedFilterCount.ts:115:   // Add committed location/bounds from URL
023523| NOTE: Line comment documents intent or constraints.
023524| src/hooks/useDebouncedFilterCount.ts:116:   const locationParams = [
023525| NOTE: Local declaration used by search logic or UI.
023526| src/hooks/useDebouncedFilterCount.ts:117:     "q",
023527| NOTE: Implementation detail supporting search page behavior.
023528| src/hooks/useDebouncedFilterCount.ts:118:     "lat",
023529| NOTE: Implementation detail supporting search page behavior.
023530| src/hooks/useDebouncedFilterCount.ts:119:     "lng",
023531| NOTE: Implementation detail supporting search page behavior.
023532| src/hooks/useDebouncedFilterCount.ts:120:     "minLat",
023533| NOTE: Implementation detail supporting search page behavior.
023534| src/hooks/useDebouncedFilterCount.ts:121:     "maxLat",
023535| NOTE: Implementation detail supporting search page behavior.
023536| src/hooks/useDebouncedFilterCount.ts:122:     "minLng",
023537| NOTE: Implementation detail supporting search page behavior.
023538| src/hooks/useDebouncedFilterCount.ts:123:     "maxLng",
023539| NOTE: Implementation detail supporting search page behavior.
023540| src/hooks/useDebouncedFilterCount.ts:124:   ];
023541| NOTE: Implementation detail supporting search page behavior.
023542| src/hooks/useDebouncedFilterCount.ts:125:   for (const key of locationParams) {
023543| NOTE: Implementation detail supporting search page behavior.
023544| src/hooks/useDebouncedFilterCount.ts:126:     const value = searchParams.get(key);
023545| NOTE: Local declaration used by search logic or UI.
023546| src/hooks/useDebouncedFilterCount.ts:127:     if (value) params.set(key, value);
023547| NOTE: Conditional logic controlling rendering or flow.
023548| src/hooks/useDebouncedFilterCount.ts:128:   }
023549| NOTE: Implementation detail supporting search page behavior.
023550| src/hooks/useDebouncedFilterCount.ts:129: 
023551| NOTE: Blank line for visual separation.
023552| src/hooks/useDebouncedFilterCount.ts:130:   return `/api/search-count?${params.toString()}`;
023553| NOTE: Return statement for component or helper output.
023554| src/hooks/useDebouncedFilterCount.ts:131: }
023555| NOTE: Implementation detail supporting search page behavior.
023556| src/hooks/useDebouncedFilterCount.ts:132: 
023557| NOTE: Blank line for visual separation.
023558| src/hooks/useDebouncedFilterCount.ts:133: /**
023559| NOTE: Block comment line describing behavior or context.
023560| src/hooks/useDebouncedFilterCount.ts:134:  * Get cached count if valid
023561| NOTE: Block comment line describing behavior or context.
023562| src/hooks/useDebouncedFilterCount.ts:135:  */
023563| NOTE: Block comment line describing behavior or context.
023564| src/hooks/useDebouncedFilterCount.ts:136: function getCachedCount(cacheKey: string): number | null | undefined {
023565| NOTE: Defines a helper or component function.
023566| src/hooks/useDebouncedFilterCount.ts:137:   const entry = countCache.get(cacheKey);
023567| NOTE: Local declaration used by search logic or UI.
023568| src/hooks/useDebouncedFilterCount.ts:138:   if (!entry) return undefined;
023569| NOTE: Conditional logic controlling rendering or flow.
023570| src/hooks/useDebouncedFilterCount.ts:139: 
023571| NOTE: Blank line for visual separation.
023572| src/hooks/useDebouncedFilterCount.ts:140:   if (Date.now() > entry.expiresAt) {
023573| NOTE: Conditional logic controlling rendering or flow.
023574| src/hooks/useDebouncedFilterCount.ts:141:     countCache.delete(cacheKey);
023575| NOTE: Implementation detail supporting search page behavior.
023576| src/hooks/useDebouncedFilterCount.ts:142:     return undefined;
023577| NOTE: Return statement for component or helper output.
023578| src/hooks/useDebouncedFilterCount.ts:143:   }
023579| NOTE: Implementation detail supporting search page behavior.
023580| src/hooks/useDebouncedFilterCount.ts:144: 
023581| NOTE: Blank line for visual separation.
023582| src/hooks/useDebouncedFilterCount.ts:145:   return entry.count;
023583| NOTE: Return statement for component or helper output.
023584| src/hooks/useDebouncedFilterCount.ts:146: }
023585| NOTE: Implementation detail supporting search page behavior.
023586| src/hooks/useDebouncedFilterCount.ts:147: 
023587| NOTE: Blank line for visual separation.
023588| src/hooks/useDebouncedFilterCount.ts:148: /**
023589| NOTE: Block comment line describing behavior or context.
023590| src/hooks/useDebouncedFilterCount.ts:149:  * Set cached count
023591| NOTE: Block comment line describing behavior or context.
023592| src/hooks/useDebouncedFilterCount.ts:150:  */
023593| NOTE: Block comment line describing behavior or context.
023594| src/hooks/useDebouncedFilterCount.ts:151: function setCachedCount(cacheKey: string, count: number | null): void {
023595| NOTE: Defines a helper or component function.
023596| src/hooks/useDebouncedFilterCount.ts:152:   countCache.set(cacheKey, {
023597| NOTE: Implementation detail supporting search page behavior.
023598| src/hooks/useDebouncedFilterCount.ts:153:     count,
023599| NOTE: Implementation detail supporting search page behavior.
023600| src/hooks/useDebouncedFilterCount.ts:154:     expiresAt: Date.now() + CACHE_TTL_MS,
023601| NOTE: Implementation detail supporting search page behavior.
023602| src/hooks/useDebouncedFilterCount.ts:155:   });
023603| NOTE: Implementation detail supporting search page behavior.
023604| src/hooks/useDebouncedFilterCount.ts:156: }
023605| NOTE: Implementation detail supporting search page behavior.
023606| src/hooks/useDebouncedFilterCount.ts:157: 
023607| NOTE: Blank line for visual separation.
023608| src/hooks/useDebouncedFilterCount.ts:158: export function useDebouncedFilterCount({
023609| NOTE: Exports helper or component function.
023610| src/hooks/useDebouncedFilterCount.ts:159:   pending,
023611| NOTE: Implementation detail supporting search page behavior.
023612| src/hooks/useDebouncedFilterCount.ts:160:   isDirty,
023613| NOTE: Implementation detail supporting search page behavior.
023614| src/hooks/useDebouncedFilterCount.ts:161:   isDrawerOpen,
023615| NOTE: Implementation detail supporting search page behavior.
023616| src/hooks/useDebouncedFilterCount.ts:162: }: UseDebouncedFilterCountOptions): UseDebouncedFilterCountReturn {
023617| NOTE: Implementation detail supporting search page behavior.
023618| src/hooks/useDebouncedFilterCount.ts:163:   const searchParams = useSearchParams();
023619| NOTE: Local declaration used by search logic or UI.
023620| src/hooks/useDebouncedFilterCount.ts:164:   const [count, setCount] = useState<number | null>(null);
023621| NOTE: Initializes local state for search UI behavior.
023622| src/hooks/useDebouncedFilterCount.ts:165:   const [previousCount, setPreviousCount] = useState<number | null>(null);
023623| NOTE: Initializes local state for search UI behavior.
023624| src/hooks/useDebouncedFilterCount.ts:166:   const [baselineCount, setBaselineCount] = useState<number | null>(null);
023625| NOTE: Initializes local state for search UI behavior.
023626| src/hooks/useDebouncedFilterCount.ts:167:   const [isLoading, setIsLoading] = useState(false);
023627| NOTE: Initializes local state for search UI behavior.
023628| src/hooks/useDebouncedFilterCount.ts:168: 
023629| NOTE: Blank line for visual separation.
023630| src/hooks/useDebouncedFilterCount.ts:169:   // Track if we've captured the baseline for this drawer session
023631| NOTE: Line comment documents intent or constraints.
023632| src/hooks/useDebouncedFilterCount.ts:170:   const baselineCapturedRef = useRef(false);
023633| NOTE: Uses ref for stable mutable storage between renders.
023634| src/hooks/useDebouncedFilterCount.ts:171: 
023635| NOTE: Blank line for visual separation.
023636| src/hooks/useDebouncedFilterCount.ts:172:   // Refs for cleanup
023637| NOTE: Line comment documents intent or constraints.
023638| src/hooks/useDebouncedFilterCount.ts:173:   const abortControllerRef = useRef<AbortController | null>(null);
023639| NOTE: Uses ref for stable mutable storage between renders.
023640| src/hooks/useDebouncedFilterCount.ts:174:   const debounceTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);
023641| NOTE: Uses ref for stable mutable storage between renders.
023642| src/hooks/useDebouncedFilterCount.ts:175: 
023643| NOTE: Blank line for visual separation.
023644| src/hooks/useDebouncedFilterCount.ts:176:   // Generate cache key for current state
023645| NOTE: Line comment documents intent or constraints.
023646| src/hooks/useDebouncedFilterCount.ts:177:   const cacheKey = useMemo(
023647| NOTE: Memoizes derived values to reduce re-render work.
023648| src/hooks/useDebouncedFilterCount.ts:178:     () => generateCacheKey(pending, searchParams),
023649| NOTE: Implementation detail supporting search page behavior.
023650| src/hooks/useDebouncedFilterCount.ts:179:     [pending, searchParams],
023651| NOTE: Implementation detail supporting search page behavior.
023652| src/hooks/useDebouncedFilterCount.ts:180:   );
023653| NOTE: Implementation detail supporting search page behavior.
023654| src/hooks/useDebouncedFilterCount.ts:181: 
023655| NOTE: Blank line for visual separation.
023656| src/hooks/useDebouncedFilterCount.ts:182:   // Fetch count function
023657| NOTE: Line comment documents intent or constraints.
023658| src/hooks/useDebouncedFilterCount.ts:183:   const fetchCount = useCallback(async () => {
023659| NOTE: Memoizes callback to preserve references across renders.
023660| src/hooks/useDebouncedFilterCount.ts:184:     // Check cache first
023661| NOTE: Line comment documents intent or constraints.
023662| src/hooks/useDebouncedFilterCount.ts:185:     const cached = getCachedCount(cacheKey);
023663| NOTE: Local declaration used by search logic or UI.
023664| src/hooks/useDebouncedFilterCount.ts:186:     if (cached !== undefined) {
023665| NOTE: Conditional logic controlling rendering or flow.
023666| src/hooks/useDebouncedFilterCount.ts:187:       setCount(cached);
023667| NOTE: Implementation detail supporting search page behavior.
023668| src/hooks/useDebouncedFilterCount.ts:188:       setIsLoading(false);
023669| NOTE: Implementation detail supporting search page behavior.
023670| src/hooks/useDebouncedFilterCount.ts:189:       return;
023671| NOTE: Implementation detail supporting search page behavior.
023672| src/hooks/useDebouncedFilterCount.ts:190:     }
023673| NOTE: Implementation detail supporting search page behavior.
023674| src/hooks/useDebouncedFilterCount.ts:191: 
023675| NOTE: Blank line for visual separation.
023676| src/hooks/useDebouncedFilterCount.ts:192:     // Cancel any in-flight request
023677| NOTE: Line comment documents intent or constraints.
023678| src/hooks/useDebouncedFilterCount.ts:193:     if (abortControllerRef.current) {
023679| NOTE: Conditional logic controlling rendering or flow.
023680| src/hooks/useDebouncedFilterCount.ts:194:       abortControllerRef.current.abort();
023681| NOTE: Implementation detail supporting search page behavior.
023682| src/hooks/useDebouncedFilterCount.ts:195:     }
023683| NOTE: Implementation detail supporting search page behavior.
023684| src/hooks/useDebouncedFilterCount.ts:196: 
023685| NOTE: Blank line for visual separation.
023686| src/hooks/useDebouncedFilterCount.ts:197:     // Create new abort controller
023687| NOTE: Line comment documents intent or constraints.
023688| src/hooks/useDebouncedFilterCount.ts:198:     const abortController = new AbortController();
023689| NOTE: Local declaration used by search logic or UI.
023690| src/hooks/useDebouncedFilterCount.ts:199:     abortControllerRef.current = abortController;
023691| NOTE: Implementation detail supporting search page behavior.
023692| src/hooks/useDebouncedFilterCount.ts:200: 
023693| NOTE: Blank line for visual separation.
023694| src/hooks/useDebouncedFilterCount.ts:201:     setIsLoading(true);
023695| NOTE: Implementation detail supporting search page behavior.
023696| src/hooks/useDebouncedFilterCount.ts:202: 
023697| NOTE: Blank line for visual separation.
023698| src/hooks/useDebouncedFilterCount.ts:203:     try {
023699| NOTE: Implementation detail supporting search page behavior.
023700| src/hooks/useDebouncedFilterCount.ts:204:       const url = buildCountUrl(pending, searchParams);
023701| NOTE: Local declaration used by search logic or UI.
023702| src/hooks/useDebouncedFilterCount.ts:205:       const response = await fetch(url, {
023703| NOTE: Local declaration used by search logic or UI.
023704| src/hooks/useDebouncedFilterCount.ts:206:         signal: abortController.signal,
023705| NOTE: Implementation detail supporting search page behavior.
023706| src/hooks/useDebouncedFilterCount.ts:207:         cache: "no-store",
023707| NOTE: Implementation detail supporting search page behavior.
023708| src/hooks/useDebouncedFilterCount.ts:208:       });
023709| NOTE: Implementation detail supporting search page behavior.
023710| src/hooks/useDebouncedFilterCount.ts:209: 
023711| NOTE: Blank line for visual separation.
023712| src/hooks/useDebouncedFilterCount.ts:210:       if (!response.ok) {
023713| NOTE: Conditional logic controlling rendering or flow.
023714| src/hooks/useDebouncedFilterCount.ts:211:         throw new Error(`Count request failed: ${response.status}`);
023715| NOTE: Implementation detail supporting search page behavior.
023716| src/hooks/useDebouncedFilterCount.ts:212:       }
023717| NOTE: Implementation detail supporting search page behavior.
023718| src/hooks/useDebouncedFilterCount.ts:213: 
023719| NOTE: Blank line for visual separation.
023720| src/hooks/useDebouncedFilterCount.ts:214:       const data = await response.json();
023721| NOTE: Local declaration used by search logic or UI.
023722| src/hooks/useDebouncedFilterCount.ts:215:       const newCount = data.count as number | null;
023723| NOTE: Local declaration used by search logic or UI.
023724| src/hooks/useDebouncedFilterCount.ts:216: 
023725| NOTE: Blank line for visual separation.
023726| src/hooks/useDebouncedFilterCount.ts:217:       // Cache the result
023727| NOTE: Line comment documents intent or constraints.
023728| src/hooks/useDebouncedFilterCount.ts:218:       setCachedCount(cacheKey, newCount);
023729| NOTE: Implementation detail supporting search page behavior.
023730| src/hooks/useDebouncedFilterCount.ts:219: 
023731| NOTE: Blank line for visual separation.
023732| src/hooks/useDebouncedFilterCount.ts:220:       // Only update state if not aborted
023733| NOTE: Line comment documents intent or constraints.
023734| src/hooks/useDebouncedFilterCount.ts:221:       if (!abortController.signal.aborted) {
023735| NOTE: Conditional logic controlling rendering or flow.
023736| src/hooks/useDebouncedFilterCount.ts:222:         setCount(newCount);
023737| NOTE: Implementation detail supporting search page behavior.
023738| src/hooks/useDebouncedFilterCount.ts:223:         setIsLoading(false);
023739| NOTE: Implementation detail supporting search page behavior.
023740| src/hooks/useDebouncedFilterCount.ts:224:       }
023741| NOTE: Implementation detail supporting search page behavior.
023742| src/hooks/useDebouncedFilterCount.ts:225:     } catch (error) {
023743| NOTE: Implementation detail supporting search page behavior.
023744| src/hooks/useDebouncedFilterCount.ts:226:       // Ignore abort errors
023745| NOTE: Line comment documents intent or constraints.
023746| src/hooks/useDebouncedFilterCount.ts:227:       if (error instanceof Error && error.name === "AbortError") {
023747| NOTE: Conditional logic controlling rendering or flow.
023748| src/hooks/useDebouncedFilterCount.ts:228:         return;
023749| NOTE: Implementation detail supporting search page behavior.
023750| src/hooks/useDebouncedFilterCount.ts:229:       }
023751| NOTE: Implementation detail supporting search page behavior.
023752| src/hooks/useDebouncedFilterCount.ts:230: 
023753| NOTE: Blank line for visual separation.
023754| src/hooks/useDebouncedFilterCount.ts:231:       // Log other errors but don't crash
023755| NOTE: Line comment documents intent or constraints.
023756| src/hooks/useDebouncedFilterCount.ts:232:       console.error("[useDebouncedFilterCount] Error fetching count:", error);
023757| NOTE: Implementation detail supporting search page behavior.
023758| src/hooks/useDebouncedFilterCount.ts:233: 
023759| NOTE: Blank line for visual separation.
023760| src/hooks/useDebouncedFilterCount.ts:234:       if (!abortController.signal.aborted) {
023761| NOTE: Conditional logic controlling rendering or flow.
023762| src/hooks/useDebouncedFilterCount.ts:235:         setIsLoading(false);
023763| NOTE: Implementation detail supporting search page behavior.
023764| src/hooks/useDebouncedFilterCount.ts:236:         // Keep previous count on error, don't set to null
023765| NOTE: Line comment documents intent or constraints.
023766| src/hooks/useDebouncedFilterCount.ts:237:       }
023767| NOTE: Implementation detail supporting search page behavior.
023768| src/hooks/useDebouncedFilterCount.ts:238:     }
023769| NOTE: Implementation detail supporting search page behavior.
023770| src/hooks/useDebouncedFilterCount.ts:239:   }, [cacheKey, pending, searchParams]);
023771| NOTE: Implementation detail supporting search page behavior.
023772| src/hooks/useDebouncedFilterCount.ts:240: 
023773| NOTE: Blank line for visual separation.
023774| src/hooks/useDebouncedFilterCount.ts:241:   // Reset baseline when drawer closes
023775| NOTE: Line comment documents intent or constraints.
023776| src/hooks/useDebouncedFilterCount.ts:242:   useEffect(() => {
023777| NOTE: Defines side effect for syncing with external state.
023778| src/hooks/useDebouncedFilterCount.ts:243:     if (!isDrawerOpen) {
023779| NOTE: Conditional logic controlling rendering or flow.
023780| src/hooks/useDebouncedFilterCount.ts:244:       baselineCapturedRef.current = false;
023781| NOTE: Implementation detail supporting search page behavior.
023782| src/hooks/useDebouncedFilterCount.ts:245:       setBaselineCount(null);
023783| NOTE: Implementation detail supporting search page behavior.
023784| src/hooks/useDebouncedFilterCount.ts:246:     }
023785| NOTE: Implementation detail supporting search page behavior.
023786| src/hooks/useDebouncedFilterCount.ts:247:   }, [isDrawerOpen]);
023787| NOTE: Implementation detail supporting search page behavior.
023788| src/hooks/useDebouncedFilterCount.ts:248: 
023789| NOTE: Blank line for visual separation.
023790| src/hooks/useDebouncedFilterCount.ts:249:   // Effect to trigger debounced fetch
023791| NOTE: Line comment documents intent or constraints.
023792| src/hooks/useDebouncedFilterCount.ts:250:   useEffect(() => {
023793| NOTE: Defines side effect for syncing with external state.
023794| src/hooks/useDebouncedFilterCount.ts:251:     // Clear any pending timeout
023795| NOTE: Line comment documents intent or constraints.
023796| src/hooks/useDebouncedFilterCount.ts:252:     if (debounceTimeoutRef.current) {
023797| NOTE: Conditional logic controlling rendering or flow.
023798| src/hooks/useDebouncedFilterCount.ts:253:       clearTimeout(debounceTimeoutRef.current);
023799| NOTE: Implementation detail supporting search page behavior.
023800| src/hooks/useDebouncedFilterCount.ts:254:       debounceTimeoutRef.current = null;
023801| NOTE: Implementation detail supporting search page behavior.
023802| src/hooks/useDebouncedFilterCount.ts:255:     }
023803| NOTE: Implementation detail supporting search page behavior.
023804| src/hooks/useDebouncedFilterCount.ts:256: 
023805| NOTE: Blank line for visual separation.
023806| src/hooks/useDebouncedFilterCount.ts:257:     // Only fetch if drawer is open AND filters are dirty
023807| NOTE: Line comment documents intent or constraints.
023808| src/hooks/useDebouncedFilterCount.ts:258:     if (!isDrawerOpen || !isDirty) {
023809| NOTE: Conditional logic controlling rendering or flow.
023810| src/hooks/useDebouncedFilterCount.ts:259:       // Reset count when drawer closes or filters become clean
023811| NOTE: Line comment documents intent or constraints.
023812| src/hooks/useDebouncedFilterCount.ts:260:       setCount(null);
023813| NOTE: Implementation detail supporting search page behavior.
023814| src/hooks/useDebouncedFilterCount.ts:261:       setIsLoading(false);
023815| NOTE: Implementation detail supporting search page behavior.
023816| src/hooks/useDebouncedFilterCount.ts:262:       return;
023817| NOTE: Implementation detail supporting search page behavior.
023818| src/hooks/useDebouncedFilterCount.ts:263:     }
023819| NOTE: Implementation detail supporting search page behavior.
023820| src/hooks/useDebouncedFilterCount.ts:264: 
023821| NOTE: Blank line for visual separation.
023822| src/hooks/useDebouncedFilterCount.ts:265:     // Capture baseline on first dirty state after drawer opens
023823| NOTE: Line comment documents intent or constraints.
023824| src/hooks/useDebouncedFilterCount.ts:266:     if (!baselineCapturedRef.current && count !== null) {
023825| NOTE: Conditional logic controlling rendering or flow.
023826| src/hooks/useDebouncedFilterCount.ts:267:       setBaselineCount(count);
023827| NOTE: Implementation detail supporting search page behavior.
023828| src/hooks/useDebouncedFilterCount.ts:268:       baselineCapturedRef.current = true;
023829| NOTE: Implementation detail supporting search page behavior.
023830| src/hooks/useDebouncedFilterCount.ts:269:     }
023831| NOTE: Implementation detail supporting search page behavior.
023832| src/hooks/useDebouncedFilterCount.ts:270: 
023833| NOTE: Blank line for visual separation.
023834| src/hooks/useDebouncedFilterCount.ts:271:     // Check cache immediately
023835| NOTE: Line comment documents intent or constraints.
023836| src/hooks/useDebouncedFilterCount.ts:272:     const cached = getCachedCount(cacheKey);
023837| NOTE: Local declaration used by search logic or UI.
023838| src/hooks/useDebouncedFilterCount.ts:273:     if (cached !== undefined) {
023839| NOTE: Conditional logic controlling rendering or flow.
023840| src/hooks/useDebouncedFilterCount.ts:274:       setCount(cached);
023841| NOTE: Implementation detail supporting search page behavior.
023842| src/hooks/useDebouncedFilterCount.ts:275:       setIsLoading(false);
023843| NOTE: Implementation detail supporting search page behavior.
023844| src/hooks/useDebouncedFilterCount.ts:276:       // Capture baseline from cache if we haven't yet
023845| NOTE: Line comment documents intent or constraints.
023846| src/hooks/useDebouncedFilterCount.ts:277:       if (!baselineCapturedRef.current) {
023847| NOTE: Conditional logic controlling rendering or flow.
023848| src/hooks/useDebouncedFilterCount.ts:278:         setBaselineCount(cached);
023849| NOTE: Implementation detail supporting search page behavior.
023850| src/hooks/useDebouncedFilterCount.ts:279:         baselineCapturedRef.current = true;
023851| NOTE: Implementation detail supporting search page behavior.
023852| src/hooks/useDebouncedFilterCount.ts:280:       }
023853| NOTE: Implementation detail supporting search page behavior.
023854| src/hooks/useDebouncedFilterCount.ts:281:       return;
023855| NOTE: Implementation detail supporting search page behavior.
023856| src/hooks/useDebouncedFilterCount.ts:282:     }
023857| NOTE: Implementation detail supporting search page behavior.
023858| src/hooks/useDebouncedFilterCount.ts:283: 
023859| NOTE: Blank line for visual separation.
023860| src/hooks/useDebouncedFilterCount.ts:284:     // Save current count as previous for optimistic UI
023861| NOTE: Line comment documents intent or constraints.
023862| src/hooks/useDebouncedFilterCount.ts:285:     setPreviousCount(count);
023863| NOTE: Implementation detail supporting search page behavior.
023864| src/hooks/useDebouncedFilterCount.ts:286: 
023865| NOTE: Blank line for visual separation.
023866| src/hooks/useDebouncedFilterCount.ts:287:     // Show loading state immediately
023867| NOTE: Line comment documents intent or constraints.
023868| src/hooks/useDebouncedFilterCount.ts:288:     setIsLoading(true);
023869| NOTE: Implementation detail supporting search page behavior.
023870| src/hooks/useDebouncedFilterCount.ts:289: 
023871| NOTE: Blank line for visual separation.
023872| src/hooks/useDebouncedFilterCount.ts:290:     // Debounce the fetch
023873| NOTE: Line comment documents intent or constraints.
023874| src/hooks/useDebouncedFilterCount.ts:291:     debounceTimeoutRef.current = setTimeout(() => {
023875| NOTE: Implementation detail supporting search page behavior.
023876| src/hooks/useDebouncedFilterCount.ts:292:       fetchCount();
023877| NOTE: Implementation detail supporting search page behavior.
023878| src/hooks/useDebouncedFilterCount.ts:293:     }, DEBOUNCE_MS);
023879| NOTE: Implementation detail supporting search page behavior.
023880| src/hooks/useDebouncedFilterCount.ts:294: 
023881| NOTE: Blank line for visual separation.
023882| src/hooks/useDebouncedFilterCount.ts:295:     // Cleanup on unmount or dependency change
023883| NOTE: Line comment documents intent or constraints.
023884| src/hooks/useDebouncedFilterCount.ts:296:     return () => {
023885| NOTE: Return statement for component or helper output.
023886| src/hooks/useDebouncedFilterCount.ts:297:       if (debounceTimeoutRef.current) {
023887| NOTE: Conditional logic controlling rendering or flow.
023888| src/hooks/useDebouncedFilterCount.ts:298:         clearTimeout(debounceTimeoutRef.current);
023889| NOTE: Implementation detail supporting search page behavior.
023890| src/hooks/useDebouncedFilterCount.ts:299:       }
023891| NOTE: Implementation detail supporting search page behavior.
023892| src/hooks/useDebouncedFilterCount.ts:300:       if (abortControllerRef.current) {
023893| NOTE: Conditional logic controlling rendering or flow.
023894| src/hooks/useDebouncedFilterCount.ts:301:         abortControllerRef.current.abort();
023895| NOTE: Implementation detail supporting search page behavior.
023896| src/hooks/useDebouncedFilterCount.ts:302:       }
023897| NOTE: Implementation detail supporting search page behavior.
023898| src/hooks/useDebouncedFilterCount.ts:303:     };
023899| NOTE: Implementation detail supporting search page behavior.
023900| src/hooks/useDebouncedFilterCount.ts:304:   }, [cacheKey, isDirty, isDrawerOpen, fetchCount, count]);
023901| NOTE: Implementation detail supporting search page behavior.
023902| src/hooks/useDebouncedFilterCount.ts:305: 
023903| NOTE: Blank line for visual separation.
023904| src/hooks/useDebouncedFilterCount.ts:306:   // Format count for display
023905| NOTE: Line comment documents intent or constraints.
023906| src/hooks/useDebouncedFilterCount.ts:307:   const formattedCount = useMemo(() => {
023907| NOTE: Memoizes derived values to reduce re-render work.
023908| src/hooks/useDebouncedFilterCount.ts:308:     if (isLoading) {
023909| NOTE: Conditional logic controlling rendering or flow.
023910| src/hooks/useDebouncedFilterCount.ts:309:       return "listings";
023911| NOTE: Return statement for component or helper output.
023912| src/hooks/useDebouncedFilterCount.ts:310:     }
023913| NOTE: Implementation detail supporting search page behavior.
023914| src/hooks/useDebouncedFilterCount.ts:311:     if (count === null) {
023915| NOTE: Conditional logic controlling rendering or flow.
023916| src/hooks/useDebouncedFilterCount.ts:312:       return "100+ listings";
023917| NOTE: Return statement for component or helper output.
023918| src/hooks/useDebouncedFilterCount.ts:313:     }
023919| NOTE: Implementation detail supporting search page behavior.
023920| src/hooks/useDebouncedFilterCount.ts:314:     if (count === 1) {
023921| NOTE: Conditional logic controlling rendering or flow.
023922| src/hooks/useDebouncedFilterCount.ts:315:       return "1 listing";
023923| NOTE: Return statement for component or helper output.
023924| src/hooks/useDebouncedFilterCount.ts:316:     }
023925| NOTE: Implementation detail supporting search page behavior.
023926| src/hooks/useDebouncedFilterCount.ts:317:     return `${count} listings`;
023927| NOTE: Return statement for component or helper output.
023928| src/hooks/useDebouncedFilterCount.ts:318:   }, [count, isLoading]);
023929| NOTE: Implementation detail supporting search page behavior.
023930| src/hooks/useDebouncedFilterCount.ts:319: 
023931| NOTE: Blank line for visual separation.
023932| src/hooks/useDebouncedFilterCount.ts:320:   return {
023933| NOTE: Return statement for component or helper output.
023934| src/hooks/useDebouncedFilterCount.ts:321:     count,
023935| NOTE: Implementation detail supporting search page behavior.
023936| src/hooks/useDebouncedFilterCount.ts:322:     previousCount,
023937| NOTE: Implementation detail supporting search page behavior.
023938| src/hooks/useDebouncedFilterCount.ts:323:     baselineCount,
023939| NOTE: Implementation detail supporting search page behavior.
023940| src/hooks/useDebouncedFilterCount.ts:324:     isLoading,
023941| NOTE: Implementation detail supporting search page behavior.
023942| src/hooks/useDebouncedFilterCount.ts:325:     formattedCount,
023943| NOTE: Implementation detail supporting search page behavior.
023944| src/hooks/useDebouncedFilterCount.ts:326:   };
023945| NOTE: Implementation detail supporting search page behavior.
023946| src/hooks/useDebouncedFilterCount.ts:327: }
023947| NOTE: Implementation detail supporting search page behavior.
023948| FILE END: src/hooks/useDebouncedFilterCount.ts
023949| 
023950| FILE START: src/hooks/useFilterImpactCount.ts
023951| FILE ROLE: Auto-discovered dependency in search page graph.
023952| src/hooks/useFilterImpactCount.ts:1: "use client";
023953| NOTE: Implementation detail supporting search page behavior.
023954| src/hooks/useFilterImpactCount.ts:2: 
023955| NOTE: Blank line for visual separation.
023956| src/hooks/useFilterImpactCount.ts:3: /**
023957| NOTE: Block comment line describing behavior or context.
023958| src/hooks/useFilterImpactCount.ts:4:  * useFilterImpactCount - Lazy-loaded filter removal impact counter
023959| NOTE: Block comment line describing behavior or context.
023960| src/hooks/useFilterImpactCount.ts:5:  *
023961| NOTE: Block comment line describing behavior or context.
023962| src/hooks/useFilterImpactCount.ts:6:  * Calculates how removing a filter would change result count.
023963| NOTE: Block comment line describing behavior or context.
023964| src/hooks/useFilterImpactCount.ts:7:  * Only fetches on hover to minimize API costs, with aggressive caching.
023965| NOTE: Block comment line describing behavior or context.
023966| src/hooks/useFilterImpactCount.ts:8:  *
023967| NOTE: Block comment line describing behavior or context.
023968| src/hooks/useFilterImpactCount.ts:9:  * Example: If current search shows 45 results and removing "WiFi" filter
023969| NOTE: Block comment line describing behavior or context.
023970| src/hooks/useFilterImpactCount.ts:10:  * would show 67 results, displays "+22" badge on the WiFi chip.
023971| NOTE: Block comment line describing behavior or context.
023972| src/hooks/useFilterImpactCount.ts:11:  */
023973| NOTE: Block comment line describing behavior or context.
023974| src/hooks/useFilterImpactCount.ts:12: 
023975| NOTE: Blank line for visual separation.
023976| src/hooks/useFilterImpactCount.ts:13: import { useState, useCallback, useRef, useEffect } from "react";
023977| NOTE: Imports dependency for this module.
023978| src/hooks/useFilterImpactCount.ts:14: import type { FilterChipData } from "@/components/filters/filter-chip-utils";
023979| NOTE: Imports dependency for this module.
023980| src/hooks/useFilterImpactCount.ts:15: import { removeFilterFromUrl } from "@/components/filters/filter-chip-utils";
023981| NOTE: Imports dependency for this module.
023982| src/hooks/useFilterImpactCount.ts:16: 
023983| NOTE: Blank line for visual separation.
023984| src/hooks/useFilterImpactCount.ts:17: // Cache entry with expiration
023985| NOTE: Line comment documents intent or constraints.
023986| src/hooks/useFilterImpactCount.ts:18: interface CacheEntry {
023987| NOTE: Type declaration for search data contracts.
023988| src/hooks/useFilterImpactCount.ts:19:   count: number | null;
023989| NOTE: Implementation detail supporting search page behavior.
023990| src/hooks/useFilterImpactCount.ts:20:   expiresAt: number;
023991| NOTE: Implementation detail supporting search page behavior.
023992| src/hooks/useFilterImpactCount.ts:21: }
023993| NOTE: Implementation detail supporting search page behavior.
023994| src/hooks/useFilterImpactCount.ts:22: 
023995| NOTE: Blank line for visual separation.
023996| src/hooks/useFilterImpactCount.ts:23: // Simple in-memory cache with TTL
023997| NOTE: Line comment documents intent or constraints.
023998| src/hooks/useFilterImpactCount.ts:24: const impactCache = new Map<string, CacheEntry>();
023999| NOTE: Local declaration used by search logic or UI.
024000| src/hooks/useFilterImpactCount.ts:25: const CACHE_TTL_MS = 60_000; // 60 seconds (longer than filter count cache)
024001| NOTE: Local declaration used by search logic or UI.
024002| src/hooks/useFilterImpactCount.ts:26: 
024003| NOTE: Blank line for visual separation.
024004| src/hooks/useFilterImpactCount.ts:27: // Debounce delay for hover
024005| NOTE: Line comment documents intent or constraints.
024006| src/hooks/useFilterImpactCount.ts:28: const DEBOUNCE_MS = 200;
024007| NOTE: Local declaration used by search logic or UI.
024008| src/hooks/useFilterImpactCount.ts:29: 
024009| NOTE: Blank line for visual separation.
024010| src/hooks/useFilterImpactCount.ts:30: export interface UseFilterImpactCountOptions {
024011| NOTE: Implementation detail supporting search page behavior.
024012| src/hooks/useFilterImpactCount.ts:31:   /** Current URL search params */
024013| NOTE: Block comment line describing behavior or context.
024014| src/hooks/useFilterImpactCount.ts:32:   searchParams: URLSearchParams;
024015| NOTE: Implementation detail supporting search page behavior.
024016| src/hooks/useFilterImpactCount.ts:33:   /** The chip we're calculating impact for */
024017| NOTE: Block comment line describing behavior or context.
024018| src/hooks/useFilterImpactCount.ts:34:   chip: FilterChipData;
024019| NOTE: Implementation detail supporting search page behavior.
024020| src/hooks/useFilterImpactCount.ts:35:   /** Whether the chip is currently being hovered */
024021| NOTE: Block comment line describing behavior or context.
024022| src/hooks/useFilterImpactCount.ts:36:   isHovering: boolean;
024023| NOTE: Implementation detail supporting search page behavior.
024024| src/hooks/useFilterImpactCount.ts:37:   /** Current result count (for calculating delta) */
024025| NOTE: Block comment line describing behavior or context.
024026| src/hooks/useFilterImpactCount.ts:38:   currentCount: number | null;
024027| NOTE: Implementation detail supporting search page behavior.
024028| src/hooks/useFilterImpactCount.ts:39: }
024029| NOTE: Implementation detail supporting search page behavior.
024030| src/hooks/useFilterImpactCount.ts:40: 
024031| NOTE: Blank line for visual separation.
024032| src/hooks/useFilterImpactCount.ts:41: export interface UseFilterImpactCountReturn {
024033| NOTE: Implementation detail supporting search page behavior.
024034| src/hooks/useFilterImpactCount.ts:42:   /** The delta in results when filter is removed (e.g., +22) */
024035| NOTE: Block comment line describing behavior or context.
024036| src/hooks/useFilterImpactCount.ts:43:   impactDelta: number | null;
024037| NOTE: Implementation detail supporting search page behavior.
024038| src/hooks/useFilterImpactCount.ts:44:   /** Whether impact count is loading */
024039| NOTE: Block comment line describing behavior or context.
024040| src/hooks/useFilterImpactCount.ts:45:   isLoading: boolean;
024041| NOTE: Implementation detail supporting search page behavior.
024042| src/hooks/useFilterImpactCount.ts:46:   /** Formatted string (e.g., "+22" or "+100") */
024043| NOTE: Block comment line describing behavior or context.
024044| src/hooks/useFilterImpactCount.ts:47:   formattedDelta: string | null;
024045| NOTE: Implementation detail supporting search page behavior.
024046| src/hooks/useFilterImpactCount.ts:48: }
024047| NOTE: Implementation detail supporting search page behavior.
024048| src/hooks/useFilterImpactCount.ts:49: 
024049| NOTE: Blank line for visual separation.
024050| src/hooks/useFilterImpactCount.ts:50: /**
024051| NOTE: Block comment line describing behavior or context.
024052| src/hooks/useFilterImpactCount.ts:51:  * Generate cache key for filter removal impact
024053| NOTE: Block comment line describing behavior or context.
024054| src/hooks/useFilterImpactCount.ts:52:  */
024055| NOTE: Block comment line describing behavior or context.
024056| src/hooks/useFilterImpactCount.ts:53: function generateCacheKey(
024057| NOTE: Defines a helper or component function.
024058| src/hooks/useFilterImpactCount.ts:54:   searchParams: URLSearchParams,
024059| NOTE: Implementation detail supporting search page behavior.
024060| src/hooks/useFilterImpactCount.ts:55:   chip: FilterChipData,
024061| NOTE: Implementation detail supporting search page behavior.
024062| src/hooks/useFilterImpactCount.ts:56: ): string {
024063| NOTE: Implementation detail supporting search page behavior.
024064| src/hooks/useFilterImpactCount.ts:57:   // The cache key is the URL query string WITHOUT the filter being removed
024065| NOTE: Line comment documents intent or constraints.
024066| src/hooks/useFilterImpactCount.ts:58:   const queryWithoutFilter = removeFilterFromUrl(searchParams, chip);
024067| NOTE: Local declaration used by search logic or UI.
024068| src/hooks/useFilterImpactCount.ts:59:   return `impact:${queryWithoutFilter}`;
024069| NOTE: Return statement for component or helper output.
024070| src/hooks/useFilterImpactCount.ts:60: }
024071| NOTE: Implementation detail supporting search page behavior.
024072| src/hooks/useFilterImpactCount.ts:61: 
024073| NOTE: Blank line for visual separation.
024074| src/hooks/useFilterImpactCount.ts:62: /**
024075| NOTE: Block comment line describing behavior or context.
024076| src/hooks/useFilterImpactCount.ts:63:  * Get cached count if valid
024077| NOTE: Block comment line describing behavior or context.
024078| src/hooks/useFilterImpactCount.ts:64:  */
024079| NOTE: Block comment line describing behavior or context.
024080| src/hooks/useFilterImpactCount.ts:65: function getCachedCount(cacheKey: string): number | null | undefined {
024081| NOTE: Defines a helper or component function.
024082| src/hooks/useFilterImpactCount.ts:66:   const entry = impactCache.get(cacheKey);
024083| NOTE: Local declaration used by search logic or UI.
024084| src/hooks/useFilterImpactCount.ts:67:   if (!entry) return undefined;
024085| NOTE: Conditional logic controlling rendering or flow.
024086| src/hooks/useFilterImpactCount.ts:68: 
024087| NOTE: Blank line for visual separation.
024088| src/hooks/useFilterImpactCount.ts:69:   if (Date.now() > entry.expiresAt) {
024089| NOTE: Conditional logic controlling rendering or flow.
024090| src/hooks/useFilterImpactCount.ts:70:     impactCache.delete(cacheKey);
024091| NOTE: Implementation detail supporting search page behavior.
024092| src/hooks/useFilterImpactCount.ts:71:     return undefined;
024093| NOTE: Return statement for component or helper output.
024094| src/hooks/useFilterImpactCount.ts:72:   }
024095| NOTE: Implementation detail supporting search page behavior.
024096| src/hooks/useFilterImpactCount.ts:73: 
024097| NOTE: Blank line for visual separation.
024098| src/hooks/useFilterImpactCount.ts:74:   return entry.count;
024099| NOTE: Return statement for component or helper output.
024100| src/hooks/useFilterImpactCount.ts:75: }
024101| NOTE: Implementation detail supporting search page behavior.
024102| src/hooks/useFilterImpactCount.ts:76: 
024103| NOTE: Blank line for visual separation.
024104| src/hooks/useFilterImpactCount.ts:77: /**
024105| NOTE: Block comment line describing behavior or context.
024106| src/hooks/useFilterImpactCount.ts:78:  * Set cached count
024107| NOTE: Block comment line describing behavior or context.
024108| src/hooks/useFilterImpactCount.ts:79:  */
024109| NOTE: Block comment line describing behavior or context.
024110| src/hooks/useFilterImpactCount.ts:80: function setCachedCount(cacheKey: string, count: number | null): void {
024111| NOTE: Defines a helper or component function.
024112| src/hooks/useFilterImpactCount.ts:81:   impactCache.set(cacheKey, {
024113| NOTE: Implementation detail supporting search page behavior.
024114| src/hooks/useFilterImpactCount.ts:82:     count,
024115| NOTE: Implementation detail supporting search page behavior.
024116| src/hooks/useFilterImpactCount.ts:83:     expiresAt: Date.now() + CACHE_TTL_MS,
024117| NOTE: Implementation detail supporting search page behavior.
024118| src/hooks/useFilterImpactCount.ts:84:   });
024119| NOTE: Implementation detail supporting search page behavior.
024120| src/hooks/useFilterImpactCount.ts:85: }
024121| NOTE: Implementation detail supporting search page behavior.
024122| src/hooks/useFilterImpactCount.ts:86: 
024123| NOTE: Blank line for visual separation.
024124| src/hooks/useFilterImpactCount.ts:87: export function useFilterImpactCount({
024125| NOTE: Exports helper or component function.
024126| src/hooks/useFilterImpactCount.ts:88:   searchParams,
024127| NOTE: Implementation detail supporting search page behavior.
024128| src/hooks/useFilterImpactCount.ts:89:   chip,
024129| NOTE: Implementation detail supporting search page behavior.
024130| src/hooks/useFilterImpactCount.ts:90:   isHovering,
024131| NOTE: Implementation detail supporting search page behavior.
024132| src/hooks/useFilterImpactCount.ts:91:   currentCount,
024133| NOTE: Implementation detail supporting search page behavior.
024134| src/hooks/useFilterImpactCount.ts:92: }: UseFilterImpactCountOptions): UseFilterImpactCountReturn {
024135| NOTE: Implementation detail supporting search page behavior.
024136| src/hooks/useFilterImpactCount.ts:93:   const [countWithoutFilter, setCountWithoutFilter] = useState<number | null>(
024137| NOTE: Initializes local state for search UI behavior.
024138| src/hooks/useFilterImpactCount.ts:94:     null,
024139| NOTE: Implementation detail supporting search page behavior.
024140| src/hooks/useFilterImpactCount.ts:95:   );
024141| NOTE: Implementation detail supporting search page behavior.
024142| src/hooks/useFilterImpactCount.ts:96:   const [isLoading, setIsLoading] = useState(false);
024143| NOTE: Initializes local state for search UI behavior.
024144| src/hooks/useFilterImpactCount.ts:97:   const [hasFetched, setHasFetched] = useState(false);
024145| NOTE: Initializes local state for search UI behavior.
024146| src/hooks/useFilterImpactCount.ts:98: 
024147| NOTE: Blank line for visual separation.
024148| src/hooks/useFilterImpactCount.ts:99:   // Refs for cleanup
024149| NOTE: Line comment documents intent or constraints.
024150| src/hooks/useFilterImpactCount.ts:100:   const abortControllerRef = useRef<AbortController | null>(null);
024151| NOTE: Uses ref for stable mutable storage between renders.
024152| src/hooks/useFilterImpactCount.ts:101:   const debounceTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);
024153| NOTE: Uses ref for stable mutable storage between renders.
024154| src/hooks/useFilterImpactCount.ts:102: 
024155| NOTE: Blank line for visual separation.
024156| src/hooks/useFilterImpactCount.ts:103:   // Generate cache key
024157| NOTE: Line comment documents intent or constraints.
024158| src/hooks/useFilterImpactCount.ts:104:   const cacheKey = generateCacheKey(searchParams, chip);
024159| NOTE: Local declaration used by search logic or UI.
024160| src/hooks/useFilterImpactCount.ts:105: 
024161| NOTE: Blank line for visual separation.
024162| src/hooks/useFilterImpactCount.ts:106:   // Fetch count function
024163| NOTE: Line comment documents intent or constraints.
024164| src/hooks/useFilterImpactCount.ts:107:   const fetchCount = useCallback(async () => {
024165| NOTE: Memoizes callback to preserve references across renders.
024166| src/hooks/useFilterImpactCount.ts:108:     // Check cache first
024167| NOTE: Line comment documents intent or constraints.
024168| src/hooks/useFilterImpactCount.ts:109:     const cached = getCachedCount(cacheKey);
024169| NOTE: Local declaration used by search logic or UI.
024170| src/hooks/useFilterImpactCount.ts:110:     if (cached !== undefined) {
024171| NOTE: Conditional logic controlling rendering or flow.
024172| src/hooks/useFilterImpactCount.ts:111:       setCountWithoutFilter(cached);
024173| NOTE: Implementation detail supporting search page behavior.
024174| src/hooks/useFilterImpactCount.ts:112:       setIsLoading(false);
024175| NOTE: Implementation detail supporting search page behavior.
024176| src/hooks/useFilterImpactCount.ts:113:       setHasFetched(true);
024177| NOTE: Implementation detail supporting search page behavior.
024178| src/hooks/useFilterImpactCount.ts:114:       return;
024179| NOTE: Implementation detail supporting search page behavior.
024180| src/hooks/useFilterImpactCount.ts:115:     }
024181| NOTE: Implementation detail supporting search page behavior.
024182| src/hooks/useFilterImpactCount.ts:116: 
024183| NOTE: Blank line for visual separation.
024184| src/hooks/useFilterImpactCount.ts:117:     // Cancel any in-flight request
024185| NOTE: Line comment documents intent or constraints.
024186| src/hooks/useFilterImpactCount.ts:118:     if (abortControllerRef.current) {
024187| NOTE: Conditional logic controlling rendering or flow.
024188| src/hooks/useFilterImpactCount.ts:119:       abortControllerRef.current.abort();
024189| NOTE: Implementation detail supporting search page behavior.
024190| src/hooks/useFilterImpactCount.ts:120:     }
024191| NOTE: Implementation detail supporting search page behavior.
024192| src/hooks/useFilterImpactCount.ts:121: 
024193| NOTE: Blank line for visual separation.
024194| src/hooks/useFilterImpactCount.ts:122:     // Create new abort controller
024195| NOTE: Line comment documents intent or constraints.
024196| src/hooks/useFilterImpactCount.ts:123:     const abortController = new AbortController();
024197| NOTE: Local declaration used by search logic or UI.
024198| src/hooks/useFilterImpactCount.ts:124:     abortControllerRef.current = abortController;
024199| NOTE: Implementation detail supporting search page behavior.
024200| src/hooks/useFilterImpactCount.ts:125: 
024201| NOTE: Blank line for visual separation.
024202| src/hooks/useFilterImpactCount.ts:126:     setIsLoading(true);
024203| NOTE: Implementation detail supporting search page behavior.
024204| src/hooks/useFilterImpactCount.ts:127: 
024205| NOTE: Blank line for visual separation.
024206| src/hooks/useFilterImpactCount.ts:128:     try {
024207| NOTE: Implementation detail supporting search page behavior.
024208| src/hooks/useFilterImpactCount.ts:129:       // Build URL with filter removed
024209| NOTE: Line comment documents intent or constraints.
024210| src/hooks/useFilterImpactCount.ts:130:       const queryWithoutFilter = removeFilterFromUrl(searchParams, chip);
024211| NOTE: Local declaration used by search logic or UI.
024212| src/hooks/useFilterImpactCount.ts:131:       const url = `/api/search-count?${queryWithoutFilter}`;
024213| NOTE: Local declaration used by search logic or UI.
024214| src/hooks/useFilterImpactCount.ts:132: 
024215| NOTE: Blank line for visual separation.
024216| src/hooks/useFilterImpactCount.ts:133:       const response = await fetch(url, {
024217| NOTE: Local declaration used by search logic or UI.
024218| src/hooks/useFilterImpactCount.ts:134:         signal: abortController.signal,
024219| NOTE: Implementation detail supporting search page behavior.
024220| src/hooks/useFilterImpactCount.ts:135:         cache: "no-store",
024221| NOTE: Implementation detail supporting search page behavior.
024222| src/hooks/useFilterImpactCount.ts:136:       });
024223| NOTE: Implementation detail supporting search page behavior.
024224| src/hooks/useFilterImpactCount.ts:137: 
024225| NOTE: Blank line for visual separation.
024226| src/hooks/useFilterImpactCount.ts:138:       if (!response.ok) {
024227| NOTE: Conditional logic controlling rendering or flow.
024228| src/hooks/useFilterImpactCount.ts:139:         throw new Error(`Count request failed: ${response.status}`);
024229| NOTE: Implementation detail supporting search page behavior.
024230| src/hooks/useFilterImpactCount.ts:140:       }
024231| NOTE: Implementation detail supporting search page behavior.
024232| src/hooks/useFilterImpactCount.ts:141: 
024233| NOTE: Blank line for visual separation.
024234| src/hooks/useFilterImpactCount.ts:142:       const data = await response.json();
024235| NOTE: Local declaration used by search logic or UI.
024236| src/hooks/useFilterImpactCount.ts:143:       const newCount = data.count as number | null;
024237| NOTE: Local declaration used by search logic or UI.
024238| src/hooks/useFilterImpactCount.ts:144: 
024239| NOTE: Blank line for visual separation.
024240| src/hooks/useFilterImpactCount.ts:145:       // Cache the result
024241| NOTE: Line comment documents intent or constraints.
024242| src/hooks/useFilterImpactCount.ts:146:       setCachedCount(cacheKey, newCount);
024243| NOTE: Implementation detail supporting search page behavior.
024244| src/hooks/useFilterImpactCount.ts:147: 
024245| NOTE: Blank line for visual separation.
024246| src/hooks/useFilterImpactCount.ts:148:       // Only update state if not aborted
024247| NOTE: Line comment documents intent or constraints.
024248| src/hooks/useFilterImpactCount.ts:149:       if (!abortController.signal.aborted) {
024249| NOTE: Conditional logic controlling rendering or flow.
024250| src/hooks/useFilterImpactCount.ts:150:         setCountWithoutFilter(newCount);
024251| NOTE: Implementation detail supporting search page behavior.
024252| src/hooks/useFilterImpactCount.ts:151:         setIsLoading(false);
024253| NOTE: Implementation detail supporting search page behavior.
024254| src/hooks/useFilterImpactCount.ts:152:         setHasFetched(true);
024255| NOTE: Implementation detail supporting search page behavior.
024256| src/hooks/useFilterImpactCount.ts:153:       }
024257| NOTE: Implementation detail supporting search page behavior.
024258| src/hooks/useFilterImpactCount.ts:154:     } catch (error) {
024259| NOTE: Implementation detail supporting search page behavior.
024260| src/hooks/useFilterImpactCount.ts:155:       // Ignore abort errors
024261| NOTE: Line comment documents intent or constraints.
024262| src/hooks/useFilterImpactCount.ts:156:       if (error instanceof Error && error.name === "AbortError") {
024263| NOTE: Conditional logic controlling rendering or flow.
024264| src/hooks/useFilterImpactCount.ts:157:         return;
024265| NOTE: Implementation detail supporting search page behavior.
024266| src/hooks/useFilterImpactCount.ts:158:       }
024267| NOTE: Implementation detail supporting search page behavior.
024268| src/hooks/useFilterImpactCount.ts:159: 
024269| NOTE: Blank line for visual separation.
024270| src/hooks/useFilterImpactCount.ts:160:       // Log other errors but don't crash
024271| NOTE: Line comment documents intent or constraints.
024272| src/hooks/useFilterImpactCount.ts:161:       console.error("[useFilterImpactCount] Error fetching count:", error);
024273| NOTE: Implementation detail supporting search page behavior.
024274| src/hooks/useFilterImpactCount.ts:162: 
024275| NOTE: Blank line for visual separation.
024276| src/hooks/useFilterImpactCount.ts:163:       if (!abortController.signal.aborted) {
024277| NOTE: Conditional logic controlling rendering or flow.
024278| src/hooks/useFilterImpactCount.ts:164:         setIsLoading(false);
024279| NOTE: Implementation detail supporting search page behavior.
024280| src/hooks/useFilterImpactCount.ts:165:         setHasFetched(true);
024281| NOTE: Implementation detail supporting search page behavior.
024282| src/hooks/useFilterImpactCount.ts:166:       }
024283| NOTE: Implementation detail supporting search page behavior.
024284| src/hooks/useFilterImpactCount.ts:167:     }
024285| NOTE: Implementation detail supporting search page behavior.
024286| src/hooks/useFilterImpactCount.ts:168:   }, [cacheKey, searchParams, chip]);
024287| NOTE: Implementation detail supporting search page behavior.
024288| src/hooks/useFilterImpactCount.ts:169: 
024289| NOTE: Blank line for visual separation.
024290| src/hooks/useFilterImpactCount.ts:170:   // Effect to trigger debounced fetch on hover
024291| NOTE: Line comment documents intent or constraints.
024292| src/hooks/useFilterImpactCount.ts:171:   useEffect(() => {
024293| NOTE: Defines side effect for syncing with external state.
024294| src/hooks/useFilterImpactCount.ts:172:     // Clear any pending timeout
024295| NOTE: Line comment documents intent or constraints.
024296| src/hooks/useFilterImpactCount.ts:173:     if (debounceTimeoutRef.current) {
024297| NOTE: Conditional logic controlling rendering or flow.
024298| src/hooks/useFilterImpactCount.ts:174:       clearTimeout(debounceTimeoutRef.current);
024299| NOTE: Implementation detail supporting search page behavior.
024300| src/hooks/useFilterImpactCount.ts:175:       debounceTimeoutRef.current = null;
024301| NOTE: Implementation detail supporting search page behavior.
024302| src/hooks/useFilterImpactCount.ts:176:     }
024303| NOTE: Implementation detail supporting search page behavior.
024304| src/hooks/useFilterImpactCount.ts:177: 
024305| NOTE: Blank line for visual separation.
024306| src/hooks/useFilterImpactCount.ts:178:     // Only fetch when hovering and haven't fetched yet for this chip
024307| NOTE: Line comment documents intent or constraints.
024308| src/hooks/useFilterImpactCount.ts:179:     if (!isHovering || hasFetched) {
024309| NOTE: Conditional logic controlling rendering or flow.
024310| src/hooks/useFilterImpactCount.ts:180:       return;
024311| NOTE: Implementation detail supporting search page behavior.
024312| src/hooks/useFilterImpactCount.ts:181:     }
024313| NOTE: Implementation detail supporting search page behavior.
024314| src/hooks/useFilterImpactCount.ts:182: 
024315| NOTE: Blank line for visual separation.
024316| src/hooks/useFilterImpactCount.ts:183:     // Check cache immediately
024317| NOTE: Line comment documents intent or constraints.
024318| src/hooks/useFilterImpactCount.ts:184:     const cached = getCachedCount(cacheKey);
024319| NOTE: Local declaration used by search logic or UI.
024320| src/hooks/useFilterImpactCount.ts:185:     if (cached !== undefined) {
024321| NOTE: Conditional logic controlling rendering or flow.
024322| src/hooks/useFilterImpactCount.ts:186:       setCountWithoutFilter(cached);
024323| NOTE: Implementation detail supporting search page behavior.
024324| src/hooks/useFilterImpactCount.ts:187:       setHasFetched(true);
024325| NOTE: Implementation detail supporting search page behavior.
024326| src/hooks/useFilterImpactCount.ts:188:       return;
024327| NOTE: Implementation detail supporting search page behavior.
024328| src/hooks/useFilterImpactCount.ts:189:     }
024329| NOTE: Implementation detail supporting search page behavior.
024330| src/hooks/useFilterImpactCount.ts:190: 
024331| NOTE: Blank line for visual separation.
024332| src/hooks/useFilterImpactCount.ts:191:     // Debounce the fetch
024333| NOTE: Line comment documents intent or constraints.
024334| src/hooks/useFilterImpactCount.ts:192:     debounceTimeoutRef.current = setTimeout(() => {
024335| NOTE: Implementation detail supporting search page behavior.
024336| src/hooks/useFilterImpactCount.ts:193:       fetchCount();
024337| NOTE: Implementation detail supporting search page behavior.
024338| src/hooks/useFilterImpactCount.ts:194:     }, DEBOUNCE_MS);
024339| NOTE: Implementation detail supporting search page behavior.
024340| src/hooks/useFilterImpactCount.ts:195: 
024341| NOTE: Blank line for visual separation.
024342| src/hooks/useFilterImpactCount.ts:196:     // Cleanup on unmount or dependency change
024343| NOTE: Line comment documents intent or constraints.
024344| src/hooks/useFilterImpactCount.ts:197:     return () => {
024345| NOTE: Return statement for component or helper output.
024346| src/hooks/useFilterImpactCount.ts:198:       if (debounceTimeoutRef.current) {
024347| NOTE: Conditional logic controlling rendering or flow.
024348| src/hooks/useFilterImpactCount.ts:199:         clearTimeout(debounceTimeoutRef.current);
024349| NOTE: Implementation detail supporting search page behavior.
024350| src/hooks/useFilterImpactCount.ts:200:       }
024351| NOTE: Implementation detail supporting search page behavior.
024352| src/hooks/useFilterImpactCount.ts:201:       if (abortControllerRef.current) {
024353| NOTE: Conditional logic controlling rendering or flow.
024354| src/hooks/useFilterImpactCount.ts:202:         abortControllerRef.current.abort();
024355| NOTE: Implementation detail supporting search page behavior.
024356| src/hooks/useFilterImpactCount.ts:203:       }
024357| NOTE: Implementation detail supporting search page behavior.
024358| src/hooks/useFilterImpactCount.ts:204:     };
024359| NOTE: Implementation detail supporting search page behavior.
024360| src/hooks/useFilterImpactCount.ts:205:   }, [isHovering, hasFetched, cacheKey, fetchCount]);
024361| NOTE: Implementation detail supporting search page behavior.
024362| src/hooks/useFilterImpactCount.ts:206: 
024363| NOTE: Blank line for visual separation.
024364| src/hooks/useFilterImpactCount.ts:207:   // Reset hasFetched when chip changes
024365| NOTE: Line comment documents intent or constraints.
024366| src/hooks/useFilterImpactCount.ts:208:   useEffect(() => {
024367| NOTE: Defines side effect for syncing with external state.
024368| src/hooks/useFilterImpactCount.ts:209:     setHasFetched(false);
024369| NOTE: Implementation detail supporting search page behavior.
024370| src/hooks/useFilterImpactCount.ts:210:     setCountWithoutFilter(null);
024371| NOTE: Implementation detail supporting search page behavior.
024372| src/hooks/useFilterImpactCount.ts:211:   }, [chip.id]);
024373| NOTE: Implementation detail supporting search page behavior.
024374| src/hooks/useFilterImpactCount.ts:212: 
024375| NOTE: Blank line for visual separation.
024376| src/hooks/useFilterImpactCount.ts:213:   // Calculate delta
024377| NOTE: Line comment documents intent or constraints.
024378| src/hooks/useFilterImpactCount.ts:214:   let impactDelta: number | null = null;
024379| NOTE: Local declaration used by search logic or UI.
024380| src/hooks/useFilterImpactCount.ts:215:   if (countWithoutFilter !== null && currentCount !== null) {
024381| NOTE: Conditional logic controlling rendering or flow.
024382| src/hooks/useFilterImpactCount.ts:216:     impactDelta = countWithoutFilter - currentCount;
024383| NOTE: Implementation detail supporting search page behavior.
024384| src/hooks/useFilterImpactCount.ts:217:   } else if (countWithoutFilter !== null && currentCount === null) {
024385| NOTE: Implementation detail supporting search page behavior.
024386| src/hooks/useFilterImpactCount.ts:218:     // Current is 100+, so we can't calculate exact delta
024387| NOTE: Line comment documents intent or constraints.
024388| src/hooks/useFilterImpactCount.ts:219:     // If the count without filter is also null (100+), no meaningful delta
024389| NOTE: Line comment documents intent or constraints.
024390| src/hooks/useFilterImpactCount.ts:220:     impactDelta = null;
024391| NOTE: Implementation detail supporting search page behavior.
024392| src/hooks/useFilterImpactCount.ts:221:   }
024393| NOTE: Implementation detail supporting search page behavior.
024394| src/hooks/useFilterImpactCount.ts:222: 
024395| NOTE: Blank line for visual separation.
024396| src/hooks/useFilterImpactCount.ts:223:   // Format delta for display
024397| NOTE: Line comment documents intent or constraints.
024398| src/hooks/useFilterImpactCount.ts:224:   let formattedDelta: string | null = null;
024399| NOTE: Local declaration used by search logic or UI.
024400| src/hooks/useFilterImpactCount.ts:225:   if (impactDelta !== null && impactDelta > 0) {
024401| NOTE: Conditional logic controlling rendering or flow.
024402| src/hooks/useFilterImpactCount.ts:226:     formattedDelta = `+${impactDelta}`;
024403| NOTE: Implementation detail supporting search page behavior.
024404| src/hooks/useFilterImpactCount.ts:227:   } else if (countWithoutFilter === null && currentCount !== null) {
024405| NOTE: Implementation detail supporting search page behavior.
024406| src/hooks/useFilterImpactCount.ts:228:     // Removing the filter would result in 100+ results
024407| NOTE: Line comment documents intent or constraints.
024408| src/hooks/useFilterImpactCount.ts:229:     formattedDelta = "+100";
024409| NOTE: Implementation detail supporting search page behavior.
024410| src/hooks/useFilterImpactCount.ts:230:   }
024411| NOTE: Implementation detail supporting search page behavior.
024412| src/hooks/useFilterImpactCount.ts:231: 
024413| NOTE: Blank line for visual separation.
024414| src/hooks/useFilterImpactCount.ts:232:   return {
024415| NOTE: Return statement for component or helper output.
024416| src/hooks/useFilterImpactCount.ts:233:     impactDelta,
024417| NOTE: Implementation detail supporting search page behavior.
024418| src/hooks/useFilterImpactCount.ts:234:     isLoading,
024419| NOTE: Implementation detail supporting search page behavior.
024420| src/hooks/useFilterImpactCount.ts:235:     formattedDelta,
024421| NOTE: Implementation detail supporting search page behavior.
024422| src/hooks/useFilterImpactCount.ts:236:   };
024423| NOTE: Implementation detail supporting search page behavior.
024424| src/hooks/useFilterImpactCount.ts:237: }
024425| NOTE: Implementation detail supporting search page behavior.
024426| FILE END: src/hooks/useFilterImpactCount.ts
024427| 
024428| FILE START: src/hooks/useKeyboardShortcuts.ts
024429| FILE ROLE: Auto-discovered dependency in search page graph.
024430| src/hooks/useKeyboardShortcuts.ts:1: "use client";
024431| NOTE: Implementation detail supporting search page behavior.
024432| src/hooks/useKeyboardShortcuts.ts:2: 
024433| NOTE: Blank line for visual separation.
024434| src/hooks/useKeyboardShortcuts.ts:3: /**
024435| NOTE: Block comment line describing behavior or context.
024436| src/hooks/useKeyboardShortcuts.ts:4:  * useKeyboardShortcuts - Hook for managing global keyboard shortcuts
024437| NOTE: Block comment line describing behavior or context.
024438| src/hooks/useKeyboardShortcuts.ts:5:  *
024439| NOTE: Block comment line describing behavior or context.
024440| src/hooks/useKeyboardShortcuts.ts:6:  * Features:
024441| NOTE: Block comment line describing behavior or context.
024442| src/hooks/useKeyboardShortcuts.ts:7:  * - Configurable shortcuts with meta key (\u2318/Ctrl) support
024443| NOTE: Block comment line describing behavior or context.
024444| src/hooks/useKeyboardShortcuts.ts:8:  * - Context-aware activation (can be disabled when not applicable)
024445| NOTE: Block comment line describing behavior or context.
024446| src/hooks/useKeyboardShortcuts.ts:9:  * - Prevents default browser behavior when shortcuts match
024447| NOTE: Block comment line describing behavior or context.
024448| src/hooks/useKeyboardShortcuts.ts:10:  * - Accessibility-friendly (respects input focus)
024449| NOTE: Block comment line describing behavior or context.
024450| src/hooks/useKeyboardShortcuts.ts:11:  *
024451| NOTE: Block comment line describing behavior or context.
024452| src/hooks/useKeyboardShortcuts.ts:12:  * Implemented shortcuts:
024453| NOTE: Block comment line describing behavior or context.
024454| src/hooks/useKeyboardShortcuts.ts:13:  * - \u2318/Ctrl + K: Focus search input
024455| NOTE: Block comment line describing behavior or context.
024456| src/hooks/useKeyboardShortcuts.ts:14:  * - Escape: Close drawer/modal
024457| NOTE: Block comment line describing behavior or context.
024458| src/hooks/useKeyboardShortcuts.ts:15:  * - \u2318/Ctrl + Enter: Apply filters (in filter drawer)
024459| NOTE: Block comment line describing behavior or context.
024460| src/hooks/useKeyboardShortcuts.ts:16:  *
024461| NOTE: Block comment line describing behavior or context.
024462| src/hooks/useKeyboardShortcuts.ts:17:  * Note: We avoid \u2318/Ctrl + F as it conflicts with browser Find
024463| NOTE: Block comment line describing behavior or context.
024464| src/hooks/useKeyboardShortcuts.ts:18:  */
024465| NOTE: Block comment line describing behavior or context.
024466| src/hooks/useKeyboardShortcuts.ts:19: 
024467| NOTE: Blank line for visual separation.
024468| src/hooks/useKeyboardShortcuts.ts:20: import { useEffect, useCallback, useRef } from "react";
024469| NOTE: Imports dependency for this module.
024470| src/hooks/useKeyboardShortcuts.ts:21: 
024471| NOTE: Blank line for visual separation.
024472| src/hooks/useKeyboardShortcuts.ts:22: /**
024473| NOTE: Block comment line describing behavior or context.
024474| src/hooks/useKeyboardShortcuts.ts:23:  * Configuration for a single keyboard shortcut
024475| NOTE: Block comment line describing behavior or context.
024476| src/hooks/useKeyboardShortcuts.ts:24:  */
024477| NOTE: Block comment line describing behavior or context.
024478| src/hooks/useKeyboardShortcuts.ts:25: export interface ShortcutConfig {
024479| NOTE: Implementation detail supporting search page behavior.
024480| src/hooks/useKeyboardShortcuts.ts:26:   /** The key to listen for (e.g., 'k', 'Escape', 'Enter') */
024481| NOTE: Block comment line describing behavior or context.
024482| src/hooks/useKeyboardShortcuts.ts:27:   key: string;
024483| NOTE: Implementation detail supporting search page behavior.
024484| src/hooks/useKeyboardShortcuts.ts:28:   /** Whether meta key (\u2318/Ctrl) should be held */
024485| NOTE: Block comment line describing behavior or context.
024486| src/hooks/useKeyboardShortcuts.ts:29:   meta?: boolean;
024487| NOTE: Implementation detail supporting search page behavior.
024488| src/hooks/useKeyboardShortcuts.ts:30:   /** Whether shift key should be held */
024489| NOTE: Block comment line describing behavior or context.
024490| src/hooks/useKeyboardShortcuts.ts:31:   shift?: boolean;
024491| NOTE: Implementation detail supporting search page behavior.
024492| src/hooks/useKeyboardShortcuts.ts:32:   /** Action to execute when shortcut is triggered */
024493| NOTE: Block comment line describing behavior or context.
024494| src/hooks/useKeyboardShortcuts.ts:33:   action: () => void;
024495| NOTE: Implementation detail supporting search page behavior.
024496| src/hooks/useKeyboardShortcuts.ts:34:   /** Whether the shortcut is currently disabled */
024497| NOTE: Block comment line describing behavior or context.
024498| src/hooks/useKeyboardShortcuts.ts:35:   disabled?: boolean;
024499| NOTE: Implementation detail supporting search page behavior.
024500| src/hooks/useKeyboardShortcuts.ts:36:   /** Description for accessibility/help display */
024501| NOTE: Block comment line describing behavior or context.
024502| src/hooks/useKeyboardShortcuts.ts:37:   description?: string;
024503| NOTE: Implementation detail supporting search page behavior.
024504| src/hooks/useKeyboardShortcuts.ts:38:   /** Prevent shortcut when user is typing in an input */
024505| NOTE: Block comment line describing behavior or context.
024506| src/hooks/useKeyboardShortcuts.ts:39:   preventInInput?: boolean;
024507| NOTE: Implementation detail supporting search page behavior.
024508| src/hooks/useKeyboardShortcuts.ts:40: }
024509| NOTE: Implementation detail supporting search page behavior.
024510| src/hooks/useKeyboardShortcuts.ts:41: 
024511| NOTE: Blank line for visual separation.
024512| src/hooks/useKeyboardShortcuts.ts:42: /**
024513| NOTE: Block comment line describing behavior or context.
024514| src/hooks/useKeyboardShortcuts.ts:43:  * Options for the useKeyboardShortcuts hook
024515| NOTE: Block comment line describing behavior or context.
024516| src/hooks/useKeyboardShortcuts.ts:44:  */
024517| NOTE: Block comment line describing behavior or context.
024518| src/hooks/useKeyboardShortcuts.ts:45: export interface UseKeyboardShortcutsOptions {
024519| NOTE: Implementation detail supporting search page behavior.
024520| src/hooks/useKeyboardShortcuts.ts:46:   /** Whether all shortcuts are globally disabled */
024521| NOTE: Block comment line describing behavior or context.
024522| src/hooks/useKeyboardShortcuts.ts:47:   disabled?: boolean;
024523| NOTE: Implementation detail supporting search page behavior.
024524| src/hooks/useKeyboardShortcuts.ts:48: }
024525| NOTE: Implementation detail supporting search page behavior.
024526| src/hooks/useKeyboardShortcuts.ts:49: 
024527| NOTE: Blank line for visual separation.
024528| src/hooks/useKeyboardShortcuts.ts:50: /**
024529| NOTE: Block comment line describing behavior or context.
024530| src/hooks/useKeyboardShortcuts.ts:51:  * Check if the active element is an input-like element
024531| NOTE: Block comment line describing behavior or context.
024532| src/hooks/useKeyboardShortcuts.ts:52:  */
024533| NOTE: Block comment line describing behavior or context.
024534| src/hooks/useKeyboardShortcuts.ts:53: function isInputElement(element: Element | null): boolean {
024535| NOTE: Defines a helper or component function.
024536| src/hooks/useKeyboardShortcuts.ts:54:   if (!element) return false;
024537| NOTE: Conditional logic controlling rendering or flow.
024538| src/hooks/useKeyboardShortcuts.ts:55: 
024539| NOTE: Blank line for visual separation.
024540| src/hooks/useKeyboardShortcuts.ts:56:   const tagName = element.tagName.toLowerCase();
024541| NOTE: Local declaration used by search logic or UI.
024542| src/hooks/useKeyboardShortcuts.ts:57:   if (tagName === "input" || tagName === "textarea" || tagName === "select") {
024543| NOTE: Conditional logic controlling rendering or flow.
024544| src/hooks/useKeyboardShortcuts.ts:58:     return true;
024545| NOTE: Return statement for component or helper output.
024546| src/hooks/useKeyboardShortcuts.ts:59:   }
024547| NOTE: Implementation detail supporting search page behavior.
024548| src/hooks/useKeyboardShortcuts.ts:60: 
024549| NOTE: Blank line for visual separation.
024550| src/hooks/useKeyboardShortcuts.ts:61:   // Check for contenteditable
024551| NOTE: Line comment documents intent or constraints.
024552| src/hooks/useKeyboardShortcuts.ts:62:   if (element.getAttribute("contenteditable") === "true") {
024553| NOTE: Conditional logic controlling rendering or flow.
024554| src/hooks/useKeyboardShortcuts.ts:63:     return true;
024555| NOTE: Return statement for component or helper output.
024556| src/hooks/useKeyboardShortcuts.ts:64:   }
024557| NOTE: Implementation detail supporting search page behavior.
024558| src/hooks/useKeyboardShortcuts.ts:65: 
024559| NOTE: Blank line for visual separation.
024560| src/hooks/useKeyboardShortcuts.ts:66:   return false;
024561| NOTE: Return statement for component or helper output.
024562| src/hooks/useKeyboardShortcuts.ts:67: }
024563| NOTE: Implementation detail supporting search page behavior.
024564| src/hooks/useKeyboardShortcuts.ts:68: 
024565| NOTE: Blank line for visual separation.
024566| src/hooks/useKeyboardShortcuts.ts:69: /**
024567| NOTE: Block comment line describing behavior or context.
024568| src/hooks/useKeyboardShortcuts.ts:70:  * Hook for managing keyboard shortcuts
024569| NOTE: Block comment line describing behavior or context.
024570| src/hooks/useKeyboardShortcuts.ts:71:  *
024571| NOTE: Block comment line describing behavior or context.
024572| src/hooks/useKeyboardShortcuts.ts:72:  * @param shortcuts - Array of shortcut configurations
024573| NOTE: Block comment line describing behavior or context.
024574| src/hooks/useKeyboardShortcuts.ts:73:  * @param options - Hook options
024575| NOTE: Block comment line describing behavior or context.
024576| src/hooks/useKeyboardShortcuts.ts:74:  *
024577| NOTE: Block comment line describing behavior or context.
024578| src/hooks/useKeyboardShortcuts.ts:75:  * @example
024579| NOTE: Block comment line describing behavior or context.
024580| src/hooks/useKeyboardShortcuts.ts:76:  * ```tsx
024581| NOTE: Block comment line describing behavior or context.
024582| src/hooks/useKeyboardShortcuts.ts:77:  * useKeyboardShortcuts([
024583| NOTE: Block comment line describing behavior or context.
024584| src/hooks/useKeyboardShortcuts.ts:78:  *   { key: 'k', meta: true, action: () => searchInputRef.current?.focus() },
024585| NOTE: Block comment line describing behavior or context.
024586| src/hooks/useKeyboardShortcuts.ts:79:  *   { key: 'Escape', action: () => setDrawerOpen(false), disabled: !drawerOpen },
024587| NOTE: Block comment line describing behavior or context.
024588| src/hooks/useKeyboardShortcuts.ts:80:  * ]);
024589| NOTE: Block comment line describing behavior or context.
024590| src/hooks/useKeyboardShortcuts.ts:81:  * ```
024591| NOTE: Block comment line describing behavior or context.
024592| src/hooks/useKeyboardShortcuts.ts:82:  */
024593| NOTE: Block comment line describing behavior or context.
024594| src/hooks/useKeyboardShortcuts.ts:83: export function useKeyboardShortcuts(
024595| NOTE: Exports helper or component function.
024596| src/hooks/useKeyboardShortcuts.ts:84:   shortcuts: ShortcutConfig[],
024597| NOTE: Implementation detail supporting search page behavior.
024598| src/hooks/useKeyboardShortcuts.ts:85:   options: UseKeyboardShortcutsOptions = {},
024599| NOTE: Implementation detail supporting search page behavior.
024600| src/hooks/useKeyboardShortcuts.ts:86: ) {
024601| NOTE: Implementation detail supporting search page behavior.
024602| src/hooks/useKeyboardShortcuts.ts:87:   const { disabled: globallyDisabled = false } = options;
024603| NOTE: Local declaration used by search logic or UI.
024604| src/hooks/useKeyboardShortcuts.ts:88: 
024605| NOTE: Blank line for visual separation.
024606| src/hooks/useKeyboardShortcuts.ts:89:   // Use ref to avoid recreating handler on every shortcut change
024607| NOTE: Line comment documents intent or constraints.
024608| src/hooks/useKeyboardShortcuts.ts:90:   const shortcutsRef = useRef(shortcuts);
024609| NOTE: Uses ref for stable mutable storage between renders.
024610| src/hooks/useKeyboardShortcuts.ts:91: 
024611| NOTE: Blank line for visual separation.
024612| src/hooks/useKeyboardShortcuts.ts:92:   // Update ref value in effect to avoid accessing ref during render
024613| NOTE: Line comment documents intent or constraints.
024614| src/hooks/useKeyboardShortcuts.ts:93:   useEffect(() => {
024615| NOTE: Defines side effect for syncing with external state.
024616| src/hooks/useKeyboardShortcuts.ts:94:     shortcutsRef.current = shortcuts;
024617| NOTE: Implementation detail supporting search page behavior.
024618| src/hooks/useKeyboardShortcuts.ts:95:   }, [shortcuts]);
024619| NOTE: Implementation detail supporting search page behavior.
024620| src/hooks/useKeyboardShortcuts.ts:96: 
024621| NOTE: Blank line for visual separation.
024622| src/hooks/useKeyboardShortcuts.ts:97:   const handleKeyDown = useCallback(
024623| NOTE: Memoizes callback to preserve references across renders.
024624| src/hooks/useKeyboardShortcuts.ts:98:     (event: KeyboardEvent) => {
024625| NOTE: Implementation detail supporting search page behavior.
024626| src/hooks/useKeyboardShortcuts.ts:99:       if (globallyDisabled) return;
024627| NOTE: Conditional logic controlling rendering or flow.
024628| src/hooks/useKeyboardShortcuts.ts:100: 
024629| NOTE: Blank line for visual separation.
024630| src/hooks/useKeyboardShortcuts.ts:101:       const isMeta = event.metaKey || event.ctrlKey;
024631| NOTE: Local declaration used by search logic or UI.
024632| src/hooks/useKeyboardShortcuts.ts:102:       const isShift = event.shiftKey;
024633| NOTE: Local declaration used by search logic or UI.
024634| src/hooks/useKeyboardShortcuts.ts:103:       const activeElement = document.activeElement;
024635| NOTE: Local declaration used by search logic or UI.
024636| src/hooks/useKeyboardShortcuts.ts:104: 
024637| NOTE: Blank line for visual separation.
024638| src/hooks/useKeyboardShortcuts.ts:105:       for (const shortcut of shortcutsRef.current) {
024639| NOTE: Implementation detail supporting search page behavior.
024640| src/hooks/useKeyboardShortcuts.ts:106:         if (shortcut.disabled) continue;
024641| NOTE: Conditional logic controlling rendering or flow.
024642| src/hooks/useKeyboardShortcuts.ts:107: 
024643| NOTE: Blank line for visual separation.
024644| src/hooks/useKeyboardShortcuts.ts:108:         // Check if shortcut should be prevented in input elements
024645| NOTE: Line comment documents intent or constraints.
024646| src/hooks/useKeyboardShortcuts.ts:109:         if (shortcut.preventInInput && isInputElement(activeElement)) {
024647| NOTE: Conditional logic controlling rendering or flow.
024648| src/hooks/useKeyboardShortcuts.ts:110:           continue;
024649| NOTE: Implementation detail supporting search page behavior.
024650| src/hooks/useKeyboardShortcuts.ts:111:         }
024651| NOTE: Implementation detail supporting search page behavior.
024652| src/hooks/useKeyboardShortcuts.ts:112: 
024653| NOTE: Blank line for visual separation.
024654| src/hooks/useKeyboardShortcuts.ts:113:         // Match key (case-insensitive for letter keys)
024655| NOTE: Line comment documents intent or constraints.
024656| src/hooks/useKeyboardShortcuts.ts:114:         const keyMatches =
024657| NOTE: Local declaration used by search logic or UI.
024658| src/hooks/useKeyboardShortcuts.ts:115:           event.key.toLowerCase() === shortcut.key.toLowerCase() ||
024659| NOTE: Implementation detail supporting search page behavior.
024660| src/hooks/useKeyboardShortcuts.ts:116:           event.key === shortcut.key;
024661| NOTE: Implementation detail supporting search page behavior.
024662| src/hooks/useKeyboardShortcuts.ts:117: 
024663| NOTE: Blank line for visual separation.
024664| src/hooks/useKeyboardShortcuts.ts:118:         if (!keyMatches) continue;
024665| NOTE: Conditional logic controlling rendering or flow.
024666| src/hooks/useKeyboardShortcuts.ts:119: 
024667| NOTE: Blank line for visual separation.
024668| src/hooks/useKeyboardShortcuts.ts:120:         // Match meta key requirement
024669| NOTE: Line comment documents intent or constraints.
024670| src/hooks/useKeyboardShortcuts.ts:121:         const metaMatches = Boolean(shortcut.meta) === isMeta;
024671| NOTE: Local declaration used by search logic or UI.
024672| src/hooks/useKeyboardShortcuts.ts:122:         if (!metaMatches) continue;
024673| NOTE: Conditional logic controlling rendering or flow.
024674| src/hooks/useKeyboardShortcuts.ts:123: 
024675| NOTE: Blank line for visual separation.
024676| src/hooks/useKeyboardShortcuts.ts:124:         // Match shift key requirement (if specified)
024677| NOTE: Line comment documents intent or constraints.
024678| src/hooks/useKeyboardShortcuts.ts:125:         const shiftMatches =
024679| NOTE: Local declaration used by search logic or UI.
024680| src/hooks/useKeyboardShortcuts.ts:126:           shortcut.shift === undefined || Boolean(shortcut.shift) === isShift;
024681| NOTE: Implementation detail supporting search page behavior.
024682| src/hooks/useKeyboardShortcuts.ts:127:         if (!shiftMatches) continue;
024683| NOTE: Conditional logic controlling rendering or flow.
024684| src/hooks/useKeyboardShortcuts.ts:128: 
024685| NOTE: Blank line for visual separation.
024686| src/hooks/useKeyboardShortcuts.ts:129:         // All conditions match - execute action
024687| NOTE: Line comment documents intent or constraints.
024688| src/hooks/useKeyboardShortcuts.ts:130:         event.preventDefault();
024689| NOTE: Implementation detail supporting search page behavior.
024690| src/hooks/useKeyboardShortcuts.ts:131:         event.stopPropagation();
024691| NOTE: Implementation detail supporting search page behavior.
024692| src/hooks/useKeyboardShortcuts.ts:132:         shortcut.action();
024693| NOTE: Implementation detail supporting search page behavior.
024694| src/hooks/useKeyboardShortcuts.ts:133:         break; // Only execute first matching shortcut
024695| NOTE: Implementation detail supporting search page behavior.
024696| src/hooks/useKeyboardShortcuts.ts:134:       }
024697| NOTE: Implementation detail supporting search page behavior.
024698| src/hooks/useKeyboardShortcuts.ts:135:     },
024699| NOTE: Implementation detail supporting search page behavior.
024700| src/hooks/useKeyboardShortcuts.ts:136:     [globallyDisabled],
024701| NOTE: Implementation detail supporting search page behavior.
024702| src/hooks/useKeyboardShortcuts.ts:137:   );
024703| NOTE: Implementation detail supporting search page behavior.
024704| src/hooks/useKeyboardShortcuts.ts:138: 
024705| NOTE: Blank line for visual separation.
024706| src/hooks/useKeyboardShortcuts.ts:139:   useEffect(() => {
024707| NOTE: Defines side effect for syncing with external state.
024708| src/hooks/useKeyboardShortcuts.ts:140:     window.addEventListener("keydown", handleKeyDown);
024709| NOTE: Implementation detail supporting search page behavior.
024710| src/hooks/useKeyboardShortcuts.ts:141:     return () => window.removeEventListener("keydown", handleKeyDown);
024711| NOTE: Return statement for component or helper output.
024712| src/hooks/useKeyboardShortcuts.ts:142:   }, [handleKeyDown]);
024713| NOTE: Implementation detail supporting search page behavior.
024714| src/hooks/useKeyboardShortcuts.ts:143: }
024715| NOTE: Implementation detail supporting search page behavior.
024716| src/hooks/useKeyboardShortcuts.ts:144: 
024717| NOTE: Blank line for visual separation.
024718| src/hooks/useKeyboardShortcuts.ts:145: /**
024719| NOTE: Block comment line describing behavior or context.
024720| src/hooks/useKeyboardShortcuts.ts:146:  * Format a shortcut for display (e.g., "\u2318K" or "Ctrl+K")
024721| NOTE: Block comment line describing behavior or context.
024722| src/hooks/useKeyboardShortcuts.ts:147:  */
024723| NOTE: Block comment line describing behavior or context.
024724| src/hooks/useKeyboardShortcuts.ts:148: export function formatShortcut(
024725| NOTE: Exports helper or component function.
024726| src/hooks/useKeyboardShortcuts.ts:149:   config: Pick<ShortcutConfig, "key" | "meta" | "shift">,
024727| NOTE: Implementation detail supporting search page behavior.
024728| src/hooks/useKeyboardShortcuts.ts:150: ): string {
024729| NOTE: Implementation detail supporting search page behavior.
024730| src/hooks/useKeyboardShortcuts.ts:151:   const parts: string[] = [];
024731| NOTE: Local declaration used by search logic or UI.
024732| src/hooks/useKeyboardShortcuts.ts:152: 
024733| NOTE: Blank line for visual separation.
024734| src/hooks/useKeyboardShortcuts.ts:153:   // Detect platform for proper symbol
024735| NOTE: Line comment documents intent or constraints.
024736| src/hooks/useKeyboardShortcuts.ts:154:   const isMac =
024737| NOTE: Local declaration used by search logic or UI.
024738| src/hooks/useKeyboardShortcuts.ts:155:     typeof navigator !== "undefined" &&
024739| NOTE: Implementation detail supporting search page behavior.
024740| src/hooks/useKeyboardShortcuts.ts:156:     /Mac|iPod|iPhone|iPad/.test(navigator.platform);
024741| NOTE: Implementation detail supporting search page behavior.
024742| src/hooks/useKeyboardShortcuts.ts:157: 
024743| NOTE: Blank line for visual separation.
024744| src/hooks/useKeyboardShortcuts.ts:158:   if (config.meta) {
024745| NOTE: Conditional logic controlling rendering or flow.
024746| src/hooks/useKeyboardShortcuts.ts:159:     parts.push(isMac ? "\u2318" : "Ctrl");
024747| NOTE: Implementation detail supporting search page behavior.
024748| src/hooks/useKeyboardShortcuts.ts:160:   }
024749| NOTE: Implementation detail supporting search page behavior.
024750| src/hooks/useKeyboardShortcuts.ts:161:   if (config.shift) {
024751| NOTE: Conditional logic controlling rendering or flow.
024752| src/hooks/useKeyboardShortcuts.ts:162:     parts.push(isMac ? "\u21E7" : "Shift");
024753| NOTE: Implementation detail supporting search page behavior.
024754| src/hooks/useKeyboardShortcuts.ts:163:   }
024755| NOTE: Implementation detail supporting search page behavior.
024756| src/hooks/useKeyboardShortcuts.ts:164: 
024757| NOTE: Blank line for visual separation.
024758| src/hooks/useKeyboardShortcuts.ts:165:   // Format key display
024759| NOTE: Line comment documents intent or constraints.
024760| src/hooks/useKeyboardShortcuts.ts:166:   let keyDisplay = config.key;
024761| NOTE: Local declaration used by search logic or UI.
024762| src/hooks/useKeyboardShortcuts.ts:167:   if (config.key === "Escape") keyDisplay = "Esc";
024763| NOTE: Conditional logic controlling rendering or flow.
024764| src/hooks/useKeyboardShortcuts.ts:168:   if (config.key === "Enter") keyDisplay = "\u21B5";
024765| NOTE: Conditional logic controlling rendering or flow.
024766| src/hooks/useKeyboardShortcuts.ts:169:   if (config.key.length === 1) keyDisplay = config.key.toUpperCase();
024767| NOTE: Conditional logic controlling rendering or flow.
024768| src/hooks/useKeyboardShortcuts.ts:170: 
024769| NOTE: Blank line for visual separation.
024770| src/hooks/useKeyboardShortcuts.ts:171:   parts.push(keyDisplay);
024771| NOTE: Implementation detail supporting search page behavior.
024772| src/hooks/useKeyboardShortcuts.ts:172: 
024773| NOTE: Blank line for visual separation.
024774| src/hooks/useKeyboardShortcuts.ts:173:   // Join with + for Windows/Linux, nothing for Mac
024775| NOTE: Line comment documents intent or constraints.
024776| src/hooks/useKeyboardShortcuts.ts:174:   return isMac ? parts.join("") : parts.join("+");
024777| NOTE: Return statement for component or helper output.
024778| src/hooks/useKeyboardShortcuts.ts:175: }
024779| NOTE: Implementation detail supporting search page behavior.
024780| src/hooks/useKeyboardShortcuts.ts:176: 
024781| NOTE: Blank line for visual separation.
024782| src/hooks/useKeyboardShortcuts.ts:177: /**
024783| NOTE: Block comment line describing behavior or context.
024784| src/hooks/useKeyboardShortcuts.ts:178:  * Common shortcut presets for search functionality
024785| NOTE: Block comment line describing behavior or context.
024786| src/hooks/useKeyboardShortcuts.ts:179:  */
024787| NOTE: Block comment line describing behavior or context.
024788| src/hooks/useKeyboardShortcuts.ts:180: export const SEARCH_SHORTCUTS = {
024789| NOTE: Implementation detail supporting search page behavior.
024790| src/hooks/useKeyboardShortcuts.ts:181:   FOCUS_SEARCH: {
024791| NOTE: Implementation detail supporting search page behavior.
024792| src/hooks/useKeyboardShortcuts.ts:182:     key: "k",
024793| NOTE: Implementation detail supporting search page behavior.
024794| src/hooks/useKeyboardShortcuts.ts:183:     meta: true,
024795| NOTE: Implementation detail supporting search page behavior.
024796| src/hooks/useKeyboardShortcuts.ts:184:     description: "Focus search input",
024797| NOTE: Implementation detail supporting search page behavior.
024798| src/hooks/useKeyboardShortcuts.ts:185:   },
024799| NOTE: Implementation detail supporting search page behavior.
024800| src/hooks/useKeyboardShortcuts.ts:186:   CLOSE: {
024801| NOTE: Implementation detail supporting search page behavior.
024802| src/hooks/useKeyboardShortcuts.ts:187:     key: "Escape",
024803| NOTE: Implementation detail supporting search page behavior.
024804| src/hooks/useKeyboardShortcuts.ts:188:     meta: false,
024805| NOTE: Implementation detail supporting search page behavior.
024806| src/hooks/useKeyboardShortcuts.ts:189:     description: "Close drawer or modal",
024807| NOTE: Implementation detail supporting search page behavior.
024808| src/hooks/useKeyboardShortcuts.ts:190:   },
024809| NOTE: Implementation detail supporting search page behavior.
024810| src/hooks/useKeyboardShortcuts.ts:191:   APPLY_FILTERS: {
024811| NOTE: Implementation detail supporting search page behavior.
024812| src/hooks/useKeyboardShortcuts.ts:192:     key: "Enter",
024813| NOTE: Implementation detail supporting search page behavior.
024814| src/hooks/useKeyboardShortcuts.ts:193:     meta: true,
024815| NOTE: Implementation detail supporting search page behavior.
024816| src/hooks/useKeyboardShortcuts.ts:194:     description: "Apply filters",
024817| NOTE: Implementation detail supporting search page behavior.
024818| src/hooks/useKeyboardShortcuts.ts:195:   },
024819| NOTE: Implementation detail supporting search page behavior.
024820| src/hooks/useKeyboardShortcuts.ts:196: } as const;
024821| NOTE: Implementation detail supporting search page behavior.
024822| FILE END: src/hooks/useKeyboardShortcuts.ts
024823| 
024824| FILE START: src/hooks/useMapPreference.ts
024825| FILE ROLE: Auto-discovered dependency in search page graph.
024826| src/hooks/useMapPreference.ts:1: "use client";
024827| NOTE: Implementation detail supporting search page behavior.
024828| src/hooks/useMapPreference.ts:2: 
024829| NOTE: Blank line for visual separation.
024830| src/hooks/useMapPreference.ts:3: import { useState, useEffect, useCallback } from "react";
024831| NOTE: Imports dependency for this module.
024832| src/hooks/useMapPreference.ts:4: 
024833| NOTE: Blank line for visual separation.
024834| src/hooks/useMapPreference.ts:5: /**
024835| NOTE: Block comment line describing behavior or context.
024836| src/hooks/useMapPreference.ts:6:  * Map visibility preference hook with localStorage persistence.
024837| NOTE: Block comment line describing behavior or context.
024838| src/hooks/useMapPreference.ts:7:  *
024839| NOTE: Block comment line describing behavior or context.
024840| src/hooks/useMapPreference.ts:8:  * Cost optimization: Deferring map initialization until user opts in saves
024841| NOTE: Block comment line describing behavior or context.
024842| src/hooks/useMapPreference.ts:9:  * Mapbox billing (charged per Map object initialization, not page views).
024843| NOTE: Block comment line describing behavior or context.
024844| src/hooks/useMapPreference.ts:10:  *
024845| NOTE: Block comment line describing behavior or context.
024846| src/hooks/useMapPreference.ts:11:  * Defaults:
024847| NOTE: Block comment line describing behavior or context.
024848| src/hooks/useMapPreference.ts:12:  * - Mobile: list-only (biggest cost savings - most mobile users won't tap "Show Map")
024849| NOTE: Block comment line describing behavior or context.
024850| src/hooks/useMapPreference.ts:13:  * - Desktop: split view (user expectation for desktop search)
024851| NOTE: Block comment line describing behavior or context.
024852| src/hooks/useMapPreference.ts:14:  *
024853| NOTE: Block comment line describing behavior or context.
024854| src/hooks/useMapPreference.ts:15:  * Preferences are persisted in localStorage so returning users see their preference.
024855| NOTE: Block comment line describing behavior or context.
024856| src/hooks/useMapPreference.ts:16:  */
024857| NOTE: Block comment line describing behavior or context.
024858| src/hooks/useMapPreference.ts:17: 
024859| NOTE: Blank line for visual separation.
024860| src/hooks/useMapPreference.ts:18: type DesktopPreference = "split" | "list-only";
024861| NOTE: Type declaration for search data contracts.
024862| src/hooks/useMapPreference.ts:19: type MobilePreference = "list" | "map";
024863| NOTE: Type declaration for search data contracts.
024864| src/hooks/useMapPreference.ts:20: 
024865| NOTE: Blank line for visual separation.
024866| src/hooks/useMapPreference.ts:21: interface MapPreference {
024867| NOTE: Type declaration for search data contracts.
024868| src/hooks/useMapPreference.ts:22:   desktop: DesktopPreference;
024869| NOTE: Implementation detail supporting search page behavior.
024870| src/hooks/useMapPreference.ts:23:   mobile: MobilePreference;
024871| NOTE: Implementation detail supporting search page behavior.
024872| src/hooks/useMapPreference.ts:24: }
024873| NOTE: Implementation detail supporting search page behavior.
024874| src/hooks/useMapPreference.ts:25: 
024875| NOTE: Blank line for visual separation.
024876| src/hooks/useMapPreference.ts:26: const STORAGE_KEY = "roomshare-map-preference";
024877| NOTE: Local declaration used by search logic or UI.
024878| src/hooks/useMapPreference.ts:27: const DEFAULT_PREFERENCE: MapPreference = {
024879| NOTE: Local declaration used by search logic or UI.
024880| src/hooks/useMapPreference.ts:28:   desktop: "split",
024881| NOTE: Implementation detail supporting search page behavior.
024882| src/hooks/useMapPreference.ts:29:   mobile: "list",
024883| NOTE: Implementation detail supporting search page behavior.
024884| src/hooks/useMapPreference.ts:30: };
024885| NOTE: Implementation detail supporting search page behavior.
024886| src/hooks/useMapPreference.ts:31: 
024887| NOTE: Blank line for visual separation.
024888| src/hooks/useMapPreference.ts:32: /**
024889| NOTE: Block comment line describing behavior or context.
024890| src/hooks/useMapPreference.ts:33:  * Safe localStorage access (handles SSR, private browsing, etc.)
024891| NOTE: Block comment line describing behavior or context.
024892| src/hooks/useMapPreference.ts:34:  */
024893| NOTE: Block comment line describing behavior or context.
024894| src/hooks/useMapPreference.ts:35: function getStoredPreference(): MapPreference | null {
024895| NOTE: Defines a helper or component function.
024896| src/hooks/useMapPreference.ts:36:   if (typeof window === "undefined") return null;
024897| NOTE: Conditional logic controlling rendering or flow.
024898| src/hooks/useMapPreference.ts:37:   try {
024899| NOTE: Implementation detail supporting search page behavior.
024900| src/hooks/useMapPreference.ts:38:     const stored = localStorage.getItem(STORAGE_KEY);
024901| NOTE: Local declaration used by search logic or UI.
024902| src/hooks/useMapPreference.ts:39:     if (!stored) return null;
024903| NOTE: Conditional logic controlling rendering or flow.
024904| src/hooks/useMapPreference.ts:40:     const parsed = JSON.parse(stored);
024905| NOTE: Local declaration used by search logic or UI.
024906| src/hooks/useMapPreference.ts:41:     // Validate shape
024907| NOTE: Line comment documents intent or constraints.
024908| src/hooks/useMapPreference.ts:42:     if (
024909| NOTE: Conditional logic controlling rendering or flow.
024910| src/hooks/useMapPreference.ts:43:       typeof parsed === "object" &&
024911| NOTE: Implementation detail supporting search page behavior.
024912| src/hooks/useMapPreference.ts:44:       (parsed.desktop === "split" || parsed.desktop === "list-only") &&
024913| NOTE: Implementation detail supporting search page behavior.
024914| src/hooks/useMapPreference.ts:45:       (parsed.mobile === "list" || parsed.mobile === "map")
024915| NOTE: Implementation detail supporting search page behavior.
024916| src/hooks/useMapPreference.ts:46:     ) {
024917| NOTE: Implementation detail supporting search page behavior.
024918| src/hooks/useMapPreference.ts:47:       return parsed as MapPreference;
024919| NOTE: Return statement for component or helper output.
024920| src/hooks/useMapPreference.ts:48:     }
024921| NOTE: Implementation detail supporting search page behavior.
024922| src/hooks/useMapPreference.ts:49:     return null;
024923| NOTE: Return statement for component or helper output.
024924| src/hooks/useMapPreference.ts:50:   } catch {
024925| NOTE: Implementation detail supporting search page behavior.
024926| src/hooks/useMapPreference.ts:51:     return null;
024927| NOTE: Return statement for component or helper output.
024928| src/hooks/useMapPreference.ts:52:   }
024929| NOTE: Implementation detail supporting search page behavior.
024930| src/hooks/useMapPreference.ts:53: }
024931| NOTE: Implementation detail supporting search page behavior.
024932| src/hooks/useMapPreference.ts:54: 
024933| NOTE: Blank line for visual separation.
024934| src/hooks/useMapPreference.ts:55: function setStoredPreference(pref: MapPreference): void {
024935| NOTE: Defines a helper or component function.
024936| src/hooks/useMapPreference.ts:56:   if (typeof window === "undefined") return;
024937| NOTE: Conditional logic controlling rendering or flow.
024938| src/hooks/useMapPreference.ts:57:   try {
024939| NOTE: Implementation detail supporting search page behavior.
024940| src/hooks/useMapPreference.ts:58:     localStorage.setItem(STORAGE_KEY, JSON.stringify(pref));
024941| NOTE: Implementation detail supporting search page behavior.
024942| src/hooks/useMapPreference.ts:59:   } catch {
024943| NOTE: Implementation detail supporting search page behavior.
024944| src/hooks/useMapPreference.ts:60:     // localStorage unavailable (private browsing, etc.) - fail silently
024945| NOTE: Line comment documents intent or constraints.
024946| src/hooks/useMapPreference.ts:61:   }
024947| NOTE: Implementation detail supporting search page behavior.
024948| src/hooks/useMapPreference.ts:62: }
024949| NOTE: Implementation detail supporting search page behavior.
024950| src/hooks/useMapPreference.ts:63: 
024951| NOTE: Blank line for visual separation.
024952| src/hooks/useMapPreference.ts:64: /**
024953| NOTE: Block comment line describing behavior or context.
024954| src/hooks/useMapPreference.ts:65:  * Hook for managing map visibility preference with localStorage persistence.
024955| NOTE: Block comment line describing behavior or context.
024956| src/hooks/useMapPreference.ts:66:  *
024957| NOTE: Block comment line describing behavior or context.
024958| src/hooks/useMapPreference.ts:67:  * Returns:
024959| NOTE: Block comment line describing behavior or context.
024960| src/hooks/useMapPreference.ts:68:  * - shouldShowMap: Whether map should be visible (accounts for device type)
024961| NOTE: Block comment line describing behavior or context.
024962| src/hooks/useMapPreference.ts:69:  * - shouldRenderMap: Whether map component should mount (for lazy init)
024963| NOTE: Block comment line describing behavior or context.
024964| src/hooks/useMapPreference.ts:70:  * - toggleMap: Toggle map visibility for current device type
024965| NOTE: Block comment line describing behavior or context.
024966| src/hooks/useMapPreference.ts:71:  * - isMobile: Current device type detection
024967| NOTE: Block comment line describing behavior or context.
024968| src/hooks/useMapPreference.ts:72:  * - isLoading: True during hydration (prevents flash of wrong state)
024969| NOTE: Block comment line describing behavior or context.
024970| src/hooks/useMapPreference.ts:73:  */
024971| NOTE: Block comment line describing behavior or context.
024972| src/hooks/useMapPreference.ts:74: export function useMapPreference() {
024973| NOTE: Exports helper or component function.
024974| src/hooks/useMapPreference.ts:75:   const [preference, setPreference] =
024975| NOTE: Local declaration used by search logic or UI.
024976| src/hooks/useMapPreference.ts:76:     useState<MapPreference>(DEFAULT_PREFERENCE);
024977| NOTE: Initializes local state for search UI behavior.
024978| src/hooks/useMapPreference.ts:77:   const [isMobile, setIsMobile] = useState(false);
024979| NOTE: Initializes local state for search UI behavior.
024980| src/hooks/useMapPreference.ts:78:   const [isHydrated, setIsHydrated] = useState(false);
024981| NOTE: Initializes local state for search UI behavior.
024982| src/hooks/useMapPreference.ts:79: 
024983| NOTE: Blank line for visual separation.
024984| src/hooks/useMapPreference.ts:80:   // Hydrate from localStorage on mount
024985| NOTE: Line comment documents intent or constraints.
024986| src/hooks/useMapPreference.ts:81:   useEffect(() => {
024987| NOTE: Defines side effect for syncing with external state.
024988| src/hooks/useMapPreference.ts:82:     const stored = getStoredPreference();
024989| NOTE: Local declaration used by search logic or UI.
024990| src/hooks/useMapPreference.ts:83:     if (stored) {
024991| NOTE: Conditional logic controlling rendering or flow.
024992| src/hooks/useMapPreference.ts:84:       setPreference(stored);
024993| NOTE: Implementation detail supporting search page behavior.
024994| src/hooks/useMapPreference.ts:85:     }
024995| NOTE: Implementation detail supporting search page behavior.
024996| src/hooks/useMapPreference.ts:86: 
024997| NOTE: Blank line for visual separation.
024998| src/hooks/useMapPreference.ts:87:     // Detect mobile (matches md: breakpoint at 768px)
024999| NOTE: Line comment documents intent or constraints.
025000| src/hooks/useMapPreference.ts:88:     const mql = window.matchMedia("(max-width: 767px)");
025001| NOTE: Local declaration used by search logic or UI.
025002| src/hooks/useMapPreference.ts:89:     setIsMobile(mql.matches);
025003| NOTE: Implementation detail supporting search page behavior.
025004| src/hooks/useMapPreference.ts:90: 
025005| NOTE: Blank line for visual separation.
025006| src/hooks/useMapPreference.ts:91:     const handleChange = (e: MediaQueryListEvent) => {
025007| NOTE: Local declaration used by search logic or UI.
025008| src/hooks/useMapPreference.ts:92:       setIsMobile(e.matches);
025009| NOTE: Implementation detail supporting search page behavior.
025010| src/hooks/useMapPreference.ts:93:     };
025011| NOTE: Implementation detail supporting search page behavior.
025012| src/hooks/useMapPreference.ts:94:     mql.addEventListener("change", handleChange);
025013| NOTE: Implementation detail supporting search page behavior.
025014| src/hooks/useMapPreference.ts:95: 
025015| NOTE: Blank line for visual separation.
025016| src/hooks/useMapPreference.ts:96:     setIsHydrated(true);
025017| NOTE: Implementation detail supporting search page behavior.
025018| src/hooks/useMapPreference.ts:97: 
025019| NOTE: Blank line for visual separation.
025020| src/hooks/useMapPreference.ts:98:     return () => mql.removeEventListener("change", handleChange);
025021| NOTE: Return statement for component or helper output.
025022| src/hooks/useMapPreference.ts:99:   }, []);
025023| NOTE: Implementation detail supporting search page behavior.
025024| src/hooks/useMapPreference.ts:100: 
025025| NOTE: Blank line for visual separation.
025026| src/hooks/useMapPreference.ts:101:   // Compute current visibility based on device type
025027| NOTE: Line comment documents intent or constraints.
025028| src/hooks/useMapPreference.ts:102:   const shouldShowMap = isMobile
025029| NOTE: Local declaration used by search logic or UI.
025030| src/hooks/useMapPreference.ts:103:     ? preference.mobile === "map"
025031| NOTE: Implementation detail supporting search page behavior.
025032| src/hooks/useMapPreference.ts:104:     : preference.desktop === "split";
025033| NOTE: Implementation detail supporting search page behavior.
025034| src/hooks/useMapPreference.ts:105: 
025035| NOTE: Blank line for visual separation.
025036| src/hooks/useMapPreference.ts:106:   // Map should only render if user wants to see it
025037| NOTE: Line comment documents intent or constraints.
025038| src/hooks/useMapPreference.ts:107:   // This is the key for cost savings - don't mount MapGL until needed
025039| NOTE: Line comment documents intent or constraints.
025040| src/hooks/useMapPreference.ts:108:   const shouldRenderMap = shouldShowMap;
025041| NOTE: Local declaration used by search logic or UI.
025042| src/hooks/useMapPreference.ts:109: 
025043| NOTE: Blank line for visual separation.
025044| src/hooks/useMapPreference.ts:110:   const toggleMap = useCallback(() => {
025045| NOTE: Memoizes callback to preserve references across renders.
025046| src/hooks/useMapPreference.ts:111:     setPreference((prev) => {
025047| NOTE: Implementation detail supporting search page behavior.
025048| src/hooks/useMapPreference.ts:112:       const next = { ...prev };
025049| NOTE: Local declaration used by search logic or UI.
025050| src/hooks/useMapPreference.ts:113:       if (isMobile) {
025051| NOTE: Conditional logic controlling rendering or flow.
025052| src/hooks/useMapPreference.ts:114:         next.mobile = prev.mobile === "list" ? "map" : "list";
025053| NOTE: Implementation detail supporting search page behavior.
025054| src/hooks/useMapPreference.ts:115:       } else {
025055| NOTE: Implementation detail supporting search page behavior.
025056| src/hooks/useMapPreference.ts:116:         next.desktop = prev.desktop === "split" ? "list-only" : "split";
025057| NOTE: Implementation detail supporting search page behavior.
025058| src/hooks/useMapPreference.ts:117:       }
025059| NOTE: Implementation detail supporting search page behavior.
025060| src/hooks/useMapPreference.ts:118:       setStoredPreference(next);
025061| NOTE: Implementation detail supporting search page behavior.
025062| src/hooks/useMapPreference.ts:119:       return next;
025063| NOTE: Return statement for component or helper output.
025064| src/hooks/useMapPreference.ts:120:     });
025065| NOTE: Implementation detail supporting search page behavior.
025066| src/hooks/useMapPreference.ts:121:   }, [isMobile]);
025067| NOTE: Implementation detail supporting search page behavior.
025068| src/hooks/useMapPreference.ts:122: 
025069| NOTE: Blank line for visual separation.
025070| src/hooks/useMapPreference.ts:123:   // For explicit show/hide (desktop "Hide map" button)
025071| NOTE: Line comment documents intent or constraints.
025072| src/hooks/useMapPreference.ts:124:   const showMap = useCallback(() => {
025073| NOTE: Memoizes callback to preserve references across renders.
025074| src/hooks/useMapPreference.ts:125:     setPreference((prev) => {
025075| NOTE: Implementation detail supporting search page behavior.
025076| src/hooks/useMapPreference.ts:126:       const next = { ...prev };
025077| NOTE: Local declaration used by search logic or UI.
025078| src/hooks/useMapPreference.ts:127:       if (isMobile) {
025079| NOTE: Conditional logic controlling rendering or flow.
025080| src/hooks/useMapPreference.ts:128:         next.mobile = "map";
025081| NOTE: Implementation detail supporting search page behavior.
025082| src/hooks/useMapPreference.ts:129:       } else {
025083| NOTE: Implementation detail supporting search page behavior.
025084| src/hooks/useMapPreference.ts:130:         next.desktop = "split";
025085| NOTE: Implementation detail supporting search page behavior.
025086| src/hooks/useMapPreference.ts:131:       }
025087| NOTE: Implementation detail supporting search page behavior.
025088| src/hooks/useMapPreference.ts:132:       setStoredPreference(next);
025089| NOTE: Implementation detail supporting search page behavior.
025090| src/hooks/useMapPreference.ts:133:       return next;
025091| NOTE: Return statement for component or helper output.
025092| src/hooks/useMapPreference.ts:134:     });
025093| NOTE: Implementation detail supporting search page behavior.
025094| src/hooks/useMapPreference.ts:135:   }, [isMobile]);
025095| NOTE: Implementation detail supporting search page behavior.
025096| src/hooks/useMapPreference.ts:136: 
025097| NOTE: Blank line for visual separation.
025098| src/hooks/useMapPreference.ts:137:   const hideMap = useCallback(() => {
025099| NOTE: Memoizes callback to preserve references across renders.
025100| src/hooks/useMapPreference.ts:138:     setPreference((prev) => {
025101| NOTE: Implementation detail supporting search page behavior.
025102| src/hooks/useMapPreference.ts:139:       const next = { ...prev };
025103| NOTE: Local declaration used by search logic or UI.
025104| src/hooks/useMapPreference.ts:140:       if (isMobile) {
025105| NOTE: Conditional logic controlling rendering or flow.
025106| src/hooks/useMapPreference.ts:141:         next.mobile = "list";
025107| NOTE: Implementation detail supporting search page behavior.
025108| src/hooks/useMapPreference.ts:142:       } else {
025109| NOTE: Implementation detail supporting search page behavior.
025110| src/hooks/useMapPreference.ts:143:         next.desktop = "list-only";
025111| NOTE: Implementation detail supporting search page behavior.
025112| src/hooks/useMapPreference.ts:144:       }
025113| NOTE: Implementation detail supporting search page behavior.
025114| src/hooks/useMapPreference.ts:145:       setStoredPreference(next);
025115| NOTE: Implementation detail supporting search page behavior.
025116| src/hooks/useMapPreference.ts:146:       return next;
025117| NOTE: Return statement for component or helper output.
025118| src/hooks/useMapPreference.ts:147:     });
025119| NOTE: Implementation detail supporting search page behavior.
025120| src/hooks/useMapPreference.ts:148:   }, [isMobile]);
025121| NOTE: Implementation detail supporting search page behavior.
025122| src/hooks/useMapPreference.ts:149: 
025123| NOTE: Blank line for visual separation.
025124| src/hooks/useMapPreference.ts:150:   return {
025125| NOTE: Return statement for component or helper output.
025126| src/hooks/useMapPreference.ts:151:     shouldShowMap,
025127| NOTE: Implementation detail supporting search page behavior.
025128| src/hooks/useMapPreference.ts:152:     shouldRenderMap,
025129| NOTE: Implementation detail supporting search page behavior.
025130| src/hooks/useMapPreference.ts:153:     toggleMap,
025131| NOTE: Implementation detail supporting search page behavior.
025132| src/hooks/useMapPreference.ts:154:     showMap,
025133| NOTE: Implementation detail supporting search page behavior.
025134| src/hooks/useMapPreference.ts:155:     hideMap,
025135| NOTE: Implementation detail supporting search page behavior.
025136| src/hooks/useMapPreference.ts:156:     isMobile,
025137| NOTE: Implementation detail supporting search page behavior.
025138| src/hooks/useMapPreference.ts:157:     isLoading: !isHydrated,
025139| NOTE: Implementation detail supporting search page behavior.
025140| src/hooks/useMapPreference.ts:158:   };
025141| NOTE: Implementation detail supporting search page behavior.
025142| src/hooks/useMapPreference.ts:159: }
025143| NOTE: Implementation detail supporting search page behavior.
025144| FILE END: src/hooks/useMapPreference.ts
025145| 
025146| FILE START: src/hooks/useRecentSearches.ts
025147| FILE ROLE: Auto-discovered dependency in search page graph.
025148| src/hooks/useRecentSearches.ts:1: "use client";
025149| NOTE: Implementation detail supporting search page behavior.
025150| src/hooks/useRecentSearches.ts:2: 
025151| NOTE: Blank line for visual separation.
025152| src/hooks/useRecentSearches.ts:3: /**
025153| NOTE: Block comment line describing behavior or context.
025154| src/hooks/useRecentSearches.ts:4:  * useRecentSearches - Hook for managing recent search history
025155| NOTE: Block comment line describing behavior or context.
025156| src/hooks/useRecentSearches.ts:5:  *
025157| NOTE: Block comment line describing behavior or context.
025158| src/hooks/useRecentSearches.ts:6:  * Features:
025159| NOTE: Block comment line describing behavior or context.
025160| src/hooks/useRecentSearches.ts:7:  * - Stores recent searches with full filter state
025161| NOTE: Block comment line describing behavior or context.
025162| src/hooks/useRecentSearches.ts:8:  * - Migrates old format (location-only) to new format (with filters)
025163| NOTE: Block comment line describing behavior or context.
025164| src/hooks/useRecentSearches.ts:9:  * - Formats searches for display: "Austin \u00B7 $500-1000 \u00B7 Wifi, Parking"
025165| NOTE: Block comment line describing behavior or context.
025166| src/hooks/useRecentSearches.ts:10:  * - Manages localStorage with error handling
025167| NOTE: Block comment line describing behavior or context.
025168| src/hooks/useRecentSearches.ts:11:  * - Max 5 entries, deduped by location
025169| NOTE: Block comment line describing behavior or context.
025170| src/hooks/useRecentSearches.ts:12:  */
025171| NOTE: Block comment line describing behavior or context.
025172| src/hooks/useRecentSearches.ts:13: 
025173| NOTE: Blank line for visual separation.
025174| src/hooks/useRecentSearches.ts:14: import { useState, useEffect, useCallback } from "react";
025175| NOTE: Imports dependency for this module.
025176| src/hooks/useRecentSearches.ts:15: 
025177| NOTE: Blank line for visual separation.
025178| src/hooks/useRecentSearches.ts:16: // Storage key and limits
025179| NOTE: Line comment documents intent or constraints.
025180| src/hooks/useRecentSearches.ts:17: const RECENT_SEARCHES_KEY = "roomshare-recent-searches";
025181| NOTE: Local declaration used by search logic or UI.
025182| src/hooks/useRecentSearches.ts:18: const MAX_RECENT_SEARCHES = 5;
025183| NOTE: Local declaration used by search logic or UI.
025184| src/hooks/useRecentSearches.ts:19: 
025185| NOTE: Blank line for visual separation.
025186| src/hooks/useRecentSearches.ts:20: /**
025187| NOTE: Block comment line describing behavior or context.
025188| src/hooks/useRecentSearches.ts:21:  * Filter state stored with each recent search
025189| NOTE: Block comment line describing behavior or context.
025190| src/hooks/useRecentSearches.ts:22:  */
025191| NOTE: Block comment line describing behavior or context.
025192| src/hooks/useRecentSearches.ts:23: export interface RecentSearchFilters {
025193| NOTE: Implementation detail supporting search page behavior.
025194| src/hooks/useRecentSearches.ts:24:   minPrice?: string;
025195| NOTE: Implementation detail supporting search page behavior.
025196| src/hooks/useRecentSearches.ts:25:   maxPrice?: string;
025197| NOTE: Implementation detail supporting search page behavior.
025198| src/hooks/useRecentSearches.ts:26:   roomType?: string;
025199| NOTE: Implementation detail supporting search page behavior.
025200| src/hooks/useRecentSearches.ts:27:   amenities?: string[];
025201| NOTE: Implementation detail supporting search page behavior.
025202| src/hooks/useRecentSearches.ts:28:   leaseDuration?: string;
025203| NOTE: Implementation detail supporting search page behavior.
025204| src/hooks/useRecentSearches.ts:29:   houseRules?: string[];
025205| NOTE: Implementation detail supporting search page behavior.
025206| src/hooks/useRecentSearches.ts:30: }
025207| NOTE: Implementation detail supporting search page behavior.
025208| src/hooks/useRecentSearches.ts:31: 
025209| NOTE: Blank line for visual separation.
025210| src/hooks/useRecentSearches.ts:32: /**
025211| NOTE: Block comment line describing behavior or context.
025212| src/hooks/useRecentSearches.ts:33:  * Enhanced recent search structure with full filter state
025213| NOTE: Block comment line describing behavior or context.
025214| src/hooks/useRecentSearches.ts:34:  */
025215| NOTE: Block comment line describing behavior or context.
025216| src/hooks/useRecentSearches.ts:35: export interface RecentSearch {
025217| NOTE: Implementation detail supporting search page behavior.
025218| src/hooks/useRecentSearches.ts:36:   /** Unique identifier for React keys */
025219| NOTE: Block comment line describing behavior or context.
025220| src/hooks/useRecentSearches.ts:37:   id: string;
025221| NOTE: Implementation detail supporting search page behavior.
025222| src/hooks/useRecentSearches.ts:38:   /** Display location (e.g., "Austin, TX") */
025223| NOTE: Block comment line describing behavior or context.
025224| src/hooks/useRecentSearches.ts:39:   location: string;
025225| NOTE: Implementation detail supporting search page behavior.
025226| src/hooks/useRecentSearches.ts:40:   /** Optional geocoded coordinates */
025227| NOTE: Block comment line describing behavior or context.
025228| src/hooks/useRecentSearches.ts:41:   coords?: { lat: number; lng: number };
025229| NOTE: Implementation detail supporting search page behavior.
025230| src/hooks/useRecentSearches.ts:42:   /** When the search was saved */
025231| NOTE: Block comment line describing behavior or context.
025232| src/hooks/useRecentSearches.ts:43:   timestamp: number;
025233| NOTE: Implementation detail supporting search page behavior.
025234| src/hooks/useRecentSearches.ts:44:   /** Applied filters at time of search */
025235| NOTE: Block comment line describing behavior or context.
025236| src/hooks/useRecentSearches.ts:45:   filters: RecentSearchFilters;
025237| NOTE: Implementation detail supporting search page behavior.
025238| src/hooks/useRecentSearches.ts:46:   /** Optional result count when search was saved */
025239| NOTE: Block comment line describing behavior or context.
025240| src/hooks/useRecentSearches.ts:47:   resultCount?: number;
025241| NOTE: Implementation detail supporting search page behavior.
025242| src/hooks/useRecentSearches.ts:48: }
025243| NOTE: Implementation detail supporting search page behavior.
025244| src/hooks/useRecentSearches.ts:49: 
025245| NOTE: Blank line for visual separation.
025246| src/hooks/useRecentSearches.ts:50: /**
025247| NOTE: Block comment line describing behavior or context.
025248| src/hooks/useRecentSearches.ts:51:  * Legacy format for migration (pre-P2-11)
025249| NOTE: Block comment line describing behavior or context.
025250| src/hooks/useRecentSearches.ts:52:  */
025251| NOTE: Block comment line describing behavior or context.
025252| src/hooks/useRecentSearches.ts:53: interface LegacyRecentSearch {
025253| NOTE: Type declaration for search data contracts.
025254| src/hooks/useRecentSearches.ts:54:   location: string;
025255| NOTE: Implementation detail supporting search page behavior.
025256| src/hooks/useRecentSearches.ts:55:   coords?: { lat: number; lng: number };
025257| NOTE: Implementation detail supporting search page behavior.
025258| src/hooks/useRecentSearches.ts:56:   timestamp: number;
025259| NOTE: Implementation detail supporting search page behavior.
025260| src/hooks/useRecentSearches.ts:57: }
025261| NOTE: Implementation detail supporting search page behavior.
025262| src/hooks/useRecentSearches.ts:58: 
025263| NOTE: Blank line for visual separation.
025264| src/hooks/useRecentSearches.ts:59: /**
025265| NOTE: Block comment line describing behavior or context.
025266| src/hooks/useRecentSearches.ts:60:  * Generate a simple unique ID for React keys
025267| NOTE: Block comment line describing behavior or context.
025268| src/hooks/useRecentSearches.ts:61:  */
025269| NOTE: Block comment line describing behavior or context.
025270| src/hooks/useRecentSearches.ts:62: function generateId(): string {
025271| NOTE: Defines a helper or component function.
025272| src/hooks/useRecentSearches.ts:63:   return `${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;
025273| NOTE: Return statement for component or helper output.
025274| src/hooks/useRecentSearches.ts:64: }
025275| NOTE: Implementation detail supporting search page behavior.
025276| src/hooks/useRecentSearches.ts:65: 
025277| NOTE: Blank line for visual separation.
025278| src/hooks/useRecentSearches.ts:66: /**
025279| NOTE: Block comment line describing behavior or context.
025280| src/hooks/useRecentSearches.ts:67:  * Check if a search entry is in the legacy format
025281| NOTE: Block comment line describing behavior or context.
025282| src/hooks/useRecentSearches.ts:68:  */
025283| NOTE: Block comment line describing behavior or context.
025284| src/hooks/useRecentSearches.ts:69: function isLegacyFormat(
025285| NOTE: Defines a helper or component function.
025286| src/hooks/useRecentSearches.ts:70:   search: RecentSearch | LegacyRecentSearch,
025287| NOTE: Implementation detail supporting search page behavior.
025288| src/hooks/useRecentSearches.ts:71: ): search is LegacyRecentSearch {
025289| NOTE: Implementation detail supporting search page behavior.
025290| src/hooks/useRecentSearches.ts:72:   return !("id" in search) || !("filters" in search);
025291| NOTE: Return statement for component or helper output.
025292| src/hooks/useRecentSearches.ts:73: }
025293| NOTE: Implementation detail supporting search page behavior.
025294| src/hooks/useRecentSearches.ts:74: 
025295| NOTE: Blank line for visual separation.
025296| src/hooks/useRecentSearches.ts:75: /**
025297| NOTE: Block comment line describing behavior or context.
025298| src/hooks/useRecentSearches.ts:76:  * Migrate a legacy search entry to the new format
025299| NOTE: Block comment line describing behavior or context.
025300| src/hooks/useRecentSearches.ts:77:  */
025301| NOTE: Block comment line describing behavior or context.
025302| src/hooks/useRecentSearches.ts:78: function migrateLegacySearch(legacy: LegacyRecentSearch): RecentSearch {
025303| NOTE: Defines a helper or component function.
025304| src/hooks/useRecentSearches.ts:79:   return {
025305| NOTE: Return statement for component or helper output.
025306| src/hooks/useRecentSearches.ts:80:     id: generateId(),
025307| NOTE: Implementation detail supporting search page behavior.
025308| src/hooks/useRecentSearches.ts:81:     location: legacy.location,
025309| NOTE: Implementation detail supporting search page behavior.
025310| src/hooks/useRecentSearches.ts:82:     coords: legacy.coords,
025311| NOTE: Implementation detail supporting search page behavior.
025312| src/hooks/useRecentSearches.ts:83:     timestamp: legacy.timestamp,
025313| NOTE: Implementation detail supporting search page behavior.
025314| src/hooks/useRecentSearches.ts:84:     filters: {}, // Empty filters for migrated entries
025315| NOTE: Implementation detail supporting search page behavior.
025316| src/hooks/useRecentSearches.ts:85:   };
025317| NOTE: Implementation detail supporting search page behavior.
025318| src/hooks/useRecentSearches.ts:86: }
025319| NOTE: Implementation detail supporting search page behavior.
025320| src/hooks/useRecentSearches.ts:87: 
025321| NOTE: Blank line for visual separation.
025322| src/hooks/useRecentSearches.ts:88: /**
025323| NOTE: Block comment line describing behavior or context.
025324| src/hooks/useRecentSearches.ts:89:  * Format a recent search for display
025325| NOTE: Block comment line describing behavior or context.
025326| src/hooks/useRecentSearches.ts:90:  * Example: "Austin, TX \u00B7 $500-1000 \u00B7 Wifi, Parking"
025327| NOTE: Block comment line describing behavior or context.
025328| src/hooks/useRecentSearches.ts:91:  */
025329| NOTE: Block comment line describing behavior or context.
025330| src/hooks/useRecentSearches.ts:92: export function formatRecentSearch(search: RecentSearch): string {
025331| NOTE: Exports helper or component function.
025332| src/hooks/useRecentSearches.ts:93:   const parts: string[] = [search.location];
025333| NOTE: Local declaration used by search logic or UI.
025334| src/hooks/useRecentSearches.ts:94: 
025335| NOTE: Blank line for visual separation.
025336| src/hooks/useRecentSearches.ts:95:   // Add price range if present
025337| NOTE: Line comment documents intent or constraints.
025338| src/hooks/useRecentSearches.ts:96:   if (search.filters.minPrice || search.filters.maxPrice) {
025339| NOTE: Conditional logic controlling rendering or flow.
025340| src/hooks/useRecentSearches.ts:97:     const min = search.filters.minPrice || "0";
025341| NOTE: Local declaration used by search logic or UI.
025342| src/hooks/useRecentSearches.ts:98:     const max = search.filters.maxPrice || "\u221E";
025343| NOTE: Local declaration used by search logic or UI.
025344| src/hooks/useRecentSearches.ts:99:     parts.push(`$${min}-${max}`);
025345| NOTE: Implementation detail supporting search page behavior.
025346| src/hooks/useRecentSearches.ts:100:   }
025347| NOTE: Implementation detail supporting search page behavior.
025348| src/hooks/useRecentSearches.ts:101: 
025349| NOTE: Blank line for visual separation.
025350| src/hooks/useRecentSearches.ts:102:   // Add room type if present
025351| NOTE: Line comment documents intent or constraints.
025352| src/hooks/useRecentSearches.ts:103:   if (search.filters.roomType) {
025353| NOTE: Conditional logic controlling rendering or flow.
025354| src/hooks/useRecentSearches.ts:104:     parts.push(search.filters.roomType);
025355| NOTE: Implementation detail supporting search page behavior.
025356| src/hooks/useRecentSearches.ts:105:   }
025357| NOTE: Implementation detail supporting search page behavior.
025358| src/hooks/useRecentSearches.ts:106: 
025359| NOTE: Blank line for visual separation.
025360| src/hooks/useRecentSearches.ts:107:   // Add first 2 amenities if present
025361| NOTE: Line comment documents intent or constraints.
025362| src/hooks/useRecentSearches.ts:108:   if (search.filters.amenities?.length) {
025363| NOTE: Conditional logic controlling rendering or flow.
025364| src/hooks/useRecentSearches.ts:109:     const amenityDisplay = search.filters.amenities.slice(0, 2).join(", ");
025365| NOTE: Local declaration used by search logic or UI.
025366| src/hooks/useRecentSearches.ts:110:     if (search.filters.amenities.length > 2) {
025367| NOTE: Conditional logic controlling rendering or flow.
025368| src/hooks/useRecentSearches.ts:111:       parts.push(`${amenityDisplay} +${search.filters.amenities.length - 2}`);
025369| NOTE: Implementation detail supporting search page behavior.
025370| src/hooks/useRecentSearches.ts:112:     } else {
025371| NOTE: Implementation detail supporting search page behavior.
025372| src/hooks/useRecentSearches.ts:113:       parts.push(amenityDisplay);
025373| NOTE: Implementation detail supporting search page behavior.
025374| src/hooks/useRecentSearches.ts:114:     }
025375| NOTE: Implementation detail supporting search page behavior.
025376| src/hooks/useRecentSearches.ts:115:   }
025377| NOTE: Implementation detail supporting search page behavior.
025378| src/hooks/useRecentSearches.ts:116: 
025379| NOTE: Blank line for visual separation.
025380| src/hooks/useRecentSearches.ts:117:   return parts.join(" \u00B7 ");
025381| NOTE: Return statement for component or helper output.
025382| src/hooks/useRecentSearches.ts:118: }
025383| NOTE: Implementation detail supporting search page behavior.
025384| src/hooks/useRecentSearches.ts:119: 
025385| NOTE: Blank line for visual separation.
025386| src/hooks/useRecentSearches.ts:120: /**
025387| NOTE: Block comment line describing behavior or context.
025388| src/hooks/useRecentSearches.ts:121:  * Get a short summary of applied filters
025389| NOTE: Block comment line describing behavior or context.
025390| src/hooks/useRecentSearches.ts:122:  */
025391| NOTE: Block comment line describing behavior or context.
025392| src/hooks/useRecentSearches.ts:123: export function getFilterSummary(filters: RecentSearchFilters): string | null {
025393| NOTE: Exports helper or component function.
025394| src/hooks/useRecentSearches.ts:124:   const summaryParts: string[] = [];
025395| NOTE: Local declaration used by search logic or UI.
025396| src/hooks/useRecentSearches.ts:125: 
025397| NOTE: Blank line for visual separation.
025398| src/hooks/useRecentSearches.ts:126:   if (filters.minPrice || filters.maxPrice) {
025399| NOTE: Conditional logic controlling rendering or flow.
025400| src/hooks/useRecentSearches.ts:127:     const min = filters.minPrice || "0";
025401| NOTE: Local declaration used by search logic or UI.
025402| src/hooks/useRecentSearches.ts:128:     const max = filters.maxPrice || "\u221E";
025403| NOTE: Local declaration used by search logic or UI.
025404| src/hooks/useRecentSearches.ts:129:     summaryParts.push(`$${min}-${max}`);
025405| NOTE: Implementation detail supporting search page behavior.
025406| src/hooks/useRecentSearches.ts:130:   }
025407| NOTE: Implementation detail supporting search page behavior.
025408| src/hooks/useRecentSearches.ts:131: 
025409| NOTE: Blank line for visual separation.
025410| src/hooks/useRecentSearches.ts:132:   if (filters.roomType) {
025411| NOTE: Conditional logic controlling rendering or flow.
025412| src/hooks/useRecentSearches.ts:133:     summaryParts.push(filters.roomType);
025413| NOTE: Implementation detail supporting search page behavior.
025414| src/hooks/useRecentSearches.ts:134:   }
025415| NOTE: Implementation detail supporting search page behavior.
025416| src/hooks/useRecentSearches.ts:135: 
025417| NOTE: Blank line for visual separation.
025418| src/hooks/useRecentSearches.ts:136:   if (filters.leaseDuration) {
025419| NOTE: Conditional logic controlling rendering or flow.
025420| src/hooks/useRecentSearches.ts:137:     summaryParts.push(filters.leaseDuration);
025421| NOTE: Implementation detail supporting search page behavior.
025422| src/hooks/useRecentSearches.ts:138:   }
025423| NOTE: Implementation detail supporting search page behavior.
025424| src/hooks/useRecentSearches.ts:139: 
025425| NOTE: Blank line for visual separation.
025426| src/hooks/useRecentSearches.ts:140:   const amenityCount = filters.amenities?.length || 0;
025427| NOTE: Local declaration used by search logic or UI.
025428| src/hooks/useRecentSearches.ts:141:   const ruleCount = filters.houseRules?.length || 0;
025429| NOTE: Local declaration used by search logic or UI.
025430| src/hooks/useRecentSearches.ts:142:   const totalFilters = amenityCount + ruleCount;
025431| NOTE: Local declaration used by search logic or UI.
025432| src/hooks/useRecentSearches.ts:143: 
025433| NOTE: Blank line for visual separation.
025434| src/hooks/useRecentSearches.ts:144:   if (totalFilters > 0) {
025435| NOTE: Conditional logic controlling rendering or flow.
025436| src/hooks/useRecentSearches.ts:145:     summaryParts.push(`${totalFilters} filter${totalFilters > 1 ? "s" : ""}`);
025437| NOTE: Implementation detail supporting search page behavior.
025438| src/hooks/useRecentSearches.ts:146:   }
025439| NOTE: Implementation detail supporting search page behavior.
025440| src/hooks/useRecentSearches.ts:147: 
025441| NOTE: Blank line for visual separation.
025442| src/hooks/useRecentSearches.ts:148:   return summaryParts.length > 0 ? summaryParts.join(" \u00B7 ") : null;
025443| NOTE: Return statement for component or helper output.
025444| src/hooks/useRecentSearches.ts:149: }
025445| NOTE: Implementation detail supporting search page behavior.
025446| src/hooks/useRecentSearches.ts:150: 
025447| NOTE: Blank line for visual separation.
025448| src/hooks/useRecentSearches.ts:151: /**
025449| NOTE: Block comment line describing behavior or context.
025450| src/hooks/useRecentSearches.ts:152:  * Hook for managing recent search history
025451| NOTE: Block comment line describing behavior or context.
025452| src/hooks/useRecentSearches.ts:153:  *
025453| NOTE: Block comment line describing behavior or context.
025454| src/hooks/useRecentSearches.ts:154:  * @returns Object with recent searches state and management functions
025455| NOTE: Block comment line describing behavior or context.
025456| src/hooks/useRecentSearches.ts:155:  */
025457| NOTE: Block comment line describing behavior or context.
025458| src/hooks/useRecentSearches.ts:156: export function useRecentSearches() {
025459| NOTE: Exports helper or component function.
025460| src/hooks/useRecentSearches.ts:157:   const [recentSearches, setRecentSearches] = useState<RecentSearch[]>([]);
025461| NOTE: Initializes local state for search UI behavior.
025462| src/hooks/useRecentSearches.ts:158:   const [isLoaded, setIsLoaded] = useState(false);
025463| NOTE: Initializes local state for search UI behavior.
025464| src/hooks/useRecentSearches.ts:159: 
025465| NOTE: Blank line for visual separation.
025466| src/hooks/useRecentSearches.ts:160:   // Load and migrate recent searches from localStorage on mount
025467| NOTE: Line comment documents intent or constraints.
025468| src/hooks/useRecentSearches.ts:161:   useEffect(() => {
025469| NOTE: Defines side effect for syncing with external state.
025470| src/hooks/useRecentSearches.ts:162:     try {
025471| NOTE: Implementation detail supporting search page behavior.
025472| src/hooks/useRecentSearches.ts:163:       const stored = localStorage.getItem(RECENT_SEARCHES_KEY);
025473| NOTE: Local declaration used by search logic or UI.
025474| src/hooks/useRecentSearches.ts:164:       if (stored) {
025475| NOTE: Conditional logic controlling rendering or flow.
025476| src/hooks/useRecentSearches.ts:165:         const parsed = JSON.parse(stored) as (
025477| NOTE: Local declaration used by search logic or UI.
025478| src/hooks/useRecentSearches.ts:166:           | RecentSearch
025479| NOTE: Implementation detail supporting search page behavior.
025480| src/hooks/useRecentSearches.ts:167:           | LegacyRecentSearch
025481| NOTE: Implementation detail supporting search page behavior.
025482| src/hooks/useRecentSearches.ts:168:         )[];
025483| NOTE: Implementation detail supporting search page behavior.
025484| src/hooks/useRecentSearches.ts:169: 
025485| NOTE: Blank line for visual separation.
025486| src/hooks/useRecentSearches.ts:170:         // Migrate any legacy entries to new format
025487| NOTE: Line comment documents intent or constraints.
025488| src/hooks/useRecentSearches.ts:171:         const migrated: RecentSearch[] = parsed.map((entry) =>
025489| NOTE: Local declaration used by search logic or UI.
025490| src/hooks/useRecentSearches.ts:172:           isLegacyFormat(entry) ? migrateLegacySearch(entry) : entry,
025491| NOTE: Implementation detail supporting search page behavior.
025492| src/hooks/useRecentSearches.ts:173:         );
025493| NOTE: Implementation detail supporting search page behavior.
025494| src/hooks/useRecentSearches.ts:174: 
025495| NOTE: Blank line for visual separation.
025496| src/hooks/useRecentSearches.ts:175:         setRecentSearches(migrated);
025497| NOTE: Implementation detail supporting search page behavior.
025498| src/hooks/useRecentSearches.ts:176: 
025499| NOTE: Blank line for visual separation.
025500| src/hooks/useRecentSearches.ts:177:         // If any entries were migrated, save back the updated format
025501| NOTE: Line comment documents intent or constraints.
025502| src/hooks/useRecentSearches.ts:178:         const hadLegacy = parsed.some(isLegacyFormat);
025503| NOTE: Local declaration used by search logic or UI.
025504| src/hooks/useRecentSearches.ts:179:         if (hadLegacy) {
025505| NOTE: Conditional logic controlling rendering or flow.
025506| src/hooks/useRecentSearches.ts:180:           localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify(migrated));
025507| NOTE: Implementation detail supporting search page behavior.
025508| src/hooks/useRecentSearches.ts:181:         }
025509| NOTE: Implementation detail supporting search page behavior.
025510| src/hooks/useRecentSearches.ts:182:       }
025511| NOTE: Implementation detail supporting search page behavior.
025512| src/hooks/useRecentSearches.ts:183:     } catch {
025513| NOTE: Implementation detail supporting search page behavior.
025514| src/hooks/useRecentSearches.ts:184:       // Ignore localStorage errors (private browsing, quota exceeded, etc.)
025515| NOTE: Line comment documents intent or constraints.
025516| src/hooks/useRecentSearches.ts:185:     }
025517| NOTE: Implementation detail supporting search page behavior.
025518| src/hooks/useRecentSearches.ts:186:     setIsLoaded(true);
025519| NOTE: Implementation detail supporting search page behavior.
025520| src/hooks/useRecentSearches.ts:187:   }, []);
025521| NOTE: Implementation detail supporting search page behavior.
025522| src/hooks/useRecentSearches.ts:188: 
025523| NOTE: Blank line for visual separation.
025524| src/hooks/useRecentSearches.ts:189:   /**
025525| NOTE: Block comment line describing behavior or context.
025526| src/hooks/useRecentSearches.ts:190:    * Save a new search to recent searches
025527| NOTE: Block comment line describing behavior or context.
025528| src/hooks/useRecentSearches.ts:191:    *
025529| NOTE: Block comment line describing behavior or context.
025530| src/hooks/useRecentSearches.ts:192:    * @param location - Display location text
025531| NOTE: Block comment line describing behavior or context.
025532| src/hooks/useRecentSearches.ts:193:    * @param coords - Optional geocoded coordinates
025533| NOTE: Block comment line describing behavior or context.
025534| src/hooks/useRecentSearches.ts:194:    * @param filters - Applied filters at time of search
025535| NOTE: Block comment line describing behavior or context.
025536| src/hooks/useRecentSearches.ts:195:    * @param resultCount - Optional result count
025537| NOTE: Block comment line describing behavior or context.
025538| src/hooks/useRecentSearches.ts:196:    */
025539| NOTE: Block comment line describing behavior or context.
025540| src/hooks/useRecentSearches.ts:197:   const saveRecentSearch = useCallback(
025541| NOTE: Memoizes callback to preserve references across renders.
025542| src/hooks/useRecentSearches.ts:198:     (
025543| NOTE: Implementation detail supporting search page behavior.
025544| src/hooks/useRecentSearches.ts:199:       location: string,
025545| NOTE: Implementation detail supporting search page behavior.
025546| src/hooks/useRecentSearches.ts:200:       coords?: { lat: number; lng: number },
025547| NOTE: Implementation detail supporting search page behavior.
025548| src/hooks/useRecentSearches.ts:201:       filters: RecentSearchFilters = {},
025549| NOTE: Implementation detail supporting search page behavior.
025550| src/hooks/useRecentSearches.ts:202:       resultCount?: number,
025551| NOTE: Implementation detail supporting search page behavior.
025552| src/hooks/useRecentSearches.ts:203:     ) => {
025553| NOTE: Implementation detail supporting search page behavior.
025554| src/hooks/useRecentSearches.ts:204:       const trimmedLocation = location.trim();
025555| NOTE: Local declaration used by search logic or UI.
025556| src/hooks/useRecentSearches.ts:205:       if (!trimmedLocation) return;
025557| NOTE: Conditional logic controlling rendering or flow.
025558| src/hooks/useRecentSearches.ts:206: 
025559| NOTE: Blank line for visual separation.
025560| src/hooks/useRecentSearches.ts:207:       const newSearch: RecentSearch = {
025561| NOTE: Local declaration used by search logic or UI.
025562| src/hooks/useRecentSearches.ts:208:         id: generateId(),
025563| NOTE: Implementation detail supporting search page behavior.
025564| src/hooks/useRecentSearches.ts:209:         location: trimmedLocation,
025565| NOTE: Implementation detail supporting search page behavior.
025566| src/hooks/useRecentSearches.ts:210:         coords,
025567| NOTE: Implementation detail supporting search page behavior.
025568| src/hooks/useRecentSearches.ts:211:         timestamp: Date.now(),
025569| NOTE: Implementation detail supporting search page behavior.
025570| src/hooks/useRecentSearches.ts:212:         filters,
025571| NOTE: Implementation detail supporting search page behavior.
025572| src/hooks/useRecentSearches.ts:213:         resultCount,
025573| NOTE: Implementation detail supporting search page behavior.
025574| src/hooks/useRecentSearches.ts:214:       };
025575| NOTE: Implementation detail supporting search page behavior.
025576| src/hooks/useRecentSearches.ts:215: 
025577| NOTE: Blank line for visual separation.
025578| src/hooks/useRecentSearches.ts:216:       setRecentSearches((prev) => {
025579| NOTE: Implementation detail supporting search page behavior.
025580| src/hooks/useRecentSearches.ts:217:         // Remove duplicates by location (case-insensitive)
025581| NOTE: Line comment documents intent or constraints.
025582| src/hooks/useRecentSearches.ts:218:         const filtered = prev.filter(
025583| NOTE: Local declaration used by search logic or UI.
025584| src/hooks/useRecentSearches.ts:219:           (s) => s.location.toLowerCase() !== trimmedLocation.toLowerCase(),
025585| NOTE: Implementation detail supporting search page behavior.
025586| src/hooks/useRecentSearches.ts:220:         );
025587| NOTE: Implementation detail supporting search page behavior.
025588| src/hooks/useRecentSearches.ts:221: 
025589| NOTE: Blank line for visual separation.
025590| src/hooks/useRecentSearches.ts:222:         // Add new search at the beginning, limit to max
025591| NOTE: Line comment documents intent or constraints.
025592| src/hooks/useRecentSearches.ts:223:         const updated = [newSearch, ...filtered].slice(0, MAX_RECENT_SEARCHES);
025593| NOTE: Local declaration used by search logic or UI.
025594| src/hooks/useRecentSearches.ts:224: 
025595| NOTE: Blank line for visual separation.
025596| src/hooks/useRecentSearches.ts:225:         // Persist to localStorage
025597| NOTE: Line comment documents intent or constraints.
025598| src/hooks/useRecentSearches.ts:226:         try {
025599| NOTE: Implementation detail supporting search page behavior.
025600| src/hooks/useRecentSearches.ts:227:           localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify(updated));
025601| NOTE: Implementation detail supporting search page behavior.
025602| src/hooks/useRecentSearches.ts:228:         } catch {
025603| NOTE: Implementation detail supporting search page behavior.
025604| src/hooks/useRecentSearches.ts:229:           // Ignore localStorage errors
025605| NOTE: Line comment documents intent or constraints.
025606| src/hooks/useRecentSearches.ts:230:         }
025607| NOTE: Implementation detail supporting search page behavior.
025608| src/hooks/useRecentSearches.ts:231: 
025609| NOTE: Blank line for visual separation.
025610| src/hooks/useRecentSearches.ts:232:         return updated;
025611| NOTE: Return statement for component or helper output.
025612| src/hooks/useRecentSearches.ts:233:       });
025613| NOTE: Implementation detail supporting search page behavior.
025614| src/hooks/useRecentSearches.ts:234:     },
025615| NOTE: Implementation detail supporting search page behavior.
025616| src/hooks/useRecentSearches.ts:235:     [],
025617| NOTE: Implementation detail supporting search page behavior.
025618| src/hooks/useRecentSearches.ts:236:   );
025619| NOTE: Implementation detail supporting search page behavior.
025620| src/hooks/useRecentSearches.ts:237: 
025621| NOTE: Blank line for visual separation.
025622| src/hooks/useRecentSearches.ts:238:   /**
025623| NOTE: Block comment line describing behavior or context.
025624| src/hooks/useRecentSearches.ts:239:    * Clear all recent searches
025625| NOTE: Block comment line describing behavior or context.
025626| src/hooks/useRecentSearches.ts:240:    */
025627| NOTE: Block comment line describing behavior or context.
025628| src/hooks/useRecentSearches.ts:241:   const clearRecentSearches = useCallback(() => {
025629| NOTE: Memoizes callback to preserve references across renders.
025630| src/hooks/useRecentSearches.ts:242:     setRecentSearches([]);
025631| NOTE: Implementation detail supporting search page behavior.
025632| src/hooks/useRecentSearches.ts:243:     try {
025633| NOTE: Implementation detail supporting search page behavior.
025634| src/hooks/useRecentSearches.ts:244:       localStorage.removeItem(RECENT_SEARCHES_KEY);
025635| NOTE: Implementation detail supporting search page behavior.
025636| src/hooks/useRecentSearches.ts:245:     } catch {
025637| NOTE: Implementation detail supporting search page behavior.
025638| src/hooks/useRecentSearches.ts:246:       // Ignore localStorage errors
025639| NOTE: Line comment documents intent or constraints.
025640| src/hooks/useRecentSearches.ts:247:     }
025641| NOTE: Implementation detail supporting search page behavior.
025642| src/hooks/useRecentSearches.ts:248:   }, []);
025643| NOTE: Implementation detail supporting search page behavior.
025644| src/hooks/useRecentSearches.ts:249: 
025645| NOTE: Blank line for visual separation.
025646| src/hooks/useRecentSearches.ts:250:   /**
025647| NOTE: Block comment line describing behavior or context.
025648| src/hooks/useRecentSearches.ts:251:    * Remove a specific recent search by ID
025649| NOTE: Block comment line describing behavior or context.
025650| src/hooks/useRecentSearches.ts:252:    *
025651| NOTE: Block comment line describing behavior or context.
025652| src/hooks/useRecentSearches.ts:253:    * @param id - ID of the search to remove
025653| NOTE: Block comment line describing behavior or context.
025654| src/hooks/useRecentSearches.ts:254:    */
025655| NOTE: Block comment line describing behavior or context.
025656| src/hooks/useRecentSearches.ts:255:   const removeRecentSearch = useCallback((id: string) => {
025657| NOTE: Memoizes callback to preserve references across renders.
025658| src/hooks/useRecentSearches.ts:256:     setRecentSearches((prev) => {
025659| NOTE: Implementation detail supporting search page behavior.
025660| src/hooks/useRecentSearches.ts:257:       const updated = prev.filter((s) => s.id !== id);
025661| NOTE: Local declaration used by search logic or UI.
025662| src/hooks/useRecentSearches.ts:258: 
025663| NOTE: Blank line for visual separation.
025664| src/hooks/useRecentSearches.ts:259:       try {
025665| NOTE: Implementation detail supporting search page behavior.
025666| src/hooks/useRecentSearches.ts:260:         if (updated.length > 0) {
025667| NOTE: Conditional logic controlling rendering or flow.
025668| src/hooks/useRecentSearches.ts:261:           localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify(updated));
025669| NOTE: Implementation detail supporting search page behavior.
025670| src/hooks/useRecentSearches.ts:262:         } else {
025671| NOTE: Implementation detail supporting search page behavior.
025672| src/hooks/useRecentSearches.ts:263:           localStorage.removeItem(RECENT_SEARCHES_KEY);
025673| NOTE: Implementation detail supporting search page behavior.
025674| src/hooks/useRecentSearches.ts:264:         }
025675| NOTE: Implementation detail supporting search page behavior.
025676| src/hooks/useRecentSearches.ts:265:       } catch {
025677| NOTE: Implementation detail supporting search page behavior.
025678| src/hooks/useRecentSearches.ts:266:         // Ignore localStorage errors
025679| NOTE: Line comment documents intent or constraints.
025680| src/hooks/useRecentSearches.ts:267:       }
025681| NOTE: Implementation detail supporting search page behavior.
025682| src/hooks/useRecentSearches.ts:268: 
025683| NOTE: Blank line for visual separation.
025684| src/hooks/useRecentSearches.ts:269:       return updated;
025685| NOTE: Return statement for component or helper output.
025686| src/hooks/useRecentSearches.ts:270:     });
025687| NOTE: Implementation detail supporting search page behavior.
025688| src/hooks/useRecentSearches.ts:271:   }, []);
025689| NOTE: Implementation detail supporting search page behavior.
025690| src/hooks/useRecentSearches.ts:272: 
025691| NOTE: Blank line for visual separation.
025692| src/hooks/useRecentSearches.ts:273:   return {
025693| NOTE: Return statement for component or helper output.
025694| src/hooks/useRecentSearches.ts:274:     /** List of recent searches (newest first) */
025695| NOTE: Block comment line describing behavior or context.
025696| src/hooks/useRecentSearches.ts:275:     recentSearches,
025697| NOTE: Implementation detail supporting search page behavior.
025698| src/hooks/useRecentSearches.ts:276:     /** Whether searches have been loaded from localStorage */
025699| NOTE: Block comment line describing behavior or context.
025700| src/hooks/useRecentSearches.ts:277:     isLoaded,
025701| NOTE: Implementation detail supporting search page behavior.
025702| src/hooks/useRecentSearches.ts:278:     /** Save a new search with optional filters and result count */
025703| NOTE: Block comment line describing behavior or context.
025704| src/hooks/useRecentSearches.ts:279:     saveRecentSearch,
025705| NOTE: Implementation detail supporting search page behavior.
025706| src/hooks/useRecentSearches.ts:280:     /** Clear all recent searches */
025707| NOTE: Block comment line describing behavior or context.
025708| src/hooks/useRecentSearches.ts:281:     clearRecentSearches,
025709| NOTE: Implementation detail supporting search page behavior.
025710| src/hooks/useRecentSearches.ts:282:     /** Remove a specific search by ID */
025711| NOTE: Block comment line describing behavior or context.
025712| src/hooks/useRecentSearches.ts:283:     removeRecentSearch,
025713| NOTE: Implementation detail supporting search page behavior.
025714| src/hooks/useRecentSearches.ts:284:     /** Format a search for display */
025715| NOTE: Block comment line describing behavior or context.
025716| src/hooks/useRecentSearches.ts:285:     formatSearch: formatRecentSearch,
025717| NOTE: Implementation detail supporting search page behavior.
025718| src/hooks/useRecentSearches.ts:286:     /** Get a short filter summary */
025719| NOTE: Block comment line describing behavior or context.
025720| src/hooks/useRecentSearches.ts:287:     getFilterSummary,
025721| NOTE: Implementation detail supporting search page behavior.
025722| src/hooks/useRecentSearches.ts:288:   };
025723| NOTE: Implementation detail supporting search page behavior.
025724| src/hooks/useRecentSearches.ts:289: }
025725| NOTE: Implementation detail supporting search page behavior.
025726| FILE END: src/hooks/useRecentSearches.ts
025727| 
025728| FILE START: src/hooks/useScrollHeader.ts
025729| FILE ROLE: Auto-discovered dependency in search page graph.
025730| src/hooks/useScrollHeader.ts:1: "use client";
025731| NOTE: Implementation detail supporting search page behavior.
025732| src/hooks/useScrollHeader.ts:2: 
025733| NOTE: Blank line for visual separation.
025734| src/hooks/useScrollHeader.ts:3: import { useState, useEffect, useCallback, useRef } from "react";
025735| NOTE: Imports dependency for this module.
025736| src/hooks/useScrollHeader.ts:4: 
025737| NOTE: Blank line for visual separation.
025738| src/hooks/useScrollHeader.ts:5: interface UseScrollHeaderOptions {
025739| NOTE: Type declaration for search data contracts.
025740| src/hooks/useScrollHeader.ts:6:   /** Scroll threshold in pixels before collapsing (default: 100) */
025741| NOTE: Block comment line describing behavior or context.
025742| src/hooks/useScrollHeader.ts:7:   threshold?: number;
025743| NOTE: Implementation detail supporting search page behavior.
025744| src/hooks/useScrollHeader.ts:8: }
025745| NOTE: Implementation detail supporting search page behavior.
025746| src/hooks/useScrollHeader.ts:9: 
025747| NOTE: Blank line for visual separation.
025748| src/hooks/useScrollHeader.ts:10: interface ScrollHeaderState {
025749| NOTE: Type declaration for search data contracts.
025750| src/hooks/useScrollHeader.ts:11:   /** Whether the header should be collapsed */
025751| NOTE: Block comment line describing behavior or context.
025752| src/hooks/useScrollHeader.ts:12:   isCollapsed: boolean;
025753| NOTE: Implementation detail supporting search page behavior.
025754| src/hooks/useScrollHeader.ts:13:   /** Current scroll position */
025755| NOTE: Block comment line describing behavior or context.
025756| src/hooks/useScrollHeader.ts:14:   scrollY: number;
025757| NOTE: Implementation detail supporting search page behavior.
025758| src/hooks/useScrollHeader.ts:15:   /** Whether user is scrolling up */
025759| NOTE: Block comment line describing behavior or context.
025760| src/hooks/useScrollHeader.ts:16:   isScrollingUp: boolean;
025761| NOTE: Implementation detail supporting search page behavior.
025762| src/hooks/useScrollHeader.ts:17: }
025763| NOTE: Implementation detail supporting search page behavior.
025764| src/hooks/useScrollHeader.ts:18: 
025765| NOTE: Blank line for visual separation.
025766| src/hooks/useScrollHeader.ts:19: /**
025767| NOTE: Block comment line describing behavior or context.
025768| src/hooks/useScrollHeader.ts:20:  * Hook to track scroll state for collapsible header behavior.
025769| NOTE: Block comment line describing behavior or context.
025770| src/hooks/useScrollHeader.ts:21:  *
025771| NOTE: Block comment line describing behavior or context.
025772| src/hooks/useScrollHeader.ts:22:  * Features:
025773| NOTE: Block comment line describing behavior or context.
025774| src/hooks/useScrollHeader.ts:23:  * - Collapses header when scrolled past threshold
025775| NOTE: Block comment line describing behavior or context.
025776| src/hooks/useScrollHeader.ts:24:  * - Expands when scrolling up (like iOS Safari)
025777| NOTE: Block comment line describing behavior or context.
025778| src/hooks/useScrollHeader.ts:25:  * - Debounced for performance
025779| NOTE: Block comment line describing behavior or context.
025780| src/hooks/useScrollHeader.ts:26:  * - Uses RAF for smooth updates
025781| NOTE: Block comment line describing behavior or context.
025782| src/hooks/useScrollHeader.ts:27:  */
025783| NOTE: Block comment line describing behavior or context.
025784| src/hooks/useScrollHeader.ts:28: export function useScrollHeader({
025785| NOTE: Exports helper or component function.
025786| src/hooks/useScrollHeader.ts:29:   threshold = 100,
025787| NOTE: Implementation detail supporting search page behavior.
025788| src/hooks/useScrollHeader.ts:30: }: UseScrollHeaderOptions = {}): ScrollHeaderState {
025789| NOTE: Implementation detail supporting search page behavior.
025790| src/hooks/useScrollHeader.ts:31:   const [state, setState] = useState<ScrollHeaderState>({
025791| NOTE: Initializes local state for search UI behavior.
025792| src/hooks/useScrollHeader.ts:32:     isCollapsed: false,
025793| NOTE: Implementation detail supporting search page behavior.
025794| src/hooks/useScrollHeader.ts:33:     scrollY: 0,
025795| NOTE: Implementation detail supporting search page behavior.
025796| src/hooks/useScrollHeader.ts:34:     isScrollingUp: false,
025797| NOTE: Implementation detail supporting search page behavior.
025798| src/hooks/useScrollHeader.ts:35:   });
025799| NOTE: Implementation detail supporting search page behavior.
025800| src/hooks/useScrollHeader.ts:36: 
025801| NOTE: Blank line for visual separation.
025802| src/hooks/useScrollHeader.ts:37:   const lastScrollY = useRef(0);
025803| NOTE: Uses ref for stable mutable storage between renders.
025804| src/hooks/useScrollHeader.ts:38:   const ticking = useRef(false);
025805| NOTE: Uses ref for stable mutable storage between renders.
025806| src/hooks/useScrollHeader.ts:39:   const rafId = useRef<number | null>(null);
025807| NOTE: Uses ref for stable mutable storage between renders.
025808| src/hooks/useScrollHeader.ts:40: 
025809| NOTE: Blank line for visual separation.
025810| src/hooks/useScrollHeader.ts:41:   const updateScrollState = useCallback(() => {
025811| NOTE: Memoizes callback to preserve references across renders.
025812| src/hooks/useScrollHeader.ts:42:     const currentScrollY = window.scrollY;
025813| NOTE: Local declaration used by search logic or UI.
025814| src/hooks/useScrollHeader.ts:43:     const isScrollingUp = currentScrollY < lastScrollY.current;
025815| NOTE: Local declaration used by search logic or UI.
025816| src/hooks/useScrollHeader.ts:44: 
025817| NOTE: Blank line for visual separation.
025818| src/hooks/useScrollHeader.ts:45:     // Determine if header should be collapsed
025819| NOTE: Line comment documents intent or constraints.
025820| src/hooks/useScrollHeader.ts:46:     // Collapse when: scrolled past threshold AND scrolling down
025821| NOTE: Line comment documents intent or constraints.
025822| src/hooks/useScrollHeader.ts:47:     // Expand when: near top OR scrolling up significantly
025823| NOTE: Line comment documents intent or constraints.
025824| src/hooks/useScrollHeader.ts:48:     const isCollapsed =
025825| NOTE: Local declaration used by search logic or UI.
025826| src/hooks/useScrollHeader.ts:49:       currentScrollY > threshold &&
025827| NOTE: Implementation detail supporting search page behavior.
025828| src/hooks/useScrollHeader.ts:50:       !isScrollingUp &&
025829| NOTE: Implementation detail supporting search page behavior.
025830| src/hooks/useScrollHeader.ts:51:       currentScrollY - lastScrollY.current > 5; // Require some momentum
025831| NOTE: Implementation detail supporting search page behavior.
025832| src/hooks/useScrollHeader.ts:52: 
025833| NOTE: Blank line for visual separation.
025834| src/hooks/useScrollHeader.ts:53:     // Always expand when near top or scrolling up significantly
025835| NOTE: Line comment documents intent or constraints.
025836| src/hooks/useScrollHeader.ts:54:     const shouldExpand =
025837| NOTE: Local declaration used by search logic or UI.
025838| src/hooks/useScrollHeader.ts:55:       currentScrollY <= threshold ||
025839| NOTE: Implementation detail supporting search page behavior.
025840| src/hooks/useScrollHeader.ts:56:       (isScrollingUp && lastScrollY.current - currentScrollY > 20);
025841| NOTE: Implementation detail supporting search page behavior.
025842| src/hooks/useScrollHeader.ts:57: 
025843| NOTE: Blank line for visual separation.
025844| src/hooks/useScrollHeader.ts:58:     setState((prev) => ({
025845| NOTE: Implementation detail supporting search page behavior.
025846| src/hooks/useScrollHeader.ts:59:       isCollapsed: shouldExpand ? false : isCollapsed || prev.isCollapsed,
025847| NOTE: Implementation detail supporting search page behavior.
025848| src/hooks/useScrollHeader.ts:60:       scrollY: currentScrollY,
025849| NOTE: Implementation detail supporting search page behavior.
025850| src/hooks/useScrollHeader.ts:61:       isScrollingUp,
025851| NOTE: Implementation detail supporting search page behavior.
025852| src/hooks/useScrollHeader.ts:62:     }));
025853| NOTE: Implementation detail supporting search page behavior.
025854| src/hooks/useScrollHeader.ts:63: 
025855| NOTE: Blank line for visual separation.
025856| src/hooks/useScrollHeader.ts:64:     lastScrollY.current = currentScrollY;
025857| NOTE: Implementation detail supporting search page behavior.
025858| src/hooks/useScrollHeader.ts:65:     ticking.current = false;
025859| NOTE: Implementation detail supporting search page behavior.
025860| src/hooks/useScrollHeader.ts:66:   }, [threshold]);
025861| NOTE: Implementation detail supporting search page behavior.
025862| src/hooks/useScrollHeader.ts:67: 
025863| NOTE: Blank line for visual separation.
025864| src/hooks/useScrollHeader.ts:68:   const handleScroll = useCallback(() => {
025865| NOTE: Memoizes callback to preserve references across renders.
025866| src/hooks/useScrollHeader.ts:69:     if (!ticking.current) {
025867| NOTE: Conditional logic controlling rendering or flow.
025868| src/hooks/useScrollHeader.ts:70:       rafId.current = requestAnimationFrame(updateScrollState);
025869| NOTE: Implementation detail supporting search page behavior.
025870| src/hooks/useScrollHeader.ts:71:       ticking.current = true;
025871| NOTE: Implementation detail supporting search page behavior.
025872| src/hooks/useScrollHeader.ts:72:     }
025873| NOTE: Implementation detail supporting search page behavior.
025874| src/hooks/useScrollHeader.ts:73:   }, [updateScrollState]);
025875| NOTE: Implementation detail supporting search page behavior.
025876| src/hooks/useScrollHeader.ts:74: 
025877| NOTE: Blank line for visual separation.
025878| src/hooks/useScrollHeader.ts:75:   useEffect(() => {
025879| NOTE: Defines side effect for syncing with external state.
025880| src/hooks/useScrollHeader.ts:76:     // Initialize with current scroll position
025881| NOTE: Line comment documents intent or constraints.
025882| src/hooks/useScrollHeader.ts:77:     lastScrollY.current = window.scrollY;
025883| NOTE: Implementation detail supporting search page behavior.
025884| src/hooks/useScrollHeader.ts:78:     setState({
025885| NOTE: Implementation detail supporting search page behavior.
025886| src/hooks/useScrollHeader.ts:79:       isCollapsed: window.scrollY > threshold,
025887| NOTE: Implementation detail supporting search page behavior.
025888| src/hooks/useScrollHeader.ts:80:       scrollY: window.scrollY,
025889| NOTE: Implementation detail supporting search page behavior.
025890| src/hooks/useScrollHeader.ts:81:       isScrollingUp: false,
025891| NOTE: Implementation detail supporting search page behavior.
025892| src/hooks/useScrollHeader.ts:82:     });
025893| NOTE: Implementation detail supporting search page behavior.
025894| src/hooks/useScrollHeader.ts:83: 
025895| NOTE: Blank line for visual separation.
025896| src/hooks/useScrollHeader.ts:84:     window.addEventListener("scroll", handleScroll, { passive: true });
025897| NOTE: Implementation detail supporting search page behavior.
025898| src/hooks/useScrollHeader.ts:85: 
025899| NOTE: Blank line for visual separation.
025900| src/hooks/useScrollHeader.ts:86:     return () => {
025901| NOTE: Return statement for component or helper output.
025902| src/hooks/useScrollHeader.ts:87:       window.removeEventListener("scroll", handleScroll);
025903| NOTE: Implementation detail supporting search page behavior.
025904| src/hooks/useScrollHeader.ts:88:       if (rafId.current) {
025905| NOTE: Conditional logic controlling rendering or flow.
025906| src/hooks/useScrollHeader.ts:89:         cancelAnimationFrame(rafId.current);
025907| NOTE: Implementation detail supporting search page behavior.
025908| src/hooks/useScrollHeader.ts:90:       }
025909| NOTE: Implementation detail supporting search page behavior.
025910| src/hooks/useScrollHeader.ts:91:     };
025911| NOTE: Implementation detail supporting search page behavior.
025912| src/hooks/useScrollHeader.ts:92:   }, [handleScroll, threshold]);
025913| NOTE: Implementation detail supporting search page behavior.
025914| src/hooks/useScrollHeader.ts:93: 
025915| NOTE: Blank line for visual separation.
025916| src/hooks/useScrollHeader.ts:94:   return state;
025917| NOTE: Return statement for component or helper output.
025918| src/hooks/useScrollHeader.ts:95: }
025919| NOTE: Implementation detail supporting search page behavior.
025920| src/hooks/useScrollHeader.ts:96: 
025921| NOTE: Blank line for visual separation.
025922| src/hooks/useScrollHeader.ts:97: /**
025923| NOTE: Block comment line describing behavior or context.
025924| src/hooks/useScrollHeader.ts:98:  * Simplified hook that just returns whether header is collapsed.
025925| NOTE: Block comment line describing behavior or context.
025926| src/hooks/useScrollHeader.ts:99:  * Use when you don't need scroll direction info.
025927| NOTE: Block comment line describing behavior or context.
025928| src/hooks/useScrollHeader.ts:100:  */
025929| NOTE: Block comment line describing behavior or context.
025930| src/hooks/useScrollHeader.ts:101: export function useHeaderCollapsed(threshold = 100): boolean {
025931| NOTE: Exports helper or component function.
025932| src/hooks/useScrollHeader.ts:102:   const { isCollapsed } = useScrollHeader({ threshold });
025933| NOTE: Local declaration used by search logic or UI.
025934| src/hooks/useScrollHeader.ts:103:   return isCollapsed;
025935| NOTE: Return statement for component or helper output.
025936| src/hooks/useScrollHeader.ts:104: }
025937| NOTE: Implementation detail supporting search page behavior.
025938| FILE END: src/hooks/useScrollHeader.ts
025939| 
025940| FILE START: src/lib/data.ts
025941| FILE ROLE: Auto-discovered dependency in search page graph.
025942| src/lib/data.ts:1: import { prisma } from "@/lib/prisma";
025943| NOTE: Imports dependency for this module.
025944| src/lib/data.ts:2: import { wrapDatabaseError } from "@/lib/errors";
025945| NOTE: Imports dependency for this module.
025946| src/lib/data.ts:3: import { logger } from "@/lib/logger";
025947| NOTE: Imports dependency for this module.
025948| src/lib/data.ts:4: import { unstable_cache } from "next/cache";
025949| NOTE: Imports dependency for this module.
025950| src/lib/data.ts:5: import {
025951| NOTE: Imports dependency for this module.
025952| src/lib/data.ts:6:   KeysetSort,
025953| NOTE: Implementation detail supporting search page behavior.
025954| src/lib/data.ts:7:   KeysetPaginatedResult,
025955| NOTE: Implementation detail supporting search page behavior.
025956| src/lib/data.ts:8:   isKeysetEligible,
025957| NOTE: Implementation detail supporting search page behavior.
025958| src/lib/data.ts:9:   decodeCursor,
025959| NOTE: Implementation detail supporting search page behavior.
025960| src/lib/data.ts:10:   createCursorFromItem,
025961| NOTE: Implementation detail supporting search page behavior.
025962| src/lib/data.ts:11: } from "@/types/pagination";
025963| NOTE: Implementation detail supporting search page behavior.
025964| src/lib/data.ts:12: import {
025965| NOTE: Imports dependency for this module.
025966| src/lib/data.ts:13:   LOW_RESULTS_THRESHOLD,
025967| NOTE: Implementation detail supporting search page behavior.
025968| src/lib/data.ts:14:   expandFiltersForNearMatches,
025969| NOTE: Implementation detail supporting search page behavior.
025970| src/lib/data.ts:15:   isNearMatch,
025971| NOTE: Implementation detail supporting search page behavior.
025972| src/lib/data.ts:16: } from "@/lib/near-matches";
025973| NOTE: Implementation detail supporting search page behavior.
025974| src/lib/data.ts:17: 
025975| NOTE: Blank line for visual separation.
025976| src/lib/data.ts:18: /**
025977| NOTE: Block comment line describing behavior or context.
025978| src/lib/data.ts:19:  * Cache key generator for getListingsPaginated
025979| NOTE: Block comment line describing behavior or context.
025980| src/lib/data.ts:20:  * Normalizes params for stable cache keys (~11m precision on bounds)
025981| NOTE: Block comment line describing behavior or context.
025982| src/lib/data.ts:21:  */
025983| NOTE: Block comment line describing behavior or context.
025984| src/lib/data.ts:22: function createListingsCacheKey(params: FilterParams): string {
025985| NOTE: Defines a helper or component function.
025986| src/lib/data.ts:23:   const normalized = {
025987| NOTE: Local declaration used by search logic or UI.
025988| src/lib/data.ts:24:     q: params.query?.toLowerCase().trim() || "",
025989| NOTE: Implementation detail supporting search page behavior.
025990| src/lib/data.ts:25:     minPrice: params.minPrice ?? "",
025991| NOTE: Implementation detail supporting search page behavior.
025992| src/lib/data.ts:26:     maxPrice: params.maxPrice ?? "",
025993| NOTE: Implementation detail supporting search page behavior.
025994| src/lib/data.ts:27:     amenities: [...(params.amenities || [])].sort().join(","),
025995| NOTE: Implementation detail supporting search page behavior.
025996| src/lib/data.ts:28:     houseRules: [...(params.houseRules || [])].sort().join(","),
025997| NOTE: Implementation detail supporting search page behavior.
025998| src/lib/data.ts:29:     languages: [...(params.languages || [])].sort().join(","),
025999| NOTE: Implementation detail supporting search page behavior.
026000| src/lib/data.ts:30:     roomType: params.roomType?.toLowerCase() || "",
026001| NOTE: Implementation detail supporting search page behavior.
026002| src/lib/data.ts:31:     leaseDuration: params.leaseDuration?.toLowerCase() || "",
026003| NOTE: Implementation detail supporting search page behavior.
026004| src/lib/data.ts:32:     moveInDate: params.moveInDate || "",
026005| NOTE: Implementation detail supporting search page behavior.
026006| src/lib/data.ts:33:     // Round bounds to 4 decimal places for cache stability (~11m precision)
026007| NOTE: Line comment documents intent or constraints.
026008| src/lib/data.ts:34:     bounds: params.bounds
026009| NOTE: Implementation detail supporting search page behavior.
026010| src/lib/data.ts:35:       ? `${params.bounds.minLng.toFixed(4)},${params.bounds.minLat.toFixed(4)},${params.bounds.maxLng.toFixed(4)},${params.bounds.maxLat.toFixed(4)}`
026011| NOTE: Implementation detail supporting search page behavior.
026012| src/lib/data.ts:36:       : "",
026013| NOTE: Implementation detail supporting search page behavior.
026014| src/lib/data.ts:37:     page: params.page ?? 1,
026015| NOTE: Implementation detail supporting search page behavior.
026016| src/lib/data.ts:38:     limit: params.limit ?? 12,
026017| NOTE: Implementation detail supporting search page behavior.
026018| src/lib/data.ts:39:     sort: params.sort || "recommended",
026019| NOTE: Implementation detail supporting search page behavior.
026020| src/lib/data.ts:40:     nearMatches: params.nearMatches ?? false,
026021| NOTE: Implementation detail supporting search page behavior.
026022| src/lib/data.ts:41:   };
026023| NOTE: Implementation detail supporting search page behavior.
026024| src/lib/data.ts:42:   return JSON.stringify(normalized);
026025| NOTE: Return statement for component or helper output.
026026| src/lib/data.ts:43: }
026027| NOTE: Implementation detail supporting search page behavior.
026028| src/lib/data.ts:44: 
026029| NOTE: Blank line for visual separation.
026030| src/lib/data.ts:45: /**
026031| NOTE: Block comment line describing behavior or context.
026032| src/lib/data.ts:46:  * Cache key generator for getMapListings
026033| NOTE: Block comment line describing behavior or context.
026034| src/lib/data.ts:47:  * Normalizes params for stable cache keys
026035| NOTE: Block comment line describing behavior or context.
026036| src/lib/data.ts:48:  */
026037| NOTE: Block comment line describing behavior or context.
026038| src/lib/data.ts:49: function createMapListingsCacheKey(params: FilterParams): string {
026039| NOTE: Defines a helper or component function.
026040| src/lib/data.ts:50:   const normalized = {
026041| NOTE: Local declaration used by search logic or UI.
026042| src/lib/data.ts:51:     q: params.query?.toLowerCase().trim() || "",
026043| NOTE: Implementation detail supporting search page behavior.
026044| src/lib/data.ts:52:     minPrice: params.minPrice ?? "",
026045| NOTE: Implementation detail supporting search page behavior.
026046| src/lib/data.ts:53:     maxPrice: params.maxPrice ?? "",
026047| NOTE: Implementation detail supporting search page behavior.
026048| src/lib/data.ts:54:     amenities: [...(params.amenities || [])].sort().join(","),
026049| NOTE: Implementation detail supporting search page behavior.
026050| src/lib/data.ts:55:     houseRules: [...(params.houseRules || [])].sort().join(","),
026051| NOTE: Implementation detail supporting search page behavior.
026052| src/lib/data.ts:56:     languages: [...(params.languages || [])].sort().join(","),
026053| NOTE: Implementation detail supporting search page behavior.
026054| src/lib/data.ts:57:     roomType: params.roomType?.toLowerCase() || "",
026055| NOTE: Implementation detail supporting search page behavior.
026056| src/lib/data.ts:58:     leaseDuration: params.leaseDuration?.toLowerCase() || "",
026057| NOTE: Implementation detail supporting search page behavior.
026058| src/lib/data.ts:59:     moveInDate: params.moveInDate || "",
026059| NOTE: Implementation detail supporting search page behavior.
026060| src/lib/data.ts:60:     bounds: params.bounds
026061| NOTE: Implementation detail supporting search page behavior.
026062| src/lib/data.ts:61:       ? `${params.bounds.minLng.toFixed(4)},${params.bounds.minLat.toFixed(4)},${params.bounds.maxLng.toFixed(4)},${params.bounds.maxLat.toFixed(4)}`
026063| NOTE: Implementation detail supporting search page behavior.
026064| src/lib/data.ts:62:       : "",
026065| NOTE: Implementation detail supporting search page behavior.
026066| src/lib/data.ts:63:   };
026067| NOTE: Implementation detail supporting search page behavior.
026068| src/lib/data.ts:64:   return JSON.stringify(normalized);
026069| NOTE: Return statement for component or helper output.
026070| src/lib/data.ts:65: }
026071| NOTE: Implementation detail supporting search page behavior.
026072| src/lib/data.ts:66: 
026073| NOTE: Blank line for visual separation.
026074| src/lib/data.ts:67: /**
026075| NOTE: Block comment line describing behavior or context.
026076| src/lib/data.ts:68:  * Cache key generator for getLimitedCount (hybrid pagination)
026077| NOTE: Block comment line describing behavior or context.
026078| src/lib/data.ts:69:  * CRITICAL: Excludes page/limit so count is cached across all pages.
026079| NOTE: Block comment line describing behavior or context.
026080| src/lib/data.ts:70:  * This ensures "Showing 1-12 of 50" on page 1 stays "Showing 13-24 of 50" on page 2.
026081| NOTE: Block comment line describing behavior or context.
026082| src/lib/data.ts:71:  */
026083| NOTE: Block comment line describing behavior or context.
026084| src/lib/data.ts:72: function createFiltersCacheKey(params: FilterParams): string {
026085| NOTE: Defines a helper or component function.
026086| src/lib/data.ts:73:   const normalized = {
026087| NOTE: Local declaration used by search logic or UI.
026088| src/lib/data.ts:74:     q: params.query?.toLowerCase().trim() || "",
026089| NOTE: Implementation detail supporting search page behavior.
026090| src/lib/data.ts:75:     minPrice: params.minPrice ?? "",
026091| NOTE: Implementation detail supporting search page behavior.
026092| src/lib/data.ts:76:     maxPrice: params.maxPrice ?? "",
026093| NOTE: Implementation detail supporting search page behavior.
026094| src/lib/data.ts:77:     amenities: [...(params.amenities || [])].sort().join(","),
026095| NOTE: Implementation detail supporting search page behavior.
026096| src/lib/data.ts:78:     houseRules: [...(params.houseRules || [])].sort().join(","),
026097| NOTE: Implementation detail supporting search page behavior.
026098| src/lib/data.ts:79:     languages: [...(params.languages || [])].sort().join(","),
026099| NOTE: Implementation detail supporting search page behavior.
026100| src/lib/data.ts:80:     roomType: params.roomType?.toLowerCase() || "",
026101| NOTE: Implementation detail supporting search page behavior.
026102| src/lib/data.ts:81:     leaseDuration: params.leaseDuration?.toLowerCase() || "",
026103| NOTE: Implementation detail supporting search page behavior.
026104| src/lib/data.ts:82:     moveInDate: params.moveInDate || "",
026105| NOTE: Implementation detail supporting search page behavior.
026106| src/lib/data.ts:83:     bounds: params.bounds
026107| NOTE: Implementation detail supporting search page behavior.
026108| src/lib/data.ts:84:       ? `${params.bounds.minLng.toFixed(4)},${params.bounds.minLat.toFixed(4)},${params.bounds.maxLng.toFixed(4)},${params.bounds.maxLat.toFixed(4)}`
026109| NOTE: Implementation detail supporting search page behavior.
026110| src/lib/data.ts:85:       : "",
026111| NOTE: Implementation detail supporting search page behavior.
026112| src/lib/data.ts:86:     // NOTE: No page or limit - intentionally excluded for cross-page caching
026113| NOTE: Line comment documents intent or constraints.
026114| src/lib/data.ts:87:   };
026115| NOTE: Implementation detail supporting search page behavior.
026116| src/lib/data.ts:88:   return JSON.stringify(normalized);
026117| NOTE: Return statement for component or helper output.
026118| src/lib/data.ts:89: }
026119| NOTE: Implementation detail supporting search page behavior.
026120| src/lib/data.ts:90: 
026121| NOTE: Blank line for visual separation.
026122| src/lib/data.ts:91: export interface ListingData {
026123| NOTE: Implementation detail supporting search page behavior.
026124| src/lib/data.ts:92:   id: string;
026125| NOTE: Implementation detail supporting search page behavior.
026126| src/lib/data.ts:93:   title: string;
026127| NOTE: Implementation detail supporting search page behavior.
026128| src/lib/data.ts:94:   description: string;
026129| NOTE: Implementation detail supporting search page behavior.
026130| src/lib/data.ts:95:   price: number;
026131| NOTE: Implementation detail supporting search page behavior.
026132| src/lib/data.ts:96:   images: string[];
026133| NOTE: Implementation detail supporting search page behavior.
026134| src/lib/data.ts:97:   availableSlots: number;
026135| NOTE: Implementation detail supporting search page behavior.
026136| src/lib/data.ts:98:   totalSlots: number;
026137| NOTE: Implementation detail supporting search page behavior.
026138| src/lib/data.ts:99:   amenities: string[];
026139| NOTE: Implementation detail supporting search page behavior.
026140| src/lib/data.ts:100:   houseRules: string[];
026141| NOTE: Implementation detail supporting search page behavior.
026142| src/lib/data.ts:101:   householdLanguages: string[];
026143| NOTE: Implementation detail supporting search page behavior.
026144| src/lib/data.ts:102:   primaryHomeLanguage?: string;
026145| NOTE: Implementation detail supporting search page behavior.
026146| src/lib/data.ts:103:   leaseDuration?: string;
026147| NOTE: Implementation detail supporting search page behavior.
026148| src/lib/data.ts:104:   roomType?: string;
026149| NOTE: Implementation detail supporting search page behavior.
026150| src/lib/data.ts:105:   moveInDate?: Date;
026151| NOTE: Implementation detail supporting search page behavior.
026152| src/lib/data.ts:106:   ownerId?: string;
026153| NOTE: Implementation detail supporting search page behavior.
026154| src/lib/data.ts:107:   location: {
026155| NOTE: Implementation detail supporting search page behavior.
026156| src/lib/data.ts:108:     address: string;
026157| NOTE: Implementation detail supporting search page behavior.
026158| src/lib/data.ts:109:     city: string;
026159| NOTE: Implementation detail supporting search page behavior.
026160| src/lib/data.ts:110:     state: string;
026161| NOTE: Implementation detail supporting search page behavior.
026162| src/lib/data.ts:111:     zip: string;
026163| NOTE: Implementation detail supporting search page behavior.
026164| src/lib/data.ts:112:     lat: number;
026165| NOTE: Implementation detail supporting search page behavior.
026166| src/lib/data.ts:113:     lng: number;
026167| NOTE: Implementation detail supporting search page behavior.
026168| src/lib/data.ts:114:   };
026169| NOTE: Implementation detail supporting search page behavior.
026170| src/lib/data.ts:115:   /** True if this listing is a near-match (matched expanded but not original filters) */
026171| NOTE: Block comment line describing behavior or context.
026172| src/lib/data.ts:116:   isNearMatch?: boolean;
026173| NOTE: Implementation detail supporting search page behavior.
026174| src/lib/data.ts:117: }
026175| NOTE: Implementation detail supporting search page behavior.
026176| src/lib/data.ts:118: 
026177| NOTE: Blank line for visual separation.
026178| src/lib/data.ts:119: export type SortOption =
026179| NOTE: Implementation detail supporting search page behavior.
026180| src/lib/data.ts:120:   | "recommended"
026181| NOTE: Implementation detail supporting search page behavior.
026182| src/lib/data.ts:121:   | "price_asc"
026183| NOTE: Implementation detail supporting search page behavior.
026184| src/lib/data.ts:122:   | "price_desc"
026185| NOTE: Implementation detail supporting search page behavior.
026186| src/lib/data.ts:123:   | "newest"
026187| NOTE: Implementation detail supporting search page behavior.
026188| src/lib/data.ts:124:   | "rating";
026189| NOTE: Implementation detail supporting search page behavior.
026190| src/lib/data.ts:125: 
026191| NOTE: Blank line for visual separation.
026192| src/lib/data.ts:126: export interface FilterParams {
026193| NOTE: Implementation detail supporting search page behavior.
026194| src/lib/data.ts:127:   query?: string;
026195| NOTE: Implementation detail supporting search page behavior.
026196| src/lib/data.ts:128:   minPrice?: number;
026197| NOTE: Implementation detail supporting search page behavior.
026198| src/lib/data.ts:129:   maxPrice?: number;
026199| NOTE: Implementation detail supporting search page behavior.
026200| src/lib/data.ts:130:   amenities?: string[];
026201| NOTE: Implementation detail supporting search page behavior.
026202| src/lib/data.ts:131:   moveInDate?: string;
026203| NOTE: Implementation detail supporting search page behavior.
026204| src/lib/data.ts:132:   leaseDuration?: string;
026205| NOTE: Implementation detail supporting search page behavior.
026206| src/lib/data.ts:133:   houseRules?: string[];
026207| NOTE: Implementation detail supporting search page behavior.
026208| src/lib/data.ts:134:   roomType?: string;
026209| NOTE: Implementation detail supporting search page behavior.
026210| src/lib/data.ts:135:   languages?: string[];
026211| NOTE: Implementation detail supporting search page behavior.
026212| src/lib/data.ts:136:   bounds?: {
026213| NOTE: Implementation detail supporting search page behavior.
026214| src/lib/data.ts:137:     minLat: number;
026215| NOTE: Implementation detail supporting search page behavior.
026216| src/lib/data.ts:138:     maxLat: number;
026217| NOTE: Implementation detail supporting search page behavior.
026218| src/lib/data.ts:139:     minLng: number;
026219| NOTE: Implementation detail supporting search page behavior.
026220| src/lib/data.ts:140:     maxLng: number;
026221| NOTE: Implementation detail supporting search page behavior.
026222| src/lib/data.ts:141:   };
026223| NOTE: Implementation detail supporting search page behavior.
026224| src/lib/data.ts:142:   page?: number;
026225| NOTE: Implementation detail supporting search page behavior.
026226| src/lib/data.ts:143:   limit?: number;
026227| NOTE: Implementation detail supporting search page behavior.
026228| src/lib/data.ts:144:   sort?: SortOption;
026229| NOTE: Implementation detail supporting search page behavior.
026230| src/lib/data.ts:145:   /** Include near-match results (relaxed filter criteria) */
026231| NOTE: Block comment line describing behavior or context.
026232| src/lib/data.ts:146:   nearMatches?: boolean;
026233| NOTE: Implementation detail supporting search page behavior.
026234| src/lib/data.ts:147: }
026235| NOTE: Implementation detail supporting search page behavior.
026236| src/lib/data.ts:148: 
026237| NOTE: Blank line for visual separation.
026238| src/lib/data.ts:149: export interface PaginatedResult<T> {
026239| NOTE: Implementation detail supporting search page behavior.
026240| src/lib/data.ts:150:   items: T[];
026241| NOTE: Implementation detail supporting search page behavior.
026242| src/lib/data.ts:151:   total: number;
026243| NOTE: Implementation detail supporting search page behavior.
026244| src/lib/data.ts:152:   page: number;
026245| NOTE: Implementation detail supporting search page behavior.
026246| src/lib/data.ts:153:   limit: number;
026247| NOTE: Implementation detail supporting search page behavior.
026248| src/lib/data.ts:154:   totalPages: number;
026249| NOTE: Implementation detail supporting search page behavior.
026250| src/lib/data.ts:155: }
026251| NOTE: Implementation detail supporting search page behavior.
026252| src/lib/data.ts:156: 
026253| NOTE: Blank line for visual separation.
026254| src/lib/data.ts:157: /**
026255| NOTE: Block comment line describing behavior or context.
026256| src/lib/data.ts:158:  * Hybrid pagination result - cost optimization for large result sets.
026257| NOTE: Block comment line describing behavior or context.
026258| src/lib/data.ts:159:  *
026259| NOTE: Block comment line describing behavior or context.
026260| src/lib/data.ts:160:  * When total \u2264 100: Full pagination UX with exact count
026261| NOTE: Block comment line describing behavior or context.
026262| src/lib/data.ts:161:  * When total > 100: Simplified UX with "100+ results" indicator
026263| NOTE: Block comment line describing behavior or context.
026264| src/lib/data.ts:162:  *
026265| NOTE: Block comment line describing behavior or context.
026266| src/lib/data.ts:163:  * This avoids expensive COUNT queries for large result sets while
026267| NOTE: Block comment line describing behavior or context.
026268| src/lib/data.ts:164:  * maintaining good UX for smaller, more manageable result sets.
026269| NOTE: Block comment line describing behavior or context.
026270| src/lib/data.ts:165:  */
026271| NOTE: Block comment line describing behavior or context.
026272| src/lib/data.ts:166: export interface PaginatedResultHybrid<T> {
026273| NOTE: Implementation detail supporting search page behavior.
026274| src/lib/data.ts:167:   items: T[];
026275| NOTE: Implementation detail supporting search page behavior.
026276| src/lib/data.ts:168:   /** Exact total if \u2264100, null if >100 (unknown) */
026277| NOTE: Block comment line describing behavior or context.
026278| src/lib/data.ts:169:   total: number | null;
026279| NOTE: Implementation detail supporting search page behavior.
026280| src/lib/data.ts:170:   /** Exact total pages if known, null otherwise */
026281| NOTE: Block comment line describing behavior or context.
026282| src/lib/data.ts:171:   totalPages: number | null;
026283| NOTE: Implementation detail supporting search page behavior.
026284| src/lib/data.ts:172:   /** Always known via limit+1 pattern */
026285| NOTE: Block comment line describing behavior or context.
026286| src/lib/data.ts:173:   hasNextPage: boolean;
026287| NOTE: Implementation detail supporting search page behavior.
026288| src/lib/data.ts:174:   /** Always known: page > 1 */
026289| NOTE: Block comment line describing behavior or context.
026290| src/lib/data.ts:175:   hasPrevPage: boolean;
026291| NOTE: Implementation detail supporting search page behavior.
026292| src/lib/data.ts:176:   page: number;
026293| NOTE: Implementation detail supporting search page behavior.
026294| src/lib/data.ts:177:   limit: number;
026295| NOTE: Implementation detail supporting search page behavior.
026296| src/lib/data.ts:178:   /** Count of near-match results included (when nearMatches enabled) */
026297| NOTE: Block comment line describing behavior or context.
026298| src/lib/data.ts:179:   nearMatchCount?: number;
026299| NOTE: Implementation detail supporting search page behavior.
026300| src/lib/data.ts:180:   /** Description of how filters were expanded for near-matches */
026301| NOTE: Block comment line describing behavior or context.
026302| src/lib/data.ts:181:   nearMatchExpansion?: string;
026303| NOTE: Implementation detail supporting search page behavior.
026304| src/lib/data.ts:182: }
026305| NOTE: Implementation detail supporting search page behavior.
026306| src/lib/data.ts:183: 
026307| NOTE: Blank line for visual separation.
026308| src/lib/data.ts:184: // Threshold for full COUNT vs hybrid mode
026309| NOTE: Line comment documents intent or constraints.
026310| src/lib/data.ts:185: const HYBRID_COUNT_THRESHOLD = 100;
026311| NOTE: Local declaration used by search logic or UI.
026312| src/lib/data.ts:186: 
026313| NOTE: Blank line for visual separation.
026314| src/lib/data.ts:187: // Constants for query validation
026315| NOTE: Line comment documents intent or constraints.
026316| src/lib/data.ts:188: export const MIN_QUERY_LENGTH = 2;
026317| NOTE: Implementation detail supporting search page behavior.
026318| src/lib/data.ts:189: export const MAX_QUERY_LENGTH = 200;
026319| NOTE: Implementation detail supporting search page behavior.
026320| src/lib/data.ts:190: 
026321| NOTE: Blank line for visual separation.
026322| src/lib/data.ts:191: // Helper function to sanitize search query and escape special characters
026323| NOTE: Line comment documents intent or constraints.
026324| src/lib/data.ts:192: // Supports international characters (unicode) while escaping SQL-dangerous chars
026325| NOTE: Line comment documents intent or constraints.
026326| src/lib/data.ts:193: export function sanitizeSearchQuery(query: string): string {
026327| NOTE: Exports helper or component function.
026328| src/lib/data.ts:194:   if (!query) return "";
026329| NOTE: Conditional logic controlling rendering or flow.
026330| src/lib/data.ts:195: 
026331| NOTE: Blank line for visual separation.
026332| src/lib/data.ts:196:   // Trim and limit length first
026333| NOTE: Line comment documents intent or constraints.
026334| src/lib/data.ts:197:   let sanitized = query.trim().slice(0, MAX_QUERY_LENGTH);
026335| NOTE: Local declaration used by search logic or UI.
026336| src/lib/data.ts:198: 
026337| NOTE: Blank line for visual separation.
026338| src/lib/data.ts:199:   // Unicode normalization (NFC) - ensures consistent representation
026339| NOTE: Line comment documents intent or constraints.
026340| src/lib/data.ts:200:   // e.g., "caf\u00E9" composed vs decomposed forms are treated the same
026341| NOTE: Line comment documents intent or constraints.
026342| src/lib/data.ts:201:   sanitized = sanitized.normalize("NFC");
026343| NOTE: Implementation detail supporting search page behavior.
026344| src/lib/data.ts:202: 
026345| NOTE: Blank line for visual separation.
026346| src/lib/data.ts:203:   // Remove invisible/zero-width characters that could bypass validation
026347| NOTE: Line comment documents intent or constraints.
026348| src/lib/data.ts:204:   // Includes: ZWSP, ZWJ, ZWNJ, RTL/LTR overrides, BOM, etc.
026349| NOTE: Line comment documents intent or constraints.
026350| src/lib/data.ts:205:   sanitized = sanitized
026351| NOTE: Implementation detail supporting search page behavior.
026352| src/lib/data.ts:206:     .replace(/[\u200B-\u200F\u2028-\u202F\uFEFF\u00AD]/g, "") // Zero-width and formatting chars
026353| NOTE: Implementation detail supporting search page behavior.
026354| src/lib/data.ts:207:     .replace(/[\u2060-\u206F]/g, "") // Word joiners, invisible operators
026355| NOTE: Implementation detail supporting search page behavior.
026356| src/lib/data.ts:208:     .replace(/[\uDB40-\uDBFF][\uDC00-\uDFFF]/g, ""); // Tag characters
026357| NOTE: Implementation detail supporting search page behavior.
026358| src/lib/data.ts:209: 
026359| NOTE: Blank line for visual separation.
026360| src/lib/data.ts:210:   // Encode HTML entities to prevent XSS
026361| NOTE: Line comment documents intent or constraints.
026362| src/lib/data.ts:211:   // This ensures that even if displayed, it won't execute as HTML
026363| NOTE: Line comment documents intent or constraints.
026364| src/lib/data.ts:212:   sanitized = sanitized
026365| NOTE: Implementation detail supporting search page behavior.
026366| src/lib/data.ts:213:     .replace(/&/g, "&amp;")
026367| NOTE: Implementation detail supporting search page behavior.
026368| src/lib/data.ts:214:     .replace(/</g, "&lt;")
026369| NOTE: Implementation detail supporting search page behavior.
026370| src/lib/data.ts:215:     .replace(/>/g, "&gt;");
026371| NOTE: Implementation detail supporting search page behavior.
026372| src/lib/data.ts:216: 
026373| NOTE: Blank line for visual separation.
026374| src/lib/data.ts:217:   // Escape SQL LIKE special characters
026375| NOTE: Line comment documents intent or constraints.
026376| src/lib/data.ts:218:   sanitized = sanitized.replace(/%/g, "\\%").replace(/_/g, "\\_");
026377| NOTE: Implementation detail supporting search page behavior.
026378| src/lib/data.ts:219: 
026379| NOTE: Blank line for visual separation.
026380| src/lib/data.ts:220:   // Remove only truly dangerous characters, keep unicode letters/numbers
026381| NOTE: Line comment documents intent or constraints.
026382| src/lib/data.ts:221:   // Allow: letters (any language), numbers, spaces, common punctuation
026383| NOTE: Line comment documents intent or constraints.
026384| src/lib/data.ts:222:   // Remove: SQL injection chars, control chars, etc.
026385| NOTE: Line comment documents intent or constraints.
026386| src/lib/data.ts:223:   sanitized = sanitized
026387| NOTE: Implementation detail supporting search page behavior.
026388| src/lib/data.ts:224:     .replace(/[\x00-\x1F\x7F]/g, "") // Control characters
026389| NOTE: Implementation detail supporting search page behavior.
026390| src/lib/data.ts:225:     .replace(/[;'"\\`]/g, "") // SQL-dangerous quotes and semicolons
026391| NOTE: Implementation detail supporting search page behavior.
026392| src/lib/data.ts:226:     .replace(/--/g, "") // SQL comment
026393| NOTE: Implementation detail supporting search page behavior.
026394| src/lib/data.ts:227:     .replace(/\/\*/g, "") // SQL block comment start
026395| NOTE: Implementation detail supporting search page behavior.
026396| src/lib/data.ts:228:     .replace(/\*\//g, ""); // SQL block comment end
026397| NOTE: Implementation detail supporting search page behavior.
026398| src/lib/data.ts:229: 
026399| NOTE: Blank line for visual separation.
026400| src/lib/data.ts:230:   return sanitized.trim();
026401| NOTE: Return statement for component or helper output.
026402| src/lib/data.ts:231: }
026403| NOTE: Implementation detail supporting search page behavior.
026404| src/lib/data.ts:232: 
026405| NOTE: Blank line for visual separation.
026406| src/lib/data.ts:233: // Validate query meets minimum requirements
026407| NOTE: Line comment documents intent or constraints.
026408| src/lib/data.ts:234: export function isValidQuery(query: string): boolean {
026409| NOTE: Exports helper or component function.
026410| src/lib/data.ts:235:   const sanitized = sanitizeSearchQuery(query);
026411| NOTE: Local declaration used by search logic or UI.
026412| src/lib/data.ts:236:   return sanitized.length >= MIN_QUERY_LENGTH;
026413| NOTE: Return statement for component or helper output.
026414| src/lib/data.ts:237: }
026415| NOTE: Implementation detail supporting search page behavior.
026416| src/lib/data.ts:238: 
026417| NOTE: Blank line for visual separation.
026418| src/lib/data.ts:239: function parseDateOnly(value: string): Date {
026419| NOTE: Defines a helper or component function.
026420| src/lib/data.ts:240:   const [year, month, day] = value.split("-").map(Number);
026421| NOTE: Local declaration used by search logic or UI.
026422| src/lib/data.ts:241:   return new Date(year, month - 1, day);
026423| NOTE: Return statement for component or helper output.
026424| src/lib/data.ts:242: }
026425| NOTE: Implementation detail supporting search page behavior.
026426| src/lib/data.ts:243: 
026427| NOTE: Blank line for visual separation.
026428| src/lib/data.ts:244: // Check if coordinates are valid (not NULL, not zero, within valid range)
026429| NOTE: Line comment documents intent or constraints.
026430| src/lib/data.ts:245: // lat=0, lng=0 is in the Gulf of Guinea and not a valid address
026431| NOTE: Line comment documents intent or constraints.
026432| src/lib/data.ts:246: export function hasValidCoordinates(
026433| NOTE: Exports helper or component function.
026434| src/lib/data.ts:247:   lat: number | null | undefined,
026435| NOTE: Implementation detail supporting search page behavior.
026436| src/lib/data.ts:248:   lng: number | null | undefined,
026437| NOTE: Implementation detail supporting search page behavior.
026438| src/lib/data.ts:249: ): boolean {
026439| NOTE: Implementation detail supporting search page behavior.
026440| src/lib/data.ts:250:   if (lat === null || lat === undefined || lng === null || lng === undefined) {
026441| NOTE: Conditional logic controlling rendering or flow.
026442| src/lib/data.ts:251:     return false;
026443| NOTE: Return statement for component or helper output.
026444| src/lib/data.ts:252:   }
026445| NOTE: Implementation detail supporting search page behavior.
026446| src/lib/data.ts:253:   // Check for zero coordinates (invalid geocoding result)
026447| NOTE: Line comment documents intent or constraints.
026448| src/lib/data.ts:254:   if (lat === 0 && lng === 0) {
026449| NOTE: Conditional logic controlling rendering or flow.
026450| src/lib/data.ts:255:     return false;
026451| NOTE: Return statement for component or helper output.
026452| src/lib/data.ts:256:   }
026453| NOTE: Implementation detail supporting search page behavior.
026454| src/lib/data.ts:257:   // Check valid ranges
026455| NOTE: Line comment documents intent or constraints.
026456| src/lib/data.ts:258:   if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
026457| NOTE: Conditional logic controlling rendering or flow.
026458| src/lib/data.ts:259:     return false;
026459| NOTE: Return statement for component or helper output.
026460| src/lib/data.ts:260:   }
026461| NOTE: Implementation detail supporting search page behavior.
026462| src/lib/data.ts:261:   return true;
026463| NOTE: Return statement for component or helper output.
026464| src/lib/data.ts:262: }
026465| NOTE: Implementation detail supporting search page behavior.
026466| src/lib/data.ts:263: 
026467| NOTE: Blank line for visual separation.
026468| src/lib/data.ts:264: /**
026469| NOTE: Block comment line describing behavior or context.
026470| src/lib/data.ts:265:  * Detects if bounds cross the antimeridian (international date line at \u00B1180\u00B0).
026471| NOTE: Block comment line describing behavior or context.
026472| src/lib/data.ts:266:  * When map view spans from Asia to Americas, minLng (west) > maxLng (east).
026473| NOTE: Block comment line describing behavior or context.
026474| src/lib/data.ts:267:  * This is a valid scenario requiring split queries.
026475| NOTE: Block comment line describing behavior or context.
026476| src/lib/data.ts:268:  */
026477| NOTE: Block comment line describing behavior or context.
026478| src/lib/data.ts:269: export function crossesAntimeridian(minLng: number, maxLng: number): boolean {
026479| NOTE: Exports helper or component function.
026480| src/lib/data.ts:270:   return minLng > maxLng;
026481| NOTE: Return statement for component or helper output.
026482| src/lib/data.ts:271: }
026483| NOTE: Implementation detail supporting search page behavior.
026484| src/lib/data.ts:272: 
026485| NOTE: Blank line for visual separation.
026486| src/lib/data.ts:273: // Extended listing type with computed fields for filtering/sorting
026487| NOTE: Line comment documents intent or constraints.
026488| src/lib/data.ts:274: export interface ListingWithMetadata extends ListingData {
026489| NOTE: Implementation detail supporting search page behavior.
026490| src/lib/data.ts:275:   createdAt: Date;
026491| NOTE: Implementation detail supporting search page behavior.
026492| src/lib/data.ts:276:   viewCount: number;
026493| NOTE: Implementation detail supporting search page behavior.
026494| src/lib/data.ts:277:   avgRating: number;
026495| NOTE: Implementation detail supporting search page behavior.
026496| src/lib/data.ts:278:   reviewCount: number;
026497| NOTE: Implementation detail supporting search page behavior.
026498| src/lib/data.ts:279: }
026499| NOTE: Implementation detail supporting search page behavior.
026500| src/lib/data.ts:280: 
026501| NOTE: Blank line for visual separation.
026502| src/lib/data.ts:281: // ============================================
026503| NOTE: Line comment documents intent or constraints.
026504| src/lib/data.ts:282: // Pure filter functions for testability
026505| NOTE: Line comment documents intent or constraints.
026506| src/lib/data.ts:283: // ============================================
026507| NOTE: Line comment documents intent or constraints.
026508| src/lib/data.ts:284: 
026509| NOTE: Blank line for visual separation.
026510| src/lib/data.ts:285: // Filter by price range
026511| NOTE: Line comment documents intent or constraints.
026512| src/lib/data.ts:286: export function filterByPrice<T extends { price: number }>(
026513| NOTE: Exports helper or component function.
026514| src/lib/data.ts:287:   listings: T[],
026515| NOTE: Implementation detail supporting search page behavior.
026516| src/lib/data.ts:288:   minPrice?: number | null,
026517| NOTE: Implementation detail supporting search page behavior.
026518| src/lib/data.ts:289:   maxPrice?: number | null,
026519| NOTE: Implementation detail supporting search page behavior.
026520| src/lib/data.ts:290: ): T[] {
026521| NOTE: Implementation detail supporting search page behavior.
026522| src/lib/data.ts:291:   let results = listings;
026523| NOTE: Local declaration used by search logic or UI.
026524| src/lib/data.ts:292:   if (minPrice !== undefined && minPrice !== null) {
026525| NOTE: Conditional logic controlling rendering or flow.
026526| src/lib/data.ts:293:     results = results.filter((l) => l.price >= minPrice);
026527| NOTE: Implementation detail supporting search page behavior.
026528| src/lib/data.ts:294:   }
026529| NOTE: Implementation detail supporting search page behavior.
026530| src/lib/data.ts:295:   if (maxPrice !== undefined && maxPrice !== null) {
026531| NOTE: Conditional logic controlling rendering or flow.
026532| src/lib/data.ts:296:     results = results.filter((l) => l.price <= maxPrice);
026533| NOTE: Implementation detail supporting search page behavior.
026534| src/lib/data.ts:297:   }
026535| NOTE: Implementation detail supporting search page behavior.
026536| src/lib/data.ts:298:   return results;
026537| NOTE: Return statement for component or helper output.
026538| src/lib/data.ts:299: }
026539| NOTE: Implementation detail supporting search page behavior.
026540| src/lib/data.ts:300: 
026541| NOTE: Blank line for visual separation.
026542| src/lib/data.ts:301: // Filter by amenities (AND logic - must have ALL selected)
026543| NOTE: Line comment documents intent or constraints.
026544| src/lib/data.ts:302: export function filterByAmenities<T extends { amenities: string[] }>(
026545| NOTE: Exports helper or component function.
026546| src/lib/data.ts:303:   listings: T[],
026547| NOTE: Implementation detail supporting search page behavior.
026548| src/lib/data.ts:304:   amenities?: string[],
026549| NOTE: Implementation detail supporting search page behavior.
026550| src/lib/data.ts:305: ): T[] {
026551| NOTE: Implementation detail supporting search page behavior.
026552| src/lib/data.ts:306:   if (!amenities || amenities.length === 0) return listings;
026553| NOTE: Conditional logic controlling rendering or flow.
026554| src/lib/data.ts:307:   // Use partial matching: UI sends 'Pool' but DB has 'Pool Access'
026555| NOTE: Line comment documents intent or constraints.
026556| src/lib/data.ts:308:   const amenitiesLower = amenities.map((a) => a.toLowerCase());
026557| NOTE: Local declaration used by search logic or UI.
026558| src/lib/data.ts:309:   return listings.filter((l) =>
026559| NOTE: Return statement for component or helper output.
026560| src/lib/data.ts:310:     amenitiesLower.every((a) =>
026561| NOTE: Implementation detail supporting search page behavior.
026562| src/lib/data.ts:311:       l.amenities.some((la: string) => la.toLowerCase().includes(a)),
026563| NOTE: Implementation detail supporting search page behavior.
026564| src/lib/data.ts:312:     ),
026565| NOTE: Implementation detail supporting search page behavior.
026566| src/lib/data.ts:313:   );
026567| NOTE: Implementation detail supporting search page behavior.
026568| src/lib/data.ts:314: }
026569| NOTE: Implementation detail supporting search page behavior.
026570| src/lib/data.ts:315: 
026571| NOTE: Blank line for visual separation.
026572| src/lib/data.ts:316: // Filter by house rules (AND logic - must have ALL selected)
026573| NOTE: Line comment documents intent or constraints.
026574| src/lib/data.ts:317: export function filterByHouseRules<T extends { houseRules: string[] }>(
026575| NOTE: Exports helper or component function.
026576| src/lib/data.ts:318:   listings: T[],
026577| NOTE: Implementation detail supporting search page behavior.
026578| src/lib/data.ts:319:   houseRules?: string[],
026579| NOTE: Implementation detail supporting search page behavior.
026580| src/lib/data.ts:320: ): T[] {
026581| NOTE: Implementation detail supporting search page behavior.
026582| src/lib/data.ts:321:   if (!houseRules || houseRules.length === 0) return listings;
026583| NOTE: Conditional logic controlling rendering or flow.
026584| src/lib/data.ts:322:   const rulesLower = houseRules.map((r) => r.toLowerCase());
026585| NOTE: Local declaration used by search logic or UI.
026586| src/lib/data.ts:323:   return listings.filter((l) =>
026587| NOTE: Return statement for component or helper output.
026588| src/lib/data.ts:324:     rulesLower.every((r) =>
026589| NOTE: Implementation detail supporting search page behavior.
026590| src/lib/data.ts:325:       l.houseRules.some((hr: string) => hr.toLowerCase() === r),
026591| NOTE: Implementation detail supporting search page behavior.
026592| src/lib/data.ts:326:     ),
026593| NOTE: Implementation detail supporting search page behavior.
026594| src/lib/data.ts:327:   );
026595| NOTE: Implementation detail supporting search page behavior.
026596| src/lib/data.ts:328: }
026597| NOTE: Implementation detail supporting search page behavior.
026598| src/lib/data.ts:329: 
026599| NOTE: Blank line for visual separation.
026600| src/lib/data.ts:330: // Filter by languages (OR logic - show if household speaks ANY selected language)
026601| NOTE: Line comment documents intent or constraints.
026602| src/lib/data.ts:331: export function filterByLanguages<T extends { householdLanguages: string[] }>(
026603| NOTE: Exports helper or component function.
026604| src/lib/data.ts:332:   listings: T[],
026605| NOTE: Implementation detail supporting search page behavior.
026606| src/lib/data.ts:333:   languages?: string[],
026607| NOTE: Implementation detail supporting search page behavior.
026608| src/lib/data.ts:334: ): T[] {
026609| NOTE: Implementation detail supporting search page behavior.
026610| src/lib/data.ts:335:   if (!languages || languages.length === 0) return listings;
026611| NOTE: Conditional logic controlling rendering or flow.
026612| src/lib/data.ts:336:   const languagesLower = languages.map((l) => l.toLowerCase());
026613| NOTE: Local declaration used by search logic or UI.
026614| src/lib/data.ts:337:   return listings.filter((listing) =>
026615| NOTE: Return statement for component or helper output.
026616| src/lib/data.ts:338:     languagesLower.some((lang) =>
026617| NOTE: Implementation detail supporting search page behavior.
026618| src/lib/data.ts:339:       listing.householdLanguages.some(
026619| NOTE: Implementation detail supporting search page behavior.
026620| src/lib/data.ts:340:         (ll: string) => ll.toLowerCase() === lang,
026621| NOTE: Implementation detail supporting search page behavior.
026622| src/lib/data.ts:341:       ),
026623| NOTE: Implementation detail supporting search page behavior.
026624| src/lib/data.ts:342:     ),
026625| NOTE: Implementation detail supporting search page behavior.
026626| src/lib/data.ts:343:   );
026627| NOTE: Implementation detail supporting search page behavior.
026628| src/lib/data.ts:344: }
026629| NOTE: Implementation detail supporting search page behavior.
026630| src/lib/data.ts:345: 
026631| NOTE: Blank line for visual separation.
026632| src/lib/data.ts:346: // Filter by room type (exact match, case-insensitive)
026633| NOTE: Line comment documents intent or constraints.
026634| src/lib/data.ts:347: export function filterByRoomType<T extends { roomType?: string }>(
026635| NOTE: Exports helper or component function.
026636| src/lib/data.ts:348:   listings: T[],
026637| NOTE: Implementation detail supporting search page behavior.
026638| src/lib/data.ts:349:   roomType?: string,
026639| NOTE: Implementation detail supporting search page behavior.
026640| src/lib/data.ts:350: ): T[] {
026641| NOTE: Implementation detail supporting search page behavior.
026642| src/lib/data.ts:351:   if (!roomType) return listings;
026643| NOTE: Conditional logic controlling rendering or flow.
026644| src/lib/data.ts:352:   const roomTypeLower = roomType.toLowerCase();
026645| NOTE: Local declaration used by search logic or UI.
026646| src/lib/data.ts:353:   return listings.filter(
026647| NOTE: Return statement for component or helper output.
026648| src/lib/data.ts:354:     (l) => l.roomType && l.roomType.toLowerCase() === roomTypeLower,
026649| NOTE: Implementation detail supporting search page behavior.
026650| src/lib/data.ts:355:   );
026651| NOTE: Implementation detail supporting search page behavior.
026652| src/lib/data.ts:356: }
026653| NOTE: Implementation detail supporting search page behavior.
026654| src/lib/data.ts:357: 
026655| NOTE: Blank line for visual separation.
026656| src/lib/data.ts:358: // Filter by lease duration (exact match, case-insensitive)
026657| NOTE: Line comment documents intent or constraints.
026658| src/lib/data.ts:359: export function filterByLeaseDuration<T extends { leaseDuration?: string }>(
026659| NOTE: Exports helper or component function.
026660| src/lib/data.ts:360:   listings: T[],
026661| NOTE: Implementation detail supporting search page behavior.
026662| src/lib/data.ts:361:   leaseDuration?: string,
026663| NOTE: Implementation detail supporting search page behavior.
026664| src/lib/data.ts:362: ): T[] {
026665| NOTE: Implementation detail supporting search page behavior.
026666| src/lib/data.ts:363:   if (!leaseDuration) return listings;
026667| NOTE: Conditional logic controlling rendering or flow.
026668| src/lib/data.ts:364:   const leaseLower = leaseDuration.toLowerCase();
026669| NOTE: Local declaration used by search logic or UI.
026670| src/lib/data.ts:365:   return listings.filter(
026671| NOTE: Return statement for component or helper output.
026672| src/lib/data.ts:366:     (l) => l.leaseDuration && l.leaseDuration.toLowerCase() === leaseLower,
026673| NOTE: Implementation detail supporting search page behavior.
026674| src/lib/data.ts:367:   );
026675| NOTE: Implementation detail supporting search page behavior.
026676| src/lib/data.ts:368: }
026677| NOTE: Implementation detail supporting search page behavior.
026678| src/lib/data.ts:369: 
026679| NOTE: Blank line for visual separation.
026680| src/lib/data.ts:370: // Filter by move-in date (listing available by target date)
026681| NOTE: Line comment documents intent or constraints.
026682| src/lib/data.ts:371: export function filterByMoveInDate<T extends { moveInDate?: Date }>(
026683| NOTE: Exports helper or component function.
026684| src/lib/data.ts:372:   listings: T[],
026685| NOTE: Implementation detail supporting search page behavior.
026686| src/lib/data.ts:373:   moveInDate?: string,
026687| NOTE: Implementation detail supporting search page behavior.
026688| src/lib/data.ts:374: ): T[] {
026689| NOTE: Implementation detail supporting search page behavior.
026690| src/lib/data.ts:375:   if (!moveInDate) return listings;
026691| NOTE: Conditional logic controlling rendering or flow.
026692| src/lib/data.ts:376:   const targetDate = new Date(moveInDate);
026693| NOTE: Local declaration used by search logic or UI.
026694| src/lib/data.ts:377:   return listings.filter(
026695| NOTE: Return statement for component or helper output.
026696| src/lib/data.ts:378:     (l) => !l.moveInDate || new Date(l.moveInDate) <= targetDate,
026697| NOTE: Implementation detail supporting search page behavior.
026698| src/lib/data.ts:379:   );
026699| NOTE: Implementation detail supporting search page behavior.
026700| src/lib/data.ts:380: }
026701| NOTE: Implementation detail supporting search page behavior.
026702| src/lib/data.ts:381: 
026703| NOTE: Blank line for visual separation.
026704| src/lib/data.ts:382: // Filter by geographic bounds
026705| NOTE: Line comment documents intent or constraints.
026706| src/lib/data.ts:383: export function filterByBounds<
026707| NOTE: Exports helper or component function.
026708| src/lib/data.ts:384:   T extends { location: { lat: number; lng: number } },
026709| NOTE: Implementation detail supporting search page behavior.
026710| src/lib/data.ts:385: >(
026711| NOTE: Implementation detail supporting search page behavior.
026712| src/lib/data.ts:386:   listings: T[],
026713| NOTE: Implementation detail supporting search page behavior.
026714| src/lib/data.ts:387:   bounds?: { minLat: number; maxLat: number; minLng: number; maxLng: number },
026715| NOTE: Implementation detail supporting search page behavior.
026716| src/lib/data.ts:388: ): T[] {
026717| NOTE: Implementation detail supporting search page behavior.
026718| src/lib/data.ts:389:   if (!bounds) return listings;
026719| NOTE: Conditional logic controlling rendering or flow.
026720| src/lib/data.ts:390:   return listings.filter(
026721| NOTE: Return statement for component or helper output.
026722| src/lib/data.ts:391:     (l) =>
026723| NOTE: Implementation detail supporting search page behavior.
026724| src/lib/data.ts:392:       l.location.lat >= bounds.minLat &&
026725| NOTE: Implementation detail supporting search page behavior.
026726| src/lib/data.ts:393:       l.location.lat <= bounds.maxLat &&
026727| NOTE: Implementation detail supporting search page behavior.
026728| src/lib/data.ts:394:       l.location.lng >= bounds.minLng &&
026729| NOTE: Implementation detail supporting search page behavior.
026730| src/lib/data.ts:395:       l.location.lng <= bounds.maxLng,
026731| NOTE: Implementation detail supporting search page behavior.
026732| src/lib/data.ts:396:   );
026733| NOTE: Implementation detail supporting search page behavior.
026734| src/lib/data.ts:397: }
026735| NOTE: Implementation detail supporting search page behavior.
026736| src/lib/data.ts:398: 
026737| NOTE: Blank line for visual separation.
026738| src/lib/data.ts:399: // Filter by text query (searches title, description, city, state)
026739| NOTE: Line comment documents intent or constraints.
026740| src/lib/data.ts:400: export function filterByQuery<
026741| NOTE: Exports helper or component function.
026742| src/lib/data.ts:401:   T extends {
026743| NOTE: Implementation detail supporting search page behavior.
026744| src/lib/data.ts:402:     title: string;
026745| NOTE: Implementation detail supporting search page behavior.
026746| src/lib/data.ts:403:     description: string;
026747| NOTE: Implementation detail supporting search page behavior.
026748| src/lib/data.ts:404:     location: { city: string; state: string };
026749| NOTE: Implementation detail supporting search page behavior.
026750| src/lib/data.ts:405:   },
026751| NOTE: Implementation detail supporting search page behavior.
026752| src/lib/data.ts:406: >(listings: T[], query?: string): T[] {
026753| NOTE: Implementation detail supporting search page behavior.
026754| src/lib/data.ts:407:   if (!query || !isValidQuery(query)) return listings;
026755| NOTE: Conditional logic controlling rendering or flow.
026756| src/lib/data.ts:408:   const q = sanitizeSearchQuery(query).toLowerCase();
026757| NOTE: Local declaration used by search logic or UI.
026758| src/lib/data.ts:409:   if (!q) return listings;
026759| NOTE: Conditional logic controlling rendering or flow.
026760| src/lib/data.ts:410:   return listings.filter(
026761| NOTE: Return statement for component or helper output.
026762| src/lib/data.ts:411:     (l) =>
026763| NOTE: Implementation detail supporting search page behavior.
026764| src/lib/data.ts:412:       l.title.toLowerCase().includes(q) ||
026765| NOTE: Implementation detail supporting search page behavior.
026766| src/lib/data.ts:413:       l.description.toLowerCase().includes(q) ||
026767| NOTE: Implementation detail supporting search page behavior.
026768| src/lib/data.ts:414:       l.location.city.toLowerCase().includes(q) ||
026769| NOTE: Implementation detail supporting search page behavior.
026770| src/lib/data.ts:415:       l.location.state.toLowerCase().includes(q),
026771| NOTE: Implementation detail supporting search page behavior.
026772| src/lib/data.ts:416:   );
026773| NOTE: Implementation detail supporting search page behavior.
026774| src/lib/data.ts:417: }
026775| NOTE: Implementation detail supporting search page behavior.
026776| src/lib/data.ts:418: 
026777| NOTE: Blank line for visual separation.
026778| src/lib/data.ts:419: // ============================================
026779| NOTE: Line comment documents intent or constraints.
026780| src/lib/data.ts:420: // Sorting functions for testability
026781| NOTE: Line comment documents intent or constraints.
026782| src/lib/data.ts:421: // ============================================
026783| NOTE: Line comment documents intent or constraints.
026784| src/lib/data.ts:422: 
026785| NOTE: Blank line for visual separation.
026786| src/lib/data.ts:423: export function sortListings(
026787| NOTE: Exports helper or component function.
026788| src/lib/data.ts:424:   listings: ListingWithMetadata[],
026789| NOTE: Implementation detail supporting search page behavior.
026790| src/lib/data.ts:425:   sort: SortOption = "recommended",
026791| NOTE: Implementation detail supporting search page behavior.
026792| src/lib/data.ts:426: ): ListingWithMetadata[] {
026793| NOTE: Implementation detail supporting search page behavior.
026794| src/lib/data.ts:427:   const results = [...listings]; // Don't mutate original
026795| NOTE: Local declaration used by search logic or UI.
026796| src/lib/data.ts:428:   switch (sort) {
026797| NOTE: Implementation detail supporting search page behavior.
026798| src/lib/data.ts:429:     case "price_asc":
026799| NOTE: Implementation detail supporting search page behavior.
026800| src/lib/data.ts:430:       results.sort((a, b) => {
026801| NOTE: Implementation detail supporting search page behavior.
026802| src/lib/data.ts:431:         const priceDiff = a.price - b.price;
026803| NOTE: Local declaration used by search logic or UI.
026804| src/lib/data.ts:432:         if (priceDiff !== 0) return priceDiff;
026805| NOTE: Conditional logic controlling rendering or flow.
026806| src/lib/data.ts:433:         return b.createdAt.getTime() - a.createdAt.getTime();
026807| NOTE: Return statement for component or helper output.
026808| src/lib/data.ts:434:       });
026809| NOTE: Implementation detail supporting search page behavior.
026810| src/lib/data.ts:435:       break;
026811| NOTE: Implementation detail supporting search page behavior.
026812| src/lib/data.ts:436:     case "price_desc":
026813| NOTE: Implementation detail supporting search page behavior.
026814| src/lib/data.ts:437:       results.sort((a, b) => {
026815| NOTE: Implementation detail supporting search page behavior.
026816| src/lib/data.ts:438:         const priceDiff = b.price - a.price;
026817| NOTE: Local declaration used by search logic or UI.
026818| src/lib/data.ts:439:         if (priceDiff !== 0) return priceDiff;
026819| NOTE: Conditional logic controlling rendering or flow.
026820| src/lib/data.ts:440:         return b.createdAt.getTime() - a.createdAt.getTime();
026821| NOTE: Return statement for component or helper output.
026822| src/lib/data.ts:441:       });
026823| NOTE: Implementation detail supporting search page behavior.
026824| src/lib/data.ts:442:       break;
026825| NOTE: Implementation detail supporting search page behavior.
026826| src/lib/data.ts:443:     case "newest":
026827| NOTE: Implementation detail supporting search page behavior.
026828| src/lib/data.ts:444:       results.sort((a, b) => {
026829| NOTE: Implementation detail supporting search page behavior.
026830| src/lib/data.ts:445:         const timeDiff = b.createdAt.getTime() - a.createdAt.getTime();
026831| NOTE: Local declaration used by search logic or UI.
026832| src/lib/data.ts:446:         if (timeDiff !== 0) return timeDiff;
026833| NOTE: Conditional logic controlling rendering or flow.
026834| src/lib/data.ts:447:         return a.id.localeCompare(b.id);
026835| NOTE: Return statement for component or helper output.
026836| src/lib/data.ts:448:       });
026837| NOTE: Implementation detail supporting search page behavior.
026838| src/lib/data.ts:449:       break;
026839| NOTE: Implementation detail supporting search page behavior.
026840| src/lib/data.ts:450:     case "rating":
026841| NOTE: Implementation detail supporting search page behavior.
026842| src/lib/data.ts:451:       results.sort((a, b) => {
026843| NOTE: Implementation detail supporting search page behavior.
026844| src/lib/data.ts:452:         const ratingDiff = b.avgRating - a.avgRating;
026845| NOTE: Local declaration used by search logic or UI.
026846| src/lib/data.ts:453:         if (ratingDiff !== 0) return ratingDiff;
026847| NOTE: Conditional logic controlling rendering or flow.
026848| src/lib/data.ts:454:         const reviewDiff = b.reviewCount - a.reviewCount;
026849| NOTE: Local declaration used by search logic or UI.
026850| src/lib/data.ts:455:         if (reviewDiff !== 0) return reviewDiff;
026851| NOTE: Conditional logic controlling rendering or flow.
026852| src/lib/data.ts:456:         return b.createdAt.getTime() - a.createdAt.getTime();
026853| NOTE: Return statement for component or helper output.
026854| src/lib/data.ts:457:       });
026855| NOTE: Implementation detail supporting search page behavior.
026856| src/lib/data.ts:458:       break;
026857| NOTE: Implementation detail supporting search page behavior.
026858| src/lib/data.ts:459:     case "recommended":
026859| NOTE: Implementation detail supporting search page behavior.
026860| src/lib/data.ts:460:     default:
026861| NOTE: Implementation detail supporting search page behavior.
026862| src/lib/data.ts:461:       results.sort((a, b) => {
026863| NOTE: Implementation detail supporting search page behavior.
026864| src/lib/data.ts:462:         const aScore = a.avgRating * 20 + a.viewCount * 0.1 + a.reviewCount * 5;
026865| NOTE: Local declaration used by search logic or UI.
026866| src/lib/data.ts:463:         const bScore = b.avgRating * 20 + b.viewCount * 0.1 + b.reviewCount * 5;
026867| NOTE: Local declaration used by search logic or UI.
026868| src/lib/data.ts:464:         const scoreDiff = bScore - aScore;
026869| NOTE: Local declaration used by search logic or UI.
026870| src/lib/data.ts:465:         if (scoreDiff !== 0) return scoreDiff;
026871| NOTE: Conditional logic controlling rendering or flow.
026872| src/lib/data.ts:466:         return b.createdAt.getTime() - a.createdAt.getTime();
026873| NOTE: Return statement for component or helper output.
026874| src/lib/data.ts:467:       });
026875| NOTE: Implementation detail supporting search page behavior.
026876| src/lib/data.ts:468:       break;
026877| NOTE: Implementation detail supporting search page behavior.
026878| src/lib/data.ts:469:   }
026879| NOTE: Implementation detail supporting search page behavior.
026880| src/lib/data.ts:470:   return results;
026881| NOTE: Return statement for component or helper output.
026882| src/lib/data.ts:471: }
026883| NOTE: Implementation detail supporting search page behavior.
026884| src/lib/data.ts:472: 
026885| NOTE: Blank line for visual separation.
026886| src/lib/data.ts:473: // Maximum results to return for performance (prevents memory issues on wide map bounds)
026887| NOTE: Line comment documents intent or constraints.
026888| src/lib/data.ts:474: const MAX_RESULTS_CAP = 500;
026889| NOTE: Local declaration used by search logic or UI.
026890| src/lib/data.ts:475: 
026891| NOTE: Blank line for visual separation.
026892| src/lib/data.ts:476: export async function getListings(
026893| NOTE: Implementation detail supporting search page behavior.
026894| src/lib/data.ts:477:   params: FilterParams = {},
026895| NOTE: Implementation detail supporting search page behavior.
026896| src/lib/data.ts:478: ): Promise<ListingData[]> {
026897| NOTE: Implementation detail supporting search page behavior.
026898| src/lib/data.ts:479:   const {
026899| NOTE: Local declaration used by search logic or UI.
026900| src/lib/data.ts:480:     query,
026901| NOTE: Implementation detail supporting search page behavior.
026902| src/lib/data.ts:481:     minPrice,
026903| NOTE: Implementation detail supporting search page behavior.
026904| src/lib/data.ts:482:     maxPrice,
026905| NOTE: Implementation detail supporting search page behavior.
026906| src/lib/data.ts:483:     amenities,
026907| NOTE: Implementation detail supporting search page behavior.
026908| src/lib/data.ts:484:     moveInDate,
026909| NOTE: Implementation detail supporting search page behavior.
026910| src/lib/data.ts:485:     leaseDuration,
026911| NOTE: Implementation detail supporting search page behavior.
026912| src/lib/data.ts:486:     houseRules,
026913| NOTE: Implementation detail supporting search page behavior.
026914| src/lib/data.ts:487:     roomType,
026915| NOTE: Implementation detail supporting search page behavior.
026916| src/lib/data.ts:488:     languages,
026917| NOTE: Implementation detail supporting search page behavior.
026918| src/lib/data.ts:489:     bounds,
026919| NOTE: Implementation detail supporting search page behavior.
026920| src/lib/data.ts:490:     sort = "recommended",
026921| NOTE: Implementation detail supporting search page behavior.
026922| src/lib/data.ts:491:   } = params;
026923| NOTE: Implementation detail supporting search page behavior.
026924| src/lib/data.ts:492: 
026925| NOTE: Blank line for visual separation.
026926| src/lib/data.ts:493:   try {
026927| NOTE: Implementation detail supporting search page behavior.
026928| src/lib/data.ts:494:     // Fetch all active listings with location data
026929| NOTE: Line comment documents intent or constraints.
026930| src/lib/data.ts:495:     const listings = await prisma.$queryRaw`
026931| NOTE: Local declaration used by search logic or UI.
026932| src/lib/data.ts:496:       SELECT
026933| NOTE: Implementation detail supporting search page behavior.
026934| src/lib/data.ts:497:           l.id,
026935| NOTE: Implementation detail supporting search page behavior.
026936| src/lib/data.ts:498:           l.title,
026937| NOTE: Implementation detail supporting search page behavior.
026938| src/lib/data.ts:499:           l.description,
026939| NOTE: Implementation detail supporting search page behavior.
026940| src/lib/data.ts:500:           l.price,
026941| NOTE: Implementation detail supporting search page behavior.
026942| src/lib/data.ts:501:           l.images,
026943| NOTE: Implementation detail supporting search page behavior.
026944| src/lib/data.ts:502:           l."availableSlots",
026945| NOTE: Implementation detail supporting search page behavior.
026946| src/lib/data.ts:503:           l."totalSlots",
026947| NOTE: Implementation detail supporting search page behavior.
026948| src/lib/data.ts:504:           l.amenities,
026949| NOTE: Implementation detail supporting search page behavior.
026950| src/lib/data.ts:505:           l."houseRules",
026951| NOTE: Implementation detail supporting search page behavior.
026952| src/lib/data.ts:506:           l."household_languages",
026953| NOTE: Implementation detail supporting search page behavior.
026954| src/lib/data.ts:507:           l."primary_home_language",
026955| NOTE: Implementation detail supporting search page behavior.
026956| src/lib/data.ts:508:           l."leaseDuration",
026957| NOTE: Implementation detail supporting search page behavior.
026958| src/lib/data.ts:509:           l."roomType",
026959| NOTE: Implementation detail supporting search page behavior.
026960| src/lib/data.ts:510:           l."moveInDate",
026961| NOTE: Implementation detail supporting search page behavior.
026962| src/lib/data.ts:511:           l."ownerId",
026963| NOTE: Implementation detail supporting search page behavior.
026964| src/lib/data.ts:512:           l."createdAt",
026965| NOTE: Implementation detail supporting search page behavior.
026966| src/lib/data.ts:513:           l."viewCount",
026967| NOTE: Implementation detail supporting search page behavior.
026968| src/lib/data.ts:514:           loc.address,
026969| NOTE: Implementation detail supporting search page behavior.
026970| src/lib/data.ts:515:           loc.city,
026971| NOTE: Implementation detail supporting search page behavior.
026972| src/lib/data.ts:516:           loc.state,
026973| NOTE: Implementation detail supporting search page behavior.
026974| src/lib/data.ts:517:           loc.zip,
026975| NOTE: Implementation detail supporting search page behavior.
026976| src/lib/data.ts:518:           ST_X(loc.coords::geometry) as lng,
026977| NOTE: Implementation detail supporting search page behavior.
026978| src/lib/data.ts:519:           ST_Y(loc.coords::geometry) as lat,
026979| NOTE: Implementation detail supporting search page behavior.
026980| src/lib/data.ts:520:           COALESCE(AVG(r.rating), 0) as avg_rating,
026981| NOTE: Implementation detail supporting search page behavior.
026982| src/lib/data.ts:521:           COUNT(r.id) as review_count
026983| NOTE: Implementation detail supporting search page behavior.
026984| src/lib/data.ts:522:       FROM "Listing" l
026985| NOTE: Implementation detail supporting search page behavior.
026986| src/lib/data.ts:523:       JOIN "Location" loc ON l.id = loc."listingId"
026987| NOTE: Implementation detail supporting search page behavior.
026988| src/lib/data.ts:524:       LEFT JOIN "Review" r ON l.id = r."listingId"
026989| NOTE: Implementation detail supporting search page behavior.
026990| src/lib/data.ts:525:       WHERE l."availableSlots" > 0
026991| NOTE: Implementation detail supporting search page behavior.
026992| src/lib/data.ts:526:         AND l.status = 'ACTIVE'
026993| NOTE: Implementation detail supporting search page behavior.
026994| src/lib/data.ts:527:         AND ST_X(loc.coords::geometry) IS NOT NULL
026995| NOTE: Implementation detail supporting search page behavior.
026996| src/lib/data.ts:528:         AND ST_Y(loc.coords::geometry) IS NOT NULL
026997| NOTE: Implementation detail supporting search page behavior.
026998| src/lib/data.ts:529:         AND NOT (ST_X(loc.coords::geometry) = 0 AND ST_Y(loc.coords::geometry) = 0)
026999| NOTE: Implementation detail supporting search page behavior.
027000| src/lib/data.ts:530:         AND ST_Y(loc.coords::geometry) BETWEEN -90 AND 90
027001| NOTE: Implementation detail supporting search page behavior.
027002| src/lib/data.ts:531:         AND ST_X(loc.coords::geometry) BETWEEN -180 AND 180
027003| NOTE: Implementation detail supporting search page behavior.
027004| src/lib/data.ts:532:       GROUP BY l.id, loc.id
027005| NOTE: Implementation detail supporting search page behavior.
027006| src/lib/data.ts:533:       ORDER BY l."createdAt" DESC
027007| NOTE: Implementation detail supporting search page behavior.
027008| src/lib/data.ts:534:   `;
027009| NOTE: Implementation detail supporting search page behavior.
027010| src/lib/data.ts:535: 
027011| NOTE: Blank line for visual separation.
027012| src/lib/data.ts:536:     let results = (listings as any[]).map((l) => ({
027013| NOTE: Local declaration used by search logic or UI.
027014| src/lib/data.ts:537:       id: l.id,
027015| NOTE: Implementation detail supporting search page behavior.
027016| src/lib/data.ts:538:       title: l.title,
027017| NOTE: Implementation detail supporting search page behavior.
027018| src/lib/data.ts:539:       description: l.description,
027019| NOTE: Implementation detail supporting search page behavior.
027020| src/lib/data.ts:540:       price: Number(l.price),
027021| NOTE: Implementation detail supporting search page behavior.
027022| src/lib/data.ts:541:       images: l.images || [],
027023| NOTE: Implementation detail supporting search page behavior.
027024| src/lib/data.ts:542:       availableSlots: l.availableSlots,
027025| NOTE: Implementation detail supporting search page behavior.
027026| src/lib/data.ts:543:       totalSlots: l.totalSlots,
027027| NOTE: Implementation detail supporting search page behavior.
027028| src/lib/data.ts:544:       amenities: l.amenities || [],
027029| NOTE: Implementation detail supporting search page behavior.
027030| src/lib/data.ts:545:       houseRules: l.houseRules || [],
027031| NOTE: Implementation detail supporting search page behavior.
027032| src/lib/data.ts:546:       householdLanguages: l.household_languages || [],
027033| NOTE: Implementation detail supporting search page behavior.
027034| src/lib/data.ts:547:       primaryHomeLanguage: l.primary_home_language,
027035| NOTE: Implementation detail supporting search page behavior.
027036| src/lib/data.ts:548:       leaseDuration: l.leaseDuration,
027037| NOTE: Implementation detail supporting search page behavior.
027038| src/lib/data.ts:549:       roomType: l.roomType,
027039| NOTE: Implementation detail supporting search page behavior.
027040| src/lib/data.ts:550:       moveInDate: l.moveInDate ? new Date(l.moveInDate) : undefined,
027041| NOTE: Implementation detail supporting search page behavior.
027042| src/lib/data.ts:551:       ownerId: l.ownerId,
027043| NOTE: Implementation detail supporting search page behavior.
027044| src/lib/data.ts:552:       createdAt: l.createdAt ? new Date(l.createdAt) : new Date(),
027045| NOTE: Implementation detail supporting search page behavior.
027046| src/lib/data.ts:553:       viewCount: Number(l.viewCount) || 0,
027047| NOTE: Implementation detail supporting search page behavior.
027048| src/lib/data.ts:554:       avgRating: Number(l.avg_rating) || 0,
027049| NOTE: Implementation detail supporting search page behavior.
027050| src/lib/data.ts:555:       reviewCount: Number(l.review_count) || 0,
027051| NOTE: Implementation detail supporting search page behavior.
027052| src/lib/data.ts:556:       location: {
027053| NOTE: Implementation detail supporting search page behavior.
027054| src/lib/data.ts:557:         address: l.address,
027055| NOTE: Implementation detail supporting search page behavior.
027056| src/lib/data.ts:558:         city: l.city,
027057| NOTE: Implementation detail supporting search page behavior.
027058| src/lib/data.ts:559:         state: l.state,
027059| NOTE: Implementation detail supporting search page behavior.
027060| src/lib/data.ts:560:         zip: l.zip,
027061| NOTE: Implementation detail supporting search page behavior.
027062| src/lib/data.ts:561:         lat: Number(l.lat) || 0,
027063| NOTE: Implementation detail supporting search page behavior.
027064| src/lib/data.ts:562:         lng: Number(l.lng) || 0,
027065| NOTE: Implementation detail supporting search page behavior.
027066| src/lib/data.ts:563:       },
027067| NOTE: Implementation detail supporting search page behavior.
027068| src/lib/data.ts:564:     }));
027069| NOTE: Implementation detail supporting search page behavior.
027070| src/lib/data.ts:565: 
027071| NOTE: Blank line for visual separation.
027072| src/lib/data.ts:566:     // Apply geographic bounds filter
027073| NOTE: Line comment documents intent or constraints.
027074| src/lib/data.ts:567:     if (bounds) {
027075| NOTE: Conditional logic controlling rendering or flow.
027076| src/lib/data.ts:568:       results = results.filter(
027077| NOTE: Implementation detail supporting search page behavior.
027078| src/lib/data.ts:569:         (l) =>
027079| NOTE: Implementation detail supporting search page behavior.
027080| src/lib/data.ts:570:           l.location.lat >= bounds.minLat &&
027081| NOTE: Implementation detail supporting search page behavior.
027082| src/lib/data.ts:571:           l.location.lat <= bounds.maxLat &&
027083| NOTE: Implementation detail supporting search page behavior.
027084| src/lib/data.ts:572:           l.location.lng >= bounds.minLng &&
027085| NOTE: Implementation detail supporting search page behavior.
027086| src/lib/data.ts:573:           l.location.lng <= bounds.maxLng,
027087| NOTE: Implementation detail supporting search page behavior.
027088| src/lib/data.ts:574:       );
027089| NOTE: Implementation detail supporting search page behavior.
027090| src/lib/data.ts:575:     }
027091| NOTE: Implementation detail supporting search page behavior.
027092| src/lib/data.ts:576: 
027093| NOTE: Blank line for visual separation.
027094| src/lib/data.ts:577:     // Apply text search filter (with sanitization for special characters)
027095| NOTE: Line comment documents intent or constraints.
027096| src/lib/data.ts:578:     // Only apply if query meets minimum length requirement (2+ chars)
027097| NOTE: Line comment documents intent or constraints.
027098| src/lib/data.ts:579:     if (query && isValidQuery(query)) {
027099| NOTE: Conditional logic controlling rendering or flow.
027100| src/lib/data.ts:580:       const q = sanitizeSearchQuery(query).toLowerCase();
027101| NOTE: Local declaration used by search logic or UI.
027102| src/lib/data.ts:581:       if (q) {
027103| NOTE: Conditional logic controlling rendering or flow.
027104| src/lib/data.ts:582:         results = results.filter(
027105| NOTE: Implementation detail supporting search page behavior.
027106| src/lib/data.ts:583:           (l) =>
027107| NOTE: Implementation detail supporting search page behavior.
027108| src/lib/data.ts:584:             l.title.toLowerCase().includes(q) ||
027109| NOTE: Implementation detail supporting search page behavior.
027110| src/lib/data.ts:585:             l.description.toLowerCase().includes(q) ||
027111| NOTE: Implementation detail supporting search page behavior.
027112| src/lib/data.ts:586:             l.location.city.toLowerCase().includes(q) ||
027113| NOTE: Implementation detail supporting search page behavior.
027114| src/lib/data.ts:587:             l.location.state.toLowerCase().includes(q),
027115| NOTE: Implementation detail supporting search page behavior.
027116| src/lib/data.ts:588:         );
027117| NOTE: Implementation detail supporting search page behavior.
027118| src/lib/data.ts:589:       }
027119| NOTE: Implementation detail supporting search page behavior.
027120| src/lib/data.ts:590:     }
027121| NOTE: Implementation detail supporting search page behavior.
027122| src/lib/data.ts:591: 
027123| NOTE: Blank line for visual separation.
027124| src/lib/data.ts:592:     // Apply price filters
027125| NOTE: Line comment documents intent or constraints.
027126| src/lib/data.ts:593:     if (minPrice !== undefined && minPrice !== null) {
027127| NOTE: Conditional logic controlling rendering or flow.
027128| src/lib/data.ts:594:       results = results.filter((l) => l.price >= minPrice);
027129| NOTE: Implementation detail supporting search page behavior.
027130| src/lib/data.ts:595:     }
027131| NOTE: Implementation detail supporting search page behavior.
027132| src/lib/data.ts:596: 
027133| NOTE: Blank line for visual separation.
027134| src/lib/data.ts:597:     if (maxPrice !== undefined && maxPrice !== null) {
027135| NOTE: Conditional logic controlling rendering or flow.
027136| src/lib/data.ts:598:       results = results.filter((l) => l.price <= maxPrice);
027137| NOTE: Implementation detail supporting search page behavior.
027138| src/lib/data.ts:599:     }
027139| NOTE: Implementation detail supporting search page behavior.
027140| src/lib/data.ts:600: 
027141| NOTE: Blank line for visual separation.
027142| src/lib/data.ts:601:     // Apply amenities filter (must have ALL selected amenities, case-insensitive partial match)
027143| NOTE: Line comment documents intent or constraints.
027144| src/lib/data.ts:602:     // UI sends short names like 'Pool', 'Gym' but DB has 'Pool Access', 'Gym Access'
027145| NOTE: Line comment documents intent or constraints.
027146| src/lib/data.ts:603:     if (amenities && amenities.length > 0) {
027147| NOTE: Conditional logic controlling rendering or flow.
027148| src/lib/data.ts:604:       const amenitiesLower = amenities.map((a) => a.toLowerCase());
027149| NOTE: Local declaration used by search logic or UI.
027150| src/lib/data.ts:605:       results = results.filter((l) =>
027151| NOTE: Implementation detail supporting search page behavior.
027152| src/lib/data.ts:606:         amenitiesLower.every((a) =>
027153| NOTE: Implementation detail supporting search page behavior.
027154| src/lib/data.ts:607:           l.amenities.some((la: string) => la.toLowerCase().includes(a)),
027155| NOTE: Implementation detail supporting search page behavior.
027156| src/lib/data.ts:608:         ),
027157| NOTE: Implementation detail supporting search page behavior.
027158| src/lib/data.ts:609:       );
027159| NOTE: Implementation detail supporting search page behavior.
027160| src/lib/data.ts:610:     }
027161| NOTE: Implementation detail supporting search page behavior.
027162| src/lib/data.ts:611: 
027163| NOTE: Blank line for visual separation.
027164| src/lib/data.ts:612:     // Apply move-in date filter (listing available by target date)
027165| NOTE: Line comment documents intent or constraints.
027166| src/lib/data.ts:613:     if (moveInDate) {
027167| NOTE: Conditional logic controlling rendering or flow.
027168| src/lib/data.ts:614:       const targetDate = new Date(moveInDate);
027169| NOTE: Local declaration used by search logic or UI.
027170| src/lib/data.ts:615:       results = results.filter(
027171| NOTE: Implementation detail supporting search page behavior.
027172| src/lib/data.ts:616:         (l) => !l.moveInDate || new Date(l.moveInDate) <= targetDate,
027173| NOTE: Implementation detail supporting search page behavior.
027174| src/lib/data.ts:617:       );
027175| NOTE: Implementation detail supporting search page behavior.
027176| src/lib/data.ts:618:     }
027177| NOTE: Implementation detail supporting search page behavior.
027178| src/lib/data.ts:619: 
027179| NOTE: Blank line for visual separation.
027180| src/lib/data.ts:620:     // Apply lease duration filter (case-insensitive)
027181| NOTE: Line comment documents intent or constraints.
027182| src/lib/data.ts:621:     if (leaseDuration) {
027183| NOTE: Conditional logic controlling rendering or flow.
027184| src/lib/data.ts:622:       const leaseLower = leaseDuration.toLowerCase();
027185| NOTE: Local declaration used by search logic or UI.
027186| src/lib/data.ts:623:       results = results.filter(
027187| NOTE: Implementation detail supporting search page behavior.
027188| src/lib/data.ts:624:         (l) => l.leaseDuration && l.leaseDuration.toLowerCase() === leaseLower,
027189| NOTE: Implementation detail supporting search page behavior.
027190| src/lib/data.ts:625:       );
027191| NOTE: Implementation detail supporting search page behavior.
027192| src/lib/data.ts:626:     }
027193| NOTE: Implementation detail supporting search page behavior.
027194| src/lib/data.ts:627: 
027195| NOTE: Blank line for visual separation.
027196| src/lib/data.ts:628:     // Apply house rules filter (must have ALL selected rules, case-insensitive)
027197| NOTE: Line comment documents intent or constraints.
027198| src/lib/data.ts:629:     if (houseRules && houseRules.length > 0) {
027199| NOTE: Conditional logic controlling rendering or flow.
027200| src/lib/data.ts:630:       const rulesLower = houseRules.map((r) => r.toLowerCase());
027201| NOTE: Local declaration used by search logic or UI.
027202| src/lib/data.ts:631:       results = results.filter((l) =>
027203| NOTE: Implementation detail supporting search page behavior.
027204| src/lib/data.ts:632:         rulesLower.every((r) =>
027205| NOTE: Implementation detail supporting search page behavior.
027206| src/lib/data.ts:633:           l.houseRules.some((hr: string) => hr.toLowerCase() === r),
027207| NOTE: Implementation detail supporting search page behavior.
027208| src/lib/data.ts:634:         ),
027209| NOTE: Implementation detail supporting search page behavior.
027210| src/lib/data.ts:635:       );
027211| NOTE: Implementation detail supporting search page behavior.
027212| src/lib/data.ts:636:     }
027213| NOTE: Implementation detail supporting search page behavior.
027214| src/lib/data.ts:637: 
027215| NOTE: Blank line for visual separation.
027216| src/lib/data.ts:638:     // Apply room type filter (case-insensitive)
027217| NOTE: Line comment documents intent or constraints.
027218| src/lib/data.ts:639:     if (roomType) {
027219| NOTE: Conditional logic controlling rendering or flow.
027220| src/lib/data.ts:640:       const roomTypeLower = roomType.toLowerCase();
027221| NOTE: Local declaration used by search logic or UI.
027222| src/lib/data.ts:641:       results = results.filter(
027223| NOTE: Implementation detail supporting search page behavior.
027224| src/lib/data.ts:642:         (l) => l.roomType && l.roomType.toLowerCase() === roomTypeLower,
027225| NOTE: Implementation detail supporting search page behavior.
027226| src/lib/data.ts:643:       );
027227| NOTE: Implementation detail supporting search page behavior.
027228| src/lib/data.ts:644:     }
027229| NOTE: Implementation detail supporting search page behavior.
027230| src/lib/data.ts:645: 
027231| NOTE: Blank line for visual separation.
027232| src/lib/data.ts:646:     // Apply languages filter (OR logic - show listings where household speaks ANY selected language)
027233| NOTE: Line comment documents intent or constraints.
027234| src/lib/data.ts:647:     if (languages && languages.length > 0) {
027235| NOTE: Conditional logic controlling rendering or flow.
027236| src/lib/data.ts:648:       const languagesLower = languages.map((l) => l.toLowerCase());
027237| NOTE: Local declaration used by search logic or UI.
027238| src/lib/data.ts:649:       results = results.filter((listing) =>
027239| NOTE: Implementation detail supporting search page behavior.
027240| src/lib/data.ts:650:         languagesLower.some((lang) =>
027241| NOTE: Implementation detail supporting search page behavior.
027242| src/lib/data.ts:651:           listing.householdLanguages.some(
027243| NOTE: Implementation detail supporting search page behavior.
027244| src/lib/data.ts:652:             (ll: string) => ll.toLowerCase() === lang,
027245| NOTE: Implementation detail supporting search page behavior.
027246| src/lib/data.ts:653:           ),
027247| NOTE: Implementation detail supporting search page behavior.
027248| src/lib/data.ts:654:         ),
027249| NOTE: Implementation detail supporting search page behavior.
027250| src/lib/data.ts:655:       );
027251| NOTE: Implementation detail supporting search page behavior.
027252| src/lib/data.ts:656:     }
027253| NOTE: Implementation detail supporting search page behavior.
027254| src/lib/data.ts:657: 
027255| NOTE: Blank line for visual separation.
027256| src/lib/data.ts:658:     // Apply sorting with stable secondary sort by createdAt
027257| NOTE: Line comment documents intent or constraints.
027258| src/lib/data.ts:659:     // This ensures deterministic ordering when primary sort values are equal
027259| NOTE: Line comment documents intent or constraints.
027260| src/lib/data.ts:660:     switch (sort) {
027261| NOTE: Implementation detail supporting search page behavior.
027262| src/lib/data.ts:661:       case "price_asc":
027263| NOTE: Implementation detail supporting search page behavior.
027264| src/lib/data.ts:662:         results.sort((a, b) => {
027265| NOTE: Implementation detail supporting search page behavior.
027266| src/lib/data.ts:663:           const priceDiff = a.price - b.price;
027267| NOTE: Local declaration used by search logic or UI.
027268| src/lib/data.ts:664:           if (priceDiff !== 0) return priceDiff;
027269| NOTE: Conditional logic controlling rendering or flow.
027270| src/lib/data.ts:665:           return b.createdAt.getTime() - a.createdAt.getTime(); // newer first as tiebreaker
027271| NOTE: Return statement for component or helper output.
027272| src/lib/data.ts:666:         });
027273| NOTE: Implementation detail supporting search page behavior.
027274| src/lib/data.ts:667:         break;
027275| NOTE: Implementation detail supporting search page behavior.
027276| src/lib/data.ts:668:       case "price_desc":
027277| NOTE: Implementation detail supporting search page behavior.
027278| src/lib/data.ts:669:         results.sort((a, b) => {
027279| NOTE: Implementation detail supporting search page behavior.
027280| src/lib/data.ts:670:           const priceDiff = b.price - a.price;
027281| NOTE: Local declaration used by search logic or UI.
027282| src/lib/data.ts:671:           if (priceDiff !== 0) return priceDiff;
027283| NOTE: Conditional logic controlling rendering or flow.
027284| src/lib/data.ts:672:           return b.createdAt.getTime() - a.createdAt.getTime();
027285| NOTE: Return statement for component or helper output.
027286| src/lib/data.ts:673:         });
027287| NOTE: Implementation detail supporting search page behavior.
027288| src/lib/data.ts:674:         break;
027289| NOTE: Implementation detail supporting search page behavior.
027290| src/lib/data.ts:675:       case "newest":
027291| NOTE: Implementation detail supporting search page behavior.
027292| src/lib/data.ts:676:         // Already sorted by createdAt, add id as ultimate tiebreaker
027293| NOTE: Line comment documents intent or constraints.
027294| src/lib/data.ts:677:         results.sort((a, b) => {
027295| NOTE: Implementation detail supporting search page behavior.
027296| src/lib/data.ts:678:           const timeDiff = b.createdAt.getTime() - a.createdAt.getTime();
027297| NOTE: Local declaration used by search logic or UI.
027298| src/lib/data.ts:679:           if (timeDiff !== 0) return timeDiff;
027299| NOTE: Conditional logic controlling rendering or flow.
027300| src/lib/data.ts:680:           return a.id.localeCompare(b.id);
027301| NOTE: Return statement for component or helper output.
027302| src/lib/data.ts:681:         });
027303| NOTE: Implementation detail supporting search page behavior.
027304| src/lib/data.ts:682:         break;
027305| NOTE: Implementation detail supporting search page behavior.
027306| src/lib/data.ts:683:       case "rating":
027307| NOTE: Implementation detail supporting search page behavior.
027308| src/lib/data.ts:684:         results.sort((a, b) => {
027309| NOTE: Implementation detail supporting search page behavior.
027310| src/lib/data.ts:685:           const ratingDiff = b.avgRating - a.avgRating;
027311| NOTE: Local declaration used by search logic or UI.
027312| src/lib/data.ts:686:           if (ratingDiff !== 0) return ratingDiff;
027313| NOTE: Conditional logic controlling rendering or flow.
027314| src/lib/data.ts:687:           const reviewDiff = b.reviewCount - a.reviewCount;
027315| NOTE: Local declaration used by search logic or UI.
027316| src/lib/data.ts:688:           if (reviewDiff !== 0) return reviewDiff;
027317| NOTE: Conditional logic controlling rendering or flow.
027318| src/lib/data.ts:689:           return b.createdAt.getTime() - a.createdAt.getTime();
027319| NOTE: Return statement for component or helper output.
027320| src/lib/data.ts:690:         });
027321| NOTE: Implementation detail supporting search page behavior.
027322| src/lib/data.ts:691:         break;
027323| NOTE: Implementation detail supporting search page behavior.
027324| src/lib/data.ts:692:       case "recommended":
027325| NOTE: Implementation detail supporting search page behavior.
027326| src/lib/data.ts:693:       default:
027327| NOTE: Implementation detail supporting search page behavior.
027328| src/lib/data.ts:694:         // Recommended: combination of recency, rating, and views
027329| NOTE: Line comment documents intent or constraints.
027330| src/lib/data.ts:695:         results.sort((a, b) => {
027331| NOTE: Implementation detail supporting search page behavior.
027332| src/lib/data.ts:696:           const aScore =
027333| NOTE: Local declaration used by search logic or UI.
027334| src/lib/data.ts:697:             a.avgRating * 20 + a.viewCount * 0.1 + a.reviewCount * 5;
027335| NOTE: Implementation detail supporting search page behavior.
027336| src/lib/data.ts:698:           const bScore =
027337| NOTE: Local declaration used by search logic or UI.
027338| src/lib/data.ts:699:             b.avgRating * 20 + b.viewCount * 0.1 + b.reviewCount * 5;
027339| NOTE: Implementation detail supporting search page behavior.
027340| src/lib/data.ts:700:           const scoreDiff = bScore - aScore;
027341| NOTE: Local declaration used by search logic or UI.
027342| src/lib/data.ts:701:           if (scoreDiff !== 0) return scoreDiff;
027343| NOTE: Conditional logic controlling rendering or flow.
027344| src/lib/data.ts:702:           return b.createdAt.getTime() - a.createdAt.getTime();
027345| NOTE: Return statement for component or helper output.
027346| src/lib/data.ts:703:         });
027347| NOTE: Implementation detail supporting search page behavior.
027348| src/lib/data.ts:704:         break;
027349| NOTE: Implementation detail supporting search page behavior.
027350| src/lib/data.ts:705:     }
027351| NOTE: Implementation detail supporting search page behavior.
027352| src/lib/data.ts:706: 
027353| NOTE: Blank line for visual separation.
027354| src/lib/data.ts:707:     // Apply maximum results cap for performance (prevents memory issues on wide map bounds)
027355| NOTE: Line comment documents intent or constraints.
027356| src/lib/data.ts:708:     if (results.length > MAX_RESULTS_CAP) {
027357| NOTE: Conditional logic controlling rendering or flow.
027358| src/lib/data.ts:709:       results = results.slice(0, MAX_RESULTS_CAP);
027359| NOTE: Implementation detail supporting search page behavior.
027360| src/lib/data.ts:710:     }
027361| NOTE: Implementation detail supporting search page behavior.
027362| src/lib/data.ts:711: 
027363| NOTE: Blank line for visual separation.
027364| src/lib/data.ts:712:     return results;
027365| NOTE: Return statement for component or helper output.
027366| src/lib/data.ts:713:   } catch (error) {
027367| NOTE: Implementation detail supporting search page behavior.
027368| src/lib/data.ts:714:     const dataError = wrapDatabaseError(error, "getListings");
027369| NOTE: Local declaration used by search logic or UI.
027370| src/lib/data.ts:715:     dataError.log({
027371| NOTE: Implementation detail supporting search page behavior.
027372| src/lib/data.ts:716:       operation: "getListings",
027373| NOTE: Implementation detail supporting search page behavior.
027374| src/lib/data.ts:717:       hasQuery: !!params.query,
027375| NOTE: Implementation detail supporting search page behavior.
027376| src/lib/data.ts:718:       hasBounds: !!params.bounds,
027377| NOTE: Implementation detail supporting search page behavior.
027378| src/lib/data.ts:719:       sortOption: params.sort,
027379| NOTE: Implementation detail supporting search page behavior.
027380| src/lib/data.ts:720:     });
027381| NOTE: Implementation detail supporting search page behavior.
027382| src/lib/data.ts:721:     throw dataError;
027383| NOTE: Implementation detail supporting search page behavior.
027384| src/lib/data.ts:722:   }
027385| NOTE: Implementation detail supporting search page behavior.
027386| src/lib/data.ts:723: }
027387| NOTE: Implementation detail supporting search page behavior.
027388| src/lib/data.ts:724: 
027389| NOTE: Blank line for visual separation.
027390| src/lib/data.ts:725: // Map-optimized listing interface (minimal fields for markers)
027391| NOTE: Line comment documents intent or constraints.
027392| src/lib/data.ts:726: export interface MapListingData {
027393| NOTE: Implementation detail supporting search page behavior.
027394| src/lib/data.ts:727:   id: string;
027395| NOTE: Implementation detail supporting search page behavior.
027396| src/lib/data.ts:728:   title: string;
027397| NOTE: Implementation detail supporting search page behavior.
027398| src/lib/data.ts:729:   price: number;
027399| NOTE: Implementation detail supporting search page behavior.
027400| src/lib/data.ts:730:   availableSlots: number;
027401| NOTE: Implementation detail supporting search page behavior.
027402| src/lib/data.ts:731:   ownerId: string;
027403| NOTE: Implementation detail supporting search page behavior.
027404| src/lib/data.ts:732:   images: string[];
027405| NOTE: Implementation detail supporting search page behavior.
027406| src/lib/data.ts:733:   location: {
027407| NOTE: Implementation detail supporting search page behavior.
027408| src/lib/data.ts:734:     lat: number;
027409| NOTE: Implementation detail supporting search page behavior.
027410| src/lib/data.ts:735:     lng: number;
027411| NOTE: Implementation detail supporting search page behavior.
027412| src/lib/data.ts:736:   };
027413| NOTE: Implementation detail supporting search page behavior.
027414| src/lib/data.ts:737: }
027415| NOTE: Implementation detail supporting search page behavior.
027416| src/lib/data.ts:738: 
027417| NOTE: Blank line for visual separation.
027418| src/lib/data.ts:739: // Maximum map markers to return (prevents UI performance issues)
027419| NOTE: Line comment documents intent or constraints.
027420| src/lib/data.ts:740: const MAX_MAP_MARKERS = 200;
027421| NOTE: Local declaration used by search logic or UI.
027422| src/lib/data.ts:741: 
027423| NOTE: Blank line for visual separation.
027424| src/lib/data.ts:742: /**
027425| NOTE: Block comment line describing behavior or context.
027426| src/lib/data.ts:743:  * Cached wrapper for map listings with 60s TTL
027427| NOTE: Block comment line describing behavior or context.
027428| src/lib/data.ts:744:  * Uses unstable_cache to reduce DB load for repeated queries
027429| NOTE: Block comment line describing behavior or context.
027430| src/lib/data.ts:745:  */
027431| NOTE: Block comment line describing behavior or context.
027432| src/lib/data.ts:746: export async function getMapListings(
027433| NOTE: Implementation detail supporting search page behavior.
027434| src/lib/data.ts:747:   params: FilterParams = {},
027435| NOTE: Implementation detail supporting search page behavior.
027436| src/lib/data.ts:748: ): Promise<MapListingData[]> {
027437| NOTE: Implementation detail supporting search page behavior.
027438| src/lib/data.ts:749:   const cacheKey = createMapListingsCacheKey(params);
027439| NOTE: Local declaration used by search logic or UI.
027440| src/lib/data.ts:750: 
027441| NOTE: Blank line for visual separation.
027442| src/lib/data.ts:751:   const cachedFn = unstable_cache(
027443| NOTE: Local declaration used by search logic or UI.
027444| src/lib/data.ts:752:     async () => getMapListingsInternal(params),
027445| NOTE: Implementation detail supporting search page behavior.
027446| src/lib/data.ts:753:     ["map-listings", cacheKey],
027447| NOTE: Implementation detail supporting search page behavior.
027448| src/lib/data.ts:754:     { revalidate: 60 },
027449| NOTE: Implementation detail supporting search page behavior.
027450| src/lib/data.ts:755:   );
027451| NOTE: Implementation detail supporting search page behavior.
027452| src/lib/data.ts:756: 
027453| NOTE: Blank line for visual separation.
027454| src/lib/data.ts:757:   return cachedFn();
027455| NOTE: Return statement for component or helper output.
027456| src/lib/data.ts:758: }
027457| NOTE: Implementation detail supporting search page behavior.
027458| src/lib/data.ts:759: 
027459| NOTE: Blank line for visual separation.
027460| src/lib/data.ts:760: /**
027461| NOTE: Block comment line describing behavior or context.
027462| src/lib/data.ts:761:  * Optimized query for map markers - uses SQL-level bounds filtering
027463| NOTE: Block comment line describing behavior or context.
027464| src/lib/data.ts:762:  * and returns only the fields needed for map display.
027465| NOTE: Block comment line describing behavior or context.
027466| src/lib/data.ts:763:  *
027467| NOTE: Block comment line describing behavior or context.
027468| src/lib/data.ts:764:  * Performance improvements over getListings():
027469| NOTE: Block comment line describing behavior or context.
027470| src/lib/data.ts:765:  * - SQL-level bounds filtering with PostGIS ST_Intersects (uses spatial index)
027471| NOTE: Block comment line describing behavior or context.
027472| src/lib/data.ts:766:  * - Returns only 8 fields vs 20+ fields
027473| NOTE: Block comment line describing behavior or context.
027474| src/lib/data.ts:767:  * - LIMIT 200 at SQL level (not post-fetch)
027475| NOTE: Block comment line describing behavior or context.
027476| src/lib/data.ts:768:  * - ~70% smaller payload per listing
027477| NOTE: Block comment line describing behavior or context.
027478| src/lib/data.ts:769:  */
027479| NOTE: Block comment line describing behavior or context.
027480| src/lib/data.ts:770: async function getMapListingsInternal(
027481| NOTE: Implementation detail supporting search page behavior.
027482| src/lib/data.ts:771:   params: FilterParams = {},
027483| NOTE: Implementation detail supporting search page behavior.
027484| src/lib/data.ts:772: ): Promise<MapListingData[]> {
027485| NOTE: Implementation detail supporting search page behavior.
027486| src/lib/data.ts:773:   const {
027487| NOTE: Local declaration used by search logic or UI.
027488| src/lib/data.ts:774:     query,
027489| NOTE: Implementation detail supporting search page behavior.
027490| src/lib/data.ts:775:     minPrice,
027491| NOTE: Implementation detail supporting search page behavior.
027492| src/lib/data.ts:776:     maxPrice,
027493| NOTE: Implementation detail supporting search page behavior.
027494| src/lib/data.ts:777:     bounds,
027495| NOTE: Implementation detail supporting search page behavior.
027496| src/lib/data.ts:778:     languages,
027497| NOTE: Implementation detail supporting search page behavior.
027498| src/lib/data.ts:779:     amenities,
027499| NOTE: Implementation detail supporting search page behavior.
027500| src/lib/data.ts:780:     houseRules,
027501| NOTE: Implementation detail supporting search page behavior.
027502| src/lib/data.ts:781:     moveInDate,
027503| NOTE: Implementation detail supporting search page behavior.
027504| src/lib/data.ts:782:     leaseDuration,
027505| NOTE: Implementation detail supporting search page behavior.
027506| src/lib/data.ts:783:     roomType,
027507| NOTE: Implementation detail supporting search page behavior.
027508| src/lib/data.ts:784:   } = params;
027509| NOTE: Implementation detail supporting search page behavior.
027510| src/lib/data.ts:785: 
027511| NOTE: Blank line for visual separation.
027512| src/lib/data.ts:786:   // Build WHERE conditions dynamically
027513| NOTE: Line comment documents intent or constraints.
027514| src/lib/data.ts:787:   const conditions: string[] = [
027515| NOTE: Local declaration used by search logic or UI.
027516| src/lib/data.ts:788:     'l."availableSlots" > 0',
027517| NOTE: Implementation detail supporting search page behavior.
027518| src/lib/data.ts:789:     "l.status = 'ACTIVE'",
027519| NOTE: Implementation detail supporting search page behavior.
027520| src/lib/data.ts:790:     "ST_X(loc.coords::geometry) IS NOT NULL",
027521| NOTE: Implementation detail supporting search page behavior.
027522| src/lib/data.ts:791:     "ST_Y(loc.coords::geometry) IS NOT NULL",
027523| NOTE: Implementation detail supporting search page behavior.
027524| src/lib/data.ts:792:     "NOT (ST_X(loc.coords::geometry) = 0 AND ST_Y(loc.coords::geometry) = 0)",
027525| NOTE: Implementation detail supporting search page behavior.
027526| src/lib/data.ts:793:     "ST_Y(loc.coords::geometry) BETWEEN -90 AND 90",
027527| NOTE: Implementation detail supporting search page behavior.
027528| src/lib/data.ts:794:     "ST_X(loc.coords::geometry) BETWEEN -180 AND 180",
027529| NOTE: Implementation detail supporting search page behavior.
027530| src/lib/data.ts:795:   ];
027531| NOTE: Implementation detail supporting search page behavior.
027532| src/lib/data.ts:796:   const queryParams: any[] = [];
027533| NOTE: Local declaration used by search logic or UI.
027534| src/lib/data.ts:797:   let paramIndex = 1;
027535| NOTE: Local declaration used by search logic or UI.
027536| src/lib/data.ts:798: 
027537| NOTE: Blank line for visual separation.
027538| src/lib/data.ts:799:   // SQL-level bounds filtering using PostGIS spatial index with antimeridian support
027539| NOTE: Line comment documents intent or constraints.
027540| src/lib/data.ts:800:   // Uses && (bbox overlap) operator for guaranteed GiST index usage + ST_Intersects for precise filtering
027541| NOTE: Line comment documents intent or constraints.
027542| src/lib/data.ts:801:   if (bounds) {
027543| NOTE: Conditional logic controlling rendering or flow.
027544| src/lib/data.ts:802:     if (crossesAntimeridian(bounds.minLng, bounds.maxLng)) {
027545| NOTE: Conditional logic controlling rendering or flow.
027546| src/lib/data.ts:803:       // Split into two envelopes for antimeridian crossing
027547| NOTE: Line comment documents intent or constraints.
027548| src/lib/data.ts:804:       // Envelope 1: minLng to 180 (eastern side)
027549| NOTE: Line comment documents intent or constraints.
027550| src/lib/data.ts:805:       // Envelope 2: -180 to maxLng (western side)
027551| NOTE: Line comment documents intent or constraints.
027552| src/lib/data.ts:806:       conditions.push(`(
027553| NOTE: Implementation detail supporting search page behavior.
027554| src/lib/data.ts:807:                 (loc.coords && ST_MakeEnvelope($${paramIndex}, $${paramIndex + 1}, 180, $${paramIndex + 2}, 4326)
027555| NOTE: Implementation detail supporting search page behavior.
027556| src/lib/data.ts:808:                  AND ST_Intersects(loc.coords, ST_MakeEnvelope($${paramIndex++}, $${paramIndex++}, 180, $${paramIndex++}, 4326)))
027557| NOTE: Implementation detail supporting search page behavior.
027558| src/lib/data.ts:809:                 OR
027559| NOTE: Implementation detail supporting search page behavior.
027560| src/lib/data.ts:810:                 (loc.coords && ST_MakeEnvelope(-180, $${paramIndex}, $${paramIndex + 1}, $${paramIndex + 2}, 4326)
027561| NOTE: Implementation detail supporting search page behavior.
027562| src/lib/data.ts:811:                  AND ST_Intersects(loc.coords, ST_MakeEnvelope(-180, $${paramIndex++}, $${paramIndex++}, $${paramIndex++}, 4326)))
027563| NOTE: Implementation detail supporting search page behavior.
027564| src/lib/data.ts:812:             )`);
027565| NOTE: Implementation detail supporting search page behavior.
027566| src/lib/data.ts:813:       queryParams.push(bounds.minLng, bounds.minLat, bounds.maxLat); // Eastern envelope
027567| NOTE: Implementation detail supporting search page behavior.
027568| src/lib/data.ts:814:       queryParams.push(bounds.minLat, bounds.maxLng, bounds.maxLat); // Western envelope
027569| NOTE: Implementation detail supporting search page behavior.
027570| src/lib/data.ts:815:     } else {
027571| NOTE: Implementation detail supporting search page behavior.
027572| src/lib/data.ts:816:       // Normal envelope: bbox filter + precise intersection
027573| NOTE: Line comment documents intent or constraints.
027574| src/lib/data.ts:817:       conditions.push(`(
027575| NOTE: Implementation detail supporting search page behavior.
027576| src/lib/data.ts:818:                 loc.coords && ST_MakeEnvelope($${paramIndex}, $${paramIndex + 1}, $${paramIndex + 2}, $${paramIndex + 3}, 4326)
027577| NOTE: Implementation detail supporting search page behavior.
027578| src/lib/data.ts:819:                 AND ST_Intersects(loc.coords, ST_MakeEnvelope($${paramIndex++}, $${paramIndex++}, $${paramIndex++}, $${paramIndex++}, 4326))
027579| NOTE: Implementation detail supporting search page behavior.
027580| src/lib/data.ts:820:             )`);
027581| NOTE: Implementation detail supporting search page behavior.
027582| src/lib/data.ts:821:       queryParams.push(
027583| NOTE: Implementation detail supporting search page behavior.
027584| src/lib/data.ts:822:         bounds.minLng,
027585| NOTE: Implementation detail supporting search page behavior.
027586| src/lib/data.ts:823:         bounds.minLat,
027587| NOTE: Implementation detail supporting search page behavior.
027588| src/lib/data.ts:824:         bounds.maxLng,
027589| NOTE: Implementation detail supporting search page behavior.
027590| src/lib/data.ts:825:         bounds.maxLat,
027591| NOTE: Implementation detail supporting search page behavior.
027592| src/lib/data.ts:826:       );
027593| NOTE: Implementation detail supporting search page behavior.
027594| src/lib/data.ts:827:     }
027595| NOTE: Implementation detail supporting search page behavior.
027596| src/lib/data.ts:828:   }
027597| NOTE: Implementation detail supporting search page behavior.
027598| src/lib/data.ts:829: 
027599| NOTE: Blank line for visual separation.
027600| src/lib/data.ts:830:   // SQL-level price filtering
027601| NOTE: Line comment documents intent or constraints.
027602| src/lib/data.ts:831:   if (minPrice !== undefined && minPrice !== null) {
027603| NOTE: Conditional logic controlling rendering or flow.
027604| src/lib/data.ts:832:     conditions.push(`l.price >= $${paramIndex++}`);
027605| NOTE: Implementation detail supporting search page behavior.
027606| src/lib/data.ts:833:     queryParams.push(minPrice);
027607| NOTE: Implementation detail supporting search page behavior.
027608| src/lib/data.ts:834:   }
027609| NOTE: Implementation detail supporting search page behavior.
027610| src/lib/data.ts:835:   if (maxPrice !== undefined && maxPrice !== null) {
027611| NOTE: Conditional logic controlling rendering or flow.
027612| src/lib/data.ts:836:     conditions.push(`l.price <= $${paramIndex++}`);
027613| NOTE: Implementation detail supporting search page behavior.
027614| src/lib/data.ts:837:     queryParams.push(maxPrice);
027615| NOTE: Implementation detail supporting search page behavior.
027616| src/lib/data.ts:838:   }
027617| NOTE: Implementation detail supporting search page behavior.
027618| src/lib/data.ts:839: 
027619| NOTE: Blank line for visual separation.
027620| src/lib/data.ts:840:   // Text search filter (SQL level, case-insensitive, with sanitization)
027621| NOTE: Line comment documents intent or constraints.
027622| src/lib/data.ts:841:   if (query && isValidQuery(query)) {
027623| NOTE: Conditional logic controlling rendering or flow.
027624| src/lib/data.ts:842:     const sanitizedQuery = sanitizeSearchQuery(query);
027625| NOTE: Local declaration used by search logic or UI.
027626| src/lib/data.ts:843:     if (sanitizedQuery) {
027627| NOTE: Conditional logic controlling rendering or flow.
027628| src/lib/data.ts:844:       const searchPattern = `%${sanitizedQuery}%`;
027629| NOTE: Local declaration used by search logic or UI.
027630| src/lib/data.ts:845:       conditions.push(`(
027631| NOTE: Implementation detail supporting search page behavior.
027632| src/lib/data.ts:846:                 LOWER(l.title) LIKE LOWER($${paramIndex}) OR
027633| NOTE: Implementation detail supporting search page behavior.
027634| src/lib/data.ts:847:                 LOWER(l.description) LIKE LOWER($${paramIndex}) OR
027635| NOTE: Implementation detail supporting search page behavior.
027636| src/lib/data.ts:848:                 LOWER(loc.city) LIKE LOWER($${paramIndex}) OR
027637| NOTE: Implementation detail supporting search page behavior.
027638| src/lib/data.ts:849:                 LOWER(loc.state) LIKE LOWER($${paramIndex})
027639| NOTE: Implementation detail supporting search page behavior.
027640| src/lib/data.ts:850:             )`);
027641| NOTE: Implementation detail supporting search page behavior.
027642| src/lib/data.ts:851:       queryParams.push(searchPattern);
027643| NOTE: Implementation detail supporting search page behavior.
027644| src/lib/data.ts:852:       paramIndex++;
027645| NOTE: Implementation detail supporting search page behavior.
027646| src/lib/data.ts:853:     }
027647| NOTE: Implementation detail supporting search page behavior.
027648| src/lib/data.ts:854:   }
027649| NOTE: Implementation detail supporting search page behavior.
027650| src/lib/data.ts:855: 
027651| NOTE: Blank line for visual separation.
027652| src/lib/data.ts:856:   // Room type filter (SQL level, case-insensitive)
027653| NOTE: Line comment documents intent or constraints.
027654| src/lib/data.ts:857:   if (roomType) {
027655| NOTE: Conditional logic controlling rendering or flow.
027656| src/lib/data.ts:858:     conditions.push(`LOWER(l."roomType") = LOWER($${paramIndex++})`);
027657| NOTE: Implementation detail supporting search page behavior.
027658| src/lib/data.ts:859:     queryParams.push(roomType);
027659| NOTE: Implementation detail supporting search page behavior.
027660| src/lib/data.ts:860:   }
027661| NOTE: Implementation detail supporting search page behavior.
027662| src/lib/data.ts:861: 
027663| NOTE: Blank line for visual separation.
027664| src/lib/data.ts:862:   // Lease duration filter (SQL level, case-insensitive)
027665| NOTE: Line comment documents intent or constraints.
027666| src/lib/data.ts:863:   if (leaseDuration) {
027667| NOTE: Conditional logic controlling rendering or flow.
027668| src/lib/data.ts:864:     conditions.push(`LOWER(l."leaseDuration") = LOWER($${paramIndex++})`);
027669| NOTE: Implementation detail supporting search page behavior.
027670| src/lib/data.ts:865:     queryParams.push(leaseDuration);
027671| NOTE: Implementation detail supporting search page behavior.
027672| src/lib/data.ts:866:   }
027673| NOTE: Implementation detail supporting search page behavior.
027674| src/lib/data.ts:867: 
027675| NOTE: Blank line for visual separation.
027676| src/lib/data.ts:868:   // Move-in date filter (SQL level)
027677| NOTE: Line comment documents intent or constraints.
027678| src/lib/data.ts:869:   if (moveInDate) {
027679| NOTE: Conditional logic controlling rendering or flow.
027680| src/lib/data.ts:870:     conditions.push(
027681| NOTE: Implementation detail supporting search page behavior.
027682| src/lib/data.ts:871:       `(l."moveInDate" IS NULL OR l."moveInDate" <= $${paramIndex++})`,
027683| NOTE: Implementation detail supporting search page behavior.
027684| src/lib/data.ts:872:     );
027685| NOTE: Implementation detail supporting search page behavior.
027686| src/lib/data.ts:873:     queryParams.push(parseDateOnly(moveInDate));
027687| NOTE: Implementation detail supporting search page behavior.
027688| src/lib/data.ts:874:   }
027689| NOTE: Implementation detail supporting search page behavior.
027690| src/lib/data.ts:875: 
027691| NOTE: Blank line for visual separation.
027692| src/lib/data.ts:876:   // Languages filter (SQL level with GIN index) - OR logic
027693| NOTE: Line comment documents intent or constraints.
027694| src/lib/data.ts:877:   if (languages?.length) {
027695| NOTE: Conditional logic controlling rendering or flow.
027696| src/lib/data.ts:878:     const normalized = languages
027697| NOTE: Local declaration used by search logic or UI.
027698| src/lib/data.ts:879:       .map((l) => l.trim().toLowerCase())
027699| NOTE: Implementation detail supporting search page behavior.
027700| src/lib/data.ts:880:       .filter(Boolean);
027701| NOTE: Implementation detail supporting search page behavior.
027702| src/lib/data.ts:881:     if (normalized.length > 0) {
027703| NOTE: Conditional logic controlling rendering or flow.
027704| src/lib/data.ts:882:       conditions.push(`l."household_languages" && $${paramIndex++}::text[]`);
027705| NOTE: Implementation detail supporting search page behavior.
027706| src/lib/data.ts:883:       queryParams.push(normalized);
027707| NOTE: Implementation detail supporting search page behavior.
027708| src/lib/data.ts:884:     }
027709| NOTE: Implementation detail supporting search page behavior.
027710| src/lib/data.ts:885:   }
027711| NOTE: Implementation detail supporting search page behavior.
027712| src/lib/data.ts:886: 
027713| NOTE: Blank line for visual separation.
027714| src/lib/data.ts:887:   // Amenities filter (SQL level) - AND logic: must have ALL selected amenities
027715| NOTE: Line comment documents intent or constraints.
027716| src/lib/data.ts:888:   // NULL safety: filter out NULL values from unnest to prevent LOWER(NULL) issues
027717| NOTE: Line comment documents intent or constraints.
027718| src/lib/data.ts:889:   if (amenities?.length) {
027719| NOTE: Conditional logic controlling rendering or flow.
027720| src/lib/data.ts:890:     const normalizedAmenities = amenities
027721| NOTE: Local declaration used by search logic or UI.
027722| src/lib/data.ts:891:       .map((a) => a.trim().toLowerCase())
027723| NOTE: Implementation detail supporting search page behavior.
027724| src/lib/data.ts:892:       .filter(Boolean);
027725| NOTE: Implementation detail supporting search page behavior.
027726| src/lib/data.ts:893:     if (normalizedAmenities.length > 0) {
027727| NOTE: Conditional logic controlling rendering or flow.
027728| src/lib/data.ts:894:       conditions.push(
027729| NOTE: Implementation detail supporting search page behavior.
027730| src/lib/data.ts:895:         `ARRAY(SELECT LOWER(x) FROM unnest(l.amenities) AS x WHERE x IS NOT NULL) @> $${paramIndex++}::text[]`,
027731| NOTE: Implementation detail supporting search page behavior.
027732| src/lib/data.ts:896:       );
027733| NOTE: Implementation detail supporting search page behavior.
027734| src/lib/data.ts:897:       queryParams.push(normalizedAmenities);
027735| NOTE: Implementation detail supporting search page behavior.
027736| src/lib/data.ts:898:     }
027737| NOTE: Implementation detail supporting search page behavior.
027738| src/lib/data.ts:899:   }
027739| NOTE: Implementation detail supporting search page behavior.
027740| src/lib/data.ts:900: 
027741| NOTE: Blank line for visual separation.
027742| src/lib/data.ts:901:   // House rules filter (SQL level) - AND logic: must have ALL selected house rules
027743| NOTE: Line comment documents intent or constraints.
027744| src/lib/data.ts:902:   // NULL safety: filter out NULL values from unnest to prevent LOWER(NULL) issues
027745| NOTE: Line comment documents intent or constraints.
027746| src/lib/data.ts:903:   if (houseRules?.length) {
027747| NOTE: Conditional logic controlling rendering or flow.
027748| src/lib/data.ts:904:     const normalizedRules = houseRules
027749| NOTE: Local declaration used by search logic or UI.
027750| src/lib/data.ts:905:       .map((r) => r.trim().toLowerCase())
027751| NOTE: Implementation detail supporting search page behavior.
027752| src/lib/data.ts:906:       .filter(Boolean);
027753| NOTE: Implementation detail supporting search page behavior.
027754| src/lib/data.ts:907:     if (normalizedRules.length > 0) {
027755| NOTE: Conditional logic controlling rendering or flow.
027756| src/lib/data.ts:908:       conditions.push(
027757| NOTE: Implementation detail supporting search page behavior.
027758| src/lib/data.ts:909:         `ARRAY(SELECT LOWER(x) FROM unnest(l."houseRules") AS x WHERE x IS NOT NULL) @> $${paramIndex++}::text[]`,
027759| NOTE: Implementation detail supporting search page behavior.
027760| src/lib/data.ts:910:       );
027761| NOTE: Implementation detail supporting search page behavior.
027762| src/lib/data.ts:911:       queryParams.push(normalizedRules);
027763| NOTE: Implementation detail supporting search page behavior.
027764| src/lib/data.ts:912:     }
027765| NOTE: Implementation detail supporting search page behavior.
027766| src/lib/data.ts:913:   }
027767| NOTE: Implementation detail supporting search page behavior.
027768| src/lib/data.ts:914: 
027769| NOTE: Blank line for visual separation.
027770| src/lib/data.ts:915:   const whereClause = conditions.join(" AND ");
027771| NOTE: Local declaration used by search logic or UI.
027772| src/lib/data.ts:916: 
027773| NOTE: Blank line for visual separation.
027774| src/lib/data.ts:917:   // Query with minimal fields for map markers
027775| NOTE: Line comment documents intent or constraints.
027776| src/lib/data.ts:918:   // Uses images[1] for first image (PostgreSQL text[] is 1-indexed)
027777| NOTE: Line comment documents intent or constraints.
027778| src/lib/data.ts:919:   const sqlQuery = `
027779| NOTE: Local declaration used by search logic or UI.
027780| src/lib/data.ts:920:         SELECT
027781| NOTE: Implementation detail supporting search page behavior.
027782| src/lib/data.ts:921:             l.id,
027783| NOTE: Implementation detail supporting search page behavior.
027784| src/lib/data.ts:922:             l.title,
027785| NOTE: Implementation detail supporting search page behavior.
027786| src/lib/data.ts:923:             l.price,
027787| NOTE: Implementation detail supporting search page behavior.
027788| src/lib/data.ts:924:             l."availableSlots",
027789| NOTE: Implementation detail supporting search page behavior.
027790| src/lib/data.ts:925:             l."ownerId",
027791| NOTE: Implementation detail supporting search page behavior.
027792| src/lib/data.ts:926:             l.images[1] as "primaryImage",
027793| NOTE: Implementation detail supporting search page behavior.
027794| src/lib/data.ts:927:             ST_X(loc.coords::geometry) as lng,
027795| NOTE: Implementation detail supporting search page behavior.
027796| src/lib/data.ts:928:             ST_Y(loc.coords::geometry) as lat
027797| NOTE: Implementation detail supporting search page behavior.
027798| src/lib/data.ts:929:         FROM "Listing" l
027799| NOTE: Implementation detail supporting search page behavior.
027800| src/lib/data.ts:930:         JOIN "Location" loc ON l.id = loc."listingId"
027801| NOTE: Implementation detail supporting search page behavior.
027802| src/lib/data.ts:931:         WHERE ${whereClause}
027803| NOTE: Implementation detail supporting search page behavior.
027804| src/lib/data.ts:932:         ORDER BY l."createdAt" DESC
027805| NOTE: Implementation detail supporting search page behavior.
027806| src/lib/data.ts:933:         LIMIT ${MAX_MAP_MARKERS}
027807| NOTE: Implementation detail supporting search page behavior.
027808| src/lib/data.ts:934:     `;
027809| NOTE: Implementation detail supporting search page behavior.
027810| src/lib/data.ts:935: 
027811| NOTE: Blank line for visual separation.
027812| src/lib/data.ts:936:   try {
027813| NOTE: Implementation detail supporting search page behavior.
027814| src/lib/data.ts:937:     const listings = await prisma.$queryRawUnsafe<any[]>(
027815| NOTE: Local declaration used by search logic or UI.
027816| src/lib/data.ts:938:       sqlQuery,
027817| NOTE: Implementation detail supporting search page behavior.
027818| src/lib/data.ts:939:       ...queryParams,
027819| NOTE: Implementation detail supporting search page behavior.
027820| src/lib/data.ts:940:     );
027821| NOTE: Implementation detail supporting search page behavior.
027822| src/lib/data.ts:941: 
027823| NOTE: Blank line for visual separation.
027824| src/lib/data.ts:942:     return listings.map((l) => ({
027825| NOTE: Return statement for component or helper output.
027826| src/lib/data.ts:943:       id: l.id,
027827| NOTE: Implementation detail supporting search page behavior.
027828| src/lib/data.ts:944:       title: l.title,
027829| NOTE: Implementation detail supporting search page behavior.
027830| src/lib/data.ts:945:       price: Number(l.price),
027831| NOTE: Implementation detail supporting search page behavior.
027832| src/lib/data.ts:946:       availableSlots: l.availableSlots,
027833| NOTE: Implementation detail supporting search page behavior.
027834| src/lib/data.ts:947:       ownerId: l.ownerId,
027835| NOTE: Implementation detail supporting search page behavior.
027836| src/lib/data.ts:948:       images: l.primaryImage ? [l.primaryImage] : [], // Single primary image
027837| NOTE: Implementation detail supporting search page behavior.
027838| src/lib/data.ts:949:       location: {
027839| NOTE: Implementation detail supporting search page behavior.
027840| src/lib/data.ts:950:         lat: Number(l.lat) || 0,
027841| NOTE: Implementation detail supporting search page behavior.
027842| src/lib/data.ts:951:         lng: Number(l.lng) || 0,
027843| NOTE: Implementation detail supporting search page behavior.
027844| src/lib/data.ts:952:       },
027845| NOTE: Implementation detail supporting search page behavior.
027846| src/lib/data.ts:953:     }));
027847| NOTE: Implementation detail supporting search page behavior.
027848| src/lib/data.ts:954:   } catch (error) {
027849| NOTE: Implementation detail supporting search page behavior.
027850| src/lib/data.ts:955:     const dataError = wrapDatabaseError(error, "getMapListings");
027851| NOTE: Local declaration used by search logic or UI.
027852| src/lib/data.ts:956:     dataError.log({
027853| NOTE: Implementation detail supporting search page behavior.
027854| src/lib/data.ts:957:       operation: "getMapListings",
027855| NOTE: Implementation detail supporting search page behavior.
027856| src/lib/data.ts:958:       hasBounds: !!params?.bounds,
027857| NOTE: Implementation detail supporting search page behavior.
027858| src/lib/data.ts:959:     });
027859| NOTE: Implementation detail supporting search page behavior.
027860| src/lib/data.ts:960:     throw dataError;
027861| NOTE: Implementation detail supporting search page behavior.
027862| src/lib/data.ts:961:   }
027863| NOTE: Implementation detail supporting search page behavior.
027864| src/lib/data.ts:962: }
027865| NOTE: Implementation detail supporting search page behavior.
027866| src/lib/data.ts:963: 
027867| NOTE: Blank line for visual separation.
027868| src/lib/data.ts:964: // ============================================
027869| NOTE: Line comment documents intent or constraints.
027870| src/lib/data.ts:965: // Hybrid COUNT optimization
027871| NOTE: Line comment documents intent or constraints.
027872| src/lib/data.ts:966: // ============================================
027873| NOTE: Line comment documents intent or constraints.
027874| src/lib/data.ts:967: 
027875| NOTE: Blank line for visual separation.
027876| src/lib/data.ts:968: /**
027877| NOTE: Block comment line describing behavior or context.
027878| src/lib/data.ts:969:  * Internal function for limited count query.
027879| NOTE: Block comment line describing behavior or context.
027880| src/lib/data.ts:970:  * Uses LIMIT 101 subquery pattern to efficiently detect if count > 100.
027881| NOTE: Block comment line describing behavior or context.
027882| src/lib/data.ts:971:  * Returns exact count if \u2264100, null if >100 (unknown).
027883| NOTE: Block comment line describing behavior or context.
027884| src/lib/data.ts:972:  */
027885| NOTE: Block comment line describing behavior or context.
027886| src/lib/data.ts:973: async function getLimitedCountInternal(
027887| NOTE: Implementation detail supporting search page behavior.
027888| src/lib/data.ts:974:   params: FilterParams,
027889| NOTE: Implementation detail supporting search page behavior.
027890| src/lib/data.ts:975: ): Promise<number | null> {
027891| NOTE: Implementation detail supporting search page behavior.
027892| src/lib/data.ts:976:   const {
027893| NOTE: Local declaration used by search logic or UI.
027894| src/lib/data.ts:977:     query,
027895| NOTE: Implementation detail supporting search page behavior.
027896| src/lib/data.ts:978:     minPrice,
027897| NOTE: Implementation detail supporting search page behavior.
027898| src/lib/data.ts:979:     maxPrice,
027899| NOTE: Implementation detail supporting search page behavior.
027900| src/lib/data.ts:980:     amenities,
027901| NOTE: Implementation detail supporting search page behavior.
027902| src/lib/data.ts:981:     moveInDate,
027903| NOTE: Implementation detail supporting search page behavior.
027904| src/lib/data.ts:982:     leaseDuration,
027905| NOTE: Implementation detail supporting search page behavior.
027906| src/lib/data.ts:983:     houseRules,
027907| NOTE: Implementation detail supporting search page behavior.
027908| src/lib/data.ts:984:     roomType,
027909| NOTE: Implementation detail supporting search page behavior.
027910| src/lib/data.ts:985:     languages,
027911| NOTE: Implementation detail supporting search page behavior.
027912| src/lib/data.ts:986:     bounds,
027913| NOTE: Implementation detail supporting search page behavior.
027914| src/lib/data.ts:987:   } = params;
027915| NOTE: Implementation detail supporting search page behavior.
027916| src/lib/data.ts:988: 
027917| NOTE: Blank line for visual separation.
027918| src/lib/data.ts:989:   // Build dynamic WHERE conditions (same logic as getListingsPaginatedInternal)
027919| NOTE: Line comment documents intent or constraints.
027920| src/lib/data.ts:990:   const conditions: string[] = [
027921| NOTE: Local declaration used by search logic or UI.
027922| src/lib/data.ts:991:     'l."availableSlots" > 0',
027923| NOTE: Implementation detail supporting search page behavior.
027924| src/lib/data.ts:992:     "l.status = 'ACTIVE'",
027925| NOTE: Implementation detail supporting search page behavior.
027926| src/lib/data.ts:993:     "ST_X(loc.coords::geometry) IS NOT NULL",
027927| NOTE: Implementation detail supporting search page behavior.
027928| src/lib/data.ts:994:     "ST_Y(loc.coords::geometry) IS NOT NULL",
027929| NOTE: Implementation detail supporting search page behavior.
027930| src/lib/data.ts:995:     "NOT (ST_X(loc.coords::geometry) = 0 AND ST_Y(loc.coords::geometry) = 0)",
027931| NOTE: Implementation detail supporting search page behavior.
027932| src/lib/data.ts:996:     "ST_Y(loc.coords::geometry) BETWEEN -90 AND 90",
027933| NOTE: Implementation detail supporting search page behavior.
027934| src/lib/data.ts:997:     "ST_X(loc.coords::geometry) BETWEEN -180 AND 180",
027935| NOTE: Implementation detail supporting search page behavior.
027936| src/lib/data.ts:998:   ];
027937| NOTE: Implementation detail supporting search page behavior.
027938| src/lib/data.ts:999:   const queryParams: unknown[] = [];
027939| NOTE: Local declaration used by search logic or UI.
027940| src/lib/data.ts:1000:   let paramIndex = 1;
027941| NOTE: Local declaration used by search logic or UI.
027942| src/lib/data.ts:1001: 
027943| NOTE: Blank line for visual separation.
027944| src/lib/data.ts:1002:   // Geographic bounds filter
027945| NOTE: Line comment documents intent or constraints.
027946| src/lib/data.ts:1003:   if (bounds) {
027947| NOTE: Conditional logic controlling rendering or flow.
027948| src/lib/data.ts:1004:     conditions.push(`ST_Y(loc.coords::geometry) >= $${paramIndex++}`);
027949| NOTE: Implementation detail supporting search page behavior.
027950| src/lib/data.ts:1005:     queryParams.push(bounds.minLat);
027951| NOTE: Implementation detail supporting search page behavior.
027952| src/lib/data.ts:1006:     conditions.push(`ST_Y(loc.coords::geometry) <= $${paramIndex++}`);
027953| NOTE: Implementation detail supporting search page behavior.
027954| src/lib/data.ts:1007:     queryParams.push(bounds.maxLat);
027955| NOTE: Implementation detail supporting search page behavior.
027956| src/lib/data.ts:1008: 
027957| NOTE: Blank line for visual separation.
027958| src/lib/data.ts:1009:     if (crossesAntimeridian(bounds.minLng, bounds.maxLng)) {
027959| NOTE: Conditional logic controlling rendering or flow.
027960| src/lib/data.ts:1010:       conditions.push(
027961| NOTE: Implementation detail supporting search page behavior.
027962| src/lib/data.ts:1011:         `(ST_X(loc.coords::geometry) >= $${paramIndex++} OR ST_X(loc.coords::geometry) <= $${paramIndex++})`,
027963| NOTE: Implementation detail supporting search page behavior.
027964| src/lib/data.ts:1012:       );
027965| NOTE: Implementation detail supporting search page behavior.
027966| src/lib/data.ts:1013:       queryParams.push(bounds.minLng);
027967| NOTE: Implementation detail supporting search page behavior.
027968| src/lib/data.ts:1014:       queryParams.push(bounds.maxLng);
027969| NOTE: Implementation detail supporting search page behavior.
027970| src/lib/data.ts:1015:     } else {
027971| NOTE: Implementation detail supporting search page behavior.
027972| src/lib/data.ts:1016:       conditions.push(`ST_X(loc.coords::geometry) >= $${paramIndex++}`);
027973| NOTE: Implementation detail supporting search page behavior.
027974| src/lib/data.ts:1017:       queryParams.push(bounds.minLng);
027975| NOTE: Implementation detail supporting search page behavior.
027976| src/lib/data.ts:1018:       conditions.push(`ST_X(loc.coords::geometry) <= $${paramIndex++}`);
027977| NOTE: Implementation detail supporting search page behavior.
027978| src/lib/data.ts:1019:       queryParams.push(bounds.maxLng);
027979| NOTE: Implementation detail supporting search page behavior.
027980| src/lib/data.ts:1020:     }
027981| NOTE: Implementation detail supporting search page behavior.
027982| src/lib/data.ts:1021:   }
027983| NOTE: Implementation detail supporting search page behavior.
027984| src/lib/data.ts:1022: 
027985| NOTE: Blank line for visual separation.
027986| src/lib/data.ts:1023:   // Price range filter
027987| NOTE: Line comment documents intent or constraints.
027988| src/lib/data.ts:1024:   if (minPrice !== undefined && minPrice !== null) {
027989| NOTE: Conditional logic controlling rendering or flow.
027990| src/lib/data.ts:1025:     conditions.push(`l.price >= $${paramIndex++}`);
027991| NOTE: Implementation detail supporting search page behavior.
027992| src/lib/data.ts:1026:     queryParams.push(minPrice);
027993| NOTE: Implementation detail supporting search page behavior.
027994| src/lib/data.ts:1027:   }
027995| NOTE: Implementation detail supporting search page behavior.
027996| src/lib/data.ts:1028:   if (maxPrice !== undefined && maxPrice !== null) {
027997| NOTE: Conditional logic controlling rendering or flow.
027998| src/lib/data.ts:1029:     conditions.push(`l.price <= $${paramIndex++}`);
027999| NOTE: Implementation detail supporting search page behavior.
028000| src/lib/data.ts:1030:     queryParams.push(maxPrice);
028001| NOTE: Implementation detail supporting search page behavior.
028002| src/lib/data.ts:1031:   }
028003| NOTE: Implementation detail supporting search page behavior.
028004| src/lib/data.ts:1032: 
028005| NOTE: Blank line for visual separation.
028006| src/lib/data.ts:1033:   // Text search filter
028007| NOTE: Line comment documents intent or constraints.
028008| src/lib/data.ts:1034:   if (query && isValidQuery(query)) {
028009| NOTE: Conditional logic controlling rendering or flow.
028010| src/lib/data.ts:1035:     const sanitizedQuery = sanitizeSearchQuery(query);
028011| NOTE: Local declaration used by search logic or UI.
028012| src/lib/data.ts:1036:     if (sanitizedQuery) {
028013| NOTE: Conditional logic controlling rendering or flow.
028014| src/lib/data.ts:1037:       const searchPattern = `%${sanitizedQuery}%`;
028015| NOTE: Local declaration used by search logic or UI.
028016| src/lib/data.ts:1038:       conditions.push(`(
028017| NOTE: Implementation detail supporting search page behavior.
028018| src/lib/data.ts:1039:         LOWER(l.title) LIKE LOWER($${paramIndex}) OR
028019| NOTE: Implementation detail supporting search page behavior.
028020| src/lib/data.ts:1040:         LOWER(l.description) LIKE LOWER($${paramIndex}) OR
028021| NOTE: Implementation detail supporting search page behavior.
028022| src/lib/data.ts:1041:         LOWER(loc.city) LIKE LOWER($${paramIndex}) OR
028023| NOTE: Implementation detail supporting search page behavior.
028024| src/lib/data.ts:1042:         LOWER(loc.state) LIKE LOWER($${paramIndex})
028025| NOTE: Implementation detail supporting search page behavior.
028026| src/lib/data.ts:1043:       )`);
028027| NOTE: Implementation detail supporting search page behavior.
028028| src/lib/data.ts:1044:       queryParams.push(searchPattern);
028029| NOTE: Implementation detail supporting search page behavior.
028030| src/lib/data.ts:1045:       paramIndex++;
028031| NOTE: Implementation detail supporting search page behavior.
028032| src/lib/data.ts:1046:     }
028033| NOTE: Implementation detail supporting search page behavior.
028034| src/lib/data.ts:1047:   }
028035| NOTE: Implementation detail supporting search page behavior.
028036| src/lib/data.ts:1048: 
028037| NOTE: Blank line for visual separation.
028038| src/lib/data.ts:1049:   // Room type filter
028039| NOTE: Line comment documents intent or constraints.
028040| src/lib/data.ts:1050:   if (roomType) {
028041| NOTE: Conditional logic controlling rendering or flow.
028042| src/lib/data.ts:1051:     conditions.push(`LOWER(l."roomType") = LOWER($${paramIndex++})`);
028043| NOTE: Implementation detail supporting search page behavior.
028044| src/lib/data.ts:1052:     queryParams.push(roomType);
028045| NOTE: Implementation detail supporting search page behavior.
028046| src/lib/data.ts:1053:   }
028047| NOTE: Implementation detail supporting search page behavior.
028048| src/lib/data.ts:1054: 
028049| NOTE: Blank line for visual separation.
028050| src/lib/data.ts:1055:   // Lease duration filter
028051| NOTE: Line comment documents intent or constraints.
028052| src/lib/data.ts:1056:   if (leaseDuration) {
028053| NOTE: Conditional logic controlling rendering or flow.
028054| src/lib/data.ts:1057:     conditions.push(`LOWER(l."leaseDuration") = LOWER($${paramIndex++})`);
028055| NOTE: Implementation detail supporting search page behavior.
028056| src/lib/data.ts:1058:     queryParams.push(leaseDuration);
028057| NOTE: Implementation detail supporting search page behavior.
028058| src/lib/data.ts:1059:   }
028059| NOTE: Implementation detail supporting search page behavior.
028060| src/lib/data.ts:1060: 
028061| NOTE: Blank line for visual separation.
028062| src/lib/data.ts:1061:   // Move-in date filter
028063| NOTE: Line comment documents intent or constraints.
028064| src/lib/data.ts:1062:   if (moveInDate) {
028065| NOTE: Conditional logic controlling rendering or flow.
028066| src/lib/data.ts:1063:     conditions.push(
028067| NOTE: Implementation detail supporting search page behavior.
028068| src/lib/data.ts:1064:       `(l."moveInDate" IS NULL OR l."moveInDate" <= $${paramIndex++})`,
028069| NOTE: Implementation detail supporting search page behavior.
028070| src/lib/data.ts:1065:     );
028071| NOTE: Implementation detail supporting search page behavior.
028072| src/lib/data.ts:1066:     queryParams.push(parseDateOnly(moveInDate));
028073| NOTE: Implementation detail supporting search page behavior.
028074| src/lib/data.ts:1067:   }
028075| NOTE: Implementation detail supporting search page behavior.
028076| src/lib/data.ts:1068: 
028077| NOTE: Blank line for visual separation.
028078| src/lib/data.ts:1069:   // Languages filter (OR logic)
028079| NOTE: Line comment documents intent or constraints.
028080| src/lib/data.ts:1070:   if (languages?.length) {
028081| NOTE: Conditional logic controlling rendering or flow.
028082| src/lib/data.ts:1071:     const normalized = languages
028083| NOTE: Local declaration used by search logic or UI.
028084| src/lib/data.ts:1072:       .map((l) => l.trim().toLowerCase())
028085| NOTE: Implementation detail supporting search page behavior.
028086| src/lib/data.ts:1073:       .filter(Boolean);
028087| NOTE: Implementation detail supporting search page behavior.
028088| src/lib/data.ts:1074:     if (normalized.length > 0) {
028089| NOTE: Conditional logic controlling rendering or flow.
028090| src/lib/data.ts:1075:       conditions.push(`l."household_languages" && $${paramIndex++}::text[]`);
028091| NOTE: Implementation detail supporting search page behavior.
028092| src/lib/data.ts:1076:       queryParams.push(normalized);
028093| NOTE: Implementation detail supporting search page behavior.
028094| src/lib/data.ts:1077:     }
028095| NOTE: Implementation detail supporting search page behavior.
028096| src/lib/data.ts:1078:   }
028097| NOTE: Implementation detail supporting search page behavior.
028098| src/lib/data.ts:1079: 
028099| NOTE: Blank line for visual separation.
028100| src/lib/data.ts:1080:   // Amenities filter (AND logic)
028101| NOTE: Line comment documents intent or constraints.
028102| src/lib/data.ts:1081:   if (amenities?.length) {
028103| NOTE: Conditional logic controlling rendering or flow.
028104| src/lib/data.ts:1082:     const normalizedAmenities = amenities
028105| NOTE: Local declaration used by search logic or UI.
028106| src/lib/data.ts:1083:       .map((a) => a.trim().toLowerCase())
028107| NOTE: Implementation detail supporting search page behavior.
028108| src/lib/data.ts:1084:       .filter(Boolean);
028109| NOTE: Implementation detail supporting search page behavior.
028110| src/lib/data.ts:1085:     if (normalizedAmenities.length > 0) {
028111| NOTE: Conditional logic controlling rendering or flow.
028112| src/lib/data.ts:1086:       conditions.push(`NOT EXISTS (
028113| NOTE: Implementation detail supporting search page behavior.
028114| src/lib/data.ts:1087:         SELECT 1 FROM unnest($${paramIndex++}::text[]) AS search_term
028115| NOTE: Implementation detail supporting search page behavior.
028116| src/lib/data.ts:1088:         WHERE NOT EXISTS (
028117| NOTE: Implementation detail supporting search page behavior.
028118| src/lib/data.ts:1089:           SELECT 1 FROM unnest(l.amenities) AS la
028119| NOTE: Implementation detail supporting search page behavior.
028120| src/lib/data.ts:1090:           WHERE LOWER(la) LIKE '%' || search_term || '%'
028121| NOTE: Implementation detail supporting search page behavior.
028122| src/lib/data.ts:1091:         )
028123| NOTE: Implementation detail supporting search page behavior.
028124| src/lib/data.ts:1092:       )`);
028125| NOTE: Implementation detail supporting search page behavior.
028126| src/lib/data.ts:1093:       queryParams.push(normalizedAmenities);
028127| NOTE: Implementation detail supporting search page behavior.
028128| src/lib/data.ts:1094:     }
028129| NOTE: Implementation detail supporting search page behavior.
028130| src/lib/data.ts:1095:   }
028131| NOTE: Implementation detail supporting search page behavior.
028132| src/lib/data.ts:1096: 
028133| NOTE: Blank line for visual separation.
028134| src/lib/data.ts:1097:   // House rules filter (AND logic)
028135| NOTE: Line comment documents intent or constraints.
028136| src/lib/data.ts:1098:   if (houseRules?.length) {
028137| NOTE: Conditional logic controlling rendering or flow.
028138| src/lib/data.ts:1099:     const normalizedRules = houseRules
028139| NOTE: Local declaration used by search logic or UI.
028140| src/lib/data.ts:1100:       .map((r) => r.trim().toLowerCase())
028141| NOTE: Implementation detail supporting search page behavior.
028142| src/lib/data.ts:1101:       .filter(Boolean);
028143| NOTE: Implementation detail supporting search page behavior.
028144| src/lib/data.ts:1102:     if (normalizedRules.length > 0) {
028145| NOTE: Conditional logic controlling rendering or flow.
028146| src/lib/data.ts:1103:       conditions.push(
028147| NOTE: Implementation detail supporting search page behavior.
028148| src/lib/data.ts:1104:         `ARRAY(SELECT LOWER(x) FROM unnest(l."houseRules") AS x WHERE x IS NOT NULL) @> $${paramIndex++}::text[]`,
028149| NOTE: Implementation detail supporting search page behavior.
028150| src/lib/data.ts:1105:       );
028151| NOTE: Implementation detail supporting search page behavior.
028152| src/lib/data.ts:1106:       queryParams.push(normalizedRules);
028153| NOTE: Implementation detail supporting search page behavior.
028154| src/lib/data.ts:1107:     }
028155| NOTE: Implementation detail supporting search page behavior.
028156| src/lib/data.ts:1108:   }
028157| NOTE: Implementation detail supporting search page behavior.
028158| src/lib/data.ts:1109: 
028159| NOTE: Blank line for visual separation.
028160| src/lib/data.ts:1110:   const whereClause = conditions.join(" AND ");
028161| NOTE: Local declaration used by search logic or UI.
028162| src/lib/data.ts:1111: 
028163| NOTE: Blank line for visual separation.
028164| src/lib/data.ts:1112:   // Use subquery with LIMIT 101 to efficiently check if count > threshold
028165| NOTE: Line comment documents intent or constraints.
028166| src/lib/data.ts:1113:   // This is much faster than COUNT(*) for large result sets
028167| NOTE: Line comment documents intent or constraints.
028168| src/lib/data.ts:1114:   const limitedCountQuery = `
028169| NOTE: Local declaration used by search logic or UI.
028170| src/lib/data.ts:1115:     SELECT COUNT(*) as count
028171| NOTE: Implementation detail supporting search page behavior.
028172| src/lib/data.ts:1116:     FROM (
028173| NOTE: Implementation detail supporting search page behavior.
028174| src/lib/data.ts:1117:       SELECT DISTINCT l.id
028175| NOTE: Implementation detail supporting search page behavior.
028176| src/lib/data.ts:1118:       FROM "Listing" l
028177| NOTE: Implementation detail supporting search page behavior.
028178| src/lib/data.ts:1119:       JOIN "Location" loc ON l.id = loc."listingId"
028179| NOTE: Implementation detail supporting search page behavior.
028180| src/lib/data.ts:1120:       WHERE ${whereClause}
028181| NOTE: Implementation detail supporting search page behavior.
028182| src/lib/data.ts:1121:       LIMIT ${HYBRID_COUNT_THRESHOLD + 1}
028183| NOTE: Implementation detail supporting search page behavior.
028184| src/lib/data.ts:1122:     ) subq
028185| NOTE: Implementation detail supporting search page behavior.
028186| src/lib/data.ts:1123:   `;
028187| NOTE: Implementation detail supporting search page behavior.
028188| src/lib/data.ts:1124: 
028189| NOTE: Blank line for visual separation.
028190| src/lib/data.ts:1125:   const result = await prisma.$queryRawUnsafe<{ count: bigint }[]>(
028191| NOTE: Local declaration used by search logic or UI.
028192| src/lib/data.ts:1126:     limitedCountQuery,
028193| NOTE: Implementation detail supporting search page behavior.
028194| src/lib/data.ts:1127:     ...queryParams,
028195| NOTE: Implementation detail supporting search page behavior.
028196| src/lib/data.ts:1128:   );
028197| NOTE: Implementation detail supporting search page behavior.
028198| src/lib/data.ts:1129: 
028199| NOTE: Blank line for visual separation.
028200| src/lib/data.ts:1130:   const count = Number(result[0]?.count || 0);
028201| NOTE: Local declaration used by search logic or UI.
028202| src/lib/data.ts:1131: 
028203| NOTE: Blank line for visual separation.
028204| src/lib/data.ts:1132:   // If count > threshold, return null (unknown total)
028205| NOTE: Line comment documents intent or constraints.
028206| src/lib/data.ts:1133:   if (count > HYBRID_COUNT_THRESHOLD) {
028207| NOTE: Conditional logic controlling rendering or flow.
028208| src/lib/data.ts:1134:     return null;
028209| NOTE: Return statement for component or helper output.
028210| src/lib/data.ts:1135:   }
028211| NOTE: Implementation detail supporting search page behavior.
028212| src/lib/data.ts:1136: 
028213| NOTE: Blank line for visual separation.
028214| src/lib/data.ts:1137:   return count;
028215| NOTE: Return statement for component or helper output.
028216| src/lib/data.ts:1138: }
028217| NOTE: Implementation detail supporting search page behavior.
028218| src/lib/data.ts:1139: 
028219| NOTE: Blank line for visual separation.
028220| src/lib/data.ts:1140: /**
028221| NOTE: Block comment line describing behavior or context.
028222| src/lib/data.ts:1141:  * Cached wrapper for limited count with 60s TTL.
028223| NOTE: Block comment line describing behavior or context.
028224| src/lib/data.ts:1142:  * CRITICAL: Uses filter-only cache key (excludes page/limit) so count is
028225| NOTE: Block comment line describing behavior or context.
028226| src/lib/data.ts:1143:  * consistent across all pages of the same filter set.
028227| NOTE: Block comment line describing behavior or context.
028228| src/lib/data.ts:1144:  *
028229| NOTE: Block comment line describing behavior or context.
028230| src/lib/data.ts:1145:  * Example: User on page 1 sees "50 results", navigates to page 2,
028231| NOTE: Block comment line describing behavior or context.
028232| src/lib/data.ts:1146:  * still sees "50 results" (cache hit on same filter key).
028233| NOTE: Block comment line describing behavior or context.
028234| src/lib/data.ts:1147:  */
028235| NOTE: Block comment line describing behavior or context.
028236| src/lib/data.ts:1148: export async function getLimitedCount(
028237| NOTE: Implementation detail supporting search page behavior.
028238| src/lib/data.ts:1149:   params: FilterParams,
028239| NOTE: Implementation detail supporting search page behavior.
028240| src/lib/data.ts:1150: ): Promise<number | null> {
028241| NOTE: Implementation detail supporting search page behavior.
028242| src/lib/data.ts:1151:   const cacheKey = createFiltersCacheKey(params);
028243| NOTE: Local declaration used by search logic or UI.
028244| src/lib/data.ts:1152: 
028245| NOTE: Blank line for visual separation.
028246| src/lib/data.ts:1153:   const cachedFn = unstable_cache(
028247| NOTE: Local declaration used by search logic or UI.
028248| src/lib/data.ts:1154:     async () => getLimitedCountInternal(params),
028249| NOTE: Implementation detail supporting search page behavior.
028250| src/lib/data.ts:1155:     ["limited-count", cacheKey],
028251| NOTE: Implementation detail supporting search page behavior.
028252| src/lib/data.ts:1156:     { revalidate: 60 },
028253| NOTE: Implementation detail supporting search page behavior.
028254| src/lib/data.ts:1157:   );
028255| NOTE: Implementation detail supporting search page behavior.
028256| src/lib/data.ts:1158: 
028257| NOTE: Blank line for visual separation.
028258| src/lib/data.ts:1159:   return cachedFn();
028259| NOTE: Return statement for component or helper output.
028260| src/lib/data.ts:1160: }
028261| NOTE: Implementation detail supporting search page behavior.
028262| src/lib/data.ts:1161: 
028263| NOTE: Blank line for visual separation.
028264| src/lib/data.ts:1162: /**
028265| NOTE: Block comment line describing behavior or context.
028266| src/lib/data.ts:1163:  * Cached wrapper for paginated listings with 60s TTL.
028267| NOTE: Block comment line describing behavior or context.
028268| src/lib/data.ts:1164:  * Uses hybrid pagination: exact count for \u2264100 results, "100+" for larger sets.
028269| NOTE: Block comment line describing behavior or context.
028270| src/lib/data.ts:1165:  * This significantly reduces DB load by avoiding expensive COUNT queries.
028271| NOTE: Block comment line describing behavior or context.
028272| src/lib/data.ts:1166:  */
028273| NOTE: Block comment line describing behavior or context.
028274| src/lib/data.ts:1167: export async function getListingsPaginated(
028275| NOTE: Implementation detail supporting search page behavior.
028276| src/lib/data.ts:1168:   params: FilterParams = {},
028277| NOTE: Implementation detail supporting search page behavior.
028278| src/lib/data.ts:1169: ): Promise<PaginatedResultHybrid<ListingData>> {
028279| NOTE: Implementation detail supporting search page behavior.
028280| src/lib/data.ts:1170:   const cacheKey = createListingsCacheKey(params);
028281| NOTE: Local declaration used by search logic or UI.
028282| src/lib/data.ts:1171: 
028283| NOTE: Blank line for visual separation.
028284| src/lib/data.ts:1172:   const cachedFn = unstable_cache(
028285| NOTE: Local declaration used by search logic or UI.
028286| src/lib/data.ts:1173:     async () => getListingsPaginatedInternal(params),
028287| NOTE: Implementation detail supporting search page behavior.
028288| src/lib/data.ts:1174:     ["listings-paginated", cacheKey],
028289| NOTE: Implementation detail supporting search page behavior.
028290| src/lib/data.ts:1175:     { revalidate: 60 },
028291| NOTE: Implementation detail supporting search page behavior.
028292| src/lib/data.ts:1176:   );
028293| NOTE: Implementation detail supporting search page behavior.
028294| src/lib/data.ts:1177: 
028295| NOTE: Blank line for visual separation.
028296| src/lib/data.ts:1178:   return cachedFn();
028297| NOTE: Return statement for component or helper output.
028298| src/lib/data.ts:1179: }
028299| NOTE: Implementation detail supporting search page behavior.
028300| src/lib/data.ts:1180: 
028301| NOTE: Blank line for visual separation.
028302| src/lib/data.ts:1181: async function getListingsPaginatedInternal(
028303| NOTE: Implementation detail supporting search page behavior.
028304| src/lib/data.ts:1182:   params: FilterParams = {},
028305| NOTE: Implementation detail supporting search page behavior.
028306| src/lib/data.ts:1183: ): Promise<PaginatedResultHybrid<ListingData>> {
028307| NOTE: Implementation detail supporting search page behavior.
028308| src/lib/data.ts:1184:   const {
028309| NOTE: Local declaration used by search logic or UI.
028310| src/lib/data.ts:1185:     query,
028311| NOTE: Implementation detail supporting search page behavior.
028312| src/lib/data.ts:1186:     minPrice,
028313| NOTE: Implementation detail supporting search page behavior.
028314| src/lib/data.ts:1187:     maxPrice,
028315| NOTE: Implementation detail supporting search page behavior.
028316| src/lib/data.ts:1188:     amenities,
028317| NOTE: Implementation detail supporting search page behavior.
028318| src/lib/data.ts:1189:     moveInDate,
028319| NOTE: Implementation detail supporting search page behavior.
028320| src/lib/data.ts:1190:     leaseDuration,
028321| NOTE: Implementation detail supporting search page behavior.
028322| src/lib/data.ts:1191:     houseRules,
028323| NOTE: Implementation detail supporting search page behavior.
028324| src/lib/data.ts:1192:     roomType,
028325| NOTE: Implementation detail supporting search page behavior.
028326| src/lib/data.ts:1193:     languages,
028327| NOTE: Implementation detail supporting search page behavior.
028328| src/lib/data.ts:1194:     bounds,
028329| NOTE: Implementation detail supporting search page behavior.
028330| src/lib/data.ts:1195:     nearMatches,
028331| NOTE: Implementation detail supporting search page behavior.
028332| src/lib/data.ts:1196:     sort = "recommended",
028333| NOTE: Implementation detail supporting search page behavior.
028334| src/lib/data.ts:1197:     page = 1,
028335| NOTE: Implementation detail supporting search page behavior.
028336| src/lib/data.ts:1198:     limit = 12,
028337| NOTE: Implementation detail supporting search page behavior.
028338| src/lib/data.ts:1199:   } = params;
028339| NOTE: Implementation detail supporting search page behavior.
028340| src/lib/data.ts:1200: 
028341| NOTE: Blank line for visual separation.
028342| src/lib/data.ts:1201:   try {
028343| NOTE: Implementation detail supporting search page behavior.
028344| src/lib/data.ts:1202:     // Build dynamic WHERE conditions for SQL
028345| NOTE: Line comment documents intent or constraints.
028346| src/lib/data.ts:1203:     const conditions: string[] = [
028347| NOTE: Local declaration used by search logic or UI.
028348| src/lib/data.ts:1204:       'l."availableSlots" > 0',
028349| NOTE: Implementation detail supporting search page behavior.
028350| src/lib/data.ts:1205:       "l.status = 'ACTIVE'",
028351| NOTE: Implementation detail supporting search page behavior.
028352| src/lib/data.ts:1206:       // Exclude listings with invalid coordinates (null, zero, or out of range)
028353| NOTE: Line comment documents intent or constraints.
028354| src/lib/data.ts:1207:       "ST_X(loc.coords::geometry) IS NOT NULL",
028355| NOTE: Implementation detail supporting search page behavior.
028356| src/lib/data.ts:1208:       "ST_Y(loc.coords::geometry) IS NOT NULL",
028357| NOTE: Implementation detail supporting search page behavior.
028358| src/lib/data.ts:1209:       "NOT (ST_X(loc.coords::geometry) = 0 AND ST_Y(loc.coords::geometry) = 0)",
028359| NOTE: Implementation detail supporting search page behavior.
028360| src/lib/data.ts:1210:       "ST_Y(loc.coords::geometry) BETWEEN -90 AND 90",
028361| NOTE: Implementation detail supporting search page behavior.
028362| src/lib/data.ts:1211:       "ST_X(loc.coords::geometry) BETWEEN -180 AND 180",
028363| NOTE: Implementation detail supporting search page behavior.
028364| src/lib/data.ts:1212:     ];
028365| NOTE: Implementation detail supporting search page behavior.
028366| src/lib/data.ts:1213:     const queryParams: any[] = [];
028367| NOTE: Local declaration used by search logic or UI.
028368| src/lib/data.ts:1214:     let paramIndex = 1;
028369| NOTE: Local declaration used by search logic or UI.
028370| src/lib/data.ts:1215: 
028371| NOTE: Blank line for visual separation.
028372| src/lib/data.ts:1216:     // Geographic bounds filter (SQL level) with antimeridian support
028373| NOTE: Line comment documents intent or constraints.
028374| src/lib/data.ts:1217:     if (bounds) {
028375| NOTE: Conditional logic controlling rendering or flow.
028376| src/lib/data.ts:1218:       // Latitude bounds (always simple range check)
028377| NOTE: Line comment documents intent or constraints.
028378| src/lib/data.ts:1219:       conditions.push(`ST_Y(loc.coords::geometry) >= $${paramIndex++}`);
028379| NOTE: Implementation detail supporting search page behavior.
028380| src/lib/data.ts:1220:       queryParams.push(bounds.minLat);
028381| NOTE: Implementation detail supporting search page behavior.
028382| src/lib/data.ts:1221:       conditions.push(`ST_Y(loc.coords::geometry) <= $${paramIndex++}`);
028383| NOTE: Implementation detail supporting search page behavior.
028384| src/lib/data.ts:1222:       queryParams.push(bounds.maxLat);
028385| NOTE: Implementation detail supporting search page behavior.
028386| src/lib/data.ts:1223: 
028387| NOTE: Blank line for visual separation.
028388| src/lib/data.ts:1224:       // Longitude bounds (may cross antimeridian when minLng > maxLng)
028389| NOTE: Line comment documents intent or constraints.
028390| src/lib/data.ts:1225:       if (crossesAntimeridian(bounds.minLng, bounds.maxLng)) {
028391| NOTE: Conditional logic controlling rendering or flow.
028392| src/lib/data.ts:1226:         // Split query: (minLng to 180) OR (-180 to maxLng)
028393| NOTE: Line comment documents intent or constraints.
028394| src/lib/data.ts:1227:         conditions.push(
028395| NOTE: Implementation detail supporting search page behavior.
028396| src/lib/data.ts:1228:           `(ST_X(loc.coords::geometry) >= $${paramIndex++} OR ST_X(loc.coords::geometry) <= $${paramIndex++})`,
028397| NOTE: Implementation detail supporting search page behavior.
028398| src/lib/data.ts:1229:         );
028399| NOTE: Implementation detail supporting search page behavior.
028400| src/lib/data.ts:1230:         queryParams.push(bounds.minLng);
028401| NOTE: Implementation detail supporting search page behavior.
028402| src/lib/data.ts:1231:         queryParams.push(bounds.maxLng);
028403| NOTE: Implementation detail supporting search page behavior.
028404| src/lib/data.ts:1232:       } else {
028405| NOTE: Implementation detail supporting search page behavior.
028406| src/lib/data.ts:1233:         // Normal longitude range
028407| NOTE: Line comment documents intent or constraints.
028408| src/lib/data.ts:1234:         conditions.push(`ST_X(loc.coords::geometry) >= $${paramIndex++}`);
028409| NOTE: Implementation detail supporting search page behavior.
028410| src/lib/data.ts:1235:         queryParams.push(bounds.minLng);
028411| NOTE: Implementation detail supporting search page behavior.
028412| src/lib/data.ts:1236:         conditions.push(`ST_X(loc.coords::geometry) <= $${paramIndex++}`);
028413| NOTE: Implementation detail supporting search page behavior.
028414| src/lib/data.ts:1237:         queryParams.push(bounds.maxLng);
028415| NOTE: Implementation detail supporting search page behavior.
028416| src/lib/data.ts:1238:       }
028417| NOTE: Implementation detail supporting search page behavior.
028418| src/lib/data.ts:1239:     }
028419| NOTE: Implementation detail supporting search page behavior.
028420| src/lib/data.ts:1240: 
028421| NOTE: Blank line for visual separation.
028422| src/lib/data.ts:1241:     // Price range filter (SQL level)
028423| NOTE: Line comment documents intent or constraints.
028424| src/lib/data.ts:1242:     if (minPrice !== undefined && minPrice !== null) {
028425| NOTE: Conditional logic controlling rendering or flow.
028426| src/lib/data.ts:1243:       conditions.push(`l.price >= $${paramIndex++}`);
028427| NOTE: Implementation detail supporting search page behavior.
028428| src/lib/data.ts:1244:       queryParams.push(minPrice);
028429| NOTE: Implementation detail supporting search page behavior.
028430| src/lib/data.ts:1245:     }
028431| NOTE: Implementation detail supporting search page behavior.
028432| src/lib/data.ts:1246:     if (maxPrice !== undefined && maxPrice !== null) {
028433| NOTE: Conditional logic controlling rendering or flow.
028434| src/lib/data.ts:1247:       conditions.push(`l.price <= $${paramIndex++}`);
028435| NOTE: Implementation detail supporting search page behavior.
028436| src/lib/data.ts:1248:       queryParams.push(maxPrice);
028437| NOTE: Implementation detail supporting search page behavior.
028438| src/lib/data.ts:1249:     }
028439| NOTE: Implementation detail supporting search page behavior.
028440| src/lib/data.ts:1250: 
028441| NOTE: Blank line for visual separation.
028442| src/lib/data.ts:1251:     // Text search filter (SQL level, case-insensitive, with sanitization)
028443| NOTE: Line comment documents intent or constraints.
028444| src/lib/data.ts:1252:     // Only apply if query meets minimum length requirement
028445| NOTE: Line comment documents intent or constraints.
028446| src/lib/data.ts:1253:     if (query && isValidQuery(query)) {
028447| NOTE: Conditional logic controlling rendering or flow.
028448| src/lib/data.ts:1254:       const sanitizedQuery = sanitizeSearchQuery(query);
028449| NOTE: Local declaration used by search logic or UI.
028450| src/lib/data.ts:1255:       if (sanitizedQuery) {
028451| NOTE: Conditional logic controlling rendering or flow.
028452| src/lib/data.ts:1256:         const searchPattern = `%${sanitizedQuery}%`;
028453| NOTE: Local declaration used by search logic or UI.
028454| src/lib/data.ts:1257:         conditions.push(`(
028455| NOTE: Implementation detail supporting search page behavior.
028456| src/lib/data.ts:1258:                 LOWER(l.title) LIKE LOWER($${paramIndex}) OR
028457| NOTE: Implementation detail supporting search page behavior.
028458| src/lib/data.ts:1259:                 LOWER(l.description) LIKE LOWER($${paramIndex}) OR
028459| NOTE: Implementation detail supporting search page behavior.
028460| src/lib/data.ts:1260:                 LOWER(loc.city) LIKE LOWER($${paramIndex}) OR
028461| NOTE: Implementation detail supporting search page behavior.
028462| src/lib/data.ts:1261:                 LOWER(loc.state) LIKE LOWER($${paramIndex})
028463| NOTE: Implementation detail supporting search page behavior.
028464| src/lib/data.ts:1262:             )`);
028465| NOTE: Implementation detail supporting search page behavior.
028466| src/lib/data.ts:1263:         queryParams.push(searchPattern);
028467| NOTE: Implementation detail supporting search page behavior.
028468| src/lib/data.ts:1264:         paramIndex++;
028469| NOTE: Implementation detail supporting search page behavior.
028470| src/lib/data.ts:1265:       }
028471| NOTE: Implementation detail supporting search page behavior.
028472| src/lib/data.ts:1266:     }
028473| NOTE: Implementation detail supporting search page behavior.
028474| src/lib/data.ts:1267: 
028475| NOTE: Blank line for visual separation.
028476| src/lib/data.ts:1268:     // Room type filter (SQL level, case-insensitive)
028477| NOTE: Line comment documents intent or constraints.
028478| src/lib/data.ts:1269:     if (roomType) {
028479| NOTE: Conditional logic controlling rendering or flow.
028480| src/lib/data.ts:1270:       conditions.push(`LOWER(l."roomType") = LOWER($${paramIndex++})`);
028481| NOTE: Implementation detail supporting search page behavior.
028482| src/lib/data.ts:1271:       queryParams.push(roomType);
028483| NOTE: Implementation detail supporting search page behavior.
028484| src/lib/data.ts:1272:     }
028485| NOTE: Implementation detail supporting search page behavior.
028486| src/lib/data.ts:1273: 
028487| NOTE: Blank line for visual separation.
028488| src/lib/data.ts:1274:     // Lease duration filter (SQL level, case-insensitive)
028489| NOTE: Line comment documents intent or constraints.
028490| src/lib/data.ts:1275:     if (leaseDuration) {
028491| NOTE: Conditional logic controlling rendering or flow.
028492| src/lib/data.ts:1276:       conditions.push(`LOWER(l."leaseDuration") = LOWER($${paramIndex++})`);
028493| NOTE: Implementation detail supporting search page behavior.
028494| src/lib/data.ts:1277:       queryParams.push(leaseDuration);
028495| NOTE: Implementation detail supporting search page behavior.
028496| src/lib/data.ts:1278:     }
028497| NOTE: Implementation detail supporting search page behavior.
028498| src/lib/data.ts:1279: 
028499| NOTE: Blank line for visual separation.
028500| src/lib/data.ts:1280:     // Move-in date filter (SQL level)
028501| NOTE: Line comment documents intent or constraints.
028502| src/lib/data.ts:1281:     if (moveInDate) {
028503| NOTE: Conditional logic controlling rendering or flow.
028504| src/lib/data.ts:1282:       conditions.push(
028505| NOTE: Implementation detail supporting search page behavior.
028506| src/lib/data.ts:1283:         `(l."moveInDate" IS NULL OR l."moveInDate" <= $${paramIndex++})`,
028507| NOTE: Implementation detail supporting search page behavior.
028508| src/lib/data.ts:1284:       );
028509| NOTE: Implementation detail supporting search page behavior.
028510| src/lib/data.ts:1285:       queryParams.push(parseDateOnly(moveInDate));
028511| NOTE: Implementation detail supporting search page behavior.
028512| src/lib/data.ts:1286:     }
028513| NOTE: Implementation detail supporting search page behavior.
028514| src/lib/data.ts:1287: 
028515| NOTE: Blank line for visual separation.
028516| src/lib/data.ts:1288:     // Languages filter (SQL level with GIN index) - OR logic
028517| NOTE: Line comment documents intent or constraints.
028518| src/lib/data.ts:1289:     // Pass ONE array param - simpler, fewer bugs, uses GIN index
028519| NOTE: Line comment documents intent or constraints.
028520| src/lib/data.ts:1290:     if (languages?.length) {
028521| NOTE: Conditional logic controlling rendering or flow.
028522| src/lib/data.ts:1291:       const normalized = languages
028523| NOTE: Local declaration used by search logic or UI.
028524| src/lib/data.ts:1292:         .map((l) => l.trim().toLowerCase())
028525| NOTE: Implementation detail supporting search page behavior.
028526| src/lib/data.ts:1293:         .filter(Boolean);
028527| NOTE: Implementation detail supporting search page behavior.
028528| src/lib/data.ts:1294:       if (normalized.length > 0) {
028529| NOTE: Conditional logic controlling rendering or flow.
028530| src/lib/data.ts:1295:         conditions.push(`l."household_languages" && $${paramIndex++}::text[]`);
028531| NOTE: Implementation detail supporting search page behavior.
028532| src/lib/data.ts:1296:         queryParams.push(normalized);
028533| NOTE: Implementation detail supporting search page behavior.
028534| src/lib/data.ts:1297:       }
028535| NOTE: Implementation detail supporting search page behavior.
028536| src/lib/data.ts:1298:     }
028537| NOTE: Implementation detail supporting search page behavior.
028538| src/lib/data.ts:1299: 
028539| NOTE: Blank line for visual separation.
028540| src/lib/data.ts:1300:     // Amenities filter (SQL level) - AND logic: must have ALL selected amenities
028541| NOTE: Line comment documents intent or constraints.
028542| src/lib/data.ts:1301:     // Uses partial matching: UI sends 'Pool' but DB has 'Pool Access'
028543| NOTE: Line comment documents intent or constraints.
028544| src/lib/data.ts:1302:     // Checks that every search term matches at least one amenity via LIKE
028545| NOTE: Line comment documents intent or constraints.
028546| src/lib/data.ts:1303:     if (amenities?.length) {
028547| NOTE: Conditional logic controlling rendering or flow.
028548| src/lib/data.ts:1304:       const normalizedAmenities = amenities
028549| NOTE: Local declaration used by search logic or UI.
028550| src/lib/data.ts:1305:         .map((a) => a.trim().toLowerCase())
028551| NOTE: Implementation detail supporting search page behavior.
028552| src/lib/data.ts:1306:         .filter(Boolean);
028553| NOTE: Implementation detail supporting search page behavior.
028554| src/lib/data.ts:1307:       if (normalizedAmenities.length > 0) {
028555| NOTE: Conditional logic controlling rendering or flow.
028556| src/lib/data.ts:1308:         // For each search term, ensure at least one amenity contains it
028557| NOTE: Line comment documents intent or constraints.
028558| src/lib/data.ts:1309:         conditions.push(`NOT EXISTS (
028559| NOTE: Implementation detail supporting search page behavior.
028560| src/lib/data.ts:1310:                 SELECT 1 FROM unnest($${paramIndex++}::text[]) AS search_term
028561| NOTE: Implementation detail supporting search page behavior.
028562| src/lib/data.ts:1311:                 WHERE NOT EXISTS (
028563| NOTE: Implementation detail supporting search page behavior.
028564| src/lib/data.ts:1312:                     SELECT 1 FROM unnest(l.amenities) AS la
028565| NOTE: Implementation detail supporting search page behavior.
028566| src/lib/data.ts:1313:                     WHERE LOWER(la) LIKE '%' || search_term || '%'
028567| NOTE: Implementation detail supporting search page behavior.
028568| src/lib/data.ts:1314:                 )
028569| NOTE: Implementation detail supporting search page behavior.
028570| src/lib/data.ts:1315:             )`);
028571| NOTE: Implementation detail supporting search page behavior.
028572| src/lib/data.ts:1316:         queryParams.push(normalizedAmenities);
028573| NOTE: Implementation detail supporting search page behavior.
028574| src/lib/data.ts:1317:       }
028575| NOTE: Implementation detail supporting search page behavior.
028576| src/lib/data.ts:1318:     }
028577| NOTE: Implementation detail supporting search page behavior.
028578| src/lib/data.ts:1319: 
028579| NOTE: Blank line for visual separation.
028580| src/lib/data.ts:1320:     // House rules filter (SQL level) - AND logic: must have ALL selected house rules
028581| NOTE: Line comment documents intent or constraints.
028582| src/lib/data.ts:1321:     // Uses case-insensitive array containment with NULL safety
028583| NOTE: Line comment documents intent or constraints.
028584| src/lib/data.ts:1322:     if (houseRules?.length) {
028585| NOTE: Conditional logic controlling rendering or flow.
028586| src/lib/data.ts:1323:       const normalizedRules = houseRules
028587| NOTE: Local declaration used by search logic or UI.
028588| src/lib/data.ts:1324:         .map((r) => r.trim().toLowerCase())
028589| NOTE: Implementation detail supporting search page behavior.
028590| src/lib/data.ts:1325:         .filter(Boolean);
028591| NOTE: Implementation detail supporting search page behavior.
028592| src/lib/data.ts:1326:       if (normalizedRules.length > 0) {
028593| NOTE: Conditional logic controlling rendering or flow.
028594| src/lib/data.ts:1327:         conditions.push(
028595| NOTE: Implementation detail supporting search page behavior.
028596| src/lib/data.ts:1328:           `ARRAY(SELECT LOWER(x) FROM unnest(l."houseRules") AS x WHERE x IS NOT NULL) @> $${paramIndex++}::text[]`,
028597| NOTE: Implementation detail supporting search page behavior.
028598| src/lib/data.ts:1329:         );
028599| NOTE: Implementation detail supporting search page behavior.
028600| src/lib/data.ts:1330:         queryParams.push(normalizedRules);
028601| NOTE: Implementation detail supporting search page behavior.
028602| src/lib/data.ts:1331:       }
028603| NOTE: Implementation detail supporting search page behavior.
028604| src/lib/data.ts:1332:     }
028605| NOTE: Implementation detail supporting search page behavior.
028606| src/lib/data.ts:1333: 
028607| NOTE: Blank line for visual separation.
028608| src/lib/data.ts:1334:     const whereClause = conditions.join(" AND ");
028609| NOTE: Local declaration used by search logic or UI.
028610| src/lib/data.ts:1335: 
028611| NOTE: Blank line for visual separation.
028612| src/lib/data.ts:1336:     // Build ORDER BY clause based on sort option
028613| NOTE: Line comment documents intent or constraints.
028614| src/lib/data.ts:1337:     let orderByClause: string;
028615| NOTE: Local declaration used by search logic or UI.
028616| src/lib/data.ts:1338:     switch (sort) {
028617| NOTE: Implementation detail supporting search page behavior.
028618| src/lib/data.ts:1339:       case "price_asc":
028619| NOTE: Implementation detail supporting search page behavior.
028620| src/lib/data.ts:1340:         orderByClause = 'l.price ASC, l."createdAt" DESC';
028621| NOTE: Implementation detail supporting search page behavior.
028622| src/lib/data.ts:1341:         break;
028623| NOTE: Implementation detail supporting search page behavior.
028624| src/lib/data.ts:1342:       case "price_desc":
028625| NOTE: Implementation detail supporting search page behavior.
028626| src/lib/data.ts:1343:         orderByClause = 'l.price DESC, l."createdAt" DESC';
028627| NOTE: Implementation detail supporting search page behavior.
028628| src/lib/data.ts:1344:         break;
028629| NOTE: Implementation detail supporting search page behavior.
028630| src/lib/data.ts:1345:       case "newest":
028631| NOTE: Implementation detail supporting search page behavior.
028632| src/lib/data.ts:1346:         orderByClause = 'l."createdAt" DESC, l.id ASC';
028633| NOTE: Implementation detail supporting search page behavior.
028634| src/lib/data.ts:1347:         break;
028635| NOTE: Implementation detail supporting search page behavior.
028636| src/lib/data.ts:1348:       case "rating":
028637| NOTE: Implementation detail supporting search page behavior.
028638| src/lib/data.ts:1349:         orderByClause =
028639| NOTE: Implementation detail supporting search page behavior.
028640| src/lib/data.ts:1350:           'COALESCE(AVG(r.rating), 0) DESC, COUNT(r.id) DESC, l."createdAt" DESC';
028641| NOTE: Implementation detail supporting search page behavior.
028642| src/lib/data.ts:1351:         break;
028643| NOTE: Implementation detail supporting search page behavior.
028644| src/lib/data.ts:1352:       case "recommended":
028645| NOTE: Implementation detail supporting search page behavior.
028646| src/lib/data.ts:1353:       default:
028647| NOTE: Implementation detail supporting search page behavior.
028648| src/lib/data.ts:1354:         orderByClause =
028649| NOTE: Implementation detail supporting search page behavior.
028650| src/lib/data.ts:1355:           '(COALESCE(AVG(r.rating), 0) * 20 + l."viewCount" * 0.1 + COUNT(r.id) * 5) DESC, l."createdAt" DESC';
028651| NOTE: Implementation detail supporting search page behavior.
028652| src/lib/data.ts:1356:         break;
028653| NOTE: Implementation detail supporting search page behavior.
028654| src/lib/data.ts:1357:     }
028655| NOTE: Implementation detail supporting search page behavior.
028656| src/lib/data.ts:1358: 
028657| NOTE: Blank line for visual separation.
028658| src/lib/data.ts:1359:     // Hybrid pagination: Use getLimitedCount for efficient counting
028659| NOTE: Line comment documents intent or constraints.
028660| src/lib/data.ts:1360:     // Returns exact count if \u2264100, null if >100 (unknown)
028661| NOTE: Line comment documents intent or constraints.
028662| src/lib/data.ts:1361:     const limitedCount = await getLimitedCount(params);
028663| NOTE: Local declaration used by search logic or UI.
028664| src/lib/data.ts:1362: 
028665| NOTE: Blank line for visual separation.
028666| src/lib/data.ts:1363:     // Calculate pagination info based on hybrid count
028667| NOTE: Line comment documents intent or constraints.
028668| src/lib/data.ts:1364:     const total = limitedCount; // null means >100 results (unknown total)
028669| NOTE: Local declaration used by search logic or UI.
028670| src/lib/data.ts:1365:     const totalPages =
028671| NOTE: Local declaration used by search logic or UI.
028672| src/lib/data.ts:1366:       limitedCount !== null ? Math.ceil(limitedCount / limit) : null;
028673| NOTE: Implementation detail supporting search page behavior.
028674| src/lib/data.ts:1367: 
028675| NOTE: Blank line for visual separation.
028676| src/lib/data.ts:1368:     // For pages without exact total, allow navigation based on hasNextPage
028677| NOTE: Line comment documents intent or constraints.
028678| src/lib/data.ts:1369:     // For pages with exact total, clamp to valid range
028679| NOTE: Line comment documents intent or constraints.
028680| src/lib/data.ts:1370:     let safePage: number;
028681| NOTE: Local declaration used by search logic or UI.
028682| src/lib/data.ts:1371:     if (totalPages !== null) {
028683| NOTE: Conditional logic controlling rendering or flow.
028684| src/lib/data.ts:1372:       safePage = totalPages > 0 ? Math.max(1, Math.min(page, totalPages)) : 1;
028685| NOTE: Implementation detail supporting search page behavior.
028686| src/lib/data.ts:1373:     } else {
028687| NOTE: Implementation detail supporting search page behavior.
028688| src/lib/data.ts:1374:       // Without exact total, allow any page \u22651 (hasNextPage will correct if needed)
028689| NOTE: Line comment documents intent or constraints.
028690| src/lib/data.ts:1375:       safePage = Math.max(1, page);
028691| NOTE: Implementation detail supporting search page behavior.
028692| src/lib/data.ts:1376:     }
028693| NOTE: Implementation detail supporting search page behavior.
028694| src/lib/data.ts:1377:     const offset = (safePage - 1) * limit;
028695| NOTE: Local declaration used by search logic or UI.
028696| src/lib/data.ts:1378: 
028697| NOTE: Blank line for visual separation.
028698| src/lib/data.ts:1379:     // Fetch limit+1 items to determine hasNextPage
028699| NOTE: Line comment documents intent or constraints.
028700| src/lib/data.ts:1380:     const fetchLimit = limit + 1;
028701| NOTE: Local declaration used by search logic or UI.
028702| src/lib/data.ts:1381: 
028703| NOTE: Blank line for visual separation.
028704| src/lib/data.ts:1382:     // Execute main query with LIMIT/OFFSET
028705| NOTE: Line comment documents intent or constraints.
028706| src/lib/data.ts:1383:     const dataQuery = `
028707| NOTE: Local declaration used by search logic or UI.
028708| src/lib/data.ts:1384:         SELECT
028709| NOTE: Implementation detail supporting search page behavior.
028710| src/lib/data.ts:1385:             l.id,
028711| NOTE: Implementation detail supporting search page behavior.
028712| src/lib/data.ts:1386:             l.title,
028713| NOTE: Implementation detail supporting search page behavior.
028714| src/lib/data.ts:1387:             l.description,
028715| NOTE: Implementation detail supporting search page behavior.
028716| src/lib/data.ts:1388:             l.price,
028717| NOTE: Implementation detail supporting search page behavior.
028718| src/lib/data.ts:1389:             l.images,
028719| NOTE: Implementation detail supporting search page behavior.
028720| src/lib/data.ts:1390:             l."availableSlots",
028721| NOTE: Implementation detail supporting search page behavior.
028722| src/lib/data.ts:1391:             l."totalSlots",
028723| NOTE: Implementation detail supporting search page behavior.
028724| src/lib/data.ts:1392:             l.amenities,
028725| NOTE: Implementation detail supporting search page behavior.
028726| src/lib/data.ts:1393:             l."houseRules",
028727| NOTE: Implementation detail supporting search page behavior.
028728| src/lib/data.ts:1394:             l."household_languages",
028729| NOTE: Implementation detail supporting search page behavior.
028730| src/lib/data.ts:1395:             l."primary_home_language",
028731| NOTE: Implementation detail supporting search page behavior.
028732| src/lib/data.ts:1396:             l."leaseDuration",
028733| NOTE: Implementation detail supporting search page behavior.
028734| src/lib/data.ts:1397:             l."roomType",
028735| NOTE: Implementation detail supporting search page behavior.
028736| src/lib/data.ts:1398:             l."moveInDate",
028737| NOTE: Implementation detail supporting search page behavior.
028738| src/lib/data.ts:1399:             l."ownerId",
028739| NOTE: Implementation detail supporting search page behavior.
028740| src/lib/data.ts:1400:             l."createdAt",
028741| NOTE: Implementation detail supporting search page behavior.
028742| src/lib/data.ts:1401:             l."viewCount",
028743| NOTE: Implementation detail supporting search page behavior.
028744| src/lib/data.ts:1402:             loc.address,
028745| NOTE: Implementation detail supporting search page behavior.
028746| src/lib/data.ts:1403:             loc.city,
028747| NOTE: Implementation detail supporting search page behavior.
028748| src/lib/data.ts:1404:             loc.state,
028749| NOTE: Implementation detail supporting search page behavior.
028750| src/lib/data.ts:1405:             loc.zip,
028751| NOTE: Implementation detail supporting search page behavior.
028752| src/lib/data.ts:1406:             ST_X(loc.coords::geometry) as lng,
028753| NOTE: Implementation detail supporting search page behavior.
028754| src/lib/data.ts:1407:             ST_Y(loc.coords::geometry) as lat,
028755| NOTE: Implementation detail supporting search page behavior.
028756| src/lib/data.ts:1408:             COALESCE(AVG(r.rating), 0) as avg_rating,
028757| NOTE: Implementation detail supporting search page behavior.
028758| src/lib/data.ts:1409:             COUNT(r.id) as review_count
028759| NOTE: Implementation detail supporting search page behavior.
028760| src/lib/data.ts:1410:         FROM "Listing" l
028761| NOTE: Implementation detail supporting search page behavior.
028762| src/lib/data.ts:1411:         JOIN "Location" loc ON l.id = loc."listingId"
028763| NOTE: Implementation detail supporting search page behavior.
028764| src/lib/data.ts:1412:         LEFT JOIN "Review" r ON l.id = r."listingId"
028765| NOTE: Implementation detail supporting search page behavior.
028766| src/lib/data.ts:1413:         WHERE ${whereClause}
028767| NOTE: Implementation detail supporting search page behavior.
028768| src/lib/data.ts:1414:         GROUP BY l.id, loc.id
028769| NOTE: Implementation detail supporting search page behavior.
028770| src/lib/data.ts:1415:         ORDER BY ${orderByClause}
028771| NOTE: Implementation detail supporting search page behavior.
028772| src/lib/data.ts:1416:         LIMIT $${paramIndex++} OFFSET $${paramIndex++}
028773| NOTE: Implementation detail supporting search page behavior.
028774| src/lib/data.ts:1417:     `;
028775| NOTE: Implementation detail supporting search page behavior.
028776| src/lib/data.ts:1418: 
028777| NOTE: Blank line for visual separation.
028778| src/lib/data.ts:1419:     // Add fetchLimit (limit+1) and offset to params
028779| NOTE: Line comment documents intent or constraints.
028780| src/lib/data.ts:1420:     // We fetch one extra to detect hasNextPage
028781| NOTE: Line comment documents intent or constraints.
028782| src/lib/data.ts:1421:     const dataParams = [...queryParams, fetchLimit, offset];
028783| NOTE: Local declaration used by search logic or UI.
028784| src/lib/data.ts:1422: 
028785| NOTE: Blank line for visual separation.
028786| src/lib/data.ts:1423:     const listings = await prisma.$queryRawUnsafe<any[]>(
028787| NOTE: Local declaration used by search logic or UI.
028788| src/lib/data.ts:1424:       dataQuery,
028789| NOTE: Implementation detail supporting search page behavior.
028790| src/lib/data.ts:1425:       ...dataParams,
028791| NOTE: Implementation detail supporting search page behavior.
028792| src/lib/data.ts:1426:     );
028793| NOTE: Implementation detail supporting search page behavior.
028794| src/lib/data.ts:1427: 
028795| NOTE: Blank line for visual separation.
028796| src/lib/data.ts:1428:     // Map results and apply JS-level filters for amenities/house rules/languages
028797| NOTE: Line comment documents intent or constraints.
028798| src/lib/data.ts:1429:     const results = listings.map((l) => ({
028799| NOTE: Local declaration used by search logic or UI.
028800| src/lib/data.ts:1430:       id: l.id,
028801| NOTE: Implementation detail supporting search page behavior.
028802| src/lib/data.ts:1431:       title: l.title,
028803| NOTE: Implementation detail supporting search page behavior.
028804| src/lib/data.ts:1432:       description: l.description,
028805| NOTE: Implementation detail supporting search page behavior.
028806| src/lib/data.ts:1433:       price: Number(l.price),
028807| NOTE: Implementation detail supporting search page behavior.
028808| src/lib/data.ts:1434:       images: l.images || [],
028809| NOTE: Implementation detail supporting search page behavior.
028810| src/lib/data.ts:1435:       availableSlots: l.availableSlots,
028811| NOTE: Implementation detail supporting search page behavior.
028812| src/lib/data.ts:1436:       totalSlots: l.totalSlots,
028813| NOTE: Implementation detail supporting search page behavior.
028814| src/lib/data.ts:1437:       amenities: l.amenities || [],
028815| NOTE: Implementation detail supporting search page behavior.
028816| src/lib/data.ts:1438:       houseRules: l.houseRules || [],
028817| NOTE: Implementation detail supporting search page behavior.
028818| src/lib/data.ts:1439:       householdLanguages: l.household_languages || [],
028819| NOTE: Implementation detail supporting search page behavior.
028820| src/lib/data.ts:1440:       primaryHomeLanguage: l.primary_home_language,
028821| NOTE: Implementation detail supporting search page behavior.
028822| src/lib/data.ts:1441:       leaseDuration: l.leaseDuration,
028823| NOTE: Implementation detail supporting search page behavior.
028824| src/lib/data.ts:1442:       roomType: l.roomType,
028825| NOTE: Implementation detail supporting search page behavior.
028826| src/lib/data.ts:1443:       moveInDate: l.moveInDate ? new Date(l.moveInDate) : undefined,
028827| NOTE: Implementation detail supporting search page behavior.
028828| src/lib/data.ts:1444:       ownerId: l.ownerId,
028829| NOTE: Implementation detail supporting search page behavior.
028830| src/lib/data.ts:1445:       createdAt: l.createdAt ? new Date(l.createdAt) : new Date(),
028831| NOTE: Implementation detail supporting search page behavior.
028832| src/lib/data.ts:1446:       viewCount: Number(l.viewCount) || 0,
028833| NOTE: Implementation detail supporting search page behavior.
028834| src/lib/data.ts:1447:       avgRating: Number(l.avg_rating) || 0,
028835| NOTE: Implementation detail supporting search page behavior.
028836| src/lib/data.ts:1448:       reviewCount: Number(l.review_count) || 0,
028837| NOTE: Implementation detail supporting search page behavior.
028838| src/lib/data.ts:1449:       location: {
028839| NOTE: Implementation detail supporting search page behavior.
028840| src/lib/data.ts:1450:         address: l.address,
028841| NOTE: Implementation detail supporting search page behavior.
028842| src/lib/data.ts:1451:         city: l.city,
028843| NOTE: Implementation detail supporting search page behavior.
028844| src/lib/data.ts:1452:         state: l.state,
028845| NOTE: Implementation detail supporting search page behavior.
028846| src/lib/data.ts:1453:         zip: l.zip,
028847| NOTE: Implementation detail supporting search page behavior.
028848| src/lib/data.ts:1454:         lat: Number(l.lat) || 0,
028849| NOTE: Implementation detail supporting search page behavior.
028850| src/lib/data.ts:1455:         lng: Number(l.lng) || 0,
028851| NOTE: Implementation detail supporting search page behavior.
028852| src/lib/data.ts:1456:       },
028853| NOTE: Implementation detail supporting search page behavior.
028854| src/lib/data.ts:1457:     }));
028855| NOTE: Implementation detail supporting search page behavior.
028856| src/lib/data.ts:1458: 
028857| NOTE: Blank line for visual separation.
028858| src/lib/data.ts:1459:     // All filters are now applied at SQL level for accurate pagination counts:
028859| NOTE: Line comment documents intent or constraints.
028860| src/lib/data.ts:1460:     // - Languages: GIN index with && operator (OR logic)
028861| NOTE: Line comment documents intent or constraints.
028862| src/lib/data.ts:1461:     // - Amenities: Case-insensitive array containment with @> operator (AND logic)
028863| NOTE: Line comment documents intent or constraints.
028864| src/lib/data.ts:1462:     // - House rules: Case-insensitive array containment with @> operator (AND logic)
028865| NOTE: Line comment documents intent or constraints.
028866| src/lib/data.ts:1463: 
028867| NOTE: Blank line for visual separation.
028868| src/lib/data.ts:1464:     // Determine hasNextPage using limit+1 pattern
028869| NOTE: Line comment documents intent or constraints.
028870| src/lib/data.ts:1465:     const hasNextPage = results.length > limit;
028871| NOTE: Local declaration used by search logic or UI.
028872| src/lib/data.ts:1466: 
028873| NOTE: Blank line for visual separation.
028874| src/lib/data.ts:1467:     // Only return `limit` items (not the extra one used for detection)
028875| NOTE: Line comment documents intent or constraints.
028876| src/lib/data.ts:1468:     let items: ListingData[] = hasNextPage ? results.slice(0, limit) : results;
028877| NOTE: Local declaration used by search logic or UI.
028878| src/lib/data.ts:1469: 
028879| NOTE: Blank line for visual separation.
028880| src/lib/data.ts:1470:     // Near-match expansion: if enabled and low results on page 1, fetch near matches
028881| NOTE: Line comment documents intent or constraints.
028882| src/lib/data.ts:1471:     let nearMatchCount = 0;
028883| NOTE: Local declaration used by search logic or UI.
028884| src/lib/data.ts:1472:     let nearMatchExpansion: string | undefined;
028885| NOTE: Local declaration used by search logic or UI.
028886| src/lib/data.ts:1473: 
028887| NOTE: Blank line for visual separation.
028888| src/lib/data.ts:1474:     if (
028889| NOTE: Conditional logic controlling rendering or flow.
028890| src/lib/data.ts:1475:       nearMatches &&
028891| NOTE: Implementation detail supporting search page behavior.
028892| src/lib/data.ts:1476:       items.length < LOW_RESULTS_THRESHOLD &&
028893| NOTE: Implementation detail supporting search page behavior.
028894| src/lib/data.ts:1477:       items.length > 0 &&
028895| NOTE: Implementation detail supporting search page behavior.
028896| src/lib/data.ts:1478:       safePage === 1 // Only expand on first page
028897| NOTE: Implementation detail supporting search page behavior.
028898| src/lib/data.ts:1479:     ) {
028899| NOTE: Implementation detail supporting search page behavior.
028900| src/lib/data.ts:1480:       const expansion = expandFiltersForNearMatches(params);
028901| NOTE: Local declaration used by search logic or UI.
028902| src/lib/data.ts:1481: 
028903| NOTE: Blank line for visual separation.
028904| src/lib/data.ts:1482:       if (expansion.expandedDimension !== null) {
028905| NOTE: Conditional logic controlling rendering or flow.
028906| src/lib/data.ts:1483:         nearMatchExpansion = expansion.expansionDescription ?? undefined;
028907| NOTE: Implementation detail supporting search page behavior.
028908| src/lib/data.ts:1484: 
028909| NOTE: Blank line for visual separation.
028910| src/lib/data.ts:1485:         // Run expanded query (without nearMatches flag to prevent recursion)
028911| NOTE: Line comment documents intent or constraints.
028912| src/lib/data.ts:1486:         const expandedResult = await getListingsPaginatedInternal({
028913| NOTE: Local declaration used by search logic or UI.
028914| src/lib/data.ts:1487:           ...expansion.expanded,
028915| NOTE: Implementation detail supporting search page behavior.
028916| src/lib/data.ts:1488:           nearMatches: false, // Prevent infinite recursion
028917| NOTE: Implementation detail supporting search page behavior.
028918| src/lib/data.ts:1489:           page: 1,
028919| NOTE: Implementation detail supporting search page behavior.
028920| src/lib/data.ts:1490:           limit: LOW_RESULTS_THRESHOLD * 2, // Fetch enough to find near matches
028921| NOTE: Implementation detail supporting search page behavior.
028922| src/lib/data.ts:1491:         });
028923| NOTE: Implementation detail supporting search page behavior.
028924| src/lib/data.ts:1492: 
028925| NOTE: Blank line for visual separation.
028926| src/lib/data.ts:1493:         // Get IDs of exact matches to dedupe
028927| NOTE: Line comment documents intent or constraints.
028928| src/lib/data.ts:1494:         const exactIds = new Set(items.map((item) => item.id));
028929| NOTE: Local declaration used by search logic or UI.
028930| src/lib/data.ts:1495: 
028931| NOTE: Blank line for visual separation.
028932| src/lib/data.ts:1496:         // Filter to only near matches (not in exact results) and tag them
028933| NOTE: Line comment documents intent or constraints.
028934| src/lib/data.ts:1497:         const nearMatchItems = expandedResult.items
028935| NOTE: Local declaration used by search logic or UI.
028936| src/lib/data.ts:1498:           .filter((item) => !exactIds.has(item.id))
028937| NOTE: Implementation detail supporting search page behavior.
028938| src/lib/data.ts:1499:           .slice(0, LOW_RESULTS_THRESHOLD) // Limit near matches
028939| NOTE: Implementation detail supporting search page behavior.
028940| src/lib/data.ts:1500:           .map((item) => {
028941| NOTE: Implementation detail supporting search page behavior.
028942| src/lib/data.ts:1501:             // Check if this item is a true near match (outside original filter range)
028943| NOTE: Line comment documents intent or constraints.
028944| src/lib/data.ts:1502:             const availableFromStr = item.moveInDate
028945| NOTE: Local declaration used by search logic or UI.
028946| src/lib/data.ts:1503:               ? item.moveInDate.toISOString().split("T")[0]
028947| NOTE: Implementation detail supporting search page behavior.
028948| src/lib/data.ts:1504:               : null;
028949| NOTE: Implementation detail supporting search page behavior.
028950| src/lib/data.ts:1505:             const isNearMatchResult = isNearMatch(
028951| NOTE: Local declaration used by search logic or UI.
028952| src/lib/data.ts:1506:               { price: item.price, available_from: availableFromStr },
028953| NOTE: Implementation detail supporting search page behavior.
028954| src/lib/data.ts:1507:               params,
028955| NOTE: Implementation detail supporting search page behavior.
028956| src/lib/data.ts:1508:               expansion.expandedDimension,
028957| NOTE: Implementation detail supporting search page behavior.
028958| src/lib/data.ts:1509:             );
028959| NOTE: Implementation detail supporting search page behavior.
028960| src/lib/data.ts:1510:             return {
028961| NOTE: Return statement for component or helper output.
028962| src/lib/data.ts:1511:               ...item,
028963| NOTE: Implementation detail supporting search page behavior.
028964| src/lib/data.ts:1512:               isNearMatch: isNearMatchResult,
028965| NOTE: Implementation detail supporting search page behavior.
028966| src/lib/data.ts:1513:             };
028967| NOTE: Implementation detail supporting search page behavior.
028968| src/lib/data.ts:1514:           })
028969| NOTE: Implementation detail supporting search page behavior.
028970| src/lib/data.ts:1515:           .filter((item) => item.isNearMatch); // Only keep actual near matches
028971| NOTE: Implementation detail supporting search page behavior.
028972| src/lib/data.ts:1516: 
028973| NOTE: Blank line for visual separation.
028974| src/lib/data.ts:1517:         nearMatchCount = nearMatchItems.length;
028975| NOTE: Implementation detail supporting search page behavior.
028976| src/lib/data.ts:1518: 
028977| NOTE: Blank line for visual separation.
028978| src/lib/data.ts:1519:         // Merge results: exact matches first, then near matches
028979| NOTE: Line comment documents intent or constraints.
028980| src/lib/data.ts:1520:         items = [...items, ...nearMatchItems];
028981| NOTE: Implementation detail supporting search page behavior.
028982| src/lib/data.ts:1521:       }
028983| NOTE: Implementation detail supporting search page behavior.
028984| src/lib/data.ts:1522:     }
028985| NOTE: Implementation detail supporting search page behavior.
028986| src/lib/data.ts:1523: 
028987| NOTE: Blank line for visual separation.
028988| src/lib/data.ts:1524:     return {
028989| NOTE: Return statement for component or helper output.
028990| src/lib/data.ts:1525:       items,
028991| NOTE: Implementation detail supporting search page behavior.
028992| src/lib/data.ts:1526:       total,
028993| NOTE: Implementation detail supporting search page behavior.
028994| src/lib/data.ts:1527:       totalPages,
028995| NOTE: Implementation detail supporting search page behavior.
028996| src/lib/data.ts:1528:       hasNextPage,
028997| NOTE: Implementation detail supporting search page behavior.
028998| src/lib/data.ts:1529:       hasPrevPage: safePage > 1,
028999| NOTE: Implementation detail supporting search page behavior.
029000| src/lib/data.ts:1530:       page: safePage,
029001| NOTE: Implementation detail supporting search page behavior.
029002| src/lib/data.ts:1531:       limit,
029003| NOTE: Implementation detail supporting search page behavior.
029004| src/lib/data.ts:1532:       nearMatchCount: nearMatchCount > 0 ? nearMatchCount : undefined,
029005| NOTE: Implementation detail supporting search page behavior.
029006| src/lib/data.ts:1533:       nearMatchExpansion,
029007| NOTE: Implementation detail supporting search page behavior.
029008| src/lib/data.ts:1534:     };
029009| NOTE: Implementation detail supporting search page behavior.
029010| src/lib/data.ts:1535:   } catch (error) {
029011| NOTE: Implementation detail supporting search page behavior.
029012| src/lib/data.ts:1536:     const dataError = wrapDatabaseError(error, "getListingsPaginated");
029013| NOTE: Local declaration used by search logic or UI.
029014| src/lib/data.ts:1537:     dataError.log({
029015| NOTE: Implementation detail supporting search page behavior.
029016| src/lib/data.ts:1538:       operation: "getListingsPaginated",
029017| NOTE: Implementation detail supporting search page behavior.
029018| src/lib/data.ts:1539:       hasQuery: !!params.query,
029019| NOTE: Implementation detail supporting search page behavior.
029020| src/lib/data.ts:1540:       hasBounds: !!params.bounds,
029021| NOTE: Implementation detail supporting search page behavior.
029022| src/lib/data.ts:1541:       page: params.page,
029023| NOTE: Implementation detail supporting search page behavior.
029024| src/lib/data.ts:1542:       sortOption: params.sort,
029025| NOTE: Implementation detail supporting search page behavior.
029026| src/lib/data.ts:1543:     });
029027| NOTE: Implementation detail supporting search page behavior.
029028| src/lib/data.ts:1544:     throw dataError;
029029| NOTE: Implementation detail supporting search page behavior.
029030| src/lib/data.ts:1545:   }
029031| NOTE: Implementation detail supporting search page behavior.
029032| src/lib/data.ts:1546: }
029033| NOTE: Implementation detail supporting search page behavior.
029034| src/lib/data.ts:1547: 
029035| NOTE: Blank line for visual separation.
029036| src/lib/data.ts:1548: // ============================================
029037| NOTE: Line comment documents intent or constraints.
029038| src/lib/data.ts:1549: // Keyset (Cursor-Based) Pagination
029039| NOTE: Line comment documents intent or constraints.
029040| src/lib/data.ts:1550: // ============================================
029041| NOTE: Line comment documents intent or constraints.
029042| src/lib/data.ts:1551: 
029043| NOTE: Blank line for visual separation.
029044| src/lib/data.ts:1552: /**
029045| NOTE: Block comment line describing behavior or context.
029046| src/lib/data.ts:1553:  * Extended filter params for keyset pagination.
029047| NOTE: Block comment line describing behavior or context.
029048| src/lib/data.ts:1554:  * Adds cursor support for stable sorts (newest, price_asc, price_desc).
029049| NOTE: Block comment line describing behavior or context.
029050| src/lib/data.ts:1555:  */
029051| NOTE: Block comment line describing behavior or context.
029052| src/lib/data.ts:1556: export interface KeysetFilterParams extends FilterParams {
029053| NOTE: Implementation detail supporting search page behavior.
029054| src/lib/data.ts:1557:   /** Encoded cursor from previous page (base64url) */
029055| NOTE: Block comment line describing behavior or context.
029056| src/lib/data.ts:1558:   cursor?: string;
029057| NOTE: Implementation detail supporting search page behavior.
029058| src/lib/data.ts:1559: }
029059| NOTE: Implementation detail supporting search page behavior.
029060| src/lib/data.ts:1560: 
029061| NOTE: Blank line for visual separation.
029062| src/lib/data.ts:1561: /**
029063| NOTE: Block comment line describing behavior or context.
029064| src/lib/data.ts:1562:  * Cache key generator for keyset pagination.
029065| NOTE: Block comment line describing behavior or context.
029066| src/lib/data.ts:1563:  * NOTE: Cursor is NOT included in cache key - each cursor position is unique.
029067| NOTE: Block comment line describing behavior or context.
029068| src/lib/data.ts:1564:  * We cache by filter params only, cursor determines starting position.
029069| NOTE: Block comment line describing behavior or context.
029070| src/lib/data.ts:1565:  */
029071| NOTE: Block comment line describing behavior or context.
029072| src/lib/data.ts:1566: function createKeysetCacheKey(params: KeysetFilterParams): string {
029073| NOTE: Defines a helper or component function.
029074| src/lib/data.ts:1567:   const normalized = {
029075| NOTE: Local declaration used by search logic or UI.
029076| src/lib/data.ts:1568:     q: params.query?.toLowerCase().trim() || "",
029077| NOTE: Implementation detail supporting search page behavior.
029078| src/lib/data.ts:1569:     minPrice: params.minPrice ?? "",
029079| NOTE: Implementation detail supporting search page behavior.
029080| src/lib/data.ts:1570:     maxPrice: params.maxPrice ?? "",
029081| NOTE: Implementation detail supporting search page behavior.
029082| src/lib/data.ts:1571:     amenities: [...(params.amenities || [])].sort().join(","),
029083| NOTE: Implementation detail supporting search page behavior.
029084| src/lib/data.ts:1572:     houseRules: [...(params.houseRules || [])].sort().join(","),
029085| NOTE: Implementation detail supporting search page behavior.
029086| src/lib/data.ts:1573:     languages: [...(params.languages || [])].sort().join(","),
029087| NOTE: Implementation detail supporting search page behavior.
029088| src/lib/data.ts:1574:     roomType: params.roomType?.toLowerCase() || "",
029089| NOTE: Implementation detail supporting search page behavior.
029090| src/lib/data.ts:1575:     leaseDuration: params.leaseDuration?.toLowerCase() || "",
029091| NOTE: Implementation detail supporting search page behavior.
029092| src/lib/data.ts:1576:     moveInDate: params.moveInDate || "",
029093| NOTE: Implementation detail supporting search page behavior.
029094| src/lib/data.ts:1577:     bounds: params.bounds
029095| NOTE: Implementation detail supporting search page behavior.
029096| src/lib/data.ts:1578:       ? `${params.bounds.minLng.toFixed(4)},${params.bounds.minLat.toFixed(4)},${params.bounds.maxLng.toFixed(4)},${params.bounds.maxLat.toFixed(4)}`
029097| NOTE: Implementation detail supporting search page behavior.
029098| src/lib/data.ts:1579:       : "",
029099| NOTE: Implementation detail supporting search page behavior.
029100| src/lib/data.ts:1580:     limit: params.limit ?? 12,
029101| NOTE: Implementation detail supporting search page behavior.
029102| src/lib/data.ts:1581:     sort: params.sort || "newest",
029103| NOTE: Implementation detail supporting search page behavior.
029104| src/lib/data.ts:1582:     // Cursor is unique per request, included here for cache differentiation
029105| NOTE: Line comment documents intent or constraints.
029106| src/lib/data.ts:1583:     cursor: params.cursor || "",
029107| NOTE: Implementation detail supporting search page behavior.
029108| src/lib/data.ts:1584:   };
029109| NOTE: Implementation detail supporting search page behavior.
029110| src/lib/data.ts:1585:   return JSON.stringify(normalized);
029111| NOTE: Return statement for component or helper output.
029112| src/lib/data.ts:1586: }
029113| NOTE: Implementation detail supporting search page behavior.
029114| src/lib/data.ts:1587: 
029115| NOTE: Blank line for visual separation.
029116| src/lib/data.ts:1588: /**
029117| NOTE: Block comment line describing behavior or context.
029118| src/lib/data.ts:1589:  * Keyset-paginated listings query for stable sorts.
029119| NOTE: Block comment line describing behavior or context.
029120| src/lib/data.ts:1590:  *
029121| NOTE: Block comment line describing behavior or context.
029122| src/lib/data.ts:1591:  * Uses cursor-based pagination for deterministic results:
029123| NOTE: Block comment line describing behavior or context.
029124| src/lib/data.ts:1592:  * - No duplicate items across pages (unlike OFFSET which shifts on inserts)
029125| NOTE: Block comment line describing behavior or context.
029126| src/lib/data.ts:1593:  * - Efficient queries without OFFSET performance degradation
029127| NOTE: Block comment line describing behavior or context.
029128| src/lib/data.ts:1594:  * - Only works with keyset-eligible sorts: newest, price_asc, price_desc
029129| NOTE: Block comment line describing behavior or context.
029130| src/lib/data.ts:1595:  *
029131| NOTE: Block comment line describing behavior or context.
029132| src/lib/data.ts:1596:  * @param params Filter params including optional cursor
029133| NOTE: Block comment line describing behavior or context.
029134| src/lib/data.ts:1597:  * @returns Keyset-paginated result with next cursor
029135| NOTE: Block comment line describing behavior or context.
029136| src/lib/data.ts:1598:  *
029137| NOTE: Block comment line describing behavior or context.
029138| src/lib/data.ts:1599:  * @example
029139| NOTE: Block comment line describing behavior or context.
029140| src/lib/data.ts:1600:  * ```ts
029141| NOTE: Block comment line describing behavior or context.
029142| src/lib/data.ts:1601:  * // First page
029143| NOTE: Block comment line describing behavior or context.
029144| src/lib/data.ts:1602:  * const page1 = await getListingsKeysetPaginated({ sort: "newest", limit: 12 });
029145| NOTE: Block comment line describing behavior or context.
029146| src/lib/data.ts:1603:  *
029147| NOTE: Block comment line describing behavior or context.
029148| src/lib/data.ts:1604:  * // Next page using cursor
029149| NOTE: Block comment line describing behavior or context.
029150| src/lib/data.ts:1605:  * const page2 = await getListingsKeysetPaginated({
029151| NOTE: Block comment line describing behavior or context.
029152| src/lib/data.ts:1606:  *   sort: "newest",
029153| NOTE: Block comment line describing behavior or context.
029154| src/lib/data.ts:1607:  *   limit: 12,
029155| NOTE: Block comment line describing behavior or context.
029156| src/lib/data.ts:1608:  *   cursor: page1.nextCursor
029157| NOTE: Block comment line describing behavior or context.
029158| src/lib/data.ts:1609:  * });
029159| NOTE: Block comment line describing behavior or context.
029160| src/lib/data.ts:1610:  * ```
029161| NOTE: Block comment line describing behavior or context.
029162| src/lib/data.ts:1611:  */
029163| NOTE: Block comment line describing behavior or context.
029164| src/lib/data.ts:1612: export async function getListingsKeysetPaginated(
029165| NOTE: Implementation detail supporting search page behavior.
029166| src/lib/data.ts:1613:   params: KeysetFilterParams = {},
029167| NOTE: Implementation detail supporting search page behavior.
029168| src/lib/data.ts:1614: ): Promise<KeysetPaginatedResult<ListingData>> {
029169| NOTE: Implementation detail supporting search page behavior.
029170| src/lib/data.ts:1615:   const sort = (params.sort as KeysetSort) || "newest";
029171| NOTE: Local declaration used by search logic or UI.
029172| src/lib/data.ts:1616: 
029173| NOTE: Blank line for visual separation.
029174| src/lib/data.ts:1617:   // Validate sort is keyset-eligible
029175| NOTE: Line comment documents intent or constraints.
029176| src/lib/data.ts:1618:   if (!isKeysetEligible(sort)) {
029177| NOTE: Conditional logic controlling rendering or flow.
029178| src/lib/data.ts:1619:     throw new Error(
029179| NOTE: Implementation detail supporting search page behavior.
029180| src/lib/data.ts:1620:       `Sort "${sort}" is not keyset-eligible. Use getListingsPaginated for offset pagination.`,
029181| NOTE: Implementation detail supporting search page behavior.
029182| src/lib/data.ts:1621:     );
029183| NOTE: Implementation detail supporting search page behavior.
029184| src/lib/data.ts:1622:   }
029185| NOTE: Implementation detail supporting search page behavior.
029186| src/lib/data.ts:1623: 
029187| NOTE: Blank line for visual separation.
029188| src/lib/data.ts:1624:   const cacheKey = createKeysetCacheKey({ ...params, sort });
029189| NOTE: Local declaration used by search logic or UI.
029190| src/lib/data.ts:1625: 
029191| NOTE: Blank line for visual separation.
029192| src/lib/data.ts:1626:   const cachedFn = unstable_cache(
029193| NOTE: Local declaration used by search logic or UI.
029194| src/lib/data.ts:1627:     async () => getListingsKeysetPaginatedInternal({ ...params, sort }),
029195| NOTE: Implementation detail supporting search page behavior.
029196| src/lib/data.ts:1628:     ["listings-keyset", cacheKey],
029197| NOTE: Implementation detail supporting search page behavior.
029198| src/lib/data.ts:1629:     { revalidate: 60 },
029199| NOTE: Implementation detail supporting search page behavior.
029200| src/lib/data.ts:1630:   );
029201| NOTE: Implementation detail supporting search page behavior.
029202| src/lib/data.ts:1631: 
029203| NOTE: Blank line for visual separation.
029204| src/lib/data.ts:1632:   return cachedFn();
029205| NOTE: Return statement for component or helper output.
029206| src/lib/data.ts:1633: }
029207| NOTE: Implementation detail supporting search page behavior.
029208| src/lib/data.ts:1634: 
029209| NOTE: Blank line for visual separation.
029210| src/lib/data.ts:1635: /**
029211| NOTE: Block comment line describing behavior or context.
029212| src/lib/data.ts:1636:  * Internal implementation of keyset pagination.
029213| NOTE: Block comment line describing behavior or context.
029214| src/lib/data.ts:1637:  * Builds cursor-based WHERE clauses for efficient pagination.
029215| NOTE: Block comment line describing behavior or context.
029216| src/lib/data.ts:1638:  */
029217| NOTE: Block comment line describing behavior or context.
029218| src/lib/data.ts:1639: async function getListingsKeysetPaginatedInternal(
029219| NOTE: Implementation detail supporting search page behavior.
029220| src/lib/data.ts:1640:   params: KeysetFilterParams = {},
029221| NOTE: Implementation detail supporting search page behavior.
029222| src/lib/data.ts:1641: ): Promise<KeysetPaginatedResult<ListingData>> {
029223| NOTE: Implementation detail supporting search page behavior.
029224| src/lib/data.ts:1642:   const {
029225| NOTE: Local declaration used by search logic or UI.
029226| src/lib/data.ts:1643:     query,
029227| NOTE: Implementation detail supporting search page behavior.
029228| src/lib/data.ts:1644:     minPrice,
029229| NOTE: Implementation detail supporting search page behavior.
029230| src/lib/data.ts:1645:     maxPrice,
029231| NOTE: Implementation detail supporting search page behavior.
029232| src/lib/data.ts:1646:     amenities,
029233| NOTE: Implementation detail supporting search page behavior.
029234| src/lib/data.ts:1647:     moveInDate,
029235| NOTE: Implementation detail supporting search page behavior.
029236| src/lib/data.ts:1648:     leaseDuration,
029237| NOTE: Implementation detail supporting search page behavior.
029238| src/lib/data.ts:1649:     houseRules,
029239| NOTE: Implementation detail supporting search page behavior.
029240| src/lib/data.ts:1650:     roomType,
029241| NOTE: Implementation detail supporting search page behavior.
029242| src/lib/data.ts:1651:     languages,
029243| NOTE: Implementation detail supporting search page behavior.
029244| src/lib/data.ts:1652:     bounds,
029245| NOTE: Implementation detail supporting search page behavior.
029246| src/lib/data.ts:1653:     sort = "newest",
029247| NOTE: Implementation detail supporting search page behavior.
029248| src/lib/data.ts:1654:     cursor,
029249| NOTE: Implementation detail supporting search page behavior.
029250| src/lib/data.ts:1655:     limit = 12,
029251| NOTE: Implementation detail supporting search page behavior.
029252| src/lib/data.ts:1656:   } = params;
029253| NOTE: Implementation detail supporting search page behavior.
029254| src/lib/data.ts:1657: 
029255| NOTE: Blank line for visual separation.
029256| src/lib/data.ts:1658:   // Validate and decode cursor if provided
029257| NOTE: Line comment documents intent or constraints.
029258| src/lib/data.ts:1659:   let cursorData = cursor ? decodeCursor(cursor) : null;
029259| NOTE: Local declaration used by search logic or UI.
029260| src/lib/data.ts:1660: 
029261| NOTE: Blank line for visual separation.
029262| src/lib/data.ts:1661:   // Validate cursor matches current sort
029263| NOTE: Line comment documents intent or constraints.
029264| src/lib/data.ts:1662:   if (cursorData && cursorData.sort !== sort) {
029265| NOTE: Conditional logic controlling rendering or flow.
029266| src/lib/data.ts:1663:     // Cursor sort mismatch - ignore cursor and start from beginning
029267| NOTE: Line comment documents intent or constraints.
029268| src/lib/data.ts:1664:     cursorData = null;
029269| NOTE: Implementation detail supporting search page behavior.
029270| src/lib/data.ts:1665:   }
029271| NOTE: Implementation detail supporting search page behavior.
029272| src/lib/data.ts:1666: 
029273| NOTE: Blank line for visual separation.
029274| src/lib/data.ts:1667:   try {
029275| NOTE: Implementation detail supporting search page behavior.
029276| src/lib/data.ts:1668:     // Build dynamic WHERE conditions for SQL
029277| NOTE: Line comment documents intent or constraints.
029278| src/lib/data.ts:1669:     const conditions: string[] = [
029279| NOTE: Local declaration used by search logic or UI.
029280| src/lib/data.ts:1670:       'l."availableSlots" > 0',
029281| NOTE: Implementation detail supporting search page behavior.
029282| src/lib/data.ts:1671:       "l.status = 'ACTIVE'",
029283| NOTE: Implementation detail supporting search page behavior.
029284| src/lib/data.ts:1672:       "ST_X(loc.coords::geometry) IS NOT NULL",
029285| NOTE: Implementation detail supporting search page behavior.
029286| src/lib/data.ts:1673:       "ST_Y(loc.coords::geometry) IS NOT NULL",
029287| NOTE: Implementation detail supporting search page behavior.
029288| src/lib/data.ts:1674:       "NOT (ST_X(loc.coords::geometry) = 0 AND ST_Y(loc.coords::geometry) = 0)",
029289| NOTE: Implementation detail supporting search page behavior.
029290| src/lib/data.ts:1675:       "ST_Y(loc.coords::geometry) BETWEEN -90 AND 90",
029291| NOTE: Implementation detail supporting search page behavior.
029292| src/lib/data.ts:1676:       "ST_X(loc.coords::geometry) BETWEEN -180 AND 180",
029293| NOTE: Implementation detail supporting search page behavior.
029294| src/lib/data.ts:1677:     ];
029295| NOTE: Implementation detail supporting search page behavior.
029296| src/lib/data.ts:1678:     const queryParams: unknown[] = [];
029297| NOTE: Local declaration used by search logic or UI.
029298| src/lib/data.ts:1679:     let paramIndex = 1;
029299| NOTE: Local declaration used by search logic or UI.
029300| src/lib/data.ts:1680: 
029301| NOTE: Blank line for visual separation.
029302| src/lib/data.ts:1681:     // Geographic bounds filter with antimeridian support
029303| NOTE: Line comment documents intent or constraints.
029304| src/lib/data.ts:1682:     if (bounds) {
029305| NOTE: Conditional logic controlling rendering or flow.
029306| src/lib/data.ts:1683:       conditions.push(`ST_Y(loc.coords::geometry) >= $${paramIndex++}`);
029307| NOTE: Implementation detail supporting search page behavior.
029308| src/lib/data.ts:1684:       queryParams.push(bounds.minLat);
029309| NOTE: Implementation detail supporting search page behavior.
029310| src/lib/data.ts:1685:       conditions.push(`ST_Y(loc.coords::geometry) <= $${paramIndex++}`);
029311| NOTE: Implementation detail supporting search page behavior.
029312| src/lib/data.ts:1686:       queryParams.push(bounds.maxLat);
029313| NOTE: Implementation detail supporting search page behavior.
029314| src/lib/data.ts:1687: 
029315| NOTE: Blank line for visual separation.
029316| src/lib/data.ts:1688:       if (crossesAntimeridian(bounds.minLng, bounds.maxLng)) {
029317| NOTE: Conditional logic controlling rendering or flow.
029318| src/lib/data.ts:1689:         conditions.push(
029319| NOTE: Implementation detail supporting search page behavior.
029320| src/lib/data.ts:1690:           `(ST_X(loc.coords::geometry) >= $${paramIndex++} OR ST_X(loc.coords::geometry) <= $${paramIndex++})`,
029321| NOTE: Implementation detail supporting search page behavior.
029322| src/lib/data.ts:1691:         );
029323| NOTE: Implementation detail supporting search page behavior.
029324| src/lib/data.ts:1692:         queryParams.push(bounds.minLng);
029325| NOTE: Implementation detail supporting search page behavior.
029326| src/lib/data.ts:1693:         queryParams.push(bounds.maxLng);
029327| NOTE: Implementation detail supporting search page behavior.
029328| src/lib/data.ts:1694:       } else {
029329| NOTE: Implementation detail supporting search page behavior.
029330| src/lib/data.ts:1695:         conditions.push(`ST_X(loc.coords::geometry) >= $${paramIndex++}`);
029331| NOTE: Implementation detail supporting search page behavior.
029332| src/lib/data.ts:1696:         queryParams.push(bounds.minLng);
029333| NOTE: Implementation detail supporting search page behavior.
029334| src/lib/data.ts:1697:         conditions.push(`ST_X(loc.coords::geometry) <= $${paramIndex++}`);
029335| NOTE: Implementation detail supporting search page behavior.
029336| src/lib/data.ts:1698:         queryParams.push(bounds.maxLng);
029337| NOTE: Implementation detail supporting search page behavior.
029338| src/lib/data.ts:1699:       }
029339| NOTE: Implementation detail supporting search page behavior.
029340| src/lib/data.ts:1700:     }
029341| NOTE: Implementation detail supporting search page behavior.
029342| src/lib/data.ts:1701: 
029343| NOTE: Blank line for visual separation.
029344| src/lib/data.ts:1702:     // Price range filter
029345| NOTE: Line comment documents intent or constraints.
029346| src/lib/data.ts:1703:     if (minPrice !== undefined && minPrice !== null) {
029347| NOTE: Conditional logic controlling rendering or flow.
029348| src/lib/data.ts:1704:       conditions.push(`l.price >= $${paramIndex++}`);
029349| NOTE: Implementation detail supporting search page behavior.
029350| src/lib/data.ts:1705:       queryParams.push(minPrice);
029351| NOTE: Implementation detail supporting search page behavior.
029352| src/lib/data.ts:1706:     }
029353| NOTE: Implementation detail supporting search page behavior.
029354| src/lib/data.ts:1707:     if (maxPrice !== undefined && maxPrice !== null) {
029355| NOTE: Conditional logic controlling rendering or flow.
029356| src/lib/data.ts:1708:       conditions.push(`l.price <= $${paramIndex++}`);
029357| NOTE: Implementation detail supporting search page behavior.
029358| src/lib/data.ts:1709:       queryParams.push(maxPrice);
029359| NOTE: Implementation detail supporting search page behavior.
029360| src/lib/data.ts:1710:     }
029361| NOTE: Implementation detail supporting search page behavior.
029362| src/lib/data.ts:1711: 
029363| NOTE: Blank line for visual separation.
029364| src/lib/data.ts:1712:     // Text search filter
029365| NOTE: Line comment documents intent or constraints.
029366| src/lib/data.ts:1713:     if (query && isValidQuery(query)) {
029367| NOTE: Conditional logic controlling rendering or flow.
029368| src/lib/data.ts:1714:       const sanitizedQuery = sanitizeSearchQuery(query);
029369| NOTE: Local declaration used by search logic or UI.
029370| src/lib/data.ts:1715:       if (sanitizedQuery) {
029371| NOTE: Conditional logic controlling rendering or flow.
029372| src/lib/data.ts:1716:         const searchPattern = `%${sanitizedQuery}%`;
029373| NOTE: Local declaration used by search logic or UI.
029374| src/lib/data.ts:1717:         conditions.push(`(
029375| NOTE: Implementation detail supporting search page behavior.
029376| src/lib/data.ts:1718:           LOWER(l.title) LIKE LOWER($${paramIndex}) OR
029377| NOTE: Implementation detail supporting search page behavior.
029378| src/lib/data.ts:1719:           LOWER(l.description) LIKE LOWER($${paramIndex}) OR
029379| NOTE: Implementation detail supporting search page behavior.
029380| src/lib/data.ts:1720:           LOWER(loc.city) LIKE LOWER($${paramIndex}) OR
029381| NOTE: Implementation detail supporting search page behavior.
029382| src/lib/data.ts:1721:           LOWER(loc.state) LIKE LOWER($${paramIndex})
029383| NOTE: Implementation detail supporting search page behavior.
029384| src/lib/data.ts:1722:         )`);
029385| NOTE: Implementation detail supporting search page behavior.
029386| src/lib/data.ts:1723:         queryParams.push(searchPattern);
029387| NOTE: Implementation detail supporting search page behavior.
029388| src/lib/data.ts:1724:         paramIndex++;
029389| NOTE: Implementation detail supporting search page behavior.
029390| src/lib/data.ts:1725:       }
029391| NOTE: Implementation detail supporting search page behavior.
029392| src/lib/data.ts:1726:     }
029393| NOTE: Implementation detail supporting search page behavior.
029394| src/lib/data.ts:1727: 
029395| NOTE: Blank line for visual separation.
029396| src/lib/data.ts:1728:     // Room type filter
029397| NOTE: Line comment documents intent or constraints.
029398| src/lib/data.ts:1729:     if (roomType) {
029399| NOTE: Conditional logic controlling rendering or flow.
029400| src/lib/data.ts:1730:       conditions.push(`LOWER(l."roomType") = LOWER($${paramIndex++})`);
029401| NOTE: Implementation detail supporting search page behavior.
029402| src/lib/data.ts:1731:       queryParams.push(roomType);
029403| NOTE: Implementation detail supporting search page behavior.
029404| src/lib/data.ts:1732:     }
029405| NOTE: Implementation detail supporting search page behavior.
029406| src/lib/data.ts:1733: 
029407| NOTE: Blank line for visual separation.
029408| src/lib/data.ts:1734:     // Lease duration filter
029409| NOTE: Line comment documents intent or constraints.
029410| src/lib/data.ts:1735:     if (leaseDuration) {
029411| NOTE: Conditional logic controlling rendering or flow.
029412| src/lib/data.ts:1736:       conditions.push(`LOWER(l."leaseDuration") = LOWER($${paramIndex++})`);
029413| NOTE: Implementation detail supporting search page behavior.
029414| src/lib/data.ts:1737:       queryParams.push(leaseDuration);
029415| NOTE: Implementation detail supporting search page behavior.
029416| src/lib/data.ts:1738:     }
029417| NOTE: Implementation detail supporting search page behavior.
029418| src/lib/data.ts:1739: 
029419| NOTE: Blank line for visual separation.
029420| src/lib/data.ts:1740:     // Move-in date filter
029421| NOTE: Line comment documents intent or constraints.
029422| src/lib/data.ts:1741:     if (moveInDate) {
029423| NOTE: Conditional logic controlling rendering or flow.
029424| src/lib/data.ts:1742:       conditions.push(
029425| NOTE: Implementation detail supporting search page behavior.
029426| src/lib/data.ts:1743:         `(l."moveInDate" IS NULL OR l."moveInDate" <= $${paramIndex++})`,
029427| NOTE: Implementation detail supporting search page behavior.
029428| src/lib/data.ts:1744:       );
029429| NOTE: Implementation detail supporting search page behavior.
029430| src/lib/data.ts:1745:       queryParams.push(parseDateOnly(moveInDate));
029431| NOTE: Implementation detail supporting search page behavior.
029432| src/lib/data.ts:1746:     }
029433| NOTE: Implementation detail supporting search page behavior.
029434| src/lib/data.ts:1747: 
029435| NOTE: Blank line for visual separation.
029436| src/lib/data.ts:1748:     // Languages filter (OR logic)
029437| NOTE: Line comment documents intent or constraints.
029438| src/lib/data.ts:1749:     if (languages?.length) {
029439| NOTE: Conditional logic controlling rendering or flow.
029440| src/lib/data.ts:1750:       const normalized = languages
029441| NOTE: Local declaration used by search logic or UI.
029442| src/lib/data.ts:1751:         .map((l) => l.trim().toLowerCase())
029443| NOTE: Implementation detail supporting search page behavior.
029444| src/lib/data.ts:1752:         .filter(Boolean);
029445| NOTE: Implementation detail supporting search page behavior.
029446| src/lib/data.ts:1753:       if (normalized.length > 0) {
029447| NOTE: Conditional logic controlling rendering or flow.
029448| src/lib/data.ts:1754:         conditions.push(`l."household_languages" && $${paramIndex++}::text[]`);
029449| NOTE: Implementation detail supporting search page behavior.
029450| src/lib/data.ts:1755:         queryParams.push(normalized);
029451| NOTE: Implementation detail supporting search page behavior.
029452| src/lib/data.ts:1756:       }
029453| NOTE: Implementation detail supporting search page behavior.
029454| src/lib/data.ts:1757:     }
029455| NOTE: Implementation detail supporting search page behavior.
029456| src/lib/data.ts:1758: 
029457| NOTE: Blank line for visual separation.
029458| src/lib/data.ts:1759:     // Amenities filter (AND logic)
029459| NOTE: Line comment documents intent or constraints.
029460| src/lib/data.ts:1760:     if (amenities?.length) {
029461| NOTE: Conditional logic controlling rendering or flow.
029462| src/lib/data.ts:1761:       const normalizedAmenities = amenities
029463| NOTE: Local declaration used by search logic or UI.
029464| src/lib/data.ts:1762:         .map((a) => a.trim().toLowerCase())
029465| NOTE: Implementation detail supporting search page behavior.
029466| src/lib/data.ts:1763:         .filter(Boolean);
029467| NOTE: Implementation detail supporting search page behavior.
029468| src/lib/data.ts:1764:       if (normalizedAmenities.length > 0) {
029469| NOTE: Conditional logic controlling rendering or flow.
029470| src/lib/data.ts:1765:         conditions.push(`NOT EXISTS (
029471| NOTE: Implementation detail supporting search page behavior.
029472| src/lib/data.ts:1766:           SELECT 1 FROM unnest($${paramIndex++}::text[]) AS search_term
029473| NOTE: Implementation detail supporting search page behavior.
029474| src/lib/data.ts:1767:           WHERE NOT EXISTS (
029475| NOTE: Implementation detail supporting search page behavior.
029476| src/lib/data.ts:1768:             SELECT 1 FROM unnest(l.amenities) AS la
029477| NOTE: Implementation detail supporting search page behavior.
029478| src/lib/data.ts:1769:             WHERE LOWER(la) LIKE '%' || search_term || '%'
029479| NOTE: Implementation detail supporting search page behavior.
029480| src/lib/data.ts:1770:           )
029481| NOTE: Implementation detail supporting search page behavior.
029482| src/lib/data.ts:1771:         )`);
029483| NOTE: Implementation detail supporting search page behavior.
029484| src/lib/data.ts:1772:         queryParams.push(normalizedAmenities);
029485| NOTE: Implementation detail supporting search page behavior.
029486| src/lib/data.ts:1773:       }
029487| NOTE: Implementation detail supporting search page behavior.
029488| src/lib/data.ts:1774:     }
029489| NOTE: Implementation detail supporting search page behavior.
029490| src/lib/data.ts:1775: 
029491| NOTE: Blank line for visual separation.
029492| src/lib/data.ts:1776:     // House rules filter (AND logic)
029493| NOTE: Line comment documents intent or constraints.
029494| src/lib/data.ts:1777:     if (houseRules?.length) {
029495| NOTE: Conditional logic controlling rendering or flow.
029496| src/lib/data.ts:1778:       const normalizedRules = houseRules
029497| NOTE: Local declaration used by search logic or UI.
029498| src/lib/data.ts:1779:         .map((r) => r.trim().toLowerCase())
029499| NOTE: Implementation detail supporting search page behavior.
029500| src/lib/data.ts:1780:         .filter(Boolean);
029501| NOTE: Implementation detail supporting search page behavior.
029502| src/lib/data.ts:1781:       if (normalizedRules.length > 0) {
029503| NOTE: Conditional logic controlling rendering or flow.
029504| src/lib/data.ts:1782:         conditions.push(
029505| NOTE: Implementation detail supporting search page behavior.
029506| src/lib/data.ts:1783:           `ARRAY(SELECT LOWER(x) FROM unnest(l."houseRules") AS x WHERE x IS NOT NULL) @> $${paramIndex++}::text[]`,
029507| NOTE: Implementation detail supporting search page behavior.
029508| src/lib/data.ts:1784:         );
029509| NOTE: Implementation detail supporting search page behavior.
029510| src/lib/data.ts:1785:         queryParams.push(normalizedRules);
029511| NOTE: Implementation detail supporting search page behavior.
029512| src/lib/data.ts:1786:       }
029513| NOTE: Implementation detail supporting search page behavior.
029514| src/lib/data.ts:1787:     }
029515| NOTE: Implementation detail supporting search page behavior.
029516| src/lib/data.ts:1788: 
029517| NOTE: Blank line for visual separation.
029518| src/lib/data.ts:1789:     // Build keyset cursor WHERE clause
029519| NOTE: Line comment documents intent or constraints.
029520| src/lib/data.ts:1790:     // This is the core of cursor-based pagination - ensures no duplicates
029521| NOTE: Line comment documents intent or constraints.
029522| src/lib/data.ts:1791:     let orderByClause: string;
029523| NOTE: Local declaration used by search logic or UI.
029524| src/lib/data.ts:1792:     if (cursorData) {
029525| NOTE: Conditional logic controlling rendering or flow.
029526| src/lib/data.ts:1793:       switch (sort) {
029527| NOTE: Implementation detail supporting search page behavior.
029528| src/lib/data.ts:1794:         case "newest":
029529| NOTE: Implementation detail supporting search page behavior.
029530| src/lib/data.ts:1795:           // ORDER BY createdAt DESC, id ASC
029531| NOTE: Line comment documents intent or constraints.
029532| src/lib/data.ts:1796:           // Cursor: (createdAt < cursor.sortValue) OR (createdAt = cursor.sortValue AND id > cursor.id)
029533| NOTE: Line comment documents intent or constraints.
029534| src/lib/data.ts:1797:           conditions.push(`(
029535| NOTE: Implementation detail supporting search page behavior.
029536| src/lib/data.ts:1798:             l."createdAt" < $${paramIndex++}::timestamp
029537| NOTE: Implementation detail supporting search page behavior.
029538| src/lib/data.ts:1799:             OR (l."createdAt" = $${paramIndex++}::timestamp AND l.id > $${paramIndex++})
029539| NOTE: Implementation detail supporting search page behavior.
029540| src/lib/data.ts:1800:           )`);
029541| NOTE: Implementation detail supporting search page behavior.
029542| src/lib/data.ts:1801:           queryParams.push(cursorData.sortValue); // createdAt comparison
029543| NOTE: Implementation detail supporting search page behavior.
029544| src/lib/data.ts:1802:           queryParams.push(cursorData.sortValue); // createdAt equality
029545| NOTE: Implementation detail supporting search page behavior.
029546| src/lib/data.ts:1803:           queryParams.push(cursorData.id); // id tiebreaker
029547| NOTE: Implementation detail supporting search page behavior.
029548| src/lib/data.ts:1804:           orderByClause = 'l."createdAt" DESC, l.id ASC';
029549| NOTE: Implementation detail supporting search page behavior.
029550| src/lib/data.ts:1805:           break;
029551| NOTE: Implementation detail supporting search page behavior.
029552| src/lib/data.ts:1806: 
029553| NOTE: Blank line for visual separation.
029554| src/lib/data.ts:1807:         case "price_asc":
029555| NOTE: Implementation detail supporting search page behavior.
029556| src/lib/data.ts:1808:           // ORDER BY price ASC, id ASC
029557| NOTE: Line comment documents intent or constraints.
029558| src/lib/data.ts:1809:           // Cursor: (price > cursor.sortValue) OR (price = cursor.sortValue AND id > cursor.id)
029559| NOTE: Line comment documents intent or constraints.
029560| src/lib/data.ts:1810:           conditions.push(`(
029561| NOTE: Implementation detail supporting search page behavior.
029562| src/lib/data.ts:1811:             l.price > $${paramIndex++}
029563| NOTE: Implementation detail supporting search page behavior.
029564| src/lib/data.ts:1812:             OR (l.price = $${paramIndex++} AND l.id > $${paramIndex++})
029565| NOTE: Implementation detail supporting search page behavior.
029566| src/lib/data.ts:1813:           )`);
029567| NOTE: Implementation detail supporting search page behavior.
029568| src/lib/data.ts:1814:           queryParams.push(cursorData.sortValue); // price comparison
029569| NOTE: Implementation detail supporting search page behavior.
029570| src/lib/data.ts:1815:           queryParams.push(cursorData.sortValue); // price equality
029571| NOTE: Implementation detail supporting search page behavior.
029572| src/lib/data.ts:1816:           queryParams.push(cursorData.id); // id tiebreaker
029573| NOTE: Implementation detail supporting search page behavior.
029574| src/lib/data.ts:1817:           orderByClause = "l.price ASC, l.id ASC";
029575| NOTE: Implementation detail supporting search page behavior.
029576| src/lib/data.ts:1818:           break;
029577| NOTE: Implementation detail supporting search page behavior.
029578| src/lib/data.ts:1819: 
029579| NOTE: Blank line for visual separation.
029580| src/lib/data.ts:1820:         case "price_desc":
029581| NOTE: Implementation detail supporting search page behavior.
029582| src/lib/data.ts:1821:           // ORDER BY price DESC, id ASC
029583| NOTE: Line comment documents intent or constraints.
029584| src/lib/data.ts:1822:           // Cursor: (price < cursor.sortValue) OR (price = cursor.sortValue AND id > cursor.id)
029585| NOTE: Line comment documents intent or constraints.
029586| src/lib/data.ts:1823:           conditions.push(`(
029587| NOTE: Implementation detail supporting search page behavior.
029588| src/lib/data.ts:1824:             l.price < $${paramIndex++}
029589| NOTE: Implementation detail supporting search page behavior.
029590| src/lib/data.ts:1825:             OR (l.price = $${paramIndex++} AND l.id > $${paramIndex++})
029591| NOTE: Implementation detail supporting search page behavior.
029592| src/lib/data.ts:1826:           )`);
029593| NOTE: Implementation detail supporting search page behavior.
029594| src/lib/data.ts:1827:           queryParams.push(cursorData.sortValue); // price comparison
029595| NOTE: Implementation detail supporting search page behavior.
029596| src/lib/data.ts:1828:           queryParams.push(cursorData.sortValue); // price equality
029597| NOTE: Implementation detail supporting search page behavior.
029598| src/lib/data.ts:1829:           queryParams.push(cursorData.id); // id tiebreaker
029599| NOTE: Implementation detail supporting search page behavior.
029600| src/lib/data.ts:1830:           orderByClause = "l.price DESC, l.id ASC";
029601| NOTE: Implementation detail supporting search page behavior.
029602| src/lib/data.ts:1831:           break;
029603| NOTE: Implementation detail supporting search page behavior.
029604| src/lib/data.ts:1832:         default:
029605| NOTE: Implementation detail supporting search page behavior.
029606| src/lib/data.ts:1833:           // For "recommended", "rating", or any other sort - use newest as default with cursor
029607| NOTE: Line comment documents intent or constraints.
029608| src/lib/data.ts:1834:           conditions.push(`(
029609| NOTE: Implementation detail supporting search page behavior.
029610| src/lib/data.ts:1835:             l."createdAt" < $${paramIndex++}::timestamp
029611| NOTE: Implementation detail supporting search page behavior.
029612| src/lib/data.ts:1836:             OR (l."createdAt" = $${paramIndex++}::timestamp AND l.id > $${paramIndex++})
029613| NOTE: Implementation detail supporting search page behavior.
029614| src/lib/data.ts:1837:           )`);
029615| NOTE: Implementation detail supporting search page behavior.
029616| src/lib/data.ts:1838:           queryParams.push(cursorData.sortValue);
029617| NOTE: Implementation detail supporting search page behavior.
029618| src/lib/data.ts:1839:           queryParams.push(cursorData.sortValue);
029619| NOTE: Implementation detail supporting search page behavior.
029620| src/lib/data.ts:1840:           queryParams.push(cursorData.id);
029621| NOTE: Implementation detail supporting search page behavior.
029622| src/lib/data.ts:1841:           orderByClause = 'l."createdAt" DESC, l.id ASC';
029623| NOTE: Implementation detail supporting search page behavior.
029624| src/lib/data.ts:1842:           break;
029625| NOTE: Implementation detail supporting search page behavior.
029626| src/lib/data.ts:1843:       }
029627| NOTE: Implementation detail supporting search page behavior.
029628| src/lib/data.ts:1844:     } else {
029629| NOTE: Implementation detail supporting search page behavior.
029630| src/lib/data.ts:1845:       // No cursor - use standard ORDER BY
029631| NOTE: Line comment documents intent or constraints.
029632| src/lib/data.ts:1846:       switch (sort) {
029633| NOTE: Implementation detail supporting search page behavior.
029634| src/lib/data.ts:1847:         case "newest":
029635| NOTE: Implementation detail supporting search page behavior.
029636| src/lib/data.ts:1848:           orderByClause = 'l."createdAt" DESC, l.id ASC';
029637| NOTE: Implementation detail supporting search page behavior.
029638| src/lib/data.ts:1849:           break;
029639| NOTE: Implementation detail supporting search page behavior.
029640| src/lib/data.ts:1850:         case "price_asc":
029641| NOTE: Implementation detail supporting search page behavior.
029642| src/lib/data.ts:1851:           orderByClause = "l.price ASC, l.id ASC";
029643| NOTE: Implementation detail supporting search page behavior.
029644| src/lib/data.ts:1852:           break;
029645| NOTE: Implementation detail supporting search page behavior.
029646| src/lib/data.ts:1853:         case "price_desc":
029647| NOTE: Implementation detail supporting search page behavior.
029648| src/lib/data.ts:1854:           orderByClause = "l.price DESC, l.id ASC";
029649| NOTE: Implementation detail supporting search page behavior.
029650| src/lib/data.ts:1855:           break;
029651| NOTE: Implementation detail supporting search page behavior.
029652| src/lib/data.ts:1856:         default:
029653| NOTE: Implementation detail supporting search page behavior.
029654| src/lib/data.ts:1857:           // For "recommended", "rating", or any other sort - use newest as default
029655| NOTE: Line comment documents intent or constraints.
029656| src/lib/data.ts:1858:           orderByClause = 'l."createdAt" DESC, l.id ASC';
029657| NOTE: Implementation detail supporting search page behavior.
029658| src/lib/data.ts:1859:           break;
029659| NOTE: Implementation detail supporting search page behavior.
029660| src/lib/data.ts:1860:       }
029661| NOTE: Implementation detail supporting search page behavior.
029662| src/lib/data.ts:1861:     }
029663| NOTE: Implementation detail supporting search page behavior.
029664| src/lib/data.ts:1862: 
029665| NOTE: Blank line for visual separation.
029666| src/lib/data.ts:1863:     const whereClause = conditions.join(" AND ");
029667| NOTE: Local declaration used by search logic or UI.
029668| src/lib/data.ts:1864: 
029669| NOTE: Blank line for visual separation.
029670| src/lib/data.ts:1865:     // Fetch limit+1 to determine hasNextPage
029671| NOTE: Line comment documents intent or constraints.
029672| src/lib/data.ts:1866:     const fetchLimit = limit + 1;
029673| NOTE: Local declaration used by search logic or UI.
029674| src/lib/data.ts:1867: 
029675| NOTE: Blank line for visual separation.
029676| src/lib/data.ts:1868:     const dataQuery = `
029677| NOTE: Local declaration used by search logic or UI.
029678| src/lib/data.ts:1869:       SELECT
029679| NOTE: Implementation detail supporting search page behavior.
029680| src/lib/data.ts:1870:         l.id,
029681| NOTE: Implementation detail supporting search page behavior.
029682| src/lib/data.ts:1871:         l.title,
029683| NOTE: Implementation detail supporting search page behavior.
029684| src/lib/data.ts:1872:         l.description,
029685| NOTE: Implementation detail supporting search page behavior.
029686| src/lib/data.ts:1873:         l.price,
029687| NOTE: Implementation detail supporting search page behavior.
029688| src/lib/data.ts:1874:         l.images,
029689| NOTE: Implementation detail supporting search page behavior.
029690| src/lib/data.ts:1875:         l."availableSlots",
029691| NOTE: Implementation detail supporting search page behavior.
029692| src/lib/data.ts:1876:         l."totalSlots",
029693| NOTE: Implementation detail supporting search page behavior.
029694| src/lib/data.ts:1877:         l.amenities,
029695| NOTE: Implementation detail supporting search page behavior.
029696| src/lib/data.ts:1878:         l."houseRules",
029697| NOTE: Implementation detail supporting search page behavior.
029698| src/lib/data.ts:1879:         l."household_languages",
029699| NOTE: Implementation detail supporting search page behavior.
029700| src/lib/data.ts:1880:         l."primary_home_language",
029701| NOTE: Implementation detail supporting search page behavior.
029702| src/lib/data.ts:1881:         l."leaseDuration",
029703| NOTE: Implementation detail supporting search page behavior.
029704| src/lib/data.ts:1882:         l."roomType",
029705| NOTE: Implementation detail supporting search page behavior.
029706| src/lib/data.ts:1883:         l."moveInDate",
029707| NOTE: Implementation detail supporting search page behavior.
029708| src/lib/data.ts:1884:         l."ownerId",
029709| NOTE: Implementation detail supporting search page behavior.
029710| src/lib/data.ts:1885:         l."createdAt",
029711| NOTE: Implementation detail supporting search page behavior.
029712| src/lib/data.ts:1886:         l."viewCount",
029713| NOTE: Implementation detail supporting search page behavior.
029714| src/lib/data.ts:1887:         loc.address,
029715| NOTE: Implementation detail supporting search page behavior.
029716| src/lib/data.ts:1888:         loc.city,
029717| NOTE: Implementation detail supporting search page behavior.
029718| src/lib/data.ts:1889:         loc.state,
029719| NOTE: Implementation detail supporting search page behavior.
029720| src/lib/data.ts:1890:         loc.zip,
029721| NOTE: Implementation detail supporting search page behavior.
029722| src/lib/data.ts:1891:         ST_X(loc.coords::geometry) as lng,
029723| NOTE: Implementation detail supporting search page behavior.
029724| src/lib/data.ts:1892:         ST_Y(loc.coords::geometry) as lat
029725| NOTE: Implementation detail supporting search page behavior.
029726| src/lib/data.ts:1893:       FROM "Listing" l
029727| NOTE: Implementation detail supporting search page behavior.
029728| src/lib/data.ts:1894:       JOIN "Location" loc ON l.id = loc."listingId"
029729| NOTE: Implementation detail supporting search page behavior.
029730| src/lib/data.ts:1895:       WHERE ${whereClause}
029731| NOTE: Implementation detail supporting search page behavior.
029732| src/lib/data.ts:1896:       ORDER BY ${orderByClause}
029733| NOTE: Implementation detail supporting search page behavior.
029734| src/lib/data.ts:1897:       LIMIT $${paramIndex++}
029735| NOTE: Implementation detail supporting search page behavior.
029736| src/lib/data.ts:1898:     `;
029737| NOTE: Implementation detail supporting search page behavior.
029738| src/lib/data.ts:1899: 
029739| NOTE: Blank line for visual separation.
029740| src/lib/data.ts:1900:     queryParams.push(fetchLimit);
029741| NOTE: Implementation detail supporting search page behavior.
029742| src/lib/data.ts:1901: 
029743| NOTE: Blank line for visual separation.
029744| src/lib/data.ts:1902:     const listings = await prisma.$queryRawUnsafe<any[]>(
029745| NOTE: Local declaration used by search logic or UI.
029746| src/lib/data.ts:1903:       dataQuery,
029747| NOTE: Implementation detail supporting search page behavior.
029748| src/lib/data.ts:1904:       ...queryParams,
029749| NOTE: Implementation detail supporting search page behavior.
029750| src/lib/data.ts:1905:     );
029751| NOTE: Implementation detail supporting search page behavior.
029752| src/lib/data.ts:1906: 
029753| NOTE: Blank line for visual separation.
029754| src/lib/data.ts:1907:     // Map results to ListingData
029755| NOTE: Line comment documents intent or constraints.
029756| src/lib/data.ts:1908:     const results = listings.map((l) => ({
029757| NOTE: Local declaration used by search logic or UI.
029758| src/lib/data.ts:1909:       id: l.id,
029759| NOTE: Implementation detail supporting search page behavior.
029760| src/lib/data.ts:1910:       title: l.title,
029761| NOTE: Implementation detail supporting search page behavior.
029762| src/lib/data.ts:1911:       description: l.description,
029763| NOTE: Implementation detail supporting search page behavior.
029764| src/lib/data.ts:1912:       price: Number(l.price),
029765| NOTE: Implementation detail supporting search page behavior.
029766| src/lib/data.ts:1913:       images: l.images || [],
029767| NOTE: Implementation detail supporting search page behavior.
029768| src/lib/data.ts:1914:       availableSlots: l.availableSlots,
029769| NOTE: Implementation detail supporting search page behavior.
029770| src/lib/data.ts:1915:       totalSlots: l.totalSlots,
029771| NOTE: Implementation detail supporting search page behavior.
029772| src/lib/data.ts:1916:       amenities: l.amenities || [],
029773| NOTE: Implementation detail supporting search page behavior.
029774| src/lib/data.ts:1917:       houseRules: l.houseRules || [],
029775| NOTE: Implementation detail supporting search page behavior.
029776| src/lib/data.ts:1918:       householdLanguages: l.household_languages || [],
029777| NOTE: Implementation detail supporting search page behavior.
029778| src/lib/data.ts:1919:       primaryHomeLanguage: l.primary_home_language,
029779| NOTE: Implementation detail supporting search page behavior.
029780| src/lib/data.ts:1920:       leaseDuration: l.leaseDuration,
029781| NOTE: Implementation detail supporting search page behavior.
029782| src/lib/data.ts:1921:       roomType: l.roomType,
029783| NOTE: Implementation detail supporting search page behavior.
029784| src/lib/data.ts:1922:       moveInDate: l.moveInDate ? new Date(l.moveInDate) : undefined,
029785| NOTE: Implementation detail supporting search page behavior.
029786| src/lib/data.ts:1923:       ownerId: l.ownerId,
029787| NOTE: Implementation detail supporting search page behavior.
029788| src/lib/data.ts:1924:       createdAt: l.createdAt ? new Date(l.createdAt) : new Date(),
029789| NOTE: Implementation detail supporting search page behavior.
029790| src/lib/data.ts:1925:       viewCount: Number(l.viewCount) || 0,
029791| NOTE: Implementation detail supporting search page behavior.
029792| src/lib/data.ts:1926:       location: {
029793| NOTE: Implementation detail supporting search page behavior.
029794| src/lib/data.ts:1927:         address: l.address,
029795| NOTE: Implementation detail supporting search page behavior.
029796| src/lib/data.ts:1928:         city: l.city,
029797| NOTE: Implementation detail supporting search page behavior.
029798| src/lib/data.ts:1929:         state: l.state,
029799| NOTE: Implementation detail supporting search page behavior.
029800| src/lib/data.ts:1930:         zip: l.zip,
029801| NOTE: Implementation detail supporting search page behavior.
029802| src/lib/data.ts:1931:         lat: Number(l.lat) || 0,
029803| NOTE: Implementation detail supporting search page behavior.
029804| src/lib/data.ts:1932:         lng: Number(l.lng) || 0,
029805| NOTE: Implementation detail supporting search page behavior.
029806| src/lib/data.ts:1933:       },
029807| NOTE: Implementation detail supporting search page behavior.
029808| src/lib/data.ts:1934:     }));
029809| NOTE: Implementation detail supporting search page behavior.
029810| src/lib/data.ts:1935: 
029811| NOTE: Blank line for visual separation.
029812| src/lib/data.ts:1936:     // Determine hasNextPage using limit+1 pattern
029813| NOTE: Line comment documents intent or constraints.
029814| src/lib/data.ts:1937:     const hasNextPage = results.length > limit;
029815| NOTE: Local declaration used by search logic or UI.
029816| src/lib/data.ts:1938: 
029817| NOTE: Blank line for visual separation.
029818| src/lib/data.ts:1939:     // Only return `limit` items
029819| NOTE: Line comment documents intent or constraints.
029820| src/lib/data.ts:1940:     const items = hasNextPage ? results.slice(0, limit) : results;
029821| NOTE: Local declaration used by search logic or UI.
029822| src/lib/data.ts:1941: 
029823| NOTE: Blank line for visual separation.
029824| src/lib/data.ts:1942:     // Generate next cursor from last item
029825| NOTE: Line comment documents intent or constraints.
029826| src/lib/data.ts:1943:     let nextCursor: string | null = null;
029827| NOTE: Local declaration used by search logic or UI.
029828| src/lib/data.ts:1944:     if (hasNextPage && items.length > 0) {
029829| NOTE: Conditional logic controlling rendering or flow.
029830| src/lib/data.ts:1945:       const lastItem = items[items.length - 1];
029831| NOTE: Local declaration used by search logic or UI.
029832| src/lib/data.ts:1946:       nextCursor = createCursorFromItem(
029833| NOTE: Implementation detail supporting search page behavior.
029834| src/lib/data.ts:1947:         {
029835| NOTE: Implementation detail supporting search page behavior.
029836| src/lib/data.ts:1948:           id: lastItem.id,
029837| NOTE: Implementation detail supporting search page behavior.
029838| src/lib/data.ts:1949:           price: lastItem.price,
029839| NOTE: Implementation detail supporting search page behavior.
029840| src/lib/data.ts:1950:           createdAt: lastItem.createdAt,
029841| NOTE: Implementation detail supporting search page behavior.
029842| src/lib/data.ts:1951:         },
029843| NOTE: Implementation detail supporting search page behavior.
029844| src/lib/data.ts:1952:         sort as KeysetSort,
029845| NOTE: Implementation detail supporting search page behavior.
029846| src/lib/data.ts:1953:       );
029847| NOTE: Implementation detail supporting search page behavior.
029848| src/lib/data.ts:1954:     }
029849| NOTE: Implementation detail supporting search page behavior.
029850| src/lib/data.ts:1955: 
029851| NOTE: Blank line for visual separation.
029852| src/lib/data.ts:1956:     return {
029853| NOTE: Return statement for component or helper output.
029854| src/lib/data.ts:1957:       items,
029855| NOTE: Implementation detail supporting search page behavior.
029856| src/lib/data.ts:1958:       nextCursor,
029857| NOTE: Implementation detail supporting search page behavior.
029858| src/lib/data.ts:1959:       hasNextPage,
029859| NOTE: Implementation detail supporting search page behavior.
029860| src/lib/data.ts:1960:       sort: sort as KeysetSort,
029861| NOTE: Implementation detail supporting search page behavior.
029862| src/lib/data.ts:1961:       limit,
029863| NOTE: Implementation detail supporting search page behavior.
029864| src/lib/data.ts:1962:     };
029865| NOTE: Implementation detail supporting search page behavior.
029866| src/lib/data.ts:1963:   } catch (error) {
029867| NOTE: Implementation detail supporting search page behavior.
029868| src/lib/data.ts:1964:     const dataError = wrapDatabaseError(error, "getListingsKeysetPaginated");
029869| NOTE: Local declaration used by search logic or UI.
029870| src/lib/data.ts:1965:     dataError.log({
029871| NOTE: Implementation detail supporting search page behavior.
029872| src/lib/data.ts:1966:       operation: "getListingsKeysetPaginated",
029873| NOTE: Implementation detail supporting search page behavior.
029874| src/lib/data.ts:1967:       hasQuery: !!params.query,
029875| NOTE: Implementation detail supporting search page behavior.
029876| src/lib/data.ts:1968:       hasBounds: !!params.bounds,
029877| NOTE: Implementation detail supporting search page behavior.
029878| src/lib/data.ts:1969:       hasCursor: !!params.cursor,
029879| NOTE: Implementation detail supporting search page behavior.
029880| src/lib/data.ts:1970:       sortOption: params.sort,
029881| NOTE: Implementation detail supporting search page behavior.
029882| src/lib/data.ts:1971:     });
029883| NOTE: Implementation detail supporting search page behavior.
029884| src/lib/data.ts:1972:     throw dataError;
029885| NOTE: Implementation detail supporting search page behavior.
029886| src/lib/data.ts:1973:   }
029887| NOTE: Implementation detail supporting search page behavior.
029888| src/lib/data.ts:1974: }
029889| NOTE: Implementation detail supporting search page behavior.
029890| src/lib/data.ts:1975: 
029891| NOTE: Blank line for visual separation.
029892| src/lib/data.ts:1976: // Types for filter analysis
029893| NOTE: Line comment documents intent or constraints.
029894| src/lib/data.ts:1977: export interface FilterSuggestion {
029895| NOTE: Implementation detail supporting search page behavior.
029896| src/lib/data.ts:1978:   filter: string;
029897| NOTE: Implementation detail supporting search page behavior.
029898| src/lib/data.ts:1979:   label: string;
029899| NOTE: Implementation detail supporting search page behavior.
029900| src/lib/data.ts:1980:   resultsWithout: number;
029901| NOTE: Implementation detail supporting search page behavior.
029902| src/lib/data.ts:1981:   suggestion: string;
029903| NOTE: Implementation detail supporting search page behavior.
029904| src/lib/data.ts:1982:   /** Flag indicating this filter has the highest impact when removed */
029905| NOTE: Block comment line describing behavior or context.
029906| src/lib/data.ts:1983:   isMostImpactful?: boolean;
029907| NOTE: Implementation detail supporting search page behavior.
029908| src/lib/data.ts:1984: }
029909| NOTE: Implementation detail supporting search page behavior.
029910| src/lib/data.ts:1985: 
029911| NOTE: Blank line for visual separation.
029912| src/lib/data.ts:1986: /**
029913| NOTE: Block comment line describing behavior or context.
029914| src/lib/data.ts:1987:  * P0 fix: Efficient COUNT query for filter analysis
029915| NOTE: Block comment line describing behavior or context.
029916| src/lib/data.ts:1988:  * Replaces the inefficient getListingsCount() that fetched ALL data just to return .length
029917| NOTE: Block comment line describing behavior or context.
029918| src/lib/data.ts:1989:  * This version only runs a lightweight COUNT query with the same WHERE clause logic.
029919| NOTE: Block comment line describing behavior or context.
029920| src/lib/data.ts:1990:  */
029921| NOTE: Block comment line describing behavior or context.
029922| src/lib/data.ts:1991: async function getListingsCountEfficient(
029923| NOTE: Implementation detail supporting search page behavior.
029924| src/lib/data.ts:1992:   params: FilterParams,
029925| NOTE: Implementation detail supporting search page behavior.
029926| src/lib/data.ts:1993: ): Promise<number> {
029927| NOTE: Implementation detail supporting search page behavior.
029928| src/lib/data.ts:1994:   const {
029929| NOTE: Local declaration used by search logic or UI.
029930| src/lib/data.ts:1995:     query,
029931| NOTE: Implementation detail supporting search page behavior.
029932| src/lib/data.ts:1996:     minPrice,
029933| NOTE: Implementation detail supporting search page behavior.
029934| src/lib/data.ts:1997:     maxPrice,
029935| NOTE: Implementation detail supporting search page behavior.
029936| src/lib/data.ts:1998:     amenities,
029937| NOTE: Implementation detail supporting search page behavior.
029938| src/lib/data.ts:1999:     moveInDate,
029939| NOTE: Implementation detail supporting search page behavior.
029940| src/lib/data.ts:2000:     leaseDuration,
029941| NOTE: Implementation detail supporting search page behavior.
029942| src/lib/data.ts:2001:     houseRules,
029943| NOTE: Implementation detail supporting search page behavior.
029944| src/lib/data.ts:2002:     roomType,
029945| NOTE: Implementation detail supporting search page behavior.
029946| src/lib/data.ts:2003:     languages,
029947| NOTE: Implementation detail supporting search page behavior.
029948| src/lib/data.ts:2004:     bounds,
029949| NOTE: Implementation detail supporting search page behavior.
029950| src/lib/data.ts:2005:   } = params;
029951| NOTE: Implementation detail supporting search page behavior.
029952| src/lib/data.ts:2006: 
029953| NOTE: Blank line for visual separation.
029954| src/lib/data.ts:2007:   // Build dynamic WHERE conditions for SQL (same logic as getListingsPaginated)
029955| NOTE: Line comment documents intent or constraints.
029956| src/lib/data.ts:2008:   const conditions: string[] = [
029957| NOTE: Local declaration used by search logic or UI.
029958| src/lib/data.ts:2009:     'l."availableSlots" > 0',
029959| NOTE: Implementation detail supporting search page behavior.
029960| src/lib/data.ts:2010:     "l.status = 'ACTIVE'",
029961| NOTE: Implementation detail supporting search page behavior.
029962| src/lib/data.ts:2011:     // Exclude listings with invalid coordinates
029963| NOTE: Line comment documents intent or constraints.
029964| src/lib/data.ts:2012:     "ST_X(loc.coords::geometry) IS NOT NULL",
029965| NOTE: Implementation detail supporting search page behavior.
029966| src/lib/data.ts:2013:     "ST_Y(loc.coords::geometry) IS NOT NULL",
029967| NOTE: Implementation detail supporting search page behavior.
029968| src/lib/data.ts:2014:     "NOT (ST_X(loc.coords::geometry) = 0 AND ST_Y(loc.coords::geometry) = 0)",
029969| NOTE: Implementation detail supporting search page behavior.
029970| src/lib/data.ts:2015:     "ST_Y(loc.coords::geometry) BETWEEN -90 AND 90",
029971| NOTE: Implementation detail supporting search page behavior.
029972| src/lib/data.ts:2016:     "ST_X(loc.coords::geometry) BETWEEN -180 AND 180",
029973| NOTE: Implementation detail supporting search page behavior.
029974| src/lib/data.ts:2017:   ];
029975| NOTE: Implementation detail supporting search page behavior.
029976| src/lib/data.ts:2018:   const queryParams: any[] = [];
029977| NOTE: Local declaration used by search logic or UI.
029978| src/lib/data.ts:2019:   let paramIndex = 1;
029979| NOTE: Local declaration used by search logic or UI.
029980| src/lib/data.ts:2020: 
029981| NOTE: Blank line for visual separation.
029982| src/lib/data.ts:2021:   // Geographic bounds filter with antimeridian support
029983| NOTE: Line comment documents intent or constraints.
029984| src/lib/data.ts:2022:   if (bounds) {
029985| NOTE: Conditional logic controlling rendering or flow.
029986| src/lib/data.ts:2023:     conditions.push(`ST_Y(loc.coords::geometry) >= $${paramIndex++}`);
029987| NOTE: Implementation detail supporting search page behavior.
029988| src/lib/data.ts:2024:     queryParams.push(bounds.minLat);
029989| NOTE: Implementation detail supporting search page behavior.
029990| src/lib/data.ts:2025:     conditions.push(`ST_Y(loc.coords::geometry) <= $${paramIndex++}`);
029991| NOTE: Implementation detail supporting search page behavior.
029992| src/lib/data.ts:2026:     queryParams.push(bounds.maxLat);
029993| NOTE: Implementation detail supporting search page behavior.
029994| src/lib/data.ts:2027: 
029995| NOTE: Blank line for visual separation.
029996| src/lib/data.ts:2028:     if (crossesAntimeridian(bounds.minLng, bounds.maxLng)) {
029997| NOTE: Conditional logic controlling rendering or flow.
029998| src/lib/data.ts:2029:       conditions.push(
029999| NOTE: Implementation detail supporting search page behavior.
030000| src/lib/data.ts:2030:         `(ST_X(loc.coords::geometry) >= $${paramIndex++} OR ST_X(loc.coords::geometry) <= $${paramIndex++})`,
030001| NOTE: Implementation detail supporting search page behavior.
030002| src/lib/data.ts:2031:       );
030003| NOTE: Implementation detail supporting search page behavior.
030004| src/lib/data.ts:2032:       queryParams.push(bounds.minLng);
030005| NOTE: Implementation detail supporting search page behavior.
030006| src/lib/data.ts:2033:       queryParams.push(bounds.maxLng);
030007| NOTE: Implementation detail supporting search page behavior.
030008| src/lib/data.ts:2034:     } else {
030009| NOTE: Implementation detail supporting search page behavior.
030010| src/lib/data.ts:2035:       conditions.push(`ST_X(loc.coords::geometry) >= $${paramIndex++}`);
030011| NOTE: Implementation detail supporting search page behavior.
030012| src/lib/data.ts:2036:       queryParams.push(bounds.minLng);
030013| NOTE: Implementation detail supporting search page behavior.
030014| src/lib/data.ts:2037:       conditions.push(`ST_X(loc.coords::geometry) <= $${paramIndex++}`);
030015| NOTE: Implementation detail supporting search page behavior.
030016| src/lib/data.ts:2038:       queryParams.push(bounds.maxLng);
030017| NOTE: Implementation detail supporting search page behavior.
030018| src/lib/data.ts:2039:     }
030019| NOTE: Implementation detail supporting search page behavior.
030020| src/lib/data.ts:2040:   }
030021| NOTE: Implementation detail supporting search page behavior.
030022| src/lib/data.ts:2041: 
030023| NOTE: Blank line for visual separation.
030024| src/lib/data.ts:2042:   // Price range filter
030025| NOTE: Line comment documents intent or constraints.
030026| src/lib/data.ts:2043:   if (minPrice !== undefined && minPrice !== null) {
030027| NOTE: Conditional logic controlling rendering or flow.
030028| src/lib/data.ts:2044:     conditions.push(`l.price >= $${paramIndex++}`);
030029| NOTE: Implementation detail supporting search page behavior.
030030| src/lib/data.ts:2045:     queryParams.push(minPrice);
030031| NOTE: Implementation detail supporting search page behavior.
030032| src/lib/data.ts:2046:   }
030033| NOTE: Implementation detail supporting search page behavior.
030034| src/lib/data.ts:2047:   if (maxPrice !== undefined && maxPrice !== null) {
030035| NOTE: Conditional logic controlling rendering or flow.
030036| src/lib/data.ts:2048:     conditions.push(`l.price <= $${paramIndex++}`);
030037| NOTE: Implementation detail supporting search page behavior.
030038| src/lib/data.ts:2049:     queryParams.push(maxPrice);
030039| NOTE: Implementation detail supporting search page behavior.
030040| src/lib/data.ts:2050:   }
030041| NOTE: Implementation detail supporting search page behavior.
030042| src/lib/data.ts:2051: 
030043| NOTE: Blank line for visual separation.
030044| src/lib/data.ts:2052:   // Text search filter
030045| NOTE: Line comment documents intent or constraints.
030046| src/lib/data.ts:2053:   if (query && isValidQuery(query)) {
030047| NOTE: Conditional logic controlling rendering or flow.
030048| src/lib/data.ts:2054:     const sanitizedQuery = sanitizeSearchQuery(query);
030049| NOTE: Local declaration used by search logic or UI.
030050| src/lib/data.ts:2055:     if (sanitizedQuery) {
030051| NOTE: Conditional logic controlling rendering or flow.
030052| src/lib/data.ts:2056:       const searchPattern = `%${sanitizedQuery}%`;
030053| NOTE: Local declaration used by search logic or UI.
030054| src/lib/data.ts:2057:       conditions.push(`(
030055| NOTE: Implementation detail supporting search page behavior.
030056| src/lib/data.ts:2058:                 LOWER(l.title) LIKE LOWER($${paramIndex}) OR
030057| NOTE: Implementation detail supporting search page behavior.
030058| src/lib/data.ts:2059:                 LOWER(l.description) LIKE LOWER($${paramIndex}) OR
030059| NOTE: Implementation detail supporting search page behavior.
030060| src/lib/data.ts:2060:                 LOWER(loc.city) LIKE LOWER($${paramIndex}) OR
030061| NOTE: Implementation detail supporting search page behavior.
030062| src/lib/data.ts:2061:                 LOWER(loc.state) LIKE LOWER($${paramIndex})
030063| NOTE: Implementation detail supporting search page behavior.
030064| src/lib/data.ts:2062:             )`);
030065| NOTE: Implementation detail supporting search page behavior.
030066| src/lib/data.ts:2063:       queryParams.push(searchPattern);
030067| NOTE: Implementation detail supporting search page behavior.
030068| src/lib/data.ts:2064:       paramIndex++;
030069| NOTE: Implementation detail supporting search page behavior.
030070| src/lib/data.ts:2065:     }
030071| NOTE: Implementation detail supporting search page behavior.
030072| src/lib/data.ts:2066:   }
030073| NOTE: Implementation detail supporting search page behavior.
030074| src/lib/data.ts:2067: 
030075| NOTE: Blank line for visual separation.
030076| src/lib/data.ts:2068:   // Room type filter
030077| NOTE: Line comment documents intent or constraints.
030078| src/lib/data.ts:2069:   if (roomType) {
030079| NOTE: Conditional logic controlling rendering or flow.
030080| src/lib/data.ts:2070:     conditions.push(`LOWER(l."roomType") = LOWER($${paramIndex++})`);
030081| NOTE: Implementation detail supporting search page behavior.
030082| src/lib/data.ts:2071:     queryParams.push(roomType);
030083| NOTE: Implementation detail supporting search page behavior.
030084| src/lib/data.ts:2072:   }
030085| NOTE: Implementation detail supporting search page behavior.
030086| src/lib/data.ts:2073: 
030087| NOTE: Blank line for visual separation.
030088| src/lib/data.ts:2074:   // Lease duration filter
030089| NOTE: Line comment documents intent or constraints.
030090| src/lib/data.ts:2075:   if (leaseDuration) {
030091| NOTE: Conditional logic controlling rendering or flow.
030092| src/lib/data.ts:2076:     conditions.push(`LOWER(l."leaseDuration") = LOWER($${paramIndex++})`);
030093| NOTE: Implementation detail supporting search page behavior.
030094| src/lib/data.ts:2077:     queryParams.push(leaseDuration);
030095| NOTE: Implementation detail supporting search page behavior.
030096| src/lib/data.ts:2078:   }
030097| NOTE: Implementation detail supporting search page behavior.
030098| src/lib/data.ts:2079: 
030099| NOTE: Blank line for visual separation.
030100| src/lib/data.ts:2080:   // Move-in date filter
030101| NOTE: Line comment documents intent or constraints.
030102| src/lib/data.ts:2081:   if (moveInDate) {
030103| NOTE: Conditional logic controlling rendering or flow.
030104| src/lib/data.ts:2082:     conditions.push(
030105| NOTE: Implementation detail supporting search page behavior.
030106| src/lib/data.ts:2083:       `(l."moveInDate" IS NULL OR l."moveInDate" <= $${paramIndex++})`,
030107| NOTE: Implementation detail supporting search page behavior.
030108| src/lib/data.ts:2084:     );
030109| NOTE: Implementation detail supporting search page behavior.
030110| src/lib/data.ts:2085:     queryParams.push(parseDateOnly(moveInDate));
030111| NOTE: Implementation detail supporting search page behavior.
030112| src/lib/data.ts:2086:   }
030113| NOTE: Implementation detail supporting search page behavior.
030114| src/lib/data.ts:2087: 
030115| NOTE: Blank line for visual separation.
030116| src/lib/data.ts:2088:   // Languages filter (OR logic)
030117| NOTE: Line comment documents intent or constraints.
030118| src/lib/data.ts:2089:   if (languages?.length) {
030119| NOTE: Conditional logic controlling rendering or flow.
030120| src/lib/data.ts:2090:     const normalized = languages
030121| NOTE: Local declaration used by search logic or UI.
030122| src/lib/data.ts:2091:       .map((l) => l.trim().toLowerCase())
030123| NOTE: Implementation detail supporting search page behavior.
030124| src/lib/data.ts:2092:       .filter(Boolean);
030125| NOTE: Implementation detail supporting search page behavior.
030126| src/lib/data.ts:2093:     if (normalized.length > 0) {
030127| NOTE: Conditional logic controlling rendering or flow.
030128| src/lib/data.ts:2094:       conditions.push(`l."household_languages" && $${paramIndex++}::text[]`);
030129| NOTE: Implementation detail supporting search page behavior.
030130| src/lib/data.ts:2095:       queryParams.push(normalized);
030131| NOTE: Implementation detail supporting search page behavior.
030132| src/lib/data.ts:2096:     }
030133| NOTE: Implementation detail supporting search page behavior.
030134| src/lib/data.ts:2097:   }
030135| NOTE: Implementation detail supporting search page behavior.
030136| src/lib/data.ts:2098: 
030137| NOTE: Blank line for visual separation.
030138| src/lib/data.ts:2099:   // Amenities filter (AND logic)
030139| NOTE: Line comment documents intent or constraints.
030140| src/lib/data.ts:2100:   if (amenities?.length) {
030141| NOTE: Conditional logic controlling rendering or flow.
030142| src/lib/data.ts:2101:     const normalizedAmenities = amenities
030143| NOTE: Local declaration used by search logic or UI.
030144| src/lib/data.ts:2102:       .map((a) => a.trim().toLowerCase())
030145| NOTE: Implementation detail supporting search page behavior.
030146| src/lib/data.ts:2103:       .filter(Boolean);
030147| NOTE: Implementation detail supporting search page behavior.
030148| src/lib/data.ts:2104:     if (normalizedAmenities.length > 0) {
030149| NOTE: Conditional logic controlling rendering or flow.
030150| src/lib/data.ts:2105:       conditions.push(
030151| NOTE: Implementation detail supporting search page behavior.
030152| src/lib/data.ts:2106:         `ARRAY(SELECT LOWER(x) FROM unnest(l.amenities) AS x WHERE x IS NOT NULL) @> $${paramIndex++}::text[]`,
030153| NOTE: Implementation detail supporting search page behavior.
030154| src/lib/data.ts:2107:       );
030155| NOTE: Implementation detail supporting search page behavior.
030156| src/lib/data.ts:2108:       queryParams.push(normalizedAmenities);
030157| NOTE: Implementation detail supporting search page behavior.
030158| src/lib/data.ts:2109:     }
030159| NOTE: Implementation detail supporting search page behavior.
030160| src/lib/data.ts:2110:   }
030161| NOTE: Implementation detail supporting search page behavior.
030162| src/lib/data.ts:2111: 
030163| NOTE: Blank line for visual separation.
030164| src/lib/data.ts:2112:   // House rules filter (AND logic)
030165| NOTE: Line comment documents intent or constraints.
030166| src/lib/data.ts:2113:   if (houseRules?.length) {
030167| NOTE: Conditional logic controlling rendering or flow.
030168| src/lib/data.ts:2114:     const normalizedRules = houseRules
030169| NOTE: Local declaration used by search logic or UI.
030170| src/lib/data.ts:2115:       .map((r) => r.trim().toLowerCase())
030171| NOTE: Implementation detail supporting search page behavior.
030172| src/lib/data.ts:2116:       .filter(Boolean);
030173| NOTE: Implementation detail supporting search page behavior.
030174| src/lib/data.ts:2117:     if (normalizedRules.length > 0) {
030175| NOTE: Conditional logic controlling rendering or flow.
030176| src/lib/data.ts:2118:       conditions.push(
030177| NOTE: Implementation detail supporting search page behavior.
030178| src/lib/data.ts:2119:         `ARRAY(SELECT LOWER(x) FROM unnest(l."houseRules") AS x WHERE x IS NOT NULL) @> $${paramIndex++}::text[]`,
030179| NOTE: Implementation detail supporting search page behavior.
030180| src/lib/data.ts:2120:       );
030181| NOTE: Implementation detail supporting search page behavior.
030182| src/lib/data.ts:2121:       queryParams.push(normalizedRules);
030183| NOTE: Implementation detail supporting search page behavior.
030184| src/lib/data.ts:2122:     }
030185| NOTE: Implementation detail supporting search page behavior.
030186| src/lib/data.ts:2123:   }
030187| NOTE: Implementation detail supporting search page behavior.
030188| src/lib/data.ts:2124: 
030189| NOTE: Blank line for visual separation.
030190| src/lib/data.ts:2125:   const whereClause = conditions.join(" AND ");
030191| NOTE: Local declaration used by search logic or UI.
030192| src/lib/data.ts:2126: 
030193| NOTE: Blank line for visual separation.
030194| src/lib/data.ts:2127:   // Execute lightweight COUNT query only
030195| NOTE: Line comment documents intent or constraints.
030196| src/lib/data.ts:2128:   const countQuery = `
030197| NOTE: Local declaration used by search logic or UI.
030198| src/lib/data.ts:2129:         SELECT COUNT(DISTINCT l.id) as total
030199| NOTE: Implementation detail supporting search page behavior.
030200| src/lib/data.ts:2130:         FROM "Listing" l
030201| NOTE: Implementation detail supporting search page behavior.
030202| src/lib/data.ts:2131:         JOIN "Location" loc ON l.id = loc."listingId"
030203| NOTE: Implementation detail supporting search page behavior.
030204| src/lib/data.ts:2132:         WHERE ${whereClause}
030205| NOTE: Implementation detail supporting search page behavior.
030206| src/lib/data.ts:2133:     `;
030207| NOTE: Implementation detail supporting search page behavior.
030208| src/lib/data.ts:2134: 
030209| NOTE: Blank line for visual separation.
030210| src/lib/data.ts:2135:   try {
030211| NOTE: Implementation detail supporting search page behavior.
030212| src/lib/data.ts:2136:     const result = await prisma.$queryRawUnsafe<[{ total: bigint }]>(
030213| NOTE: Local declaration used by search logic or UI.
030214| src/lib/data.ts:2137:       countQuery,
030215| NOTE: Implementation detail supporting search page behavior.
030216| src/lib/data.ts:2138:       ...queryParams,
030217| NOTE: Implementation detail supporting search page behavior.
030218| src/lib/data.ts:2139:     );
030219| NOTE: Implementation detail supporting search page behavior.
030220| src/lib/data.ts:2140:     return Number(result[0]?.total ?? 0);
030221| NOTE: Return statement for component or helper output.
030222| src/lib/data.ts:2141:   } catch (error) {
030223| NOTE: Implementation detail supporting search page behavior.
030224| src/lib/data.ts:2142:     const dataError = wrapDatabaseError(error, "getListingsCountEfficient");
030225| NOTE: Local declaration used by search logic or UI.
030226| src/lib/data.ts:2143:     dataError.log({
030227| NOTE: Implementation detail supporting search page behavior.
030228| src/lib/data.ts:2144:       operation: "getListingsCountEfficient",
030229| NOTE: Implementation detail supporting search page behavior.
030230| src/lib/data.ts:2145:     });
030231| NOTE: Implementation detail supporting search page behavior.
030232| src/lib/data.ts:2146:     throw dataError;
030233| NOTE: Implementation detail supporting search page behavior.
030234| src/lib/data.ts:2147:   }
030235| NOTE: Implementation detail supporting search page behavior.
030236| src/lib/data.ts:2148: }
030237| NOTE: Implementation detail supporting search page behavior.
030238| src/lib/data.ts:2149: 
030239| NOTE: Blank line for visual separation.
030240| src/lib/data.ts:2150: // Safe wrapper for count queries in filter analysis - graceful degradation
030241| NOTE: Line comment documents intent or constraints.
030242| src/lib/data.ts:2151: async function safeGetCount(params: FilterParams): Promise<number | null> {
030243| NOTE: Implementation detail supporting search page behavior.
030244| src/lib/data.ts:2152:   try {
030245| NOTE: Implementation detail supporting search page behavior.
030246| src/lib/data.ts:2153:     return await getListingsCountEfficient(params);
030247| NOTE: Return statement for component or helper output.
030248| src/lib/data.ts:2154:   } catch (error) {
030249| NOTE: Implementation detail supporting search page behavior.
030250| src/lib/data.ts:2155:     logger.sync.warn("Filter analysis count failed", {
030251| NOTE: Implementation detail supporting search page behavior.
030252| src/lib/data.ts:2156:       error: error instanceof Error ? error.message : String(error),
030253| NOTE: Implementation detail supporting search page behavior.
030254| src/lib/data.ts:2157:     });
030255| NOTE: Implementation detail supporting search page behavior.
030256| src/lib/data.ts:2158:     return null; // Skip this suggestion
030257| NOTE: Return statement for component or helper output.
030258| src/lib/data.ts:2159:   }
030259| NOTE: Implementation detail supporting search page behavior.
030260| src/lib/data.ts:2160: }
030261| NOTE: Implementation detail supporting search page behavior.
030262| src/lib/data.ts:2161: 
030263| NOTE: Blank line for visual separation.
030264| src/lib/data.ts:2162: // Analyze which filters are most restrictive and suggest removing them
030265| NOTE: Line comment documents intent or constraints.
030266| src/lib/data.ts:2163: // P0 fix: Now uses efficient COUNT queries instead of fetching all data
030267| NOTE: Line comment documents intent or constraints.
030268| src/lib/data.ts:2164: // P2-10 enhancement: Run queries in parallel for better performance
030269| NOTE: Line comment documents intent or constraints.
030270| src/lib/data.ts:2165: export async function analyzeFilterImpact(
030271| NOTE: Implementation detail supporting search page behavior.
030272| src/lib/data.ts:2166:   params: FilterParams,
030273| NOTE: Implementation detail supporting search page behavior.
030274| src/lib/data.ts:2167: ): Promise<FilterSuggestion[]> {
030275| NOTE: Implementation detail supporting search page behavior.
030276| src/lib/data.ts:2168:   // Build array of filter tests to run in parallel
030277| NOTE: Line comment documents intent or constraints.
030278| src/lib/data.ts:2169:   interface FilterTest {
030279| NOTE: Type declaration for search data contracts.
030280| src/lib/data.ts:2170:     filter: string;
030281| NOTE: Implementation detail supporting search page behavior.
030282| src/lib/data.ts:2171:     label: string;
030283| NOTE: Implementation detail supporting search page behavior.
030284| src/lib/data.ts:2172:     params: FilterParams;
030285| NOTE: Implementation detail supporting search page behavior.
030286| src/lib/data.ts:2173:     makeSuggestion: (count: number) => string;
030287| NOTE: Implementation detail supporting search page behavior.
030288| src/lib/data.ts:2174:   }
030289| NOTE: Implementation detail supporting search page behavior.
030290| src/lib/data.ts:2175: 
030291| NOTE: Blank line for visual separation.
030292| src/lib/data.ts:2176:   const tests: FilterTest[] = [];
030293| NOTE: Local declaration used by search logic or UI.
030294| src/lib/data.ts:2177: 
030295| NOTE: Blank line for visual separation.
030296| src/lib/data.ts:2178:   // Test removing price filters
030297| NOTE: Line comment documents intent or constraints.
030298| src/lib/data.ts:2179:   if (params.maxPrice !== undefined) {
030299| NOTE: Conditional logic controlling rendering or flow.
030300| src/lib/data.ts:2180:     tests.push({
030301| NOTE: Implementation detail supporting search page behavior.
030302| src/lib/data.ts:2181:       filter: "maxPrice",
030303| NOTE: Implementation detail supporting search page behavior.
030304| src/lib/data.ts:2182:       label: `max price ($${params.maxPrice})`,
030305| NOTE: Implementation detail supporting search page behavior.
030306| src/lib/data.ts:2183:       params: { ...params, maxPrice: undefined },
030307| NOTE: Implementation detail supporting search page behavior.
030308| src/lib/data.ts:2184:       makeSuggestion: (count) =>
030309| NOTE: Implementation detail supporting search page behavior.
030310| src/lib/data.ts:2185:         `Increase your budget to see ${count} more listing${count > 1 ? "s" : ""}`,
030311| NOTE: Implementation detail supporting search page behavior.
030312| src/lib/data.ts:2186:     });
030313| NOTE: Implementation detail supporting search page behavior.
030314| src/lib/data.ts:2187:   }
030315| NOTE: Implementation detail supporting search page behavior.
030316| src/lib/data.ts:2188: 
030317| NOTE: Blank line for visual separation.
030318| src/lib/data.ts:2189:   if (params.minPrice !== undefined && params.minPrice > 0) {
030319| NOTE: Conditional logic controlling rendering or flow.
030320| src/lib/data.ts:2190:     tests.push({
030321| NOTE: Implementation detail supporting search page behavior.
030322| src/lib/data.ts:2191:       filter: "minPrice",
030323| NOTE: Implementation detail supporting search page behavior.
030324| src/lib/data.ts:2192:       label: `min price ($${params.minPrice})`,
030325| NOTE: Implementation detail supporting search page behavior.
030326| src/lib/data.ts:2193:       params: { ...params, minPrice: undefined },
030327| NOTE: Implementation detail supporting search page behavior.
030328| src/lib/data.ts:2194:       makeSuggestion: (count) =>
030329| NOTE: Implementation detail supporting search page behavior.
030330| src/lib/data.ts:2195:         `Lower your minimum budget to see ${count} more listing${count > 1 ? "s" : ""}`,
030331| NOTE: Implementation detail supporting search page behavior.
030332| src/lib/data.ts:2196:     });
030333| NOTE: Implementation detail supporting search page behavior.
030334| src/lib/data.ts:2197:   }
030335| NOTE: Implementation detail supporting search page behavior.
030336| src/lib/data.ts:2198: 
030337| NOTE: Blank line for visual separation.
030338| src/lib/data.ts:2199:   // Test removing amenities
030339| NOTE: Line comment documents intent or constraints.
030340| src/lib/data.ts:2200:   if (params.amenities && params.amenities.length > 0) {
030341| NOTE: Conditional logic controlling rendering or flow.
030342| src/lib/data.ts:2201:     tests.push({
030343| NOTE: Implementation detail supporting search page behavior.
030344| src/lib/data.ts:2202:       filter: "amenities",
030345| NOTE: Implementation detail supporting search page behavior.
030346| src/lib/data.ts:2203:       label: `amenities (${params.amenities.join(", ")})`,
030347| NOTE: Implementation detail supporting search page behavior.
030348| src/lib/data.ts:2204:       params: { ...params, amenities: [] },
030349| NOTE: Implementation detail supporting search page behavior.
030350| src/lib/data.ts:2205:       makeSuggestion: (count) =>
030351| NOTE: Implementation detail supporting search page behavior.
030352| src/lib/data.ts:2206:         `Remove amenity filters to see ${count} listing${count > 1 ? "s" : ""}`,
030353| NOTE: Implementation detail supporting search page behavior.
030354| src/lib/data.ts:2207:     });
030355| NOTE: Implementation detail supporting search page behavior.
030356| src/lib/data.ts:2208:   }
030357| NOTE: Implementation detail supporting search page behavior.
030358| src/lib/data.ts:2209: 
030359| NOTE: Blank line for visual separation.
030360| src/lib/data.ts:2210:   // Test removing house rules
030361| NOTE: Line comment documents intent or constraints.
030362| src/lib/data.ts:2211:   if (params.houseRules && params.houseRules.length > 0) {
030363| NOTE: Conditional logic controlling rendering or flow.
030364| src/lib/data.ts:2212:     tests.push({
030365| NOTE: Implementation detail supporting search page behavior.
030366| src/lib/data.ts:2213:       filter: "houseRules",
030367| NOTE: Implementation detail supporting search page behavior.
030368| src/lib/data.ts:2214:       label: `house rules (${params.houseRules.join(", ")})`,
030369| NOTE: Implementation detail supporting search page behavior.
030370| src/lib/data.ts:2215:       params: { ...params, houseRules: [] },
030371| NOTE: Implementation detail supporting search page behavior.
030372| src/lib/data.ts:2216:       makeSuggestion: (count) =>
030373| NOTE: Implementation detail supporting search page behavior.
030374| src/lib/data.ts:2217:         `Remove house rules filters to see ${count} listing${count > 1 ? "s" : ""}`,
030375| NOTE: Implementation detail supporting search page behavior.
030376| src/lib/data.ts:2218:     });
030377| NOTE: Implementation detail supporting search page behavior.
030378| src/lib/data.ts:2219:   }
030379| NOTE: Implementation detail supporting search page behavior.
030380| src/lib/data.ts:2220: 
030381| NOTE: Blank line for visual separation.
030382| src/lib/data.ts:2221:   // Test removing room type
030383| NOTE: Line comment documents intent or constraints.
030384| src/lib/data.ts:2222:   if (params.roomType) {
030385| NOTE: Conditional logic controlling rendering or flow.
030386| src/lib/data.ts:2223:     tests.push({
030387| NOTE: Implementation detail supporting search page behavior.
030388| src/lib/data.ts:2224:       filter: "roomType",
030389| NOTE: Implementation detail supporting search page behavior.
030390| src/lib/data.ts:2225:       label: `room type (${params.roomType})`,
030391| NOTE: Implementation detail supporting search page behavior.
030392| src/lib/data.ts:2226:       params: { ...params, roomType: undefined },
030393| NOTE: Implementation detail supporting search page behavior.
030394| src/lib/data.ts:2227:       makeSuggestion: (count) =>
030395| NOTE: Implementation detail supporting search page behavior.
030396| src/lib/data.ts:2228:         `Include all room types to see ${count} listing${count > 1 ? "s" : ""}`,
030397| NOTE: Implementation detail supporting search page behavior.
030398| src/lib/data.ts:2229:     });
030399| NOTE: Implementation detail supporting search page behavior.
030400| src/lib/data.ts:2230:   }
030401| NOTE: Implementation detail supporting search page behavior.
030402| src/lib/data.ts:2231: 
030403| NOTE: Blank line for visual separation.
030404| src/lib/data.ts:2232:   // Test removing lease duration
030405| NOTE: Line comment documents intent or constraints.
030406| src/lib/data.ts:2233:   if (params.leaseDuration) {
030407| NOTE: Conditional logic controlling rendering or flow.
030408| src/lib/data.ts:2234:     tests.push({
030409| NOTE: Implementation detail supporting search page behavior.
030410| src/lib/data.ts:2235:       filter: "leaseDuration",
030411| NOTE: Implementation detail supporting search page behavior.
030412| src/lib/data.ts:2236:       label: `lease duration (${params.leaseDuration})`,
030413| NOTE: Implementation detail supporting search page behavior.
030414| src/lib/data.ts:2237:       params: { ...params, leaseDuration: undefined },
030415| NOTE: Implementation detail supporting search page behavior.
030416| src/lib/data.ts:2238:       makeSuggestion: (count) =>
030417| NOTE: Implementation detail supporting search page behavior.
030418| src/lib/data.ts:2239:         `Include all lease durations to see ${count} listing${count > 1 ? "s" : ""}`,
030419| NOTE: Implementation detail supporting search page behavior.
030420| src/lib/data.ts:2240:     });
030421| NOTE: Implementation detail supporting search page behavior.
030422| src/lib/data.ts:2241:   }
030423| NOTE: Implementation detail supporting search page behavior.
030424| src/lib/data.ts:2242: 
030425| NOTE: Blank line for visual separation.
030426| src/lib/data.ts:2243:   // Test removing location bounds (search area)
030427| NOTE: Line comment documents intent or constraints.
030428| src/lib/data.ts:2244:   if (params.bounds) {
030429| NOTE: Conditional logic controlling rendering or flow.
030430| src/lib/data.ts:2245:     tests.push({
030431| NOTE: Implementation detail supporting search page behavior.
030432| src/lib/data.ts:2246:       filter: "location",
030433| NOTE: Implementation detail supporting search page behavior.
030434| src/lib/data.ts:2247:       label: "search area",
030435| NOTE: Implementation detail supporting search page behavior.
030436| src/lib/data.ts:2248:       params: { ...params, bounds: undefined },
030437| NOTE: Implementation detail supporting search page behavior.
030438| src/lib/data.ts:2249:       makeSuggestion: (count) =>
030439| NOTE: Implementation detail supporting search page behavior.
030440| src/lib/data.ts:2250:         `Expand your search area to see ${count} listing${count > 1 ? "s" : ""}`,
030441| NOTE: Implementation detail supporting search page behavior.
030442| src/lib/data.ts:2251:     });
030443| NOTE: Implementation detail supporting search page behavior.
030444| src/lib/data.ts:2252:   }
030445| NOTE: Implementation detail supporting search page behavior.
030446| src/lib/data.ts:2253: 
030447| NOTE: Blank line for visual separation.
030448| src/lib/data.ts:2254:   // If no filters to test, return empty array
030449| NOTE: Line comment documents intent or constraints.
030450| src/lib/data.ts:2255:   if (tests.length === 0) {
030451| NOTE: Conditional logic controlling rendering or flow.
030452| src/lib/data.ts:2256:     return [];
030453| NOTE: Return statement for component or helper output.
030454| src/lib/data.ts:2257:   }
030455| NOTE: Implementation detail supporting search page behavior.
030456| src/lib/data.ts:2258: 
030457| NOTE: Blank line for visual separation.
030458| src/lib/data.ts:2259:   // Run all count queries in parallel for better performance
030459| NOTE: Line comment documents intent or constraints.
030460| src/lib/data.ts:2260:   const results = await Promise.all(
030461| NOTE: Local declaration used by search logic or UI.
030462| src/lib/data.ts:2261:     tests.map(async (test) => {
030463| NOTE: Implementation detail supporting search page behavior.
030464| src/lib/data.ts:2262:       const count = await safeGetCount(test.params);
030465| NOTE: Local declaration used by search logic or UI.
030466| src/lib/data.ts:2263:       return { test, count };
030467| NOTE: Return statement for component or helper output.
030468| src/lib/data.ts:2264:     }),
030469| NOTE: Implementation detail supporting search page behavior.
030470| src/lib/data.ts:2265:   );
030471| NOTE: Implementation detail supporting search page behavior.
030472| src/lib/data.ts:2266: 
030473| NOTE: Blank line for visual separation.
030474| src/lib/data.ts:2267:   // Build suggestions from results, filtering out null/zero counts
030475| NOTE: Line comment documents intent or constraints.
030476| src/lib/data.ts:2268:   const suggestions: FilterSuggestion[] = results
030477| NOTE: Local declaration used by search logic or UI.
030478| src/lib/data.ts:2269:     .filter(({ count }) => count !== null && count > 0)
030479| NOTE: Implementation detail supporting search page behavior.
030480| src/lib/data.ts:2270:     .map(({ test, count }) => ({
030481| NOTE: Implementation detail supporting search page behavior.
030482| src/lib/data.ts:2271:       filter: test.filter,
030483| NOTE: Implementation detail supporting search page behavior.
030484| src/lib/data.ts:2272:       label: test.label,
030485| NOTE: Implementation detail supporting search page behavior.
030486| src/lib/data.ts:2273:       resultsWithout: count!,
030487| NOTE: Implementation detail supporting search page behavior.
030488| src/lib/data.ts:2274:       suggestion: test.makeSuggestion(count!),
030489| NOTE: Implementation detail supporting search page behavior.
030490| src/lib/data.ts:2275:     }));
030491| NOTE: Implementation detail supporting search page behavior.
030492| src/lib/data.ts:2276: 
030493| NOTE: Blank line for visual separation.
030494| src/lib/data.ts:2277:   // Sort by impact (most results unlocked first)
030495| NOTE: Line comment documents intent or constraints.
030496| src/lib/data.ts:2278:   suggestions.sort((a, b) => b.resultsWithout - a.resultsWithout);
030497| NOTE: Implementation detail supporting search page behavior.
030498| src/lib/data.ts:2279: 
030499| NOTE: Blank line for visual separation.
030500| src/lib/data.ts:2280:   // Mark the most impactful suggestion
030501| NOTE: Line comment documents intent or constraints.
030502| src/lib/data.ts:2281:   if (suggestions.length > 0) {
030503| NOTE: Conditional logic controlling rendering or flow.
030504| src/lib/data.ts:2282:     suggestions[0].isMostImpactful = true;
030505| NOTE: Implementation detail supporting search page behavior.
030506| src/lib/data.ts:2283:   }
030507| NOTE: Implementation detail supporting search page behavior.
030508| src/lib/data.ts:2284: 
030509| NOTE: Blank line for visual separation.
030510| src/lib/data.ts:2285:   return suggestions;
030511| NOTE: Return statement for component or helper output.
030512| src/lib/data.ts:2286: }
030513| NOTE: Implementation detail supporting search page behavior.
030514| src/lib/data.ts:2287: 
030515| NOTE: Blank line for visual separation.
030516| src/lib/data.ts:2288: export async function getSavedListingIds(userId: string): Promise<string[]> {
030517| NOTE: Implementation detail supporting search page behavior.
030518| src/lib/data.ts:2289:   const saved = await prisma.savedListing.findMany({
030519| NOTE: Local declaration used by search logic or UI.
030520| src/lib/data.ts:2290:     where: { userId },
030521| NOTE: Implementation detail supporting search page behavior.
030522| src/lib/data.ts:2291:     select: { listingId: true },
030523| NOTE: Implementation detail supporting search page behavior.
030524| src/lib/data.ts:2292:   });
030525| NOTE: Implementation detail supporting search page behavior.
030526| src/lib/data.ts:2293:   return saved.map((s) => s.listingId);
030527| NOTE: Return statement for component or helper output.
030528| src/lib/data.ts:2294: }
030529| NOTE: Implementation detail supporting search page behavior.
030530| src/lib/data.ts:2295: 
030531| NOTE: Blank line for visual separation.
030532| src/lib/data.ts:2296: export async function getSavedListings(userId: string): Promise<ListingData[]> {
030533| NOTE: Implementation detail supporting search page behavior.
030534| src/lib/data.ts:2297:   // Use raw query to properly fetch PostGIS coordinates
030535| NOTE: Line comment documents intent or constraints.
030536| src/lib/data.ts:2298:   const savedListings = await prisma.$queryRaw<
030537| NOTE: Local declaration used by search logic or UI.
030538| src/lib/data.ts:2299:     Array<{
030539| NOTE: Implementation detail supporting search page behavior.
030540| src/lib/data.ts:2300:       id: string;
030541| NOTE: Implementation detail supporting search page behavior.
030542| src/lib/data.ts:2301:       title: string;
030543| NOTE: Implementation detail supporting search page behavior.
030544| src/lib/data.ts:2302:       description: string;
030545| NOTE: Implementation detail supporting search page behavior.
030546| src/lib/data.ts:2303:       price: number;
030547| NOTE: Implementation detail supporting search page behavior.
030548| src/lib/data.ts:2304:       images: string[];
030549| NOTE: Implementation detail supporting search page behavior.
030550| src/lib/data.ts:2305:       availableSlots: number;
030551| NOTE: Implementation detail supporting search page behavior.
030552| src/lib/data.ts:2306:       totalSlots: number;
030553| NOTE: Implementation detail supporting search page behavior.
030554| src/lib/data.ts:2307:       amenities: string[];
030555| NOTE: Implementation detail supporting search page behavior.
030556| src/lib/data.ts:2308:       houseRules: string[];
030557| NOTE: Implementation detail supporting search page behavior.
030558| src/lib/data.ts:2309:       household_languages: string[];
030559| NOTE: Implementation detail supporting search page behavior.
030560| src/lib/data.ts:2310:       primary_home_language: string | null;
030561| NOTE: Implementation detail supporting search page behavior.
030562| src/lib/data.ts:2311:       leaseDuration: string | null;
030563| NOTE: Implementation detail supporting search page behavior.
030564| src/lib/data.ts:2312:       roomType: string | null;
030565| NOTE: Implementation detail supporting search page behavior.
030566| src/lib/data.ts:2313:       moveInDate: Date | null;
030567| NOTE: Implementation detail supporting search page behavior.
030568| src/lib/data.ts:2314:       ownerId: string;
030569| NOTE: Implementation detail supporting search page behavior.
030570| src/lib/data.ts:2315:       address: string;
030571| NOTE: Implementation detail supporting search page behavior.
030572| src/lib/data.ts:2316:       city: string;
030573| NOTE: Implementation detail supporting search page behavior.
030574| src/lib/data.ts:2317:       state: string;
030575| NOTE: Implementation detail supporting search page behavior.
030576| src/lib/data.ts:2318:       zip: string;
030577| NOTE: Implementation detail supporting search page behavior.
030578| src/lib/data.ts:2319:       lat: number;
030579| NOTE: Implementation detail supporting search page behavior.
030580| src/lib/data.ts:2320:       lng: number;
030581| NOTE: Implementation detail supporting search page behavior.
030582| src/lib/data.ts:2321:     }>
030583| NOTE: Implementation detail supporting search page behavior.
030584| src/lib/data.ts:2322:   >`
030585| NOTE: Implementation detail supporting search page behavior.
030586| src/lib/data.ts:2323:         SELECT
030587| NOTE: Implementation detail supporting search page behavior.
030588| src/lib/data.ts:2324:             l.id,
030589| NOTE: Implementation detail supporting search page behavior.
030590| src/lib/data.ts:2325:             l.title,
030591| NOTE: Implementation detail supporting search page behavior.
030592| src/lib/data.ts:2326:             l.description,
030593| NOTE: Implementation detail supporting search page behavior.
030594| src/lib/data.ts:2327:             l.price,
030595| NOTE: Implementation detail supporting search page behavior.
030596| src/lib/data.ts:2328:             l.images,
030597| NOTE: Implementation detail supporting search page behavior.
030598| src/lib/data.ts:2329:             l."availableSlots",
030599| NOTE: Implementation detail supporting search page behavior.
030600| src/lib/data.ts:2330:             l."totalSlots",
030601| NOTE: Implementation detail supporting search page behavior.
030602| src/lib/data.ts:2331:             l.amenities,
030603| NOTE: Implementation detail supporting search page behavior.
030604| src/lib/data.ts:2332:             l."houseRules",
030605| NOTE: Implementation detail supporting search page behavior.
030606| src/lib/data.ts:2333:             l."household_languages",
030607| NOTE: Implementation detail supporting search page behavior.
030608| src/lib/data.ts:2334:             l."primary_home_language",
030609| NOTE: Implementation detail supporting search page behavior.
030610| src/lib/data.ts:2335:             l."leaseDuration",
030611| NOTE: Implementation detail supporting search page behavior.
030612| src/lib/data.ts:2336:             l."roomType",
030613| NOTE: Implementation detail supporting search page behavior.
030614| src/lib/data.ts:2337:             l."moveInDate",
030615| NOTE: Implementation detail supporting search page behavior.
030616| src/lib/data.ts:2338:             l."ownerId",
030617| NOTE: Implementation detail supporting search page behavior.
030618| src/lib/data.ts:2339:             loc.address,
030619| NOTE: Implementation detail supporting search page behavior.
030620| src/lib/data.ts:2340:             loc.city,
030621| NOTE: Implementation detail supporting search page behavior.
030622| src/lib/data.ts:2341:             loc.state,
030623| NOTE: Implementation detail supporting search page behavior.
030624| src/lib/data.ts:2342:             loc.zip,
030625| NOTE: Implementation detail supporting search page behavior.
030626| src/lib/data.ts:2343:             ST_Y(loc.coords::geometry) as lat,
030627| NOTE: Implementation detail supporting search page behavior.
030628| src/lib/data.ts:2344:             ST_X(loc.coords::geometry) as lng
030629| NOTE: Implementation detail supporting search page behavior.
030630| src/lib/data.ts:2345:         FROM "SavedListing" sl
030631| NOTE: Implementation detail supporting search page behavior.
030632| src/lib/data.ts:2346:         JOIN "Listing" l ON sl."listingId" = l.id
030633| NOTE: Implementation detail supporting search page behavior.
030634| src/lib/data.ts:2347:         JOIN "Location" loc ON l.id = loc."listingId"
030635| NOTE: Implementation detail supporting search page behavior.
030636| src/lib/data.ts:2348:         WHERE sl."userId" = ${userId}
030637| NOTE: Implementation detail supporting search page behavior.
030638| src/lib/data.ts:2349:             AND l.status = 'ACTIVE'
030639| NOTE: Implementation detail supporting search page behavior.
030640| src/lib/data.ts:2350:             AND ST_X(loc.coords::geometry) IS NOT NULL
030641| NOTE: Implementation detail supporting search page behavior.
030642| src/lib/data.ts:2351:             AND ST_Y(loc.coords::geometry) IS NOT NULL
030643| NOTE: Implementation detail supporting search page behavior.
030644| src/lib/data.ts:2352:             AND NOT (ST_X(loc.coords::geometry) = 0 AND ST_Y(loc.coords::geometry) = 0)
030645| NOTE: Implementation detail supporting search page behavior.
030646| src/lib/data.ts:2353:         ORDER BY sl."createdAt" DESC
030647| NOTE: Implementation detail supporting search page behavior.
030648| src/lib/data.ts:2354:     `;
030649| NOTE: Implementation detail supporting search page behavior.
030650| src/lib/data.ts:2355: 
030651| NOTE: Blank line for visual separation.
030652| src/lib/data.ts:2356:   // Filter out any listings with invalid coordinates and map to ListingData
030653| NOTE: Line comment documents intent or constraints.
030654| src/lib/data.ts:2357:   return savedListings
030655| NOTE: Return statement for component or helper output.
030656| src/lib/data.ts:2358:     .filter((l) => hasValidCoordinates(l.lat, l.lng))
030657| NOTE: Implementation detail supporting search page behavior.
030658| src/lib/data.ts:2359:     .map((l) => ({
030659| NOTE: Implementation detail supporting search page behavior.
030660| src/lib/data.ts:2360:       id: l.id,
030661| NOTE: Implementation detail supporting search page behavior.
030662| src/lib/data.ts:2361:       title: l.title,
030663| NOTE: Implementation detail supporting search page behavior.
030664| src/lib/data.ts:2362:       description: l.description,
030665| NOTE: Implementation detail supporting search page behavior.
030666| src/lib/data.ts:2363:       price: l.price,
030667| NOTE: Implementation detail supporting search page behavior.
030668| src/lib/data.ts:2364:       images: l.images || [],
030669| NOTE: Implementation detail supporting search page behavior.
030670| src/lib/data.ts:2365:       availableSlots: l.availableSlots,
030671| NOTE: Implementation detail supporting search page behavior.
030672| src/lib/data.ts:2366:       totalSlots: l.totalSlots,
030673| NOTE: Implementation detail supporting search page behavior.
030674| src/lib/data.ts:2367:       amenities: l.amenities || [],
030675| NOTE: Implementation detail supporting search page behavior.
030676| src/lib/data.ts:2368:       houseRules: l.houseRules || [],
030677| NOTE: Implementation detail supporting search page behavior.
030678| src/lib/data.ts:2369:       householdLanguages: l.household_languages || [],
030679| NOTE: Implementation detail supporting search page behavior.
030680| src/lib/data.ts:2370:       primaryHomeLanguage: l.primary_home_language ?? undefined,
030681| NOTE: Implementation detail supporting search page behavior.
030682| src/lib/data.ts:2371:       leaseDuration: l.leaseDuration ?? undefined,
030683| NOTE: Implementation detail supporting search page behavior.
030684| src/lib/data.ts:2372:       roomType: l.roomType ?? undefined,
030685| NOTE: Implementation detail supporting search page behavior.
030686| src/lib/data.ts:2373:       moveInDate: l.moveInDate ? new Date(l.moveInDate) : undefined,
030687| NOTE: Implementation detail supporting search page behavior.
030688| src/lib/data.ts:2374:       ownerId: l.ownerId,
030689| NOTE: Implementation detail supporting search page behavior.
030690| src/lib/data.ts:2375:       location: {
030691| NOTE: Implementation detail supporting search page behavior.
030692| src/lib/data.ts:2376:         address: l.address,
030693| NOTE: Implementation detail supporting search page behavior.
030694| src/lib/data.ts:2377:         city: l.city,
030695| NOTE: Implementation detail supporting search page behavior.
030696| src/lib/data.ts:2378:         state: l.state,
030697| NOTE: Implementation detail supporting search page behavior.
030698| src/lib/data.ts:2379:         zip: l.zip,
030699| NOTE: Implementation detail supporting search page behavior.
030700| src/lib/data.ts:2380:         lat: l.lat,
030701| NOTE: Implementation detail supporting search page behavior.
030702| src/lib/data.ts:2381:         lng: l.lng,
030703| NOTE: Implementation detail supporting search page behavior.
030704| src/lib/data.ts:2382:       },
030705| NOTE: Implementation detail supporting search page behavior.
030706| src/lib/data.ts:2383:     }));
030707| NOTE: Implementation detail supporting search page behavior.
030708| src/lib/data.ts:2384: }
030709| NOTE: Implementation detail supporting search page behavior.
030710| src/lib/data.ts:2385: 
030711| NOTE: Blank line for visual separation.
030712| src/lib/data.ts:2386: export async function getReviews(listingId?: string, userId?: string) {
030713| NOTE: Implementation detail supporting search page behavior.
030714| src/lib/data.ts:2387:   if (!listingId && !userId) return [];
030715| NOTE: Conditional logic controlling rendering or flow.
030716| src/lib/data.ts:2388: 
030717| NOTE: Blank line for visual separation.
030718| src/lib/data.ts:2389:   return await prisma.review.findMany({
030719| NOTE: Return statement for component or helper output.
030720| src/lib/data.ts:2390:     where: {
030721| NOTE: Implementation detail supporting search page behavior.
030722| src/lib/data.ts:2391:       ...(listingId ? { listingId } : {}),
030723| NOTE: Implementation detail supporting search page behavior.
030724| src/lib/data.ts:2392:       ...(userId ? { targetUserId: userId } : {}),
030725| NOTE: Implementation detail supporting search page behavior.
030726| src/lib/data.ts:2393:     },
030727| NOTE: Implementation detail supporting search page behavior.
030728| src/lib/data.ts:2394:     include: {
030729| NOTE: Implementation detail supporting search page behavior.
030730| src/lib/data.ts:2395:       author: {
030731| NOTE: Implementation detail supporting search page behavior.
030732| src/lib/data.ts:2396:         select: {
030733| NOTE: Implementation detail supporting search page behavior.
030734| src/lib/data.ts:2397:           id: true,
030735| NOTE: Implementation detail supporting search page behavior.
030736| src/lib/data.ts:2398:           name: true,
030737| NOTE: Implementation detail supporting search page behavior.
030738| src/lib/data.ts:2399:           image: true,
030739| NOTE: Implementation detail supporting search page behavior.
030740| src/lib/data.ts:2400:         },
030741| NOTE: Implementation detail supporting search page behavior.
030742| src/lib/data.ts:2401:       },
030743| NOTE: Implementation detail supporting search page behavior.
030744| src/lib/data.ts:2402:     },
030745| NOTE: Implementation detail supporting search page behavior.
030746| src/lib/data.ts:2403:     orderBy: {
030747| NOTE: Implementation detail supporting search page behavior.
030748| src/lib/data.ts:2404:       createdAt: "desc",
030749| NOTE: Implementation detail supporting search page behavior.
030750| src/lib/data.ts:2405:     },
030751| NOTE: Implementation detail supporting search page behavior.
030752| src/lib/data.ts:2406:   });
030753| NOTE: Implementation detail supporting search page behavior.
030754| src/lib/data.ts:2407: }
030755| NOTE: Implementation detail supporting search page behavior.
030756| src/lib/data.ts:2408: 
030757| NOTE: Blank line for visual separation.
030758| src/lib/data.ts:2409: export async function getAverageRating(listingId?: string, userId?: string) {
030759| NOTE: Implementation detail supporting search page behavior.
030760| src/lib/data.ts:2410:   if (!listingId && !userId) return 0;
030761| NOTE: Conditional logic controlling rendering or flow.
030762| src/lib/data.ts:2411: 
030763| NOTE: Blank line for visual separation.
030764| src/lib/data.ts:2412:   const aggregations = await prisma.review.aggregate({
030765| NOTE: Local declaration used by search logic or UI.
030766| src/lib/data.ts:2413:     _avg: {
030767| NOTE: Implementation detail supporting search page behavior.
030768| src/lib/data.ts:2414:       rating: true,
030769| NOTE: Implementation detail supporting search page behavior.
030770| src/lib/data.ts:2415:     },
030771| NOTE: Implementation detail supporting search page behavior.
030772| src/lib/data.ts:2416:     where: {
030773| NOTE: Implementation detail supporting search page behavior.
030774| src/lib/data.ts:2417:       ...(listingId ? { listingId } : {}),
030775| NOTE: Implementation detail supporting search page behavior.
030776| src/lib/data.ts:2418:       ...(userId ? { targetUserId: userId } : {}),
030777| NOTE: Implementation detail supporting search page behavior.
030778| src/lib/data.ts:2419:     },
030779| NOTE: Implementation detail supporting search page behavior.
030780| src/lib/data.ts:2420:   });
030781| NOTE: Implementation detail supporting search page behavior.
030782| src/lib/data.ts:2421: 
030783| NOTE: Blank line for visual separation.
030784| src/lib/data.ts:2422:   return aggregations._avg.rating || 0;
030785| NOTE: Return statement for component or helper output.
030786| src/lib/data.ts:2423: }
030787| NOTE: Implementation detail supporting search page behavior.
030788| FILE END: src/lib/data.ts
030789| 
030790| FILE START: src/lib/env.ts
030791| FILE ROLE: Auto-discovered dependency in search page graph.
030792| src/lib/env.ts:1: /**
030793| NOTE: Block comment line describing behavior or context.
030794| src/lib/env.ts:2:  * Centralized environment validation using Zod
030795| NOTE: Block comment line describing behavior or context.
030796| src/lib/env.ts:3:  * Validates all required and optional environment variables at startup
030797| NOTE: Block comment line describing behavior or context.
030798| src/lib/env.ts:4:  * Fails fast if critical variables are missing
030799| NOTE: Block comment line describing behavior or context.
030800| src/lib/env.ts:5:  */
030801| NOTE: Block comment line describing behavior or context.
030802| src/lib/env.ts:6: 
030803| NOTE: Blank line for visual separation.
030804| src/lib/env.ts:7: import { z } from "zod";
030805| NOTE: Imports dependency for this module.
030806| src/lib/env.ts:8: 
030807| NOTE: Blank line for visual separation.
030808| src/lib/env.ts:9: // Schema for server-side environment variables
030809| NOTE: Line comment documents intent or constraints.
030810| src/lib/env.ts:10: const serverEnvSchema = z.object({
030811| NOTE: Local declaration used by search logic or UI.
030812| src/lib/env.ts:11:   // Database (REQUIRED)
030813| NOTE: Line comment documents intent or constraints.
030814| src/lib/env.ts:12:   DATABASE_URL: z.string().min(1, "DATABASE_URL is required"),
030815| NOTE: Implementation detail supporting search page behavior.
030816| src/lib/env.ts:13: 
030817| NOTE: Blank line for visual separation.
030818| src/lib/env.ts:14:   // Authentication (REQUIRED)
030819| NOTE: Line comment documents intent or constraints.
030820| src/lib/env.ts:15:   NEXTAUTH_SECRET: z
030821| NOTE: Implementation detail supporting search page behavior.
030822| src/lib/env.ts:16:     .string()
030823| NOTE: Implementation detail supporting search page behavior.
030824| src/lib/env.ts:17:     .min(32, "NEXTAUTH_SECRET must be at least 32 characters"),
030825| NOTE: Implementation detail supporting search page behavior.
030826| src/lib/env.ts:18:   NEXTAUTH_URL: z.string().url("NEXTAUTH_URL must be a valid URL"),
030827| NOTE: Implementation detail supporting search page behavior.
030828| src/lib/env.ts:19:   GOOGLE_CLIENT_ID: z.string().min(1, "GOOGLE_CLIENT_ID is required"),
030829| NOTE: Implementation detail supporting search page behavior.
030830| src/lib/env.ts:20:   GOOGLE_CLIENT_SECRET: z.string().min(1, "GOOGLE_CLIENT_SECRET is required"),
030831| NOTE: Implementation detail supporting search page behavior.
030832| src/lib/env.ts:21: 
030833| NOTE: Blank line for visual separation.
030834| src/lib/env.ts:22:   // Email (optional - gracefully degrades)
030835| NOTE: Line comment documents intent or constraints.
030836| src/lib/env.ts:23:   RESEND_API_KEY: z.string().optional(),
030837| NOTE: Implementation detail supporting search page behavior.
030838| src/lib/env.ts:24:   FROM_EMAIL: z.string().optional(),
030839| NOTE: Implementation detail supporting search page behavior.
030840| src/lib/env.ts:25: 
030841| NOTE: Blank line for visual separation.
030842| src/lib/env.ts:26:   // Geocoding (optional - gracefully degrades)
030843| NOTE: Line comment documents intent or constraints.
030844| src/lib/env.ts:27:   MAPBOX_ACCESS_TOKEN: z.string().optional(),
030845| NOTE: Implementation detail supporting search page behavior.
030846| src/lib/env.ts:28: 
030847| NOTE: Blank line for visual separation.
030848| src/lib/env.ts:29:   // Redis Rate Limiting (optional - falls back to DB)
030849| NOTE: Line comment documents intent or constraints.
030850| src/lib/env.ts:30:   UPSTASH_REDIS_REST_URL: z.string().url().optional(),
030851| NOTE: Implementation detail supporting search page behavior.
030852| src/lib/env.ts:31:   UPSTASH_REDIS_REST_TOKEN: z.string().optional(),
030853| NOTE: Implementation detail supporting search page behavior.
030854| src/lib/env.ts:32: 
030855| NOTE: Blank line for visual separation.
030856| src/lib/env.ts:33:   // AI Chat (optional - gracefully degrades)
030857| NOTE: Line comment documents intent or constraints.
030858| src/lib/env.ts:34:   GROQ_API_KEY: z.string().optional(),
030859| NOTE: Implementation detail supporting search page behavior.
030860| src/lib/env.ts:35: 
030861| NOTE: Blank line for visual separation.
030862| src/lib/env.ts:36:   // Error Tracking (optional but recommended for production)
030863| NOTE: Line comment documents intent or constraints.
030864| src/lib/env.ts:37:   SENTRY_DSN: z.string().url().optional(),
030865| NOTE: Implementation detail supporting search page behavior.
030866| src/lib/env.ts:38:   SENTRY_AUTH_TOKEN: z.string().optional(),
030867| NOTE: Implementation detail supporting search page behavior.
030868| src/lib/env.ts:39: 
030869| NOTE: Blank line for visual separation.
030870| src/lib/env.ts:40:   // Vercel-specific (auto-populated)
030871| NOTE: Line comment documents intent or constraints.
030872| src/lib/env.ts:41:   VERCEL_ENV: z.enum(["production", "preview", "development"]).optional(),
030873| NOTE: Implementation detail supporting search page behavior.
030874| src/lib/env.ts:42:   VERCEL_GIT_COMMIT_SHA: z.string().optional(),
030875| NOTE: Implementation detail supporting search page behavior.
030876| src/lib/env.ts:43: 
030877| NOTE: Blank line for visual separation.
030878| src/lib/env.ts:44:   // Security: Cron authentication (required in production)
030879| NOTE: Line comment documents intent or constraints.
030880| src/lib/env.ts:45:   CRON_SECRET: z
030881| NOTE: Implementation detail supporting search page behavior.
030882| src/lib/env.ts:46:     .string()
030883| NOTE: Implementation detail supporting search page behavior.
030884| src/lib/env.ts:47:     .min(32, "CRON_SECRET must be at least 32 characters")
030885| NOTE: Implementation detail supporting search page behavior.
030886| src/lib/env.ts:48:     .optional()
030887| NOTE: Implementation detail supporting search page behavior.
030888| src/lib/env.ts:49:     .refine(
030889| NOTE: Implementation detail supporting search page behavior.
030890| src/lib/env.ts:50:       (val) => !val || !val.includes("change-in-production"),
030891| NOTE: Implementation detail supporting search page behavior.
030892| src/lib/env.ts:51:       "CRON_SECRET must not contain placeholder values",
030893| NOTE: Implementation detail supporting search page behavior.
030894| src/lib/env.ts:52:     )
030895| NOTE: Implementation detail supporting search page behavior.
030896| src/lib/env.ts:53:     .refine(
030897| NOTE: Implementation detail supporting search page behavior.
030898| src/lib/env.ts:54:       (val) => process.env.NODE_ENV !== "production" || !!val,
030899| NOTE: Implementation detail supporting search page behavior.
030900| src/lib/env.ts:55:       "CRON_SECRET is required in production",
030901| NOTE: Implementation detail supporting search page behavior.
030902| src/lib/env.ts:56:     ),
030903| NOTE: Implementation detail supporting search page behavior.
030904| src/lib/env.ts:57: 
030905| NOTE: Blank line for visual separation.
030906| src/lib/env.ts:58:   // Security: Origin enforcement (comma-separated URLs)
030907| NOTE: Line comment documents intent or constraints.
030908| src/lib/env.ts:59:   ALLOWED_ORIGINS: z.string().optional(),
030909| NOTE: Implementation detail supporting search page behavior.
030910| src/lib/env.ts:60:   ALLOWED_HOSTS: z.string().optional(),
030911| NOTE: Implementation detail supporting search page behavior.
030912| src/lib/env.ts:61: 
030913| NOTE: Blank line for visual separation.
030914| src/lib/env.ts:62:   // Privacy: Metrics HMAC
030915| NOTE: Line comment documents intent or constraints.
030916| src/lib/env.ts:63:   LOG_HMAC_SECRET: z
030917| NOTE: Implementation detail supporting search page behavior.
030918| src/lib/env.ts:64:     .string()
030919| NOTE: Implementation detail supporting search page behavior.
030920| src/lib/env.ts:65:     .min(32, "LOG_HMAC_SECRET must be at least 32 characters")
030921| NOTE: Implementation detail supporting search page behavior.
030922| src/lib/env.ts:66:     .optional(),
030923| NOTE: Implementation detail supporting search page behavior.
030924| src/lib/env.ts:67: 
030925| NOTE: Blank line for visual separation.
030926| src/lib/env.ts:68:   // Google Places (server-side, IP-restricted key)
030927| NOTE: Line comment documents intent or constraints.
030928| src/lib/env.ts:69:   GOOGLE_PLACES_API_KEY: z.string().optional(),
030929| NOTE: Implementation detail supporting search page behavior.
030930| src/lib/env.ts:70: 
030931| NOTE: Blank line for visual separation.
030932| src/lib/env.ts:71:   // Supabase service key (server-side)
030933| NOTE: Line comment documents intent or constraints.
030934| src/lib/env.ts:72:   SUPABASE_SERVICE_ROLE_KEY: z.string().optional(),
030935| NOTE: Implementation detail supporting search page behavior.
030936| src/lib/env.ts:73: 
030937| NOTE: Blank line for visual separation.
030938| src/lib/env.ts:74:   // Radar API (server-side, for nearby places search)
030939| NOTE: Line comment documents intent or constraints.
030940| src/lib/env.ts:75:   RADAR_SECRET_KEY: z.string().optional(),
030941| NOTE: Implementation detail supporting search page behavior.
030942| src/lib/env.ts:76: 
030943| NOTE: Blank line for visual separation.
030944| src/lib/env.ts:77:   // Feature flags (server-side)
030945| NOTE: Line comment documents intent or constraints.
030946| src/lib/env.ts:78:   ENABLE_SEARCH_V2: z.enum(["true", "false"]).optional(),
030947| NOTE: Implementation detail supporting search page behavior.
030948| src/lib/env.ts:79:   ENABLE_SEARCH_KEYSET: z.enum(["true", "false"]).optional(),
030949| NOTE: Implementation detail supporting search page behavior.
030950| src/lib/env.ts:80:   ENABLE_SEARCH_RANKING: z.enum(["true", "false"]).optional(),
030951| NOTE: Implementation detail supporting search page behavior.
030952| src/lib/env.ts:81: 
030953| NOTE: Blank line for visual separation.
030954| src/lib/env.ts:82:   // Node environment
030955| NOTE: Line comment documents intent or constraints.
030956| src/lib/env.ts:83:   NODE_ENV: z
030957| NOTE: Implementation detail supporting search page behavior.
030958| src/lib/env.ts:84:     .enum(["development", "production", "test"])
030959| NOTE: Implementation detail supporting search page behavior.
030960| src/lib/env.ts:85:     .default("development"),
030961| NOTE: Implementation detail supporting search page behavior.
030962| src/lib/env.ts:86: });
030963| NOTE: Implementation detail supporting search page behavior.
030964| src/lib/env.ts:87: 
030965| NOTE: Blank line for visual separation.
030966| src/lib/env.ts:88: // Schema for client-side (public) environment variables
030967| NOTE: Line comment documents intent or constraints.
030968| src/lib/env.ts:89: const clientEnvSchema = z.object({
030969| NOTE: Local declaration used by search logic or UI.
030970| src/lib/env.ts:90:   // Supabase (optional - affects real-time features only)
030971| NOTE: Line comment documents intent or constraints.
030972| src/lib/env.ts:91:   NEXT_PUBLIC_SUPABASE_URL: z.string().url().optional(),
030973| NOTE: Implementation detail supporting search page behavior.
030974| src/lib/env.ts:92:   NEXT_PUBLIC_SUPABASE_ANON_KEY: z.string().optional(),
030975| NOTE: Implementation detail supporting search page behavior.
030976| src/lib/env.ts:93: 
030977| NOTE: Blank line for visual separation.
030978| src/lib/env.ts:94:   // Google Maps (optional - affects map features)
030979| NOTE: Line comment documents intent or constraints.
030980| src/lib/env.ts:95:   NEXT_PUBLIC_GOOGLE_MAPS_API_KEY: z.string().optional(),
030981| NOTE: Implementation detail supporting search page behavior.
030982| src/lib/env.ts:96: 
030983| NOTE: Blank line for visual separation.
030984| src/lib/env.ts:97:   // Radar (optional - for nearby places map style)
030985| NOTE: Line comment documents intent or constraints.
030986| src/lib/env.ts:98:   NEXT_PUBLIC_RADAR_PUBLISHABLE_KEY: z.string().optional(),
030987| NOTE: Implementation detail supporting search page behavior.
030988| src/lib/env.ts:99: 
030989| NOTE: Blank line for visual separation.
030990| src/lib/env.ts:100:   // Stadia Maps (optional - for premium basemap tiles)
030991| NOTE: Line comment documents intent or constraints.
030992| src/lib/env.ts:101:   // Free tier: non-commercial/evaluation only. Production requires paid plan.
030993| NOTE: Line comment documents intent or constraints.
030994| src/lib/env.ts:102:   // localhost works without API key. Production: use domain auth or API key.
030995| NOTE: Line comment documents intent or constraints.
030996| src/lib/env.ts:103:   NEXT_PUBLIC_STADIA_API_KEY: z.string().optional(),
030997| NOTE: Implementation detail supporting search page behavior.
030998| src/lib/env.ts:104: 
030999| NOTE: Blank line for visual separation.
031000| src/lib/env.ts:105:   // Feature flags
031001| NOTE: Line comment documents intent or constraints.
031002| src/lib/env.ts:106:   NEXT_PUBLIC_NEARBY_ENABLED: z.enum(["true", "false"]).optional(),
031003| NOTE: Implementation detail supporting search page behavior.
031004| src/lib/env.ts:107: });
031005| NOTE: Implementation detail supporting search page behavior.
031006| src/lib/env.ts:108: 
031007| NOTE: Blank line for visual separation.
031008| src/lib/env.ts:109: // Type exports for use throughout the application
031009| NOTE: Line comment documents intent or constraints.
031010| src/lib/env.ts:110: export type ServerEnv = z.infer<typeof serverEnvSchema>;
031011| NOTE: Implementation detail supporting search page behavior.
031012| src/lib/env.ts:111: export type ClientEnv = z.infer<typeof clientEnvSchema>;
031013| NOTE: Implementation detail supporting search page behavior.
031014| src/lib/env.ts:112: 
031015| NOTE: Blank line for visual separation.
031016| src/lib/env.ts:113: /**
031017| NOTE: Block comment line describing behavior or context.
031018| src/lib/env.ts:114:  * Validates server environment variables
031019| NOTE: Block comment line describing behavior or context.
031020| src/lib/env.ts:115:  * Call this at startup to fail fast on missing configuration
031021| NOTE: Block comment line describing behavior or context.
031022| src/lib/env.ts:116:  */
031023| NOTE: Block comment line describing behavior or context.
031024| src/lib/env.ts:117: function validateServerEnv(): ServerEnv {
031025| NOTE: Defines a helper or component function.
031026| src/lib/env.ts:118:   const result = serverEnvSchema.safeParse(process.env);
031027| NOTE: Local declaration used by search logic or UI.
031028| src/lib/env.ts:119: 
031029| NOTE: Blank line for visual separation.
031030| src/lib/env.ts:120:   if (!result.success) {
031031| NOTE: Conditional logic controlling rendering or flow.
031032| src/lib/env.ts:121:     const errors = result.error.issues
031033| NOTE: Local declaration used by search logic or UI.
031034| src/lib/env.ts:122:       .map((issue) => `  - ${issue.path.join(".")}: ${issue.message}`)
031035| NOTE: Implementation detail supporting search page behavior.
031036| src/lib/env.ts:123:       .join("\n");
031037| NOTE: Implementation detail supporting search page behavior.
031038| src/lib/env.ts:124: 
031039| NOTE: Blank line for visual separation.
031040| src/lib/env.ts:125:     console.error("Environment validation failed:\n" + errors);
031041| NOTE: Implementation detail supporting search page behavior.
031042| src/lib/env.ts:126: 
031043| NOTE: Blank line for visual separation.
031044| src/lib/env.ts:127:     // In production, fail fast. In development, warn but continue
031045| NOTE: Line comment documents intent or constraints.
031046| src/lib/env.ts:128:     if (process.env.NODE_ENV === "production") {
031047| NOTE: Conditional logic controlling rendering or flow.
031048| src/lib/env.ts:129:       throw new Error(
031049| NOTE: Implementation detail supporting search page behavior.
031050| src/lib/env.ts:130:         "Invalid environment configuration. Check logs for details.",
031051| NOTE: Implementation detail supporting search page behavior.
031052| src/lib/env.ts:131:       );
031053| NOTE: Implementation detail supporting search page behavior.
031054| src/lib/env.ts:132:     }
031055| NOTE: Implementation detail supporting search page behavior.
031056| src/lib/env.ts:133:   }
031057| NOTE: Implementation detail supporting search page behavior.
031058| src/lib/env.ts:134: 
031059| NOTE: Blank line for visual separation.
031060| src/lib/env.ts:135:   return result.success ? result.data : (process.env as unknown as ServerEnv);
031061| NOTE: Return statement for component or helper output.
031062| src/lib/env.ts:136: }
031063| NOTE: Implementation detail supporting search page behavior.
031064| src/lib/env.ts:137: 
031065| NOTE: Blank line for visual separation.
031066| src/lib/env.ts:138: /**
031067| NOTE: Block comment line describing behavior or context.
031068| src/lib/env.ts:139:  * Validates client environment variables
031069| NOTE: Block comment line describing behavior or context.
031070| src/lib/env.ts:140:  */
031071| NOTE: Block comment line describing behavior or context.
031072| src/lib/env.ts:141: function validateClientEnv(): ClientEnv {
031073| NOTE: Defines a helper or component function.
031074| src/lib/env.ts:142:   const clientVars = {
031075| NOTE: Local declaration used by search logic or UI.
031076| src/lib/env.ts:143:     NEXT_PUBLIC_SUPABASE_URL: process.env.NEXT_PUBLIC_SUPABASE_URL,
031077| NOTE: Implementation detail supporting search page behavior.
031078| src/lib/env.ts:144:     NEXT_PUBLIC_SUPABASE_ANON_KEY: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
031079| NOTE: Implementation detail supporting search page behavior.
031080| src/lib/env.ts:145:     NEXT_PUBLIC_GOOGLE_MAPS_API_KEY:
031081| NOTE: Implementation detail supporting search page behavior.
031082| src/lib/env.ts:146:       process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,
031083| NOTE: Implementation detail supporting search page behavior.
031084| src/lib/env.ts:147:     NEXT_PUBLIC_RADAR_PUBLISHABLE_KEY:
031085| NOTE: Implementation detail supporting search page behavior.
031086| src/lib/env.ts:148:       process.env.NEXT_PUBLIC_RADAR_PUBLISHABLE_KEY,
031087| NOTE: Implementation detail supporting search page behavior.
031088| src/lib/env.ts:149:     NEXT_PUBLIC_STADIA_API_KEY: process.env.NEXT_PUBLIC_STADIA_API_KEY,
031089| NOTE: Implementation detail supporting search page behavior.
031090| src/lib/env.ts:150:     NEXT_PUBLIC_NEARBY_ENABLED: process.env.NEXT_PUBLIC_NEARBY_ENABLED,
031091| NOTE: Implementation detail supporting search page behavior.
031092| src/lib/env.ts:151:   };
031093| NOTE: Implementation detail supporting search page behavior.
031094| src/lib/env.ts:152: 
031095| NOTE: Blank line for visual separation.
031096| src/lib/env.ts:153:   const result = clientEnvSchema.safeParse(clientVars);
031097| NOTE: Local declaration used by search logic or UI.
031098| src/lib/env.ts:154: 
031099| NOTE: Blank line for visual separation.
031100| src/lib/env.ts:155:   if (!result.success) {
031101| NOTE: Conditional logic controlling rendering or flow.
031102| src/lib/env.ts:156:     console.warn(
031103| NOTE: Implementation detail supporting search page behavior.
031104| src/lib/env.ts:157:       "Client environment validation warnings:",
031105| NOTE: Implementation detail supporting search page behavior.
031106| src/lib/env.ts:158:       result.error.issues,
031107| NOTE: Implementation detail supporting search page behavior.
031108| src/lib/env.ts:159:     );
031109| NOTE: Implementation detail supporting search page behavior.
031110| src/lib/env.ts:160:   }
031111| NOTE: Implementation detail supporting search page behavior.
031112| src/lib/env.ts:161: 
031113| NOTE: Blank line for visual separation.
031114| src/lib/env.ts:162:   return result.success ? result.data : (clientVars as ClientEnv);
031115| NOTE: Return statement for component or helper output.
031116| src/lib/env.ts:163: }
031117| NOTE: Implementation detail supporting search page behavior.
031118| src/lib/env.ts:164: 
031119| NOTE: Blank line for visual separation.
031120| src/lib/env.ts:165: // Validated environment objects - import these instead of using process.env directly
031121| NOTE: Line comment documents intent or constraints.
031122| src/lib/env.ts:166: export const serverEnv = validateServerEnv();
031123| NOTE: Implementation detail supporting search page behavior.
031124| src/lib/env.ts:167: export const clientEnv = validateClientEnv();
031125| NOTE: Implementation detail supporting search page behavior.
031126| src/lib/env.ts:168: 
031127| NOTE: Blank line for visual separation.
031128| src/lib/env.ts:169: // Helper to check if a feature is available
031129| NOTE: Line comment documents intent or constraints.
031130| src/lib/env.ts:170: export const features = {
031131| NOTE: Implementation detail supporting search page behavior.
031132| src/lib/env.ts:171:   email: !!serverEnv.RESEND_API_KEY,
031133| NOTE: Implementation detail supporting search page behavior.
031134| src/lib/env.ts:172:   geocoding: !!serverEnv.MAPBOX_ACCESS_TOKEN,
031135| NOTE: Implementation detail supporting search page behavior.
031136| src/lib/env.ts:173:   redis: !!(
031137| NOTE: Implementation detail supporting search page behavior.
031138| src/lib/env.ts:174:     serverEnv.UPSTASH_REDIS_REST_URL && serverEnv.UPSTASH_REDIS_REST_TOKEN
031139| NOTE: Implementation detail supporting search page behavior.
031140| src/lib/env.ts:175:   ),
031141| NOTE: Implementation detail supporting search page behavior.
031142| src/lib/env.ts:176:   aiChat: !!serverEnv.GROQ_API_KEY,
031143| NOTE: Implementation detail supporting search page behavior.
031144| src/lib/env.ts:177:   realtime: !!(
031145| NOTE: Implementation detail supporting search page behavior.
031146| src/lib/env.ts:178:     clientEnv.NEXT_PUBLIC_SUPABASE_URL &&
031147| NOTE: Implementation detail supporting search page behavior.
031148| src/lib/env.ts:179:     clientEnv.NEXT_PUBLIC_SUPABASE_ANON_KEY
031149| NOTE: Implementation detail supporting search page behavior.
031150| src/lib/env.ts:180:   ),
031151| NOTE: Implementation detail supporting search page behavior.
031152| src/lib/env.ts:181:   errorTracking: !!serverEnv.SENTRY_DSN,
031153| NOTE: Implementation detail supporting search page behavior.
031154| src/lib/env.ts:182:   maps: !!clientEnv.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,
031155| NOTE: Implementation detail supporting search page behavior.
031156| src/lib/env.ts:183:   // Stadia Maps basemap tiles (optional - falls back to domain auth or works on localhost)
031157| NOTE: Line comment documents intent or constraints.
031158| src/lib/env.ts:184:   stadiaMaps: !!clientEnv.NEXT_PUBLIC_STADIA_API_KEY,
031159| NOTE: Implementation detail supporting search page behavior.
031160| src/lib/env.ts:185:   // Security features
031161| NOTE: Line comment documents intent or constraints.
031162| src/lib/env.ts:186:   cronAuth: !!serverEnv.CRON_SECRET,
031163| NOTE: Implementation detail supporting search page behavior.
031164| src/lib/env.ts:187:   originEnforcement: !!(serverEnv.ALLOWED_ORIGINS || serverEnv.ALLOWED_HOSTS),
031165| NOTE: Implementation detail supporting search page behavior.
031166| src/lib/env.ts:188:   metricsHmac: !!serverEnv.LOG_HMAC_SECRET,
031167| NOTE: Implementation detail supporting search page behavior.
031168| src/lib/env.ts:189:   googlePlaces: !!serverEnv.GOOGLE_PLACES_API_KEY,
031169| NOTE: Implementation detail supporting search page behavior.
031170| src/lib/env.ts:190:   supabaseStorage: !!serverEnv.SUPABASE_SERVICE_ROLE_KEY,
031171| NOTE: Implementation detail supporting search page behavior.
031172| src/lib/env.ts:191:   // Nearby Places (Radar API)
031173| NOTE: Line comment documents intent or constraints.
031174| src/lib/env.ts:192:   nearbyPlaces: !!(
031175| NOTE: Implementation detail supporting search page behavior.
031176| src/lib/env.ts:193:     serverEnv.RADAR_SECRET_KEY &&
031177| NOTE: Implementation detail supporting search page behavior.
031178| src/lib/env.ts:194:     clientEnv.NEXT_PUBLIC_RADAR_PUBLISHABLE_KEY &&
031179| NOTE: Implementation detail supporting search page behavior.
031180| src/lib/env.ts:195:     clientEnv.NEXT_PUBLIC_NEARBY_ENABLED === "true"
031181| NOTE: Implementation detail supporting search page behavior.
031182| src/lib/env.ts:196:   ),
031183| NOTE: Implementation detail supporting search page behavior.
031184| src/lib/env.ts:197:   // Search API v2 (unified list + map response)
031185| NOTE: Line comment documents intent or constraints.
031186| src/lib/env.ts:198:   searchV2: serverEnv.ENABLE_SEARCH_V2 === "true",
031187| NOTE: Implementation detail supporting search page behavior.
031188| src/lib/env.ts:199:   // Keyset pagination for search v2 (prevents result drift)
031189| NOTE: Line comment documents intent or constraints.
031190| src/lib/env.ts:200:   searchKeyset: serverEnv.ENABLE_SEARCH_KEYSET === "true",
031191| NOTE: Implementation detail supporting search page behavior.
031192| src/lib/env.ts:201:   // Score-based ranking for map pin tiering (heuristic v1)
031193| NOTE: Line comment documents intent or constraints.
031194| src/lib/env.ts:202:   searchRanking: serverEnv.ENABLE_SEARCH_RANKING === "true",
031195| NOTE: Implementation detail supporting search page behavior.
031196| src/lib/env.ts:203: } as const;
031197| NOTE: Implementation detail supporting search page behavior.
031198| src/lib/env.ts:204: 
031199| NOTE: Blank line for visual separation.
031200| src/lib/env.ts:205: // P1-25 FIX: Log startup warnings for missing optional services
031201| NOTE: Line comment documents intent or constraints.
031202| src/lib/env.ts:206: // This helps operators understand which features are disabled
031203| NOTE: Line comment documents intent or constraints.
031204| src/lib/env.ts:207: if (typeof window === "undefined" && process.env.NODE_ENV === "production") {
031205| NOTE: Conditional logic controlling rendering or flow.
031206| src/lib/env.ts:208:   const warnings: string[] = [];
031207| NOTE: Local declaration used by search logic or UI.
031208| src/lib/env.ts:209: 
031209| NOTE: Blank line for visual separation.
031210| src/lib/env.ts:210:   if (!features.aiChat) {
031211| NOTE: Conditional logic controlling rendering or flow.
031212| src/lib/env.ts:211:     warnings.push("GROQ_API_KEY not configured - AI chat feature disabled");
031213| NOTE: Implementation detail supporting search page behavior.
031214| src/lib/env.ts:212:   }
031215| NOTE: Implementation detail supporting search page behavior.
031216| src/lib/env.ts:213:   if (!features.email) {
031217| NOTE: Conditional logic controlling rendering or flow.
031218| src/lib/env.ts:214:     warnings.push(
031219| NOTE: Implementation detail supporting search page behavior.
031220| src/lib/env.ts:215:       "RESEND_API_KEY not configured - email notifications disabled",
031221| NOTE: Implementation detail supporting search page behavior.
031222| src/lib/env.ts:216:     );
031223| NOTE: Implementation detail supporting search page behavior.
031224| src/lib/env.ts:217:   }
031225| NOTE: Implementation detail supporting search page behavior.
031226| src/lib/env.ts:218:   if (!features.errorTracking) {
031227| NOTE: Conditional logic controlling rendering or flow.
031228| src/lib/env.ts:219:     warnings.push("SENTRY_DSN not configured - error tracking disabled");
031229| NOTE: Implementation detail supporting search page behavior.
031230| src/lib/env.ts:220:   }
031231| NOTE: Implementation detail supporting search page behavior.
031232| src/lib/env.ts:221:   if (!features.redis) {
031233| NOTE: Conditional logic controlling rendering or flow.
031234| src/lib/env.ts:222:     warnings.push(
031235| NOTE: Implementation detail supporting search page behavior.
031236| src/lib/env.ts:223:       "Redis not configured - using database-backed rate limiting (slower)",
031237| NOTE: Implementation detail supporting search page behavior.
031238| src/lib/env.ts:224:     );
031239| NOTE: Implementation detail supporting search page behavior.
031240| src/lib/env.ts:225:   }
031241| NOTE: Implementation detail supporting search page behavior.
031242| src/lib/env.ts:226:   if (!features.geocoding) {
031243| NOTE: Conditional logic controlling rendering or flow.
031244| src/lib/env.ts:227:     warnings.push("MAPBOX_ACCESS_TOKEN not configured - geocoding disabled");
031245| NOTE: Implementation detail supporting search page behavior.
031246| src/lib/env.ts:228:   }
031247| NOTE: Implementation detail supporting search page behavior.
031248| src/lib/env.ts:229:   if (!features.cronAuth) {
031249| NOTE: Conditional logic controlling rendering or flow.
031250| src/lib/env.ts:230:     warnings.push("CRON_SECRET not configured - cron endpoints unprotected");
031251| NOTE: Implementation detail supporting search page behavior.
031252| src/lib/env.ts:231:   }
031253| NOTE: Implementation detail supporting search page behavior.
031254| src/lib/env.ts:232:   if (!features.nearbyPlaces) {
031255| NOTE: Conditional logic controlling rendering or flow.
031256| src/lib/env.ts:233:     warnings.push(
031257| NOTE: Implementation detail supporting search page behavior.
031258| src/lib/env.ts:234:       "Radar API not fully configured - nearby places feature disabled",
031259| NOTE: Implementation detail supporting search page behavior.
031260| src/lib/env.ts:235:     );
031261| NOTE: Implementation detail supporting search page behavior.
031262| src/lib/env.ts:236:   }
031263| NOTE: Implementation detail supporting search page behavior.
031264| src/lib/env.ts:237: 
031265| NOTE: Blank line for visual separation.
031266| src/lib/env.ts:238:   if (warnings.length > 0) {
031267| NOTE: Conditional logic controlling rendering or flow.
031268| src/lib/env.ts:239:     console.warn(
031269| NOTE: Implementation detail supporting search page behavior.
031270| src/lib/env.ts:240:       "[ENV] Optional services not configured:\n  - " + warnings.join("\n  - "),
031271| NOTE: Implementation detail supporting search page behavior.
031272| src/lib/env.ts:241:     );
031273| NOTE: Implementation detail supporting search page behavior.
031274| src/lib/env.ts:242:   }
031275| NOTE: Implementation detail supporting search page behavior.
031276| src/lib/env.ts:243: }
031277| NOTE: Implementation detail supporting search page behavior.
031278| FILE END: src/lib/env.ts
031279| 
031280| FILE START: src/lib/errors/data-errors.ts
031281| FILE ROLE: Auto-discovered dependency in search page graph.
031282| src/lib/errors/data-errors.ts:1: /**
031283| NOTE: Block comment line describing behavior or context.
031284| src/lib/errors/data-errors.ts:2:  * Typed error classes for data layer failures
031285| NOTE: Block comment line describing behavior or context.
031286| src/lib/errors/data-errors.ts:3:  * Enables proper error discrimination, structured logging, and user-friendly handling
031287| NOTE: Block comment line describing behavior or context.
031288| src/lib/errors/data-errors.ts:4:  */
031289| NOTE: Block comment line describing behavior or context.
031290| src/lib/errors/data-errors.ts:5: 
031291| NOTE: Blank line for visual separation.
031292| src/lib/errors/data-errors.ts:6: import { logger } from "@/lib/logger";
031293| NOTE: Imports dependency for this module.
031294| src/lib/errors/data-errors.ts:7: 
031295| NOTE: Blank line for visual separation.
031296| src/lib/errors/data-errors.ts:8: /**
031297| NOTE: Block comment line describing behavior or context.
031298| src/lib/errors/data-errors.ts:9:  * Base error for all data layer failures
031299| NOTE: Block comment line describing behavior or context.
031300| src/lib/errors/data-errors.ts:10:  */
031301| NOTE: Block comment line describing behavior or context.
031302| src/lib/errors/data-errors.ts:11: export class DataError extends Error {
031303| NOTE: Implementation detail supporting search page behavior.
031304| src/lib/errors/data-errors.ts:12:   public readonly code: string;
031305| NOTE: Implementation detail supporting search page behavior.
031306| src/lib/errors/data-errors.ts:13:   public readonly retryable: boolean;
031307| NOTE: Implementation detail supporting search page behavior.
031308| src/lib/errors/data-errors.ts:14:   public readonly cause?: Error;
031309| NOTE: Implementation detail supporting search page behavior.
031310| src/lib/errors/data-errors.ts:15: 
031311| NOTE: Blank line for visual separation.
031312| src/lib/errors/data-errors.ts:16:   constructor(
031313| NOTE: Implementation detail supporting search page behavior.
031314| src/lib/errors/data-errors.ts:17:     message: string,
031315| NOTE: Implementation detail supporting search page behavior.
031316| src/lib/errors/data-errors.ts:18:     options: {
031317| NOTE: Implementation detail supporting search page behavior.
031318| src/lib/errors/data-errors.ts:19:       code: string;
031319| NOTE: Implementation detail supporting search page behavior.
031320| src/lib/errors/data-errors.ts:20:       retryable?: boolean;
031321| NOTE: Implementation detail supporting search page behavior.
031322| src/lib/errors/data-errors.ts:21:       cause?: Error;
031323| NOTE: Implementation detail supporting search page behavior.
031324| src/lib/errors/data-errors.ts:22:     },
031325| NOTE: Implementation detail supporting search page behavior.
031326| src/lib/errors/data-errors.ts:23:   ) {
031327| NOTE: Implementation detail supporting search page behavior.
031328| src/lib/errors/data-errors.ts:24:     super(message);
031329| NOTE: Implementation detail supporting search page behavior.
031330| src/lib/errors/data-errors.ts:25:     this.name = "DataError";
031331| NOTE: Implementation detail supporting search page behavior.
031332| src/lib/errors/data-errors.ts:26:     this.code = options.code;
031333| NOTE: Implementation detail supporting search page behavior.
031334| src/lib/errors/data-errors.ts:27:     this.retryable = options.retryable ?? false;
031335| NOTE: Implementation detail supporting search page behavior.
031336| src/lib/errors/data-errors.ts:28:     this.cause = options.cause;
031337| NOTE: Implementation detail supporting search page behavior.
031338| src/lib/errors/data-errors.ts:29: 
031339| NOTE: Blank line for visual separation.
031340| src/lib/errors/data-errors.ts:30:     // Maintains proper stack trace for where error was thrown (V8 engines)
031341| NOTE: Line comment documents intent or constraints.
031342| src/lib/errors/data-errors.ts:31:     if (Error.captureStackTrace) {
031343| NOTE: Conditional logic controlling rendering or flow.
031344| src/lib/errors/data-errors.ts:32:       Error.captureStackTrace(this, this.constructor);
031345| NOTE: Implementation detail supporting search page behavior.
031346| src/lib/errors/data-errors.ts:33:     }
031347| NOTE: Implementation detail supporting search page behavior.
031348| src/lib/errors/data-errors.ts:34:   }
031349| NOTE: Implementation detail supporting search page behavior.
031350| src/lib/errors/data-errors.ts:35: 
031351| NOTE: Blank line for visual separation.
031352| src/lib/errors/data-errors.ts:36:   /**
031353| NOTE: Block comment line describing behavior or context.
031354| src/lib/errors/data-errors.ts:37:    * Log the error with structured metadata
031355| NOTE: Block comment line describing behavior or context.
031356| src/lib/errors/data-errors.ts:38:    */
031357| NOTE: Block comment line describing behavior or context.
031358| src/lib/errors/data-errors.ts:39:   log(context?: Record<string, unknown>): void {
031359| NOTE: Implementation detail supporting search page behavior.
031360| src/lib/errors/data-errors.ts:40:     logger.sync.error(this.message, {
031361| NOTE: Implementation detail supporting search page behavior.
031362| src/lib/errors/data-errors.ts:41:       errorCode: this.code,
031363| NOTE: Implementation detail supporting search page behavior.
031364| src/lib/errors/data-errors.ts:42:       errorName: this.name,
031365| NOTE: Implementation detail supporting search page behavior.
031366| src/lib/errors/data-errors.ts:43:       retryable: this.retryable,
031367| NOTE: Implementation detail supporting search page behavior.
031368| src/lib/errors/data-errors.ts:44:       cause: this.cause?.message,
031369| NOTE: Implementation detail supporting search page behavior.
031370| src/lib/errors/data-errors.ts:45:       stack: this.stack,
031371| NOTE: Implementation detail supporting search page behavior.
031372| src/lib/errors/data-errors.ts:46:       ...context,
031373| NOTE: Implementation detail supporting search page behavior.
031374| src/lib/errors/data-errors.ts:47:     });
031375| NOTE: Implementation detail supporting search page behavior.
031376| src/lib/errors/data-errors.ts:48:   }
031377| NOTE: Implementation detail supporting search page behavior.
031378| src/lib/errors/data-errors.ts:49: }
031379| NOTE: Implementation detail supporting search page behavior.
031380| src/lib/errors/data-errors.ts:50: 
031381| NOTE: Blank line for visual separation.
031382| src/lib/errors/data-errors.ts:51: /**
031383| NOTE: Block comment line describing behavior or context.
031384| src/lib/errors/data-errors.ts:52:  * Database query execution failed
031385| NOTE: Block comment line describing behavior or context.
031386| src/lib/errors/data-errors.ts:53:  */
031387| NOTE: Block comment line describing behavior or context.
031388| src/lib/errors/data-errors.ts:54: export class QueryError extends DataError {
031389| NOTE: Implementation detail supporting search page behavior.
031390| src/lib/errors/data-errors.ts:55:   constructor(operation: string, cause?: Error) {
031391| NOTE: Implementation detail supporting search page behavior.
031392| src/lib/errors/data-errors.ts:56:     super(`Database query failed: ${operation}`, {
031393| NOTE: Implementation detail supporting search page behavior.
031394| src/lib/errors/data-errors.ts:57:       code: "QUERY_ERROR",
031395| NOTE: Implementation detail supporting search page behavior.
031396| src/lib/errors/data-errors.ts:58:       retryable: true,
031397| NOTE: Implementation detail supporting search page behavior.
031398| src/lib/errors/data-errors.ts:59:       cause,
031399| NOTE: Implementation detail supporting search page behavior.
031400| src/lib/errors/data-errors.ts:60:     });
031401| NOTE: Implementation detail supporting search page behavior.
031402| src/lib/errors/data-errors.ts:61:     this.name = "QueryError";
031403| NOTE: Implementation detail supporting search page behavior.
031404| src/lib/errors/data-errors.ts:62:   }
031405| NOTE: Implementation detail supporting search page behavior.
031406| src/lib/errors/data-errors.ts:63: }
031407| NOTE: Implementation detail supporting search page behavior.
031408| src/lib/errors/data-errors.ts:64: 
031409| NOTE: Blank line for visual separation.
031410| src/lib/errors/data-errors.ts:65: /**
031411| NOTE: Block comment line describing behavior or context.
031412| src/lib/errors/data-errors.ts:66:  * Database connection or timeout error
031413| NOTE: Block comment line describing behavior or context.
031414| src/lib/errors/data-errors.ts:67:  */
031415| NOTE: Block comment line describing behavior or context.
031416| src/lib/errors/data-errors.ts:68: export class ConnectionError extends DataError {
031417| NOTE: Implementation detail supporting search page behavior.
031418| src/lib/errors/data-errors.ts:69:   constructor(cause?: Error) {
031419| NOTE: Implementation detail supporting search page behavior.
031420| src/lib/errors/data-errors.ts:70:     super("Database connection failed", {
031421| NOTE: Implementation detail supporting search page behavior.
031422| src/lib/errors/data-errors.ts:71:       code: "CONNECTION_ERROR",
031423| NOTE: Implementation detail supporting search page behavior.
031424| src/lib/errors/data-errors.ts:72:       retryable: true,
031425| NOTE: Implementation detail supporting search page behavior.
031426| src/lib/errors/data-errors.ts:73:       cause,
031427| NOTE: Implementation detail supporting search page behavior.
031428| src/lib/errors/data-errors.ts:74:     });
031429| NOTE: Implementation detail supporting search page behavior.
031430| src/lib/errors/data-errors.ts:75:     this.name = "ConnectionError";
031431| NOTE: Implementation detail supporting search page behavior.
031432| src/lib/errors/data-errors.ts:76:   }
031433| NOTE: Implementation detail supporting search page behavior.
031434| src/lib/errors/data-errors.ts:77: }
031435| NOTE: Implementation detail supporting search page behavior.
031436| src/lib/errors/data-errors.ts:78: 
031437| NOTE: Blank line for visual separation.
031438| src/lib/errors/data-errors.ts:79: /**
031439| NOTE: Block comment line describing behavior or context.
031440| src/lib/errors/data-errors.ts:80:  * Data validation or transformation error
031441| NOTE: Block comment line describing behavior or context.
031442| src/lib/errors/data-errors.ts:81:  */
031443| NOTE: Block comment line describing behavior or context.
031444| src/lib/errors/data-errors.ts:82: export class DataTransformError extends DataError {
031445| NOTE: Implementation detail supporting search page behavior.
031446| src/lib/errors/data-errors.ts:83:   constructor(operation: string, cause?: Error) {
031447| NOTE: Implementation detail supporting search page behavior.
031448| src/lib/errors/data-errors.ts:84:     super(`Data transformation failed: ${operation}`, {
031449| NOTE: Implementation detail supporting search page behavior.
031450| src/lib/errors/data-errors.ts:85:       code: "TRANSFORM_ERROR",
031451| NOTE: Implementation detail supporting search page behavior.
031452| src/lib/errors/data-errors.ts:86:       retryable: false,
031453| NOTE: Implementation detail supporting search page behavior.
031454| src/lib/errors/data-errors.ts:87:       cause,
031455| NOTE: Implementation detail supporting search page behavior.
031456| src/lib/errors/data-errors.ts:88:     });
031457| NOTE: Implementation detail supporting search page behavior.
031458| src/lib/errors/data-errors.ts:89:     this.name = "DataTransformError";
031459| NOTE: Implementation detail supporting search page behavior.
031460| src/lib/errors/data-errors.ts:90:   }
031461| NOTE: Implementation detail supporting search page behavior.
031462| src/lib/errors/data-errors.ts:91: }
031463| NOTE: Implementation detail supporting search page behavior.
031464| src/lib/errors/data-errors.ts:92: 
031465| NOTE: Blank line for visual separation.
031466| src/lib/errors/data-errors.ts:93: /**
031467| NOTE: Block comment line describing behavior or context.
031468| src/lib/errors/data-errors.ts:94:  * Helper to check if an error is a known data error
031469| NOTE: Block comment line describing behavior or context.
031470| src/lib/errors/data-errors.ts:95:  */
031471| NOTE: Block comment line describing behavior or context.
031472| src/lib/errors/data-errors.ts:96: export function isDataError(error: unknown): error is DataError {
031473| NOTE: Exports helper or component function.
031474| src/lib/errors/data-errors.ts:97:   return error instanceof DataError;
031475| NOTE: Return statement for component or helper output.
031476| src/lib/errors/data-errors.ts:98: }
031477| NOTE: Implementation detail supporting search page behavior.
031478| src/lib/errors/data-errors.ts:99: 
031479| NOTE: Blank line for visual separation.
031480| src/lib/errors/data-errors.ts:100: /**
031481| NOTE: Block comment line describing behavior or context.
031482| src/lib/errors/data-errors.ts:101:  * Helper to wrap unknown errors into typed DataError instances
031483| NOTE: Block comment line describing behavior or context.
031484| src/lib/errors/data-errors.ts:102:  * Detects connection-related errors and wraps appropriately
031485| NOTE: Block comment line describing behavior or context.
031486| src/lib/errors/data-errors.ts:103:  */
031487| NOTE: Block comment line describing behavior or context.
031488| src/lib/errors/data-errors.ts:104: export function wrapDatabaseError(
031489| NOTE: Exports helper or component function.
031490| src/lib/errors/data-errors.ts:105:   error: unknown,
031491| NOTE: Implementation detail supporting search page behavior.
031492| src/lib/errors/data-errors.ts:106:   operation: string,
031493| NOTE: Implementation detail supporting search page behavior.
031494| src/lib/errors/data-errors.ts:107: ): DataError {
031495| NOTE: Implementation detail supporting search page behavior.
031496| src/lib/errors/data-errors.ts:108:   // If already a DataError, return as-is
031497| NOTE: Line comment documents intent or constraints.
031498| src/lib/errors/data-errors.ts:109:   if (isDataError(error)) {
031499| NOTE: Conditional logic controlling rendering or flow.
031500| src/lib/errors/data-errors.ts:110:     return error;
031501| NOTE: Return statement for component or helper output.
031502| src/lib/errors/data-errors.ts:111:   }
031503| NOTE: Implementation detail supporting search page behavior.
031504| src/lib/errors/data-errors.ts:112: 
031505| NOTE: Blank line for visual separation.
031506| src/lib/errors/data-errors.ts:113:   const cause = error instanceof Error ? error : new Error(String(error));
031507| NOTE: Local declaration used by search logic or UI.
031508| src/lib/errors/data-errors.ts:114:   const message = cause.message.toLowerCase();
031509| NOTE: Local declaration used by search logic or UI.
031510| src/lib/errors/data-errors.ts:115: 
031511| NOTE: Blank line for visual separation.
031512| src/lib/errors/data-errors.ts:116:   // Detect connection-related errors
031513| NOTE: Line comment documents intent or constraints.
031514| src/lib/errors/data-errors.ts:117:   if (
031515| NOTE: Conditional logic controlling rendering or flow.
031516| src/lib/errors/data-errors.ts:118:     message.includes("connection") ||
031517| NOTE: Implementation detail supporting search page behavior.
031518| src/lib/errors/data-errors.ts:119:     message.includes("timeout") ||
031519| NOTE: Implementation detail supporting search page behavior.
031520| src/lib/errors/data-errors.ts:120:     message.includes("econnrefused") ||
031521| NOTE: Implementation detail supporting search page behavior.
031522| src/lib/errors/data-errors.ts:121:     message.includes("econnreset") ||
031523| NOTE: Implementation detail supporting search page behavior.
031524| src/lib/errors/data-errors.ts:122:     message.includes("etimedout") ||
031525| NOTE: Implementation detail supporting search page behavior.
031526| src/lib/errors/data-errors.ts:123:     message.includes("pool") ||
031527| NOTE: Implementation detail supporting search page behavior.
031528| src/lib/errors/data-errors.ts:124:     message.includes("socket")
031529| NOTE: Implementation detail supporting search page behavior.
031530| src/lib/errors/data-errors.ts:125:   ) {
031531| NOTE: Implementation detail supporting search page behavior.
031532| src/lib/errors/data-errors.ts:126:     return new ConnectionError(cause);
031533| NOTE: Return statement for component or helper output.
031534| src/lib/errors/data-errors.ts:127:   }
031535| NOTE: Implementation detail supporting search page behavior.
031536| src/lib/errors/data-errors.ts:128: 
031537| NOTE: Blank line for visual separation.
031538| src/lib/errors/data-errors.ts:129:   // Default to QueryError for other database failures
031539| NOTE: Line comment documents intent or constraints.
031540| src/lib/errors/data-errors.ts:130:   return new QueryError(operation, cause);
031541| NOTE: Return statement for component or helper output.
031542| src/lib/errors/data-errors.ts:131: }
031543| NOTE: Implementation detail supporting search page behavior.
031544| FILE END: src/lib/errors/data-errors.ts
031545| 
031546| FILE START: src/lib/errors/index.ts
031547| FILE ROLE: Auto-discovered dependency in search page graph.
031548| src/lib/errors/index.ts:1: /**
031549| NOTE: Block comment line describing behavior or context.
031550| src/lib/errors/index.ts:2:  * Error types barrel export
031551| NOTE: Block comment line describing behavior or context.
031552| src/lib/errors/index.ts:3:  */
031553| NOTE: Block comment line describing behavior or context.
031554| src/lib/errors/index.ts:4: export {
031555| NOTE: Implementation detail supporting search page behavior.
031556| src/lib/errors/index.ts:5:   DataError,
031557| NOTE: Implementation detail supporting search page behavior.
031558| src/lib/errors/index.ts:6:   QueryError,
031559| NOTE: Implementation detail supporting search page behavior.
031560| src/lib/errors/index.ts:7:   ConnectionError,
031561| NOTE: Implementation detail supporting search page behavior.
031562| src/lib/errors/index.ts:8:   DataTransformError,
031563| NOTE: Implementation detail supporting search page behavior.
031564| src/lib/errors/index.ts:9:   isDataError,
031565| NOTE: Implementation detail supporting search page behavior.
031566| src/lib/errors/index.ts:10:   wrapDatabaseError,
031567| NOTE: Implementation detail supporting search page behavior.
031568| src/lib/errors/index.ts:11: } from "./data-errors";
031569| NOTE: Implementation detail supporting search page behavior.
031570| FILE END: src/lib/errors/index.ts
031571| 
031572| FILE START: src/lib/languages.ts
031573| FILE ROLE: Auto-discovered dependency in search page graph.
031574| src/lib/languages.ts:1: /**
031575| NOTE: Block comment line describing behavior or context.
031576| src/lib/languages.ts:2:  * Canonical Language List
031577| NOTE: Block comment line describing behavior or context.
031578| src/lib/languages.ts:3:  *
031579| NOTE: Block comment line describing behavior or context.
031580| src/lib/languages.ts:4:  * Single source of truth for supported languages in RoomShare.
031581| NOTE: Block comment line describing behavior or context.
031582| src/lib/languages.ts:5:  * Stores ISO 639-1 language codes with display names.
031583| NOTE: Block comment line describing behavior or context.
031584| src/lib/languages.ts:6:  *
031585| NOTE: Block comment line describing behavior or context.
031586| src/lib/languages.ts:7:  * Used for:
031587| NOTE: Block comment line describing behavior or context.
031588| src/lib/languages.ts:8:  * - "Languages spoken in the house" (lister selection)
031589| NOTE: Block comment line describing behavior or context.
031590| src/lib/languages.ts:9:  * - "Can communicate in" (seeker filter)
031591| NOTE: Block comment line describing behavior or context.
031592| src/lib/languages.ts:10:  * - Listing card display
031593| NOTE: Block comment line describing behavior or context.
031594| src/lib/languages.ts:11:  */
031595| NOTE: Block comment line describing behavior or context.
031596| src/lib/languages.ts:12: 
031597| NOTE: Blank line for visual separation.
031598| src/lib/languages.ts:13: /**
031599| NOTE: Block comment line describing behavior or context.
031600| src/lib/languages.ts:14:  * Supported languages with ISO 639-1 codes and display names.
031601| NOTE: Block comment line describing behavior or context.
031602| src/lib/languages.ts:15:  * Approximately 50 languages covering major world languages,
031603| NOTE: Block comment line describing behavior or context.
031604| src/lib/languages.ts:16:  * South Asian, East Asian, Middle Eastern, African, and European languages.
031605| NOTE: Block comment line describing behavior or context.
031606| src/lib/languages.ts:17:  */
031607| NOTE: Block comment line describing behavior or context.
031608| src/lib/languages.ts:18: export const SUPPORTED_LANGUAGES = {
031609| NOTE: Implementation detail supporting search page behavior.
031610| src/lib/languages.ts:19:   // Major world languages
031611| NOTE: Line comment documents intent or constraints.
031612| src/lib/languages.ts:20:   en: "English",
031613| NOTE: Implementation detail supporting search page behavior.
031614| src/lib/languages.ts:21:   es: "Spanish",
031615| NOTE: Implementation detail supporting search page behavior.
031616| src/lib/languages.ts:22:   zh: "Mandarin Chinese",
031617| NOTE: Implementation detail supporting search page behavior.
031618| src/lib/languages.ts:23:   hi: "Hindi",
031619| NOTE: Implementation detail supporting search page behavior.
031620| src/lib/languages.ts:24:   ar: "Arabic",
031621| NOTE: Implementation detail supporting search page behavior.
031622| src/lib/languages.ts:25:   pt: "Portuguese",
031623| NOTE: Implementation detail supporting search page behavior.
031624| src/lib/languages.ts:26:   ru: "Russian",
031625| NOTE: Implementation detail supporting search page behavior.
031626| src/lib/languages.ts:27:   ja: "Japanese",
031627| NOTE: Implementation detail supporting search page behavior.
031628| src/lib/languages.ts:28:   de: "German",
031629| NOTE: Implementation detail supporting search page behavior.
031630| src/lib/languages.ts:29:   fr: "French",
031631| NOTE: Implementation detail supporting search page behavior.
031632| src/lib/languages.ts:30:   ko: "Korean",
031633| NOTE: Implementation detail supporting search page behavior.
031634| src/lib/languages.ts:31:   vi: "Vietnamese",
031635| NOTE: Implementation detail supporting search page behavior.
031636| src/lib/languages.ts:32:   it: "Italian",
031637| NOTE: Implementation detail supporting search page behavior.
031638| src/lib/languages.ts:33:   nl: "Dutch",
031639| NOTE: Implementation detail supporting search page behavior.
031640| src/lib/languages.ts:34:   pl: "Polish",
031641| NOTE: Implementation detail supporting search page behavior.
031642| src/lib/languages.ts:35:   tr: "Turkish",
031643| NOTE: Implementation detail supporting search page behavior.
031644| src/lib/languages.ts:36:   th: "Thai",
031645| NOTE: Implementation detail supporting search page behavior.
031646| src/lib/languages.ts:37: 
031647| NOTE: Blank line for visual separation.
031648| src/lib/languages.ts:38:   // South Asian languages
031649| NOTE: Line comment documents intent or constraints.
031650| src/lib/languages.ts:39:   te: "Telugu",
031651| NOTE: Implementation detail supporting search page behavior.
031652| src/lib/languages.ts:40:   ta: "Tamil",
031653| NOTE: Implementation detail supporting search page behavior.
031654| src/lib/languages.ts:41:   bn: "Bengali",
031655| NOTE: Implementation detail supporting search page behavior.
031656| src/lib/languages.ts:42:   pa: "Punjabi",
031657| NOTE: Implementation detail supporting search page behavior.
031658| src/lib/languages.ts:43:   gu: "Gujarati",
031659| NOTE: Implementation detail supporting search page behavior.
031660| src/lib/languages.ts:44:   mr: "Marathi",
031661| NOTE: Implementation detail supporting search page behavior.
031662| src/lib/languages.ts:45:   kn: "Kannada",
031663| NOTE: Implementation detail supporting search page behavior.
031664| src/lib/languages.ts:46:   ml: "Malayalam",
031665| NOTE: Implementation detail supporting search page behavior.
031666| src/lib/languages.ts:47:   ur: "Urdu",
031667| NOTE: Implementation detail supporting search page behavior.
031668| src/lib/languages.ts:48:   ne: "Nepali",
031669| NOTE: Implementation detail supporting search page behavior.
031670| src/lib/languages.ts:49:   si: "Sinhala",
031671| NOTE: Implementation detail supporting search page behavior.
031672| src/lib/languages.ts:50: 
031673| NOTE: Blank line for visual separation.
031674| src/lib/languages.ts:51:   // East Asian / Southeast Asian
031675| NOTE: Line comment documents intent or constraints.
031676| src/lib/languages.ts:52:   yue: "Cantonese",
031677| NOTE: Implementation detail supporting search page behavior.
031678| src/lib/languages.ts:53:   tl: "Tagalog",
031679| NOTE: Implementation detail supporting search page behavior.
031680| src/lib/languages.ts:54:   id: "Indonesian",
031681| NOTE: Implementation detail supporting search page behavior.
031682| src/lib/languages.ts:55:   ms: "Malay",
031683| NOTE: Implementation detail supporting search page behavior.
031684| src/lib/languages.ts:56:   my: "Burmese",
031685| NOTE: Implementation detail supporting search page behavior.
031686| src/lib/languages.ts:57:   km: "Khmer",
031687| NOTE: Implementation detail supporting search page behavior.
031688| src/lib/languages.ts:58: 
031689| NOTE: Blank line for visual separation.
031690| src/lib/languages.ts:59:   // Middle Eastern
031691| NOTE: Line comment documents intent or constraints.
031692| src/lib/languages.ts:60:   fa: "Persian",
031693| NOTE: Implementation detail supporting search page behavior.
031694| src/lib/languages.ts:61:   he: "Hebrew",
031695| NOTE: Implementation detail supporting search page behavior.
031696| src/lib/languages.ts:62: 
031697| NOTE: Blank line for visual separation.
031698| src/lib/languages.ts:63:   // African
031699| NOTE: Line comment documents intent or constraints.
031700| src/lib/languages.ts:64:   sw: "Swahili",
031701| NOTE: Implementation detail supporting search page behavior.
031702| src/lib/languages.ts:65:   am: "Amharic",
031703| NOTE: Implementation detail supporting search page behavior.
031704| src/lib/languages.ts:66:   yo: "Yoruba",
031705| NOTE: Implementation detail supporting search page behavior.
031706| src/lib/languages.ts:67:   ha: "Hausa",
031707| NOTE: Implementation detail supporting search page behavior.
031708| src/lib/languages.ts:68:   ig: "Igbo",
031709| NOTE: Implementation detail supporting search page behavior.
031710| src/lib/languages.ts:69: 
031711| NOTE: Blank line for visual separation.
031712| src/lib/languages.ts:70:   // European
031713| NOTE: Line comment documents intent or constraints.
031714| src/lib/languages.ts:71:   uk: "Ukrainian",
031715| NOTE: Implementation detail supporting search page behavior.
031716| src/lib/languages.ts:72:   cs: "Czech",
031717| NOTE: Implementation detail supporting search page behavior.
031718| src/lib/languages.ts:73:   ro: "Romanian",
031719| NOTE: Implementation detail supporting search page behavior.
031720| src/lib/languages.ts:74:   el: "Greek",
031721| NOTE: Implementation detail supporting search page behavior.
031722| src/lib/languages.ts:75:   hu: "Hungarian",
031723| NOTE: Implementation detail supporting search page behavior.
031724| src/lib/languages.ts:76:   sv: "Swedish",
031725| NOTE: Implementation detail supporting search page behavior.
031726| src/lib/languages.ts:77:   da: "Danish",
031727| NOTE: Implementation detail supporting search page behavior.
031728| src/lib/languages.ts:78:   no: "Norwegian",
031729| NOTE: Implementation detail supporting search page behavior.
031730| src/lib/languages.ts:79:   fi: "Finnish",
031731| NOTE: Implementation detail supporting search page behavior.
031732| src/lib/languages.ts:80:   sk: "Slovak",
031733| NOTE: Implementation detail supporting search page behavior.
031734| src/lib/languages.ts:81:   bg: "Bulgarian",
031735| NOTE: Implementation detail supporting search page behavior.
031736| src/lib/languages.ts:82:   sr: "Serbian",
031737| NOTE: Implementation detail supporting search page behavior.
031738| src/lib/languages.ts:83:   hr: "Croatian",
031739| NOTE: Implementation detail supporting search page behavior.
031740| src/lib/languages.ts:84: } as const;
031741| NOTE: Implementation detail supporting search page behavior.
031742| src/lib/languages.ts:85: 
031743| NOTE: Blank line for visual separation.
031744| src/lib/languages.ts:86: /**
031745| NOTE: Block comment line describing behavior or context.
031746| src/lib/languages.ts:87:  * Type for valid language codes
031747| NOTE: Block comment line describing behavior or context.
031748| src/lib/languages.ts:88:  */
031749| NOTE: Block comment line describing behavior or context.
031750| src/lib/languages.ts:89: export type LanguageCode = keyof typeof SUPPORTED_LANGUAGES;
031751| NOTE: Implementation detail supporting search page behavior.
031752| src/lib/languages.ts:90: 
031753| NOTE: Blank line for visual separation.
031754| src/lib/languages.ts:91: /**
031755| NOTE: Block comment line describing behavior or context.
031756| src/lib/languages.ts:92:  * Array of all valid language codes (for iteration)
031757| NOTE: Block comment line describing behavior or context.
031758| src/lib/languages.ts:93:  */
031759| NOTE: Block comment line describing behavior or context.
031760| src/lib/languages.ts:94: export const LANGUAGE_CODES = Object.keys(
031761| NOTE: Implementation detail supporting search page behavior.
031762| src/lib/languages.ts:95:   SUPPORTED_LANGUAGES,
031763| NOTE: Implementation detail supporting search page behavior.
031764| src/lib/languages.ts:96: ) as LanguageCode[];
031765| NOTE: Implementation detail supporting search page behavior.
031766| src/lib/languages.ts:97: 
031767| NOTE: Blank line for visual separation.
031768| src/lib/languages.ts:98: /**
031769| NOTE: Block comment line describing behavior or context.
031770| src/lib/languages.ts:99:  * Array of language entries sorted alphabetically by display name
031771| NOTE: Block comment line describing behavior or context.
031772| src/lib/languages.ts:100:  * Useful for rendering in UI dropdowns and chip selectors
031773| NOTE: Block comment line describing behavior or context.
031774| src/lib/languages.ts:101:  */
031775| NOTE: Block comment line describing behavior or context.
031776| src/lib/languages.ts:102: export const LANGUAGES_SORTED = LANGUAGE_CODES.map((code) => ({
031777| NOTE: Implementation detail supporting search page behavior.
031778| src/lib/languages.ts:103:   code,
031779| NOTE: Implementation detail supporting search page behavior.
031780| src/lib/languages.ts:104:   name: SUPPORTED_LANGUAGES[code],
031781| NOTE: Implementation detail supporting search page behavior.
031782| src/lib/languages.ts:105: })).sort((a, b) => a.name.localeCompare(b.name));
031783| NOTE: Implementation detail supporting search page behavior.
031784| src/lib/languages.ts:106: 
031785| NOTE: Blank line for visual separation.
031786| src/lib/languages.ts:107: /**
031787| NOTE: Block comment line describing behavior or context.
031788| src/lib/languages.ts:108:  * Check if a string is a valid language code
031789| NOTE: Block comment line describing behavior or context.
031790| src/lib/languages.ts:109:  */
031791| NOTE: Block comment line describing behavior or context.
031792| src/lib/languages.ts:110: export function isValidLanguageCode(code: string): code is LanguageCode {
031793| NOTE: Exports helper or component function.
031794| src/lib/languages.ts:111:   return code in SUPPORTED_LANGUAGES;
031795| NOTE: Return statement for component or helper output.
031796| src/lib/languages.ts:112: }
031797| NOTE: Implementation detail supporting search page behavior.
031798| src/lib/languages.ts:113: 
031799| NOTE: Blank line for visual separation.
031800| src/lib/languages.ts:114: /**
031801| NOTE: Block comment line describing behavior or context.
031802| src/lib/languages.ts:115:  * Get display name for a language code
031803| NOTE: Block comment line describing behavior or context.
031804| src/lib/languages.ts:116:  * Returns the code itself if not found (for backwards compatibility)
031805| NOTE: Block comment line describing behavior or context.
031806| src/lib/languages.ts:117:  */
031807| NOTE: Block comment line describing behavior or context.
031808| src/lib/languages.ts:118: export function getLanguageName(code: string): string {
031809| NOTE: Exports helper or component function.
031810| src/lib/languages.ts:119:   if (isValidLanguageCode(code)) {
031811| NOTE: Conditional logic controlling rendering or flow.
031812| src/lib/languages.ts:120:     return SUPPORTED_LANGUAGES[code];
031813| NOTE: Return statement for component or helper output.
031814| src/lib/languages.ts:121:   }
031815| NOTE: Implementation detail supporting search page behavior.
031816| src/lib/languages.ts:122:   // Handle legacy display names stored directly
031817| NOTE: Line comment documents intent or constraints.
031818| src/lib/languages.ts:123:   if (
031819| NOTE: Conditional logic controlling rendering or flow.
031820| src/lib/languages.ts:124:     Object.values(SUPPORTED_LANGUAGES).includes(
031821| NOTE: Implementation detail supporting search page behavior.
031822| src/lib/languages.ts:125:       code as (typeof SUPPORTED_LANGUAGES)[LanguageCode],
031823| NOTE: Implementation detail supporting search page behavior.
031824| src/lib/languages.ts:126:     )
031825| NOTE: Implementation detail supporting search page behavior.
031826| src/lib/languages.ts:127:   ) {
031827| NOTE: Implementation detail supporting search page behavior.
031828| src/lib/languages.ts:128:     return code;
031829| NOTE: Return statement for component or helper output.
031830| src/lib/languages.ts:129:   }
031831| NOTE: Implementation detail supporting search page behavior.
031832| src/lib/languages.ts:130:   return code;
031833| NOTE: Return statement for component or helper output.
031834| src/lib/languages.ts:131: }
031835| NOTE: Implementation detail supporting search page behavior.
031836| src/lib/languages.ts:132: 
031837| NOTE: Blank line for visual separation.
031838| src/lib/languages.ts:133: /**
031839| NOTE: Block comment line describing behavior or context.
031840| src/lib/languages.ts:134:  * Mapping from legacy display names to codes (for migration)
031841| NOTE: Block comment line describing behavior or context.
031842| src/lib/languages.ts:135:  */
031843| NOTE: Block comment line describing behavior or context.
031844| src/lib/languages.ts:136: export const LEGACY_NAME_TO_CODE: Record<string, LanguageCode> = {
031845| NOTE: Implementation detail supporting search page behavior.
031846| src/lib/languages.ts:137:   English: "en",
031847| NOTE: Implementation detail supporting search page behavior.
031848| src/lib/languages.ts:138:   Spanish: "es",
031849| NOTE: Implementation detail supporting search page behavior.
031850| src/lib/languages.ts:139:   Mandarin: "zh",
031851| NOTE: Implementation detail supporting search page behavior.
031852| src/lib/languages.ts:140:   "Mandarin Chinese": "zh",
031853| NOTE: Implementation detail supporting search page behavior.
031854| src/lib/languages.ts:141:   Hindi: "hi",
031855| NOTE: Implementation detail supporting search page behavior.
031856| src/lib/languages.ts:142:   French: "fr",
031857| NOTE: Implementation detail supporting search page behavior.
031858| src/lib/languages.ts:143:   Arabic: "ar",
031859| NOTE: Implementation detail supporting search page behavior.
031860| src/lib/languages.ts:144:   Portuguese: "pt",
031861| NOTE: Implementation detail supporting search page behavior.
031862| src/lib/languages.ts:145:   Russian: "ru",
031863| NOTE: Implementation detail supporting search page behavior.
031864| src/lib/languages.ts:146:   Japanese: "ja",
031865| NOTE: Implementation detail supporting search page behavior.
031866| src/lib/languages.ts:147:   German: "de",
031867| NOTE: Implementation detail supporting search page behavior.
031868| src/lib/languages.ts:148:   Korean: "ko",
031869| NOTE: Implementation detail supporting search page behavior.
031870| src/lib/languages.ts:149:   Vietnamese: "vi",
031871| NOTE: Implementation detail supporting search page behavior.
031872| src/lib/languages.ts:150:   Italian: "it",
031873| NOTE: Implementation detail supporting search page behavior.
031874| src/lib/languages.ts:151:   Dutch: "nl",
031875| NOTE: Implementation detail supporting search page behavior.
031876| src/lib/languages.ts:152:   Polish: "pl",
031877| NOTE: Implementation detail supporting search page behavior.
031878| src/lib/languages.ts:153:   Turkish: "tr",
031879| NOTE: Implementation detail supporting search page behavior.
031880| src/lib/languages.ts:154:   Thai: "th",
031881| NOTE: Implementation detail supporting search page behavior.
031882| src/lib/languages.ts:155:   Telugu: "te",
031883| NOTE: Implementation detail supporting search page behavior.
031884| src/lib/languages.ts:156:   Tamil: "ta",
031885| NOTE: Implementation detail supporting search page behavior.
031886| src/lib/languages.ts:157:   Bengali: "bn",
031887| NOTE: Implementation detail supporting search page behavior.
031888| src/lib/languages.ts:158:   Punjabi: "pa",
031889| NOTE: Implementation detail supporting search page behavior.
031890| src/lib/languages.ts:159:   Gujarati: "gu",
031891| NOTE: Implementation detail supporting search page behavior.
031892| src/lib/languages.ts:160:   Marathi: "mr",
031893| NOTE: Implementation detail supporting search page behavior.
031894| src/lib/languages.ts:161:   Kannada: "kn",
031895| NOTE: Implementation detail supporting search page behavior.
031896| src/lib/languages.ts:162:   Malayalam: "ml",
031897| NOTE: Implementation detail supporting search page behavior.
031898| src/lib/languages.ts:163:   Urdu: "ur",
031899| NOTE: Implementation detail supporting search page behavior.
031900| src/lib/languages.ts:164: };
031901| NOTE: Implementation detail supporting search page behavior.
031902| src/lib/languages.ts:165: 
031903| NOTE: Blank line for visual separation.
031904| src/lib/languages.ts:166: const LEGACY_NAME_TO_CODE_LOWER: Record<string, LanguageCode> =
031905| NOTE: Local declaration used by search logic or UI.
031906| src/lib/languages.ts:167:   Object.fromEntries(
031907| NOTE: Implementation detail supporting search page behavior.
031908| src/lib/languages.ts:168:     Object.entries(LEGACY_NAME_TO_CODE).map(([name, code]) => [
031909| NOTE: Implementation detail supporting search page behavior.
031910| src/lib/languages.ts:169:       name.toLowerCase(),
031911| NOTE: Implementation detail supporting search page behavior.
031912| src/lib/languages.ts:170:       code,
031913| NOTE: Implementation detail supporting search page behavior.
031914| src/lib/languages.ts:171:     ]),
031915| NOTE: Implementation detail supporting search page behavior.
031916| src/lib/languages.ts:172:   );
031917| NOTE: Implementation detail supporting search page behavior.
031918| src/lib/languages.ts:173: 
031919| NOTE: Blank line for visual separation.
031920| src/lib/languages.ts:174: /**
031921| NOTE: Block comment line describing behavior or context.
031922| src/lib/languages.ts:175:  * Convert a language (code or legacy name) to its code
031923| NOTE: Block comment line describing behavior or context.
031924| src/lib/languages.ts:176:  * Returns the input if no mapping found
031925| NOTE: Block comment line describing behavior or context.
031926| src/lib/languages.ts:177:  */
031927| NOTE: Block comment line describing behavior or context.
031928| src/lib/languages.ts:178: export function toLanguageCode(input: string): string {
031929| NOTE: Exports helper or component function.
031930| src/lib/languages.ts:179:   const normalized = input.trim();
031931| NOTE: Local declaration used by search logic or UI.
031932| src/lib/languages.ts:180:   if (!normalized) {
031933| NOTE: Conditional logic controlling rendering or flow.
031934| src/lib/languages.ts:181:     return normalized;
031935| NOTE: Return statement for component or helper output.
031936| src/lib/languages.ts:182:   }
031937| NOTE: Implementation detail supporting search page behavior.
031938| src/lib/languages.ts:183:   const lower = normalized.toLowerCase();
031939| NOTE: Local declaration used by search logic or UI.
031940| src/lib/languages.ts:184:   // Already a valid code
031941| NOTE: Line comment documents intent or constraints.
031942| src/lib/languages.ts:185:   if (isValidLanguageCode(lower)) {
031943| NOTE: Conditional logic controlling rendering or flow.
031944| src/lib/languages.ts:186:     return lower;
031945| NOTE: Return statement for component or helper output.
031946| src/lib/languages.ts:187:   }
031947| NOTE: Implementation detail supporting search page behavior.
031948| src/lib/languages.ts:188:   // Try legacy name mapping
031949| NOTE: Line comment documents intent or constraints.
031950| src/lib/languages.ts:189:   const code =
031951| NOTE: Local declaration used by search logic or UI.
031952| src/lib/languages.ts:190:     LEGACY_NAME_TO_CODE[normalized] ?? LEGACY_NAME_TO_CODE_LOWER[lower];
031953| NOTE: Implementation detail supporting search page behavior.
031954| src/lib/languages.ts:191:   if (code) {
031955| NOTE: Conditional logic controlling rendering or flow.
031956| src/lib/languages.ts:192:     return code;
031957| NOTE: Return statement for component or helper output.
031958| src/lib/languages.ts:193:   }
031959| NOTE: Implementation detail supporting search page behavior.
031960| src/lib/languages.ts:194:   // Return as-is (unknown language)
031961| NOTE: Line comment documents intent or constraints.
031962| src/lib/languages.ts:195:   return normalized;
031963| NOTE: Return statement for component or helper output.
031964| src/lib/languages.ts:196: }
031965| NOTE: Implementation detail supporting search page behavior.
031966| src/lib/languages.ts:197: 
031967| NOTE: Blank line for visual separation.
031968| src/lib/languages.ts:198: /**
031969| NOTE: Block comment line describing behavior or context.
031970| src/lib/languages.ts:199:  * Validate and normalize an array of languages
031971| NOTE: Block comment line describing behavior or context.
031972| src/lib/languages.ts:200:  * Converts legacy names to codes, filters invalid entries
031973| NOTE: Block comment line describing behavior or context.
031974| src/lib/languages.ts:201:  */
031975| NOTE: Block comment line describing behavior or context.
031976| src/lib/languages.ts:202: export function normalizeLanguages(languages: string[]): LanguageCode[] {
031977| NOTE: Exports helper or component function.
031978| src/lib/languages.ts:203:   return languages.map(toLanguageCode).filter(isValidLanguageCode);
031979| NOTE: Return statement for component or helper output.
031980| src/lib/languages.ts:204: }
031981| NOTE: Implementation detail supporting search page behavior.
031982| FILE END: src/lib/languages.ts
031983| 
031984| FILE START: src/lib/locations/us-locations.ts
031985| FILE ROLE: Auto-discovered dependency in search page graph.
031986| src/lib/locations/us-locations.ts:1: /**
031987| NOTE: Block comment line describing behavior or context.
031988| src/lib/locations/us-locations.ts:2:  * US Locations Dataset - Local-first Location Search
031989| NOTE: Block comment line describing behavior or context.
031990| src/lib/locations/us-locations.ts:3:  *
031991| NOTE: Block comment line describing behavior or context.
031992| src/lib/locations/us-locations.ts:4:  * This dataset reduces Mapbox Geocoding API calls by providing
031993| NOTE: Block comment line describing behavior or context.
031994| src/lib/locations/us-locations.ts:5:  * instant local search for common US locations.
031995| NOTE: Block comment line describing behavior or context.
031996| src/lib/locations/us-locations.ts:6:  *
031997| NOTE: Block comment line describing behavior or context.
031998| src/lib/locations/us-locations.ts:7:  * Data sources (public domain):
031999| NOTE: Block comment line describing behavior or context.
032000| src/lib/locations/us-locations.ts:8:  * - US Census Bureau (cities, populations)
032001| NOTE: Block comment line describing behavior or context.
032002| src/lib/locations/us-locations.ts:9:  * - Wikipedia (coordinates, neighborhoods)
032003| NOTE: Block comment line describing behavior or context.
032004| src/lib/locations/us-locations.ts:10:  *
032005| NOTE: Block comment line describing behavior or context.
032006| src/lib/locations/us-locations.ts:11:  * Note: This is OUR data, NOT from Mapbox API, so it's safe to cache indefinitely.
032007| NOTE: Block comment line describing behavior or context.
032008| src/lib/locations/us-locations.ts:12:  * Mapbox ToS prohibits caching their geocoding results.
032009| NOTE: Block comment line describing behavior or context.
032010| src/lib/locations/us-locations.ts:13:  */
032011| NOTE: Block comment line describing behavior or context.
032012| src/lib/locations/us-locations.ts:14: 
032013| NOTE: Blank line for visual separation.
032014| src/lib/locations/us-locations.ts:15: export interface LocalLocation {
032015| NOTE: Implementation detail supporting search page behavior.
032016| src/lib/locations/us-locations.ts:16:   id: string;
032017| NOTE: Implementation detail supporting search page behavior.
032018| src/lib/locations/us-locations.ts:17:   name: string;
032019| NOTE: Implementation detail supporting search page behavior.
032020| src/lib/locations/us-locations.ts:18:   searchTerms: string[]; // All searchable variations
032021| NOTE: Implementation detail supporting search page behavior.
032022| src/lib/locations/us-locations.ts:19:   displayName: string; // "San Francisco, CA"
032023| NOTE: Implementation detail supporting search page behavior.
032024| src/lib/locations/us-locations.ts:20:   type: "city" | "neighborhood" | "region" | "metro" | "state";
032025| NOTE: Implementation detail supporting search page behavior.
032026| src/lib/locations/us-locations.ts:21:   center: [number, number]; // [lng, lat]
032027| NOTE: Implementation detail supporting search page behavior.
032028| src/lib/locations/us-locations.ts:22:   bbox?: [number, number, number, number]; // [minLng, minLat, maxLng, maxLat]
032029| NOTE: Implementation detail supporting search page behavior.
032030| src/lib/locations/us-locations.ts:23:   population?: number; // For ranking
032031| NOTE: Implementation detail supporting search page behavior.
032032| src/lib/locations/us-locations.ts:24:   state: string;
032033| NOTE: Implementation detail supporting search page behavior.
032034| src/lib/locations/us-locations.ts:25: }
032035| NOTE: Implementation detail supporting search page behavior.
032036| src/lib/locations/us-locations.ts:26: 
032037| NOTE: Blank line for visual separation.
032038| src/lib/locations/us-locations.ts:27: // Top US cities by population + college towns + key neighborhoods
032039| NOTE: Line comment documents intent or constraints.
032040| src/lib/locations/us-locations.ts:28: export const US_LOCATIONS: LocalLocation[] = [
032041| NOTE: Implementation detail supporting search page behavior.
032042| src/lib/locations/us-locations.ts:29:   // Top 50 cities by population
032043| NOTE: Line comment documents intent or constraints.
032044| src/lib/locations/us-locations.ts:30:   {
032045| NOTE: Implementation detail supporting search page behavior.
032046| src/lib/locations/us-locations.ts:31:     id: "nyc",
032047| NOTE: Implementation detail supporting search page behavior.
032048| src/lib/locations/us-locations.ts:32:     name: "New York City",
032049| NOTE: Implementation detail supporting search page behavior.
032050| src/lib/locations/us-locations.ts:33:     searchTerms: ["new york", "nyc", "new york city", "manhattan", "ny"],
032051| NOTE: Implementation detail supporting search page behavior.
032052| src/lib/locations/us-locations.ts:34:     displayName: "New York City, NY",
032053| NOTE: Implementation detail supporting search page behavior.
032054| src/lib/locations/us-locations.ts:35:     type: "city",
032055| NOTE: Implementation detail supporting search page behavior.
032056| src/lib/locations/us-locations.ts:36:     center: [-74.006, 40.7128],
032057| NOTE: Implementation detail supporting search page behavior.
032058| src/lib/locations/us-locations.ts:37:     bbox: [-74.259, 40.4774, -73.7004, 40.9176],
032059| NOTE: Implementation detail supporting search page behavior.
032060| src/lib/locations/us-locations.ts:38:     population: 8336817,
032061| NOTE: Implementation detail supporting search page behavior.
032062| src/lib/locations/us-locations.ts:39:     state: "NY",
032063| NOTE: Implementation detail supporting search page behavior.
032064| src/lib/locations/us-locations.ts:40:   },
032065| NOTE: Implementation detail supporting search page behavior.
032066| src/lib/locations/us-locations.ts:41:   {
032067| NOTE: Implementation detail supporting search page behavior.
032068| src/lib/locations/us-locations.ts:42:     id: "la",
032069| NOTE: Implementation detail supporting search page behavior.
032070| src/lib/locations/us-locations.ts:43:     name: "Los Angeles",
032071| NOTE: Implementation detail supporting search page behavior.
032072| src/lib/locations/us-locations.ts:44:     searchTerms: ["los angeles", "la", "l.a.", "los angeles ca"],
032073| NOTE: Implementation detail supporting search page behavior.
032074| src/lib/locations/us-locations.ts:45:     displayName: "Los Angeles, CA",
032075| NOTE: Implementation detail supporting search page behavior.
032076| src/lib/locations/us-locations.ts:46:     type: "city",
032077| NOTE: Implementation detail supporting search page behavior.
032078| src/lib/locations/us-locations.ts:47:     center: [-118.2437, 34.0522],
032079| NOTE: Implementation detail supporting search page behavior.
032080| src/lib/locations/us-locations.ts:48:     bbox: [-118.6682, 33.7037, -118.1553, 34.3373],
032081| NOTE: Implementation detail supporting search page behavior.
032082| src/lib/locations/us-locations.ts:49:     population: 3979576,
032083| NOTE: Implementation detail supporting search page behavior.
032084| src/lib/locations/us-locations.ts:50:     state: "CA",
032085| NOTE: Implementation detail supporting search page behavior.
032086| src/lib/locations/us-locations.ts:51:   },
032087| NOTE: Implementation detail supporting search page behavior.
032088| src/lib/locations/us-locations.ts:52:   {
032089| NOTE: Implementation detail supporting search page behavior.
032090| src/lib/locations/us-locations.ts:53:     id: "chicago",
032091| NOTE: Implementation detail supporting search page behavior.
032092| src/lib/locations/us-locations.ts:54:     name: "Chicago",
032093| NOTE: Implementation detail supporting search page behavior.
032094| src/lib/locations/us-locations.ts:55:     searchTerms: ["chicago", "chi", "chicago il", "windy city"],
032095| NOTE: Implementation detail supporting search page behavior.
032096| src/lib/locations/us-locations.ts:56:     displayName: "Chicago, IL",
032097| NOTE: Implementation detail supporting search page behavior.
032098| src/lib/locations/us-locations.ts:57:     type: "city",
032099| NOTE: Implementation detail supporting search page behavior.
032100| src/lib/locations/us-locations.ts:58:     center: [-87.6298, 41.8781],
032101| NOTE: Implementation detail supporting search page behavior.
032102| src/lib/locations/us-locations.ts:59:     bbox: [-87.9401, 41.6445, -87.5241, 42.0231],
032103| NOTE: Implementation detail supporting search page behavior.
032104| src/lib/locations/us-locations.ts:60:     population: 2693976,
032105| NOTE: Implementation detail supporting search page behavior.
032106| src/lib/locations/us-locations.ts:61:     state: "IL",
032107| NOTE: Implementation detail supporting search page behavior.
032108| src/lib/locations/us-locations.ts:62:   },
032109| NOTE: Implementation detail supporting search page behavior.
032110| src/lib/locations/us-locations.ts:63:   {
032111| NOTE: Implementation detail supporting search page behavior.
032112| src/lib/locations/us-locations.ts:64:     id: "houston",
032113| NOTE: Implementation detail supporting search page behavior.
032114| src/lib/locations/us-locations.ts:65:     name: "Houston",
032115| NOTE: Implementation detail supporting search page behavior.
032116| src/lib/locations/us-locations.ts:66:     searchTerms: ["houston", "houston tx", "houston texas"],
032117| NOTE: Implementation detail supporting search page behavior.
032118| src/lib/locations/us-locations.ts:67:     displayName: "Houston, TX",
032119| NOTE: Implementation detail supporting search page behavior.
032120| src/lib/locations/us-locations.ts:68:     type: "city",
032121| NOTE: Implementation detail supporting search page behavior.
032122| src/lib/locations/us-locations.ts:69:     center: [-95.3698, 29.7604],
032123| NOTE: Implementation detail supporting search page behavior.
032124| src/lib/locations/us-locations.ts:70:     bbox: [-95.7869, 29.5232, -95.0143, 30.1108],
032125| NOTE: Implementation detail supporting search page behavior.
032126| src/lib/locations/us-locations.ts:71:     population: 2320268,
032127| NOTE: Implementation detail supporting search page behavior.
032128| src/lib/locations/us-locations.ts:72:     state: "TX",
032129| NOTE: Implementation detail supporting search page behavior.
032130| src/lib/locations/us-locations.ts:73:   },
032131| NOTE: Implementation detail supporting search page behavior.
032132| src/lib/locations/us-locations.ts:74:   {
032133| NOTE: Implementation detail supporting search page behavior.
032134| src/lib/locations/us-locations.ts:75:     id: "phoenix",
032135| NOTE: Implementation detail supporting search page behavior.
032136| src/lib/locations/us-locations.ts:76:     name: "Phoenix",
032137| NOTE: Implementation detail supporting search page behavior.
032138| src/lib/locations/us-locations.ts:77:     searchTerms: ["phoenix", "phoenix az", "phoenix arizona"],
032139| NOTE: Implementation detail supporting search page behavior.
032140| src/lib/locations/us-locations.ts:78:     displayName: "Phoenix, AZ",
032141| NOTE: Implementation detail supporting search page behavior.
032142| src/lib/locations/us-locations.ts:79:     type: "city",
032143| NOTE: Implementation detail supporting search page behavior.
032144| src/lib/locations/us-locations.ts:80:     center: [-112.074, 33.4484],
032145| NOTE: Implementation detail supporting search page behavior.
032146| src/lib/locations/us-locations.ts:81:     bbox: [-112.3241, 33.2902, -111.9259, 33.6881],
032147| NOTE: Implementation detail supporting search page behavior.
032148| src/lib/locations/us-locations.ts:82:     population: 1680992,
032149| NOTE: Implementation detail supporting search page behavior.
032150| src/lib/locations/us-locations.ts:83:     state: "AZ",
032151| NOTE: Implementation detail supporting search page behavior.
032152| src/lib/locations/us-locations.ts:84:   },
032153| NOTE: Implementation detail supporting search page behavior.
032154| src/lib/locations/us-locations.ts:85:   {
032155| NOTE: Implementation detail supporting search page behavior.
032156| src/lib/locations/us-locations.ts:86:     id: "philadelphia",
032157| NOTE: Implementation detail supporting search page behavior.
032158| src/lib/locations/us-locations.ts:87:     name: "Philadelphia",
032159| NOTE: Implementation detail supporting search page behavior.
032160| src/lib/locations/us-locations.ts:88:     searchTerms: ["philadelphia", "philly", "philadelphia pa", "phila"],
032161| NOTE: Implementation detail supporting search page behavior.
032162| src/lib/locations/us-locations.ts:89:     displayName: "Philadelphia, PA",
032163| NOTE: Implementation detail supporting search page behavior.
032164| src/lib/locations/us-locations.ts:90:     type: "city",
032165| NOTE: Implementation detail supporting search page behavior.
032166| src/lib/locations/us-locations.ts:91:     center: [-75.1652, 39.9526],
032167| NOTE: Implementation detail supporting search page behavior.
032168| src/lib/locations/us-locations.ts:92:     bbox: [-75.2803, 39.8671, -74.9558, 40.1379],
032169| NOTE: Implementation detail supporting search page behavior.
032170| src/lib/locations/us-locations.ts:93:     population: 1584064,
032171| NOTE: Implementation detail supporting search page behavior.
032172| src/lib/locations/us-locations.ts:94:     state: "PA",
032173| NOTE: Implementation detail supporting search page behavior.
032174| src/lib/locations/us-locations.ts:95:   },
032175| NOTE: Implementation detail supporting search page behavior.
032176| src/lib/locations/us-locations.ts:96:   {
032177| NOTE: Implementation detail supporting search page behavior.
032178| src/lib/locations/us-locations.ts:97:     id: "san-antonio",
032179| NOTE: Implementation detail supporting search page behavior.
032180| src/lib/locations/us-locations.ts:98:     name: "San Antonio",
032181| NOTE: Implementation detail supporting search page behavior.
032182| src/lib/locations/us-locations.ts:99:     searchTerms: ["san antonio", "san antonio tx", "san antonio texas"],
032183| NOTE: Implementation detail supporting search page behavior.
032184| src/lib/locations/us-locations.ts:100:     displayName: "San Antonio, TX",
032185| NOTE: Implementation detail supporting search page behavior.
032186| src/lib/locations/us-locations.ts:101:     type: "city",
032187| NOTE: Implementation detail supporting search page behavior.
032188| src/lib/locations/us-locations.ts:102:     center: [-98.4936, 29.4241],
032189| NOTE: Implementation detail supporting search page behavior.
032190| src/lib/locations/us-locations.ts:103:     bbox: [-98.7591, 29.2037, -98.2098, 29.7164],
032191| NOTE: Implementation detail supporting search page behavior.
032192| src/lib/locations/us-locations.ts:104:     population: 1547253,
032193| NOTE: Implementation detail supporting search page behavior.
032194| src/lib/locations/us-locations.ts:105:     state: "TX",
032195| NOTE: Implementation detail supporting search page behavior.
032196| src/lib/locations/us-locations.ts:106:   },
032197| NOTE: Implementation detail supporting search page behavior.
032198| src/lib/locations/us-locations.ts:107:   {
032199| NOTE: Implementation detail supporting search page behavior.
032200| src/lib/locations/us-locations.ts:108:     id: "san-diego",
032201| NOTE: Implementation detail supporting search page behavior.
032202| src/lib/locations/us-locations.ts:109:     name: "San Diego",
032203| NOTE: Implementation detail supporting search page behavior.
032204| src/lib/locations/us-locations.ts:110:     searchTerms: ["san diego", "san diego ca", "san diego california", "sd"],
032205| NOTE: Implementation detail supporting search page behavior.
032206| src/lib/locations/us-locations.ts:111:     displayName: "San Diego, CA",
032207| NOTE: Implementation detail supporting search page behavior.
032208| src/lib/locations/us-locations.ts:112:     type: "city",
032209| NOTE: Implementation detail supporting search page behavior.
032210| src/lib/locations/us-locations.ts:113:     center: [-117.1611, 32.7157],
032211| NOTE: Implementation detail supporting search page behavior.
032212| src/lib/locations/us-locations.ts:114:     bbox: [-117.2821, 32.5345, -116.9053, 33.1141],
032213| NOTE: Implementation detail supporting search page behavior.
032214| src/lib/locations/us-locations.ts:115:     population: 1423851,
032215| NOTE: Implementation detail supporting search page behavior.
032216| src/lib/locations/us-locations.ts:116:     state: "CA",
032217| NOTE: Implementation detail supporting search page behavior.
032218| src/lib/locations/us-locations.ts:117:   },
032219| NOTE: Implementation detail supporting search page behavior.
032220| src/lib/locations/us-locations.ts:118:   {
032221| NOTE: Implementation detail supporting search page behavior.
032222| src/lib/locations/us-locations.ts:119:     id: "dallas",
032223| NOTE: Implementation detail supporting search page behavior.
032224| src/lib/locations/us-locations.ts:120:     name: "Dallas",
032225| NOTE: Implementation detail supporting search page behavior.
032226| src/lib/locations/us-locations.ts:121:     searchTerms: ["dallas", "dallas tx", "dallas texas", "dfw"],
032227| NOTE: Implementation detail supporting search page behavior.
032228| src/lib/locations/us-locations.ts:122:     displayName: "Dallas, TX",
032229| NOTE: Implementation detail supporting search page behavior.
032230| src/lib/locations/us-locations.ts:123:     type: "city",
032231| NOTE: Implementation detail supporting search page behavior.
032232| src/lib/locations/us-locations.ts:124:     center: [-96.797, 32.7767],
032233| NOTE: Implementation detail supporting search page behavior.
032234| src/lib/locations/us-locations.ts:125:     bbox: [-96.9989, 32.6178, -96.5556, 33.0237],
032235| NOTE: Implementation detail supporting search page behavior.
032236| src/lib/locations/us-locations.ts:126:     population: 1343573,
032237| NOTE: Implementation detail supporting search page behavior.
032238| src/lib/locations/us-locations.ts:127:     state: "TX",
032239| NOTE: Implementation detail supporting search page behavior.
032240| src/lib/locations/us-locations.ts:128:   },
032241| NOTE: Implementation detail supporting search page behavior.
032242| src/lib/locations/us-locations.ts:129:   {
032243| NOTE: Implementation detail supporting search page behavior.
032244| src/lib/locations/us-locations.ts:130:     id: "san-jose",
032245| NOTE: Implementation detail supporting search page behavior.
032246| src/lib/locations/us-locations.ts:131:     name: "San Jose",
032247| NOTE: Implementation detail supporting search page behavior.
032248| src/lib/locations/us-locations.ts:132:     searchTerms: ["san jose", "san jose ca", "san jose california"],
032249| NOTE: Implementation detail supporting search page behavior.
032250| src/lib/locations/us-locations.ts:133:     displayName: "San Jose, CA",
032251| NOTE: Implementation detail supporting search page behavior.
032252| src/lib/locations/us-locations.ts:134:     type: "city",
032253| NOTE: Implementation detail supporting search page behavior.
032254| src/lib/locations/us-locations.ts:135:     center: [-121.8863, 37.3382],
032255| NOTE: Implementation detail supporting search page behavior.
032256| src/lib/locations/us-locations.ts:136:     bbox: [-122.0468, 37.1248, -121.7328, 37.4691],
032257| NOTE: Implementation detail supporting search page behavior.
032258| src/lib/locations/us-locations.ts:137:     population: 1021795,
032259| NOTE: Implementation detail supporting search page behavior.
032260| src/lib/locations/us-locations.ts:138:     state: "CA",
032261| NOTE: Implementation detail supporting search page behavior.
032262| src/lib/locations/us-locations.ts:139:   },
032263| NOTE: Implementation detail supporting search page behavior.
032264| src/lib/locations/us-locations.ts:140:   {
032265| NOTE: Implementation detail supporting search page behavior.
032266| src/lib/locations/us-locations.ts:141:     id: "austin",
032267| NOTE: Implementation detail supporting search page behavior.
032268| src/lib/locations/us-locations.ts:142:     name: "Austin",
032269| NOTE: Implementation detail supporting search page behavior.
032270| src/lib/locations/us-locations.ts:143:     searchTerms: ["austin", "austin tx", "austin texas", "atx"],
032271| NOTE: Implementation detail supporting search page behavior.
032272| src/lib/locations/us-locations.ts:144:     displayName: "Austin, TX",
032273| NOTE: Implementation detail supporting search page behavior.
032274| src/lib/locations/us-locations.ts:145:     type: "city",
032275| NOTE: Implementation detail supporting search page behavior.
032276| src/lib/locations/us-locations.ts:146:     center: [-97.7431, 30.2672],
032277| NOTE: Implementation detail supporting search page behavior.
032278| src/lib/locations/us-locations.ts:147:     bbox: [-97.9384, 30.0986, -97.5614, 30.5167],
032279| NOTE: Implementation detail supporting search page behavior.
032280| src/lib/locations/us-locations.ts:148:     population: 978908,
032281| NOTE: Implementation detail supporting search page behavior.
032282| src/lib/locations/us-locations.ts:149:     state: "TX",
032283| NOTE: Implementation detail supporting search page behavior.
032284| src/lib/locations/us-locations.ts:150:   },
032285| NOTE: Implementation detail supporting search page behavior.
032286| src/lib/locations/us-locations.ts:151:   {
032287| NOTE: Implementation detail supporting search page behavior.
032288| src/lib/locations/us-locations.ts:152:     id: "jacksonville",
032289| NOTE: Implementation detail supporting search page behavior.
032290| src/lib/locations/us-locations.ts:153:     name: "Jacksonville",
032291| NOTE: Implementation detail supporting search page behavior.
032292| src/lib/locations/us-locations.ts:154:     searchTerms: [
032293| NOTE: Implementation detail supporting search page behavior.
032294| src/lib/locations/us-locations.ts:155:       "jacksonville",
032295| NOTE: Implementation detail supporting search page behavior.
032296| src/lib/locations/us-locations.ts:156:       "jacksonville fl",
032297| NOTE: Implementation detail supporting search page behavior.
032298| src/lib/locations/us-locations.ts:157:       "jacksonville florida",
032299| NOTE: Implementation detail supporting search page behavior.
032300| src/lib/locations/us-locations.ts:158:       "jax",
032301| NOTE: Implementation detail supporting search page behavior.
032302| src/lib/locations/us-locations.ts:159:     ],
032303| NOTE: Implementation detail supporting search page behavior.
032304| src/lib/locations/us-locations.ts:160:     displayName: "Jacksonville, FL",
032305| NOTE: Implementation detail supporting search page behavior.
032306| src/lib/locations/us-locations.ts:161:     type: "city",
032307| NOTE: Implementation detail supporting search page behavior.
032308| src/lib/locations/us-locations.ts:162:     center: [-81.6557, 30.3322],
032309| NOTE: Implementation detail supporting search page behavior.
032310| src/lib/locations/us-locations.ts:163:     bbox: [-81.9164, 30.1034, -81.3917, 30.5869],
032311| NOTE: Implementation detail supporting search page behavior.
032312| src/lib/locations/us-locations.ts:164:     population: 911507,
032313| NOTE: Implementation detail supporting search page behavior.
032314| src/lib/locations/us-locations.ts:165:     state: "FL",
032315| NOTE: Implementation detail supporting search page behavior.
032316| src/lib/locations/us-locations.ts:166:   },
032317| NOTE: Implementation detail supporting search page behavior.
032318| src/lib/locations/us-locations.ts:167:   {
032319| NOTE: Implementation detail supporting search page behavior.
032320| src/lib/locations/us-locations.ts:168:     id: "fort-worth",
032321| NOTE: Implementation detail supporting search page behavior.
032322| src/lib/locations/us-locations.ts:169:     name: "Fort Worth",
032323| NOTE: Implementation detail supporting search page behavior.
032324| src/lib/locations/us-locations.ts:170:     searchTerms: ["fort worth", "fort worth tx", "ft worth"],
032325| NOTE: Implementation detail supporting search page behavior.
032326| src/lib/locations/us-locations.ts:171:     displayName: "Fort Worth, TX",
032327| NOTE: Implementation detail supporting search page behavior.
032328| src/lib/locations/us-locations.ts:172:     type: "city",
032329| NOTE: Implementation detail supporting search page behavior.
032330| src/lib/locations/us-locations.ts:173:     center: [-97.3308, 32.7555],
032331| NOTE: Implementation detail supporting search page behavior.
032332| src/lib/locations/us-locations.ts:174:     bbox: [-97.5628, 32.5513, -97.0336, 32.9905],
032333| NOTE: Implementation detail supporting search page behavior.
032334| src/lib/locations/us-locations.ts:175:     population: 909585,
032335| NOTE: Implementation detail supporting search page behavior.
032336| src/lib/locations/us-locations.ts:176:     state: "TX",
032337| NOTE: Implementation detail supporting search page behavior.
032338| src/lib/locations/us-locations.ts:177:   },
032339| NOTE: Implementation detail supporting search page behavior.
032340| src/lib/locations/us-locations.ts:178:   {
032341| NOTE: Implementation detail supporting search page behavior.
032342| src/lib/locations/us-locations.ts:179:     id: "columbus",
032343| NOTE: Implementation detail supporting search page behavior.
032344| src/lib/locations/us-locations.ts:180:     name: "Columbus",
032345| NOTE: Implementation detail supporting search page behavior.
032346| src/lib/locations/us-locations.ts:181:     searchTerms: ["columbus", "columbus oh", "columbus ohio"],
032347| NOTE: Implementation detail supporting search page behavior.
032348| src/lib/locations/us-locations.ts:182:     displayName: "Columbus, OH",
032349| NOTE: Implementation detail supporting search page behavior.
032350| src/lib/locations/us-locations.ts:183:     type: "city",
032351| NOTE: Implementation detail supporting search page behavior.
032352| src/lib/locations/us-locations.ts:184:     center: [-82.9988, 39.9612],
032353| NOTE: Implementation detail supporting search page behavior.
032354| src/lib/locations/us-locations.ts:185:     bbox: [-83.2092, 39.8086, -82.7713, 40.1572],
032355| NOTE: Implementation detail supporting search page behavior.
032356| src/lib/locations/us-locations.ts:186:     population: 905748,
032357| NOTE: Implementation detail supporting search page behavior.
032358| src/lib/locations/us-locations.ts:187:     state: "OH",
032359| NOTE: Implementation detail supporting search page behavior.
032360| src/lib/locations/us-locations.ts:188:   },
032361| NOTE: Implementation detail supporting search page behavior.
032362| src/lib/locations/us-locations.ts:189:   {
032363| NOTE: Implementation detail supporting search page behavior.
032364| src/lib/locations/us-locations.ts:190:     id: "sf",
032365| NOTE: Implementation detail supporting search page behavior.
032366| src/lib/locations/us-locations.ts:191:     name: "San Francisco",
032367| NOTE: Implementation detail supporting search page behavior.
032368| src/lib/locations/us-locations.ts:192:     searchTerms: [
032369| NOTE: Implementation detail supporting search page behavior.
032370| src/lib/locations/us-locations.ts:193:       "san francisco",
032371| NOTE: Implementation detail supporting search page behavior.
032372| src/lib/locations/us-locations.ts:194:       "sf",
032373| NOTE: Implementation detail supporting search page behavior.
032374| src/lib/locations/us-locations.ts:195:       "san fran",
032375| NOTE: Implementation detail supporting search page behavior.
032376| src/lib/locations/us-locations.ts:196:       "san francisco ca",
032377| NOTE: Implementation detail supporting search page behavior.
032378| src/lib/locations/us-locations.ts:197:       "frisco",
032379| NOTE: Implementation detail supporting search page behavior.
032380| src/lib/locations/us-locations.ts:198:     ],
032381| NOTE: Implementation detail supporting search page behavior.
032382| src/lib/locations/us-locations.ts:199:     displayName: "San Francisco, CA",
032383| NOTE: Implementation detail supporting search page behavior.
032384| src/lib/locations/us-locations.ts:200:     type: "city",
032385| NOTE: Implementation detail supporting search page behavior.
032386| src/lib/locations/us-locations.ts:201:     center: [-122.4194, 37.7749],
032387| NOTE: Implementation detail supporting search page behavior.
032388| src/lib/locations/us-locations.ts:202:     bbox: [-122.5155, 37.7082, -122.357, 37.8324],
032389| NOTE: Implementation detail supporting search page behavior.
032390| src/lib/locations/us-locations.ts:203:     population: 873965,
032391| NOTE: Implementation detail supporting search page behavior.
032392| src/lib/locations/us-locations.ts:204:     state: "CA",
032393| NOTE: Implementation detail supporting search page behavior.
032394| src/lib/locations/us-locations.ts:205:   },
032395| NOTE: Implementation detail supporting search page behavior.
032396| src/lib/locations/us-locations.ts:206:   {
032397| NOTE: Implementation detail supporting search page behavior.
032398| src/lib/locations/us-locations.ts:207:     id: "charlotte",
032399| NOTE: Implementation detail supporting search page behavior.
032400| src/lib/locations/us-locations.ts:208:     name: "Charlotte",
032401| NOTE: Implementation detail supporting search page behavior.
032402| src/lib/locations/us-locations.ts:209:     searchTerms: [
032403| NOTE: Implementation detail supporting search page behavior.
032404| src/lib/locations/us-locations.ts:210:       "charlotte",
032405| NOTE: Implementation detail supporting search page behavior.
032406| src/lib/locations/us-locations.ts:211:       "charlotte nc",
032407| NOTE: Implementation detail supporting search page behavior.
032408| src/lib/locations/us-locations.ts:212:       "charlotte north carolina",
032409| NOTE: Implementation detail supporting search page behavior.
032410| src/lib/locations/us-locations.ts:213:       "clt",
032411| NOTE: Implementation detail supporting search page behavior.
032412| src/lib/locations/us-locations.ts:214:     ],
032413| NOTE: Implementation detail supporting search page behavior.
032414| src/lib/locations/us-locations.ts:215:     displayName: "Charlotte, NC",
032415| NOTE: Implementation detail supporting search page behavior.
032416| src/lib/locations/us-locations.ts:216:     type: "city",
032417| NOTE: Implementation detail supporting search page behavior.
032418| src/lib/locations/us-locations.ts:217:     center: [-80.8431, 35.2271],
032419| NOTE: Implementation detail supporting search page behavior.
032420| src/lib/locations/us-locations.ts:218:     bbox: [-81.0095, 35.0027, -80.6509, 35.4202],
032421| NOTE: Implementation detail supporting search page behavior.
032422| src/lib/locations/us-locations.ts:219:     population: 872498,
032423| NOTE: Implementation detail supporting search page behavior.
032424| src/lib/locations/us-locations.ts:220:     state: "NC",
032425| NOTE: Implementation detail supporting search page behavior.
032426| src/lib/locations/us-locations.ts:221:   },
032427| NOTE: Implementation detail supporting search page behavior.
032428| src/lib/locations/us-locations.ts:222:   {
032429| NOTE: Implementation detail supporting search page behavior.
032430| src/lib/locations/us-locations.ts:223:     id: "indianapolis",
032431| NOTE: Implementation detail supporting search page behavior.
032432| src/lib/locations/us-locations.ts:224:     name: "Indianapolis",
032433| NOTE: Implementation detail supporting search page behavior.
032434| src/lib/locations/us-locations.ts:225:     searchTerms: ["indianapolis", "indianapolis in", "indy"],
032435| NOTE: Implementation detail supporting search page behavior.
032436| src/lib/locations/us-locations.ts:226:     displayName: "Indianapolis, IN",
032437| NOTE: Implementation detail supporting search page behavior.
032438| src/lib/locations/us-locations.ts:227:     type: "city",
032439| NOTE: Implementation detail supporting search page behavior.
032440| src/lib/locations/us-locations.ts:228:     center: [-86.1581, 39.7684],
032441| NOTE: Implementation detail supporting search page behavior.
032442| src/lib/locations/us-locations.ts:229:     bbox: [-86.3279, 39.6321, -85.9376, 39.9276],
032443| NOTE: Implementation detail supporting search page behavior.
032444| src/lib/locations/us-locations.ts:230:     population: 867125,
032445| NOTE: Implementation detail supporting search page behavior.
032446| src/lib/locations/us-locations.ts:231:     state: "IN",
032447| NOTE: Implementation detail supporting search page behavior.
032448| src/lib/locations/us-locations.ts:232:   },
032449| NOTE: Implementation detail supporting search page behavior.
032450| src/lib/locations/us-locations.ts:233:   {
032451| NOTE: Implementation detail supporting search page behavior.
032452| src/lib/locations/us-locations.ts:234:     id: "seattle",
032453| NOTE: Implementation detail supporting search page behavior.
032454| src/lib/locations/us-locations.ts:235:     name: "Seattle",
032455| NOTE: Implementation detail supporting search page behavior.
032456| src/lib/locations/us-locations.ts:236:     searchTerms: ["seattle", "seattle wa", "seattle washington", "sea"],
032457| NOTE: Implementation detail supporting search page behavior.
032458| src/lib/locations/us-locations.ts:237:     displayName: "Seattle, WA",
032459| NOTE: Implementation detail supporting search page behavior.
032460| src/lib/locations/us-locations.ts:238:     type: "city",
032461| NOTE: Implementation detail supporting search page behavior.
032462| src/lib/locations/us-locations.ts:239:     center: [-122.3321, 47.6062],
032463| NOTE: Implementation detail supporting search page behavior.
032464| src/lib/locations/us-locations.ts:240:     bbox: [-122.436, 47.4951, -122.236, 47.7341],
032465| NOTE: Implementation detail supporting search page behavior.
032466| src/lib/locations/us-locations.ts:241:     population: 753675,
032467| NOTE: Implementation detail supporting search page behavior.
032468| src/lib/locations/us-locations.ts:242:     state: "WA",
032469| NOTE: Implementation detail supporting search page behavior.
032470| src/lib/locations/us-locations.ts:243:   },
032471| NOTE: Implementation detail supporting search page behavior.
032472| src/lib/locations/us-locations.ts:244:   {
032473| NOTE: Implementation detail supporting search page behavior.
032474| src/lib/locations/us-locations.ts:245:     id: "denver",
032475| NOTE: Implementation detail supporting search page behavior.
032476| src/lib/locations/us-locations.ts:246:     name: "Denver",
032477| NOTE: Implementation detail supporting search page behavior.
032478| src/lib/locations/us-locations.ts:247:     searchTerms: ["denver", "denver co", "denver colorado", "mile high"],
032479| NOTE: Implementation detail supporting search page behavior.
032480| src/lib/locations/us-locations.ts:248:     displayName: "Denver, CO",
032481| NOTE: Implementation detail supporting search page behavior.
032482| src/lib/locations/us-locations.ts:249:     type: "city",
032483| NOTE: Implementation detail supporting search page behavior.
032484| src/lib/locations/us-locations.ts:250:     center: [-104.9903, 39.7392],
032485| NOTE: Implementation detail supporting search page behavior.
032486| src/lib/locations/us-locations.ts:251:     bbox: [-105.1098, 39.6144, -104.5996, 39.9143],
032487| NOTE: Implementation detail supporting search page behavior.
032488| src/lib/locations/us-locations.ts:252:     population: 727211,
032489| NOTE: Implementation detail supporting search page behavior.
032490| src/lib/locations/us-locations.ts:253:     state: "CO",
032491| NOTE: Implementation detail supporting search page behavior.
032492| src/lib/locations/us-locations.ts:254:   },
032493| NOTE: Implementation detail supporting search page behavior.
032494| src/lib/locations/us-locations.ts:255:   {
032495| NOTE: Implementation detail supporting search page behavior.
032496| src/lib/locations/us-locations.ts:256:     id: "washington-dc",
032497| NOTE: Implementation detail supporting search page behavior.
032498| src/lib/locations/us-locations.ts:257:     name: "Washington",
032499| NOTE: Implementation detail supporting search page behavior.
032500| src/lib/locations/us-locations.ts:258:     searchTerms: [
032501| NOTE: Implementation detail supporting search page behavior.
032502| src/lib/locations/us-locations.ts:259:       "washington dc",
032503| NOTE: Implementation detail supporting search page behavior.
032504| src/lib/locations/us-locations.ts:260:       "dc",
032505| NOTE: Implementation detail supporting search page behavior.
032506| src/lib/locations/us-locations.ts:261:       "d.c.",
032507| NOTE: Implementation detail supporting search page behavior.
032508| src/lib/locations/us-locations.ts:262:       "washington d.c.",
032509| NOTE: Implementation detail supporting search page behavior.
032510| src/lib/locations/us-locations.ts:263:       "washington",
032511| NOTE: Implementation detail supporting search page behavior.
032512| src/lib/locations/us-locations.ts:264:     ],
032513| NOTE: Implementation detail supporting search page behavior.
032514| src/lib/locations/us-locations.ts:265:     displayName: "Washington, DC",
032515| NOTE: Implementation detail supporting search page behavior.
032516| src/lib/locations/us-locations.ts:266:     type: "city",
032517| NOTE: Implementation detail supporting search page behavior.
032518| src/lib/locations/us-locations.ts:267:     center: [-77.0369, 38.9072],
032519| NOTE: Implementation detail supporting search page behavior.
032520| src/lib/locations/us-locations.ts:268:     bbox: [-77.1198, 38.7916, -76.9094, 38.9958],
032521| NOTE: Implementation detail supporting search page behavior.
032522| src/lib/locations/us-locations.ts:269:     population: 689545,
032523| NOTE: Implementation detail supporting search page behavior.
032524| src/lib/locations/us-locations.ts:270:     state: "DC",
032525| NOTE: Implementation detail supporting search page behavior.
032526| src/lib/locations/us-locations.ts:271:   },
032527| NOTE: Implementation detail supporting search page behavior.
032528| src/lib/locations/us-locations.ts:272:   {
032529| NOTE: Implementation detail supporting search page behavior.
032530| src/lib/locations/us-locations.ts:273:     id: "boston",
032531| NOTE: Implementation detail supporting search page behavior.
032532| src/lib/locations/us-locations.ts:274:     name: "Boston",
032533| NOTE: Implementation detail supporting search page behavior.
032534| src/lib/locations/us-locations.ts:275:     searchTerms: ["boston", "boston ma", "boston massachusetts", "bos"],
032535| NOTE: Implementation detail supporting search page behavior.
032536| src/lib/locations/us-locations.ts:276:     displayName: "Boston, MA",
032537| NOTE: Implementation detail supporting search page behavior.
032538| src/lib/locations/us-locations.ts:277:     type: "city",
032539| NOTE: Implementation detail supporting search page behavior.
032540| src/lib/locations/us-locations.ts:278:     center: [-71.0589, 42.3601],
032541| NOTE: Implementation detail supporting search page behavior.
032542| src/lib/locations/us-locations.ts:279:     bbox: [-71.1912, 42.2279, -70.9235, 42.3969],
032543| NOTE: Implementation detail supporting search page behavior.
032544| src/lib/locations/us-locations.ts:280:     population: 675647,
032545| NOTE: Implementation detail supporting search page behavior.
032546| src/lib/locations/us-locations.ts:281:     state: "MA",
032547| NOTE: Implementation detail supporting search page behavior.
032548| src/lib/locations/us-locations.ts:282:   },
032549| NOTE: Implementation detail supporting search page behavior.
032550| src/lib/locations/us-locations.ts:283:   {
032551| NOTE: Implementation detail supporting search page behavior.
032552| src/lib/locations/us-locations.ts:284:     id: "nashville",
032553| NOTE: Implementation detail supporting search page behavior.
032554| src/lib/locations/us-locations.ts:285:     name: "Nashville",
032555| NOTE: Implementation detail supporting search page behavior.
032556| src/lib/locations/us-locations.ts:286:     searchTerms: [
032557| NOTE: Implementation detail supporting search page behavior.
032558| src/lib/locations/us-locations.ts:287:       "nashville",
032559| NOTE: Implementation detail supporting search page behavior.
032560| src/lib/locations/us-locations.ts:288:       "nashville tn",
032561| NOTE: Implementation detail supporting search page behavior.
032562| src/lib/locations/us-locations.ts:289:       "nashville tennessee",
032563| NOTE: Implementation detail supporting search page behavior.
032564| src/lib/locations/us-locations.ts:290:       "music city",
032565| NOTE: Implementation detail supporting search page behavior.
032566| src/lib/locations/us-locations.ts:291:     ],
032567| NOTE: Implementation detail supporting search page behavior.
032568| src/lib/locations/us-locations.ts:292:     displayName: "Nashville, TN",
032569| NOTE: Implementation detail supporting search page behavior.
032570| src/lib/locations/us-locations.ts:293:     type: "city",
032571| NOTE: Implementation detail supporting search page behavior.
032572| src/lib/locations/us-locations.ts:294:     center: [-86.7816, 36.1627],
032573| NOTE: Implementation detail supporting search page behavior.
032574| src/lib/locations/us-locations.ts:295:     bbox: [-87.0549, 35.9678, -86.5156, 36.4054],
032575| NOTE: Implementation detail supporting search page behavior.
032576| src/lib/locations/us-locations.ts:296:     population: 670820,
032577| NOTE: Implementation detail supporting search page behavior.
032578| src/lib/locations/us-locations.ts:297:     state: "TN",
032579| NOTE: Implementation detail supporting search page behavior.
032580| src/lib/locations/us-locations.ts:298:   },
032581| NOTE: Implementation detail supporting search page behavior.
032582| src/lib/locations/us-locations.ts:299:   {
032583| NOTE: Implementation detail supporting search page behavior.
032584| src/lib/locations/us-locations.ts:300:     id: "detroit",
032585| NOTE: Implementation detail supporting search page behavior.
032586| src/lib/locations/us-locations.ts:301:     name: "Detroit",
032587| NOTE: Implementation detail supporting search page behavior.
032588| src/lib/locations/us-locations.ts:302:     searchTerms: ["detroit", "detroit mi", "detroit michigan", "motor city"],
032589| NOTE: Implementation detail supporting search page behavior.
032590| src/lib/locations/us-locations.ts:303:     displayName: "Detroit, MI",
032591| NOTE: Implementation detail supporting search page behavior.
032592| src/lib/locations/us-locations.ts:304:     type: "city",
032593| NOTE: Implementation detail supporting search page behavior.
032594| src/lib/locations/us-locations.ts:305:     center: [-83.0458, 42.3314],
032595| NOTE: Implementation detail supporting search page behavior.
032596| src/lib/locations/us-locations.ts:306:     bbox: [-83.2875, 42.255, -82.9104, 42.4502],
032597| NOTE: Implementation detail supporting search page behavior.
032598| src/lib/locations/us-locations.ts:307:     population: 639111,
032599| NOTE: Implementation detail supporting search page behavior.
032600| src/lib/locations/us-locations.ts:308:     state: "MI",
032601| NOTE: Implementation detail supporting search page behavior.
032602| src/lib/locations/us-locations.ts:309:   },
032603| NOTE: Implementation detail supporting search page behavior.
032604| src/lib/locations/us-locations.ts:310:   {
032605| NOTE: Implementation detail supporting search page behavior.
032606| src/lib/locations/us-locations.ts:311:     id: "portland",
032607| NOTE: Implementation detail supporting search page behavior.
032608| src/lib/locations/us-locations.ts:312:     name: "Portland",
032609| NOTE: Implementation detail supporting search page behavior.
032610| src/lib/locations/us-locations.ts:313:     searchTerms: ["portland", "portland or", "portland oregon", "pdx"],
032611| NOTE: Implementation detail supporting search page behavior.
032612| src/lib/locations/us-locations.ts:314:     displayName: "Portland, OR",
032613| NOTE: Implementation detail supporting search page behavior.
032614| src/lib/locations/us-locations.ts:315:     type: "city",
032615| NOTE: Implementation detail supporting search page behavior.
032616| src/lib/locations/us-locations.ts:316:     center: [-122.6765, 45.5152],
032617| NOTE: Implementation detail supporting search page behavior.
032618| src/lib/locations/us-locations.ts:317:     bbox: [-122.836, 45.4323, -122.4715, 45.6534],
032619| NOTE: Implementation detail supporting search page behavior.
032620| src/lib/locations/us-locations.ts:318:     population: 652503,
032621| NOTE: Implementation detail supporting search page behavior.
032622| src/lib/locations/us-locations.ts:319:     state: "OR",
032623| NOTE: Implementation detail supporting search page behavior.
032624| src/lib/locations/us-locations.ts:320:   },
032625| NOTE: Implementation detail supporting search page behavior.
032626| src/lib/locations/us-locations.ts:321:   {
032627| NOTE: Implementation detail supporting search page behavior.
032628| src/lib/locations/us-locations.ts:322:     id: "memphis",
032629| NOTE: Implementation detail supporting search page behavior.
032630| src/lib/locations/us-locations.ts:323:     name: "Memphis",
032631| NOTE: Implementation detail supporting search page behavior.
032632| src/lib/locations/us-locations.ts:324:     searchTerms: ["memphis", "memphis tn", "memphis tennessee"],
032633| NOTE: Implementation detail supporting search page behavior.
032634| src/lib/locations/us-locations.ts:325:     displayName: "Memphis, TN",
032635| NOTE: Implementation detail supporting search page behavior.
032636| src/lib/locations/us-locations.ts:326:     type: "city",
032637| NOTE: Implementation detail supporting search page behavior.
032638| src/lib/locations/us-locations.ts:327:     center: [-90.049, 35.1495],
032639| NOTE: Implementation detail supporting search page behavior.
032640| src/lib/locations/us-locations.ts:328:     bbox: [-90.1999, 34.9943, -89.7086, 35.3168],
032641| NOTE: Implementation detail supporting search page behavior.
032642| src/lib/locations/us-locations.ts:329:     population: 633104,
032643| NOTE: Implementation detail supporting search page behavior.
032644| src/lib/locations/us-locations.ts:330:     state: "TN",
032645| NOTE: Implementation detail supporting search page behavior.
032646| src/lib/locations/us-locations.ts:331:   },
032647| NOTE: Implementation detail supporting search page behavior.
032648| src/lib/locations/us-locations.ts:332:   {
032649| NOTE: Implementation detail supporting search page behavior.
032650| src/lib/locations/us-locations.ts:333:     id: "louisville",
032651| NOTE: Implementation detail supporting search page behavior.
032652| src/lib/locations/us-locations.ts:334:     name: "Louisville",
032653| NOTE: Implementation detail supporting search page behavior.
032654| src/lib/locations/us-locations.ts:335:     searchTerms: ["louisville", "louisville ky", "louisville kentucky"],
032655| NOTE: Implementation detail supporting search page behavior.
032656| src/lib/locations/us-locations.ts:336:     displayName: "Louisville, KY",
032657| NOTE: Implementation detail supporting search page behavior.
032658| src/lib/locations/us-locations.ts:337:     type: "city",
032659| NOTE: Implementation detail supporting search page behavior.
032660| src/lib/locations/us-locations.ts:338:     center: [-85.7585, 38.2527],
032661| NOTE: Implementation detail supporting search page behavior.
032662| src/lib/locations/us-locations.ts:339:     bbox: [-85.9481, 38.0548, -85.4206, 38.3801],
032663| NOTE: Implementation detail supporting search page behavior.
032664| src/lib/locations/us-locations.ts:340:     population: 617638,
032665| NOTE: Implementation detail supporting search page behavior.
032666| src/lib/locations/us-locations.ts:341:     state: "KY",
032667| NOTE: Implementation detail supporting search page behavior.
032668| src/lib/locations/us-locations.ts:342:   },
032669| NOTE: Implementation detail supporting search page behavior.
032670| src/lib/locations/us-locations.ts:343:   {
032671| NOTE: Implementation detail supporting search page behavior.
032672| src/lib/locations/us-locations.ts:344:     id: "baltimore",
032673| NOTE: Implementation detail supporting search page behavior.
032674| src/lib/locations/us-locations.ts:345:     name: "Baltimore",
032675| NOTE: Implementation detail supporting search page behavior.
032676| src/lib/locations/us-locations.ts:346:     searchTerms: ["baltimore", "baltimore md", "baltimore maryland", "bmore"],
032677| NOTE: Implementation detail supporting search page behavior.
032678| src/lib/locations/us-locations.ts:347:     displayName: "Baltimore, MD",
032679| NOTE: Implementation detail supporting search page behavior.
032680| src/lib/locations/us-locations.ts:348:     type: "city",
032681| NOTE: Implementation detail supporting search page behavior.
032682| src/lib/locations/us-locations.ts:349:     center: [-76.6122, 39.2904],
032683| NOTE: Implementation detail supporting search page behavior.
032684| src/lib/locations/us-locations.ts:350:     bbox: [-76.7112, 39.1974, -76.5295, 39.3721],
032685| NOTE: Implementation detail supporting search page behavior.
032686| src/lib/locations/us-locations.ts:351:     population: 585708,
032687| NOTE: Implementation detail supporting search page behavior.
032688| src/lib/locations/us-locations.ts:352:     state: "MD",
032689| NOTE: Implementation detail supporting search page behavior.
032690| src/lib/locations/us-locations.ts:353:   },
032691| NOTE: Implementation detail supporting search page behavior.
032692| src/lib/locations/us-locations.ts:354:   {
032693| NOTE: Implementation detail supporting search page behavior.
032694| src/lib/locations/us-locations.ts:355:     id: "milwaukee",
032695| NOTE: Implementation detail supporting search page behavior.
032696| src/lib/locations/us-locations.ts:356:     name: "Milwaukee",
032697| NOTE: Implementation detail supporting search page behavior.
032698| src/lib/locations/us-locations.ts:357:     searchTerms: ["milwaukee", "milwaukee wi", "milwaukee wisconsin", "mke"],
032699| NOTE: Implementation detail supporting search page behavior.
032700| src/lib/locations/us-locations.ts:358:     displayName: "Milwaukee, WI",
032701| NOTE: Implementation detail supporting search page behavior.
032702| src/lib/locations/us-locations.ts:359:     type: "city",
032703| NOTE: Implementation detail supporting search page behavior.
032704| src/lib/locations/us-locations.ts:360:     center: [-87.9065, 43.0389],
032705| NOTE: Implementation detail supporting search page behavior.
032706| src/lib/locations/us-locations.ts:361:     bbox: [-88.0695, 42.9211, -87.8635, 43.1947],
032707| NOTE: Implementation detail supporting search page behavior.
032708| src/lib/locations/us-locations.ts:362:     population: 577222,
032709| NOTE: Implementation detail supporting search page behavior.
032710| src/lib/locations/us-locations.ts:363:     state: "WI",
032711| NOTE: Implementation detail supporting search page behavior.
032712| src/lib/locations/us-locations.ts:364:   },
032713| NOTE: Implementation detail supporting search page behavior.
032714| src/lib/locations/us-locations.ts:365:   {
032715| NOTE: Implementation detail supporting search page behavior.
032716| src/lib/locations/us-locations.ts:366:     id: "albuquerque",
032717| NOTE: Implementation detail supporting search page behavior.
032718| src/lib/locations/us-locations.ts:367:     name: "Albuquerque",
032719| NOTE: Implementation detail supporting search page behavior.
032720| src/lib/locations/us-locations.ts:368:     searchTerms: ["albuquerque", "albuquerque nm", "abq"],
032721| NOTE: Implementation detail supporting search page behavior.
032722| src/lib/locations/us-locations.ts:369:     displayName: "Albuquerque, NM",
032723| NOTE: Implementation detail supporting search page behavior.
032724| src/lib/locations/us-locations.ts:370:     type: "city",
032725| NOTE: Implementation detail supporting search page behavior.
032726| src/lib/locations/us-locations.ts:371:     center: [-106.6504, 35.0844],
032727| NOTE: Implementation detail supporting search page behavior.
032728| src/lib/locations/us-locations.ts:372:     bbox: [-106.8816, 34.9474, -106.4724, 35.2184],
032729| NOTE: Implementation detail supporting search page behavior.
032730| src/lib/locations/us-locations.ts:373:     population: 560513,
032731| NOTE: Implementation detail supporting search page behavior.
032732| src/lib/locations/us-locations.ts:374:     state: "NM",
032733| NOTE: Implementation detail supporting search page behavior.
032734| src/lib/locations/us-locations.ts:375:   },
032735| NOTE: Implementation detail supporting search page behavior.
032736| src/lib/locations/us-locations.ts:376:   {
032737| NOTE: Implementation detail supporting search page behavior.
032738| src/lib/locations/us-locations.ts:377:     id: "tucson",
032739| NOTE: Implementation detail supporting search page behavior.
032740| src/lib/locations/us-locations.ts:378:     name: "Tucson",
032741| NOTE: Implementation detail supporting search page behavior.
032742| src/lib/locations/us-locations.ts:379:     searchTerms: ["tucson", "tucson az", "tucson arizona"],
032743| NOTE: Implementation detail supporting search page behavior.
032744| src/lib/locations/us-locations.ts:380:     displayName: "Tucson, AZ",
032745| NOTE: Implementation detail supporting search page behavior.
032746| src/lib/locations/us-locations.ts:381:     type: "city",
032747| NOTE: Implementation detail supporting search page behavior.
032748| src/lib/locations/us-locations.ts:382:     center: [-110.9747, 32.2226],
032749| NOTE: Implementation detail supporting search page behavior.
032750| src/lib/locations/us-locations.ts:383:     bbox: [-111.0832, 32.0576, -110.7412, 32.3233],
032751| NOTE: Implementation detail supporting search page behavior.
032752| src/lib/locations/us-locations.ts:384:     population: 548073,
032753| NOTE: Implementation detail supporting search page behavior.
032754| src/lib/locations/us-locations.ts:385:     state: "AZ",
032755| NOTE: Implementation detail supporting search page behavior.
032756| src/lib/locations/us-locations.ts:386:   },
032757| NOTE: Implementation detail supporting search page behavior.
032758| src/lib/locations/us-locations.ts:387:   {
032759| NOTE: Implementation detail supporting search page behavior.
032760| src/lib/locations/us-locations.ts:388:     id: "fresno",
032761| NOTE: Implementation detail supporting search page behavior.
032762| src/lib/locations/us-locations.ts:389:     name: "Fresno",
032763| NOTE: Implementation detail supporting search page behavior.
032764| src/lib/locations/us-locations.ts:390:     searchTerms: ["fresno", "fresno ca", "fresno california"],
032765| NOTE: Implementation detail supporting search page behavior.
032766| src/lib/locations/us-locations.ts:391:     displayName: "Fresno, CA",
032767| NOTE: Implementation detail supporting search page behavior.
032768| src/lib/locations/us-locations.ts:392:     type: "city",
032769| NOTE: Implementation detail supporting search page behavior.
032770| src/lib/locations/us-locations.ts:393:     center: [-119.7871, 36.7378],
032771| NOTE: Implementation detail supporting search page behavior.
032772| src/lib/locations/us-locations.ts:394:     bbox: [-119.9323, 36.6357, -119.6513, 36.9133],
032773| NOTE: Implementation detail supporting search page behavior.
032774| src/lib/locations/us-locations.ts:395:     population: 542107,
032775| NOTE: Implementation detail supporting search page behavior.
032776| src/lib/locations/us-locations.ts:396:     state: "CA",
032777| NOTE: Implementation detail supporting search page behavior.
032778| src/lib/locations/us-locations.ts:397:   },
032779| NOTE: Implementation detail supporting search page behavior.
032780| src/lib/locations/us-locations.ts:398:   {
032781| NOTE: Implementation detail supporting search page behavior.
032782| src/lib/locations/us-locations.ts:399:     id: "sacramento",
032783| NOTE: Implementation detail supporting search page behavior.
032784| src/lib/locations/us-locations.ts:400:     name: "Sacramento",
032785| NOTE: Implementation detail supporting search page behavior.
032786| src/lib/locations/us-locations.ts:401:     searchTerms: ["sacramento", "sacramento ca", "sac"],
032787| NOTE: Implementation detail supporting search page behavior.
032788| src/lib/locations/us-locations.ts:402:     displayName: "Sacramento, CA",
032789| NOTE: Implementation detail supporting search page behavior.
032790| src/lib/locations/us-locations.ts:403:     type: "city",
032791| NOTE: Implementation detail supporting search page behavior.
032792| src/lib/locations/us-locations.ts:404:     center: [-121.4944, 38.5816],
032793| NOTE: Implementation detail supporting search page behavior.
032794| src/lib/locations/us-locations.ts:405:     bbox: [-121.56, 38.4375, -121.3628, 38.6852],
032795| NOTE: Implementation detail supporting search page behavior.
032796| src/lib/locations/us-locations.ts:406:     population: 524943,
032797| NOTE: Implementation detail supporting search page behavior.
032798| src/lib/locations/us-locations.ts:407:     state: "CA",
032799| NOTE: Implementation detail supporting search page behavior.
032800| src/lib/locations/us-locations.ts:408:   },
032801| NOTE: Implementation detail supporting search page behavior.
032802| src/lib/locations/us-locations.ts:409:   {
032803| NOTE: Implementation detail supporting search page behavior.
032804| src/lib/locations/us-locations.ts:410:     id: "mesa",
032805| NOTE: Implementation detail supporting search page behavior.
032806| src/lib/locations/us-locations.ts:411:     name: "Mesa",
032807| NOTE: Implementation detail supporting search page behavior.
032808| src/lib/locations/us-locations.ts:412:     searchTerms: ["mesa", "mesa az", "mesa arizona"],
032809| NOTE: Implementation detail supporting search page behavior.
032810| src/lib/locations/us-locations.ts:413:     displayName: "Mesa, AZ",
032811| NOTE: Implementation detail supporting search page behavior.
032812| src/lib/locations/us-locations.ts:414:     type: "city",
032813| NOTE: Implementation detail supporting search page behavior.
032814| src/lib/locations/us-locations.ts:415:     center: [-111.8315, 33.4152],
032815| NOTE: Implementation detail supporting search page behavior.
032816| src/lib/locations/us-locations.ts:416:     bbox: [-111.9646, 33.2895, -111.5869, 33.5087],
032817| NOTE: Implementation detail supporting search page behavior.
032818| src/lib/locations/us-locations.ts:417:     population: 518012,
032819| NOTE: Implementation detail supporting search page behavior.
032820| src/lib/locations/us-locations.ts:418:     state: "AZ",
032821| NOTE: Implementation detail supporting search page behavior.
032822| src/lib/locations/us-locations.ts:419:   },
032823| NOTE: Implementation detail supporting search page behavior.
032824| src/lib/locations/us-locations.ts:420:   {
032825| NOTE: Implementation detail supporting search page behavior.
032826| src/lib/locations/us-locations.ts:421:     id: "atlanta",
032827| NOTE: Implementation detail supporting search page behavior.
032828| src/lib/locations/us-locations.ts:422:     name: "Atlanta",
032829| NOTE: Implementation detail supporting search page behavior.
032830| src/lib/locations/us-locations.ts:423:     searchTerms: ["atlanta", "atlanta ga", "atlanta georgia", "atl"],
032831| NOTE: Implementation detail supporting search page behavior.
032832| src/lib/locations/us-locations.ts:424:     displayName: "Atlanta, GA",
032833| NOTE: Implementation detail supporting search page behavior.
032834| src/lib/locations/us-locations.ts:425:     type: "city",
032835| NOTE: Implementation detail supporting search page behavior.
032836| src/lib/locations/us-locations.ts:426:     center: [-84.388, 33.749],
032837| NOTE: Implementation detail supporting search page behavior.
032838| src/lib/locations/us-locations.ts:427:     bbox: [-84.5516, 33.6479, -84.2893, 33.887],
032839| NOTE: Implementation detail supporting search page behavior.
032840| src/lib/locations/us-locations.ts:428:     population: 498715,
032841| NOTE: Implementation detail supporting search page behavior.
032842| src/lib/locations/us-locations.ts:429:     state: "GA",
032843| NOTE: Implementation detail supporting search page behavior.
032844| src/lib/locations/us-locations.ts:430:   },
032845| NOTE: Implementation detail supporting search page behavior.
032846| src/lib/locations/us-locations.ts:431:   {
032847| NOTE: Implementation detail supporting search page behavior.
032848| src/lib/locations/us-locations.ts:432:     id: "kansas-city",
032849| NOTE: Implementation detail supporting search page behavior.
032850| src/lib/locations/us-locations.ts:433:     name: "Kansas City",
032851| NOTE: Implementation detail supporting search page behavior.
032852| src/lib/locations/us-locations.ts:434:     searchTerms: ["kansas city", "kansas city mo", "kc"],
032853| NOTE: Implementation detail supporting search page behavior.
032854| src/lib/locations/us-locations.ts:435:     displayName: "Kansas City, MO",
032855| NOTE: Implementation detail supporting search page behavior.
032856| src/lib/locations/us-locations.ts:436:     type: "city",
032857| NOTE: Implementation detail supporting search page behavior.
032858| src/lib/locations/us-locations.ts:437:     center: [-94.5786, 39.0997],
032859| NOTE: Implementation detail supporting search page behavior.
032860| src/lib/locations/us-locations.ts:438:     bbox: [-94.7646, 38.8589, -94.3876, 39.3329],
032861| NOTE: Implementation detail supporting search page behavior.
032862| src/lib/locations/us-locations.ts:439:     population: 508090,
032863| NOTE: Implementation detail supporting search page behavior.
032864| src/lib/locations/us-locations.ts:440:     state: "MO",
032865| NOTE: Implementation detail supporting search page behavior.
032866| src/lib/locations/us-locations.ts:441:   },
032867| NOTE: Implementation detail supporting search page behavior.
032868| src/lib/locations/us-locations.ts:442:   {
032869| NOTE: Implementation detail supporting search page behavior.
032870| src/lib/locations/us-locations.ts:443:     id: "omaha",
032871| NOTE: Implementation detail supporting search page behavior.
032872| src/lib/locations/us-locations.ts:444:     name: "Omaha",
032873| NOTE: Implementation detail supporting search page behavior.
032874| src/lib/locations/us-locations.ts:445:     searchTerms: ["omaha", "omaha ne", "omaha nebraska"],
032875| NOTE: Implementation detail supporting search page behavior.
032876| src/lib/locations/us-locations.ts:446:     displayName: "Omaha, NE",
032877| NOTE: Implementation detail supporting search page behavior.
032878| src/lib/locations/us-locations.ts:447:     type: "city",
032879| NOTE: Implementation detail supporting search page behavior.
032880| src/lib/locations/us-locations.ts:448:     center: [-95.9345, 41.2565],
032881| NOTE: Implementation detail supporting search page behavior.
032882| src/lib/locations/us-locations.ts:449:     bbox: [-96.194, 41.1755, -95.8597, 41.3771],
032883| NOTE: Implementation detail supporting search page behavior.
032884| src/lib/locations/us-locations.ts:450:     population: 486051,
032885| NOTE: Implementation detail supporting search page behavior.
032886| src/lib/locations/us-locations.ts:451:     state: "NE",
032887| NOTE: Implementation detail supporting search page behavior.
032888| src/lib/locations/us-locations.ts:452:   },
032889| NOTE: Implementation detail supporting search page behavior.
032890| src/lib/locations/us-locations.ts:453:   {
032891| NOTE: Implementation detail supporting search page behavior.
032892| src/lib/locations/us-locations.ts:454:     id: "miami",
032893| NOTE: Implementation detail supporting search page behavior.
032894| src/lib/locations/us-locations.ts:455:     name: "Miami",
032895| NOTE: Implementation detail supporting search page behavior.
032896| src/lib/locations/us-locations.ts:456:     searchTerms: ["miami", "miami fl", "miami florida", "mia"],
032897| NOTE: Implementation detail supporting search page behavior.
032898| src/lib/locations/us-locations.ts:457:     displayName: "Miami, FL",
032899| NOTE: Implementation detail supporting search page behavior.
032900| src/lib/locations/us-locations.ts:458:     type: "city",
032901| NOTE: Implementation detail supporting search page behavior.
032902| src/lib/locations/us-locations.ts:459:     center: [-80.1918, 25.7617],
032903| NOTE: Implementation detail supporting search page behavior.
032904| src/lib/locations/us-locations.ts:460:     bbox: [-80.3193, 25.7091, -80.1395, 25.8556],
032905| NOTE: Implementation detail supporting search page behavior.
032906| src/lib/locations/us-locations.ts:461:     population: 467963,
032907| NOTE: Implementation detail supporting search page behavior.
032908| src/lib/locations/us-locations.ts:462:     state: "FL",
032909| NOTE: Implementation detail supporting search page behavior.
032910| src/lib/locations/us-locations.ts:463:   },
032911| NOTE: Implementation detail supporting search page behavior.
032912| src/lib/locations/us-locations.ts:464:   {
032913| NOTE: Implementation detail supporting search page behavior.
032914| src/lib/locations/us-locations.ts:465:     id: "oakland",
032915| NOTE: Implementation detail supporting search page behavior.
032916| src/lib/locations/us-locations.ts:466:     name: "Oakland",
032917| NOTE: Implementation detail supporting search page behavior.
032918| src/lib/locations/us-locations.ts:467:     searchTerms: ["oakland", "oakland ca", "oakland california"],
032919| NOTE: Implementation detail supporting search page behavior.
032920| src/lib/locations/us-locations.ts:468:     displayName: "Oakland, CA",
032921| NOTE: Implementation detail supporting search page behavior.
032922| src/lib/locations/us-locations.ts:469:     type: "city",
032923| NOTE: Implementation detail supporting search page behavior.
032924| src/lib/locations/us-locations.ts:470:     center: [-122.2711, 37.8044],
032925| NOTE: Implementation detail supporting search page behavior.
032926| src/lib/locations/us-locations.ts:471:     bbox: [-122.3551, 37.6323, -122.1144, 37.8855],
032927| NOTE: Implementation detail supporting search page behavior.
032928| src/lib/locations/us-locations.ts:472:     population: 433031,
032929| NOTE: Implementation detail supporting search page behavior.
032930| src/lib/locations/us-locations.ts:473:     state: "CA",
032931| NOTE: Implementation detail supporting search page behavior.
032932| src/lib/locations/us-locations.ts:474:   },
032933| NOTE: Implementation detail supporting search page behavior.
032934| src/lib/locations/us-locations.ts:475:   {
032935| NOTE: Implementation detail supporting search page behavior.
032936| src/lib/locations/us-locations.ts:476:     id: "minneapolis",
032937| NOTE: Implementation detail supporting search page behavior.
032938| src/lib/locations/us-locations.ts:477:     name: "Minneapolis",
032939| NOTE: Implementation detail supporting search page behavior.
032940| src/lib/locations/us-locations.ts:478:     searchTerms: ["minneapolis", "minneapolis mn", "mpls", "twin cities"],
032941| NOTE: Implementation detail supporting search page behavior.
032942| src/lib/locations/us-locations.ts:479:     displayName: "Minneapolis, MN",
032943| NOTE: Implementation detail supporting search page behavior.
032944| src/lib/locations/us-locations.ts:480:     type: "city",
032945| NOTE: Implementation detail supporting search page behavior.
032946| src/lib/locations/us-locations.ts:481:     center: [-93.265, 44.9778],
032947| NOTE: Implementation detail supporting search page behavior.
032948| src/lib/locations/us-locations.ts:482:     bbox: [-93.3291, 44.8902, -93.1937, 45.0512],
032949| NOTE: Implementation detail supporting search page behavior.
032950| src/lib/locations/us-locations.ts:483:     population: 429954,
032951| NOTE: Implementation detail supporting search page behavior.
032952| src/lib/locations/us-locations.ts:484:     state: "MN",
032953| NOTE: Implementation detail supporting search page behavior.
032954| src/lib/locations/us-locations.ts:485:   },
032955| NOTE: Implementation detail supporting search page behavior.
032956| src/lib/locations/us-locations.ts:486:   {
032957| NOTE: Implementation detail supporting search page behavior.
032958| src/lib/locations/us-locations.ts:487:     id: "raleigh",
032959| NOTE: Implementation detail supporting search page behavior.
032960| src/lib/locations/us-locations.ts:488:     name: "Raleigh",
032961| NOTE: Implementation detail supporting search page behavior.
032962| src/lib/locations/us-locations.ts:489:     searchTerms: [
032963| NOTE: Implementation detail supporting search page behavior.
032964| src/lib/locations/us-locations.ts:490:       "raleigh",
032965| NOTE: Implementation detail supporting search page behavior.
032966| src/lib/locations/us-locations.ts:491:       "raleigh nc",
032967| NOTE: Implementation detail supporting search page behavior.
032968| src/lib/locations/us-locations.ts:492:       "raleigh durham",
032969| NOTE: Implementation detail supporting search page behavior.
032970| src/lib/locations/us-locations.ts:493:       "research triangle",
032971| NOTE: Implementation detail supporting search page behavior.
032972| src/lib/locations/us-locations.ts:494:     ],
032973| NOTE: Implementation detail supporting search page behavior.
032974| src/lib/locations/us-locations.ts:495:     displayName: "Raleigh, NC",
032975| NOTE: Implementation detail supporting search page behavior.
032976| src/lib/locations/us-locations.ts:496:     type: "city",
032977| NOTE: Implementation detail supporting search page behavior.
032978| src/lib/locations/us-locations.ts:497:     center: [-78.6382, 35.7796],
032979| NOTE: Implementation detail supporting search page behavior.
032980| src/lib/locations/us-locations.ts:498:     bbox: [-78.8192, 35.6595, -78.4653, 35.9728],
032981| NOTE: Implementation detail supporting search page behavior.
032982| src/lib/locations/us-locations.ts:499:     population: 474069,
032983| NOTE: Implementation detail supporting search page behavior.
032984| src/lib/locations/us-locations.ts:500:     state: "NC",
032985| NOTE: Implementation detail supporting search page behavior.
032986| src/lib/locations/us-locations.ts:501:   },
032987| NOTE: Implementation detail supporting search page behavior.
032988| src/lib/locations/us-locations.ts:502:   {
032989| NOTE: Implementation detail supporting search page behavior.
032990| src/lib/locations/us-locations.ts:503:     id: "tampa",
032991| NOTE: Implementation detail supporting search page behavior.
032992| src/lib/locations/us-locations.ts:504:     name: "Tampa",
032993| NOTE: Implementation detail supporting search page behavior.
032994| src/lib/locations/us-locations.ts:505:     searchTerms: ["tampa", "tampa fl", "tampa bay", "tampa florida"],
032995| NOTE: Implementation detail supporting search page behavior.
032996| src/lib/locations/us-locations.ts:506:     displayName: "Tampa, FL",
032997| NOTE: Implementation detail supporting search page behavior.
032998| src/lib/locations/us-locations.ts:507:     type: "city",
032999| NOTE: Implementation detail supporting search page behavior.
033000| src/lib/locations/us-locations.ts:508:     center: [-82.4572, 27.9506],
033001| NOTE: Implementation detail supporting search page behavior.
033002| src/lib/locations/us-locations.ts:509:     bbox: [-82.56, 27.8218, -82.2571, 28.1712],
033003| NOTE: Implementation detail supporting search page behavior.
033004| src/lib/locations/us-locations.ts:510:     population: 399700,
033005| NOTE: Implementation detail supporting search page behavior.
033006| src/lib/locations/us-locations.ts:511:     state: "FL",
033007| NOTE: Implementation detail supporting search page behavior.
033008| src/lib/locations/us-locations.ts:512:   },
033009| NOTE: Implementation detail supporting search page behavior.
033010| src/lib/locations/us-locations.ts:513:   {
033011| NOTE: Implementation detail supporting search page behavior.
033012| src/lib/locations/us-locations.ts:514:     id: "orlando",
033013| NOTE: Implementation detail supporting search page behavior.
033014| src/lib/locations/us-locations.ts:515:     name: "Orlando",
033015| NOTE: Implementation detail supporting search page behavior.
033016| src/lib/locations/us-locations.ts:516:     searchTerms: ["orlando", "orlando fl", "orlando florida"],
033017| NOTE: Implementation detail supporting search page behavior.
033018| src/lib/locations/us-locations.ts:517:     displayName: "Orlando, FL",
033019| NOTE: Implementation detail supporting search page behavior.
033020| src/lib/locations/us-locations.ts:518:     type: "city",
033021| NOTE: Implementation detail supporting search page behavior.
033022| src/lib/locations/us-locations.ts:519:     center: [-81.3792, 28.5383],
033023| NOTE: Implementation detail supporting search page behavior.
033024| src/lib/locations/us-locations.ts:520:     bbox: [-81.5075, 28.3522, -81.225, 28.6153],
033025| NOTE: Implementation detail supporting search page behavior.
033026| src/lib/locations/us-locations.ts:521:     population: 307573,
033027| NOTE: Implementation detail supporting search page behavior.
033028| src/lib/locations/us-locations.ts:522:     state: "FL",
033029| NOTE: Implementation detail supporting search page behavior.
033030| src/lib/locations/us-locations.ts:523:   },
033031| NOTE: Implementation detail supporting search page behavior.
033032| src/lib/locations/us-locations.ts:524:   {
033033| NOTE: Implementation detail supporting search page behavior.
033034| src/lib/locations/us-locations.ts:525:     id: "las-vegas",
033035| NOTE: Implementation detail supporting search page behavior.
033036| src/lib/locations/us-locations.ts:526:     name: "Las Vegas",
033037| NOTE: Implementation detail supporting search page behavior.
033038| src/lib/locations/us-locations.ts:527:     searchTerms: ["las vegas", "vegas", "las vegas nv", "sin city"],
033039| NOTE: Implementation detail supporting search page behavior.
033040| src/lib/locations/us-locations.ts:528:     displayName: "Las Vegas, NV",
033041| NOTE: Implementation detail supporting search page behavior.
033042| src/lib/locations/us-locations.ts:529:     type: "city",
033043| NOTE: Implementation detail supporting search page behavior.
033044| src/lib/locations/us-locations.ts:530:     center: [-115.1398, 36.1699],
033045| NOTE: Implementation detail supporting search page behavior.
033046| src/lib/locations/us-locations.ts:531:     bbox: [-115.3844, 36.0019, -115.0627, 36.3854],
033047| NOTE: Implementation detail supporting search page behavior.
033048| src/lib/locations/us-locations.ts:532:     population: 651319,
033049| NOTE: Implementation detail supporting search page behavior.
033050| src/lib/locations/us-locations.ts:533:     state: "NV",
033051| NOTE: Implementation detail supporting search page behavior.
033052| src/lib/locations/us-locations.ts:534:   },
033053| NOTE: Implementation detail supporting search page behavior.
033054| src/lib/locations/us-locations.ts:535:   {
033055| NOTE: Implementation detail supporting search page behavior.
033056| src/lib/locations/us-locations.ts:536:     id: "salt-lake-city",
033057| NOTE: Implementation detail supporting search page behavior.
033058| src/lib/locations/us-locations.ts:537:     name: "Salt Lake City",
033059| NOTE: Implementation detail supporting search page behavior.
033060| src/lib/locations/us-locations.ts:538:     searchTerms: ["salt lake city", "slc", "salt lake", "salt lake city ut"],
033061| NOTE: Implementation detail supporting search page behavior.
033062| src/lib/locations/us-locations.ts:539:     displayName: "Salt Lake City, UT",
033063| NOTE: Implementation detail supporting search page behavior.
033064| src/lib/locations/us-locations.ts:540:     type: "city",
033065| NOTE: Implementation detail supporting search page behavior.
033066| src/lib/locations/us-locations.ts:541:     center: [-111.891, 40.7608],
033067| NOTE: Implementation detail supporting search page behavior.
033068| src/lib/locations/us-locations.ts:542:     bbox: [-112.1019, 40.6997, -111.7397, 40.8523],
033069| NOTE: Implementation detail supporting search page behavior.
033070| src/lib/locations/us-locations.ts:543:     population: 200478,
033071| NOTE: Implementation detail supporting search page behavior.
033072| src/lib/locations/us-locations.ts:544:     state: "UT",
033073| NOTE: Implementation detail supporting search page behavior.
033074| src/lib/locations/us-locations.ts:545:   },
033075| NOTE: Implementation detail supporting search page behavior.
033076| src/lib/locations/us-locations.ts:546:   {
033077| NOTE: Implementation detail supporting search page behavior.
033078| src/lib/locations/us-locations.ts:547:     id: "pittsburgh",
033079| NOTE: Implementation detail supporting search page behavior.
033080| src/lib/locations/us-locations.ts:548:     name: "Pittsburgh",
033081| NOTE: Implementation detail supporting search page behavior.
033082| src/lib/locations/us-locations.ts:549:     searchTerms: ["pittsburgh", "pittsburgh pa", "pgh", "steel city"],
033083| NOTE: Implementation detail supporting search page behavior.
033084| src/lib/locations/us-locations.ts:550:     displayName: "Pittsburgh, PA",
033085| NOTE: Implementation detail supporting search page behavior.
033086| src/lib/locations/us-locations.ts:551:     type: "city",
033087| NOTE: Implementation detail supporting search page behavior.
033088| src/lib/locations/us-locations.ts:552:     center: [-79.9959, 40.4406],
033089| NOTE: Implementation detail supporting search page behavior.
033090| src/lib/locations/us-locations.ts:553:     bbox: [-80.0953, 40.3616, -79.8654, 40.5012],
033091| NOTE: Implementation detail supporting search page behavior.
033092| src/lib/locations/us-locations.ts:554:     population: 302971,
033093| NOTE: Implementation detail supporting search page behavior.
033094| src/lib/locations/us-locations.ts:555:     state: "PA",
033095| NOTE: Implementation detail supporting search page behavior.
033096| src/lib/locations/us-locations.ts:556:   },
033097| NOTE: Implementation detail supporting search page behavior.
033098| src/lib/locations/us-locations.ts:557:   {
033099| NOTE: Implementation detail supporting search page behavior.
033100| src/lib/locations/us-locations.ts:558:     id: "cincinnati",
033101| NOTE: Implementation detail supporting search page behavior.
033102| src/lib/locations/us-locations.ts:559:     name: "Cincinnati",
033103| NOTE: Implementation detail supporting search page behavior.
033104| src/lib/locations/us-locations.ts:560:     searchTerms: ["cincinnati", "cincinnati oh", "cincy"],
033105| NOTE: Implementation detail supporting search page behavior.
033106| src/lib/locations/us-locations.ts:561:     displayName: "Cincinnati, OH",
033107| NOTE: Implementation detail supporting search page behavior.
033108| src/lib/locations/us-locations.ts:562:     type: "city",
033109| NOTE: Implementation detail supporting search page behavior.
033110| src/lib/locations/us-locations.ts:563:     center: [-84.512, 39.1031],
033111| NOTE: Implementation detail supporting search page behavior.
033112| src/lib/locations/us-locations.ts:564:     bbox: [-84.7103, 39.0518, -84.3619, 39.2139],
033113| NOTE: Implementation detail supporting search page behavior.
033114| src/lib/locations/us-locations.ts:565:     population: 309317,
033115| NOTE: Implementation detail supporting search page behavior.
033116| src/lib/locations/us-locations.ts:566:     state: "OH",
033117| NOTE: Implementation detail supporting search page behavior.
033118| src/lib/locations/us-locations.ts:567:   },
033119| NOTE: Implementation detail supporting search page behavior.
033120| src/lib/locations/us-locations.ts:568:   {
033121| NOTE: Implementation detail supporting search page behavior.
033122| src/lib/locations/us-locations.ts:569:     id: "st-louis",
033123| NOTE: Implementation detail supporting search page behavior.
033124| src/lib/locations/us-locations.ts:570:     name: "St. Louis",
033125| NOTE: Implementation detail supporting search page behavior.
033126| src/lib/locations/us-locations.ts:571:     searchTerms: ["st louis", "saint louis", "st. louis mo", "stl"],
033127| NOTE: Implementation detail supporting search page behavior.
033128| src/lib/locations/us-locations.ts:572:     displayName: "St. Louis, MO",
033129| NOTE: Implementation detail supporting search page behavior.
033130| src/lib/locations/us-locations.ts:573:     type: "city",
033131| NOTE: Implementation detail supporting search page behavior.
033132| src/lib/locations/us-locations.ts:574:     center: [-90.1994, 38.627],
033133| NOTE: Implementation detail supporting search page behavior.
033134| src/lib/locations/us-locations.ts:575:     bbox: [-90.3207, 38.5326, -90.1664, 38.7742],
033135| NOTE: Implementation detail supporting search page behavior.
033136| src/lib/locations/us-locations.ts:576:     population: 301578,
033137| NOTE: Implementation detail supporting search page behavior.
033138| src/lib/locations/us-locations.ts:577:     state: "MO",
033139| NOTE: Implementation detail supporting search page behavior.
033140| src/lib/locations/us-locations.ts:578:   },
033141| NOTE: Implementation detail supporting search page behavior.
033142| src/lib/locations/us-locations.ts:579:   {
033143| NOTE: Implementation detail supporting search page behavior.
033144| src/lib/locations/us-locations.ts:580:     id: "new-orleans",
033145| NOTE: Implementation detail supporting search page behavior.
033146| src/lib/locations/us-locations.ts:581:     name: "New Orleans",
033147| NOTE: Implementation detail supporting search page behavior.
033148| src/lib/locations/us-locations.ts:582:     searchTerms: ["new orleans", "nola", "new orleans la"],
033149| NOTE: Implementation detail supporting search page behavior.
033150| src/lib/locations/us-locations.ts:583:     displayName: "New Orleans, LA",
033151| NOTE: Implementation detail supporting search page behavior.
033152| src/lib/locations/us-locations.ts:584:     type: "city",
033153| NOTE: Implementation detail supporting search page behavior.
033154| src/lib/locations/us-locations.ts:585:     center: [-90.0715, 29.9511],
033155| NOTE: Implementation detail supporting search page behavior.
033156| src/lib/locations/us-locations.ts:586:     bbox: [-90.1403, 29.8658, -89.8656, 30.0592],
033157| NOTE: Implementation detail supporting search page behavior.
033158| src/lib/locations/us-locations.ts:587:     population: 383997,
033159| NOTE: Implementation detail supporting search page behavior.
033160| src/lib/locations/us-locations.ts:588:     state: "LA",
033161| NOTE: Implementation detail supporting search page behavior.
033162| src/lib/locations/us-locations.ts:589:   },
033163| NOTE: Implementation detail supporting search page behavior.
033164| src/lib/locations/us-locations.ts:590: 
033165| NOTE: Blank line for visual separation.
033166| src/lib/locations/us-locations.ts:591:   // Major college towns
033167| NOTE: Line comment documents intent or constraints.
033168| src/lib/locations/us-locations.ts:592:   {
033169| NOTE: Implementation detail supporting search page behavior.
033170| src/lib/locations/us-locations.ts:593:     id: "ann-arbor",
033171| NOTE: Implementation detail supporting search page behavior.
033172| src/lib/locations/us-locations.ts:594:     name: "Ann Arbor",
033173| NOTE: Implementation detail supporting search page behavior.
033174| src/lib/locations/us-locations.ts:595:     searchTerms: [
033175| NOTE: Implementation detail supporting search page behavior.
033176| src/lib/locations/us-locations.ts:596:       "ann arbor",
033177| NOTE: Implementation detail supporting search page behavior.
033178| src/lib/locations/us-locations.ts:597:       "ann arbor mi",
033179| NOTE: Implementation detail supporting search page behavior.
033180| src/lib/locations/us-locations.ts:598:       "u of m",
033181| NOTE: Implementation detail supporting search page behavior.
033182| src/lib/locations/us-locations.ts:599:       "university of michigan",
033183| NOTE: Implementation detail supporting search page behavior.
033184| src/lib/locations/us-locations.ts:600:     ],
033185| NOTE: Implementation detail supporting search page behavior.
033186| src/lib/locations/us-locations.ts:601:     displayName: "Ann Arbor, MI",
033187| NOTE: Implementation detail supporting search page behavior.
033188| src/lib/locations/us-locations.ts:602:     type: "city",
033189| NOTE: Implementation detail supporting search page behavior.
033190| src/lib/locations/us-locations.ts:603:     center: [-83.743, 42.2808],
033191| NOTE: Implementation detail supporting search page behavior.
033192| src/lib/locations/us-locations.ts:604:     population: 121890,
033193| NOTE: Implementation detail supporting search page behavior.
033194| src/lib/locations/us-locations.ts:605:     state: "MI",
033195| NOTE: Implementation detail supporting search page behavior.
033196| src/lib/locations/us-locations.ts:606:   },
033197| NOTE: Implementation detail supporting search page behavior.
033198| src/lib/locations/us-locations.ts:607:   {
033199| NOTE: Implementation detail supporting search page behavior.
033200| src/lib/locations/us-locations.ts:608:     id: "boulder",
033201| NOTE: Implementation detail supporting search page behavior.
033202| src/lib/locations/us-locations.ts:609:     name: "Boulder",
033203| NOTE: Implementation detail supporting search page behavior.
033204| src/lib/locations/us-locations.ts:610:     searchTerms: ["boulder", "boulder co", "cu boulder"],
033205| NOTE: Implementation detail supporting search page behavior.
033206| src/lib/locations/us-locations.ts:611:     displayName: "Boulder, CO",
033207| NOTE: Implementation detail supporting search page behavior.
033208| src/lib/locations/us-locations.ts:612:     type: "city",
033209| NOTE: Implementation detail supporting search page behavior.
033210| src/lib/locations/us-locations.ts:613:     center: [-105.2705, 40.015],
033211| NOTE: Implementation detail supporting search page behavior.
033212| src/lib/locations/us-locations.ts:614:     population: 105485,
033213| NOTE: Implementation detail supporting search page behavior.
033214| src/lib/locations/us-locations.ts:615:     state: "CO",
033215| NOTE: Implementation detail supporting search page behavior.
033216| src/lib/locations/us-locations.ts:616:   },
033217| NOTE: Implementation detail supporting search page behavior.
033218| src/lib/locations/us-locations.ts:617:   {
033219| NOTE: Implementation detail supporting search page behavior.
033220| src/lib/locations/us-locations.ts:618:     id: "chapel-hill",
033221| NOTE: Implementation detail supporting search page behavior.
033222| src/lib/locations/us-locations.ts:619:     name: "Chapel Hill",
033223| NOTE: Implementation detail supporting search page behavior.
033224| src/lib/locations/us-locations.ts:620:     searchTerms: ["chapel hill", "chapel hill nc", "unc"],
033225| NOTE: Implementation detail supporting search page behavior.
033226| src/lib/locations/us-locations.ts:621:     displayName: "Chapel Hill, NC",
033227| NOTE: Implementation detail supporting search page behavior.
033228| src/lib/locations/us-locations.ts:622:     type: "city",
033229| NOTE: Implementation detail supporting search page behavior.
033230| src/lib/locations/us-locations.ts:623:     center: [-79.0558, 35.9132],
033231| NOTE: Implementation detail supporting search page behavior.
033232| src/lib/locations/us-locations.ts:624:     population: 61960,
033233| NOTE: Implementation detail supporting search page behavior.
033234| src/lib/locations/us-locations.ts:625:     state: "NC",
033235| NOTE: Implementation detail supporting search page behavior.
033236| src/lib/locations/us-locations.ts:626:   },
033237| NOTE: Implementation detail supporting search page behavior.
033238| src/lib/locations/us-locations.ts:627:   {
033239| NOTE: Implementation detail supporting search page behavior.
033240| src/lib/locations/us-locations.ts:628:     id: "berkeley",
033241| NOTE: Implementation detail supporting search page behavior.
033242| src/lib/locations/us-locations.ts:629:     name: "Berkeley",
033243| NOTE: Implementation detail supporting search page behavior.
033244| src/lib/locations/us-locations.ts:630:     searchTerms: ["berkeley", "berkeley ca", "uc berkeley", "cal"],
033245| NOTE: Implementation detail supporting search page behavior.
033246| src/lib/locations/us-locations.ts:631:     displayName: "Berkeley, CA",
033247| NOTE: Implementation detail supporting search page behavior.
033248| src/lib/locations/us-locations.ts:632:     type: "city",
033249| NOTE: Implementation detail supporting search page behavior.
033250| src/lib/locations/us-locations.ts:633:     center: [-122.2727, 37.8716],
033251| NOTE: Implementation detail supporting search page behavior.
033252| src/lib/locations/us-locations.ts:634:     population: 124321,
033253| NOTE: Implementation detail supporting search page behavior.
033254| src/lib/locations/us-locations.ts:635:     state: "CA",
033255| NOTE: Implementation detail supporting search page behavior.
033256| src/lib/locations/us-locations.ts:636:   },
033257| NOTE: Implementation detail supporting search page behavior.
033258| src/lib/locations/us-locations.ts:637:   {
033259| NOTE: Implementation detail supporting search page behavior.
033260| src/lib/locations/us-locations.ts:638:     id: "cambridge",
033261| NOTE: Implementation detail supporting search page behavior.
033262| src/lib/locations/us-locations.ts:639:     name: "Cambridge",
033263| NOTE: Implementation detail supporting search page behavior.
033264| src/lib/locations/us-locations.ts:640:     searchTerms: ["cambridge", "cambridge ma", "harvard", "mit"],
033265| NOTE: Implementation detail supporting search page behavior.
033266| src/lib/locations/us-locations.ts:641:     displayName: "Cambridge, MA",
033267| NOTE: Implementation detail supporting search page behavior.
033268| src/lib/locations/us-locations.ts:642:     type: "city",
033269| NOTE: Implementation detail supporting search page behavior.
033270| src/lib/locations/us-locations.ts:643:     center: [-71.1097, 42.3736],
033271| NOTE: Implementation detail supporting search page behavior.
033272| src/lib/locations/us-locations.ts:644:     population: 118403,
033273| NOTE: Implementation detail supporting search page behavior.
033274| src/lib/locations/us-locations.ts:645:     state: "MA",
033275| NOTE: Implementation detail supporting search page behavior.
033276| src/lib/locations/us-locations.ts:646:   },
033277| NOTE: Implementation detail supporting search page behavior.
033278| src/lib/locations/us-locations.ts:647:   {
033279| NOTE: Implementation detail supporting search page behavior.
033280| src/lib/locations/us-locations.ts:648:     id: "madison",
033281| NOTE: Implementation detail supporting search page behavior.
033282| src/lib/locations/us-locations.ts:649:     name: "Madison",
033283| NOTE: Implementation detail supporting search page behavior.
033284| src/lib/locations/us-locations.ts:650:     searchTerms: ["madison", "madison wi", "uw madison"],
033285| NOTE: Implementation detail supporting search page behavior.
033286| src/lib/locations/us-locations.ts:651:     displayName: "Madison, WI",
033287| NOTE: Implementation detail supporting search page behavior.
033288| src/lib/locations/us-locations.ts:652:     type: "city",
033289| NOTE: Implementation detail supporting search page behavior.
033290| src/lib/locations/us-locations.ts:653:     center: [-89.4012, 43.0731],
033291| NOTE: Implementation detail supporting search page behavior.
033292| src/lib/locations/us-locations.ts:654:     population: 269840,
033293| NOTE: Implementation detail supporting search page behavior.
033294| src/lib/locations/us-locations.ts:655:     state: "WI",
033295| NOTE: Implementation detail supporting search page behavior.
033296| src/lib/locations/us-locations.ts:656:   },
033297| NOTE: Implementation detail supporting search page behavior.
033298| src/lib/locations/us-locations.ts:657:   {
033299| NOTE: Implementation detail supporting search page behavior.
033300| src/lib/locations/us-locations.ts:658:     id: "bloomington-in",
033301| NOTE: Implementation detail supporting search page behavior.
033302| src/lib/locations/us-locations.ts:659:     name: "Bloomington",
033303| NOTE: Implementation detail supporting search page behavior.
033304| src/lib/locations/us-locations.ts:660:     searchTerms: [
033305| NOTE: Implementation detail supporting search page behavior.
033306| src/lib/locations/us-locations.ts:661:       "bloomington in",
033307| NOTE: Implementation detail supporting search page behavior.
033308| src/lib/locations/us-locations.ts:662:       "bloomington indiana",
033309| NOTE: Implementation detail supporting search page behavior.
033310| src/lib/locations/us-locations.ts:663:       "iu",
033311| NOTE: Implementation detail supporting search page behavior.
033312| src/lib/locations/us-locations.ts:664:       "indiana university",
033313| NOTE: Implementation detail supporting search page behavior.
033314| src/lib/locations/us-locations.ts:665:     ],
033315| NOTE: Implementation detail supporting search page behavior.
033316| src/lib/locations/us-locations.ts:666:     displayName: "Bloomington, IN",
033317| NOTE: Implementation detail supporting search page behavior.
033318| src/lib/locations/us-locations.ts:667:     type: "city",
033319| NOTE: Implementation detail supporting search page behavior.
033320| src/lib/locations/us-locations.ts:668:     center: [-86.5264, 39.1653],
033321| NOTE: Implementation detail supporting search page behavior.
033322| src/lib/locations/us-locations.ts:669:     population: 79168,
033323| NOTE: Implementation detail supporting search page behavior.
033324| src/lib/locations/us-locations.ts:670:     state: "IN",
033325| NOTE: Implementation detail supporting search page behavior.
033326| src/lib/locations/us-locations.ts:671:   },
033327| NOTE: Implementation detail supporting search page behavior.
033328| src/lib/locations/us-locations.ts:672:   {
033329| NOTE: Implementation detail supporting search page behavior.
033330| src/lib/locations/us-locations.ts:673:     id: "state-college",
033331| NOTE: Implementation detail supporting search page behavior.
033332| src/lib/locations/us-locations.ts:674:     name: "State College",
033333| NOTE: Implementation detail supporting search page behavior.
033334| src/lib/locations/us-locations.ts:675:     searchTerms: ["state college", "state college pa", "penn state", "psu"],
033335| NOTE: Implementation detail supporting search page behavior.
033336| src/lib/locations/us-locations.ts:676:     displayName: "State College, PA",
033337| NOTE: Implementation detail supporting search page behavior.
033338| src/lib/locations/us-locations.ts:677:     type: "city",
033339| NOTE: Implementation detail supporting search page behavior.
033340| src/lib/locations/us-locations.ts:678:     center: [-77.8599, 40.7934],
033341| NOTE: Implementation detail supporting search page behavior.
033342| src/lib/locations/us-locations.ts:679:     population: 42034,
033343| NOTE: Implementation detail supporting search page behavior.
033344| src/lib/locations/us-locations.ts:680:     state: "PA",
033345| NOTE: Implementation detail supporting search page behavior.
033346| src/lib/locations/us-locations.ts:681:   },
033347| NOTE: Implementation detail supporting search page behavior.
033348| src/lib/locations/us-locations.ts:682:   {
033349| NOTE: Implementation detail supporting search page behavior.
033350| src/lib/locations/us-locations.ts:683:     id: "athens",
033351| NOTE: Implementation detail supporting search page behavior.
033352| src/lib/locations/us-locations.ts:684:     name: "Athens",
033353| NOTE: Implementation detail supporting search page behavior.
033354| src/lib/locations/us-locations.ts:685:     searchTerms: [
033355| NOTE: Implementation detail supporting search page behavior.
033356| src/lib/locations/us-locations.ts:686:       "athens ga",
033357| NOTE: Implementation detail supporting search page behavior.
033358| src/lib/locations/us-locations.ts:687:       "athens georgia",
033359| NOTE: Implementation detail supporting search page behavior.
033360| src/lib/locations/us-locations.ts:688:       "uga",
033361| NOTE: Implementation detail supporting search page behavior.
033362| src/lib/locations/us-locations.ts:689:       "university of georgia",
033363| NOTE: Implementation detail supporting search page behavior.
033364| src/lib/locations/us-locations.ts:690:     ],
033365| NOTE: Implementation detail supporting search page behavior.
033366| src/lib/locations/us-locations.ts:691:     displayName: "Athens, GA",
033367| NOTE: Implementation detail supporting search page behavior.
033368| src/lib/locations/us-locations.ts:692:     type: "city",
033369| NOTE: Implementation detail supporting search page behavior.
033370| src/lib/locations/us-locations.ts:693:     center: [-83.3576, 33.951],
033371| NOTE: Implementation detail supporting search page behavior.
033372| src/lib/locations/us-locations.ts:694:     population: 127315,
033373| NOTE: Implementation detail supporting search page behavior.
033374| src/lib/locations/us-locations.ts:695:     state: "GA",
033375| NOTE: Implementation detail supporting search page behavior.
033376| src/lib/locations/us-locations.ts:696:   },
033377| NOTE: Implementation detail supporting search page behavior.
033378| src/lib/locations/us-locations.ts:697:   {
033379| NOTE: Implementation detail supporting search page behavior.
033380| src/lib/locations/us-locations.ts:698:     id: "eugene",
033381| NOTE: Implementation detail supporting search page behavior.
033382| src/lib/locations/us-locations.ts:699:     name: "Eugene",
033383| NOTE: Implementation detail supporting search page behavior.
033384| src/lib/locations/us-locations.ts:700:     searchTerms: ["eugene", "eugene or", "u of o", "university of oregon"],
033385| NOTE: Implementation detail supporting search page behavior.
033386| src/lib/locations/us-locations.ts:701:     displayName: "Eugene, OR",
033387| NOTE: Implementation detail supporting search page behavior.
033388| src/lib/locations/us-locations.ts:702:     type: "city",
033389| NOTE: Implementation detail supporting search page behavior.
033390| src/lib/locations/us-locations.ts:703:     center: [-123.0868, 44.0521],
033391| NOTE: Implementation detail supporting search page behavior.
033392| src/lib/locations/us-locations.ts:704:     population: 176654,
033393| NOTE: Implementation detail supporting search page behavior.
033394| src/lib/locations/us-locations.ts:705:     state: "OR",
033395| NOTE: Implementation detail supporting search page behavior.
033396| src/lib/locations/us-locations.ts:706:   },
033397| NOTE: Implementation detail supporting search page behavior.
033398| src/lib/locations/us-locations.ts:707:   {
033399| NOTE: Implementation detail supporting search page behavior.
033400| src/lib/locations/us-locations.ts:708:     id: "ithaca",
033401| NOTE: Implementation detail supporting search page behavior.
033402| src/lib/locations/us-locations.ts:709:     name: "Ithaca",
033403| NOTE: Implementation detail supporting search page behavior.
033404| src/lib/locations/us-locations.ts:710:     searchTerms: ["ithaca", "ithaca ny", "cornell"],
033405| NOTE: Implementation detail supporting search page behavior.
033406| src/lib/locations/us-locations.ts:711:     displayName: "Ithaca, NY",
033407| NOTE: Implementation detail supporting search page behavior.
033408| src/lib/locations/us-locations.ts:712:     type: "city",
033409| NOTE: Implementation detail supporting search page behavior.
033410| src/lib/locations/us-locations.ts:713:     center: [-76.4966, 42.4406],
033411| NOTE: Implementation detail supporting search page behavior.
033412| src/lib/locations/us-locations.ts:714:     population: 32027,
033413| NOTE: Implementation detail supporting search page behavior.
033414| src/lib/locations/us-locations.ts:715:     state: "NY",
033415| NOTE: Implementation detail supporting search page behavior.
033416| src/lib/locations/us-locations.ts:716:   },
033417| NOTE: Implementation detail supporting search page behavior.
033418| src/lib/locations/us-locations.ts:717:   {
033419| NOTE: Implementation detail supporting search page behavior.
033420| src/lib/locations/us-locations.ts:718:     id: "gainesville",
033421| NOTE: Implementation detail supporting search page behavior.
033422| src/lib/locations/us-locations.ts:719:     name: "Gainesville",
033423| NOTE: Implementation detail supporting search page behavior.
033424| src/lib/locations/us-locations.ts:720:     searchTerms: [
033425| NOTE: Implementation detail supporting search page behavior.
033426| src/lib/locations/us-locations.ts:721:       "gainesville",
033427| NOTE: Implementation detail supporting search page behavior.
033428| src/lib/locations/us-locations.ts:722:       "gainesville fl",
033429| NOTE: Implementation detail supporting search page behavior.
033430| src/lib/locations/us-locations.ts:723:       "uf",
033431| NOTE: Implementation detail supporting search page behavior.
033432| src/lib/locations/us-locations.ts:724:       "university of florida",
033433| NOTE: Implementation detail supporting search page behavior.
033434| src/lib/locations/us-locations.ts:725:     ],
033435| NOTE: Implementation detail supporting search page behavior.
033436| src/lib/locations/us-locations.ts:726:     displayName: "Gainesville, FL",
033437| NOTE: Implementation detail supporting search page behavior.
033438| src/lib/locations/us-locations.ts:727:     type: "city",
033439| NOTE: Implementation detail supporting search page behavior.
033440| src/lib/locations/us-locations.ts:728:     center: [-82.3248, 29.6516],
033441| NOTE: Implementation detail supporting search page behavior.
033442| src/lib/locations/us-locations.ts:729:     population: 141085,
033443| NOTE: Implementation detail supporting search page behavior.
033444| src/lib/locations/us-locations.ts:730:     state: "FL",
033445| NOTE: Implementation detail supporting search page behavior.
033446| src/lib/locations/us-locations.ts:731:   },
033447| NOTE: Implementation detail supporting search page behavior.
033448| src/lib/locations/us-locations.ts:732:   {
033449| NOTE: Implementation detail supporting search page behavior.
033450| src/lib/locations/us-locations.ts:733:     id: "college-station",
033451| NOTE: Implementation detail supporting search page behavior.
033452| src/lib/locations/us-locations.ts:734:     name: "College Station",
033453| NOTE: Implementation detail supporting search page behavior.
033454| src/lib/locations/us-locations.ts:735:     searchTerms: ["college station", "college station tx", "texas a&m", "tamu"],
033455| NOTE: Implementation detail supporting search page behavior.
033456| src/lib/locations/us-locations.ts:736:     displayName: "College Station, TX",
033457| NOTE: Implementation detail supporting search page behavior.
033458| src/lib/locations/us-locations.ts:737:     type: "city",
033459| NOTE: Implementation detail supporting search page behavior.
033460| src/lib/locations/us-locations.ts:738:     center: [-96.3344, 30.6253],
033461| NOTE: Implementation detail supporting search page behavior.
033462| src/lib/locations/us-locations.ts:739:     population: 120511,
033463| NOTE: Implementation detail supporting search page behavior.
033464| src/lib/locations/us-locations.ts:740:     state: "TX",
033465| NOTE: Implementation detail supporting search page behavior.
033466| src/lib/locations/us-locations.ts:741:   },
033467| NOTE: Implementation detail supporting search page behavior.
033468| src/lib/locations/us-locations.ts:742: 
033469| NOTE: Blank line for visual separation.
033470| src/lib/locations/us-locations.ts:743:   // Major NYC neighborhoods
033471| NOTE: Line comment documents intent or constraints.
033472| src/lib/locations/us-locations.ts:744:   {
033473| NOTE: Implementation detail supporting search page behavior.
033474| src/lib/locations/us-locations.ts:745:     id: "brooklyn",
033475| NOTE: Implementation detail supporting search page behavior.
033476| src/lib/locations/us-locations.ts:746:     name: "Brooklyn",
033477| NOTE: Implementation detail supporting search page behavior.
033478| src/lib/locations/us-locations.ts:747:     searchTerms: ["brooklyn", "brooklyn ny", "bk"],
033479| NOTE: Implementation detail supporting search page behavior.
033480| src/lib/locations/us-locations.ts:748:     displayName: "Brooklyn, NY",
033481| NOTE: Implementation detail supporting search page behavior.
033482| src/lib/locations/us-locations.ts:749:     type: "neighborhood",
033483| NOTE: Implementation detail supporting search page behavior.
033484| src/lib/locations/us-locations.ts:750:     center: [-73.9442, 40.6782],
033485| NOTE: Implementation detail supporting search page behavior.
033486| src/lib/locations/us-locations.ts:751:     population: 2736074,
033487| NOTE: Implementation detail supporting search page behavior.
033488| src/lib/locations/us-locations.ts:752:     state: "NY",
033489| NOTE: Implementation detail supporting search page behavior.
033490| src/lib/locations/us-locations.ts:753:   },
033491| NOTE: Implementation detail supporting search page behavior.
033492| src/lib/locations/us-locations.ts:754:   {
033493| NOTE: Implementation detail supporting search page behavior.
033494| src/lib/locations/us-locations.ts:755:     id: "manhattan",
033495| NOTE: Implementation detail supporting search page behavior.
033496| src/lib/locations/us-locations.ts:756:     name: "Manhattan",
033497| NOTE: Implementation detail supporting search page behavior.
033498| src/lib/locations/us-locations.ts:757:     searchTerms: ["manhattan", "manhattan ny"],
033499| NOTE: Implementation detail supporting search page behavior.
033500| src/lib/locations/us-locations.ts:758:     displayName: "Manhattan, NY",
033501| NOTE: Implementation detail supporting search page behavior.
033502| src/lib/locations/us-locations.ts:759:     type: "neighborhood",
033503| NOTE: Implementation detail supporting search page behavior.
033504| src/lib/locations/us-locations.ts:760:     center: [-73.9712, 40.7831],
033505| NOTE: Implementation detail supporting search page behavior.
033506| src/lib/locations/us-locations.ts:761:     population: 1694251,
033507| NOTE: Implementation detail supporting search page behavior.
033508| src/lib/locations/us-locations.ts:762:     state: "NY",
033509| NOTE: Implementation detail supporting search page behavior.
033510| src/lib/locations/us-locations.ts:763:   },
033511| NOTE: Implementation detail supporting search page behavior.
033512| src/lib/locations/us-locations.ts:764:   {
033513| NOTE: Implementation detail supporting search page behavior.
033514| src/lib/locations/us-locations.ts:765:     id: "queens",
033515| NOTE: Implementation detail supporting search page behavior.
033516| src/lib/locations/us-locations.ts:766:     name: "Queens",
033517| NOTE: Implementation detail supporting search page behavior.
033518| src/lib/locations/us-locations.ts:767:     searchTerms: ["queens", "queens ny"],
033519| NOTE: Implementation detail supporting search page behavior.
033520| src/lib/locations/us-locations.ts:768:     displayName: "Queens, NY",
033521| NOTE: Implementation detail supporting search page behavior.
033522| src/lib/locations/us-locations.ts:769:     type: "neighborhood",
033523| NOTE: Implementation detail supporting search page behavior.
033524| src/lib/locations/us-locations.ts:770:     center: [-73.7949, 40.7282],
033525| NOTE: Implementation detail supporting search page behavior.
033526| src/lib/locations/us-locations.ts:771:     population: 2405464,
033527| NOTE: Implementation detail supporting search page behavior.
033528| src/lib/locations/us-locations.ts:772:     state: "NY",
033529| NOTE: Implementation detail supporting search page behavior.
033530| src/lib/locations/us-locations.ts:773:   },
033531| NOTE: Implementation detail supporting search page behavior.
033532| src/lib/locations/us-locations.ts:774:   {
033533| NOTE: Implementation detail supporting search page behavior.
033534| src/lib/locations/us-locations.ts:775:     id: "bronx",
033535| NOTE: Implementation detail supporting search page behavior.
033536| src/lib/locations/us-locations.ts:776:     name: "The Bronx",
033537| NOTE: Implementation detail supporting search page behavior.
033538| src/lib/locations/us-locations.ts:777:     searchTerms: ["bronx", "the bronx", "bronx ny"],
033539| NOTE: Implementation detail supporting search page behavior.
033540| src/lib/locations/us-locations.ts:778:     displayName: "Bronx, NY",
033541| NOTE: Implementation detail supporting search page behavior.
033542| src/lib/locations/us-locations.ts:779:     type: "neighborhood",
033543| NOTE: Implementation detail supporting search page behavior.
033544| src/lib/locations/us-locations.ts:780:     center: [-73.8648, 40.8448],
033545| NOTE: Implementation detail supporting search page behavior.
033546| src/lib/locations/us-locations.ts:781:     population: 1472654,
033547| NOTE: Implementation detail supporting search page behavior.
033548| src/lib/locations/us-locations.ts:782:     state: "NY",
033549| NOTE: Implementation detail supporting search page behavior.
033550| src/lib/locations/us-locations.ts:783:   },
033551| NOTE: Implementation detail supporting search page behavior.
033552| src/lib/locations/us-locations.ts:784:   {
033553| NOTE: Implementation detail supporting search page behavior.
033554| src/lib/locations/us-locations.ts:785:     id: "williamsburg",
033555| NOTE: Implementation detail supporting search page behavior.
033556| src/lib/locations/us-locations.ts:786:     name: "Williamsburg",
033557| NOTE: Implementation detail supporting search page behavior.
033558| src/lib/locations/us-locations.ts:787:     searchTerms: ["williamsburg", "williamsburg brooklyn"],
033559| NOTE: Implementation detail supporting search page behavior.
033560| src/lib/locations/us-locations.ts:788:     displayName: "Williamsburg, Brooklyn, NY",
033561| NOTE: Implementation detail supporting search page behavior.
033562| src/lib/locations/us-locations.ts:789:     type: "neighborhood",
033563| NOTE: Implementation detail supporting search page behavior.
033564| src/lib/locations/us-locations.ts:790:     center: [-73.9572, 40.7081],
033565| NOTE: Implementation detail supporting search page behavior.
033566| src/lib/locations/us-locations.ts:791:     state: "NY",
033567| NOTE: Implementation detail supporting search page behavior.
033568| src/lib/locations/us-locations.ts:792:   },
033569| NOTE: Implementation detail supporting search page behavior.
033570| src/lib/locations/us-locations.ts:793: 
033571| NOTE: Blank line for visual separation.
033572| src/lib/locations/us-locations.ts:794:   // Major LA neighborhoods
033573| NOTE: Line comment documents intent or constraints.
033574| src/lib/locations/us-locations.ts:795:   {
033575| NOTE: Implementation detail supporting search page behavior.
033576| src/lib/locations/us-locations.ts:796:     id: "hollywood",
033577| NOTE: Implementation detail supporting search page behavior.
033578| src/lib/locations/us-locations.ts:797:     name: "Hollywood",
033579| NOTE: Implementation detail supporting search page behavior.
033580| src/lib/locations/us-locations.ts:798:     searchTerms: ["hollywood", "hollywood ca", "hollywood los angeles"],
033581| NOTE: Implementation detail supporting search page behavior.
033582| src/lib/locations/us-locations.ts:799:     displayName: "Hollywood, Los Angeles, CA",
033583| NOTE: Implementation detail supporting search page behavior.
033584| src/lib/locations/us-locations.ts:800:     type: "neighborhood",
033585| NOTE: Implementation detail supporting search page behavior.
033586| src/lib/locations/us-locations.ts:801:     center: [-118.3287, 34.0928],
033587| NOTE: Implementation detail supporting search page behavior.
033588| src/lib/locations/us-locations.ts:802:     state: "CA",
033589| NOTE: Implementation detail supporting search page behavior.
033590| src/lib/locations/us-locations.ts:803:   },
033591| NOTE: Implementation detail supporting search page behavior.
033592| src/lib/locations/us-locations.ts:804:   {
033593| NOTE: Implementation detail supporting search page behavior.
033594| src/lib/locations/us-locations.ts:805:     id: "santa-monica",
033595| NOTE: Implementation detail supporting search page behavior.
033596| src/lib/locations/us-locations.ts:806:     name: "Santa Monica",
033597| NOTE: Implementation detail supporting search page behavior.
033598| src/lib/locations/us-locations.ts:807:     searchTerms: ["santa monica", "santa monica ca"],
033599| NOTE: Implementation detail supporting search page behavior.
033600| src/lib/locations/us-locations.ts:808:     displayName: "Santa Monica, CA",
033601| NOTE: Implementation detail supporting search page behavior.
033602| src/lib/locations/us-locations.ts:809:     type: "city",
033603| NOTE: Implementation detail supporting search page behavior.
033604| src/lib/locations/us-locations.ts:810:     center: [-118.4912, 34.0195],
033605| NOTE: Implementation detail supporting search page behavior.
033606| src/lib/locations/us-locations.ts:811:     population: 93076,
033607| NOTE: Implementation detail supporting search page behavior.
033608| src/lib/locations/us-locations.ts:812:     state: "CA",
033609| NOTE: Implementation detail supporting search page behavior.
033610| src/lib/locations/us-locations.ts:813:   },
033611| NOTE: Implementation detail supporting search page behavior.
033612| src/lib/locations/us-locations.ts:814:   {
033613| NOTE: Implementation detail supporting search page behavior.
033614| src/lib/locations/us-locations.ts:815:     id: "venice-beach",
033615| NOTE: Implementation detail supporting search page behavior.
033616| src/lib/locations/us-locations.ts:816:     name: "Venice",
033617| NOTE: Implementation detail supporting search page behavior.
033618| src/lib/locations/us-locations.ts:817:     searchTerms: ["venice", "venice beach", "venice ca"],
033619| NOTE: Implementation detail supporting search page behavior.
033620| src/lib/locations/us-locations.ts:818:     displayName: "Venice, Los Angeles, CA",
033621| NOTE: Implementation detail supporting search page behavior.
033622| src/lib/locations/us-locations.ts:819:     type: "neighborhood",
033623| NOTE: Implementation detail supporting search page behavior.
033624| src/lib/locations/us-locations.ts:820:     center: [-118.4695, 33.9875],
033625| NOTE: Implementation detail supporting search page behavior.
033626| src/lib/locations/us-locations.ts:821:     state: "CA",
033627| NOTE: Implementation detail supporting search page behavior.
033628| src/lib/locations/us-locations.ts:822:   },
033629| NOTE: Implementation detail supporting search page behavior.
033630| src/lib/locations/us-locations.ts:823:   {
033631| NOTE: Implementation detail supporting search page behavior.
033632| src/lib/locations/us-locations.ts:824:     id: "pasadena",
033633| NOTE: Implementation detail supporting search page behavior.
033634| src/lib/locations/us-locations.ts:825:     name: "Pasadena",
033635| NOTE: Implementation detail supporting search page behavior.
033636| src/lib/locations/us-locations.ts:826:     searchTerms: ["pasadena", "pasadena ca"],
033637| NOTE: Implementation detail supporting search page behavior.
033638| src/lib/locations/us-locations.ts:827:     displayName: "Pasadena, CA",
033639| NOTE: Implementation detail supporting search page behavior.
033640| src/lib/locations/us-locations.ts:828:     type: "city",
033641| NOTE: Implementation detail supporting search page behavior.
033642| src/lib/locations/us-locations.ts:829:     center: [-118.1445, 34.1478],
033643| NOTE: Implementation detail supporting search page behavior.
033644| src/lib/locations/us-locations.ts:830:     population: 138699,
033645| NOTE: Implementation detail supporting search page behavior.
033646| src/lib/locations/us-locations.ts:831:     state: "CA",
033647| NOTE: Implementation detail supporting search page behavior.
033648| src/lib/locations/us-locations.ts:832:   },
033649| NOTE: Implementation detail supporting search page behavior.
033650| src/lib/locations/us-locations.ts:833:   {
033651| NOTE: Implementation detail supporting search page behavior.
033652| src/lib/locations/us-locations.ts:834:     id: "long-beach",
033653| NOTE: Implementation detail supporting search page behavior.
033654| src/lib/locations/us-locations.ts:835:     name: "Long Beach",
033655| NOTE: Implementation detail supporting search page behavior.
033656| src/lib/locations/us-locations.ts:836:     searchTerms: ["long beach", "long beach ca"],
033657| NOTE: Implementation detail supporting search page behavior.
033658| src/lib/locations/us-locations.ts:837:     displayName: "Long Beach, CA",
033659| NOTE: Implementation detail supporting search page behavior.
033660| src/lib/locations/us-locations.ts:838:     type: "city",
033661| NOTE: Implementation detail supporting search page behavior.
033662| src/lib/locations/us-locations.ts:839:     center: [-118.1937, 33.77],
033663| NOTE: Implementation detail supporting search page behavior.
033664| src/lib/locations/us-locations.ts:840:     population: 466742,
033665| NOTE: Implementation detail supporting search page behavior.
033666| src/lib/locations/us-locations.ts:841:     state: "CA",
033667| NOTE: Implementation detail supporting search page behavior.
033668| src/lib/locations/us-locations.ts:842:   },
033669| NOTE: Implementation detail supporting search page behavior.
033670| src/lib/locations/us-locations.ts:843: 
033671| NOTE: Blank line for visual separation.
033672| src/lib/locations/us-locations.ts:844:   // Major SF Bay Area neighborhoods
033673| NOTE: Line comment documents intent or constraints.
033674| src/lib/locations/us-locations.ts:845:   {
033675| NOTE: Implementation detail supporting search page behavior.
033676| src/lib/locations/us-locations.ts:846:     id: "palo-alto",
033677| NOTE: Implementation detail supporting search page behavior.
033678| src/lib/locations/us-locations.ts:847:     name: "Palo Alto",
033679| NOTE: Implementation detail supporting search page behavior.
033680| src/lib/locations/us-locations.ts:848:     searchTerms: ["palo alto", "palo alto ca", "stanford"],
033681| NOTE: Implementation detail supporting search page behavior.
033682| src/lib/locations/us-locations.ts:849:     displayName: "Palo Alto, CA",
033683| NOTE: Implementation detail supporting search page behavior.
033684| src/lib/locations/us-locations.ts:850:     type: "city",
033685| NOTE: Implementation detail supporting search page behavior.
033686| src/lib/locations/us-locations.ts:851:     center: [-122.143, 37.4419],
033687| NOTE: Implementation detail supporting search page behavior.
033688| src/lib/locations/us-locations.ts:852:     population: 68572,
033689| NOTE: Implementation detail supporting search page behavior.
033690| src/lib/locations/us-locations.ts:853:     state: "CA",
033691| NOTE: Implementation detail supporting search page behavior.
033692| src/lib/locations/us-locations.ts:854:   },
033693| NOTE: Implementation detail supporting search page behavior.
033694| src/lib/locations/us-locations.ts:855:   {
033695| NOTE: Implementation detail supporting search page behavior.
033696| src/lib/locations/us-locations.ts:856:     id: "mountain-view",
033697| NOTE: Implementation detail supporting search page behavior.
033698| src/lib/locations/us-locations.ts:857:     name: "Mountain View",
033699| NOTE: Implementation detail supporting search page behavior.
033700| src/lib/locations/us-locations.ts:858:     searchTerms: ["mountain view", "mountain view ca", "mtv"],
033701| NOTE: Implementation detail supporting search page behavior.
033702| src/lib/locations/us-locations.ts:859:     displayName: "Mountain View, CA",
033703| NOTE: Implementation detail supporting search page behavior.
033704| src/lib/locations/us-locations.ts:860:     type: "city",
033705| NOTE: Implementation detail supporting search page behavior.
033706| src/lib/locations/us-locations.ts:861:     center: [-122.0838, 37.3861],
033707| NOTE: Implementation detail supporting search page behavior.
033708| src/lib/locations/us-locations.ts:862:     population: 82376,
033709| NOTE: Implementation detail supporting search page behavior.
033710| src/lib/locations/us-locations.ts:863:     state: "CA",
033711| NOTE: Implementation detail supporting search page behavior.
033712| src/lib/locations/us-locations.ts:864:   },
033713| NOTE: Implementation detail supporting search page behavior.
033714| src/lib/locations/us-locations.ts:865:   {
033715| NOTE: Implementation detail supporting search page behavior.
033716| src/lib/locations/us-locations.ts:866:     id: "sunnyvale",
033717| NOTE: Implementation detail supporting search page behavior.
033718| src/lib/locations/us-locations.ts:867:     name: "Sunnyvale",
033719| NOTE: Implementation detail supporting search page behavior.
033720| src/lib/locations/us-locations.ts:868:     searchTerms: ["sunnyvale", "sunnyvale ca"],
033721| NOTE: Implementation detail supporting search page behavior.
033722| src/lib/locations/us-locations.ts:869:     displayName: "Sunnyvale, CA",
033723| NOTE: Implementation detail supporting search page behavior.
033724| src/lib/locations/us-locations.ts:870:     type: "city",
033725| NOTE: Implementation detail supporting search page behavior.
033726| src/lib/locations/us-locations.ts:871:     center: [-122.0363, 37.3688],
033727| NOTE: Implementation detail supporting search page behavior.
033728| src/lib/locations/us-locations.ts:872:     population: 155805,
033729| NOTE: Implementation detail supporting search page behavior.
033730| src/lib/locations/us-locations.ts:873:     state: "CA",
033731| NOTE: Implementation detail supporting search page behavior.
033732| src/lib/locations/us-locations.ts:874:   },
033733| NOTE: Implementation detail supporting search page behavior.
033734| src/lib/locations/us-locations.ts:875:   {
033735| NOTE: Implementation detail supporting search page behavior.
033736| src/lib/locations/us-locations.ts:876:     id: "cupertino",
033737| NOTE: Implementation detail supporting search page behavior.
033738| src/lib/locations/us-locations.ts:877:     name: "Cupertino",
033739| NOTE: Implementation detail supporting search page behavior.
033740| src/lib/locations/us-locations.ts:878:     searchTerms: ["cupertino", "cupertino ca", "apple"],
033741| NOTE: Implementation detail supporting search page behavior.
033742| src/lib/locations/us-locations.ts:879:     displayName: "Cupertino, CA",
033743| NOTE: Implementation detail supporting search page behavior.
033744| src/lib/locations/us-locations.ts:880:     type: "city",
033745| NOTE: Implementation detail supporting search page behavior.
033746| src/lib/locations/us-locations.ts:881:     center: [-122.0322, 37.323],
033747| NOTE: Implementation detail supporting search page behavior.
033748| src/lib/locations/us-locations.ts:882:     population: 60170,
033749| NOTE: Implementation detail supporting search page behavior.
033750| src/lib/locations/us-locations.ts:883:     state: "CA",
033751| NOTE: Implementation detail supporting search page behavior.
033752| src/lib/locations/us-locations.ts:884:   },
033753| NOTE: Implementation detail supporting search page behavior.
033754| src/lib/locations/us-locations.ts:885:   {
033755| NOTE: Implementation detail supporting search page behavior.
033756| src/lib/locations/us-locations.ts:886:     id: "fremont",
033757| NOTE: Implementation detail supporting search page behavior.
033758| src/lib/locations/us-locations.ts:887:     name: "Fremont",
033759| NOTE: Implementation detail supporting search page behavior.
033760| src/lib/locations/us-locations.ts:888:     searchTerms: ["fremont", "fremont ca"],
033761| NOTE: Implementation detail supporting search page behavior.
033762| src/lib/locations/us-locations.ts:889:     displayName: "Fremont, CA",
033763| NOTE: Implementation detail supporting search page behavior.
033764| src/lib/locations/us-locations.ts:890:     type: "city",
033765| NOTE: Implementation detail supporting search page behavior.
033766| src/lib/locations/us-locations.ts:891:     center: [-121.9886, 37.5485],
033767| NOTE: Implementation detail supporting search page behavior.
033768| src/lib/locations/us-locations.ts:892:     population: 230504,
033769| NOTE: Implementation detail supporting search page behavior.
033770| src/lib/locations/us-locations.ts:893:     state: "CA",
033771| NOTE: Implementation detail supporting search page behavior.
033772| src/lib/locations/us-locations.ts:894:   },
033773| NOTE: Implementation detail supporting search page behavior.
033774| src/lib/locations/us-locations.ts:895: 
033775| NOTE: Blank line for visual separation.
033776| src/lib/locations/us-locations.ts:896:   // Chicago neighborhoods
033777| NOTE: Line comment documents intent or constraints.
033778| src/lib/locations/us-locations.ts:897:   {
033779| NOTE: Implementation detail supporting search page behavior.
033780| src/lib/locations/us-locations.ts:898:     id: "wicker-park",
033781| NOTE: Implementation detail supporting search page behavior.
033782| src/lib/locations/us-locations.ts:899:     name: "Wicker Park",
033783| NOTE: Implementation detail supporting search page behavior.
033784| src/lib/locations/us-locations.ts:900:     searchTerms: ["wicker park", "wicker park chicago"],
033785| NOTE: Implementation detail supporting search page behavior.
033786| src/lib/locations/us-locations.ts:901:     displayName: "Wicker Park, Chicago, IL",
033787| NOTE: Implementation detail supporting search page behavior.
033788| src/lib/locations/us-locations.ts:902:     type: "neighborhood",
033789| NOTE: Implementation detail supporting search page behavior.
033790| src/lib/locations/us-locations.ts:903:     center: [-87.6775, 41.9088],
033791| NOTE: Implementation detail supporting search page behavior.
033792| src/lib/locations/us-locations.ts:904:     state: "IL",
033793| NOTE: Implementation detail supporting search page behavior.
033794| src/lib/locations/us-locations.ts:905:   },
033795| NOTE: Implementation detail supporting search page behavior.
033796| src/lib/locations/us-locations.ts:906:   {
033797| NOTE: Implementation detail supporting search page behavior.
033798| src/lib/locations/us-locations.ts:907:     id: "lincoln-park-chi",
033799| NOTE: Implementation detail supporting search page behavior.
033800| src/lib/locations/us-locations.ts:908:     name: "Lincoln Park",
033801| NOTE: Implementation detail supporting search page behavior.
033802| src/lib/locations/us-locations.ts:909:     searchTerms: ["lincoln park chicago", "lincoln park"],
033803| NOTE: Implementation detail supporting search page behavior.
033804| src/lib/locations/us-locations.ts:910:     displayName: "Lincoln Park, Chicago, IL",
033805| NOTE: Implementation detail supporting search page behavior.
033806| src/lib/locations/us-locations.ts:911:     type: "neighborhood",
033807| NOTE: Implementation detail supporting search page behavior.
033808| src/lib/locations/us-locations.ts:912:     center: [-87.6468, 41.9214],
033809| NOTE: Implementation detail supporting search page behavior.
033810| src/lib/locations/us-locations.ts:913:     state: "IL",
033811| NOTE: Implementation detail supporting search page behavior.
033812| src/lib/locations/us-locations.ts:914:   },
033813| NOTE: Implementation detail supporting search page behavior.
033814| src/lib/locations/us-locations.ts:915:   {
033815| NOTE: Implementation detail supporting search page behavior.
033816| src/lib/locations/us-locations.ts:916:     id: "logan-square",
033817| NOTE: Implementation detail supporting search page behavior.
033818| src/lib/locations/us-locations.ts:917:     name: "Logan Square",
033819| NOTE: Implementation detail supporting search page behavior.
033820| src/lib/locations/us-locations.ts:918:     searchTerms: ["logan square", "logan square chicago"],
033821| NOTE: Implementation detail supporting search page behavior.
033822| src/lib/locations/us-locations.ts:919:     displayName: "Logan Square, Chicago, IL",
033823| NOTE: Implementation detail supporting search page behavior.
033824| src/lib/locations/us-locations.ts:920:     type: "neighborhood",
033825| NOTE: Implementation detail supporting search page behavior.
033826| src/lib/locations/us-locations.ts:921:     center: [-87.7086, 41.9234],
033827| NOTE: Implementation detail supporting search page behavior.
033828| src/lib/locations/us-locations.ts:922:     state: "IL",
033829| NOTE: Implementation detail supporting search page behavior.
033830| src/lib/locations/us-locations.ts:923:   },
033831| NOTE: Implementation detail supporting search page behavior.
033832| src/lib/locations/us-locations.ts:924: 
033833| NOTE: Blank line for visual separation.
033834| src/lib/locations/us-locations.ts:925:   // Additional major cities
033835| NOTE: Line comment documents intent or constraints.
033836| src/lib/locations/us-locations.ts:926:   {
033837| NOTE: Implementation detail supporting search page behavior.
033838| src/lib/locations/us-locations.ts:927:     id: "san-bernardino",
033839| NOTE: Implementation detail supporting search page behavior.
033840| src/lib/locations/us-locations.ts:928:     name: "San Bernardino",
033841| NOTE: Implementation detail supporting search page behavior.
033842| src/lib/locations/us-locations.ts:929:     searchTerms: ["san bernardino", "san bernardino ca"],
033843| NOTE: Implementation detail supporting search page behavior.
033844| src/lib/locations/us-locations.ts:930:     displayName: "San Bernardino, CA",
033845| NOTE: Implementation detail supporting search page behavior.
033846| src/lib/locations/us-locations.ts:931:     type: "city",
033847| NOTE: Implementation detail supporting search page behavior.
033848| src/lib/locations/us-locations.ts:932:     center: [-117.2898, 34.1083],
033849| NOTE: Implementation detail supporting search page behavior.
033850| src/lib/locations/us-locations.ts:933:     population: 222101,
033851| NOTE: Implementation detail supporting search page behavior.
033852| src/lib/locations/us-locations.ts:934:     state: "CA",
033853| NOTE: Implementation detail supporting search page behavior.
033854| src/lib/locations/us-locations.ts:935:   },
033855| NOTE: Implementation detail supporting search page behavior.
033856| src/lib/locations/us-locations.ts:936:   {
033857| NOTE: Implementation detail supporting search page behavior.
033858| src/lib/locations/us-locations.ts:937:     id: "irvine",
033859| NOTE: Implementation detail supporting search page behavior.
033860| src/lib/locations/us-locations.ts:938:     name: "Irvine",
033861| NOTE: Implementation detail supporting search page behavior.
033862| src/lib/locations/us-locations.ts:939:     searchTerms: ["irvine", "irvine ca", "uci"],
033863| NOTE: Implementation detail supporting search page behavior.
033864| src/lib/locations/us-locations.ts:940:     displayName: "Irvine, CA",
033865| NOTE: Implementation detail supporting search page behavior.
033866| src/lib/locations/us-locations.ts:941:     type: "city",
033867| NOTE: Implementation detail supporting search page behavior.
033868| src/lib/locations/us-locations.ts:942:     center: [-117.8265, 33.6846],
033869| NOTE: Implementation detail supporting search page behavior.
033870| src/lib/locations/us-locations.ts:943:     population: 307670,
033871| NOTE: Implementation detail supporting search page behavior.
033872| src/lib/locations/us-locations.ts:944:     state: "CA",
033873| NOTE: Implementation detail supporting search page behavior.
033874| src/lib/locations/us-locations.ts:945:   },
033875| NOTE: Implementation detail supporting search page behavior.
033876| src/lib/locations/us-locations.ts:946:   {
033877| NOTE: Implementation detail supporting search page behavior.
033878| src/lib/locations/us-locations.ts:947:     id: "honolulu",
033879| NOTE: Implementation detail supporting search page behavior.
033880| src/lib/locations/us-locations.ts:948:     name: "Honolulu",
033881| NOTE: Implementation detail supporting search page behavior.
033882| src/lib/locations/us-locations.ts:949:     searchTerms: ["honolulu", "honolulu hi", "hawaii", "oahu"],
033883| NOTE: Implementation detail supporting search page behavior.
033884| src/lib/locations/us-locations.ts:950:     displayName: "Honolulu, HI",
033885| NOTE: Implementation detail supporting search page behavior.
033886| src/lib/locations/us-locations.ts:951:     type: "city",
033887| NOTE: Implementation detail supporting search page behavior.
033888| src/lib/locations/us-locations.ts:952:     center: [-157.8583, 21.3069],
033889| NOTE: Implementation detail supporting search page behavior.
033890| src/lib/locations/us-locations.ts:953:     population: 350964,
033891| NOTE: Implementation detail supporting search page behavior.
033892| src/lib/locations/us-locations.ts:954:     state: "HI",
033893| NOTE: Implementation detail supporting search page behavior.
033894| src/lib/locations/us-locations.ts:955:   },
033895| NOTE: Implementation detail supporting search page behavior.
033896| src/lib/locations/us-locations.ts:956:   {
033897| NOTE: Implementation detail supporting search page behavior.
033898| src/lib/locations/us-locations.ts:957:     id: "anchorage",
033899| NOTE: Implementation detail supporting search page behavior.
033900| src/lib/locations/us-locations.ts:958:     name: "Anchorage",
033901| NOTE: Implementation detail supporting search page behavior.
033902| src/lib/locations/us-locations.ts:959:     searchTerms: ["anchorage", "anchorage ak", "alaska"],
033903| NOTE: Implementation detail supporting search page behavior.
033904| src/lib/locations/us-locations.ts:960:     displayName: "Anchorage, AK",
033905| NOTE: Implementation detail supporting search page behavior.
033906| src/lib/locations/us-locations.ts:961:     type: "city",
033907| NOTE: Implementation detail supporting search page behavior.
033908| src/lib/locations/us-locations.ts:962:     center: [-149.9003, 61.2181],
033909| NOTE: Implementation detail supporting search page behavior.
033910| src/lib/locations/us-locations.ts:963:     population: 291247,
033911| NOTE: Implementation detail supporting search page behavior.
033912| src/lib/locations/us-locations.ts:964:     state: "AK",
033913| NOTE: Implementation detail supporting search page behavior.
033914| src/lib/locations/us-locations.ts:965:   },
033915| NOTE: Implementation detail supporting search page behavior.
033916| src/lib/locations/us-locations.ts:966:   {
033917| NOTE: Implementation detail supporting search page behavior.
033918| src/lib/locations/us-locations.ts:967:     id: "boise",
033919| NOTE: Implementation detail supporting search page behavior.
033920| src/lib/locations/us-locations.ts:968:     name: "Boise",
033921| NOTE: Implementation detail supporting search page behavior.
033922| src/lib/locations/us-locations.ts:969:     searchTerms: ["boise", "boise id", "boise idaho"],
033923| NOTE: Implementation detail supporting search page behavior.
033924| src/lib/locations/us-locations.ts:970:     displayName: "Boise, ID",
033925| NOTE: Implementation detail supporting search page behavior.
033926| src/lib/locations/us-locations.ts:971:     type: "city",
033927| NOTE: Implementation detail supporting search page behavior.
033928| src/lib/locations/us-locations.ts:972:     center: [-116.2023, 43.615],
033929| NOTE: Implementation detail supporting search page behavior.
033930| src/lib/locations/us-locations.ts:973:     population: 235684,
033931| NOTE: Implementation detail supporting search page behavior.
033932| src/lib/locations/us-locations.ts:974:     state: "ID",
033933| NOTE: Implementation detail supporting search page behavior.
033934| src/lib/locations/us-locations.ts:975:   },
033935| NOTE: Implementation detail supporting search page behavior.
033936| src/lib/locations/us-locations.ts:976:   {
033937| NOTE: Implementation detail supporting search page behavior.
033938| src/lib/locations/us-locations.ts:977:     id: "providence",
033939| NOTE: Implementation detail supporting search page behavior.
033940| src/lib/locations/us-locations.ts:978:     name: "Providence",
033941| NOTE: Implementation detail supporting search page behavior.
033942| src/lib/locations/us-locations.ts:979:     searchTerms: ["providence", "providence ri", "rhode island"],
033943| NOTE: Implementation detail supporting search page behavior.
033944| src/lib/locations/us-locations.ts:980:     displayName: "Providence, RI",
033945| NOTE: Implementation detail supporting search page behavior.
033946| src/lib/locations/us-locations.ts:981:     type: "city",
033947| NOTE: Implementation detail supporting search page behavior.
033948| src/lib/locations/us-locations.ts:982:     center: [-71.4128, 41.824],
033949| NOTE: Implementation detail supporting search page behavior.
033950| src/lib/locations/us-locations.ts:983:     population: 190934,
033951| NOTE: Implementation detail supporting search page behavior.
033952| src/lib/locations/us-locations.ts:984:     state: "RI",
033953| NOTE: Implementation detail supporting search page behavior.
033954| src/lib/locations/us-locations.ts:985:   },
033955| NOTE: Implementation detail supporting search page behavior.
033956| src/lib/locations/us-locations.ts:986:   {
033957| NOTE: Implementation detail supporting search page behavior.
033958| src/lib/locations/us-locations.ts:987:     id: "richmond",
033959| NOTE: Implementation detail supporting search page behavior.
033960| src/lib/locations/us-locations.ts:988:     name: "Richmond",
033961| NOTE: Implementation detail supporting search page behavior.
033962| src/lib/locations/us-locations.ts:989:     searchTerms: ["richmond", "richmond va", "rva"],
033963| NOTE: Implementation detail supporting search page behavior.
033964| src/lib/locations/us-locations.ts:990:     displayName: "Richmond, VA",
033965| NOTE: Implementation detail supporting search page behavior.
033966| src/lib/locations/us-locations.ts:991:     type: "city",
033967| NOTE: Implementation detail supporting search page behavior.
033968| src/lib/locations/us-locations.ts:992:     center: [-77.436, 37.5407],
033969| NOTE: Implementation detail supporting search page behavior.
033970| src/lib/locations/us-locations.ts:993:     population: 226610,
033971| NOTE: Implementation detail supporting search page behavior.
033972| src/lib/locations/us-locations.ts:994:     state: "VA",
033973| NOTE: Implementation detail supporting search page behavior.
033974| src/lib/locations/us-locations.ts:995:   },
033975| NOTE: Implementation detail supporting search page behavior.
033976| src/lib/locations/us-locations.ts:996:   {
033977| NOTE: Implementation detail supporting search page behavior.
033978| src/lib/locations/us-locations.ts:997:     id: "rochester",
033979| NOTE: Implementation detail supporting search page behavior.
033980| src/lib/locations/us-locations.ts:998:     name: "Rochester",
033981| NOTE: Implementation detail supporting search page behavior.
033982| src/lib/locations/us-locations.ts:999:     searchTerms: ["rochester", "rochester ny"],
033983| NOTE: Implementation detail supporting search page behavior.
033984| src/lib/locations/us-locations.ts:1000:     displayName: "Rochester, NY",
033985| NOTE: Implementation detail supporting search page behavior.
033986| src/lib/locations/us-locations.ts:1001:     type: "city",
033987| NOTE: Implementation detail supporting search page behavior.
033988| src/lib/locations/us-locations.ts:1002:     center: [-77.6109, 43.1566],
033989| NOTE: Implementation detail supporting search page behavior.
033990| src/lib/locations/us-locations.ts:1003:     population: 211328,
033991| NOTE: Implementation detail supporting search page behavior.
033992| src/lib/locations/us-locations.ts:1004:     state: "NY",
033993| NOTE: Implementation detail supporting search page behavior.
033994| src/lib/locations/us-locations.ts:1005:   },
033995| NOTE: Implementation detail supporting search page behavior.
033996| src/lib/locations/us-locations.ts:1006:   {
033997| NOTE: Implementation detail supporting search page behavior.
033998| src/lib/locations/us-locations.ts:1007:     id: "buffalo",
033999| NOTE: Implementation detail supporting search page behavior.
034000| src/lib/locations/us-locations.ts:1008:     name: "Buffalo",
034001| NOTE: Implementation detail supporting search page behavior.
034002| src/lib/locations/us-locations.ts:1009:     searchTerms: ["buffalo", "buffalo ny"],
034003| NOTE: Implementation detail supporting search page behavior.
034004| src/lib/locations/us-locations.ts:1010:     displayName: "Buffalo, NY",
034005| NOTE: Implementation detail supporting search page behavior.
034006| src/lib/locations/us-locations.ts:1011:     type: "city",
034007| NOTE: Implementation detail supporting search page behavior.
034008| src/lib/locations/us-locations.ts:1012:     center: [-78.8784, 42.8864],
034009| NOTE: Implementation detail supporting search page behavior.
034010| src/lib/locations/us-locations.ts:1013:     population: 278349,
034011| NOTE: Implementation detail supporting search page behavior.
034012| src/lib/locations/us-locations.ts:1014:     state: "NY",
034013| NOTE: Implementation detail supporting search page behavior.
034014| src/lib/locations/us-locations.ts:1015:   },
034015| NOTE: Implementation detail supporting search page behavior.
034016| src/lib/locations/us-locations.ts:1016:   {
034017| NOTE: Implementation detail supporting search page behavior.
034018| src/lib/locations/us-locations.ts:1017:     id: "hartford",
034019| NOTE: Implementation detail supporting search page behavior.
034020| src/lib/locations/us-locations.ts:1018:     name: "Hartford",
034021| NOTE: Implementation detail supporting search page behavior.
034022| src/lib/locations/us-locations.ts:1019:     searchTerms: ["hartford", "hartford ct"],
034023| NOTE: Implementation detail supporting search page behavior.
034024| src/lib/locations/us-locations.ts:1020:     displayName: "Hartford, CT",
034025| NOTE: Implementation detail supporting search page behavior.
034026| src/lib/locations/us-locations.ts:1021:     type: "city",
034027| NOTE: Implementation detail supporting search page behavior.
034028| src/lib/locations/us-locations.ts:1022:     center: [-72.6851, 41.7658],
034029| NOTE: Implementation detail supporting search page behavior.
034030| src/lib/locations/us-locations.ts:1023:     population: 121054,
034031| NOTE: Implementation detail supporting search page behavior.
034032| src/lib/locations/us-locations.ts:1024:     state: "CT",
034033| NOTE: Implementation detail supporting search page behavior.
034034| src/lib/locations/us-locations.ts:1025:   },
034035| NOTE: Implementation detail supporting search page behavior.
034036| src/lib/locations/us-locations.ts:1026:   {
034037| NOTE: Implementation detail supporting search page behavior.
034038| src/lib/locations/us-locations.ts:1027:     id: "new-haven",
034039| NOTE: Implementation detail supporting search page behavior.
034040| src/lib/locations/us-locations.ts:1028:     name: "New Haven",
034041| NOTE: Implementation detail supporting search page behavior.
034042| src/lib/locations/us-locations.ts:1029:     searchTerms: ["new haven", "new haven ct", "yale"],
034043| NOTE: Implementation detail supporting search page behavior.
034044| src/lib/locations/us-locations.ts:1030:     displayName: "New Haven, CT",
034045| NOTE: Implementation detail supporting search page behavior.
034046| src/lib/locations/us-locations.ts:1031:     type: "city",
034047| NOTE: Implementation detail supporting search page behavior.
034048| src/lib/locations/us-locations.ts:1032:     center: [-72.9279, 41.3083],
034049| NOTE: Implementation detail supporting search page behavior.
034050| src/lib/locations/us-locations.ts:1033:     population: 134023,
034051| NOTE: Implementation detail supporting search page behavior.
034052| src/lib/locations/us-locations.ts:1034:     state: "CT",
034053| NOTE: Implementation detail supporting search page behavior.
034054| src/lib/locations/us-locations.ts:1035:   },
034055| NOTE: Implementation detail supporting search page behavior.
034056| src/lib/locations/us-locations.ts:1036: 
034057| NOTE: Blank line for visual separation.
034058| src/lib/locations/us-locations.ts:1037:   // US States (as regions)
034059| NOTE: Line comment documents intent or constraints.
034060| src/lib/locations/us-locations.ts:1038:   {
034061| NOTE: Implementation detail supporting search page behavior.
034062| src/lib/locations/us-locations.ts:1039:     id: "california",
034063| NOTE: Implementation detail supporting search page behavior.
034064| src/lib/locations/us-locations.ts:1040:     name: "California",
034065| NOTE: Implementation detail supporting search page behavior.
034066| src/lib/locations/us-locations.ts:1041:     searchTerms: ["california", "ca", "cali"],
034067| NOTE: Implementation detail supporting search page behavior.
034068| src/lib/locations/us-locations.ts:1042:     displayName: "California",
034069| NOTE: Implementation detail supporting search page behavior.
034070| src/lib/locations/us-locations.ts:1043:     type: "state",
034071| NOTE: Implementation detail supporting search page behavior.
034072| src/lib/locations/us-locations.ts:1044:     center: [-119.4179, 36.7783],
034073| NOTE: Implementation detail supporting search page behavior.
034074| src/lib/locations/us-locations.ts:1045:     bbox: [-124.4096, 32.5343, -114.1312, 42.0095],
034075| NOTE: Implementation detail supporting search page behavior.
034076| src/lib/locations/us-locations.ts:1046:     state: "CA",
034077| NOTE: Implementation detail supporting search page behavior.
034078| src/lib/locations/us-locations.ts:1047:   },
034079| NOTE: Implementation detail supporting search page behavior.
034080| src/lib/locations/us-locations.ts:1048:   {
034081| NOTE: Implementation detail supporting search page behavior.
034082| src/lib/locations/us-locations.ts:1049:     id: "texas",
034083| NOTE: Implementation detail supporting search page behavior.
034084| src/lib/locations/us-locations.ts:1050:     name: "Texas",
034085| NOTE: Implementation detail supporting search page behavior.
034086| src/lib/locations/us-locations.ts:1051:     searchTerms: ["texas", "tx"],
034087| NOTE: Implementation detail supporting search page behavior.
034088| src/lib/locations/us-locations.ts:1052:     displayName: "Texas",
034089| NOTE: Implementation detail supporting search page behavior.
034090| src/lib/locations/us-locations.ts:1053:     type: "state",
034091| NOTE: Implementation detail supporting search page behavior.
034092| src/lib/locations/us-locations.ts:1054:     center: [-99.9018, 31.9686],
034093| NOTE: Implementation detail supporting search page behavior.
034094| src/lib/locations/us-locations.ts:1055:     bbox: [-106.6456, 25.8371, -93.5083, 36.5007],
034095| NOTE: Implementation detail supporting search page behavior.
034096| src/lib/locations/us-locations.ts:1056:     state: "TX",
034097| NOTE: Implementation detail supporting search page behavior.
034098| src/lib/locations/us-locations.ts:1057:   },
034099| NOTE: Implementation detail supporting search page behavior.
034100| src/lib/locations/us-locations.ts:1058:   {
034101| NOTE: Implementation detail supporting search page behavior.
034102| src/lib/locations/us-locations.ts:1059:     id: "florida",
034103| NOTE: Implementation detail supporting search page behavior.
034104| src/lib/locations/us-locations.ts:1060:     name: "Florida",
034105| NOTE: Implementation detail supporting search page behavior.
034106| src/lib/locations/us-locations.ts:1061:     searchTerms: ["florida", "fl"],
034107| NOTE: Implementation detail supporting search page behavior.
034108| src/lib/locations/us-locations.ts:1062:     displayName: "Florida",
034109| NOTE: Implementation detail supporting search page behavior.
034110| src/lib/locations/us-locations.ts:1063:     type: "state",
034111| NOTE: Implementation detail supporting search page behavior.
034112| src/lib/locations/us-locations.ts:1064:     center: [-81.5158, 27.6648],
034113| NOTE: Implementation detail supporting search page behavior.
034114| src/lib/locations/us-locations.ts:1065:     bbox: [-87.6349, 24.3963, -79.9743, 31.0009],
034115| NOTE: Implementation detail supporting search page behavior.
034116| src/lib/locations/us-locations.ts:1066:     state: "FL",
034117| NOTE: Implementation detail supporting search page behavior.
034118| src/lib/locations/us-locations.ts:1067:   },
034119| NOTE: Implementation detail supporting search page behavior.
034120| src/lib/locations/us-locations.ts:1068:   {
034121| NOTE: Implementation detail supporting search page behavior.
034122| src/lib/locations/us-locations.ts:1069:     id: "new-york-state",
034123| NOTE: Implementation detail supporting search page behavior.
034124| src/lib/locations/us-locations.ts:1070:     name: "New York",
034125| NOTE: Implementation detail supporting search page behavior.
034126| src/lib/locations/us-locations.ts:1071:     searchTerms: ["new york state", "ny state"],
034127| NOTE: Implementation detail supporting search page behavior.
034128| src/lib/locations/us-locations.ts:1072:     displayName: "New York",
034129| NOTE: Implementation detail supporting search page behavior.
034130| src/lib/locations/us-locations.ts:1073:     type: "state",
034131| NOTE: Implementation detail supporting search page behavior.
034132| src/lib/locations/us-locations.ts:1074:     center: [-75.4999, 43.0004],
034133| NOTE: Implementation detail supporting search page behavior.
034134| src/lib/locations/us-locations.ts:1075:     bbox: [-79.7624, 40.4961, -71.8562, 45.0159],
034135| NOTE: Implementation detail supporting search page behavior.
034136| src/lib/locations/us-locations.ts:1076:     state: "NY",
034137| NOTE: Implementation detail supporting search page behavior.
034138| src/lib/locations/us-locations.ts:1077:   },
034139| NOTE: Implementation detail supporting search page behavior.
034140| src/lib/locations/us-locations.ts:1078:   {
034141| NOTE: Implementation detail supporting search page behavior.
034142| src/lib/locations/us-locations.ts:1079:     id: "illinois",
034143| NOTE: Implementation detail supporting search page behavior.
034144| src/lib/locations/us-locations.ts:1080:     name: "Illinois",
034145| NOTE: Implementation detail supporting search page behavior.
034146| src/lib/locations/us-locations.ts:1081:     searchTerms: ["illinois", "il"],
034147| NOTE: Implementation detail supporting search page behavior.
034148| src/lib/locations/us-locations.ts:1082:     displayName: "Illinois",
034149| NOTE: Implementation detail supporting search page behavior.
034150| src/lib/locations/us-locations.ts:1083:     type: "state",
034151| NOTE: Implementation detail supporting search page behavior.
034152| src/lib/locations/us-locations.ts:1084:     center: [-89.3985, 40.6331],
034153| NOTE: Implementation detail supporting search page behavior.
034154| src/lib/locations/us-locations.ts:1085:     bbox: [-91.513, 36.9703, -87.019, 42.5083],
034155| NOTE: Implementation detail supporting search page behavior.
034156| src/lib/locations/us-locations.ts:1086:     state: "IL",
034157| NOTE: Implementation detail supporting search page behavior.
034158| src/lib/locations/us-locations.ts:1087:   },
034159| NOTE: Implementation detail supporting search page behavior.
034160| src/lib/locations/us-locations.ts:1088:   {
034161| NOTE: Implementation detail supporting search page behavior.
034162| src/lib/locations/us-locations.ts:1089:     id: "pennsylvania",
034163| NOTE: Implementation detail supporting search page behavior.
034164| src/lib/locations/us-locations.ts:1090:     name: "Pennsylvania",
034165| NOTE: Implementation detail supporting search page behavior.
034166| src/lib/locations/us-locations.ts:1091:     searchTerms: ["pennsylvania", "pa"],
034167| NOTE: Implementation detail supporting search page behavior.
034168| src/lib/locations/us-locations.ts:1092:     displayName: "Pennsylvania",
034169| NOTE: Implementation detail supporting search page behavior.
034170| src/lib/locations/us-locations.ts:1093:     type: "state",
034171| NOTE: Implementation detail supporting search page behavior.
034172| src/lib/locations/us-locations.ts:1094:     center: [-77.1945, 41.2033],
034173| NOTE: Implementation detail supporting search page behavior.
034174| src/lib/locations/us-locations.ts:1095:     bbox: [-80.5199, 39.7198, -74.6895, 42.2699],
034175| NOTE: Implementation detail supporting search page behavior.
034176| src/lib/locations/us-locations.ts:1096:     state: "PA",
034177| NOTE: Implementation detail supporting search page behavior.
034178| src/lib/locations/us-locations.ts:1097:   },
034179| NOTE: Implementation detail supporting search page behavior.
034180| src/lib/locations/us-locations.ts:1098:   {
034181| NOTE: Implementation detail supporting search page behavior.
034182| src/lib/locations/us-locations.ts:1099:     id: "ohio",
034183| NOTE: Implementation detail supporting search page behavior.
034184| src/lib/locations/us-locations.ts:1100:     name: "Ohio",
034185| NOTE: Implementation detail supporting search page behavior.
034186| src/lib/locations/us-locations.ts:1101:     searchTerms: ["ohio", "oh"],
034187| NOTE: Implementation detail supporting search page behavior.
034188| src/lib/locations/us-locations.ts:1102:     displayName: "Ohio",
034189| NOTE: Implementation detail supporting search page behavior.
034190| src/lib/locations/us-locations.ts:1103:     type: "state",
034191| NOTE: Implementation detail supporting search page behavior.
034192| src/lib/locations/us-locations.ts:1104:     center: [-82.9071, 40.4173],
034193| NOTE: Implementation detail supporting search page behavior.
034194| src/lib/locations/us-locations.ts:1105:     bbox: [-84.8203, 38.4032, -80.519, 42.3271],
034195| NOTE: Implementation detail supporting search page behavior.
034196| src/lib/locations/us-locations.ts:1106:     state: "OH",
034197| NOTE: Implementation detail supporting search page behavior.
034198| src/lib/locations/us-locations.ts:1107:   },
034199| NOTE: Implementation detail supporting search page behavior.
034200| src/lib/locations/us-locations.ts:1108:   {
034201| NOTE: Implementation detail supporting search page behavior.
034202| src/lib/locations/us-locations.ts:1109:     id: "georgia-state",
034203| NOTE: Implementation detail supporting search page behavior.
034204| src/lib/locations/us-locations.ts:1110:     name: "Georgia",
034205| NOTE: Implementation detail supporting search page behavior.
034206| src/lib/locations/us-locations.ts:1111:     searchTerms: ["georgia", "ga"],
034207| NOTE: Implementation detail supporting search page behavior.
034208| src/lib/locations/us-locations.ts:1112:     displayName: "Georgia",
034209| NOTE: Implementation detail supporting search page behavior.
034210| src/lib/locations/us-locations.ts:1113:     type: "state",
034211| NOTE: Implementation detail supporting search page behavior.
034212| src/lib/locations/us-locations.ts:1114:     center: [-83.5005, 32.1656],
034213| NOTE: Implementation detail supporting search page behavior.
034214| src/lib/locations/us-locations.ts:1115:     bbox: [-85.6052, 30.3557, -80.8396, 35.0007],
034215| NOTE: Implementation detail supporting search page behavior.
034216| src/lib/locations/us-locations.ts:1116:     state: "GA",
034217| NOTE: Implementation detail supporting search page behavior.
034218| src/lib/locations/us-locations.ts:1117:   },
034219| NOTE: Implementation detail supporting search page behavior.
034220| src/lib/locations/us-locations.ts:1118:   {
034221| NOTE: Implementation detail supporting search page behavior.
034222| src/lib/locations/us-locations.ts:1119:     id: "north-carolina",
034223| NOTE: Implementation detail supporting search page behavior.
034224| src/lib/locations/us-locations.ts:1120:     name: "North Carolina",
034225| NOTE: Implementation detail supporting search page behavior.
034226| src/lib/locations/us-locations.ts:1121:     searchTerms: ["north carolina", "nc"],
034227| NOTE: Implementation detail supporting search page behavior.
034228| src/lib/locations/us-locations.ts:1122:     displayName: "North Carolina",
034229| NOTE: Implementation detail supporting search page behavior.
034230| src/lib/locations/us-locations.ts:1123:     type: "state",
034231| NOTE: Implementation detail supporting search page behavior.
034232| src/lib/locations/us-locations.ts:1124:     center: [-79.0193, 35.7596],
034233| NOTE: Implementation detail supporting search page behavior.
034234| src/lib/locations/us-locations.ts:1125:     bbox: [-84.3219, 33.8424, -75.4006, 36.5881],
034235| NOTE: Implementation detail supporting search page behavior.
034236| src/lib/locations/us-locations.ts:1126:     state: "NC",
034237| NOTE: Implementation detail supporting search page behavior.
034238| src/lib/locations/us-locations.ts:1127:   },
034239| NOTE: Implementation detail supporting search page behavior.
034240| src/lib/locations/us-locations.ts:1128:   {
034241| NOTE: Implementation detail supporting search page behavior.
034242| src/lib/locations/us-locations.ts:1129:     id: "michigan",
034243| NOTE: Implementation detail supporting search page behavior.
034244| src/lib/locations/us-locations.ts:1130:     name: "Michigan",
034245| NOTE: Implementation detail supporting search page behavior.
034246| src/lib/locations/us-locations.ts:1131:     searchTerms: ["michigan", "mi"],
034247| NOTE: Implementation detail supporting search page behavior.
034248| src/lib/locations/us-locations.ts:1132:     displayName: "Michigan",
034249| NOTE: Implementation detail supporting search page behavior.
034250| src/lib/locations/us-locations.ts:1133:     type: "state",
034251| NOTE: Implementation detail supporting search page behavior.
034252| src/lib/locations/us-locations.ts:1134:     center: [-85.6024, 44.3148],
034253| NOTE: Implementation detail supporting search page behavior.
034254| src/lib/locations/us-locations.ts:1135:     bbox: [-90.4186, 41.6961, -82.122, 48.3062],
034255| NOTE: Implementation detail supporting search page behavior.
034256| src/lib/locations/us-locations.ts:1136:     state: "MI",
034257| NOTE: Implementation detail supporting search page behavior.
034258| src/lib/locations/us-locations.ts:1137:   },
034259| NOTE: Implementation detail supporting search page behavior.
034260| src/lib/locations/us-locations.ts:1138: ];
034261| NOTE: Implementation detail supporting search page behavior.
034262| src/lib/locations/us-locations.ts:1139: 
034263| NOTE: Blank line for visual separation.
034264| src/lib/locations/us-locations.ts:1140: // Pre-built search index for fast prefix lookups
034265| NOTE: Line comment documents intent or constraints.
034266| src/lib/locations/us-locations.ts:1141: const searchIndex: Map<string, LocalLocation[]> = new Map();
034267| NOTE: Local declaration used by search logic or UI.
034268| src/lib/locations/us-locations.ts:1142: 
034269| NOTE: Blank line for visual separation.
034270| src/lib/locations/us-locations.ts:1143: /**
034271| NOTE: Block comment line describing behavior or context.
034272| src/lib/locations/us-locations.ts:1144:  * Build search index for O(1) prefix lookups
034273| NOTE: Block comment line describing behavior or context.
034274| src/lib/locations/us-locations.ts:1145:  */
034275| NOTE: Block comment line describing behavior or context.
034276| src/lib/locations/us-locations.ts:1146: function buildSearchIndex() {
034277| NOTE: Defines a helper or component function.
034278| src/lib/locations/us-locations.ts:1147:   if (searchIndex.size > 0) return; // Already built
034279| NOTE: Conditional logic controlling rendering or flow.
034280| src/lib/locations/us-locations.ts:1148: 
034281| NOTE: Blank line for visual separation.
034282| src/lib/locations/us-locations.ts:1149:   for (const location of US_LOCATIONS) {
034283| NOTE: Implementation detail supporting search page behavior.
034284| src/lib/locations/us-locations.ts:1150:     for (const term of location.searchTerms) {
034285| NOTE: Implementation detail supporting search page behavior.
034286| src/lib/locations/us-locations.ts:1151:       const normalized = term.toLowerCase();
034287| NOTE: Local declaration used by search logic or UI.
034288| src/lib/locations/us-locations.ts:1152:       // Index by first 1, 2, and 3 character prefixes for fast lookup
034289| NOTE: Line comment documents intent or constraints.
034290| src/lib/locations/us-locations.ts:1153:       for (let len = 1; len <= Math.min(normalized.length, 3); len++) {
034291| NOTE: Implementation detail supporting search page behavior.
034292| src/lib/locations/us-locations.ts:1154:         const prefix = normalized.slice(0, len);
034293| NOTE: Local declaration used by search logic or UI.
034294| src/lib/locations/us-locations.ts:1155:         if (!searchIndex.has(prefix)) {
034295| NOTE: Conditional logic controlling rendering or flow.
034296| src/lib/locations/us-locations.ts:1156:           searchIndex.set(prefix, []);
034297| NOTE: Implementation detail supporting search page behavior.
034298| src/lib/locations/us-locations.ts:1157:         }
034299| NOTE: Implementation detail supporting search page behavior.
034300| src/lib/locations/us-locations.ts:1158:         searchIndex.get(prefix)!.push(location);
034301| NOTE: Implementation detail supporting search page behavior.
034302| src/lib/locations/us-locations.ts:1159:       }
034303| NOTE: Implementation detail supporting search page behavior.
034304| src/lib/locations/us-locations.ts:1160:     }
034305| NOTE: Implementation detail supporting search page behavior.
034306| src/lib/locations/us-locations.ts:1161:   }
034307| NOTE: Implementation detail supporting search page behavior.
034308| src/lib/locations/us-locations.ts:1162: }
034309| NOTE: Implementation detail supporting search page behavior.
034310| src/lib/locations/us-locations.ts:1163: 
034311| NOTE: Blank line for visual separation.
034312| src/lib/locations/us-locations.ts:1164: // Build index on module load
034313| NOTE: Line comment documents intent or constraints.
034314| src/lib/locations/us-locations.ts:1165: buildSearchIndex();
034315| NOTE: Implementation detail supporting search page behavior.
034316| src/lib/locations/us-locations.ts:1166: 
034317| NOTE: Blank line for visual separation.
034318| src/lib/locations/us-locations.ts:1167: /**
034319| NOTE: Block comment line describing behavior or context.
034320| src/lib/locations/us-locations.ts:1168:  * Score a location match (higher = better)
034321| NOTE: Block comment line describing behavior or context.
034322| src/lib/locations/us-locations.ts:1169:  */
034323| NOTE: Block comment line describing behavior or context.
034324| src/lib/locations/us-locations.ts:1170: function scoreMatch(
034325| NOTE: Defines a helper or component function.
034326| src/lib/locations/us-locations.ts:1171:   location: LocalLocation,
034327| NOTE: Implementation detail supporting search page behavior.
034328| src/lib/locations/us-locations.ts:1172:   query: string,
034329| NOTE: Implementation detail supporting search page behavior.
034330| src/lib/locations/us-locations.ts:1173:   matchType: "exact" | "prefix" | "contains",
034331| NOTE: Implementation detail supporting search page behavior.
034332| src/lib/locations/us-locations.ts:1174: ): number {
034333| NOTE: Implementation detail supporting search page behavior.
034334| src/lib/locations/us-locations.ts:1175:   let score = 0;
034335| NOTE: Local declaration used by search logic or UI.
034336| src/lib/locations/us-locations.ts:1176: 
034337| NOTE: Blank line for visual separation.
034338| src/lib/locations/us-locations.ts:1177:   // Match type scoring
034339| NOTE: Line comment documents intent or constraints.
034340| src/lib/locations/us-locations.ts:1178:   switch (matchType) {
034341| NOTE: Implementation detail supporting search page behavior.
034342| src/lib/locations/us-locations.ts:1179:     case "exact":
034343| NOTE: Implementation detail supporting search page behavior.
034344| src/lib/locations/us-locations.ts:1180:       score += 100;
034345| NOTE: Implementation detail supporting search page behavior.
034346| src/lib/locations/us-locations.ts:1181:       break;
034347| NOTE: Implementation detail supporting search page behavior.
034348| src/lib/locations/us-locations.ts:1182:     case "prefix":
034349| NOTE: Implementation detail supporting search page behavior.
034350| src/lib/locations/us-locations.ts:1183:       score += 50;
034351| NOTE: Implementation detail supporting search page behavior.
034352| src/lib/locations/us-locations.ts:1184:       break;
034353| NOTE: Implementation detail supporting search page behavior.
034354| src/lib/locations/us-locations.ts:1185:     case "contains":
034355| NOTE: Implementation detail supporting search page behavior.
034356| src/lib/locations/us-locations.ts:1186:       score += 25;
034357| NOTE: Implementation detail supporting search page behavior.
034358| src/lib/locations/us-locations.ts:1187:       break;
034359| NOTE: Implementation detail supporting search page behavior.
034360| src/lib/locations/us-locations.ts:1188:   }
034361| NOTE: Implementation detail supporting search page behavior.
034362| src/lib/locations/us-locations.ts:1189: 
034363| NOTE: Blank line for visual separation.
034364| src/lib/locations/us-locations.ts:1190:   // Population boost (normalized to 0-30 range)
034365| NOTE: Line comment documents intent or constraints.
034366| src/lib/locations/us-locations.ts:1191:   if (location.population) {
034367| NOTE: Conditional logic controlling rendering or flow.
034368| src/lib/locations/us-locations.ts:1192:     score += Math.min(30, Math.log10(location.population) * 3);
034369| NOTE: Implementation detail supporting search page behavior.
034370| src/lib/locations/us-locations.ts:1193:   }
034371| NOTE: Implementation detail supporting search page behavior.
034372| src/lib/locations/us-locations.ts:1194: 
034373| NOTE: Blank line for visual separation.
034374| src/lib/locations/us-locations.ts:1195:   // Type preference (cities preferred for general search)
034375| NOTE: Line comment documents intent or constraints.
034376| src/lib/locations/us-locations.ts:1196:   if (location.type === "city") score += 10;
034377| NOTE: Conditional logic controlling rendering or flow.
034378| src/lib/locations/us-locations.ts:1197:   if (location.type === "neighborhood") score += 5;
034379| NOTE: Conditional logic controlling rendering or flow.
034380| src/lib/locations/us-locations.ts:1198: 
034381| NOTE: Blank line for visual separation.
034382| src/lib/locations/us-locations.ts:1199:   // Query length bonus - longer matches are better
034383| NOTE: Line comment documents intent or constraints.
034384| src/lib/locations/us-locations.ts:1200:   score += Math.min(10, query.length);
034385| NOTE: Implementation detail supporting search page behavior.
034386| src/lib/locations/us-locations.ts:1201: 
034387| NOTE: Blank line for visual separation.
034388| src/lib/locations/us-locations.ts:1202:   return score;
034389| NOTE: Return statement for component or helper output.
034390| src/lib/locations/us-locations.ts:1203: }
034391| NOTE: Implementation detail supporting search page behavior.
034392| src/lib/locations/us-locations.ts:1204: 
034393| NOTE: Blank line for visual separation.
034394| src/lib/locations/us-locations.ts:1205: export interface LocalSearchResult {
034395| NOTE: Implementation detail supporting search page behavior.
034396| src/lib/locations/us-locations.ts:1206:   location: LocalLocation;
034397| NOTE: Implementation detail supporting search page behavior.
034398| src/lib/locations/us-locations.ts:1207:   score: number;
034399| NOTE: Implementation detail supporting search page behavior.
034400| src/lib/locations/us-locations.ts:1208:   matchType: "exact" | "prefix" | "contains";
034401| NOTE: Implementation detail supporting search page behavior.
034402| src/lib/locations/us-locations.ts:1209: }
034403| NOTE: Implementation detail supporting search page behavior.
034404| src/lib/locations/us-locations.ts:1210: 
034405| NOTE: Blank line for visual separation.
034406| src/lib/locations/us-locations.ts:1211: /**
034407| NOTE: Block comment line describing behavior or context.
034408| src/lib/locations/us-locations.ts:1212:  * Search local locations dataset
034409| NOTE: Block comment line describing behavior or context.
034410| src/lib/locations/us-locations.ts:1213:  *
034411| NOTE: Block comment line describing behavior or context.
034412| src/lib/locations/us-locations.ts:1214:  * @param query - Search query
034413| NOTE: Block comment line describing behavior or context.
034414| src/lib/locations/us-locations.ts:1215:  * @param limit - Maximum results to return (default 5)
034415| NOTE: Block comment line describing behavior or context.
034416| src/lib/locations/us-locations.ts:1216:  * @returns Array of matching locations with scores
034417| NOTE: Block comment line describing behavior or context.
034418| src/lib/locations/us-locations.ts:1217:  */
034419| NOTE: Block comment line describing behavior or context.
034420| src/lib/locations/us-locations.ts:1218: export function searchLocalLocations(
034421| NOTE: Exports helper or component function.
034422| src/lib/locations/us-locations.ts:1219:   query: string,
034423| NOTE: Implementation detail supporting search page behavior.
034424| src/lib/locations/us-locations.ts:1220:   limit: number = 5,
034425| NOTE: Implementation detail supporting search page behavior.
034426| src/lib/locations/us-locations.ts:1221: ): LocalSearchResult[] {
034427| NOTE: Implementation detail supporting search page behavior.
034428| src/lib/locations/us-locations.ts:1222:   if (!query || query.length < 2) return [];
034429| NOTE: Conditional logic controlling rendering or flow.
034430| src/lib/locations/us-locations.ts:1223: 
034431| NOTE: Blank line for visual separation.
034432| src/lib/locations/us-locations.ts:1224:   const normalized = query.toLowerCase().trim();
034433| NOTE: Local declaration used by search logic or UI.
034434| src/lib/locations/us-locations.ts:1225:   const results: LocalSearchResult[] = [];
034435| NOTE: Local declaration used by search logic or UI.
034436| src/lib/locations/us-locations.ts:1226:   const seen = new Set<string>();
034437| NOTE: Local declaration used by search logic or UI.
034438| src/lib/locations/us-locations.ts:1227: 
034439| NOTE: Blank line for visual separation.
034440| src/lib/locations/us-locations.ts:1228:   // Get candidate locations from index
034441| NOTE: Line comment documents intent or constraints.
034442| src/lib/locations/us-locations.ts:1229:   const prefix = normalized.slice(0, Math.min(normalized.length, 3));
034443| NOTE: Local declaration used by search logic or UI.
034444| src/lib/locations/us-locations.ts:1230:   const candidates = searchIndex.get(prefix) || [];
034445| NOTE: Local declaration used by search logic or UI.
034446| src/lib/locations/us-locations.ts:1231: 
034447| NOTE: Blank line for visual separation.
034448| src/lib/locations/us-locations.ts:1232:   // Also search all locations for contains matches if needed
034449| NOTE: Line comment documents intent or constraints.
034450| src/lib/locations/us-locations.ts:1233:   const allCandidates = candidates.length >= limit ? candidates : US_LOCATIONS;
034451| NOTE: Local declaration used by search logic or UI.
034452| src/lib/locations/us-locations.ts:1234: 
034453| NOTE: Blank line for visual separation.
034454| src/lib/locations/us-locations.ts:1235:   for (const location of allCandidates) {
034455| NOTE: Implementation detail supporting search page behavior.
034456| src/lib/locations/us-locations.ts:1236:     if (seen.has(location.id)) continue;
034457| NOTE: Conditional logic controlling rendering or flow.
034458| src/lib/locations/us-locations.ts:1237: 
034459| NOTE: Blank line for visual separation.
034460| src/lib/locations/us-locations.ts:1238:     for (const term of location.searchTerms) {
034461| NOTE: Implementation detail supporting search page behavior.
034462| src/lib/locations/us-locations.ts:1239:       const termLower = term.toLowerCase();
034463| NOTE: Local declaration used by search logic or UI.
034464| src/lib/locations/us-locations.ts:1240: 
034465| NOTE: Blank line for visual separation.
034466| src/lib/locations/us-locations.ts:1241:       let matchType: "exact" | "prefix" | "contains" | null = null;
034467| NOTE: Local declaration used by search logic or UI.
034468| src/lib/locations/us-locations.ts:1242: 
034469| NOTE: Blank line for visual separation.
034470| src/lib/locations/us-locations.ts:1243:       if (termLower === normalized) {
034471| NOTE: Conditional logic controlling rendering or flow.
034472| src/lib/locations/us-locations.ts:1244:         matchType = "exact";
034473| NOTE: Implementation detail supporting search page behavior.
034474| src/lib/locations/us-locations.ts:1245:       } else if (termLower.startsWith(normalized)) {
034475| NOTE: Implementation detail supporting search page behavior.
034476| src/lib/locations/us-locations.ts:1246:         matchType = "prefix";
034477| NOTE: Implementation detail supporting search page behavior.
034478| src/lib/locations/us-locations.ts:1247:       } else if (termLower.includes(normalized)) {
034479| NOTE: Implementation detail supporting search page behavior.
034480| src/lib/locations/us-locations.ts:1248:         matchType = "contains";
034481| NOTE: Implementation detail supporting search page behavior.
034482| src/lib/locations/us-locations.ts:1249:       }
034483| NOTE: Implementation detail supporting search page behavior.
034484| src/lib/locations/us-locations.ts:1250: 
034485| NOTE: Blank line for visual separation.
034486| src/lib/locations/us-locations.ts:1251:       if (matchType) {
034487| NOTE: Conditional logic controlling rendering or flow.
034488| src/lib/locations/us-locations.ts:1252:         seen.add(location.id);
034489| NOTE: Implementation detail supporting search page behavior.
034490| src/lib/locations/us-locations.ts:1253:         results.push({
034491| NOTE: Implementation detail supporting search page behavior.
034492| src/lib/locations/us-locations.ts:1254:           location,
034493| NOTE: Implementation detail supporting search page behavior.
034494| src/lib/locations/us-locations.ts:1255:           score: scoreMatch(location, normalized, matchType),
034495| NOTE: Implementation detail supporting search page behavior.
034496| src/lib/locations/us-locations.ts:1256:           matchType,
034497| NOTE: Implementation detail supporting search page behavior.
034498| src/lib/locations/us-locations.ts:1257:         });
034499| NOTE: Implementation detail supporting search page behavior.
034500| src/lib/locations/us-locations.ts:1258:         break; // Only count each location once
034501| NOTE: Implementation detail supporting search page behavior.
034502| src/lib/locations/us-locations.ts:1259:       }
034503| NOTE: Implementation detail supporting search page behavior.
034504| src/lib/locations/us-locations.ts:1260:     }
034505| NOTE: Implementation detail supporting search page behavior.
034506| src/lib/locations/us-locations.ts:1261:   }
034507| NOTE: Implementation detail supporting search page behavior.
034508| src/lib/locations/us-locations.ts:1262: 
034509| NOTE: Blank line for visual separation.
034510| src/lib/locations/us-locations.ts:1263:   // Sort by score descending
034511| NOTE: Line comment documents intent or constraints.
034512| src/lib/locations/us-locations.ts:1264:   results.sort((a, b) => b.score - a.score);
034513| NOTE: Implementation detail supporting search page behavior.
034514| src/lib/locations/us-locations.ts:1265: 
034515| NOTE: Blank line for visual separation.
034516| src/lib/locations/us-locations.ts:1266:   return results.slice(0, limit);
034517| NOTE: Return statement for component or helper output.
034518| src/lib/locations/us-locations.ts:1267: }
034519| NOTE: Implementation detail supporting search page behavior.
034520| src/lib/locations/us-locations.ts:1268: 
034521| NOTE: Blank line for visual separation.
034522| src/lib/locations/us-locations.ts:1269: /**
034523| NOTE: Block comment line describing behavior or context.
034524| src/lib/locations/us-locations.ts:1270:  * Check if a query looks like a street address
034525| NOTE: Block comment line describing behavior or context.
034526| src/lib/locations/us-locations.ts:1271:  * Street addresses typically contain numbers
034527| NOTE: Block comment line describing behavior or context.
034528| src/lib/locations/us-locations.ts:1272:  */
034529| NOTE: Block comment line describing behavior or context.
034530| src/lib/locations/us-locations.ts:1273: export function looksLikeStreetAddress(query: string): boolean {
034531| NOTE: Exports helper or component function.
034532| src/lib/locations/us-locations.ts:1274:   // Check for common street address patterns
034533| NOTE: Line comment documents intent or constraints.
034534| src/lib/locations/us-locations.ts:1275:   return /\d+\s+\w/.test(query);
034535| NOTE: Return statement for component or helper output.
034536| src/lib/locations/us-locations.ts:1276: }
034537| NOTE: Implementation detail supporting search page behavior.
034538| FILE END: src/lib/locations/us-locations.ts
034539| 
034540| FILE START: src/lib/logger.ts
034541| FILE ROLE: Auto-discovered dependency in search page graph.
034542| src/lib/logger.ts:1: /**
034543| NOTE: Block comment line describing behavior or context.
034544| src/lib/logger.ts:2:  * Structured logging utility for production observability
034545| NOTE: Block comment line describing behavior or context.
034546| src/lib/logger.ts:3:  * Outputs JSON logs compatible with log aggregation services
034547| NOTE: Block comment line describing behavior or context.
034548| src/lib/logger.ts:4:  *
034549| NOTE: Block comment line describing behavior or context.
034550| src/lib/logger.ts:5:  * SECURITY: Implements automatic redaction of sensitive fields
034551| NOTE: Block comment line describing behavior or context.
034552| src/lib/logger.ts:6:  */
034553| NOTE: Block comment line describing behavior or context.
034554| src/lib/logger.ts:7: 
034555| NOTE: Blank line for visual separation.
034556| src/lib/logger.ts:8: import { getRequestContext } from "./request-context";
034557| NOTE: Imports dependency for this module.
034558| src/lib/logger.ts:9: import { headers } from "next/headers";
034559| NOTE: Imports dependency for this module.
034560| src/lib/logger.ts:10: 
034561| NOTE: Blank line for visual separation.
034562| src/lib/logger.ts:11: export type LogLevel = "debug" | "info" | "warn" | "error";
034563| NOTE: Implementation detail supporting search page behavior.
034564| src/lib/logger.ts:12: 
034565| NOTE: Blank line for visual separation.
034566| src/lib/logger.ts:13: export interface LogEntry {
034567| NOTE: Implementation detail supporting search page behavior.
034568| src/lib/logger.ts:14:   timestamp: string;
034569| NOTE: Implementation detail supporting search page behavior.
034570| src/lib/logger.ts:15:   level: LogLevel;
034571| NOTE: Implementation detail supporting search page behavior.
034572| src/lib/logger.ts:16:   message: string;
034573| NOTE: Implementation detail supporting search page behavior.
034574| src/lib/logger.ts:17:   requestId?: string;
034575| NOTE: Implementation detail supporting search page behavior.
034576| src/lib/logger.ts:18:   userId?: string;
034577| NOTE: Implementation detail supporting search page behavior.
034578| src/lib/logger.ts:19:   service: string;
034579| NOTE: Implementation detail supporting search page behavior.
034580| src/lib/logger.ts:20:   environment: string;
034581| NOTE: Implementation detail supporting search page behavior.
034582| src/lib/logger.ts:21:   version?: string;
034583| NOTE: Implementation detail supporting search page behavior.
034584| src/lib/logger.ts:22:   route?: string;
034585| NOTE: Implementation detail supporting search page behavior.
034586| src/lib/logger.ts:23:   method?: string;
034587| NOTE: Implementation detail supporting search page behavior.
034588| src/lib/logger.ts:24:   durationMs?: number;
034589| NOTE: Implementation detail supporting search page behavior.
034590| src/lib/logger.ts:25:   [key: string]: unknown;
034591| NOTE: Implementation detail supporting search page behavior.
034592| src/lib/logger.ts:26: }
034593| NOTE: Implementation detail supporting search page behavior.
034594| src/lib/logger.ts:27: 
034595| NOTE: Blank line for visual separation.
034596| src/lib/logger.ts:28: const LOG_LEVELS: Record<LogLevel, number> = {
034597| NOTE: Local declaration used by search logic or UI.
034598| src/lib/logger.ts:29:   debug: 0,
034599| NOTE: Implementation detail supporting search page behavior.
034600| src/lib/logger.ts:30:   info: 1,
034601| NOTE: Implementation detail supporting search page behavior.
034602| src/lib/logger.ts:31:   warn: 2,
034603| NOTE: Implementation detail supporting search page behavior.
034604| src/lib/logger.ts:32:   error: 3,
034605| NOTE: Implementation detail supporting search page behavior.
034606| src/lib/logger.ts:33: };
034607| NOTE: Implementation detail supporting search page behavior.
034608| src/lib/logger.ts:34: 
034609| NOTE: Blank line for visual separation.
034610| src/lib/logger.ts:35: // Minimum log level based on environment
034611| NOTE: Line comment documents intent or constraints.
034612| src/lib/logger.ts:36: const MIN_LOG_LEVEL: LogLevel =
034613| NOTE: Local declaration used by search logic or UI.
034614| src/lib/logger.ts:37:   process.env.NODE_ENV === "production" ? "info" : "debug";
034615| NOTE: Implementation detail supporting search page behavior.
034616| src/lib/logger.ts:38: 
034617| NOTE: Blank line for visual separation.
034618| src/lib/logger.ts:39: // Fields to redact from logs (case-insensitive matching)
034619| NOTE: Line comment documents intent or constraints.
034620| src/lib/logger.ts:40: const REDACTED_FIELDS = new Set([
034621| NOTE: Local declaration used by search logic or UI.
034622| src/lib/logger.ts:41:   "password",
034623| NOTE: Implementation detail supporting search page behavior.
034624| src/lib/logger.ts:42:   "token",
034625| NOTE: Implementation detail supporting search page behavior.
034626| src/lib/logger.ts:43:   "secret",
034627| NOTE: Implementation detail supporting search page behavior.
034628| src/lib/logger.ts:44:   "apikey",
034629| NOTE: Implementation detail supporting search page behavior.
034630| src/lib/logger.ts:45:   "api_key",
034631| NOTE: Implementation detail supporting search page behavior.
034632| src/lib/logger.ts:46:   "authorization",
034633| NOTE: Implementation detail supporting search page behavior.
034634| src/lib/logger.ts:47:   "cookie",
034635| NOTE: Implementation detail supporting search page behavior.
034636| src/lib/logger.ts:48:   "sessiontoken",
034637| NOTE: Implementation detail supporting search page behavior.
034638| src/lib/logger.ts:49:   "accesstoken",
034639| NOTE: Implementation detail supporting search page behavior.
034640| src/lib/logger.ts:50:   "refreshtoken",
034641| NOTE: Implementation detail supporting search page behavior.
034642| src/lib/logger.ts:51:   "bearer",
034643| NOTE: Implementation detail supporting search page behavior.
034644| src/lib/logger.ts:52:   "credential",
034645| NOTE: Implementation detail supporting search page behavior.
034646| src/lib/logger.ts:53:   "private_key",
034647| NOTE: Implementation detail supporting search page behavior.
034648| src/lib/logger.ts:54:   "privatekey",
034649| NOTE: Implementation detail supporting search page behavior.
034650| src/lib/logger.ts:55:   "ssn",
034651| NOTE: Implementation detail supporting search page behavior.
034652| src/lib/logger.ts:56:   "creditcard",
034653| NOTE: Implementation detail supporting search page behavior.
034654| src/lib/logger.ts:57:   "credit_card",
034655| NOTE: Implementation detail supporting search page behavior.
034656| src/lib/logger.ts:58:   "cardnumber",
034657| NOTE: Implementation detail supporting search page behavior.
034658| src/lib/logger.ts:59:   "cvv",
034659| NOTE: Implementation detail supporting search page behavior.
034660| src/lib/logger.ts:60:   "cvc",
034661| NOTE: Implementation detail supporting search page behavior.
034662| src/lib/logger.ts:61: ]);
034663| NOTE: Implementation detail supporting search page behavior.
034664| src/lib/logger.ts:62: 
034665| NOTE: Blank line for visual separation.
034666| src/lib/logger.ts:63: // Patterns to redact from string values
034667| NOTE: Line comment documents intent or constraints.
034668| src/lib/logger.ts:64: const REDACT_PATTERNS = [
034669| NOTE: Local declaration used by search logic or UI.
034670| src/lib/logger.ts:65:   /Bearer\s+[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+/gi, // JWT tokens
034671| NOTE: Implementation detail supporting search page behavior.
034672| src/lib/logger.ts:66:   /[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}/g, // Email addresses (optional)
034673| NOTE: Implementation detail supporting search page behavior.
034674| src/lib/logger.ts:67: ];
034675| NOTE: Implementation detail supporting search page behavior.
034676| src/lib/logger.ts:68: 
034677| NOTE: Blank line for visual separation.
034678| src/lib/logger.ts:69: /**
034679| NOTE: Block comment line describing behavior or context.
034680| src/lib/logger.ts:70:  * Redact sensitive information from log metadata
034681| NOTE: Block comment line describing behavior or context.
034682| src/lib/logger.ts:71:  */
034683| NOTE: Block comment line describing behavior or context.
034684| src/lib/logger.ts:72: function redactSensitive(obj: unknown, depth = 0): unknown {
034685| NOTE: Defines a helper or component function.
034686| src/lib/logger.ts:73:   if (depth > 10) return "[MAX_DEPTH]";
034687| NOTE: Conditional logic controlling rendering or flow.
034688| src/lib/logger.ts:74: 
034689| NOTE: Blank line for visual separation.
034690| src/lib/logger.ts:75:   if (obj === null || obj === undefined) return obj;
034691| NOTE: Conditional logic controlling rendering or flow.
034692| src/lib/logger.ts:76: 
034693| NOTE: Blank line for visual separation.
034694| src/lib/logger.ts:77:   if (typeof obj === "string") {
034695| NOTE: Conditional logic controlling rendering or flow.
034696| src/lib/logger.ts:78:     let result = obj;
034697| NOTE: Local declaration used by search logic or UI.
034698| src/lib/logger.ts:79:     for (const pattern of REDACT_PATTERNS) {
034699| NOTE: Implementation detail supporting search page behavior.
034700| src/lib/logger.ts:80:       result = result.replace(pattern, "[REDACTED]");
034701| NOTE: Implementation detail supporting search page behavior.
034702| src/lib/logger.ts:81:     }
034703| NOTE: Implementation detail supporting search page behavior.
034704| src/lib/logger.ts:82:     return result;
034705| NOTE: Return statement for component or helper output.
034706| src/lib/logger.ts:83:   }
034707| NOTE: Implementation detail supporting search page behavior.
034708| src/lib/logger.ts:84: 
034709| NOTE: Blank line for visual separation.
034710| src/lib/logger.ts:85:   if (Array.isArray(obj)) {
034711| NOTE: Conditional logic controlling rendering or flow.
034712| src/lib/logger.ts:86:     return obj.map((item) => redactSensitive(item, depth + 1));
034713| NOTE: Return statement for component or helper output.
034714| src/lib/logger.ts:87:   }
034715| NOTE: Implementation detail supporting search page behavior.
034716| src/lib/logger.ts:88: 
034717| NOTE: Blank line for visual separation.
034718| src/lib/logger.ts:89:   if (typeof obj === "object") {
034719| NOTE: Conditional logic controlling rendering or flow.
034720| src/lib/logger.ts:90:     const redacted: Record<string, unknown> = {};
034721| NOTE: Local declaration used by search logic or UI.
034722| src/lib/logger.ts:91:     for (const [key, value] of Object.entries(obj)) {
034723| NOTE: Implementation detail supporting search page behavior.
034724| src/lib/logger.ts:92:       const lowerKey = key.toLowerCase();
034725| NOTE: Local declaration used by search logic or UI.
034726| src/lib/logger.ts:93:       if (REDACTED_FIELDS.has(lowerKey)) {
034727| NOTE: Conditional logic controlling rendering or flow.
034728| src/lib/logger.ts:94:         redacted[key] = "[REDACTED]";
034729| NOTE: Implementation detail supporting search page behavior.
034730| src/lib/logger.ts:95:       } else {
034731| NOTE: Implementation detail supporting search page behavior.
034732| src/lib/logger.ts:96:         redacted[key] = redactSensitive(value, depth + 1);
034733| NOTE: Implementation detail supporting search page behavior.
034734| src/lib/logger.ts:97:       }
034735| NOTE: Implementation detail supporting search page behavior.
034736| src/lib/logger.ts:98:     }
034737| NOTE: Implementation detail supporting search page behavior.
034738| src/lib/logger.ts:99:     return redacted;
034739| NOTE: Return statement for component or helper output.
034740| src/lib/logger.ts:100:   }
034741| NOTE: Implementation detail supporting search page behavior.
034742| src/lib/logger.ts:101: 
034743| NOTE: Blank line for visual separation.
034744| src/lib/logger.ts:102:   return obj;
034745| NOTE: Return statement for component or helper output.
034746| src/lib/logger.ts:103: }
034747| NOTE: Implementation detail supporting search page behavior.
034748| src/lib/logger.ts:104: 
034749| NOTE: Blank line for visual separation.
034750| src/lib/logger.ts:105: function shouldLog(level: LogLevel): boolean {
034751| NOTE: Defines a helper or component function.
034752| src/lib/logger.ts:106:   return LOG_LEVELS[level] >= LOG_LEVELS[MIN_LOG_LEVEL];
034753| NOTE: Return statement for component or helper output.
034754| src/lib/logger.ts:107: }
034755| NOTE: Implementation detail supporting search page behavior.
034756| src/lib/logger.ts:108: 
034757| NOTE: Blank line for visual separation.
034758| src/lib/logger.ts:109: /**
034759| NOTE: Block comment line describing behavior or context.
034760| src/lib/logger.ts:110:  * Get request ID from Next.js headers (works in server components and API routes)
034761| NOTE: Block comment line describing behavior or context.
034762| src/lib/logger.ts:111:  */
034763| NOTE: Block comment line describing behavior or context.
034764| src/lib/logger.ts:112: async function getRequestIdFromHeaders(): Promise<string | undefined> {
034765| NOTE: Implementation detail supporting search page behavior.
034766| src/lib/logger.ts:113:   try {
034767| NOTE: Implementation detail supporting search page behavior.
034768| src/lib/logger.ts:114:     const headersList = await headers();
034769| NOTE: Local declaration used by search logic or UI.
034770| src/lib/logger.ts:115:     return (
034771| NOTE: Return statement for component or helper output.
034772| src/lib/logger.ts:116:       headersList.get("x-request-id") ||
034773| NOTE: Implementation detail supporting search page behavior.
034774| src/lib/logger.ts:117:       headersList.get("x-vercel-id") ||
034775| NOTE: Implementation detail supporting search page behavior.
034776| src/lib/logger.ts:118:       undefined
034777| NOTE: Implementation detail supporting search page behavior.
034778| src/lib/logger.ts:119:     );
034779| NOTE: Implementation detail supporting search page behavior.
034780| src/lib/logger.ts:120:   } catch {
034781| NOTE: Implementation detail supporting search page behavior.
034782| src/lib/logger.ts:121:     // headers() throws outside of request context
034783| NOTE: Line comment documents intent or constraints.
034784| src/lib/logger.ts:122:     return undefined;
034785| NOTE: Return statement for component or helper output.
034786| src/lib/logger.ts:123:   }
034787| NOTE: Implementation detail supporting search page behavior.
034788| src/lib/logger.ts:124: }
034789| NOTE: Implementation detail supporting search page behavior.
034790| src/lib/logger.ts:125: 
034791| NOTE: Blank line for visual separation.
034792| src/lib/logger.ts:126: async function formatLogEntry(
034793| NOTE: Implementation detail supporting search page behavior.
034794| src/lib/logger.ts:127:   level: LogLevel,
034795| NOTE: Implementation detail supporting search page behavior.
034796| src/lib/logger.ts:128:   message: string,
034797| NOTE: Implementation detail supporting search page behavior.
034798| src/lib/logger.ts:129:   meta?: Record<string, unknown>,
034799| NOTE: Implementation detail supporting search page behavior.
034800| src/lib/logger.ts:130: ): Promise<LogEntry> {
034801| NOTE: Implementation detail supporting search page behavior.
034802| src/lib/logger.ts:131:   const context = getRequestContext();
034803| NOTE: Local declaration used by search logic or UI.
034804| src/lib/logger.ts:132:   const requestId = context?.requestId || (await getRequestIdFromHeaders());
034805| NOTE: Local declaration used by search logic or UI.
034806| src/lib/logger.ts:133: 
034807| NOTE: Blank line for visual separation.
034808| src/lib/logger.ts:134:   // Redact sensitive data from metadata
034809| NOTE: Line comment documents intent or constraints.
034810| src/lib/logger.ts:135:   const safeMeta = meta
034811| NOTE: Local declaration used by search logic or UI.
034812| src/lib/logger.ts:136:     ? (redactSensitive(meta) as Record<string, unknown>)
034813| NOTE: Implementation detail supporting search page behavior.
034814| src/lib/logger.ts:137:     : undefined;
034815| NOTE: Implementation detail supporting search page behavior.
034816| src/lib/logger.ts:138: 
034817| NOTE: Blank line for visual separation.
034818| src/lib/logger.ts:139:   return {
034819| NOTE: Return statement for component or helper output.
034820| src/lib/logger.ts:140:     timestamp: new Date().toISOString(),
034821| NOTE: Implementation detail supporting search page behavior.
034822| src/lib/logger.ts:141:     level,
034823| NOTE: Implementation detail supporting search page behavior.
034824| src/lib/logger.ts:142:     message,
034825| NOTE: Implementation detail supporting search page behavior.
034826| src/lib/logger.ts:143:     requestId,
034827| NOTE: Implementation detail supporting search page behavior.
034828| src/lib/logger.ts:144:     userId: context?.userId,
034829| NOTE: Implementation detail supporting search page behavior.
034830| src/lib/logger.ts:145:     service: "roomshare",
034831| NOTE: Implementation detail supporting search page behavior.
034832| src/lib/logger.ts:146:     environment: process.env.NODE_ENV || "development",
034833| NOTE: Implementation detail supporting search page behavior.
034834| src/lib/logger.ts:147:     version: process.env.VERCEL_GIT_COMMIT_SHA?.slice(0, 7),
034835| NOTE: Implementation detail supporting search page behavior.
034836| src/lib/logger.ts:148:     route: context?.path,
034837| NOTE: Implementation detail supporting search page behavior.
034838| src/lib/logger.ts:149:     method: context?.method,
034839| NOTE: Implementation detail supporting search page behavior.
034840| src/lib/logger.ts:150:     ...safeMeta,
034841| NOTE: Implementation detail supporting search page behavior.
034842| src/lib/logger.ts:151:   };
034843| NOTE: Implementation detail supporting search page behavior.
034844| src/lib/logger.ts:152: }
034845| NOTE: Implementation detail supporting search page behavior.
034846| src/lib/logger.ts:153: 
034847| NOTE: Blank line for visual separation.
034848| src/lib/logger.ts:154: async function log(
034849| NOTE: Implementation detail supporting search page behavior.
034850| src/lib/logger.ts:155:   level: LogLevel,
034851| NOTE: Implementation detail supporting search page behavior.
034852| src/lib/logger.ts:156:   message: string,
034853| NOTE: Implementation detail supporting search page behavior.
034854| src/lib/logger.ts:157:   meta?: Record<string, unknown>,
034855| NOTE: Implementation detail supporting search page behavior.
034856| src/lib/logger.ts:158: ): Promise<void> {
034857| NOTE: Implementation detail supporting search page behavior.
034858| src/lib/logger.ts:159:   if (!shouldLog(level)) return;
034859| NOTE: Conditional logic controlling rendering or flow.
034860| src/lib/logger.ts:160: 
034861| NOTE: Blank line for visual separation.
034862| src/lib/logger.ts:161:   const entry = await formatLogEntry(level, message, meta);
034863| NOTE: Local declaration used by search logic or UI.
034864| src/lib/logger.ts:162: 
034865| NOTE: Blank line for visual separation.
034866| src/lib/logger.ts:163:   // In production, output JSON for log aggregation
034867| NOTE: Line comment documents intent or constraints.
034868| src/lib/logger.ts:164:   // In development, use human-readable format
034869| NOTE: Line comment documents intent or constraints.
034870| src/lib/logger.ts:165:   if (process.env.NODE_ENV === "production") {
034871| NOTE: Conditional logic controlling rendering or flow.
034872| src/lib/logger.ts:166:     const output = JSON.stringify(entry);
034873| NOTE: Local declaration used by search logic or UI.
034874| src/lib/logger.ts:167:     switch (level) {
034875| NOTE: Implementation detail supporting search page behavior.
034876| src/lib/logger.ts:168:       case "error":
034877| NOTE: Implementation detail supporting search page behavior.
034878| src/lib/logger.ts:169:         console.error(output);
034879| NOTE: Implementation detail supporting search page behavior.
034880| src/lib/logger.ts:170:         break;
034881| NOTE: Implementation detail supporting search page behavior.
034882| src/lib/logger.ts:171:       case "warn":
034883| NOTE: Implementation detail supporting search page behavior.
034884| src/lib/logger.ts:172:         console.warn(output);
034885| NOTE: Implementation detail supporting search page behavior.
034886| src/lib/logger.ts:173:         break;
034887| NOTE: Implementation detail supporting search page behavior.
034888| src/lib/logger.ts:174:       default:
034889| NOTE: Implementation detail supporting search page behavior.
034890| src/lib/logger.ts:175:         console.log(output);
034891| NOTE: Implementation detail supporting search page behavior.
034892| src/lib/logger.ts:176:     }
034893| NOTE: Implementation detail supporting search page behavior.
034894| src/lib/logger.ts:177:   } else {
034895| NOTE: Implementation detail supporting search page behavior.
034896| src/lib/logger.ts:178:     // Development: human-readable format
034897| NOTE: Line comment documents intent or constraints.
034898| src/lib/logger.ts:179:     const prefix = `[${entry.timestamp}] [${level.toUpperCase()}]`;
034899| NOTE: Local declaration used by search logic or UI.
034900| src/lib/logger.ts:180:     const contextInfo = entry.requestId
034901| NOTE: Local declaration used by search logic or UI.
034902| src/lib/logger.ts:181:       ? ` [${entry.requestId.slice(0, 8)}]`
034903| NOTE: Implementation detail supporting search page behavior.
034904| src/lib/logger.ts:182:       : "";
034905| NOTE: Implementation detail supporting search page behavior.
034906| src/lib/logger.ts:183:     const userInfo = entry.userId ? ` [user:${entry.userId.slice(0, 8)}]` : "";
034907| NOTE: Local declaration used by search logic or UI.
034908| src/lib/logger.ts:184: 
034909| NOTE: Blank line for visual separation.
034910| src/lib/logger.ts:185:     // Redact meta for development output too
034911| NOTE: Line comment documents intent or constraints.
034912| src/lib/logger.ts:186:     const safeMeta = meta ? redactSensitive(meta) : undefined;
034913| NOTE: Local declaration used by search logic or UI.
034914| src/lib/logger.ts:187: 
034915| NOTE: Blank line for visual separation.
034916| src/lib/logger.ts:188:     switch (level) {
034917| NOTE: Implementation detail supporting search page behavior.
034918| src/lib/logger.ts:189:       case "error":
034919| NOTE: Implementation detail supporting search page behavior.
034920| src/lib/logger.ts:190:         console.error(
034921| NOTE: Implementation detail supporting search page behavior.
034922| src/lib/logger.ts:191:           `${prefix}${contextInfo}${userInfo}`,
034923| NOTE: Implementation detail supporting search page behavior.
034924| src/lib/logger.ts:192:           message,
034925| NOTE: Implementation detail supporting search page behavior.
034926| src/lib/logger.ts:193:           safeMeta || "",
034927| NOTE: Implementation detail supporting search page behavior.
034928| src/lib/logger.ts:194:         );
034929| NOTE: Implementation detail supporting search page behavior.
034930| src/lib/logger.ts:195:         break;
034931| NOTE: Implementation detail supporting search page behavior.
034932| src/lib/logger.ts:196:       case "warn":
034933| NOTE: Implementation detail supporting search page behavior.
034934| src/lib/logger.ts:197:         console.warn(
034935| NOTE: Implementation detail supporting search page behavior.
034936| src/lib/logger.ts:198:           `${prefix}${contextInfo}${userInfo}`,
034937| NOTE: Implementation detail supporting search page behavior.
034938| src/lib/logger.ts:199:           message,
034939| NOTE: Implementation detail supporting search page behavior.
034940| src/lib/logger.ts:200:           safeMeta || "",
034941| NOTE: Implementation detail supporting search page behavior.
034942| src/lib/logger.ts:201:         );
034943| NOTE: Implementation detail supporting search page behavior.
034944| src/lib/logger.ts:202:         break;
034945| NOTE: Implementation detail supporting search page behavior.
034946| src/lib/logger.ts:203:       case "debug":
034947| NOTE: Implementation detail supporting search page behavior.
034948| src/lib/logger.ts:204:         console.debug(
034949| NOTE: Implementation detail supporting search page behavior.
034950| src/lib/logger.ts:205:           `${prefix}${contextInfo}${userInfo}`,
034951| NOTE: Implementation detail supporting search page behavior.
034952| src/lib/logger.ts:206:           message,
034953| NOTE: Implementation detail supporting search page behavior.
034954| src/lib/logger.ts:207:           safeMeta || "",
034955| NOTE: Implementation detail supporting search page behavior.
034956| src/lib/logger.ts:208:         );
034957| NOTE: Implementation detail supporting search page behavior.
034958| src/lib/logger.ts:209:         break;
034959| NOTE: Implementation detail supporting search page behavior.
034960| src/lib/logger.ts:210:       default:
034961| NOTE: Implementation detail supporting search page behavior.
034962| src/lib/logger.ts:211:         console.log(
034963| NOTE: Implementation detail supporting search page behavior.
034964| src/lib/logger.ts:212:           `${prefix}${contextInfo}${userInfo}`,
034965| NOTE: Implementation detail supporting search page behavior.
034966| src/lib/logger.ts:213:           message,
034967| NOTE: Implementation detail supporting search page behavior.
034968| src/lib/logger.ts:214:           safeMeta || "",
034969| NOTE: Implementation detail supporting search page behavior.
034970| src/lib/logger.ts:215:         );
034971| NOTE: Implementation detail supporting search page behavior.
034972| src/lib/logger.ts:216:     }
034973| NOTE: Implementation detail supporting search page behavior.
034974| src/lib/logger.ts:217:   }
034975| NOTE: Implementation detail supporting search page behavior.
034976| src/lib/logger.ts:218: }
034977| NOTE: Implementation detail supporting search page behavior.
034978| src/lib/logger.ts:219: 
034979| NOTE: Blank line for visual separation.
034980| src/lib/logger.ts:220: /**
034981| NOTE: Block comment line describing behavior or context.
034982| src/lib/logger.ts:221:  * Synchronous log function for use in catch blocks where async is awkward
034983| NOTE: Block comment line describing behavior or context.
034984| src/lib/logger.ts:222:  * Uses cached request context only (no async header lookup)
034985| NOTE: Block comment line describing behavior or context.
034986| src/lib/logger.ts:223:  */
034987| NOTE: Block comment line describing behavior or context.
034988| src/lib/logger.ts:224: function logSync(
034989| NOTE: Defines a helper or component function.
034990| src/lib/logger.ts:225:   level: LogLevel,
034991| NOTE: Implementation detail supporting search page behavior.
034992| src/lib/logger.ts:226:   message: string,
034993| NOTE: Implementation detail supporting search page behavior.
034994| src/lib/logger.ts:227:   meta?: Record<string, unknown>,
034995| NOTE: Implementation detail supporting search page behavior.
034996| src/lib/logger.ts:228: ): void {
034997| NOTE: Implementation detail supporting search page behavior.
034998| src/lib/logger.ts:229:   if (!shouldLog(level)) return;
034999| NOTE: Conditional logic controlling rendering or flow.
035000| src/lib/logger.ts:230: 
035001| NOTE: Blank line for visual separation.
035002| src/lib/logger.ts:231:   const context = getRequestContext();
035003| NOTE: Local declaration used by search logic or UI.
035004| src/lib/logger.ts:232:   const safeMeta = meta
035005| NOTE: Local declaration used by search logic or UI.
035006| src/lib/logger.ts:233:     ? (redactSensitive(meta) as Record<string, unknown>)
035007| NOTE: Implementation detail supporting search page behavior.
035008| src/lib/logger.ts:234:     : undefined;
035009| NOTE: Implementation detail supporting search page behavior.
035010| src/lib/logger.ts:235: 
035011| NOTE: Blank line for visual separation.
035012| src/lib/logger.ts:236:   const entry: LogEntry = {
035013| NOTE: Local declaration used by search logic or UI.
035014| src/lib/logger.ts:237:     timestamp: new Date().toISOString(),
035015| NOTE: Implementation detail supporting search page behavior.
035016| src/lib/logger.ts:238:     level,
035017| NOTE: Implementation detail supporting search page behavior.
035018| src/lib/logger.ts:239:     message,
035019| NOTE: Implementation detail supporting search page behavior.
035020| src/lib/logger.ts:240:     requestId: context?.requestId,
035021| NOTE: Implementation detail supporting search page behavior.
035022| src/lib/logger.ts:241:     userId: context?.userId,
035023| NOTE: Implementation detail supporting search page behavior.
035024| src/lib/logger.ts:242:     service: "roomshare",
035025| NOTE: Implementation detail supporting search page behavior.
035026| src/lib/logger.ts:243:     environment: process.env.NODE_ENV || "development",
035027| NOTE: Implementation detail supporting search page behavior.
035028| src/lib/logger.ts:244:     version: process.env.VERCEL_GIT_COMMIT_SHA?.slice(0, 7),
035029| NOTE: Implementation detail supporting search page behavior.
035030| src/lib/logger.ts:245:     route: context?.path,
035031| NOTE: Implementation detail supporting search page behavior.
035032| src/lib/logger.ts:246:     method: context?.method,
035033| NOTE: Implementation detail supporting search page behavior.
035034| src/lib/logger.ts:247:     ...safeMeta,
035035| NOTE: Implementation detail supporting search page behavior.
035036| src/lib/logger.ts:248:   };
035037| NOTE: Implementation detail supporting search page behavior.
035038| src/lib/logger.ts:249: 
035039| NOTE: Blank line for visual separation.
035040| src/lib/logger.ts:250:   if (process.env.NODE_ENV === "production") {
035041| NOTE: Conditional logic controlling rendering or flow.
035042| src/lib/logger.ts:251:     const output = JSON.stringify(entry);
035043| NOTE: Local declaration used by search logic or UI.
035044| src/lib/logger.ts:252:     switch (level) {
035045| NOTE: Implementation detail supporting search page behavior.
035046| src/lib/logger.ts:253:       case "error":
035047| NOTE: Implementation detail supporting search page behavior.
035048| src/lib/logger.ts:254:         console.error(output);
035049| NOTE: Implementation detail supporting search page behavior.
035050| src/lib/logger.ts:255:         break;
035051| NOTE: Implementation detail supporting search page behavior.
035052| src/lib/logger.ts:256:       case "warn":
035053| NOTE: Implementation detail supporting search page behavior.
035054| src/lib/logger.ts:257:         console.warn(output);
035055| NOTE: Implementation detail supporting search page behavior.
035056| src/lib/logger.ts:258:         break;
035057| NOTE: Implementation detail supporting search page behavior.
035058| src/lib/logger.ts:259:       default:
035059| NOTE: Implementation detail supporting search page behavior.
035060| src/lib/logger.ts:260:         console.log(output);
035061| NOTE: Implementation detail supporting search page behavior.
035062| src/lib/logger.ts:261:     }
035063| NOTE: Implementation detail supporting search page behavior.
035064| src/lib/logger.ts:262:   } else {
035065| NOTE: Implementation detail supporting search page behavior.
035066| src/lib/logger.ts:263:     const prefix = `[${entry.timestamp}] [${level.toUpperCase()}]`;
035067| NOTE: Local declaration used by search logic or UI.
035068| src/lib/logger.ts:264:     const contextInfo = entry.requestId
035069| NOTE: Local declaration used by search logic or UI.
035070| src/lib/logger.ts:265:       ? ` [${entry.requestId.slice(0, 8)}]`
035071| NOTE: Implementation detail supporting search page behavior.
035072| src/lib/logger.ts:266:       : "";
035073| NOTE: Implementation detail supporting search page behavior.
035074| src/lib/logger.ts:267:     const userInfo = entry.userId ? ` [user:${entry.userId.slice(0, 8)}]` : "";
035075| NOTE: Local declaration used by search logic or UI.
035076| src/lib/logger.ts:268: 
035077| NOTE: Blank line for visual separation.
035078| src/lib/logger.ts:269:     switch (level) {
035079| NOTE: Implementation detail supporting search page behavior.
035080| src/lib/logger.ts:270:       case "error":
035081| NOTE: Implementation detail supporting search page behavior.
035082| src/lib/logger.ts:271:         console.error(
035083| NOTE: Implementation detail supporting search page behavior.
035084| src/lib/logger.ts:272:           `${prefix}${contextInfo}${userInfo}`,
035085| NOTE: Implementation detail supporting search page behavior.
035086| src/lib/logger.ts:273:           message,
035087| NOTE: Implementation detail supporting search page behavior.
035088| src/lib/logger.ts:274:           safeMeta || "",
035089| NOTE: Implementation detail supporting search page behavior.
035090| src/lib/logger.ts:275:         );
035091| NOTE: Implementation detail supporting search page behavior.
035092| src/lib/logger.ts:276:         break;
035093| NOTE: Implementation detail supporting search page behavior.
035094| src/lib/logger.ts:277:       case "warn":
035095| NOTE: Implementation detail supporting search page behavior.
035096| src/lib/logger.ts:278:         console.warn(
035097| NOTE: Implementation detail supporting search page behavior.
035098| src/lib/logger.ts:279:           `${prefix}${contextInfo}${userInfo}`,
035099| NOTE: Implementation detail supporting search page behavior.
035100| src/lib/logger.ts:280:           message,
035101| NOTE: Implementation detail supporting search page behavior.
035102| src/lib/logger.ts:281:           safeMeta || "",
035103| NOTE: Implementation detail supporting search page behavior.
035104| src/lib/logger.ts:282:         );
035105| NOTE: Implementation detail supporting search page behavior.
035106| src/lib/logger.ts:283:         break;
035107| NOTE: Implementation detail supporting search page behavior.
035108| src/lib/logger.ts:284:       case "debug":
035109| NOTE: Implementation detail supporting search page behavior.
035110| src/lib/logger.ts:285:         console.debug(
035111| NOTE: Implementation detail supporting search page behavior.
035112| src/lib/logger.ts:286:           `${prefix}${contextInfo}${userInfo}`,
035113| NOTE: Implementation detail supporting search page behavior.
035114| src/lib/logger.ts:287:           message,
035115| NOTE: Implementation detail supporting search page behavior.
035116| src/lib/logger.ts:288:           safeMeta || "",
035117| NOTE: Implementation detail supporting search page behavior.
035118| src/lib/logger.ts:289:         );
035119| NOTE: Implementation detail supporting search page behavior.
035120| src/lib/logger.ts:290:         break;
035121| NOTE: Implementation detail supporting search page behavior.
035122| src/lib/logger.ts:291:       default:
035123| NOTE: Implementation detail supporting search page behavior.
035124| src/lib/logger.ts:292:         console.log(
035125| NOTE: Implementation detail supporting search page behavior.
035126| src/lib/logger.ts:293:           `${prefix}${contextInfo}${userInfo}`,
035127| NOTE: Implementation detail supporting search page behavior.
035128| src/lib/logger.ts:294:           message,
035129| NOTE: Implementation detail supporting search page behavior.
035130| src/lib/logger.ts:295:           safeMeta || "",
035131| NOTE: Implementation detail supporting search page behavior.
035132| src/lib/logger.ts:296:         );
035133| NOTE: Implementation detail supporting search page behavior.
035134| src/lib/logger.ts:297:     }
035135| NOTE: Implementation detail supporting search page behavior.
035136| src/lib/logger.ts:298:   }
035137| NOTE: Implementation detail supporting search page behavior.
035138| src/lib/logger.ts:299: }
035139| NOTE: Implementation detail supporting search page behavior.
035140| src/lib/logger.ts:300: 
035141| NOTE: Blank line for visual separation.
035142| src/lib/logger.ts:301: /**
035143| NOTE: Block comment line describing behavior or context.
035144| src/lib/logger.ts:302:  * Structured logger with request context correlation
035145| NOTE: Block comment line describing behavior or context.
035146| src/lib/logger.ts:303:  *
035147| NOTE: Block comment line describing behavior or context.
035148| src/lib/logger.ts:304:  * Provides both async (default) and sync methods:
035149| NOTE: Block comment line describing behavior or context.
035150| src/lib/logger.ts:305:  * - Async methods (`logger.info`, etc.) include request ID from headers
035151| NOTE: Block comment line describing behavior or context.
035152| src/lib/logger.ts:306:  * - Sync methods (`logger.sync.info`, etc.) for catch blocks
035153| NOTE: Block comment line describing behavior or context.
035154| src/lib/logger.ts:307:  *
035155| NOTE: Block comment line describing behavior or context.
035156| src/lib/logger.ts:308:  * @example
035157| NOTE: Block comment line describing behavior or context.
035158| src/lib/logger.ts:309:  * ```ts
035159| NOTE: Block comment line describing behavior or context.
035160| src/lib/logger.ts:310:  * // Async (preferred - includes full request context)
035161| NOTE: Block comment line describing behavior or context.
035162| src/lib/logger.ts:311:  * await logger.info('User logged in', { userId: '123' });
035163| NOTE: Block comment line describing behavior or context.
035164| src/lib/logger.ts:312:  * await logger.error('Failed to send email', { error: err.message });
035165| NOTE: Block comment line describing behavior or context.
035166| src/lib/logger.ts:313:  *
035167| NOTE: Block comment line describing behavior or context.
035168| src/lib/logger.ts:314:  * // Sync (for catch blocks or non-async contexts)
035169| NOTE: Block comment line describing behavior or context.
035170| src/lib/logger.ts:315:  * logger.sync.error('Sync error log', { error: err.message });
035171| NOTE: Block comment line describing behavior or context.
035172| src/lib/logger.ts:316:  *
035173| NOTE: Block comment line describing behavior or context.
035174| src/lib/logger.ts:317:  * // Child logger with preset context
035175| NOTE: Block comment line describing behavior or context.
035176| src/lib/logger.ts:318:  * const routeLogger = logger.child({ route: '/api/users', method: 'POST' });
035177| NOTE: Block comment line describing behavior or context.
035178| src/lib/logger.ts:319:  * await routeLogger.info('Processing request');
035179| NOTE: Block comment line describing behavior or context.
035180| src/lib/logger.ts:320:  * ```
035181| NOTE: Block comment line describing behavior or context.
035182| src/lib/logger.ts:321:  */
035183| NOTE: Block comment line describing behavior or context.
035184| src/lib/logger.ts:322: export const logger = {
035185| NOTE: Implementation detail supporting search page behavior.
035186| src/lib/logger.ts:323:   debug: (message: string, meta?: Record<string, unknown>) =>
035187| NOTE: Implementation detail supporting search page behavior.
035188| src/lib/logger.ts:324:     log("debug", message, meta),
035189| NOTE: Implementation detail supporting search page behavior.
035190| src/lib/logger.ts:325:   info: (message: string, meta?: Record<string, unknown>) =>
035191| NOTE: Implementation detail supporting search page behavior.
035192| src/lib/logger.ts:326:     log("info", message, meta),
035193| NOTE: Implementation detail supporting search page behavior.
035194| src/lib/logger.ts:327:   warn: (message: string, meta?: Record<string, unknown>) =>
035195| NOTE: Implementation detail supporting search page behavior.
035196| src/lib/logger.ts:328:     log("warn", message, meta),
035197| NOTE: Implementation detail supporting search page behavior.
035198| src/lib/logger.ts:329:   error: (message: string, meta?: Record<string, unknown>) =>
035199| NOTE: Implementation detail supporting search page behavior.
035200| src/lib/logger.ts:330:     log("error", message, meta),
035201| NOTE: Implementation detail supporting search page behavior.
035202| src/lib/logger.ts:331: 
035203| NOTE: Blank line for visual separation.
035204| src/lib/logger.ts:332:   /**
035205| NOTE: Block comment line describing behavior or context.
035206| src/lib/logger.ts:333:    * Log with custom level
035207| NOTE: Block comment line describing behavior or context.
035208| src/lib/logger.ts:334:    */
035209| NOTE: Block comment line describing behavior or context.
035210| src/lib/logger.ts:335:   log: (level: LogLevel, message: string, meta?: Record<string, unknown>) =>
035211| NOTE: Implementation detail supporting search page behavior.
035212| src/lib/logger.ts:336:     log(level, message, meta),
035213| NOTE: Implementation detail supporting search page behavior.
035214| src/lib/logger.ts:337: 
035215| NOTE: Blank line for visual separation.
035216| src/lib/logger.ts:338:   /**
035217| NOTE: Block comment line describing behavior or context.
035218| src/lib/logger.ts:339:    * Synchronous logging methods for catch blocks
035219| NOTE: Block comment line describing behavior or context.
035220| src/lib/logger.ts:340:    * Uses only cached request context (no async header lookup)
035221| NOTE: Block comment line describing behavior or context.
035222| src/lib/logger.ts:341:    */
035223| NOTE: Block comment line describing behavior or context.
035224| src/lib/logger.ts:342:   sync: {
035225| NOTE: Implementation detail supporting search page behavior.
035226| src/lib/logger.ts:343:     debug: (message: string, meta?: Record<string, unknown>) =>
035227| NOTE: Implementation detail supporting search page behavior.
035228| src/lib/logger.ts:344:       logSync("debug", message, meta),
035229| NOTE: Implementation detail supporting search page behavior.
035230| src/lib/logger.ts:345:     info: (message: string, meta?: Record<string, unknown>) =>
035231| NOTE: Implementation detail supporting search page behavior.
035232| src/lib/logger.ts:346:       logSync("info", message, meta),
035233| NOTE: Implementation detail supporting search page behavior.
035234| src/lib/logger.ts:347:     warn: (message: string, meta?: Record<string, unknown>) =>
035235| NOTE: Implementation detail supporting search page behavior.
035236| src/lib/logger.ts:348:       logSync("warn", message, meta),
035237| NOTE: Implementation detail supporting search page behavior.
035238| src/lib/logger.ts:349:     error: (message: string, meta?: Record<string, unknown>) =>
035239| NOTE: Implementation detail supporting search page behavior.
035240| src/lib/logger.ts:350:       logSync("error", message, meta),
035241| NOTE: Implementation detail supporting search page behavior.
035242| src/lib/logger.ts:351:   },
035243| NOTE: Implementation detail supporting search page behavior.
035244| src/lib/logger.ts:352: 
035245| NOTE: Blank line for visual separation.
035246| src/lib/logger.ts:353:   /**
035247| NOTE: Block comment line describing behavior or context.
035248| src/lib/logger.ts:354:    * Create a child logger with preset metadata
035249| NOTE: Block comment line describing behavior or context.
035250| src/lib/logger.ts:355:    * Useful for adding context to all logs in a function
035251| NOTE: Block comment line describing behavior or context.
035252| src/lib/logger.ts:356:    */
035253| NOTE: Block comment line describing behavior or context.
035254| src/lib/logger.ts:357:   child: (defaultMeta: Record<string, unknown>) => ({
035255| NOTE: Implementation detail supporting search page behavior.
035256| src/lib/logger.ts:358:     debug: (message: string, meta?: Record<string, unknown>) =>
035257| NOTE: Implementation detail supporting search page behavior.
035258| src/lib/logger.ts:359:       log("debug", message, { ...defaultMeta, ...meta }),
035259| NOTE: Implementation detail supporting search page behavior.
035260| src/lib/logger.ts:360:     info: (message: string, meta?: Record<string, unknown>) =>
035261| NOTE: Implementation detail supporting search page behavior.
035262| src/lib/logger.ts:361:       log("info", message, { ...defaultMeta, ...meta }),
035263| NOTE: Implementation detail supporting search page behavior.
035264| src/lib/logger.ts:362:     warn: (message: string, meta?: Record<string, unknown>) =>
035265| NOTE: Implementation detail supporting search page behavior.
035266| src/lib/logger.ts:363:       log("warn", message, { ...defaultMeta, ...meta }),
035267| NOTE: Implementation detail supporting search page behavior.
035268| src/lib/logger.ts:364:     error: (message: string, meta?: Record<string, unknown>) =>
035269| NOTE: Implementation detail supporting search page behavior.
035270| src/lib/logger.ts:365:       log("error", message, { ...defaultMeta, ...meta }),
035271| NOTE: Implementation detail supporting search page behavior.
035272| src/lib/logger.ts:366:     sync: {
035273| NOTE: Implementation detail supporting search page behavior.
035274| src/lib/logger.ts:367:       debug: (message: string, meta?: Record<string, unknown>) =>
035275| NOTE: Implementation detail supporting search page behavior.
035276| src/lib/logger.ts:368:         logSync("debug", message, { ...defaultMeta, ...meta }),
035277| NOTE: Implementation detail supporting search page behavior.
035278| src/lib/logger.ts:369:       info: (message: string, meta?: Record<string, unknown>) =>
035279| NOTE: Implementation detail supporting search page behavior.
035280| src/lib/logger.ts:370:         logSync("info", message, { ...defaultMeta, ...meta }),
035281| NOTE: Implementation detail supporting search page behavior.
035282| src/lib/logger.ts:371:       warn: (message: string, meta?: Record<string, unknown>) =>
035283| NOTE: Implementation detail supporting search page behavior.
035284| src/lib/logger.ts:372:         logSync("warn", message, { ...defaultMeta, ...meta }),
035285| NOTE: Implementation detail supporting search page behavior.
035286| src/lib/logger.ts:373:       error: (message: string, meta?: Record<string, unknown>) =>
035287| NOTE: Implementation detail supporting search page behavior.
035288| src/lib/logger.ts:374:         logSync("error", message, { ...defaultMeta, ...meta }),
035289| NOTE: Implementation detail supporting search page behavior.
035290| src/lib/logger.ts:375:     },
035291| NOTE: Implementation detail supporting search page behavior.
035292| src/lib/logger.ts:376:   }),
035293| NOTE: Implementation detail supporting search page behavior.
035294| src/lib/logger.ts:377: };
035295| NOTE: Implementation detail supporting search page behavior.
035296| src/lib/logger.ts:378: 
035297| NOTE: Blank line for visual separation.
035298| src/lib/logger.ts:379: /**
035299| NOTE: Block comment line describing behavior or context.
035300| src/lib/logger.ts:380:  * Export redaction utility for use in other modules
035301| NOTE: Block comment line describing behavior or context.
035302| src/lib/logger.ts:381:  */
035303| NOTE: Block comment line describing behavior or context.
035304| src/lib/logger.ts:382: export { redactSensitive };
035305| NOTE: Implementation detail supporting search page behavior.
035306| FILE END: src/lib/logger.ts
035307| 
035308| FILE START: src/lib/mapbox-init.ts
035309| FILE ROLE: Auto-discovered dependency in search page graph.
035310| src/lib/mapbox-init.ts:1: import mapboxgl from "mapbox-gl";
035311| NOTE: Imports dependency for this module.
035312| src/lib/mapbox-init.ts:2: 
035313| NOTE: Blank line for visual separation.
035314| src/lib/mapbox-init.ts:3: /**
035315| NOTE: Block comment line describing behavior or context.
035316| src/lib/mapbox-init.ts:4:  * Mapbox GL Worker Initialization
035317| NOTE: Block comment line describing behavior or context.
035318| src/lib/mapbox-init.ts:5:  *
035319| NOTE: Block comment line describing behavior or context.
035320| src/lib/mapbox-init.ts:6:  * Sets the worker URL for CSP compliance. Must be same-origin (CORS restriction).
035321| NOTE: Block comment line describing behavior or context.
035322| src/lib/mapbox-init.ts:7:  * Worker file is copied from node_modules/mapbox-gl/dist/ to public/.
035323| NOTE: Block comment line describing behavior or context.
035324| src/lib/mapbox-init.ts:8:  *
035325| NOTE: Block comment line describing behavior or context.
035326| src/lib/mapbox-init.ts:9:  * Note: workerUrl exists at runtime but isn't in @types/mapbox-gl
035327| NOTE: Block comment line describing behavior or context.
035328| src/lib/mapbox-init.ts:10:  *
035329| NOTE: Block comment line describing behavior or context.
035330| src/lib/mapbox-init.ts:11:  * IMPORTANT: This must run before any map rendering to avoid
035331| NOTE: Block comment line describing behavior or context.
035332| src/lib/mapbox-init.ts:12:  * "Cannot read properties of undefined (reading 'send')" errors
035333| NOTE: Block comment line describing behavior or context.
035334| src/lib/mapbox-init.ts:13:  * that can occur during Turbopack HMR or initial page load.
035335| NOTE: Block comment line describing behavior or context.
035336| src/lib/mapbox-init.ts:14:  */
035337| NOTE: Block comment line describing behavior or context.
035338| src/lib/mapbox-init.ts:15: try {
035339| NOTE: Implementation detail supporting search page behavior.
035340| src/lib/mapbox-init.ts:16:   // Only set worker URL in browser environment
035341| NOTE: Line comment documents intent or constraints.
035342| src/lib/mapbox-init.ts:17:   if (typeof window !== "undefined") {
035343| NOTE: Conditional logic controlling rendering or flow.
035344| src/lib/mapbox-init.ts:18:     (mapboxgl as unknown as { workerUrl: string }).workerUrl =
035345| NOTE: Implementation detail supporting search page behavior.
035346| src/lib/mapbox-init.ts:19:       "/mapbox-gl-csp-worker.js";
035347| NOTE: Implementation detail supporting search page behavior.
035348| src/lib/mapbox-init.ts:20:   }
035349| NOTE: Implementation detail supporting search page behavior.
035350| src/lib/mapbox-init.ts:21: } catch (error) {
035351| NOTE: Implementation detail supporting search page behavior.
035352| src/lib/mapbox-init.ts:22:   // Log but don't crash - map may still work with default worker
035353| NOTE: Line comment documents intent or constraints.
035354| src/lib/mapbox-init.ts:23:   console.error("[MAPBOX] Failed to initialize worker URL:", error);
035355| NOTE: Implementation detail supporting search page behavior.
035356| src/lib/mapbox-init.ts:24: }
035357| NOTE: Implementation detail supporting search page behavior.
035358| src/lib/mapbox-init.ts:25: 
035359| NOTE: Blank line for visual separation.
035360| src/lib/mapbox-init.ts:26: export default mapboxgl;
035361| NOTE: Implementation detail supporting search page behavior.
035362| FILE END: src/lib/mapbox-init.ts
035363| 
035364| FILE START: src/lib/maps/marker-utils.ts
035365| FILE ROLE: Auto-discovered dependency in search page graph.
035366| src/lib/maps/marker-utils.ts:1: /**
035367| NOTE: Block comment line describing behavior or context.
035368| src/lib/maps/marker-utils.ts:2:  * Marker Utilities for Map Component
035369| NOTE: Block comment line describing behavior or context.
035370| src/lib/maps/marker-utils.ts:3:  *
035371| NOTE: Block comment line describing behavior or context.
035372| src/lib/maps/marker-utils.ts:4:  * Provides coordinate-based grouping for stacked markers and
035373| NOTE: Block comment line describing behavior or context.
035374| src/lib/maps/marker-utils.ts:5:  * price formatting for marker labels. Used by Map.tsx for
035375| NOTE: Block comment line describing behavior or context.
035376| src/lib/maps/marker-utils.ts:6:  * displaying multiple listings at the same location.
035377| NOTE: Block comment line describing behavior or context.
035378| src/lib/maps/marker-utils.ts:7:  */
035379| NOTE: Block comment line describing behavior or context.
035380| src/lib/maps/marker-utils.ts:8: 
035381| NOTE: Blank line for visual separation.
035382| src/lib/maps/marker-utils.ts:9: /** Coordinate precision for grouping (~1.1m at equator) */
035383| NOTE: Block comment line describing behavior or context.
035384| src/lib/maps/marker-utils.ts:10: export const COORD_PRECISION = 5;
035385| NOTE: Implementation detail supporting search page behavior.
035386| src/lib/maps/marker-utils.ts:11: 
035387| NOTE: Blank line for visual separation.
035388| src/lib/maps/marker-utils.ts:12: /**
035389| NOTE: Block comment line describing behavior or context.
035390| src/lib/maps/marker-utils.ts:13:  * Minimal listing interface for marker grouping
035391| NOTE: Block comment line describing behavior or context.
035392| src/lib/maps/marker-utils.ts:14:  * Matches the Listing interface used in Map.tsx
035393| NOTE: Block comment line describing behavior or context.
035394| src/lib/maps/marker-utils.ts:15:  */
035395| NOTE: Block comment line describing behavior or context.
035396| src/lib/maps/marker-utils.ts:16: export interface MapMarkerListing {
035397| NOTE: Implementation detail supporting search page behavior.
035398| src/lib/maps/marker-utils.ts:17:   id: string;
035399| NOTE: Implementation detail supporting search page behavior.
035400| src/lib/maps/marker-utils.ts:18:   title: string;
035401| NOTE: Implementation detail supporting search page behavior.
035402| src/lib/maps/marker-utils.ts:19:   price: number;
035403| NOTE: Implementation detail supporting search page behavior.
035404| src/lib/maps/marker-utils.ts:20:   availableSlots: number;
035405| NOTE: Implementation detail supporting search page behavior.
035406| src/lib/maps/marker-utils.ts:21:   ownerId?: string;
035407| NOTE: Implementation detail supporting search page behavior.
035408| src/lib/maps/marker-utils.ts:22:   images?: string[];
035409| NOTE: Implementation detail supporting search page behavior.
035410| src/lib/maps/marker-utils.ts:23:   location: {
035411| NOTE: Implementation detail supporting search page behavior.
035412| src/lib/maps/marker-utils.ts:24:     lat: number;
035413| NOTE: Implementation detail supporting search page behavior.
035414| src/lib/maps/marker-utils.ts:25:     lng: number;
035415| NOTE: Implementation detail supporting search page behavior.
035416| src/lib/maps/marker-utils.ts:26:   };
035417| NOTE: Implementation detail supporting search page behavior.
035418| src/lib/maps/marker-utils.ts:27: }
035419| NOTE: Implementation detail supporting search page behavior.
035420| src/lib/maps/marker-utils.ts:28: 
035421| NOTE: Blank line for visual separation.
035422| src/lib/maps/marker-utils.ts:29: /**
035423| NOTE: Block comment line describing behavior or context.
035424| src/lib/maps/marker-utils.ts:30:  * Group of listings at the same coordinate
035425| NOTE: Block comment line describing behavior or context.
035426| src/lib/maps/marker-utils.ts:31:  */
035427| NOTE: Block comment line describing behavior or context.
035428| src/lib/maps/marker-utils.ts:32: export interface ListingGroup {
035429| NOTE: Implementation detail supporting search page behavior.
035430| src/lib/maps/marker-utils.ts:33:   /** Unique key for React rendering */
035431| NOTE: Block comment line describing behavior or context.
035432| src/lib/maps/marker-utils.ts:34:   key: string;
035433| NOTE: Implementation detail supporting search page behavior.
035434| src/lib/maps/marker-utils.ts:35:   /** TRUE latitude (not offset) */
035435| NOTE: Block comment line describing behavior or context.
035436| src/lib/maps/marker-utils.ts:36:   lat: number;
035437| NOTE: Implementation detail supporting search page behavior.
035438| src/lib/maps/marker-utils.ts:37:   /** TRUE longitude (not offset) */
035439| NOTE: Block comment line describing behavior or context.
035440| src/lib/maps/marker-utils.ts:38:   lng: number;
035441| NOTE: Implementation detail supporting search page behavior.
035442| src/lib/maps/marker-utils.ts:39:   /** All listings at this coordinate */
035443| NOTE: Block comment line describing behavior or context.
035444| src/lib/maps/marker-utils.ts:40:   listings: MapMarkerListing[];
035445| NOTE: Implementation detail supporting search page behavior.
035446| src/lib/maps/marker-utils.ts:41: }
035447| NOTE: Implementation detail supporting search page behavior.
035448| src/lib/maps/marker-utils.ts:42: 
035449| NOTE: Blank line for visual separation.
035450| src/lib/maps/marker-utils.ts:43: /**
035451| NOTE: Block comment line describing behavior or context.
035452| src/lib/maps/marker-utils.ts:44:  * Groups listings by coordinate, keeping true position.
035453| NOTE: Block comment line describing behavior or context.
035454| src/lib/maps/marker-utils.ts:45:  * Uses coordinate precision to group nearby points (~1.1m at 5 decimals).
035455| NOTE: Block comment line describing behavior or context.
035456| src/lib/maps/marker-utils.ts:46:  *
035457| NOTE: Block comment line describing behavior or context.
035458| src/lib/maps/marker-utils.ts:47:  * @param listings - Array of listings to group
035459| NOTE: Block comment line describing behavior or context.
035460| src/lib/maps/marker-utils.ts:48:  * @param precision - Decimal places for coordinate comparison (default: 5)
035461| NOTE: Block comment line describing behavior or context.
035462| src/lib/maps/marker-utils.ts:49:  * @returns Array of listing groups at unique coordinates
035463| NOTE: Block comment line describing behavior or context.
035464| src/lib/maps/marker-utils.ts:50:  */
035465| NOTE: Block comment line describing behavior or context.
035466| src/lib/maps/marker-utils.ts:51: export function groupListingsByCoord(
035467| NOTE: Exports helper or component function.
035468| src/lib/maps/marker-utils.ts:52:   listings: MapMarkerListing[],
035469| NOTE: Implementation detail supporting search page behavior.
035470| src/lib/maps/marker-utils.ts:53:   precision = COORD_PRECISION,
035471| NOTE: Implementation detail supporting search page behavior.
035472| src/lib/maps/marker-utils.ts:54: ): ListingGroup[] {
035473| NOTE: Implementation detail supporting search page behavior.
035474| src/lib/maps/marker-utils.ts:55:   const groups = new Map<string, MapMarkerListing[]>();
035475| NOTE: Local declaration used by search logic or UI.
035476| src/lib/maps/marker-utils.ts:56: 
035477| NOTE: Blank line for visual separation.
035478| src/lib/maps/marker-utils.ts:57:   listings.forEach((listing) => {
035479| NOTE: Implementation detail supporting search page behavior.
035480| src/lib/maps/marker-utils.ts:58:     const key = `${listing.location.lat.toFixed(precision)},${listing.location.lng.toFixed(precision)}`;
035481| NOTE: Local declaration used by search logic or UI.
035482| src/lib/maps/marker-utils.ts:59:     if (!groups.has(key)) groups.set(key, []);
035483| NOTE: Conditional logic controlling rendering or flow.
035484| src/lib/maps/marker-utils.ts:60:     groups.get(key)!.push(listing);
035485| NOTE: Implementation detail supporting search page behavior.
035486| src/lib/maps/marker-utils.ts:61:   });
035487| NOTE: Implementation detail supporting search page behavior.
035488| src/lib/maps/marker-utils.ts:62: 
035489| NOTE: Blank line for visual separation.
035490| src/lib/maps/marker-utils.ts:63:   return Array.from(groups.entries()).map(([key, groupListings]) => ({
035491| NOTE: Return statement for component or helper output.
035492| src/lib/maps/marker-utils.ts:64:     key,
035493| NOTE: Implementation detail supporting search page behavior.
035494| src/lib/maps/marker-utils.ts:65:     lat: groupListings[0].location.lat, // TRUE coordinate
035495| NOTE: Implementation detail supporting search page behavior.
035496| src/lib/maps/marker-utils.ts:66:     lng: groupListings[0].location.lng, // TRUE coordinate
035497| NOTE: Implementation detail supporting search page behavior.
035498| src/lib/maps/marker-utils.ts:67:     listings: groupListings,
035499| NOTE: Implementation detail supporting search page behavior.
035500| src/lib/maps/marker-utils.ts:68:   }));
035501| NOTE: Implementation detail supporting search page behavior.
035502| src/lib/maps/marker-utils.ts:69: }
035503| NOTE: Implementation detail supporting search page behavior.
035504| src/lib/maps/marker-utils.ts:70: 
035505| NOTE: Blank line for visual separation.
035506| src/lib/maps/marker-utils.ts:71: /**
035507| NOTE: Block comment line describing behavior or context.
035508| src/lib/maps/marker-utils.ts:72:  * Formats price range for stacked markers.
035509| NOTE: Block comment line describing behavior or context.
035510| src/lib/maps/marker-utils.ts:73:  * Shows single price if all same, otherwise shows range.
035511| NOTE: Block comment line describing behavior or context.
035512| src/lib/maps/marker-utils.ts:74:  *
035513| NOTE: Block comment line describing behavior or context.
035514| src/lib/maps/marker-utils.ts:75:  * @param listings - Array of listings to format price for
035515| NOTE: Block comment line describing behavior or context.
035516| src/lib/maps/marker-utils.ts:76:  * @returns Formatted price string (e.g., "$1,200" or "$850\u2013$1,200")
035517| NOTE: Block comment line describing behavior or context.
035518| src/lib/maps/marker-utils.ts:77:  */
035519| NOTE: Block comment line describing behavior or context.
035520| src/lib/maps/marker-utils.ts:78: export function formatStackPriceRange(listings: MapMarkerListing[]): string {
035521| NOTE: Exports helper or component function.
035522| src/lib/maps/marker-utils.ts:79:   if (listings.length === 0) return "";
035523| NOTE: Conditional logic controlling rendering or flow.
035524| src/lib/maps/marker-utils.ts:80: 
035525| NOTE: Blank line for visual separation.
035526| src/lib/maps/marker-utils.ts:81:   const prices = listings.map((l) => l.price);
035527| NOTE: Local declaration used by search logic or UI.
035528| src/lib/maps/marker-utils.ts:82:   const min = Math.min(...prices);
035529| NOTE: Local declaration used by search logic or UI.
035530| src/lib/maps/marker-utils.ts:83:   const max = Math.max(...prices);
035531| NOTE: Local declaration used by search logic or UI.
035532| src/lib/maps/marker-utils.ts:84: 
035533| NOTE: Blank line for visual separation.
035534| src/lib/maps/marker-utils.ts:85:   const fmt = new Intl.NumberFormat("en-US", {
035535| NOTE: Local declaration used by search logic or UI.
035536| src/lib/maps/marker-utils.ts:86:     style: "currency",
035537| NOTE: Implementation detail supporting search page behavior.
035538| src/lib/maps/marker-utils.ts:87:     currency: "USD",
035539| NOTE: Implementation detail supporting search page behavior.
035540| src/lib/maps/marker-utils.ts:88:     maximumFractionDigits: 0,
035541| NOTE: Implementation detail supporting search page behavior.
035542| src/lib/maps/marker-utils.ts:89:   });
035543| NOTE: Implementation detail supporting search page behavior.
035544| src/lib/maps/marker-utils.ts:90: 
035545| NOTE: Blank line for visual separation.
035546| src/lib/maps/marker-utils.ts:91:   return min === max
035547| NOTE: Return statement for component or helper output.
035548| src/lib/maps/marker-utils.ts:92:     ? fmt.format(min)
035549| NOTE: Implementation detail supporting search page behavior.
035550| src/lib/maps/marker-utils.ts:93:     : `${fmt.format(min)}\u2013${fmt.format(max)}`;
035551| NOTE: Implementation detail supporting search page behavior.
035552| src/lib/maps/marker-utils.ts:94: }
035553| NOTE: Implementation detail supporting search page behavior.
035554| src/lib/maps/marker-utils.ts:95: 
035555| NOTE: Blank line for visual separation.
035556| src/lib/maps/marker-utils.ts:96: /**
035557| NOTE: Block comment line describing behavior or context.
035558| src/lib/maps/marker-utils.ts:97:  * Extended ListingGroup with tier classification for Airbnb-style pin tiering
035559| NOTE: Block comment line describing behavior or context.
035560| src/lib/maps/marker-utils.ts:98:  */
035561| NOTE: Block comment line describing behavior or context.
035562| src/lib/maps/marker-utils.ts:99: export interface TieredGroup extends ListingGroup {
035563| NOTE: Implementation detail supporting search page behavior.
035564| src/lib/maps/marker-utils.ts:100:   /** Best rank among listings (lower = better, 0 = highest priority) */
035565| NOTE: Block comment line describing behavior or context.
035566| src/lib/maps/marker-utils.ts:101:   groupRank: number;
035567| NOTE: Implementation detail supporting search page behavior.
035568| src/lib/maps/marker-utils.ts:102:   /** Pin type to render: primary (price pill) or mini (small dot) */
035569| NOTE: Block comment line describing behavior or context.
035570| src/lib/maps/marker-utils.ts:103:   tier: "primary" | "mini";
035571| NOTE: Implementation detail supporting search page behavior.
035572| src/lib/maps/marker-utils.ts:104: }
035573| NOTE: Implementation detail supporting search page behavior.
035574| src/lib/maps/marker-utils.ts:105: 
035575| NOTE: Blank line for visual separation.
035576| src/lib/maps/marker-utils.ts:106: /**
035577| NOTE: Block comment line describing behavior or context.
035578| src/lib/maps/marker-utils.ts:107:  * Default primary pin limit. Configurable via NEXT_PUBLIC_PRIMARY_PINS.
035579| NOTE: Block comment line describing behavior or context.
035580| src/lib/maps/marker-utils.ts:108:  * Clamped to 10-120 range for safety.
035581| NOTE: Block comment line describing behavior or context.
035582| src/lib/maps/marker-utils.ts:109:  */
035583| NOTE: Block comment line describing behavior or context.
035584| src/lib/maps/marker-utils.ts:110: export const DEFAULT_PRIMARY_LIMIT = 40;
035585| NOTE: Implementation detail supporting search page behavior.
035586| src/lib/maps/marker-utils.ts:111: export const MIN_PRIMARY_LIMIT = 10;
035587| NOTE: Implementation detail supporting search page behavior.
035588| src/lib/maps/marker-utils.ts:112: export const MAX_PRIMARY_LIMIT = 120;
035589| NOTE: Implementation detail supporting search page behavior.
035590| src/lib/maps/marker-utils.ts:113: 
035591| NOTE: Blank line for visual separation.
035592| src/lib/maps/marker-utils.ts:114: /**
035593| NOTE: Block comment line describing behavior or context.
035594| src/lib/maps/marker-utils.ts:115:  * Parse and clamp primary pin limit from env var.
035595| NOTE: Block comment line describing behavior or context.
035596| src/lib/maps/marker-utils.ts:116:  * Returns a value between MIN_PRIMARY_LIMIT and MAX_PRIMARY_LIMIT.
035597| NOTE: Block comment line describing behavior or context.
035598| src/lib/maps/marker-utils.ts:117:  */
035599| NOTE: Block comment line describing behavior or context.
035600| src/lib/maps/marker-utils.ts:118: export function getPrimaryPinLimit(): number {
035601| NOTE: Exports helper or component function.
035602| src/lib/maps/marker-utils.ts:119:   const envVal = process.env.NEXT_PUBLIC_PRIMARY_PINS;
035603| NOTE: Local declaration used by search logic or UI.
035604| src/lib/maps/marker-utils.ts:120:   if (!envVal) return DEFAULT_PRIMARY_LIMIT;
035605| NOTE: Conditional logic controlling rendering or flow.
035606| src/lib/maps/marker-utils.ts:121: 
035607| NOTE: Blank line for visual separation.
035608| src/lib/maps/marker-utils.ts:122:   const parsed = parseInt(envVal, 10);
035609| NOTE: Local declaration used by search logic or UI.
035610| src/lib/maps/marker-utils.ts:123:   if (isNaN(parsed)) return DEFAULT_PRIMARY_LIMIT;
035611| NOTE: Conditional logic controlling rendering or flow.
035612| src/lib/maps/marker-utils.ts:124: 
035613| NOTE: Blank line for visual separation.
035614| src/lib/maps/marker-utils.ts:125:   return Math.max(MIN_PRIMARY_LIMIT, Math.min(MAX_PRIMARY_LIMIT, parsed));
035615| NOTE: Return statement for component or helper output.
035616| src/lib/maps/marker-utils.ts:126: }
035617| NOTE: Implementation detail supporting search page behavior.
035618| src/lib/maps/marker-utils.ts:127: 
035619| NOTE: Blank line for visual separation.
035620| src/lib/maps/marker-utils.ts:128: /**
035621| NOTE: Block comment line describing behavior or context.
035622| src/lib/maps/marker-utils.ts:129:  * Build listingId \u2192 rank index map from listings array.
035623| NOTE: Block comment line describing behavior or context.
035624| src/lib/maps/marker-utils.ts:130:  * Rank is array index (0 = highest priority, based on API sort order).
035625| NOTE: Block comment line describing behavior or context.
035626| src/lib/maps/marker-utils.ts:131:  *
035627| NOTE: Block comment line describing behavior or context.
035628| src/lib/maps/marker-utils.ts:132:  * @param listings - Array of listings in rank order
035629| NOTE: Block comment line describing behavior or context.
035630| src/lib/maps/marker-utils.ts:133:  * @returns Map of listing ID to rank index
035631| NOTE: Block comment line describing behavior or context.
035632| src/lib/maps/marker-utils.ts:134:  */
035633| NOTE: Block comment line describing behavior or context.
035634| src/lib/maps/marker-utils.ts:135: export function buildRankMap(
035635| NOTE: Exports helper or component function.
035636| src/lib/maps/marker-utils.ts:136:   listings: MapMarkerListing[],
035637| NOTE: Implementation detail supporting search page behavior.
035638| src/lib/maps/marker-utils.ts:137: ): Map<string, number> {
035639| NOTE: Implementation detail supporting search page behavior.
035640| src/lib/maps/marker-utils.ts:138:   const map = new Map<string, number>();
035641| NOTE: Local declaration used by search logic or UI.
035642| src/lib/maps/marker-utils.ts:139:   listings.forEach((listing, index) => {
035643| NOTE: Implementation detail supporting search page behavior.
035644| src/lib/maps/marker-utils.ts:140:     map.set(listing.id, index);
035645| NOTE: Implementation detail supporting search page behavior.
035646| src/lib/maps/marker-utils.ts:141:   });
035647| NOTE: Implementation detail supporting search page behavior.
035648| src/lib/maps/marker-utils.ts:142:   return map;
035649| NOTE: Return statement for component or helper output.
035650| src/lib/maps/marker-utils.ts:143: }
035651| NOTE: Implementation detail supporting search page behavior.
035652| src/lib/maps/marker-utils.ts:144: 
035653| NOTE: Blank line for visual separation.
035654| src/lib/maps/marker-utils.ts:145: /**
035655| NOTE: Block comment line describing behavior or context.
035656| src/lib/maps/marker-utils.ts:146:  * Build listingId \u2192 rank index map from score map.
035657| NOTE: Block comment line describing behavior or context.
035658| src/lib/maps/marker-utils.ts:147:  * Converts scores to ranks (0 = best, higher = worse).
035659| NOTE: Block comment line describing behavior or context.
035660| src/lib/maps/marker-utils.ts:148:  * Falls back to position-based ranking if no scores provided.
035661| NOTE: Block comment line describing behavior or context.
035662| src/lib/maps/marker-utils.ts:149:  *
035663| NOTE: Block comment line describing behavior or context.
035664| src/lib/maps/marker-utils.ts:150:  * @param listings - Array of listings to rank
035665| NOTE: Block comment line describing behavior or context.
035666| src/lib/maps/marker-utils.ts:151:  * @param scoreMap - Optional map of listing ID to score (0-1, higher = better)
035667| NOTE: Block comment line describing behavior or context.
035668| src/lib/maps/marker-utils.ts:152:  * @returns Map of listing ID to rank index (lower = better)
035669| NOTE: Block comment line describing behavior or context.
035670| src/lib/maps/marker-utils.ts:153:  */
035671| NOTE: Block comment line describing behavior or context.
035672| src/lib/maps/marker-utils.ts:154: export function buildRankMapFromScores(
035673| NOTE: Exports helper or component function.
035674| src/lib/maps/marker-utils.ts:155:   listings: MapMarkerListing[],
035675| NOTE: Implementation detail supporting search page behavior.
035676| src/lib/maps/marker-utils.ts:156:   scoreMap?: Map<string, number>,
035677| NOTE: Implementation detail supporting search page behavior.
035678| src/lib/maps/marker-utils.ts:157: ): Map<string, number> {
035679| NOTE: Implementation detail supporting search page behavior.
035680| src/lib/maps/marker-utils.ts:158:   // Fallback to position-based ranking (current behavior)
035681| NOTE: Line comment documents intent or constraints.
035682| src/lib/maps/marker-utils.ts:159:   if (!scoreMap || scoreMap.size === 0) {
035683| NOTE: Conditional logic controlling rendering or flow.
035684| src/lib/maps/marker-utils.ts:160:     return buildRankMap(listings);
035685| NOTE: Return statement for component or helper output.
035686| src/lib/maps/marker-utils.ts:161:   }
035687| NOTE: Implementation detail supporting search page behavior.
035688| src/lib/maps/marker-utils.ts:162: 
035689| NOTE: Blank line for visual separation.
035690| src/lib/maps/marker-utils.ts:163:   // Sort listings by score descending, then by ID for determinism
035691| NOTE: Line comment documents intent or constraints.
035692| src/lib/maps/marker-utils.ts:164:   const sorted = [...listings].sort((a, b) => {
035693| NOTE: Local declaration used by search logic or UI.
035694| src/lib/maps/marker-utils.ts:165:     const scoreA = scoreMap.get(a.id) ?? 0;
035695| NOTE: Local declaration used by search logic or UI.
035696| src/lib/maps/marker-utils.ts:166:     const scoreB = scoreMap.get(b.id) ?? 0;
035697| NOTE: Local declaration used by search logic or UI.
035698| src/lib/maps/marker-utils.ts:167: 
035699| NOTE: Blank line for visual separation.
035700| src/lib/maps/marker-utils.ts:168:     // Higher score = better = lower rank
035701| NOTE: Line comment documents intent or constraints.
035702| src/lib/maps/marker-utils.ts:169:     if (scoreB !== scoreA) return scoreB - scoreA;
035703| NOTE: Conditional logic controlling rendering or flow.
035704| src/lib/maps/marker-utils.ts:170: 
035705| NOTE: Blank line for visual separation.
035706| src/lib/maps/marker-utils.ts:171:     // Stable tie-break by ID
035707| NOTE: Line comment documents intent or constraints.
035708| src/lib/maps/marker-utils.ts:172:     return a.id.localeCompare(b.id);
035709| NOTE: Return statement for component or helper output.
035710| src/lib/maps/marker-utils.ts:173:   });
035711| NOTE: Implementation detail supporting search page behavior.
035712| src/lib/maps/marker-utils.ts:174: 
035713| NOTE: Blank line for visual separation.
035714| src/lib/maps/marker-utils.ts:175:   // Build rank map from sorted order
035715| NOTE: Line comment documents intent or constraints.
035716| src/lib/maps/marker-utils.ts:176:   const rankMap = new Map<string, number>();
035717| NOTE: Local declaration used by search logic or UI.
035718| src/lib/maps/marker-utils.ts:177:   sorted.forEach((listing, index) => {
035719| NOTE: Implementation detail supporting search page behavior.
035720| src/lib/maps/marker-utils.ts:178:     rankMap.set(listing.id, index);
035721| NOTE: Implementation detail supporting search page behavior.
035722| src/lib/maps/marker-utils.ts:179:   });
035723| NOTE: Implementation detail supporting search page behavior.
035724| src/lib/maps/marker-utils.ts:180: 
035725| NOTE: Blank line for visual separation.
035726| src/lib/maps/marker-utils.ts:181:   return rankMap;
035727| NOTE: Return statement for component or helper output.
035728| src/lib/maps/marker-utils.ts:182: }
035729| NOTE: Implementation detail supporting search page behavior.
035730| src/lib/maps/marker-utils.ts:183: 
035731| NOTE: Blank line for visual separation.
035732| src/lib/maps/marker-utils.ts:184: /**
035733| NOTE: Block comment line describing behavior or context.
035734| src/lib/maps/marker-utils.ts:185:  * Compute tiered groups with primary/mini classification.
035735| NOTE: Block comment line describing behavior or context.
035736| src/lib/maps/marker-utils.ts:186:  * Groups are sorted by rank, listings within groups are also sorted.
035737| NOTE: Block comment line describing behavior or context.
035738| src/lib/maps/marker-utils.ts:187:  *
035739| NOTE: Block comment line describing behavior or context.
035740| src/lib/maps/marker-utils.ts:188:  * @param groups - Array of listing groups from groupListingsByCoord
035741| NOTE: Block comment line describing behavior or context.
035742| src/lib/maps/marker-utils.ts:189:  * @param rankMap - Map of listing ID to rank index
035743| NOTE: Block comment line describing behavior or context.
035744| src/lib/maps/marker-utils.ts:190:  * @param primaryLimit - Number of top groups to mark as primary
035745| NOTE: Block comment line describing behavior or context.
035746| src/lib/maps/marker-utils.ts:191:  * @returns Array of tiered groups sorted by rank
035747| NOTE: Block comment line describing behavior or context.
035748| src/lib/maps/marker-utils.ts:192:  */
035749| NOTE: Block comment line describing behavior or context.
035750| src/lib/maps/marker-utils.ts:193: export function computeTieredGroups(
035751| NOTE: Exports helper or component function.
035752| src/lib/maps/marker-utils.ts:194:   groups: ListingGroup[],
035753| NOTE: Implementation detail supporting search page behavior.
035754| src/lib/maps/marker-utils.ts:195:   rankMap: Map<string, number>,
035755| NOTE: Implementation detail supporting search page behavior.
035756| src/lib/maps/marker-utils.ts:196:   primaryLimit: number = DEFAULT_PRIMARY_LIMIT,
035757| NOTE: Implementation detail supporting search page behavior.
035758| src/lib/maps/marker-utils.ts:197: ): TieredGroup[] {
035759| NOTE: Implementation detail supporting search page behavior.
035760| src/lib/maps/marker-utils.ts:198:   // Clamp limit for safety
035761| NOTE: Line comment documents intent or constraints.
035762| src/lib/maps/marker-utils.ts:199:   const limit = Math.max(
035763| NOTE: Local declaration used by search logic or UI.
035764| src/lib/maps/marker-utils.ts:200:     MIN_PRIMARY_LIMIT,
035765| NOTE: Implementation detail supporting search page behavior.
035766| src/lib/maps/marker-utils.ts:201:     Math.min(MAX_PRIMARY_LIMIT, primaryLimit),
035767| NOTE: Implementation detail supporting search page behavior.
035768| src/lib/maps/marker-utils.ts:202:   );
035769| NOTE: Implementation detail supporting search page behavior.
035770| src/lib/maps/marker-utils.ts:203: 
035771| NOTE: Blank line for visual separation.
035772| src/lib/maps/marker-utils.ts:204:   const tieredGroups: TieredGroup[] = groups.map((group) => {
035773| NOTE: Local declaration used by search logic or UI.
035774| src/lib/maps/marker-utils.ts:205:     // Sort listings within group by rank (best first)
035775| NOTE: Line comment documents intent or constraints.
035776| src/lib/maps/marker-utils.ts:206:     const sortedListings = [...group.listings].sort((a, b) => {
035777| NOTE: Local declaration used by search logic or UI.
035778| src/lib/maps/marker-utils.ts:207:       const rankA = rankMap.get(a.id) ?? Infinity;
035779| NOTE: Local declaration used by search logic or UI.
035780| src/lib/maps/marker-utils.ts:208:       const rankB = rankMap.get(b.id) ?? Infinity;
035781| NOTE: Local declaration used by search logic or UI.
035782| src/lib/maps/marker-utils.ts:209:       return rankA - rankB;
035783| NOTE: Return statement for component or helper output.
035784| src/lib/maps/marker-utils.ts:210:     });
035785| NOTE: Implementation detail supporting search page behavior.
035786| src/lib/maps/marker-utils.ts:211: 
035787| NOTE: Blank line for visual separation.
035788| src/lib/maps/marker-utils.ts:212:     // Group rank = best (lowest) rank among its listings
035789| NOTE: Line comment documents intent or constraints.
035790| src/lib/maps/marker-utils.ts:213:     const groupRank = sortedListings.reduce((min, listing) => {
035791| NOTE: Local declaration used by search logic or UI.
035792| src/lib/maps/marker-utils.ts:214:       const rank = rankMap.get(listing.id) ?? Infinity;
035793| NOTE: Local declaration used by search logic or UI.
035794| src/lib/maps/marker-utils.ts:215:       return Math.min(min, rank);
035795| NOTE: Return statement for component or helper output.
035796| src/lib/maps/marker-utils.ts:216:     }, Infinity);
035797| NOTE: Implementation detail supporting search page behavior.
035798| src/lib/maps/marker-utils.ts:217: 
035799| NOTE: Blank line for visual separation.
035800| src/lib/maps/marker-utils.ts:218:     return {
035801| NOTE: Return statement for component or helper output.
035802| src/lib/maps/marker-utils.ts:219:       ...group,
035803| NOTE: Implementation detail supporting search page behavior.
035804| src/lib/maps/marker-utils.ts:220:       listings: sortedListings,
035805| NOTE: Implementation detail supporting search page behavior.
035806| src/lib/maps/marker-utils.ts:221:       groupRank,
035807| NOTE: Implementation detail supporting search page behavior.
035808| src/lib/maps/marker-utils.ts:222:       tier: "mini" as const, // Will be updated after sorting
035809| NOTE: Implementation detail supporting search page behavior.
035810| src/lib/maps/marker-utils.ts:223:     };
035811| NOTE: Implementation detail supporting search page behavior.
035812| src/lib/maps/marker-utils.ts:224:   });
035813| NOTE: Implementation detail supporting search page behavior.
035814| src/lib/maps/marker-utils.ts:225: 
035815| NOTE: Blank line for visual separation.
035816| src/lib/maps/marker-utils.ts:226:   // Sort groups by groupRank ascending (best first)
035817| NOTE: Line comment documents intent or constraints.
035818| src/lib/maps/marker-utils.ts:227:   tieredGroups.sort((a, b) => a.groupRank - b.groupRank);
035819| NOTE: Implementation detail supporting search page behavior.
035820| src/lib/maps/marker-utils.ts:228: 
035821| NOTE: Blank line for visual separation.
035822| src/lib/maps/marker-utils.ts:229:   // Mark top N as primary, rest as mini
035823| NOTE: Line comment documents intent or constraints.
035824| src/lib/maps/marker-utils.ts:230:   tieredGroups.forEach((group, index) => {
035825| NOTE: Implementation detail supporting search page behavior.
035826| src/lib/maps/marker-utils.ts:231:     group.tier = index < limit ? "primary" : "mini";
035827| NOTE: Implementation detail supporting search page behavior.
035828| src/lib/maps/marker-utils.ts:232:   });
035829| NOTE: Implementation detail supporting search page behavior.
035830| src/lib/maps/marker-utils.ts:233: 
035831| NOTE: Blank line for visual separation.
035832| src/lib/maps/marker-utils.ts:234:   return tieredGroups;
035833| NOTE: Return statement for component or helper output.
035834| src/lib/maps/marker-utils.ts:235: }
035835| NOTE: Implementation detail supporting search page behavior.
035836| src/lib/maps/marker-utils.ts:236: 
035837| NOTE: Blank line for visual separation.
035838| src/lib/maps/marker-utils.ts:237: /**
035839| NOTE: Block comment line describing behavior or context.
035840| src/lib/maps/marker-utils.ts:238:  * Get best listing from a group by rank.
035841| NOTE: Block comment line describing behavior or context.
035842| src/lib/maps/marker-utils.ts:239:  * Explicitly selects the listing with lowest rank (highest score).
035843| NOTE: Block comment line describing behavior or context.
035844| src/lib/maps/marker-utils.ts:240:  * Used for pin display to show the highest-priority listing.
035845| NOTE: Block comment line describing behavior or context.
035846| src/lib/maps/marker-utils.ts:241:  *
035847| NOTE: Block comment line describing behavior or context.
035848| src/lib/maps/marker-utils.ts:242:  * @param listings - Array of listings in the group
035849| NOTE: Block comment line describing behavior or context.
035850| src/lib/maps/marker-utils.ts:243:  * @param rankMap - Map of listing ID to rank (lower = better)
035851| NOTE: Block comment line describing behavior or context.
035852| src/lib/maps/marker-utils.ts:244:  * @returns Best listing in the group
035853| NOTE: Block comment line describing behavior or context.
035854| src/lib/maps/marker-utils.ts:245:  */
035855| NOTE: Block comment line describing behavior or context.
035856| src/lib/maps/marker-utils.ts:246: export function getBestListingInGroup(
035857| NOTE: Exports helper or component function.
035858| src/lib/maps/marker-utils.ts:247:   listings: MapMarkerListing[],
035859| NOTE: Implementation detail supporting search page behavior.
035860| src/lib/maps/marker-utils.ts:248:   rankMap: Map<string, number>,
035861| NOTE: Implementation detail supporting search page behavior.
035862| src/lib/maps/marker-utils.ts:249: ): MapMarkerListing {
035863| NOTE: Implementation detail supporting search page behavior.
035864| src/lib/maps/marker-utils.ts:250:   if (listings.length === 0) {
035865| NOTE: Conditional logic controlling rendering or flow.
035866| src/lib/maps/marker-utils.ts:251:     throw new Error("Cannot get best listing from empty group");
035867| NOTE: Implementation detail supporting search page behavior.
035868| src/lib/maps/marker-utils.ts:252:   }
035869| NOTE: Implementation detail supporting search page behavior.
035870| src/lib/maps/marker-utils.ts:253: 
035871| NOTE: Blank line for visual separation.
035872| src/lib/maps/marker-utils.ts:254:   if (listings.length === 1) {
035873| NOTE: Conditional logic controlling rendering or flow.
035874| src/lib/maps/marker-utils.ts:255:     return listings[0];
035875| NOTE: Return statement for component or helper output.
035876| src/lib/maps/marker-utils.ts:256:   }
035877| NOTE: Implementation detail supporting search page behavior.
035878| src/lib/maps/marker-utils.ts:257: 
035879| NOTE: Blank line for visual separation.
035880| src/lib/maps/marker-utils.ts:258:   return listings.reduce((best, current) => {
035881| NOTE: Return statement for component or helper output.
035882| src/lib/maps/marker-utils.ts:259:     const bestRank = rankMap.get(best.id) ?? Infinity;
035883| NOTE: Local declaration used by search logic or UI.
035884| src/lib/maps/marker-utils.ts:260:     const currentRank = rankMap.get(current.id) ?? Infinity;
035885| NOTE: Local declaration used by search logic or UI.
035886| src/lib/maps/marker-utils.ts:261:     return currentRank < bestRank ? current : best;
035887| NOTE: Return statement for component or helper output.
035888| src/lib/maps/marker-utils.ts:262:   });
035889| NOTE: Implementation detail supporting search page behavior.
035890| src/lib/maps/marker-utils.ts:263: }
035891| NOTE: Implementation detail supporting search page behavior.
035892| FILE END: src/lib/maps/marker-utils.ts
035893| 
035894| FILE START: src/lib/near-matches.ts
035895| FILE ROLE: Auto-discovered dependency in search page graph.
035896| src/lib/near-matches.ts:1: /**
035897| NOTE: Block comment line describing behavior or context.
035898| src/lib/near-matches.ts:2:  * Near-matches filter expansion logic.
035899| NOTE: Block comment line describing behavior or context.
035900| src/lib/near-matches.ts:3:  *
035901| NOTE: Block comment line describing behavior or context.
035902| src/lib/near-matches.ts:4:  * When search results are low (<5), this module provides logic to expand
035903| NOTE: Block comment line describing behavior or context.
035904| src/lib/near-matches.ts:5:  * filters slightly to find "near match" listings that almost meet criteria.
035905| NOTE: Block comment line describing behavior or context.
035906| src/lib/near-matches.ts:6:  *
035907| NOTE: Block comment line describing behavior or context.
035908| src/lib/near-matches.ts:7:  * Expansion strategy prioritizes:
035909| NOTE: Block comment line describing behavior or context.
035910| src/lib/near-matches.ts:8:  * 1. Price: +10% maxPrice, -10% minPrice
035911| NOTE: Block comment line describing behavior or context.
035912| src/lib/near-matches.ts:9:  * 2. Move-in date: \u00B17 days
035913| NOTE: Block comment line describing behavior or context.
035914| src/lib/near-matches.ts:10:  *
035915| NOTE: Block comment line describing behavior or context.
035916| src/lib/near-matches.ts:11:  * Only ONE dimension is expanded at a time to keep results relevant.
035917| NOTE: Block comment line describing behavior or context.
035918| src/lib/near-matches.ts:12:  */
035919| NOTE: Block comment line describing behavior or context.
035920| src/lib/near-matches.ts:13: 
035921| NOTE: Blank line for visual separation.
035922| src/lib/near-matches.ts:14: import type { FilterParams } from "./search-params";
035923| NOTE: Imports dependency for this module.
035924| src/lib/near-matches.ts:15: 
035925| NOTE: Blank line for visual separation.
035926| src/lib/near-matches.ts:16: /** Threshold below which we offer near-match expansion */
035927| NOTE: Block comment line describing behavior or context.
035928| src/lib/near-matches.ts:17: export const LOW_RESULTS_THRESHOLD = 5;
035929| NOTE: Implementation detail supporting search page behavior.
035930| src/lib/near-matches.ts:18: 
035931| NOTE: Blank line for visual separation.
035932| src/lib/near-matches.ts:19: /** Rules for expanding filters */
035933| NOTE: Block comment line describing behavior or context.
035934| src/lib/near-matches.ts:20: export const NEAR_MATCH_RULES = {
035935| NOTE: Implementation detail supporting search page behavior.
035936| src/lib/near-matches.ts:21:   price: {
035937| NOTE: Implementation detail supporting search page behavior.
035938| src/lib/near-matches.ts:22:     /** Percentage to expand price range by */
035939| NOTE: Block comment line describing behavior or context.
035940| src/lib/near-matches.ts:23:     expandPercent: 10,
035941| NOTE: Implementation detail supporting search page behavior.
035942| src/lib/near-matches.ts:24:   },
035943| NOTE: Implementation detail supporting search page behavior.
035944| src/lib/near-matches.ts:25:   date: {
035945| NOTE: Implementation detail supporting search page behavior.
035946| src/lib/near-matches.ts:26:     /** Days to expand move-in date by (\u00B1) */
035947| NOTE: Block comment line describing behavior or context.
035948| src/lib/near-matches.ts:27:     expandDays: 7,
035949| NOTE: Implementation detail supporting search page behavior.
035950| src/lib/near-matches.ts:28:   },
035951| NOTE: Implementation detail supporting search page behavior.
035952| src/lib/near-matches.ts:29: } as const;
035953| NOTE: Implementation detail supporting search page behavior.
035954| src/lib/near-matches.ts:30: 
035955| NOTE: Blank line for visual separation.
035956| src/lib/near-matches.ts:31: /**
035957| NOTE: Block comment line describing behavior or context.
035958| src/lib/near-matches.ts:32:  * Result of expanding filters for near matches.
035959| NOTE: Block comment line describing behavior or context.
035960| src/lib/near-matches.ts:33:  */
035961| NOTE: Block comment line describing behavior or context.
035962| src/lib/near-matches.ts:34: export interface NearMatchExpansion {
035963| NOTE: Implementation detail supporting search page behavior.
035964| src/lib/near-matches.ts:35:   /** The expanded filter params */
035965| NOTE: Block comment line describing behavior or context.
035966| src/lib/near-matches.ts:36:   expanded: FilterParams;
035967| NOTE: Implementation detail supporting search page behavior.
035968| src/lib/near-matches.ts:37:   /** Which dimension was expanded */
035969| NOTE: Block comment line describing behavior or context.
035970| src/lib/near-matches.ts:38:   expandedDimension: "price" | "date" | null;
035971| NOTE: Implementation detail supporting search page behavior.
035972| src/lib/near-matches.ts:39:   /** Human-readable description of the expansion */
035973| NOTE: Block comment line describing behavior or context.
035974| src/lib/near-matches.ts:40:   expansionDescription: string | null;
035975| NOTE: Implementation detail supporting search page behavior.
035976| src/lib/near-matches.ts:41: }
035977| NOTE: Implementation detail supporting search page behavior.
035978| src/lib/near-matches.ts:42: 
035979| NOTE: Blank line for visual separation.
035980| src/lib/near-matches.ts:43: /**
035981| NOTE: Block comment line describing behavior or context.
035982| src/lib/near-matches.ts:44:  * Expand filters to find near-match listings.
035983| NOTE: Block comment line describing behavior or context.
035984| src/lib/near-matches.ts:45:  *
035985| NOTE: Block comment line describing behavior or context.
035986| src/lib/near-matches.ts:46:  * Priority:
035987| NOTE: Block comment line describing behavior or context.
035988| src/lib/near-matches.ts:47:  * 1. If price filters are set, expand price range by \u00B110%
035989| NOTE: Block comment line describing behavior or context.
035990| src/lib/near-matches.ts:48:  * 2. If move-in date is set, expand date range by \u00B17 days
035991| NOTE: Block comment line describing behavior or context.
035992| src/lib/near-matches.ts:49:  *
035993| NOTE: Block comment line describing behavior or context.
035994| src/lib/near-matches.ts:50:  * Only expands ONE dimension to keep results relevant.
035995| NOTE: Block comment line describing behavior or context.
035996| src/lib/near-matches.ts:51:  *
035997| NOTE: Block comment line describing behavior or context.
035998| src/lib/near-matches.ts:52:  * @param params - Original filter parameters
035999| NOTE: Block comment line describing behavior or context.
036000| src/lib/near-matches.ts:53:  * @returns Expanded filter params with metadata about what was expanded
036001| NOTE: Block comment line describing behavior or context.
036002| src/lib/near-matches.ts:54:  */
036003| NOTE: Block comment line describing behavior or context.
036004| src/lib/near-matches.ts:55: export function expandFiltersForNearMatches(
036005| NOTE: Exports helper or component function.
036006| src/lib/near-matches.ts:56:   params: FilterParams,
036007| NOTE: Implementation detail supporting search page behavior.
036008| src/lib/near-matches.ts:57: ): NearMatchExpansion {
036009| NOTE: Implementation detail supporting search page behavior.
036010| src/lib/near-matches.ts:58:   // Check if price filters can be expanded
036011| NOTE: Line comment documents intent or constraints.
036012| src/lib/near-matches.ts:59:   if (params.minPrice !== undefined || params.maxPrice !== undefined) {
036013| NOTE: Conditional logic controlling rendering or flow.
036014| src/lib/near-matches.ts:60:     const { expandPercent } = NEAR_MATCH_RULES.price;
036015| NOTE: Local declaration used by search logic or UI.
036016| src/lib/near-matches.ts:61:     const multiplier = expandPercent / 100;
036017| NOTE: Local declaration used by search logic or UI.
036018| src/lib/near-matches.ts:62: 
036019| NOTE: Blank line for visual separation.
036020| src/lib/near-matches.ts:63:     const expanded: FilterParams = { ...params };
036021| NOTE: Local declaration used by search logic or UI.
036022| src/lib/near-matches.ts:64: 
036023| NOTE: Blank line for visual separation.
036024| src/lib/near-matches.ts:65:     // Expand minPrice down by percentage
036025| NOTE: Line comment documents intent or constraints.
036026| src/lib/near-matches.ts:66:     if (params.minPrice !== undefined && params.minPrice > 0) {
036027| NOTE: Conditional logic controlling rendering or flow.
036028| src/lib/near-matches.ts:67:       expanded.minPrice = Math.floor(params.minPrice * (1 - multiplier));
036029| NOTE: Implementation detail supporting search page behavior.
036030| src/lib/near-matches.ts:68:     }
036031| NOTE: Implementation detail supporting search page behavior.
036032| src/lib/near-matches.ts:69: 
036033| NOTE: Blank line for visual separation.
036034| src/lib/near-matches.ts:70:     // Expand maxPrice up by percentage
036035| NOTE: Line comment documents intent or constraints.
036036| src/lib/near-matches.ts:71:     if (params.maxPrice !== undefined) {
036037| NOTE: Conditional logic controlling rendering or flow.
036038| src/lib/near-matches.ts:72:       expanded.maxPrice = Math.ceil(params.maxPrice * (1 + multiplier));
036039| NOTE: Implementation detail supporting search page behavior.
036040| src/lib/near-matches.ts:73:     }
036041| NOTE: Implementation detail supporting search page behavior.
036042| src/lib/near-matches.ts:74: 
036043| NOTE: Blank line for visual separation.
036044| src/lib/near-matches.ts:75:     const parts: string[] = [];
036045| NOTE: Local declaration used by search logic or UI.
036046| src/lib/near-matches.ts:76:     if (
036047| NOTE: Conditional logic controlling rendering or flow.
036048| src/lib/near-matches.ts:77:       params.minPrice !== undefined &&
036049| NOTE: Implementation detail supporting search page behavior.
036050| src/lib/near-matches.ts:78:       expanded.minPrice !== params.minPrice
036051| NOTE: Implementation detail supporting search page behavior.
036052| src/lib/near-matches.ts:79:     ) {
036053| NOTE: Implementation detail supporting search page behavior.
036054| src/lib/near-matches.ts:80:       parts.push(`min $${expanded.minPrice}`);
036055| NOTE: Implementation detail supporting search page behavior.
036056| src/lib/near-matches.ts:81:     }
036057| NOTE: Implementation detail supporting search page behavior.
036058| src/lib/near-matches.ts:82:     if (
036059| NOTE: Conditional logic controlling rendering or flow.
036060| src/lib/near-matches.ts:83:       params.maxPrice !== undefined &&
036061| NOTE: Implementation detail supporting search page behavior.
036062| src/lib/near-matches.ts:84:       expanded.maxPrice !== params.maxPrice
036063| NOTE: Implementation detail supporting search page behavior.
036064| src/lib/near-matches.ts:85:     ) {
036065| NOTE: Implementation detail supporting search page behavior.
036066| src/lib/near-matches.ts:86:       parts.push(`max $${expanded.maxPrice}`);
036067| NOTE: Implementation detail supporting search page behavior.
036068| src/lib/near-matches.ts:87:     }
036069| NOTE: Implementation detail supporting search page behavior.
036070| src/lib/near-matches.ts:88: 
036071| NOTE: Blank line for visual separation.
036072| src/lib/near-matches.ts:89:     return {
036073| NOTE: Return statement for component or helper output.
036074| src/lib/near-matches.ts:90:       expanded,
036075| NOTE: Implementation detail supporting search page behavior.
036076| src/lib/near-matches.ts:91:       expandedDimension: "price",
036077| NOTE: Implementation detail supporting search page behavior.
036078| src/lib/near-matches.ts:92:       expansionDescription:
036079| NOTE: Implementation detail supporting search page behavior.
036080| src/lib/near-matches.ts:93:         parts.length > 0 ? `Price range expanded to ${parts.join(", ")}` : null,
036081| NOTE: Implementation detail supporting search page behavior.
036082| src/lib/near-matches.ts:94:     };
036083| NOTE: Implementation detail supporting search page behavior.
036084| src/lib/near-matches.ts:95:   }
036085| NOTE: Implementation detail supporting search page behavior.
036086| src/lib/near-matches.ts:96: 
036087| NOTE: Blank line for visual separation.
036088| src/lib/near-matches.ts:97:   // Check if move-in date can be expanded
036089| NOTE: Line comment documents intent or constraints.
036090| src/lib/near-matches.ts:98:   if (params.moveInDate) {
036091| NOTE: Conditional logic controlling rendering or flow.
036092| src/lib/near-matches.ts:99:     const { expandDays } = NEAR_MATCH_RULES.date;
036093| NOTE: Local declaration used by search logic or UI.
036094| src/lib/near-matches.ts:100:     const originalDate = new Date(params.moveInDate);
036095| NOTE: Local declaration used by search logic or UI.
036096| src/lib/near-matches.ts:101: 
036097| NOTE: Blank line for visual separation.
036098| src/lib/near-matches.ts:102:     // Expand by moving the date back by expandDays
036099| NOTE: Line comment documents intent or constraints.
036100| src/lib/near-matches.ts:103:     // (allows listings available slightly later than requested)
036101| NOTE: Line comment documents intent or constraints.
036102| src/lib/near-matches.ts:104:     const expandedDate = new Date(originalDate);
036103| NOTE: Local declaration used by search logic or UI.
036104| src/lib/near-matches.ts:105:     expandedDate.setDate(expandedDate.getDate() - expandDays);
036105| NOTE: Implementation detail supporting search page behavior.
036106| src/lib/near-matches.ts:106: 
036107| NOTE: Blank line for visual separation.
036108| src/lib/near-matches.ts:107:     // Don't expand to dates in the past
036109| NOTE: Line comment documents intent or constraints.
036110| src/lib/near-matches.ts:108:     const today = new Date();
036111| NOTE: Local declaration used by search logic or UI.
036112| src/lib/near-matches.ts:109:     today.setHours(0, 0, 0, 0);
036113| NOTE: Implementation detail supporting search page behavior.
036114| src/lib/near-matches.ts:110:     if (expandedDate < today) {
036115| NOTE: Conditional logic controlling rendering or flow.
036116| src/lib/near-matches.ts:111:       expandedDate.setTime(today.getTime());
036117| NOTE: Implementation detail supporting search page behavior.
036118| src/lib/near-matches.ts:112:     }
036119| NOTE: Implementation detail supporting search page behavior.
036120| src/lib/near-matches.ts:113: 
036121| NOTE: Blank line for visual separation.
036122| src/lib/near-matches.ts:114:     const expandedDateStr = expandedDate.toISOString().split("T")[0];
036123| NOTE: Local declaration used by search logic or UI.
036124| src/lib/near-matches.ts:115: 
036125| NOTE: Blank line for visual separation.
036126| src/lib/near-matches.ts:116:     // Only expand if the new date is different
036127| NOTE: Line comment documents intent or constraints.
036128| src/lib/near-matches.ts:117:     if (expandedDateStr !== params.moveInDate) {
036129| NOTE: Conditional logic controlling rendering or flow.
036130| src/lib/near-matches.ts:118:       const expanded: FilterParams = {
036131| NOTE: Local declaration used by search logic or UI.
036132| src/lib/near-matches.ts:119:         ...params,
036133| NOTE: Implementation detail supporting search page behavior.
036134| src/lib/near-matches.ts:120:         moveInDate: expandedDateStr,
036135| NOTE: Implementation detail supporting search page behavior.
036136| src/lib/near-matches.ts:121:       };
036137| NOTE: Implementation detail supporting search page behavior.
036138| src/lib/near-matches.ts:122: 
036139| NOTE: Blank line for visual separation.
036140| src/lib/near-matches.ts:123:       return {
036141| NOTE: Return statement for component or helper output.
036142| src/lib/near-matches.ts:124:         expanded,
036143| NOTE: Implementation detail supporting search page behavior.
036144| src/lib/near-matches.ts:125:         expandedDimension: "date",
036145| NOTE: Implementation detail supporting search page behavior.
036146| src/lib/near-matches.ts:126:         expansionDescription: `Move-in date expanded to ${formatDate(expandedDateStr)}`,
036147| NOTE: Implementation detail supporting search page behavior.
036148| src/lib/near-matches.ts:127:       };
036149| NOTE: Implementation detail supporting search page behavior.
036150| src/lib/near-matches.ts:128:     }
036151| NOTE: Implementation detail supporting search page behavior.
036152| src/lib/near-matches.ts:129:   }
036153| NOTE: Implementation detail supporting search page behavior.
036154| src/lib/near-matches.ts:130: 
036155| NOTE: Blank line for visual separation.
036156| src/lib/near-matches.ts:131:   // No expansion possible
036157| NOTE: Line comment documents intent or constraints.
036158| src/lib/near-matches.ts:132:   return {
036159| NOTE: Return statement for component or helper output.
036160| src/lib/near-matches.ts:133:     expanded: params,
036161| NOTE: Implementation detail supporting search page behavior.
036162| src/lib/near-matches.ts:134:     expandedDimension: null,
036163| NOTE: Implementation detail supporting search page behavior.
036164| src/lib/near-matches.ts:135:     expansionDescription: null,
036165| NOTE: Implementation detail supporting search page behavior.
036166| src/lib/near-matches.ts:136:   };
036167| NOTE: Implementation detail supporting search page behavior.
036168| src/lib/near-matches.ts:137: }
036169| NOTE: Implementation detail supporting search page behavior.
036170| src/lib/near-matches.ts:138: 
036171| NOTE: Blank line for visual separation.
036172| src/lib/near-matches.ts:139: /**
036173| NOTE: Block comment line describing behavior or context.
036174| src/lib/near-matches.ts:140:  * Check if a listing is a "near match" (matched expanded but not original filters).
036175| NOTE: Block comment line describing behavior or context.
036176| src/lib/near-matches.ts:141:  *
036177| NOTE: Block comment line describing behavior or context.
036178| src/lib/near-matches.ts:142:  * This is used to tag listings that came from the expanded query but wouldn't
036179| NOTE: Block comment line describing behavior or context.
036180| src/lib/near-matches.ts:143:  * have matched the original strict filters.
036181| NOTE: Block comment line describing behavior or context.
036182| src/lib/near-matches.ts:144:  *
036183| NOTE: Block comment line describing behavior or context.
036184| src/lib/near-matches.ts:145:  * @param listing - The listing to check
036185| NOTE: Block comment line describing behavior or context.
036186| src/lib/near-matches.ts:146:  * @param originalParams - Original filter parameters
036187| NOTE: Block comment line describing behavior or context.
036188| src/lib/near-matches.ts:147:  * @param expandedDimension - Which dimension was expanded
036189| NOTE: Block comment line describing behavior or context.
036190| src/lib/near-matches.ts:148:  * @returns true if the listing is a near match (not an exact match)
036191| NOTE: Block comment line describing behavior or context.
036192| src/lib/near-matches.ts:149:  */
036193| NOTE: Block comment line describing behavior or context.
036194| src/lib/near-matches.ts:150: export function isNearMatch(
036195| NOTE: Exports helper or component function.
036196| src/lib/near-matches.ts:151:   listing: { price: number; available_from?: string | null },
036197| NOTE: Implementation detail supporting search page behavior.
036198| src/lib/near-matches.ts:152:   originalParams: FilterParams,
036199| NOTE: Implementation detail supporting search page behavior.
036200| src/lib/near-matches.ts:153:   expandedDimension: "price" | "date" | null,
036201| NOTE: Implementation detail supporting search page behavior.
036202| src/lib/near-matches.ts:154: ): boolean {
036203| NOTE: Implementation detail supporting search page behavior.
036204| src/lib/near-matches.ts:155:   if (expandedDimension === null) {
036205| NOTE: Conditional logic controlling rendering or flow.
036206| src/lib/near-matches.ts:156:     return false;
036207| NOTE: Return statement for component or helper output.
036208| src/lib/near-matches.ts:157:   }
036209| NOTE: Implementation detail supporting search page behavior.
036210| src/lib/near-matches.ts:158: 
036211| NOTE: Blank line for visual separation.
036212| src/lib/near-matches.ts:159:   if (expandedDimension === "price") {
036213| NOTE: Conditional logic controlling rendering or flow.
036214| src/lib/near-matches.ts:160:     // Check if listing price is outside original range
036215| NOTE: Line comment documents intent or constraints.
036216| src/lib/near-matches.ts:161:     if (
036217| NOTE: Conditional logic controlling rendering or flow.
036218| src/lib/near-matches.ts:162:       originalParams.minPrice !== undefined &&
036219| NOTE: Implementation detail supporting search page behavior.
036220| src/lib/near-matches.ts:163:       listing.price < originalParams.minPrice
036221| NOTE: Implementation detail supporting search page behavior.
036222| src/lib/near-matches.ts:164:     ) {
036223| NOTE: Implementation detail supporting search page behavior.
036224| src/lib/near-matches.ts:165:       return true;
036225| NOTE: Return statement for component or helper output.
036226| src/lib/near-matches.ts:166:     }
036227| NOTE: Implementation detail supporting search page behavior.
036228| src/lib/near-matches.ts:167:     if (
036229| NOTE: Conditional logic controlling rendering or flow.
036230| src/lib/near-matches.ts:168:       originalParams.maxPrice !== undefined &&
036231| NOTE: Implementation detail supporting search page behavior.
036232| src/lib/near-matches.ts:169:       listing.price > originalParams.maxPrice
036233| NOTE: Implementation detail supporting search page behavior.
036234| src/lib/near-matches.ts:170:     ) {
036235| NOTE: Implementation detail supporting search page behavior.
036236| src/lib/near-matches.ts:171:       return true;
036237| NOTE: Return statement for component or helper output.
036238| src/lib/near-matches.ts:172:     }
036239| NOTE: Implementation detail supporting search page behavior.
036240| src/lib/near-matches.ts:173:     return false;
036241| NOTE: Return statement for component or helper output.
036242| src/lib/near-matches.ts:174:   }
036243| NOTE: Implementation detail supporting search page behavior.
036244| src/lib/near-matches.ts:175: 
036245| NOTE: Blank line for visual separation.
036246| src/lib/near-matches.ts:176:   if (expandedDimension === "date") {
036247| NOTE: Conditional logic controlling rendering or flow.
036248| src/lib/near-matches.ts:177:     // Check if listing available_from is after original move-in date
036249| NOTE: Line comment documents intent or constraints.
036250| src/lib/near-matches.ts:178:     if (
036251| NOTE: Conditional logic controlling rendering or flow.
036252| src/lib/near-matches.ts:179:       originalParams.moveInDate &&
036253| NOTE: Implementation detail supporting search page behavior.
036254| src/lib/near-matches.ts:180:       listing.available_from &&
036255| NOTE: Implementation detail supporting search page behavior.
036256| src/lib/near-matches.ts:181:       listing.available_from > originalParams.moveInDate
036257| NOTE: Implementation detail supporting search page behavior.
036258| src/lib/near-matches.ts:182:     ) {
036259| NOTE: Implementation detail supporting search page behavior.
036260| src/lib/near-matches.ts:183:       return true;
036261| NOTE: Return statement for component or helper output.
036262| src/lib/near-matches.ts:184:     }
036263| NOTE: Implementation detail supporting search page behavior.
036264| src/lib/near-matches.ts:185:     return false;
036265| NOTE: Return statement for component or helper output.
036266| src/lib/near-matches.ts:186:   }
036267| NOTE: Implementation detail supporting search page behavior.
036268| src/lib/near-matches.ts:187: 
036269| NOTE: Blank line for visual separation.
036270| src/lib/near-matches.ts:188:   return false;
036271| NOTE: Return statement for component or helper output.
036272| src/lib/near-matches.ts:189: }
036273| NOTE: Implementation detail supporting search page behavior.
036274| src/lib/near-matches.ts:190: 
036275| NOTE: Blank line for visual separation.
036276| src/lib/near-matches.ts:191: /**
036277| NOTE: Block comment line describing behavior or context.
036278| src/lib/near-matches.ts:192:  * Generate filter suggestions for low results.
036279| NOTE: Block comment line describing behavior or context.
036280| src/lib/near-matches.ts:193:  *
036281| NOTE: Block comment line describing behavior or context.
036282| src/lib/near-matches.ts:194:  * Returns ranked suggestions for which filters to relax.
036283| NOTE: Block comment line describing behavior or context.
036284| src/lib/near-matches.ts:195:  *
036285| NOTE: Block comment line describing behavior or context.
036286| src/lib/near-matches.ts:196:  * @param params - Current filter parameters
036287| NOTE: Block comment line describing behavior or context.
036288| src/lib/near-matches.ts:197:  * @param resultCount - Number of results with current filters
036289| NOTE: Block comment line describing behavior or context.
036290| src/lib/near-matches.ts:198:  * @returns Array of suggestions with priority order
036291| NOTE: Block comment line describing behavior or context.
036292| src/lib/near-matches.ts:199:  */
036293| NOTE: Block comment line describing behavior or context.
036294| src/lib/near-matches.ts:200: export interface FilterSuggestion {
036295| NOTE: Implementation detail supporting search page behavior.
036296| src/lib/near-matches.ts:201:   /** Type of filter to adjust */
036297| NOTE: Block comment line describing behavior or context.
036298| src/lib/near-matches.ts:202:   type: "price" | "date" | "roomType" | "amenities" | "leaseDuration";
036299| NOTE: Implementation detail supporting search page behavior.
036300| src/lib/near-matches.ts:203:   /** Human-readable suggestion */
036301| NOTE: Block comment line describing behavior or context.
036302| src/lib/near-matches.ts:204:   label: string;
036303| NOTE: Implementation detail supporting search page behavior.
036304| src/lib/near-matches.ts:205:   /** Priority (lower = higher priority) */
036305| NOTE: Block comment line describing behavior or context.
036306| src/lib/near-matches.ts:206:   priority: number;
036307| NOTE: Implementation detail supporting search page behavior.
036308| src/lib/near-matches.ts:207: }
036309| NOTE: Implementation detail supporting search page behavior.
036310| src/lib/near-matches.ts:208: 
036311| NOTE: Blank line for visual separation.
036312| src/lib/near-matches.ts:209: export function generateFilterSuggestions(
036313| NOTE: Exports helper or component function.
036314| src/lib/near-matches.ts:210:   params: FilterParams,
036315| NOTE: Implementation detail supporting search page behavior.
036316| src/lib/near-matches.ts:211:   _resultCount: number,
036317| NOTE: Implementation detail supporting search page behavior.
036318| src/lib/near-matches.ts:212: ): FilterSuggestion[] {
036319| NOTE: Implementation detail supporting search page behavior.
036320| src/lib/near-matches.ts:213:   const suggestions: FilterSuggestion[] = [];
036321| NOTE: Local declaration used by search logic or UI.
036322| src/lib/near-matches.ts:214: 
036323| NOTE: Blank line for visual separation.
036324| src/lib/near-matches.ts:215:   // Price is highest priority - often the most restrictive filter
036325| NOTE: Line comment documents intent or constraints.
036326| src/lib/near-matches.ts:216:   if (params.minPrice !== undefined || params.maxPrice !== undefined) {
036327| NOTE: Conditional logic controlling rendering or flow.
036328| src/lib/near-matches.ts:217:     if (params.minPrice !== undefined && params.maxPrice !== undefined) {
036329| NOTE: Conditional logic controlling rendering or flow.
036330| src/lib/near-matches.ts:218:       suggestions.push({
036331| NOTE: Implementation detail supporting search page behavior.
036332| src/lib/near-matches.ts:219:         type: "price",
036333| NOTE: Implementation detail supporting search page behavior.
036334| src/lib/near-matches.ts:220:         label: `Expand price range ($${params.minPrice} - $${params.maxPrice})`,
036335| NOTE: Implementation detail supporting search page behavior.
036336| src/lib/near-matches.ts:221:         priority: 1,
036337| NOTE: Implementation detail supporting search page behavior.
036338| src/lib/near-matches.ts:222:       });
036339| NOTE: Implementation detail supporting search page behavior.
036340| src/lib/near-matches.ts:223:     } else if (params.maxPrice !== undefined) {
036341| NOTE: Implementation detail supporting search page behavior.
036342| src/lib/near-matches.ts:224:       suggestions.push({
036343| NOTE: Implementation detail supporting search page behavior.
036344| src/lib/near-matches.ts:225:         type: "price",
036345| NOTE: Implementation detail supporting search page behavior.
036346| src/lib/near-matches.ts:226:         label: `Increase max price ($${params.maxPrice})`,
036347| NOTE: Implementation detail supporting search page behavior.
036348| src/lib/near-matches.ts:227:         priority: 1,
036349| NOTE: Implementation detail supporting search page behavior.
036350| src/lib/near-matches.ts:228:       });
036351| NOTE: Implementation detail supporting search page behavior.
036352| src/lib/near-matches.ts:229:     } else if (params.minPrice !== undefined) {
036353| NOTE: Implementation detail supporting search page behavior.
036354| src/lib/near-matches.ts:230:       suggestions.push({
036355| NOTE: Implementation detail supporting search page behavior.
036356| src/lib/near-matches.ts:231:         type: "price",
036357| NOTE: Implementation detail supporting search page behavior.
036358| src/lib/near-matches.ts:232:         label: `Lower min price ($${params.minPrice})`,
036359| NOTE: Implementation detail supporting search page behavior.
036360| src/lib/near-matches.ts:233:         priority: 1,
036361| NOTE: Implementation detail supporting search page behavior.
036362| src/lib/near-matches.ts:234:       });
036363| NOTE: Implementation detail supporting search page behavior.
036364| src/lib/near-matches.ts:235:     }
036365| NOTE: Implementation detail supporting search page behavior.
036366| src/lib/near-matches.ts:236:   }
036367| NOTE: Implementation detail supporting search page behavior.
036368| src/lib/near-matches.ts:237: 
036369| NOTE: Blank line for visual separation.
036370| src/lib/near-matches.ts:238:   // Move-in date is second priority
036371| NOTE: Line comment documents intent or constraints.
036372| src/lib/near-matches.ts:239:   if (params.moveInDate) {
036373| NOTE: Conditional logic controlling rendering or flow.
036374| src/lib/near-matches.ts:240:     suggestions.push({
036375| NOTE: Implementation detail supporting search page behavior.
036376| src/lib/near-matches.ts:241:       type: "date",
036377| NOTE: Implementation detail supporting search page behavior.
036378| src/lib/near-matches.ts:242:       label: `Flexible on move-in date (${formatDate(params.moveInDate)})`,
036379| NOTE: Implementation detail supporting search page behavior.
036380| src/lib/near-matches.ts:243:       priority: 2,
036381| NOTE: Implementation detail supporting search page behavior.
036382| src/lib/near-matches.ts:244:     });
036383| NOTE: Implementation detail supporting search page behavior.
036384| src/lib/near-matches.ts:245:   }
036385| NOTE: Implementation detail supporting search page behavior.
036386| src/lib/near-matches.ts:246: 
036387| NOTE: Blank line for visual separation.
036388| src/lib/near-matches.ts:247:   // Room type is third
036389| NOTE: Line comment documents intent or constraints.
036390| src/lib/near-matches.ts:248:   if (params.roomType) {
036391| NOTE: Conditional logic controlling rendering or flow.
036392| src/lib/near-matches.ts:249:     suggestions.push({
036393| NOTE: Implementation detail supporting search page behavior.
036394| src/lib/near-matches.ts:250:       type: "roomType",
036395| NOTE: Implementation detail supporting search page behavior.
036396| src/lib/near-matches.ts:251:       label: `Any room type (currently: ${params.roomType})`,
036397| NOTE: Implementation detail supporting search page behavior.
036398| src/lib/near-matches.ts:252:       priority: 3,
036399| NOTE: Implementation detail supporting search page behavior.
036400| src/lib/near-matches.ts:253:     });
036401| NOTE: Implementation detail supporting search page behavior.
036402| src/lib/near-matches.ts:254:   }
036403| NOTE: Implementation detail supporting search page behavior.
036404| src/lib/near-matches.ts:255: 
036405| NOTE: Blank line for visual separation.
036406| src/lib/near-matches.ts:256:   // Amenities can be restrictive
036407| NOTE: Line comment documents intent or constraints.
036408| src/lib/near-matches.ts:257:   if (params.amenities && params.amenities.length > 0) {
036409| NOTE: Conditional logic controlling rendering or flow.
036410| src/lib/near-matches.ts:258:     const amenityCount = params.amenities.length;
036411| NOTE: Local declaration used by search logic or UI.
036412| src/lib/near-matches.ts:259:     suggestions.push({
036413| NOTE: Implementation detail supporting search page behavior.
036414| src/lib/near-matches.ts:260:       type: "amenities",
036415| NOTE: Implementation detail supporting search page behavior.
036416| src/lib/near-matches.ts:261:       label: `Fewer amenities (${amenityCount} selected)`,
036417| NOTE: Implementation detail supporting search page behavior.
036418| src/lib/near-matches.ts:262:       priority: 4,
036419| NOTE: Implementation detail supporting search page behavior.
036420| src/lib/near-matches.ts:263:     });
036421| NOTE: Implementation detail supporting search page behavior.
036422| src/lib/near-matches.ts:264:   }
036423| NOTE: Implementation detail supporting search page behavior.
036424| src/lib/near-matches.ts:265: 
036425| NOTE: Blank line for visual separation.
036426| src/lib/near-matches.ts:266:   // Lease duration
036427| NOTE: Line comment documents intent or constraints.
036428| src/lib/near-matches.ts:267:   if (params.leaseDuration) {
036429| NOTE: Conditional logic controlling rendering or flow.
036430| src/lib/near-matches.ts:268:     suggestions.push({
036431| NOTE: Implementation detail supporting search page behavior.
036432| src/lib/near-matches.ts:269:       type: "leaseDuration",
036433| NOTE: Implementation detail supporting search page behavior.
036434| src/lib/near-matches.ts:270:       label: `Any lease duration (currently: ${params.leaseDuration})`,
036435| NOTE: Implementation detail supporting search page behavior.
036436| src/lib/near-matches.ts:271:       priority: 5,
036437| NOTE: Implementation detail supporting search page behavior.
036438| src/lib/near-matches.ts:272:     });
036439| NOTE: Implementation detail supporting search page behavior.
036440| src/lib/near-matches.ts:273:   }
036441| NOTE: Implementation detail supporting search page behavior.
036442| src/lib/near-matches.ts:274: 
036443| NOTE: Blank line for visual separation.
036444| src/lib/near-matches.ts:275:   // Sort by priority and return top 4
036445| NOTE: Line comment documents intent or constraints.
036446| src/lib/near-matches.ts:276:   return suggestions.sort((a, b) => a.priority - b.priority).slice(0, 4);
036447| NOTE: Return statement for component or helper output.
036448| src/lib/near-matches.ts:277: }
036449| NOTE: Implementation detail supporting search page behavior.
036450| src/lib/near-matches.ts:278: 
036451| NOTE: Blank line for visual separation.
036452| src/lib/near-matches.ts:279: /**
036453| NOTE: Block comment line describing behavior or context.
036454| src/lib/near-matches.ts:280:  * Format a date string for display.
036455| NOTE: Block comment line describing behavior or context.
036456| src/lib/near-matches.ts:281:  */
036457| NOTE: Block comment line describing behavior or context.
036458| src/lib/near-matches.ts:282: function formatDate(dateStr: string): string {
036459| NOTE: Defines a helper or component function.
036460| src/lib/near-matches.ts:283:   try {
036461| NOTE: Implementation detail supporting search page behavior.
036462| src/lib/near-matches.ts:284:     const date = new Date(dateStr + "T00:00:00");
036463| NOTE: Local declaration used by search logic or UI.
036464| src/lib/near-matches.ts:285:     return date.toLocaleDateString("en-US", {
036465| NOTE: Return statement for component or helper output.
036466| src/lib/near-matches.ts:286:       month: "short",
036467| NOTE: Implementation detail supporting search page behavior.
036468| src/lib/near-matches.ts:287:       day: "numeric",
036469| NOTE: Implementation detail supporting search page behavior.
036470| src/lib/near-matches.ts:288:       year: "numeric",
036471| NOTE: Implementation detail supporting search page behavior.
036472| src/lib/near-matches.ts:289:     });
036473| NOTE: Implementation detail supporting search page behavior.
036474| src/lib/near-matches.ts:290:   } catch {
036475| NOTE: Implementation detail supporting search page behavior.
036476| src/lib/near-matches.ts:291:     return dateStr;
036477| NOTE: Return statement for component or helper output.
036478| src/lib/near-matches.ts:292:   }
036479| NOTE: Implementation detail supporting search page behavior.
036480| src/lib/near-matches.ts:293: }
036481| NOTE: Implementation detail supporting search page behavior.
036482| FILE END: src/lib/near-matches.ts
036483| 
036484| FILE START: src/lib/prisma.ts
036485| FILE ROLE: Auto-discovered dependency in search page graph.
036486| src/lib/prisma.ts:1: import { PrismaClient, Prisma } from "@prisma/client";
036487| NOTE: Imports dependency for this module.
036488| src/lib/prisma.ts:2: import { logger } from "./logger";
036489| NOTE: Imports dependency for this module.
036490| src/lib/prisma.ts:3: 
036491| NOTE: Blank line for visual separation.
036492| src/lib/prisma.ts:4: const globalForPrisma = globalThis as unknown as {
036493| NOTE: Local declaration used by search logic or UI.
036494| src/lib/prisma.ts:5:   prisma: PrismaClient | undefined;
036495| NOTE: Implementation detail supporting search page behavior.
036496| src/lib/prisma.ts:6: };
036497| NOTE: Implementation detail supporting search page behavior.
036498| src/lib/prisma.ts:7: 
036499| NOTE: Blank line for visual separation.
036500| src/lib/prisma.ts:8: // P2-15: Connection pool configuration for serverless environments
036501| NOTE: Line comment documents intent or constraints.
036502| src/lib/prisma.ts:9: // Vercel serverless functions have short lifecycles, so we need to optimize connection handling
036503| NOTE: Line comment documents intent or constraints.
036504| src/lib/prisma.ts:10: // - connection_limit: Max connections per function instance (keep low for serverless)
036505| NOTE: Line comment documents intent or constraints.
036506| src/lib/prisma.ts:11: // - pool_timeout: How long to wait for a connection (fail fast in serverless)
036507| NOTE: Line comment documents intent or constraints.
036508| src/lib/prisma.ts:12: // - connect_timeout: Time to establish a new connection
036509| NOTE: Line comment documents intent or constraints.
036510| src/lib/prisma.ts:13: // See: https://www.prisma.io/docs/guides/performance-and-optimization/connection-management
036511| NOTE: Line comment documents intent or constraints.
036512| src/lib/prisma.ts:14: const getDatasourceUrl = () => {
036513| NOTE: Local declaration used by search logic or UI.
036514| src/lib/prisma.ts:15:   const baseUrl = process.env.DATABASE_URL;
036515| NOTE: Local declaration used by search logic or UI.
036516| src/lib/prisma.ts:16:   if (!baseUrl) return baseUrl;
036517| NOTE: Conditional logic controlling rendering or flow.
036518| src/lib/prisma.ts:17: 
036519| NOTE: Blank line for visual separation.
036520| src/lib/prisma.ts:18:   // Only add connection params if not already present
036521| NOTE: Line comment documents intent or constraints.
036522| src/lib/prisma.ts:19:   if (baseUrl.includes("connection_limit")) return baseUrl;
036523| NOTE: Conditional logic controlling rendering or flow.
036524| src/lib/prisma.ts:20: 
036525| NOTE: Blank line for visual separation.
036526| src/lib/prisma.ts:21:   const separator = baseUrl.includes("?") ? "&" : "?";
036527| NOTE: Local declaration used by search logic or UI.
036528| src/lib/prisma.ts:22:   // Lower limits for serverless: 5 connections max, 10s pool timeout, 5s connect timeout
036529| NOTE: Line comment documents intent or constraints.
036530| src/lib/prisma.ts:23:   return `${baseUrl}${separator}connection_limit=5&pool_timeout=10&connect_timeout=5`;
036531| NOTE: Return statement for component or helper output.
036532| src/lib/prisma.ts:24: };
036533| NOTE: Implementation detail supporting search page behavior.
036534| src/lib/prisma.ts:25: 
036535| NOTE: Blank line for visual separation.
036536| src/lib/prisma.ts:26: // P3-03 FIX: Configure Prisma logging
036537| NOTE: Line comment documents intent or constraints.
036538| src/lib/prisma.ts:27: // Development: log queries to stdout, errors/warnings via events for structured logging
036539| NOTE: Line comment documents intent or constraints.
036540| src/lib/prisma.ts:28: // Production: log errors/warnings via events only for structured logging with correlation
036541| NOTE: Line comment documents intent or constraints.
036542| src/lib/prisma.ts:29: type LogConfig = Prisma.PrismaClientOptions["log"];
036543| NOTE: Type declaration for search data contracts.
036544| src/lib/prisma.ts:30: 
036545| NOTE: Blank line for visual separation.
036546| src/lib/prisma.ts:31: const getLogConfig = (): LogConfig => {
036547| NOTE: Local declaration used by search logic or UI.
036548| src/lib/prisma.ts:32:   if (process.env.NODE_ENV === "development") {
036549| NOTE: Conditional logic controlling rendering or flow.
036550| src/lib/prisma.ts:33:     return [
036551| NOTE: Return statement for component or helper output.
036552| src/lib/prisma.ts:34:       { emit: "stdout", level: "query" },
036553| NOTE: Implementation detail supporting search page behavior.
036554| src/lib/prisma.ts:35:       { emit: "event", level: "error" },
036555| NOTE: Implementation detail supporting search page behavior.
036556| src/lib/prisma.ts:36:       { emit: "event", level: "warn" },
036557| NOTE: Implementation detail supporting search page behavior.
036558| src/lib/prisma.ts:37:     ];
036559| NOTE: Implementation detail supporting search page behavior.
036560| src/lib/prisma.ts:38:   }
036561| NOTE: Implementation detail supporting search page behavior.
036562| src/lib/prisma.ts:39:   // Production: route all through structured logger
036563| NOTE: Line comment documents intent or constraints.
036564| src/lib/prisma.ts:40:   return [
036565| NOTE: Return statement for component or helper output.
036566| src/lib/prisma.ts:41:     { emit: "event", level: "error" },
036567| NOTE: Implementation detail supporting search page behavior.
036568| src/lib/prisma.ts:42:     { emit: "event", level: "warn" },
036569| NOTE: Implementation detail supporting search page behavior.
036570| src/lib/prisma.ts:43:   ];
036571| NOTE: Implementation detail supporting search page behavior.
036572| src/lib/prisma.ts:44: };
036573| NOTE: Implementation detail supporting search page behavior.
036574| src/lib/prisma.ts:45: 
036575| NOTE: Blank line for visual separation.
036576| src/lib/prisma.ts:46: function createPrismaClient(): PrismaClient {
036577| NOTE: Defines a helper or component function.
036578| src/lib/prisma.ts:47:   const client = new PrismaClient({
036579| NOTE: Local declaration used by search logic or UI.
036580| src/lib/prisma.ts:48:     log: getLogConfig(),
036581| NOTE: Implementation detail supporting search page behavior.
036582| src/lib/prisma.ts:49:     datasources: {
036583| NOTE: Implementation detail supporting search page behavior.
036584| src/lib/prisma.ts:50:       db: {
036585| NOTE: Implementation detail supporting search page behavior.
036586| src/lib/prisma.ts:51:         url: getDatasourceUrl(),
036587| NOTE: Implementation detail supporting search page behavior.
036588| src/lib/prisma.ts:52:       },
036589| NOTE: Implementation detail supporting search page behavior.
036590| src/lib/prisma.ts:53:     },
036591| NOTE: Implementation detail supporting search page behavior.
036592| src/lib/prisma.ts:54:   });
036593| NOTE: Implementation detail supporting search page behavior.
036594| src/lib/prisma.ts:55: 
036595| NOTE: Blank line for visual separation.
036596| src/lib/prisma.ts:56:   // P3-03 FIX: Route Prisma errors through structured logger for correlation
036597| NOTE: Line comment documents intent or constraints.
036598| src/lib/prisma.ts:57:   // This provides requestId, userId context and PII redaction
036599| NOTE: Line comment documents intent or constraints.
036600| src/lib/prisma.ts:58:   // Using type assertion since $on is available when log emit is 'event'
036601| NOTE: Line comment documents intent or constraints.
036602| src/lib/prisma.ts:59:   const extendedClient = client as PrismaClient & {
036603| NOTE: Local declaration used by search logic or UI.
036604| src/lib/prisma.ts:60:     $on: (
036605| NOTE: Implementation detail supporting search page behavior.
036606| src/lib/prisma.ts:61:       eventType: "error" | "warn",
036607| NOTE: Implementation detail supporting search page behavior.
036608| src/lib/prisma.ts:62:       callback: (event: {
036609| NOTE: Implementation detail supporting search page behavior.
036610| src/lib/prisma.ts:63:         message: string;
036611| NOTE: Implementation detail supporting search page behavior.
036612| src/lib/prisma.ts:64:         target: string;
036613| NOTE: Implementation detail supporting search page behavior.
036614| src/lib/prisma.ts:65:         timestamp: Date;
036615| NOTE: Implementation detail supporting search page behavior.
036616| src/lib/prisma.ts:66:       }) => void,
036617| NOTE: Implementation detail supporting search page behavior.
036618| src/lib/prisma.ts:67:     ) => void;
036619| NOTE: Implementation detail supporting search page behavior.
036620| src/lib/prisma.ts:68:   };
036621| NOTE: Implementation detail supporting search page behavior.
036622| src/lib/prisma.ts:69: 
036623| NOTE: Blank line for visual separation.
036624| src/lib/prisma.ts:70:   extendedClient.$on("error", (e) => {
036625| NOTE: Implementation detail supporting search page behavior.
036626| src/lib/prisma.ts:71:     // P4-01 FIX: Add fallback values to prevent empty {} logs
036627| NOTE: Line comment documents intent or constraints.
036628| src/lib/prisma.ts:72:     // Event properties may be undefined in some error scenarios
036629| NOTE: Line comment documents intent or constraints.
036630| src/lib/prisma.ts:73:     const errorDetails = {
036631| NOTE: Local declaration used by search logic or UI.
036632| src/lib/prisma.ts:74:       target: e?.target || "unknown",
036633| NOTE: Implementation detail supporting search page behavior.
036634| src/lib/prisma.ts:75:       message: e?.message || "No message provided",
036635| NOTE: Implementation detail supporting search page behavior.
036636| src/lib/prisma.ts:76:       timestamp: e?.timestamp?.toISOString?.() || new Date().toISOString(),
036637| NOTE: Implementation detail supporting search page behavior.
036638| src/lib/prisma.ts:77:     };
036639| NOTE: Implementation detail supporting search page behavior.
036640| src/lib/prisma.ts:78:     logger.sync.error("Prisma error", errorDetails);
036641| NOTE: Implementation detail supporting search page behavior.
036642| src/lib/prisma.ts:79:   });
036643| NOTE: Implementation detail supporting search page behavior.
036644| src/lib/prisma.ts:80: 
036645| NOTE: Blank line for visual separation.
036646| src/lib/prisma.ts:81:   extendedClient.$on("warn", (e) => {
036647| NOTE: Implementation detail supporting search page behavior.
036648| src/lib/prisma.ts:82:     // P4-01 FIX: Add fallback values for consistency
036649| NOTE: Line comment documents intent or constraints.
036650| src/lib/prisma.ts:83:     const warnDetails = {
036651| NOTE: Local declaration used by search logic or UI.
036652| src/lib/prisma.ts:84:       target: e?.target || "unknown",
036653| NOTE: Implementation detail supporting search page behavior.
036654| src/lib/prisma.ts:85:       message: e?.message || "No message provided",
036655| NOTE: Implementation detail supporting search page behavior.
036656| src/lib/prisma.ts:86:       timestamp: e?.timestamp?.toISOString?.() || new Date().toISOString(),
036657| NOTE: Implementation detail supporting search page behavior.
036658| src/lib/prisma.ts:87:     };
036659| NOTE: Implementation detail supporting search page behavior.
036660| src/lib/prisma.ts:88:     logger.sync.warn("Prisma warning", warnDetails);
036661| NOTE: Implementation detail supporting search page behavior.
036662| src/lib/prisma.ts:89:   });
036663| NOTE: Implementation detail supporting search page behavior.
036664| src/lib/prisma.ts:90: 
036665| NOTE: Blank line for visual separation.
036666| src/lib/prisma.ts:91:   return client;
036667| NOTE: Return statement for component or helper output.
036668| src/lib/prisma.ts:92: }
036669| NOTE: Implementation detail supporting search page behavior.
036670| src/lib/prisma.ts:93: 
036671| NOTE: Blank line for visual separation.
036672| src/lib/prisma.ts:94: export const prisma = globalForPrisma.prisma ?? createPrismaClient();
036673| NOTE: Implementation detail supporting search page behavior.
036674| src/lib/prisma.ts:95: 
036675| NOTE: Blank line for visual separation.
036676| src/lib/prisma.ts:96: // Prevent multiple instances in development (hot reload)
036677| NOTE: Line comment documents intent or constraints.
036678| src/lib/prisma.ts:97: if (process.env.NODE_ENV !== "production") {
036679| NOTE: Conditional logic controlling rendering or flow.
036680| src/lib/prisma.ts:98:   globalForPrisma.prisma = prisma;
036681| NOTE: Implementation detail supporting search page behavior.
036682| src/lib/prisma.ts:99: }
036683| NOTE: Implementation detail supporting search page behavior.
036684| FILE END: src/lib/prisma.ts
036685| 
036686| FILE START: src/lib/rate-limit-redis.ts
036687| FILE ROLE: Auto-discovered dependency in search page graph.
036688| src/lib/rate-limit-redis.ts:1: /**
036689| NOTE: Block comment line describing behavior or context.
036690| src/lib/rate-limit-redis.ts:2:  * Redis-backed rate limiting using Upstash.
036691| NOTE: Block comment line describing behavior or context.
036692| src/lib/rate-limit-redis.ts:3:  *
036693| NOTE: Block comment line describing behavior or context.
036694| src/lib/rate-limit-redis.ts:4:  * Provides burst and sustained rate limiters for:
036695| NOTE: Block comment line describing behavior or context.
036696| src/lib/rate-limit-redis.ts:5:  * - Chat API: 5/min burst, 30/hour sustained
036697| NOTE: Block comment line describing behavior or context.
036698| src/lib/rate-limit-redis.ts:6:  * - Metrics API: 100/min burst, 500/hour sustained
036699| NOTE: Block comment line describing behavior or context.
036700| src/lib/rate-limit-redis.ts:7:  *
036701| NOTE: Block comment line describing behavior or context.
036702| src/lib/rate-limit-redis.ts:8:  * Uses sliding window algorithm for accurate rate limiting
036703| NOTE: Block comment line describing behavior or context.
036704| src/lib/rate-limit-redis.ts:9:  * across serverless function instances.
036705| NOTE: Block comment line describing behavior or context.
036706| src/lib/rate-limit-redis.ts:10:  */
036707| NOTE: Block comment line describing behavior or context.
036708| src/lib/rate-limit-redis.ts:11: 
036709| NOTE: Blank line for visual separation.
036710| src/lib/rate-limit-redis.ts:12: import { Ratelimit } from "@upstash/ratelimit";
036711| NOTE: Imports dependency for this module.
036712| src/lib/rate-limit-redis.ts:13: import { Redis } from "@upstash/redis";
036713| NOTE: Imports dependency for this module.
036714| src/lib/rate-limit-redis.ts:14: 
036715| NOTE: Blank line for visual separation.
036716| src/lib/rate-limit-redis.ts:15: // Initialize Redis client
036717| NOTE: Line comment documents intent or constraints.
036718| src/lib/rate-limit-redis.ts:16: // Falls back gracefully if env vars not set (for local dev without Redis)
036719| NOTE: Line comment documents intent or constraints.
036720| src/lib/rate-limit-redis.ts:17: const redis = new Redis({
036721| NOTE: Local declaration used by search logic or UI.
036722| src/lib/rate-limit-redis.ts:18:   url: process.env.UPSTASH_REDIS_REST_URL || "",
036723| NOTE: Implementation detail supporting search page behavior.
036724| src/lib/rate-limit-redis.ts:19:   token: process.env.UPSTASH_REDIS_REST_TOKEN || "",
036725| NOTE: Implementation detail supporting search page behavior.
036726| src/lib/rate-limit-redis.ts:20: });
036727| NOTE: Implementation detail supporting search page behavior.
036728| src/lib/rate-limit-redis.ts:21: 
036729| NOTE: Blank line for visual separation.
036730| src/lib/rate-limit-redis.ts:22: // ============ CHAT LIMITERS ============
036731| NOTE: Line comment documents intent or constraints.
036732| src/lib/rate-limit-redis.ts:23: 
036733| NOTE: Blank line for visual separation.
036734| src/lib/rate-limit-redis.ts:24: /**
036735| NOTE: Block comment line describing behavior or context.
036736| src/lib/rate-limit-redis.ts:25:  * Burst limiter: 5 requests per minute
036737| NOTE: Block comment line describing behavior or context.
036738| src/lib/rate-limit-redis.ts:26:  * Prevents rapid-fire requests from a single IP
036739| NOTE: Block comment line describing behavior or context.
036740| src/lib/rate-limit-redis.ts:27:  */
036741| NOTE: Block comment line describing behavior or context.
036742| src/lib/rate-limit-redis.ts:28: export const chatBurstLimiter = new Ratelimit({
036743| NOTE: Implementation detail supporting search page behavior.
036744| src/lib/rate-limit-redis.ts:29:   redis,
036745| NOTE: Implementation detail supporting search page behavior.
036746| src/lib/rate-limit-redis.ts:30:   limiter: Ratelimit.slidingWindow(5, "1 m"),
036747| NOTE: Implementation detail supporting search page behavior.
036748| src/lib/rate-limit-redis.ts:31:   prefix: "chat-burst",
036749| NOTE: Implementation detail supporting search page behavior.
036750| src/lib/rate-limit-redis.ts:32:   analytics: true,
036751| NOTE: Implementation detail supporting search page behavior.
036752| src/lib/rate-limit-redis.ts:33: });
036753| NOTE: Implementation detail supporting search page behavior.
036754| src/lib/rate-limit-redis.ts:34: 
036755| NOTE: Blank line for visual separation.
036756| src/lib/rate-limit-redis.ts:35: /**
036757| NOTE: Block comment line describing behavior or context.
036758| src/lib/rate-limit-redis.ts:36:  * Sustained limiter: 30 requests per hour
036759| NOTE: Block comment line describing behavior or context.
036760| src/lib/rate-limit-redis.ts:37:  * Prevents abuse over longer periods
036761| NOTE: Block comment line describing behavior or context.
036762| src/lib/rate-limit-redis.ts:38:  */
036763| NOTE: Block comment line describing behavior or context.
036764| src/lib/rate-limit-redis.ts:39: export const chatSustainedLimiter = new Ratelimit({
036765| NOTE: Implementation detail supporting search page behavior.
036766| src/lib/rate-limit-redis.ts:40:   redis,
036767| NOTE: Implementation detail supporting search page behavior.
036768| src/lib/rate-limit-redis.ts:41:   limiter: Ratelimit.slidingWindow(30, "1 h"),
036769| NOTE: Implementation detail supporting search page behavior.
036770| src/lib/rate-limit-redis.ts:42:   prefix: "chat-sustained",
036771| NOTE: Implementation detail supporting search page behavior.
036772| src/lib/rate-limit-redis.ts:43:   analytics: true,
036773| NOTE: Implementation detail supporting search page behavior.
036774| src/lib/rate-limit-redis.ts:44: });
036775| NOTE: Implementation detail supporting search page behavior.
036776| src/lib/rate-limit-redis.ts:45: 
036777| NOTE: Blank line for visual separation.
036778| src/lib/rate-limit-redis.ts:46: // ============ METRICS LIMITERS ============
036779| NOTE: Line comment documents intent or constraints.
036780| src/lib/rate-limit-redis.ts:47: 
036781| NOTE: Blank line for visual separation.
036782| src/lib/rate-limit-redis.ts:48: /**
036783| NOTE: Block comment line describing behavior or context.
036784| src/lib/rate-limit-redis.ts:49:  * Metrics burst limiter: 100 requests per minute
036785| NOTE: Block comment line describing behavior or context.
036786| src/lib/rate-limit-redis.ts:50:  * Higher than chat since metrics are lightweight fire-and-forget
036787| NOTE: Block comment line describing behavior or context.
036788| src/lib/rate-limit-redis.ts:51:  */
036789| NOTE: Block comment line describing behavior or context.
036790| src/lib/rate-limit-redis.ts:52: export const metricsBurstLimiter = new Ratelimit({
036791| NOTE: Implementation detail supporting search page behavior.
036792| src/lib/rate-limit-redis.ts:53:   redis,
036793| NOTE: Implementation detail supporting search page behavior.
036794| src/lib/rate-limit-redis.ts:54:   limiter: Ratelimit.slidingWindow(100, "1 m"),
036795| NOTE: Implementation detail supporting search page behavior.
036796| src/lib/rate-limit-redis.ts:55:   prefix: "metrics-burst",
036797| NOTE: Implementation detail supporting search page behavior.
036798| src/lib/rate-limit-redis.ts:56:   analytics: true,
036799| NOTE: Implementation detail supporting search page behavior.
036800| src/lib/rate-limit-redis.ts:57: });
036801| NOTE: Implementation detail supporting search page behavior.
036802| src/lib/rate-limit-redis.ts:58: 
036803| NOTE: Blank line for visual separation.
036804| src/lib/rate-limit-redis.ts:59: /**
036805| NOTE: Block comment line describing behavior or context.
036806| src/lib/rate-limit-redis.ts:60:  * Metrics sustained limiter: 500 requests per hour
036807| NOTE: Block comment line describing behavior or context.
036808| src/lib/rate-limit-redis.ts:61:  * Prevents logging abuse
036809| NOTE: Block comment line describing behavior or context.
036810| src/lib/rate-limit-redis.ts:62:  */
036811| NOTE: Block comment line describing behavior or context.
036812| src/lib/rate-limit-redis.ts:63: export const metricsSustainedLimiter = new Ratelimit({
036813| NOTE: Implementation detail supporting search page behavior.
036814| src/lib/rate-limit-redis.ts:64:   redis,
036815| NOTE: Implementation detail supporting search page behavior.
036816| src/lib/rate-limit-redis.ts:65:   limiter: Ratelimit.slidingWindow(500, "1 h"),
036817| NOTE: Implementation detail supporting search page behavior.
036818| src/lib/rate-limit-redis.ts:66:   prefix: "metrics-sustained",
036819| NOTE: Implementation detail supporting search page behavior.
036820| src/lib/rate-limit-redis.ts:67:   analytics: true,
036821| NOTE: Implementation detail supporting search page behavior.
036822| src/lib/rate-limit-redis.ts:68: });
036823| NOTE: Implementation detail supporting search page behavior.
036824| src/lib/rate-limit-redis.ts:69: 
036825| NOTE: Blank line for visual separation.
036826| src/lib/rate-limit-redis.ts:70: // ============ MAP LIMITERS ============
036827| NOTE: Line comment documents intent or constraints.
036828| src/lib/rate-limit-redis.ts:71: 
036829| NOTE: Blank line for visual separation.
036830| src/lib/rate-limit-redis.ts:72: /**
036831| NOTE: Block comment line describing behavior or context.
036832| src/lib/rate-limit-redis.ts:73:  * Map burst limiter: 60 requests per minute
036833| NOTE: Block comment line describing behavior or context.
036834| src/lib/rate-limit-redis.ts:74:  * Prevents rapid-fire map panning abuse
036835| NOTE: Block comment line describing behavior or context.
036836| src/lib/rate-limit-redis.ts:75:  * 60 req/min = 1 req/second which covers reasonable user interaction
036837| NOTE: Block comment line describing behavior or context.
036838| src/lib/rate-limit-redis.ts:76:  */
036839| NOTE: Block comment line describing behavior or context.
036840| src/lib/rate-limit-redis.ts:77: export const mapBurstLimiter = new Ratelimit({
036841| NOTE: Implementation detail supporting search page behavior.
036842| src/lib/rate-limit-redis.ts:78:   redis,
036843| NOTE: Implementation detail supporting search page behavior.
036844| src/lib/rate-limit-redis.ts:79:   limiter: Ratelimit.slidingWindow(60, "1 m"),
036845| NOTE: Implementation detail supporting search page behavior.
036846| src/lib/rate-limit-redis.ts:80:   prefix: "map-burst",
036847| NOTE: Implementation detail supporting search page behavior.
036848| src/lib/rate-limit-redis.ts:81:   analytics: true,
036849| NOTE: Implementation detail supporting search page behavior.
036850| src/lib/rate-limit-redis.ts:82: });
036851| NOTE: Implementation detail supporting search page behavior.
036852| src/lib/rate-limit-redis.ts:83: 
036853| NOTE: Blank line for visual separation.
036854| src/lib/rate-limit-redis.ts:84: /**
036855| NOTE: Block comment line describing behavior or context.
036856| src/lib/rate-limit-redis.ts:85:  * Map sustained limiter: 300 requests per hour
036857| NOTE: Block comment line describing behavior or context.
036858| src/lib/rate-limit-redis.ts:86:  * Prevents automated scraping via map endpoint
036859| NOTE: Block comment line describing behavior or context.
036860| src/lib/rate-limit-redis.ts:87:  */
036861| NOTE: Block comment line describing behavior or context.
036862| src/lib/rate-limit-redis.ts:88: export const mapSustainedLimiter = new Ratelimit({
036863| NOTE: Implementation detail supporting search page behavior.
036864| src/lib/rate-limit-redis.ts:89:   redis,
036865| NOTE: Implementation detail supporting search page behavior.
036866| src/lib/rate-limit-redis.ts:90:   limiter: Ratelimit.slidingWindow(300, "1 h"),
036867| NOTE: Implementation detail supporting search page behavior.
036868| src/lib/rate-limit-redis.ts:91:   prefix: "map-sustained",
036869| NOTE: Implementation detail supporting search page behavior.
036870| src/lib/rate-limit-redis.ts:92:   analytics: true,
036871| NOTE: Implementation detail supporting search page behavior.
036872| src/lib/rate-limit-redis.ts:93: });
036873| NOTE: Implementation detail supporting search page behavior.
036874| src/lib/rate-limit-redis.ts:94: 
036875| NOTE: Blank line for visual separation.
036876| src/lib/rate-limit-redis.ts:95: // ============ SEARCH COUNT LIMITERS ============
036877| NOTE: Line comment documents intent or constraints.
036878| src/lib/rate-limit-redis.ts:96: 
036879| NOTE: Blank line for visual separation.
036880| src/lib/rate-limit-redis.ts:97: /**
036881| NOTE: Block comment line describing behavior or context.
036882| src/lib/rate-limit-redis.ts:98:  * Search count burst limiter: 30 requests per minute
036883| NOTE: Block comment line describing behavior or context.
036884| src/lib/rate-limit-redis.ts:99:  * Used for filter drawer "Show X listings" preview
036885| NOTE: Block comment line describing behavior or context.
036886| src/lib/rate-limit-redis.ts:100:  * Lower than map since client debounces (300ms)
036887| NOTE: Block comment line describing behavior or context.
036888| src/lib/rate-limit-redis.ts:101:  */
036889| NOTE: Block comment line describing behavior or context.
036890| src/lib/rate-limit-redis.ts:102: export const searchCountBurstLimiter = new Ratelimit({
036891| NOTE: Implementation detail supporting search page behavior.
036892| src/lib/rate-limit-redis.ts:103:   redis,
036893| NOTE: Implementation detail supporting search page behavior.
036894| src/lib/rate-limit-redis.ts:104:   limiter: Ratelimit.slidingWindow(30, "1 m"),
036895| NOTE: Implementation detail supporting search page behavior.
036896| src/lib/rate-limit-redis.ts:105:   prefix: "search-count-burst",
036897| NOTE: Implementation detail supporting search page behavior.
036898| src/lib/rate-limit-redis.ts:106:   analytics: true,
036899| NOTE: Implementation detail supporting search page behavior.
036900| src/lib/rate-limit-redis.ts:107: });
036901| NOTE: Implementation detail supporting search page behavior.
036902| src/lib/rate-limit-redis.ts:108: 
036903| NOTE: Blank line for visual separation.
036904| src/lib/rate-limit-redis.ts:109: /**
036905| NOTE: Block comment line describing behavior or context.
036906| src/lib/rate-limit-redis.ts:110:  * Search count sustained limiter: 200 requests per hour
036907| NOTE: Block comment line describing behavior or context.
036908| src/lib/rate-limit-redis.ts:111:  * Prevents abuse of count endpoint
036909| NOTE: Block comment line describing behavior or context.
036910| src/lib/rate-limit-redis.ts:112:  */
036911| NOTE: Block comment line describing behavior or context.
036912| src/lib/rate-limit-redis.ts:113: export const searchCountSustainedLimiter = new Ratelimit({
036913| NOTE: Implementation detail supporting search page behavior.
036914| src/lib/rate-limit-redis.ts:114:   redis,
036915| NOTE: Implementation detail supporting search page behavior.
036916| src/lib/rate-limit-redis.ts:115:   limiter: Ratelimit.slidingWindow(200, "1 h"),
036917| NOTE: Implementation detail supporting search page behavior.
036918| src/lib/rate-limit-redis.ts:116:   prefix: "search-count-sustained",
036919| NOTE: Implementation detail supporting search page behavior.
036920| src/lib/rate-limit-redis.ts:117:   analytics: true,
036921| NOTE: Implementation detail supporting search page behavior.
036922| src/lib/rate-limit-redis.ts:118: });
036923| NOTE: Implementation detail supporting search page behavior.
036924| src/lib/rate-limit-redis.ts:119: 
036925| NOTE: Blank line for visual separation.
036926| src/lib/rate-limit-redis.ts:120: // ============ RATE LIMIT CHECK FUNCTIONS ============
036927| NOTE: Line comment documents intent or constraints.
036928| src/lib/rate-limit-redis.ts:121: 
036929| NOTE: Blank line for visual separation.
036930| src/lib/rate-limit-redis.ts:122: export interface RateLimitResult {
036931| NOTE: Implementation detail supporting search page behavior.
036932| src/lib/rate-limit-redis.ts:123:   success: boolean;
036933| NOTE: Implementation detail supporting search page behavior.
036934| src/lib/rate-limit-redis.ts:124:   retryAfter?: number;
036935| NOTE: Implementation detail supporting search page behavior.
036936| src/lib/rate-limit-redis.ts:125: }
036937| NOTE: Implementation detail supporting search page behavior.
036938| src/lib/rate-limit-redis.ts:126: 
036939| NOTE: Blank line for visual separation.
036940| src/lib/rate-limit-redis.ts:127: /**
036941| NOTE: Block comment line describing behavior or context.
036942| src/lib/rate-limit-redis.ts:128:  * Check chat rate limits (both burst and sustained).
036943| NOTE: Block comment line describing behavior or context.
036944| src/lib/rate-limit-redis.ts:129:  * Returns success: false if either limit is exceeded.
036945| NOTE: Block comment line describing behavior or context.
036946| src/lib/rate-limit-redis.ts:130:  *
036947| NOTE: Block comment line describing behavior or context.
036948| src/lib/rate-limit-redis.ts:131:  * @param ip - Client IP address
036949| NOTE: Block comment line describing behavior or context.
036950| src/lib/rate-limit-redis.ts:132:  * @returns Rate limit result with optional retry-after seconds
036951| NOTE: Block comment line describing behavior or context.
036952| src/lib/rate-limit-redis.ts:133:  */
036953| NOTE: Block comment line describing behavior or context.
036954| src/lib/rate-limit-redis.ts:134: export async function checkChatRateLimit(ip: string): Promise<RateLimitResult> {
036955| NOTE: Implementation detail supporting search page behavior.
036956| src/lib/rate-limit-redis.ts:135:   // Check if Redis is configured
036957| NOTE: Line comment documents intent or constraints.
036958| src/lib/rate-limit-redis.ts:136:   if (
036959| NOTE: Conditional logic controlling rendering or flow.
036960| src/lib/rate-limit-redis.ts:137:     !process.env.UPSTASH_REDIS_REST_URL ||
036961| NOTE: Implementation detail supporting search page behavior.
036962| src/lib/rate-limit-redis.ts:138:     !process.env.UPSTASH_REDIS_REST_TOKEN
036963| NOTE: Implementation detail supporting search page behavior.
036964| src/lib/rate-limit-redis.ts:139:   ) {
036965| NOTE: Implementation detail supporting search page behavior.
036966| src/lib/rate-limit-redis.ts:140:     // Skip rate limiting in development without Redis
036967| NOTE: Line comment documents intent or constraints.
036968| src/lib/rate-limit-redis.ts:141:     if (process.env.NODE_ENV === "development") {
036969| NOTE: Conditional logic controlling rendering or flow.
036970| src/lib/rate-limit-redis.ts:142:       return { success: true };
036971| NOTE: Return statement for component or helper output.
036972| src/lib/rate-limit-redis.ts:143:     }
036973| NOTE: Implementation detail supporting search page behavior.
036974| src/lib/rate-limit-redis.ts:144:     // In production, fail closed (deny requests if Redis not configured)
036975| NOTE: Line comment documents intent or constraints.
036976| src/lib/rate-limit-redis.ts:145:     console.error("[RateLimit] Redis not configured in production");
036977| NOTE: Implementation detail supporting search page behavior.
036978| src/lib/rate-limit-redis.ts:146:     return { success: false, retryAfter: 60 };
036979| NOTE: Return statement for component or helper output.
036980| src/lib/rate-limit-redis.ts:147:   }
036981| NOTE: Implementation detail supporting search page behavior.
036982| src/lib/rate-limit-redis.ts:148: 
036983| NOTE: Blank line for visual separation.
036984| src/lib/rate-limit-redis.ts:149:   try {
036985| NOTE: Implementation detail supporting search page behavior.
036986| src/lib/rate-limit-redis.ts:150:     // Check burst limit first (more likely to be hit)
036987| NOTE: Line comment documents intent or constraints.
036988| src/lib/rate-limit-redis.ts:151:     const burstResult = await chatBurstLimiter.limit(ip);
036989| NOTE: Local declaration used by search logic or UI.
036990| src/lib/rate-limit-redis.ts:152:     if (!burstResult.success) {
036991| NOTE: Conditional logic controlling rendering or flow.
036992| src/lib/rate-limit-redis.ts:153:       return {
036993| NOTE: Return statement for component or helper output.
036994| src/lib/rate-limit-redis.ts:154:         success: false,
036995| NOTE: Implementation detail supporting search page behavior.
036996| src/lib/rate-limit-redis.ts:155:         retryAfter: Math.ceil((burstResult.reset - Date.now()) / 1000),
036997| NOTE: Implementation detail supporting search page behavior.
036998| src/lib/rate-limit-redis.ts:156:       };
036999| NOTE: Implementation detail supporting search page behavior.
037000| src/lib/rate-limit-redis.ts:157:     }
037001| NOTE: Implementation detail supporting search page behavior.
037002| src/lib/rate-limit-redis.ts:158: 
037003| NOTE: Blank line for visual separation.
037004| src/lib/rate-limit-redis.ts:159:     // Check sustained limit
037005| NOTE: Line comment documents intent or constraints.
037006| src/lib/rate-limit-redis.ts:160:     const sustainedResult = await chatSustainedLimiter.limit(ip);
037007| NOTE: Local declaration used by search logic or UI.
037008| src/lib/rate-limit-redis.ts:161:     if (!sustainedResult.success) {
037009| NOTE: Conditional logic controlling rendering or flow.
037010| src/lib/rate-limit-redis.ts:162:       return {
037011| NOTE: Return statement for component or helper output.
037012| src/lib/rate-limit-redis.ts:163:         success: false,
037013| NOTE: Implementation detail supporting search page behavior.
037014| src/lib/rate-limit-redis.ts:164:         retryAfter: Math.ceil((sustainedResult.reset - Date.now()) / 1000),
037015| NOTE: Implementation detail supporting search page behavior.
037016| src/lib/rate-limit-redis.ts:165:       };
037017| NOTE: Implementation detail supporting search page behavior.
037018| src/lib/rate-limit-redis.ts:166:     }
037019| NOTE: Implementation detail supporting search page behavior.
037020| src/lib/rate-limit-redis.ts:167: 
037021| NOTE: Blank line for visual separation.
037022| src/lib/rate-limit-redis.ts:168:     return { success: true };
037023| NOTE: Return statement for component or helper output.
037024| src/lib/rate-limit-redis.ts:169:   } catch (error) {
037025| NOTE: Implementation detail supporting search page behavior.
037026| src/lib/rate-limit-redis.ts:170:     console.error("[RateLimit] Redis error:", error);
037027| NOTE: Implementation detail supporting search page behavior.
037028| src/lib/rate-limit-redis.ts:171:     // FAIL CLOSED in production - security over availability
037029| NOTE: Line comment documents intent or constraints.
037030| src/lib/rate-limit-redis.ts:172:     if (process.env.NODE_ENV === "production") {
037031| NOTE: Conditional logic controlling rendering or flow.
037032| src/lib/rate-limit-redis.ts:173:       return { success: false, retryAfter: 60 };
037033| NOTE: Return statement for component or helper output.
037034| src/lib/rate-limit-redis.ts:174:     }
037035| NOTE: Implementation detail supporting search page behavior.
037036| src/lib/rate-limit-redis.ts:175:     // Allow in development for local testing without Redis
037037| NOTE: Line comment documents intent or constraints.
037038| src/lib/rate-limit-redis.ts:176:     return { success: true };
037039| NOTE: Return statement for component or helper output.
037040| src/lib/rate-limit-redis.ts:177:   }
037041| NOTE: Implementation detail supporting search page behavior.
037042| src/lib/rate-limit-redis.ts:178: }
037043| NOTE: Implementation detail supporting search page behavior.
037044| src/lib/rate-limit-redis.ts:179: 
037045| NOTE: Blank line for visual separation.
037046| src/lib/rate-limit-redis.ts:180: /**
037047| NOTE: Block comment line describing behavior or context.
037048| src/lib/rate-limit-redis.ts:181:  * Check metrics rate limits (both burst and sustained).
037049| NOTE: Block comment line describing behavior or context.
037050| src/lib/rate-limit-redis.ts:182:  * Returns success: false if either limit is exceeded.
037051| NOTE: Block comment line describing behavior or context.
037052| src/lib/rate-limit-redis.ts:183:  *
037053| NOTE: Block comment line describing behavior or context.
037054| src/lib/rate-limit-redis.ts:184:  * @param ip - Client IP address
037055| NOTE: Block comment line describing behavior or context.
037056| src/lib/rate-limit-redis.ts:185:  * @returns Rate limit result with optional retry-after seconds
037057| NOTE: Block comment line describing behavior or context.
037058| src/lib/rate-limit-redis.ts:186:  */
037059| NOTE: Block comment line describing behavior or context.
037060| src/lib/rate-limit-redis.ts:187: export async function checkMetricsRateLimit(
037061| NOTE: Implementation detail supporting search page behavior.
037062| src/lib/rate-limit-redis.ts:188:   ip: string,
037063| NOTE: Implementation detail supporting search page behavior.
037064| src/lib/rate-limit-redis.ts:189: ): Promise<RateLimitResult> {
037065| NOTE: Implementation detail supporting search page behavior.
037066| src/lib/rate-limit-redis.ts:190:   // Check if Redis is configured
037067| NOTE: Line comment documents intent or constraints.
037068| src/lib/rate-limit-redis.ts:191:   if (
037069| NOTE: Conditional logic controlling rendering or flow.
037070| src/lib/rate-limit-redis.ts:192:     !process.env.UPSTASH_REDIS_REST_URL ||
037071| NOTE: Implementation detail supporting search page behavior.
037072| src/lib/rate-limit-redis.ts:193:     !process.env.UPSTASH_REDIS_REST_TOKEN
037073| NOTE: Implementation detail supporting search page behavior.
037074| src/lib/rate-limit-redis.ts:194:   ) {
037075| NOTE: Implementation detail supporting search page behavior.
037076| src/lib/rate-limit-redis.ts:195:     // Skip rate limiting in development without Redis
037077| NOTE: Line comment documents intent or constraints.
037078| src/lib/rate-limit-redis.ts:196:     if (process.env.NODE_ENV === "development") {
037079| NOTE: Conditional logic controlling rendering or flow.
037080| src/lib/rate-limit-redis.ts:197:       return { success: true };
037081| NOTE: Return statement for component or helper output.
037082| src/lib/rate-limit-redis.ts:198:     }
037083| NOTE: Implementation detail supporting search page behavior.
037084| src/lib/rate-limit-redis.ts:199:     // In production, fail closed
037085| NOTE: Line comment documents intent or constraints.
037086| src/lib/rate-limit-redis.ts:200:     console.error("[RateLimit] Redis not configured in production");
037087| NOTE: Implementation detail supporting search page behavior.
037088| src/lib/rate-limit-redis.ts:201:     return { success: false, retryAfter: 60 };
037089| NOTE: Return statement for component or helper output.
037090| src/lib/rate-limit-redis.ts:202:   }
037091| NOTE: Implementation detail supporting search page behavior.
037092| src/lib/rate-limit-redis.ts:203: 
037093| NOTE: Blank line for visual separation.
037094| src/lib/rate-limit-redis.ts:204:   try {
037095| NOTE: Implementation detail supporting search page behavior.
037096| src/lib/rate-limit-redis.ts:205:     // Check burst limit first
037097| NOTE: Line comment documents intent or constraints.
037098| src/lib/rate-limit-redis.ts:206:     const burstResult = await metricsBurstLimiter.limit(ip);
037099| NOTE: Local declaration used by search logic or UI.
037100| src/lib/rate-limit-redis.ts:207:     if (!burstResult.success) {
037101| NOTE: Conditional logic controlling rendering or flow.
037102| src/lib/rate-limit-redis.ts:208:       return {
037103| NOTE: Return statement for component or helper output.
037104| src/lib/rate-limit-redis.ts:209:         success: false,
037105| NOTE: Implementation detail supporting search page behavior.
037106| src/lib/rate-limit-redis.ts:210:         retryAfter: Math.ceil((burstResult.reset - Date.now()) / 1000),
037107| NOTE: Implementation detail supporting search page behavior.
037108| src/lib/rate-limit-redis.ts:211:       };
037109| NOTE: Implementation detail supporting search page behavior.
037110| src/lib/rate-limit-redis.ts:212:     }
037111| NOTE: Implementation detail supporting search page behavior.
037112| src/lib/rate-limit-redis.ts:213: 
037113| NOTE: Blank line for visual separation.
037114| src/lib/rate-limit-redis.ts:214:     // Check sustained limit
037115| NOTE: Line comment documents intent or constraints.
037116| src/lib/rate-limit-redis.ts:215:     const sustainedResult = await metricsSustainedLimiter.limit(ip);
037117| NOTE: Local declaration used by search logic or UI.
037118| src/lib/rate-limit-redis.ts:216:     if (!sustainedResult.success) {
037119| NOTE: Conditional logic controlling rendering or flow.
037120| src/lib/rate-limit-redis.ts:217:       return {
037121| NOTE: Return statement for component or helper output.
037122| src/lib/rate-limit-redis.ts:218:         success: false,
037123| NOTE: Implementation detail supporting search page behavior.
037124| src/lib/rate-limit-redis.ts:219:         retryAfter: Math.ceil((sustainedResult.reset - Date.now()) / 1000),
037125| NOTE: Implementation detail supporting search page behavior.
037126| src/lib/rate-limit-redis.ts:220:       };
037127| NOTE: Implementation detail supporting search page behavior.
037128| src/lib/rate-limit-redis.ts:221:     }
037129| NOTE: Implementation detail supporting search page behavior.
037130| src/lib/rate-limit-redis.ts:222: 
037131| NOTE: Blank line for visual separation.
037132| src/lib/rate-limit-redis.ts:223:     return { success: true };
037133| NOTE: Return statement for component or helper output.
037134| src/lib/rate-limit-redis.ts:224:   } catch (error) {
037135| NOTE: Implementation detail supporting search page behavior.
037136| src/lib/rate-limit-redis.ts:225:     console.error("[RateLimit] Redis error:", error);
037137| NOTE: Implementation detail supporting search page behavior.
037138| src/lib/rate-limit-redis.ts:226:     // FAIL CLOSED in production - even for metrics
037139| NOTE: Line comment documents intent or constraints.
037140| src/lib/rate-limit-redis.ts:227:     if (process.env.NODE_ENV === "production") {
037141| NOTE: Conditional logic controlling rendering or flow.
037142| src/lib/rate-limit-redis.ts:228:       return { success: false, retryAfter: 60 };
037143| NOTE: Return statement for component or helper output.
037144| src/lib/rate-limit-redis.ts:229:     }
037145| NOTE: Implementation detail supporting search page behavior.
037146| src/lib/rate-limit-redis.ts:230:     return { success: true };
037147| NOTE: Return statement for component or helper output.
037148| src/lib/rate-limit-redis.ts:231:   }
037149| NOTE: Implementation detail supporting search page behavior.
037150| src/lib/rate-limit-redis.ts:232: }
037151| NOTE: Implementation detail supporting search page behavior.
037152| src/lib/rate-limit-redis.ts:233: 
037153| NOTE: Blank line for visual separation.
037154| src/lib/rate-limit-redis.ts:234: /**
037155| NOTE: Block comment line describing behavior or context.
037156| src/lib/rate-limit-redis.ts:235:  * Check map rate limits (both burst and sustained).
037157| NOTE: Block comment line describing behavior or context.
037158| src/lib/rate-limit-redis.ts:236:  * Returns success: false if either limit is exceeded.
037159| NOTE: Block comment line describing behavior or context.
037160| src/lib/rate-limit-redis.ts:237:  *
037161| NOTE: Block comment line describing behavior or context.
037162| src/lib/rate-limit-redis.ts:238:  * FAIL-CLOSED: On Redis error or misconfiguration in production,
037163| NOTE: Block comment line describing behavior or context.
037164| src/lib/rate-limit-redis.ts:239:  * denies requests to prevent abuse during outages.
037165| NOTE: Block comment line describing behavior or context.
037166| src/lib/rate-limit-redis.ts:240:  *
037167| NOTE: Block comment line describing behavior or context.
037168| src/lib/rate-limit-redis.ts:241:  * @param ip - Client IP address
037169| NOTE: Block comment line describing behavior or context.
037170| src/lib/rate-limit-redis.ts:242:  * @returns Rate limit result with optional retry-after seconds
037171| NOTE: Block comment line describing behavior or context.
037172| src/lib/rate-limit-redis.ts:243:  */
037173| NOTE: Block comment line describing behavior or context.
037174| src/lib/rate-limit-redis.ts:244: export async function checkMapRateLimit(ip: string): Promise<RateLimitResult> {
037175| NOTE: Implementation detail supporting search page behavior.
037176| src/lib/rate-limit-redis.ts:245:   // Check if Redis is configured
037177| NOTE: Line comment documents intent or constraints.
037178| src/lib/rate-limit-redis.ts:246:   if (
037179| NOTE: Conditional logic controlling rendering or flow.
037180| src/lib/rate-limit-redis.ts:247:     !process.env.UPSTASH_REDIS_REST_URL ||
037181| NOTE: Implementation detail supporting search page behavior.
037182| src/lib/rate-limit-redis.ts:248:     !process.env.UPSTASH_REDIS_REST_TOKEN
037183| NOTE: Implementation detail supporting search page behavior.
037184| src/lib/rate-limit-redis.ts:249:   ) {
037185| NOTE: Implementation detail supporting search page behavior.
037186| src/lib/rate-limit-redis.ts:250:     // Skip rate limiting in development without Redis
037187| NOTE: Line comment documents intent or constraints.
037188| src/lib/rate-limit-redis.ts:251:     if (process.env.NODE_ENV === "development") {
037189| NOTE: Conditional logic controlling rendering or flow.
037190| src/lib/rate-limit-redis.ts:252:       return { success: true };
037191| NOTE: Return statement for component or helper output.
037192| src/lib/rate-limit-redis.ts:253:     }
037193| NOTE: Implementation detail supporting search page behavior.
037194| src/lib/rate-limit-redis.ts:254:     // FAIL CLOSED in production - security over availability
037195| NOTE: Line comment documents intent or constraints.
037196| src/lib/rate-limit-redis.ts:255:     console.error("[RateLimit] Redis not configured in production for map API");
037197| NOTE: Implementation detail supporting search page behavior.
037198| src/lib/rate-limit-redis.ts:256:     return { success: false, retryAfter: 60 };
037199| NOTE: Return statement for component or helper output.
037200| src/lib/rate-limit-redis.ts:257:   }
037201| NOTE: Implementation detail supporting search page behavior.
037202| src/lib/rate-limit-redis.ts:258: 
037203| NOTE: Blank line for visual separation.
037204| src/lib/rate-limit-redis.ts:259:   try {
037205| NOTE: Implementation detail supporting search page behavior.
037206| src/lib/rate-limit-redis.ts:260:     // Check burst limit first (more likely to be hit during rapid pan)
037207| NOTE: Line comment documents intent or constraints.
037208| src/lib/rate-limit-redis.ts:261:     const burstResult = await mapBurstLimiter.limit(ip);
037209| NOTE: Local declaration used by search logic or UI.
037210| src/lib/rate-limit-redis.ts:262:     if (!burstResult.success) {
037211| NOTE: Conditional logic controlling rendering or flow.
037212| src/lib/rate-limit-redis.ts:263:       return {
037213| NOTE: Return statement for component or helper output.
037214| src/lib/rate-limit-redis.ts:264:         success: false,
037215| NOTE: Implementation detail supporting search page behavior.
037216| src/lib/rate-limit-redis.ts:265:         retryAfter: Math.ceil((burstResult.reset - Date.now()) / 1000),
037217| NOTE: Implementation detail supporting search page behavior.
037218| src/lib/rate-limit-redis.ts:266:       };
037219| NOTE: Implementation detail supporting search page behavior.
037220| src/lib/rate-limit-redis.ts:267:     }
037221| NOTE: Implementation detail supporting search page behavior.
037222| src/lib/rate-limit-redis.ts:268: 
037223| NOTE: Blank line for visual separation.
037224| src/lib/rate-limit-redis.ts:269:     // Check sustained limit (catches slow scraping)
037225| NOTE: Line comment documents intent or constraints.
037226| src/lib/rate-limit-redis.ts:270:     const sustainedResult = await mapSustainedLimiter.limit(ip);
037227| NOTE: Local declaration used by search logic or UI.
037228| src/lib/rate-limit-redis.ts:271:     if (!sustainedResult.success) {
037229| NOTE: Conditional logic controlling rendering or flow.
037230| src/lib/rate-limit-redis.ts:272:       return {
037231| NOTE: Return statement for component or helper output.
037232| src/lib/rate-limit-redis.ts:273:         success: false,
037233| NOTE: Implementation detail supporting search page behavior.
037234| src/lib/rate-limit-redis.ts:274:         retryAfter: Math.ceil((sustainedResult.reset - Date.now()) / 1000),
037235| NOTE: Implementation detail supporting search page behavior.
037236| src/lib/rate-limit-redis.ts:275:       };
037237| NOTE: Implementation detail supporting search page behavior.
037238| src/lib/rate-limit-redis.ts:276:     }
037239| NOTE: Implementation detail supporting search page behavior.
037240| src/lib/rate-limit-redis.ts:277: 
037241| NOTE: Blank line for visual separation.
037242| src/lib/rate-limit-redis.ts:278:     return { success: true };
037243| NOTE: Return statement for component or helper output.
037244| src/lib/rate-limit-redis.ts:279:   } catch (error) {
037245| NOTE: Implementation detail supporting search page behavior.
037246| src/lib/rate-limit-redis.ts:280:     console.error("[RateLimit] Redis error for map API:", error);
037247| NOTE: Implementation detail supporting search page behavior.
037248| src/lib/rate-limit-redis.ts:281:     // FAIL CLOSED in production - prevents abuse during Redis outages
037249| NOTE: Line comment documents intent or constraints.
037250| src/lib/rate-limit-redis.ts:282:     if (process.env.NODE_ENV === "production") {
037251| NOTE: Conditional logic controlling rendering or flow.
037252| src/lib/rate-limit-redis.ts:283:       return { success: false, retryAfter: 60 };
037253| NOTE: Return statement for component or helper output.
037254| src/lib/rate-limit-redis.ts:284:     }
037255| NOTE: Implementation detail supporting search page behavior.
037256| src/lib/rate-limit-redis.ts:285:     // Allow in development for local testing without Redis
037257| NOTE: Line comment documents intent or constraints.
037258| src/lib/rate-limit-redis.ts:286:     return { success: true };
037259| NOTE: Return statement for component or helper output.
037260| src/lib/rate-limit-redis.ts:287:   }
037261| NOTE: Implementation detail supporting search page behavior.
037262| src/lib/rate-limit-redis.ts:288: }
037263| NOTE: Implementation detail supporting search page behavior.
037264| src/lib/rate-limit-redis.ts:289: 
037265| NOTE: Blank line for visual separation.
037266| src/lib/rate-limit-redis.ts:290: /**
037267| NOTE: Block comment line describing behavior or context.
037268| src/lib/rate-limit-redis.ts:291:  * Check search count rate limits (both burst and sustained).
037269| NOTE: Block comment line describing behavior or context.
037270| src/lib/rate-limit-redis.ts:292:  * Returns success: false if either limit is exceeded.
037271| NOTE: Block comment line describing behavior or context.
037272| src/lib/rate-limit-redis.ts:293:  *
037273| NOTE: Block comment line describing behavior or context.
037274| src/lib/rate-limit-redis.ts:294:  * FAIL-CLOSED: On Redis error or misconfiguration in production,
037275| NOTE: Block comment line describing behavior or context.
037276| src/lib/rate-limit-redis.ts:295:  * denies requests to prevent abuse during outages.
037277| NOTE: Block comment line describing behavior or context.
037278| src/lib/rate-limit-redis.ts:296:  *
037279| NOTE: Block comment line describing behavior or context.
037280| src/lib/rate-limit-redis.ts:297:  * @param ip - Client IP address
037281| NOTE: Block comment line describing behavior or context.
037282| src/lib/rate-limit-redis.ts:298:  * @returns Rate limit result with optional retry-after seconds
037283| NOTE: Block comment line describing behavior or context.
037284| src/lib/rate-limit-redis.ts:299:  */
037285| NOTE: Block comment line describing behavior or context.
037286| src/lib/rate-limit-redis.ts:300: export async function checkSearchCountRateLimit(
037287| NOTE: Implementation detail supporting search page behavior.
037288| src/lib/rate-limit-redis.ts:301:   ip: string,
037289| NOTE: Implementation detail supporting search page behavior.
037290| src/lib/rate-limit-redis.ts:302: ): Promise<RateLimitResult> {
037291| NOTE: Implementation detail supporting search page behavior.
037292| src/lib/rate-limit-redis.ts:303:   // Check if Redis is configured
037293| NOTE: Line comment documents intent or constraints.
037294| src/lib/rate-limit-redis.ts:304:   if (
037295| NOTE: Conditional logic controlling rendering or flow.
037296| src/lib/rate-limit-redis.ts:305:     !process.env.UPSTASH_REDIS_REST_URL ||
037297| NOTE: Implementation detail supporting search page behavior.
037298| src/lib/rate-limit-redis.ts:306:     !process.env.UPSTASH_REDIS_REST_TOKEN
037299| NOTE: Implementation detail supporting search page behavior.
037300| src/lib/rate-limit-redis.ts:307:   ) {
037301| NOTE: Implementation detail supporting search page behavior.
037302| src/lib/rate-limit-redis.ts:308:     // Skip rate limiting in development without Redis
037303| NOTE: Line comment documents intent or constraints.
037304| src/lib/rate-limit-redis.ts:309:     if (process.env.NODE_ENV === "development") {
037305| NOTE: Conditional logic controlling rendering or flow.
037306| src/lib/rate-limit-redis.ts:310:       return { success: true };
037307| NOTE: Return statement for component or helper output.
037308| src/lib/rate-limit-redis.ts:311:     }
037309| NOTE: Implementation detail supporting search page behavior.
037310| src/lib/rate-limit-redis.ts:312:     // FAIL CLOSED in production - security over availability
037311| NOTE: Line comment documents intent or constraints.
037312| src/lib/rate-limit-redis.ts:313:     console.error(
037313| NOTE: Implementation detail supporting search page behavior.
037314| src/lib/rate-limit-redis.ts:314:       "[RateLimit] Redis not configured in production for search-count API",
037315| NOTE: Implementation detail supporting search page behavior.
037316| src/lib/rate-limit-redis.ts:315:     );
037317| NOTE: Implementation detail supporting search page behavior.
037318| src/lib/rate-limit-redis.ts:316:     return { success: false, retryAfter: 60 };
037319| NOTE: Return statement for component or helper output.
037320| src/lib/rate-limit-redis.ts:317:   }
037321| NOTE: Implementation detail supporting search page behavior.
037322| src/lib/rate-limit-redis.ts:318: 
037323| NOTE: Blank line for visual separation.
037324| src/lib/rate-limit-redis.ts:319:   try {
037325| NOTE: Implementation detail supporting search page behavior.
037326| src/lib/rate-limit-redis.ts:320:     // Check burst limit first
037327| NOTE: Line comment documents intent or constraints.
037328| src/lib/rate-limit-redis.ts:321:     const burstResult = await searchCountBurstLimiter.limit(ip);
037329| NOTE: Local declaration used by search logic or UI.
037330| src/lib/rate-limit-redis.ts:322:     if (!burstResult.success) {
037331| NOTE: Conditional logic controlling rendering or flow.
037332| src/lib/rate-limit-redis.ts:323:       return {
037333| NOTE: Return statement for component or helper output.
037334| src/lib/rate-limit-redis.ts:324:         success: false,
037335| NOTE: Implementation detail supporting search page behavior.
037336| src/lib/rate-limit-redis.ts:325:         retryAfter: Math.ceil((burstResult.reset - Date.now()) / 1000),
037337| NOTE: Implementation detail supporting search page behavior.
037338| src/lib/rate-limit-redis.ts:326:       };
037339| NOTE: Implementation detail supporting search page behavior.
037340| src/lib/rate-limit-redis.ts:327:     }
037341| NOTE: Implementation detail supporting search page behavior.
037342| src/lib/rate-limit-redis.ts:328: 
037343| NOTE: Blank line for visual separation.
037344| src/lib/rate-limit-redis.ts:329:     // Check sustained limit
037345| NOTE: Line comment documents intent or constraints.
037346| src/lib/rate-limit-redis.ts:330:     const sustainedResult = await searchCountSustainedLimiter.limit(ip);
037347| NOTE: Local declaration used by search logic or UI.
037348| src/lib/rate-limit-redis.ts:331:     if (!sustainedResult.success) {
037349| NOTE: Conditional logic controlling rendering or flow.
037350| src/lib/rate-limit-redis.ts:332:       return {
037351| NOTE: Return statement for component or helper output.
037352| src/lib/rate-limit-redis.ts:333:         success: false,
037353| NOTE: Implementation detail supporting search page behavior.
037354| src/lib/rate-limit-redis.ts:334:         retryAfter: Math.ceil((sustainedResult.reset - Date.now()) / 1000),
037355| NOTE: Implementation detail supporting search page behavior.
037356| src/lib/rate-limit-redis.ts:335:       };
037357| NOTE: Implementation detail supporting search page behavior.
037358| src/lib/rate-limit-redis.ts:336:     }
037359| NOTE: Implementation detail supporting search page behavior.
037360| src/lib/rate-limit-redis.ts:337: 
037361| NOTE: Blank line for visual separation.
037362| src/lib/rate-limit-redis.ts:338:     return { success: true };
037363| NOTE: Return statement for component or helper output.
037364| src/lib/rate-limit-redis.ts:339:   } catch (error) {
037365| NOTE: Implementation detail supporting search page behavior.
037366| src/lib/rate-limit-redis.ts:340:     console.error("[RateLimit] Redis error for search-count API:", error);
037367| NOTE: Implementation detail supporting search page behavior.
037368| src/lib/rate-limit-redis.ts:341:     // FAIL CLOSED in production - prevents abuse during Redis outages
037369| NOTE: Line comment documents intent or constraints.
037370| src/lib/rate-limit-redis.ts:342:     if (process.env.NODE_ENV === "production") {
037371| NOTE: Conditional logic controlling rendering or flow.
037372| src/lib/rate-limit-redis.ts:343:       return { success: false, retryAfter: 60 };
037373| NOTE: Return statement for component or helper output.
037374| src/lib/rate-limit-redis.ts:344:     }
037375| NOTE: Implementation detail supporting search page behavior.
037376| src/lib/rate-limit-redis.ts:345:     // Allow in development for local testing without Redis
037377| NOTE: Line comment documents intent or constraints.
037378| src/lib/rate-limit-redis.ts:346:     return { success: true };
037379| NOTE: Return statement for component or helper output.
037380| src/lib/rate-limit-redis.ts:347:   }
037381| NOTE: Implementation detail supporting search page behavior.
037382| src/lib/rate-limit-redis.ts:348: }
037383| NOTE: Implementation detail supporting search page behavior.
037384| FILE END: src/lib/rate-limit-redis.ts
037385| 
037386| FILE START: src/lib/rate-limit.ts
037387| FILE ROLE: Auto-discovered dependency in search page graph.
037388| src/lib/rate-limit.ts:1: import { prisma } from "@/lib/prisma";
037389| NOTE: Imports dependency for this module.
037390| src/lib/rate-limit.ts:2: 
037391| NOTE: Blank line for visual separation.
037392| src/lib/rate-limit.ts:3: interface RateLimitResult {
037393| NOTE: Type declaration for search data contracts.
037394| src/lib/rate-limit.ts:4:   success: boolean;
037395| NOTE: Implementation detail supporting search page behavior.
037396| src/lib/rate-limit.ts:5:   remaining: number;
037397| NOTE: Implementation detail supporting search page behavior.
037398| src/lib/rate-limit.ts:6:   resetAt: Date;
037399| NOTE: Implementation detail supporting search page behavior.
037400| src/lib/rate-limit.ts:7:   retryAfter?: number; // seconds until reset
037401| NOTE: Implementation detail supporting search page behavior.
037402| src/lib/rate-limit.ts:8: }
037403| NOTE: Implementation detail supporting search page behavior.
037404| src/lib/rate-limit.ts:9: 
037405| NOTE: Blank line for visual separation.
037406| src/lib/rate-limit.ts:10: interface RateLimitConfig {
037407| NOTE: Type declaration for search data contracts.
037408| src/lib/rate-limit.ts:11:   limit: number; // max requests allowed
037409| NOTE: Implementation detail supporting search page behavior.
037410| src/lib/rate-limit.ts:12:   windowMs: number; // time window in milliseconds
037411| NOTE: Implementation detail supporting search page behavior.
037412| src/lib/rate-limit.ts:13: }
037413| NOTE: Implementation detail supporting search page behavior.
037414| src/lib/rate-limit.ts:14: 
037415| NOTE: Blank line for visual separation.
037416| src/lib/rate-limit.ts:15: /**
037417| NOTE: Block comment line describing behavior or context.
037418| src/lib/rate-limit.ts:16:  * Database-backed rate limiter for Vercel serverless
037419| NOTE: Block comment line describing behavior or context.
037420| src/lib/rate-limit.ts:17:  * Uses sliding window algorithm with PostgreSQL
037421| NOTE: Block comment line describing behavior or context.
037422| src/lib/rate-limit.ts:18:  */
037423| NOTE: Block comment line describing behavior or context.
037424| src/lib/rate-limit.ts:19: export async function checkRateLimit(
037425| NOTE: Implementation detail supporting search page behavior.
037426| src/lib/rate-limit.ts:20:   identifier: string,
037427| NOTE: Implementation detail supporting search page behavior.
037428| src/lib/rate-limit.ts:21:   endpoint: string,
037429| NOTE: Implementation detail supporting search page behavior.
037430| src/lib/rate-limit.ts:22:   config: RateLimitConfig,
037431| NOTE: Implementation detail supporting search page behavior.
037432| src/lib/rate-limit.ts:23: ): Promise<RateLimitResult> {
037433| NOTE: Implementation detail supporting search page behavior.
037434| src/lib/rate-limit.ts:24:   const { limit, windowMs } = config;
037435| NOTE: Local declaration used by search logic or UI.
037436| src/lib/rate-limit.ts:25:   const now = new Date();
037437| NOTE: Local declaration used by search logic or UI.
037438| src/lib/rate-limit.ts:26:   const windowStart = new Date(now.getTime() - windowMs);
037439| NOTE: Local declaration used by search logic or UI.
037440| src/lib/rate-limit.ts:27:   const expiresAt = new Date(now.getTime() + windowMs);
037441| NOTE: Local declaration used by search logic or UI.
037442| src/lib/rate-limit.ts:28: 
037443| NOTE: Blank line for visual separation.
037444| src/lib/rate-limit.ts:29:   try {
037445| NOTE: Implementation detail supporting search page behavior.
037446| src/lib/rate-limit.ts:30:     // Clean up expired entries for this identifier/endpoint (opportunistic cleanup)
037447| NOTE: Line comment documents intent or constraints.
037448| src/lib/rate-limit.ts:31:     await prisma.rateLimitEntry.deleteMany({
037449| NOTE: Implementation detail supporting search page behavior.
037450| src/lib/rate-limit.ts:32:       where: {
037451| NOTE: Implementation detail supporting search page behavior.
037452| src/lib/rate-limit.ts:33:         identifier,
037453| NOTE: Implementation detail supporting search page behavior.
037454| src/lib/rate-limit.ts:34:         endpoint,
037455| NOTE: Implementation detail supporting search page behavior.
037456| src/lib/rate-limit.ts:35:         expiresAt: { lt: now },
037457| NOTE: Implementation detail supporting search page behavior.
037458| src/lib/rate-limit.ts:36:       },
037459| NOTE: Implementation detail supporting search page behavior.
037460| src/lib/rate-limit.ts:37:     });
037461| NOTE: Implementation detail supporting search page behavior.
037462| src/lib/rate-limit.ts:38: 
037463| NOTE: Blank line for visual separation.
037464| src/lib/rate-limit.ts:39:     // Try to find existing entry within the current window
037465| NOTE: Line comment documents intent or constraints.
037466| src/lib/rate-limit.ts:40:     const existing = await prisma.rateLimitEntry.findUnique({
037467| NOTE: Local declaration used by search logic or UI.
037468| src/lib/rate-limit.ts:41:       where: {
037469| NOTE: Implementation detail supporting search page behavior.
037470| src/lib/rate-limit.ts:42:         identifier_endpoint: { identifier, endpoint },
037471| NOTE: Implementation detail supporting search page behavior.
037472| src/lib/rate-limit.ts:43:       },
037473| NOTE: Implementation detail supporting search page behavior.
037474| src/lib/rate-limit.ts:44:     });
037475| NOTE: Implementation detail supporting search page behavior.
037476| src/lib/rate-limit.ts:45: 
037477| NOTE: Blank line for visual separation.
037478| src/lib/rate-limit.ts:46:     if (existing && existing.windowStart > windowStart) {
037479| NOTE: Conditional logic controlling rendering or flow.
037480| src/lib/rate-limit.ts:47:       // Entry exists and is within the current window
037481| NOTE: Line comment documents intent or constraints.
037482| src/lib/rate-limit.ts:48:       if (existing.count >= limit) {
037483| NOTE: Conditional logic controlling rendering or flow.
037484| src/lib/rate-limit.ts:49:         const resetAt = new Date(existing.windowStart.getTime() + windowMs);
037485| NOTE: Local declaration used by search logic or UI.
037486| src/lib/rate-limit.ts:50:         const retryAfter = Math.ceil(
037487| NOTE: Local declaration used by search logic or UI.
037488| src/lib/rate-limit.ts:51:           (resetAt.getTime() - now.getTime()) / 1000,
037489| NOTE: Implementation detail supporting search page behavior.
037490| src/lib/rate-limit.ts:52:         );
037491| NOTE: Implementation detail supporting search page behavior.
037492| src/lib/rate-limit.ts:53:         return {
037493| NOTE: Return statement for component or helper output.
037494| src/lib/rate-limit.ts:54:           success: false,
037495| NOTE: Implementation detail supporting search page behavior.
037496| src/lib/rate-limit.ts:55:           remaining: 0,
037497| NOTE: Implementation detail supporting search page behavior.
037498| src/lib/rate-limit.ts:56:           resetAt,
037499| NOTE: Implementation detail supporting search page behavior.
037500| src/lib/rate-limit.ts:57:           retryAfter: Math.max(1, retryAfter),
037501| NOTE: Implementation detail supporting search page behavior.
037502| src/lib/rate-limit.ts:58:         };
037503| NOTE: Implementation detail supporting search page behavior.
037504| src/lib/rate-limit.ts:59:       }
037505| NOTE: Implementation detail supporting search page behavior.
037506| src/lib/rate-limit.ts:60: 
037507| NOTE: Blank line for visual separation.
037508| src/lib/rate-limit.ts:61:       // Increment the count
037509| NOTE: Line comment documents intent or constraints.
037510| src/lib/rate-limit.ts:62:       const updated = await prisma.rateLimitEntry.update({
037511| NOTE: Local declaration used by search logic or UI.
037512| src/lib/rate-limit.ts:63:         where: { id: existing.id },
037513| NOTE: Implementation detail supporting search page behavior.
037514| src/lib/rate-limit.ts:64:         data: { count: existing.count + 1 },
037515| NOTE: Implementation detail supporting search page behavior.
037516| src/lib/rate-limit.ts:65:       });
037517| NOTE: Implementation detail supporting search page behavior.
037518| src/lib/rate-limit.ts:66: 
037519| NOTE: Blank line for visual separation.
037520| src/lib/rate-limit.ts:67:       const resetAt = new Date(existing.windowStart.getTime() + windowMs);
037521| NOTE: Local declaration used by search logic or UI.
037522| src/lib/rate-limit.ts:68:       return {
037523| NOTE: Return statement for component or helper output.
037524| src/lib/rate-limit.ts:69:         success: true,
037525| NOTE: Implementation detail supporting search page behavior.
037526| src/lib/rate-limit.ts:70:         remaining: Math.max(0, limit - updated.count),
037527| NOTE: Implementation detail supporting search page behavior.
037528| src/lib/rate-limit.ts:71:         resetAt,
037529| NOTE: Implementation detail supporting search page behavior.
037530| src/lib/rate-limit.ts:72:       };
037531| NOTE: Implementation detail supporting search page behavior.
037532| src/lib/rate-limit.ts:73:     }
037533| NOTE: Implementation detail supporting search page behavior.
037534| src/lib/rate-limit.ts:74: 
037535| NOTE: Blank line for visual separation.
037536| src/lib/rate-limit.ts:75:     // Create new entry or reset the window
037537| NOTE: Line comment documents intent or constraints.
037538| src/lib/rate-limit.ts:76:     await prisma.rateLimitEntry.upsert({
037539| NOTE: Implementation detail supporting search page behavior.
037540| src/lib/rate-limit.ts:77:       where: {
037541| NOTE: Implementation detail supporting search page behavior.
037542| src/lib/rate-limit.ts:78:         identifier_endpoint: { identifier, endpoint },
037543| NOTE: Implementation detail supporting search page behavior.
037544| src/lib/rate-limit.ts:79:       },
037545| NOTE: Implementation detail supporting search page behavior.
037546| src/lib/rate-limit.ts:80:       create: {
037547| NOTE: Implementation detail supporting search page behavior.
037548| src/lib/rate-limit.ts:81:         identifier,
037549| NOTE: Implementation detail supporting search page behavior.
037550| src/lib/rate-limit.ts:82:         endpoint,
037551| NOTE: Implementation detail supporting search page behavior.
037552| src/lib/rate-limit.ts:83:         count: 1,
037553| NOTE: Implementation detail supporting search page behavior.
037554| src/lib/rate-limit.ts:84:         windowStart: now,
037555| NOTE: Implementation detail supporting search page behavior.
037556| src/lib/rate-limit.ts:85:         expiresAt,
037557| NOTE: Implementation detail supporting search page behavior.
037558| src/lib/rate-limit.ts:86:       },
037559| NOTE: Implementation detail supporting search page behavior.
037560| src/lib/rate-limit.ts:87:       update: {
037561| NOTE: Implementation detail supporting search page behavior.
037562| src/lib/rate-limit.ts:88:         count: 1,
037563| NOTE: Implementation detail supporting search page behavior.
037564| src/lib/rate-limit.ts:89:         windowStart: now,
037565| NOTE: Implementation detail supporting search page behavior.
037566| src/lib/rate-limit.ts:90:         expiresAt,
037567| NOTE: Implementation detail supporting search page behavior.
037568| src/lib/rate-limit.ts:91:       },
037569| NOTE: Implementation detail supporting search page behavior.
037570| src/lib/rate-limit.ts:92:     });
037571| NOTE: Implementation detail supporting search page behavior.
037572| src/lib/rate-limit.ts:93: 
037573| NOTE: Blank line for visual separation.
037574| src/lib/rate-limit.ts:94:     return {
037575| NOTE: Return statement for component or helper output.
037576| src/lib/rate-limit.ts:95:       success: true,
037577| NOTE: Implementation detail supporting search page behavior.
037578| src/lib/rate-limit.ts:96:       remaining: limit - 1,
037579| NOTE: Implementation detail supporting search page behavior.
037580| src/lib/rate-limit.ts:97:       resetAt: expiresAt,
037581| NOTE: Implementation detail supporting search page behavior.
037582| src/lib/rate-limit.ts:98:     };
037583| NOTE: Implementation detail supporting search page behavior.
037584| src/lib/rate-limit.ts:99:   } catch (error) {
037585| NOTE: Implementation detail supporting search page behavior.
037586| src/lib/rate-limit.ts:100:     console.error("Rate limit check error:", error);
037587| NOTE: Implementation detail supporting search page behavior.
037588| src/lib/rate-limit.ts:101:     // On error, allow the request but log it
037589| NOTE: Line comment documents intent or constraints.
037590| src/lib/rate-limit.ts:102:     return {
037591| NOTE: Return statement for component or helper output.
037592| src/lib/rate-limit.ts:103:       success: true,
037593| NOTE: Implementation detail supporting search page behavior.
037594| src/lib/rate-limit.ts:104:       remaining: limit,
037595| NOTE: Implementation detail supporting search page behavior.
037596| src/lib/rate-limit.ts:105:       resetAt: expiresAt,
037597| NOTE: Implementation detail supporting search page behavior.
037598| src/lib/rate-limit.ts:106:     };
037599| NOTE: Implementation detail supporting search page behavior.
037600| src/lib/rate-limit.ts:107:   }
037601| NOTE: Implementation detail supporting search page behavior.
037602| src/lib/rate-limit.ts:108: }
037603| NOTE: Implementation detail supporting search page behavior.
037604| src/lib/rate-limit.ts:109: 
037605| NOTE: Blank line for visual separation.
037606| src/lib/rate-limit.ts:110: // Predefined rate limit configurations
037607| NOTE: Line comment documents intent or constraints.
037608| src/lib/rate-limit.ts:111: export const RATE_LIMITS = {
037609| NOTE: Implementation detail supporting search page behavior.
037610| src/lib/rate-limit.ts:112:   register: { limit: 5, windowMs: 60 * 60 * 1000 }, // 5 per hour
037611| NOTE: Implementation detail supporting search page behavior.
037612| src/lib/rate-limit.ts:113:   forgotPassword: { limit: 5, windowMs: 15 * 60 * 1000 }, // 5 per 15 minutes
037613| NOTE: Implementation detail supporting search page behavior.
037614| src/lib/rate-limit.ts:114:   resendVerification: { limit: 3, windowMs: 60 * 60 * 1000 }, // 3 per hour
037615| NOTE: Implementation detail supporting search page behavior.
037616| src/lib/rate-limit.ts:115:   upload: { limit: 20, windowMs: 60 * 60 * 1000 }, // 20 per hour
037617| NOTE: Implementation detail supporting search page behavior.
037618| src/lib/rate-limit.ts:116:   messages: { limit: 60, windowMs: 60 * 60 * 1000 }, // 60 per hour
037619| NOTE: Implementation detail supporting search page behavior.
037620| src/lib/rate-limit.ts:117:   listings: { limit: 10, windowMs: 24 * 60 * 60 * 1000 }, // 10 per day
037621| NOTE: Implementation detail supporting search page behavior.
037622| src/lib/rate-limit.ts:118:   // P1 fixes: Additional rate limits for unprotected endpoints
037623| NOTE: Line comment documents intent or constraints.
037624| src/lib/rate-limit.ts:119:   verifyEmail: { limit: 10, windowMs: 60 * 60 * 1000 }, // 10 per hour
037625| NOTE: Implementation detail supporting search page behavior.
037626| src/lib/rate-limit.ts:120:   resetPassword: { limit: 5, windowMs: 60 * 60 * 1000 }, // 5 per hour
037627| NOTE: Implementation detail supporting search page behavior.
037628| src/lib/rate-limit.ts:121:   createListing: { limit: 5, windowMs: 24 * 60 * 60 * 1000 }, // 5 per day
037629| NOTE: Implementation detail supporting search page behavior.
037630| src/lib/rate-limit.ts:122:   sendMessage: { limit: 100, windowMs: 60 * 60 * 1000 }, // 100 per hour
037631| NOTE: Implementation detail supporting search page behavior.
037632| src/lib/rate-limit.ts:123:   createReview: { limit: 10, windowMs: 24 * 60 * 60 * 1000 }, // 10 per day
037633| NOTE: Implementation detail supporting search page behavior.
037634| src/lib/rate-limit.ts:124:   agent: { limit: 20, windowMs: 60 * 60 * 1000 }, // 20 per hour
037635| NOTE: Implementation detail supporting search page behavior.
037636| src/lib/rate-limit.ts:125:   // P2 fixes: Rate limits for scraping protection and abuse prevention
037637| NOTE: Line comment documents intent or constraints.
037638| src/lib/rate-limit.ts:126:   listingsRead: { limit: 100, windowMs: 60 * 60 * 1000 }, // 100 per hour (scraping protection)
037639| NOTE: Implementation detail supporting search page behavior.
037640| src/lib/rate-limit.ts:127:   unreadCount: { limit: 60, windowMs: 60 * 1000 }, // 60 per minute (frequent polling)
037641| NOTE: Implementation detail supporting search page behavior.
037642| src/lib/rate-limit.ts:128:   toggleFavorite: { limit: 60, windowMs: 60 * 60 * 1000 }, // 60 per hour
037643| NOTE: Implementation detail supporting search page behavior.
037644| src/lib/rate-limit.ts:129:   createReport: { limit: 10, windowMs: 24 * 60 * 60 * 1000 }, // 10 per day
037645| NOTE: Implementation detail supporting search page behavior.
037646| src/lib/rate-limit.ts:130:   // P0 fix: Search page rate limit to prevent DoS
037647| NOTE: Line comment documents intent or constraints.
037648| src/lib/rate-limit.ts:131:   search: { limit: 30, windowMs: 60 * 1000 }, // 30 per minute
037649| NOTE: Implementation detail supporting search page behavior.
037650| src/lib/rate-limit.ts:132:   // Nearby places search (Radar API)
037651| NOTE: Line comment documents intent or constraints.
037652| src/lib/rate-limit.ts:133:   nearbySearch: { limit: 30, windowMs: 60 * 1000 }, // 30 per minute
037653| NOTE: Implementation detail supporting search page behavior.
037654| src/lib/rate-limit.ts:134: } as const;
037655| NOTE: Implementation detail supporting search page behavior.
037656| src/lib/rate-limit.ts:135: 
037657| NOTE: Blank line for visual separation.
037658| src/lib/rate-limit.ts:136: /**
037659| NOTE: Block comment line describing behavior or context.
037660| src/lib/rate-limit.ts:137:  * Get client IP from request headers (Vercel compatible)
037661| NOTE: Block comment line describing behavior or context.
037662| src/lib/rate-limit.ts:138:  *
037663| NOTE: Block comment line describing behavior or context.
037664| src/lib/rate-limit.ts:139:  * SECURITY: x-real-ip is set by Vercel's edge and cannot be spoofed.
037665| NOTE: Block comment line describing behavior or context.
037666| src/lib/rate-limit.ts:140:  * x-forwarded-for CAN be spoofed by clients, so only trust it in dev.
037667| NOTE: Block comment line describing behavior or context.
037668| src/lib/rate-limit.ts:141:  */
037669| NOTE: Block comment line describing behavior or context.
037670| src/lib/rate-limit.ts:142: export function getClientIP(request: Request): string {
037671| NOTE: Exports helper or component function.
037672| src/lib/rate-limit.ts:143:   // On Vercel, x-real-ip is set by the edge and cannot be spoofed
037673| NOTE: Line comment documents intent or constraints.
037674| src/lib/rate-limit.ts:144:   // ALWAYS prefer it over x-forwarded-for which can be manipulated
037675| NOTE: Line comment documents intent or constraints.
037676| src/lib/rate-limit.ts:145:   const realIP = request.headers.get("x-real-ip");
037677| NOTE: Local declaration used by search logic or UI.
037678| src/lib/rate-limit.ts:146:   if (realIP) {
037679| NOTE: Conditional logic controlling rendering or flow.
037680| src/lib/rate-limit.ts:147:     return realIP;
037681| NOTE: Return statement for component or helper output.
037682| src/lib/rate-limit.ts:148:   }
037683| NOTE: Implementation detail supporting search page behavior.
037684| src/lib/rate-limit.ts:149: 
037685| NOTE: Blank line for visual separation.
037686| src/lib/rate-limit.ts:150:   // Fallback for non-Vercel environments (local dev only)
037687| NOTE: Line comment documents intent or constraints.
037688| src/lib/rate-limit.ts:151:   const forwarded = request.headers.get("x-forwarded-for");
037689| NOTE: Local declaration used by search logic or UI.
037690| src/lib/rate-limit.ts:152:   if (forwarded && process.env.NODE_ENV === "development") {
037691| NOTE: Conditional logic controlling rendering or flow.
037692| src/lib/rate-limit.ts:153:     return forwarded.split(",")[0].trim();
037693| NOTE: Return statement for component or helper output.
037694| src/lib/rate-limit.ts:154:   }
037695| NOTE: Implementation detail supporting search page behavior.
037696| src/lib/rate-limit.ts:155: 
037697| NOTE: Blank line for visual separation.
037698| src/lib/rate-limit.ts:156:   // Fallback
037699| NOTE: Line comment documents intent or constraints.
037700| src/lib/rate-limit.ts:157:   return "unknown";
037701| NOTE: Return statement for component or helper output.
037702| src/lib/rate-limit.ts:158: }
037703| NOTE: Implementation detail supporting search page behavior.
037704| src/lib/rate-limit.ts:159: 
037705| NOTE: Blank line for visual separation.
037706| src/lib/rate-limit.ts:160: /**
037707| NOTE: Block comment line describing behavior or context.
037708| src/lib/rate-limit.ts:161:  * Get client IP from Headers object (for Server Components)
037709| NOTE: Block comment line describing behavior or context.
037710| src/lib/rate-limit.ts:162:  * Server Components cannot access the Request object directly,
037711| NOTE: Block comment line describing behavior or context.
037712| src/lib/rate-limit.ts:163:  * so this version takes a Headers object from next/headers.
037713| NOTE: Block comment line describing behavior or context.
037714| src/lib/rate-limit.ts:164:  *
037715| NOTE: Block comment line describing behavior or context.
037716| src/lib/rate-limit.ts:165:  * SECURITY: Same trust model as getClientIP - prefer x-real-ip on Vercel.
037717| NOTE: Block comment line describing behavior or context.
037718| src/lib/rate-limit.ts:166:  */
037719| NOTE: Block comment line describing behavior or context.
037720| src/lib/rate-limit.ts:167: export function getClientIPFromHeaders(headersList: Headers): string {
037721| NOTE: Exports helper or component function.
037722| src/lib/rate-limit.ts:168:   // On Vercel, x-real-ip is set by the edge and cannot be spoofed
037723| NOTE: Line comment documents intent or constraints.
037724| src/lib/rate-limit.ts:169:   const realIP = headersList.get("x-real-ip");
037725| NOTE: Local declaration used by search logic or UI.
037726| src/lib/rate-limit.ts:170:   if (realIP) {
037727| NOTE: Conditional logic controlling rendering or flow.
037728| src/lib/rate-limit.ts:171:     return realIP;
037729| NOTE: Return statement for component or helper output.
037730| src/lib/rate-limit.ts:172:   }
037731| NOTE: Implementation detail supporting search page behavior.
037732| src/lib/rate-limit.ts:173: 
037733| NOTE: Blank line for visual separation.
037734| src/lib/rate-limit.ts:174:   // Fallback for non-Vercel environments (local dev only)
037735| NOTE: Line comment documents intent or constraints.
037736| src/lib/rate-limit.ts:175:   const forwarded = headersList.get("x-forwarded-for");
037737| NOTE: Local declaration used by search logic or UI.
037738| src/lib/rate-limit.ts:176:   if (forwarded && process.env.NODE_ENV === "development") {
037739| NOTE: Conditional logic controlling rendering or flow.
037740| src/lib/rate-limit.ts:177:     return forwarded.split(",")[0].trim();
037741| NOTE: Return statement for component or helper output.
037742| src/lib/rate-limit.ts:178:   }
037743| NOTE: Implementation detail supporting search page behavior.
037744| src/lib/rate-limit.ts:179: 
037745| NOTE: Blank line for visual separation.
037746| src/lib/rate-limit.ts:180:   // Fallback
037747| NOTE: Line comment documents intent or constraints.
037748| src/lib/rate-limit.ts:181:   return "unknown";
037749| NOTE: Return statement for component or helper output.
037750| src/lib/rate-limit.ts:182: }
037751| NOTE: Implementation detail supporting search page behavior.
037752| FILE END: src/lib/rate-limit.ts
037753| 
037754| FILE START: src/lib/request-context.ts
037755| FILE ROLE: Auto-discovered dependency in search page graph.
037756| src/lib/request-context.ts:1: /**
037757| NOTE: Block comment line describing behavior or context.
037758| src/lib/request-context.ts:2:  * Request context management using AsyncLocalStorage
037759| NOTE: Block comment line describing behavior or context.
037760| src/lib/request-context.ts:3:  * Provides request-scoped context (request ID, user ID) for logging and tracing
037761| NOTE: Block comment line describing behavior or context.
037762| src/lib/request-context.ts:4:  */
037763| NOTE: Block comment line describing behavior or context.
037764| src/lib/request-context.ts:5: 
037765| NOTE: Blank line for visual separation.
037766| src/lib/request-context.ts:6: import { AsyncLocalStorage } from "async_hooks";
037767| NOTE: Imports dependency for this module.
037768| src/lib/request-context.ts:7: 
037769| NOTE: Blank line for visual separation.
037770| src/lib/request-context.ts:8: /**
037771| NOTE: Block comment line describing behavior or context.
037772| src/lib/request-context.ts:9:  * Generate a UUID using Web Crypto API (Edge Runtime compatible)
037773| NOTE: Block comment line describing behavior or context.
037774| src/lib/request-context.ts:10:  * Falls back to a pseudo-random implementation for older environments
037775| NOTE: Block comment line describing behavior or context.
037776| src/lib/request-context.ts:11:  */
037777| NOTE: Block comment line describing behavior or context.
037778| src/lib/request-context.ts:12: function generateUUID(): string {
037779| NOTE: Defines a helper or component function.
037780| src/lib/request-context.ts:13:   // Use Web Crypto API (available in Edge Runtime and modern browsers)
037781| NOTE: Line comment documents intent or constraints.
037782| src/lib/request-context.ts:14:   if (
037783| NOTE: Conditional logic controlling rendering or flow.
037784| src/lib/request-context.ts:15:     typeof globalThis.crypto !== "undefined" &&
037785| NOTE: Implementation detail supporting search page behavior.
037786| src/lib/request-context.ts:16:     globalThis.crypto.randomUUID
037787| NOTE: Implementation detail supporting search page behavior.
037788| src/lib/request-context.ts:17:   ) {
037789| NOTE: Implementation detail supporting search page behavior.
037790| src/lib/request-context.ts:18:     return globalThis.crypto.randomUUID();
037791| NOTE: Return statement for component or helper output.
037792| src/lib/request-context.ts:19:   }
037793| NOTE: Implementation detail supporting search page behavior.
037794| src/lib/request-context.ts:20:   // Fallback for older environments
037795| NOTE: Line comment documents intent or constraints.
037796| src/lib/request-context.ts:21:   return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
037797| NOTE: Return statement for component or helper output.
037798| src/lib/request-context.ts:22:     const r = (Math.random() * 16) | 0;
037799| NOTE: Local declaration used by search logic or UI.
037800| src/lib/request-context.ts:23:     const v = c === "x" ? r : (r & 0x3) | 0x8;
037801| NOTE: Local declaration used by search logic or UI.
037802| src/lib/request-context.ts:24:     return v.toString(16);
037803| NOTE: Return statement for component or helper output.
037804| src/lib/request-context.ts:25:   });
037805| NOTE: Implementation detail supporting search page behavior.
037806| src/lib/request-context.ts:26: }
037807| NOTE: Implementation detail supporting search page behavior.
037808| src/lib/request-context.ts:27: 
037809| NOTE: Blank line for visual separation.
037810| src/lib/request-context.ts:28: export interface RequestContext {
037811| NOTE: Implementation detail supporting search page behavior.
037812| src/lib/request-context.ts:29:   requestId: string;
037813| NOTE: Implementation detail supporting search page behavior.
037814| src/lib/request-context.ts:30:   userId?: string;
037815| NOTE: Implementation detail supporting search page behavior.
037816| src/lib/request-context.ts:31:   startTime: number;
037817| NOTE: Implementation detail supporting search page behavior.
037818| src/lib/request-context.ts:32:   path?: string;
037819| NOTE: Implementation detail supporting search page behavior.
037820| src/lib/request-context.ts:33:   method?: string;
037821| NOTE: Implementation detail supporting search page behavior.
037822| src/lib/request-context.ts:34: }
037823| NOTE: Implementation detail supporting search page behavior.
037824| src/lib/request-context.ts:35: 
037825| NOTE: Blank line for visual separation.
037826| src/lib/request-context.ts:36: // AsyncLocalStorage instance for request-scoped context
037827| NOTE: Line comment documents intent or constraints.
037828| src/lib/request-context.ts:37: const requestContextStorage = new AsyncLocalStorage<RequestContext>();
037829| NOTE: Local declaration used by search logic or UI.
037830| src/lib/request-context.ts:38: 
037831| NOTE: Blank line for visual separation.
037832| src/lib/request-context.ts:39: /**
037833| NOTE: Block comment line describing behavior or context.
037834| src/lib/request-context.ts:40:  * Generate a unique request ID
037835| NOTE: Block comment line describing behavior or context.
037836| src/lib/request-context.ts:41:  * Uses x-request-id header if present, otherwise generates a UUID
037837| NOTE: Block comment line describing behavior or context.
037838| src/lib/request-context.ts:42:  */
037839| NOTE: Block comment line describing behavior or context.
037840| src/lib/request-context.ts:43: export function generateRequestId(existingId?: string): string {
037841| NOTE: Exports helper or component function.
037842| src/lib/request-context.ts:44:   return existingId || generateUUID();
037843| NOTE: Return statement for component or helper output.
037844| src/lib/request-context.ts:45: }
037845| NOTE: Implementation detail supporting search page behavior.
037846| src/lib/request-context.ts:46: 
037847| NOTE: Blank line for visual separation.
037848| src/lib/request-context.ts:47: /**
037849| NOTE: Block comment line describing behavior or context.
037850| src/lib/request-context.ts:48:  * Run a function within a request context
037851| NOTE: Block comment line describing behavior or context.
037852| src/lib/request-context.ts:49:  * All code within the callback will have access to the context via getRequestContext()
037853| NOTE: Block comment line describing behavior or context.
037854| src/lib/request-context.ts:50:  *
037855| NOTE: Block comment line describing behavior or context.
037856| src/lib/request-context.ts:51:  * @example
037857| NOTE: Block comment line describing behavior or context.
037858| src/lib/request-context.ts:52:  * ```ts
037859| NOTE: Block comment line describing behavior or context.
037860| src/lib/request-context.ts:53:  * await runWithRequestContext({ requestId: 'abc-123', userId: 'user-456' }, async () => {
037861| NOTE: Block comment line describing behavior or context.
037862| src/lib/request-context.ts:54:  *   // All logs and traces within this function will include the context
037863| NOTE: Block comment line describing behavior or context.
037864| src/lib/request-context.ts:55:  *   logger.info('Processing request');
037865| NOTE: Block comment line describing behavior or context.
037866| src/lib/request-context.ts:56:  * });
037867| NOTE: Block comment line describing behavior or context.
037868| src/lib/request-context.ts:57:  * ```
037869| NOTE: Block comment line describing behavior or context.
037870| src/lib/request-context.ts:58:  */
037871| NOTE: Block comment line describing behavior or context.
037872| src/lib/request-context.ts:59: export function runWithRequestContext<T>(
037873| NOTE: Exports helper or component function.
037874| src/lib/request-context.ts:60:   context: Partial<RequestContext>,
037875| NOTE: Implementation detail supporting search page behavior.
037876| src/lib/request-context.ts:61:   fn: () => T,
037877| NOTE: Implementation detail supporting search page behavior.
037878| src/lib/request-context.ts:62: ): T {
037879| NOTE: Implementation detail supporting search page behavior.
037880| src/lib/request-context.ts:63:   const fullContext: RequestContext = {
037881| NOTE: Local declaration used by search logic or UI.
037882| src/lib/request-context.ts:64:     requestId: context.requestId || generateRequestId(),
037883| NOTE: Implementation detail supporting search page behavior.
037884| src/lib/request-context.ts:65:     userId: context.userId,
037885| NOTE: Implementation detail supporting search page behavior.
037886| src/lib/request-context.ts:66:     startTime: context.startTime || Date.now(),
037887| NOTE: Implementation detail supporting search page behavior.
037888| src/lib/request-context.ts:67:     path: context.path,
037889| NOTE: Implementation detail supporting search page behavior.
037890| src/lib/request-context.ts:68:     method: context.method,
037891| NOTE: Implementation detail supporting search page behavior.
037892| src/lib/request-context.ts:69:   };
037893| NOTE: Implementation detail supporting search page behavior.
037894| src/lib/request-context.ts:70: 
037895| NOTE: Blank line for visual separation.
037896| src/lib/request-context.ts:71:   return requestContextStorage.run(fullContext, fn);
037897| NOTE: Return statement for component or helper output.
037898| src/lib/request-context.ts:72: }
037899| NOTE: Implementation detail supporting search page behavior.
037900| src/lib/request-context.ts:73: 
037901| NOTE: Blank line for visual separation.
037902| src/lib/request-context.ts:74: /**
037903| NOTE: Block comment line describing behavior or context.
037904| src/lib/request-context.ts:75:  * Get the current request context
037905| NOTE: Block comment line describing behavior or context.
037906| src/lib/request-context.ts:76:  * Returns undefined if called outside of a request context
037907| NOTE: Block comment line describing behavior or context.
037908| src/lib/request-context.ts:77:  */
037909| NOTE: Block comment line describing behavior or context.
037910| src/lib/request-context.ts:78: export function getRequestContext(): RequestContext | undefined {
037911| NOTE: Exports helper or component function.
037912| src/lib/request-context.ts:79:   return requestContextStorage.getStore();
037913| NOTE: Return statement for component or helper output.
037914| src/lib/request-context.ts:80: }
037915| NOTE: Implementation detail supporting search page behavior.
037916| src/lib/request-context.ts:81: 
037917| NOTE: Blank line for visual separation.
037918| src/lib/request-context.ts:82: /**
037919| NOTE: Block comment line describing behavior or context.
037920| src/lib/request-context.ts:83:  * Update the current request context
037921| NOTE: Block comment line describing behavior or context.
037922| src/lib/request-context.ts:84:  * Useful for adding user ID after authentication
037923| NOTE: Block comment line describing behavior or context.
037924| src/lib/request-context.ts:85:  */
037925| NOTE: Block comment line describing behavior or context.
037926| src/lib/request-context.ts:86: export function updateRequestContext(updates: Partial<RequestContext>): void {
037927| NOTE: Exports helper or component function.
037928| src/lib/request-context.ts:87:   const current = requestContextStorage.getStore();
037929| NOTE: Local declaration used by search logic or UI.
037930| src/lib/request-context.ts:88:   if (current) {
037931| NOTE: Conditional logic controlling rendering or flow.
037932| src/lib/request-context.ts:89:     Object.assign(current, updates);
037933| NOTE: Implementation detail supporting search page behavior.
037934| src/lib/request-context.ts:90:   }
037935| NOTE: Implementation detail supporting search page behavior.
037936| src/lib/request-context.ts:91: }
037937| NOTE: Implementation detail supporting search page behavior.
037938| src/lib/request-context.ts:92: 
037939| NOTE: Blank line for visual separation.
037940| src/lib/request-context.ts:93: /**
037941| NOTE: Block comment line describing behavior or context.
037942| src/lib/request-context.ts:94:  * Get the current request ID
037943| NOTE: Block comment line describing behavior or context.
037944| src/lib/request-context.ts:95:  * Returns 'unknown' if called outside of a request context
037945| NOTE: Block comment line describing behavior or context.
037946| src/lib/request-context.ts:96:  */
037947| NOTE: Block comment line describing behavior or context.
037948| src/lib/request-context.ts:97: export function getRequestId(): string {
037949| NOTE: Exports helper or component function.
037950| src/lib/request-context.ts:98:   return getRequestContext()?.requestId || "unknown";
037951| NOTE: Return statement for component or helper output.
037952| src/lib/request-context.ts:99: }
037953| NOTE: Implementation detail supporting search page behavior.
037954| src/lib/request-context.ts:100: 
037955| NOTE: Blank line for visual separation.
037956| src/lib/request-context.ts:101: /**
037957| NOTE: Block comment line describing behavior or context.
037958| src/lib/request-context.ts:102:  * Get the elapsed time since request start in milliseconds
037959| NOTE: Block comment line describing behavior or context.
037960| src/lib/request-context.ts:103:  */
037961| NOTE: Block comment line describing behavior or context.
037962| src/lib/request-context.ts:104: export function getRequestDuration(): number {
037963| NOTE: Exports helper or component function.
037964| src/lib/request-context.ts:105:   const context = getRequestContext();
037965| NOTE: Local declaration used by search logic or UI.
037966| src/lib/request-context.ts:106:   return context ? Date.now() - context.startTime : 0;
037967| NOTE: Return statement for component or helper output.
037968| src/lib/request-context.ts:107: }
037969| NOTE: Implementation detail supporting search page behavior.
037970| src/lib/request-context.ts:108: 
037971| NOTE: Blank line for visual separation.
037972| src/lib/request-context.ts:109: /**
037973| NOTE: Block comment line describing behavior or context.
037974| src/lib/request-context.ts:110:  * Create request context from Next.js request headers
037975| NOTE: Block comment line describing behavior or context.
037976| src/lib/request-context.ts:111:  */
037977| NOTE: Block comment line describing behavior or context.
037978| src/lib/request-context.ts:112: export function createContextFromHeaders(
037979| NOTE: Exports helper or component function.
037980| src/lib/request-context.ts:113:   headers: Headers,
037981| NOTE: Implementation detail supporting search page behavior.
037982| src/lib/request-context.ts:114: ): Partial<RequestContext> {
037983| NOTE: Implementation detail supporting search page behavior.
037984| src/lib/request-context.ts:115:   return {
037985| NOTE: Return statement for component or helper output.
037986| src/lib/request-context.ts:116:     requestId:
037987| NOTE: Implementation detail supporting search page behavior.
037988| src/lib/request-context.ts:117:       headers.get("x-request-id") ||
037989| NOTE: Implementation detail supporting search page behavior.
037990| src/lib/request-context.ts:118:       headers.get("x-vercel-id") ||
037991| NOTE: Implementation detail supporting search page behavior.
037992| src/lib/request-context.ts:119:       generateRequestId(),
037993| NOTE: Implementation detail supporting search page behavior.
037994| src/lib/request-context.ts:120:     startTime: Date.now(),
037995| NOTE: Implementation detail supporting search page behavior.
037996| src/lib/request-context.ts:121:   };
037997| NOTE: Implementation detail supporting search page behavior.
037998| src/lib/request-context.ts:122: }
037999| NOTE: Implementation detail supporting search page behavior.
038000| FILE END: src/lib/request-context.ts
038001| 
038002| FILE START: src/lib/search-params.ts
038003| FILE ROLE: Auto-discovered dependency in search page graph.
038004| src/lib/search-params.ts:1: import { normalizeLanguages } from "./languages";
038005| NOTE: Imports dependency for this module.
038006| src/lib/search-params.ts:2: 
038007| NOTE: Blank line for visual separation.
038008| src/lib/search-params.ts:3: export type SortOption =
038009| NOTE: Implementation detail supporting search page behavior.
038010| src/lib/search-params.ts:4:   | "recommended"
038011| NOTE: Implementation detail supporting search page behavior.
038012| src/lib/search-params.ts:5:   | "price_asc"
038013| NOTE: Implementation detail supporting search page behavior.
038014| src/lib/search-params.ts:6:   | "price_desc"
038015| NOTE: Implementation detail supporting search page behavior.
038016| src/lib/search-params.ts:7:   | "newest"
038017| NOTE: Implementation detail supporting search page behavior.
038018| src/lib/search-params.ts:8:   | "rating";
038019| NOTE: Implementation detail supporting search page behavior.
038020| src/lib/search-params.ts:9: 
038021| NOTE: Blank line for visual separation.
038022| src/lib/search-params.ts:10: export interface FilterParams {
038023| NOTE: Implementation detail supporting search page behavior.
038024| src/lib/search-params.ts:11:   query?: string;
038025| NOTE: Implementation detail supporting search page behavior.
038026| src/lib/search-params.ts:12:   minPrice?: number;
038027| NOTE: Implementation detail supporting search page behavior.
038028| src/lib/search-params.ts:13:   maxPrice?: number;
038029| NOTE: Implementation detail supporting search page behavior.
038030| src/lib/search-params.ts:14:   amenities?: string[];
038031| NOTE: Implementation detail supporting search page behavior.
038032| src/lib/search-params.ts:15:   moveInDate?: string;
038033| NOTE: Implementation detail supporting search page behavior.
038034| src/lib/search-params.ts:16:   leaseDuration?: string;
038035| NOTE: Implementation detail supporting search page behavior.
038036| src/lib/search-params.ts:17:   houseRules?: string[];
038037| NOTE: Implementation detail supporting search page behavior.
038038| src/lib/search-params.ts:18:   roomType?: string;
038039| NOTE: Implementation detail supporting search page behavior.
038040| src/lib/search-params.ts:19:   languages?: string[];
038041| NOTE: Implementation detail supporting search page behavior.
038042| src/lib/search-params.ts:20:   bounds?: {
038043| NOTE: Implementation detail supporting search page behavior.
038044| src/lib/search-params.ts:21:     minLat: number;
038045| NOTE: Implementation detail supporting search page behavior.
038046| src/lib/search-params.ts:22:     maxLat: number;
038047| NOTE: Implementation detail supporting search page behavior.
038048| src/lib/search-params.ts:23:     minLng: number;
038049| NOTE: Implementation detail supporting search page behavior.
038050| src/lib/search-params.ts:24:     maxLng: number;
038051| NOTE: Implementation detail supporting search page behavior.
038052| src/lib/search-params.ts:25:   };
038053| NOTE: Implementation detail supporting search page behavior.
038054| src/lib/search-params.ts:26:   sort?: SortOption;
038055| NOTE: Implementation detail supporting search page behavior.
038056| src/lib/search-params.ts:27:   /** Include near-match results (relaxed filter criteria) */
038057| NOTE: Block comment line describing behavior or context.
038058| src/lib/search-params.ts:28:   nearMatches?: boolean;
038059| NOTE: Implementation detail supporting search page behavior.
038060| src/lib/search-params.ts:29: }
038061| NOTE: Implementation detail supporting search page behavior.
038062| src/lib/search-params.ts:30: 
038063| NOTE: Blank line for visual separation.
038064| src/lib/search-params.ts:31: export interface RawSearchParams {
038065| NOTE: Implementation detail supporting search page behavior.
038066| src/lib/search-params.ts:32:   q?: string | string[];
038067| NOTE: Implementation detail supporting search page behavior.
038068| src/lib/search-params.ts:33:   minPrice?: string | string[];
038069| NOTE: Implementation detail supporting search page behavior.
038070| src/lib/search-params.ts:34:   maxPrice?: string | string[];
038071| NOTE: Implementation detail supporting search page behavior.
038072| src/lib/search-params.ts:35:   /** Alias for minPrice (budget terminology) */
038073| NOTE: Block comment line describing behavior or context.
038074| src/lib/search-params.ts:36:   minBudget?: string | string[];
038075| NOTE: Implementation detail supporting search page behavior.
038076| src/lib/search-params.ts:37:   /** Alias for maxBudget (budget terminology) */
038077| NOTE: Block comment line describing behavior or context.
038078| src/lib/search-params.ts:38:   maxBudget?: string | string[];
038079| NOTE: Implementation detail supporting search page behavior.
038080| src/lib/search-params.ts:39:   amenities?: string | string[];
038081| NOTE: Implementation detail supporting search page behavior.
038082| src/lib/search-params.ts:40:   moveInDate?: string | string[];
038083| NOTE: Implementation detail supporting search page behavior.
038084| src/lib/search-params.ts:41:   leaseDuration?: string | string[];
038085| NOTE: Implementation detail supporting search page behavior.
038086| src/lib/search-params.ts:42:   houseRules?: string | string[];
038087| NOTE: Implementation detail supporting search page behavior.
038088| src/lib/search-params.ts:43:   languages?: string | string[];
038089| NOTE: Implementation detail supporting search page behavior.
038090| src/lib/search-params.ts:44:   roomType?: string | string[];
038091| NOTE: Implementation detail supporting search page behavior.
038092| src/lib/search-params.ts:45:   minLat?: string | string[];
038093| NOTE: Implementation detail supporting search page behavior.
038094| src/lib/search-params.ts:46:   maxLat?: string | string[];
038095| NOTE: Implementation detail supporting search page behavior.
038096| src/lib/search-params.ts:47:   minLng?: string | string[];
038097| NOTE: Implementation detail supporting search page behavior.
038098| src/lib/search-params.ts:48:   maxLng?: string | string[];
038099| NOTE: Implementation detail supporting search page behavior.
038100| src/lib/search-params.ts:49:   lat?: string | string[];
038101| NOTE: Implementation detail supporting search page behavior.
038102| src/lib/search-params.ts:50:   lng?: string | string[];
038103| NOTE: Implementation detail supporting search page behavior.
038104| src/lib/search-params.ts:51:   page?: string | string[];
038105| NOTE: Implementation detail supporting search page behavior.
038106| src/lib/search-params.ts:52:   sort?: string | string[];
038107| NOTE: Implementation detail supporting search page behavior.
038108| src/lib/search-params.ts:53:   nearMatches?: string | string[];
038109| NOTE: Implementation detail supporting search page behavior.
038110| src/lib/search-params.ts:54: }
038111| NOTE: Implementation detail supporting search page behavior.
038112| src/lib/search-params.ts:55: 
038113| NOTE: Blank line for visual separation.
038114| src/lib/search-params.ts:56: export interface ParsedSearchParams {
038115| NOTE: Implementation detail supporting search page behavior.
038116| src/lib/search-params.ts:57:   q?: string;
038117| NOTE: Implementation detail supporting search page behavior.
038118| src/lib/search-params.ts:58:   requestedPage: number;
038119| NOTE: Implementation detail supporting search page behavior.
038120| src/lib/search-params.ts:59:   sortOption: SortOption;
038121| NOTE: Implementation detail supporting search page behavior.
038122| src/lib/search-params.ts:60:   filterParams: FilterParams;
038123| NOTE: Implementation detail supporting search page behavior.
038124| src/lib/search-params.ts:61: }
038125| NOTE: Implementation detail supporting search page behavior.
038126| src/lib/search-params.ts:62: 
038127| NOTE: Blank line for visual separation.
038128| src/lib/search-params.ts:63: export const MAX_SAFE_PRICE = 1000000000;
038129| NOTE: Implementation detail supporting search page behavior.
038130| src/lib/search-params.ts:64: export const MAX_SAFE_PAGE = 100;
038131| NOTE: Implementation detail supporting search page behavior.
038132| src/lib/search-params.ts:65: export const MAX_ARRAY_ITEMS = 20;
038133| NOTE: Implementation detail supporting search page behavior.
038134| src/lib/search-params.ts:66: 
038135| NOTE: Blank line for visual separation.
038136| src/lib/search-params.ts:67: export const VALID_AMENITIES = [
038137| NOTE: Implementation detail supporting search page behavior.
038138| src/lib/search-params.ts:68:   "Wifi",
038139| NOTE: Implementation detail supporting search page behavior.
038140| src/lib/search-params.ts:69:   "AC",
038141| NOTE: Implementation detail supporting search page behavior.
038142| src/lib/search-params.ts:70:   "Parking",
038143| NOTE: Implementation detail supporting search page behavior.
038144| src/lib/search-params.ts:71:   "Washer",
038145| NOTE: Implementation detail supporting search page behavior.
038146| src/lib/search-params.ts:72:   "Dryer",
038147| NOTE: Implementation detail supporting search page behavior.
038148| src/lib/search-params.ts:73:   "Kitchen",
038149| NOTE: Implementation detail supporting search page behavior.
038150| src/lib/search-params.ts:74:   "Gym",
038151| NOTE: Implementation detail supporting search page behavior.
038152| src/lib/search-params.ts:75:   "Pool",
038153| NOTE: Implementation detail supporting search page behavior.
038154| src/lib/search-params.ts:76:   "Furnished",
038155| NOTE: Implementation detail supporting search page behavior.
038156| src/lib/search-params.ts:77: ] as const;
038157| NOTE: Implementation detail supporting search page behavior.
038158| src/lib/search-params.ts:78: export const VALID_HOUSE_RULES = [
038159| NOTE: Implementation detail supporting search page behavior.
038160| src/lib/search-params.ts:79:   "Pets allowed",
038161| NOTE: Implementation detail supporting search page behavior.
038162| src/lib/search-params.ts:80:   "Smoking allowed",
038163| NOTE: Implementation detail supporting search page behavior.
038164| src/lib/search-params.ts:81:   "Couples allowed",
038165| NOTE: Implementation detail supporting search page behavior.
038166| src/lib/search-params.ts:82:   "Guests allowed",
038167| NOTE: Implementation detail supporting search page behavior.
038168| src/lib/search-params.ts:83: ] as const;
038169| NOTE: Implementation detail supporting search page behavior.
038170| src/lib/search-params.ts:84: export const VALID_LEASE_DURATIONS = [
038171| NOTE: Implementation detail supporting search page behavior.
038172| src/lib/search-params.ts:85:   "any",
038173| NOTE: Implementation detail supporting search page behavior.
038174| src/lib/search-params.ts:86:   "Month-to-month",
038175| NOTE: Implementation detail supporting search page behavior.
038176| src/lib/search-params.ts:87:   "3 months",
038177| NOTE: Implementation detail supporting search page behavior.
038178| src/lib/search-params.ts:88:   "6 months",
038179| NOTE: Implementation detail supporting search page behavior.
038180| src/lib/search-params.ts:89:   "12 months",
038181| NOTE: Implementation detail supporting search page behavior.
038182| src/lib/search-params.ts:90:   "Flexible",
038183| NOTE: Implementation detail supporting search page behavior.
038184| src/lib/search-params.ts:91: ] as const;
038185| NOTE: Implementation detail supporting search page behavior.
038186| src/lib/search-params.ts:92: // Alias mappings for alternative formats (URL-friendly formats like 6_MONTHS)
038187| NOTE: Line comment documents intent or constraints.
038188| src/lib/search-params.ts:93: export const LEASE_DURATION_ALIASES: Record<string, string> = {
038189| NOTE: Implementation detail supporting search page behavior.
038190| src/lib/search-params.ts:94:   "month-to-month": "Month-to-month",
038191| NOTE: Implementation detail supporting search page behavior.
038192| src/lib/search-params.ts:95:   month_to_month: "Month-to-month",
038193| NOTE: Implementation detail supporting search page behavior.
038194| src/lib/search-params.ts:96:   mtm: "Month-to-month",
038195| NOTE: Implementation detail supporting search page behavior.
038196| src/lib/search-params.ts:97:   "3_months": "3 months",
038197| NOTE: Implementation detail supporting search page behavior.
038198| src/lib/search-params.ts:98:   "3months": "3 months",
038199| NOTE: Implementation detail supporting search page behavior.
038200| src/lib/search-params.ts:99:   "6_months": "6 months",
038201| NOTE: Implementation detail supporting search page behavior.
038202| src/lib/search-params.ts:100:   "6months": "6 months",
038203| NOTE: Implementation detail supporting search page behavior.
038204| src/lib/search-params.ts:101:   "12_months": "12 months",
038205| NOTE: Implementation detail supporting search page behavior.
038206| src/lib/search-params.ts:102:   "12months": "12 months",
038207| NOTE: Implementation detail supporting search page behavior.
038208| src/lib/search-params.ts:103:   "1_year": "12 months",
038209| NOTE: Implementation detail supporting search page behavior.
038210| src/lib/search-params.ts:104:   "1year": "12 months",
038211| NOTE: Implementation detail supporting search page behavior.
038212| src/lib/search-params.ts:105: };
038213| NOTE: Implementation detail supporting search page behavior.
038214| src/lib/search-params.ts:106: export const VALID_ROOM_TYPES = [
038215| NOTE: Implementation detail supporting search page behavior.
038216| src/lib/search-params.ts:107:   "any",
038217| NOTE: Implementation detail supporting search page behavior.
038218| src/lib/search-params.ts:108:   "Private Room",
038219| NOTE: Implementation detail supporting search page behavior.
038220| src/lib/search-params.ts:109:   "Shared Room",
038221| NOTE: Implementation detail supporting search page behavior.
038222| src/lib/search-params.ts:110:   "Entire Place",
038223| NOTE: Implementation detail supporting search page behavior.
038224| src/lib/search-params.ts:111: ] as const;
038225| NOTE: Implementation detail supporting search page behavior.
038226| src/lib/search-params.ts:112: // Alias mappings for alternative formats (URL-friendly formats like PRIVATE)
038227| NOTE: Line comment documents intent or constraints.
038228| src/lib/search-params.ts:113: export const ROOM_TYPE_ALIASES: Record<string, string> = {
038229| NOTE: Implementation detail supporting search page behavior.
038230| src/lib/search-params.ts:114:   private: "Private Room",
038231| NOTE: Implementation detail supporting search page behavior.
038232| src/lib/search-params.ts:115:   private_room: "Private Room",
038233| NOTE: Implementation detail supporting search page behavior.
038234| src/lib/search-params.ts:116:   privateroom: "Private Room",
038235| NOTE: Implementation detail supporting search page behavior.
038236| src/lib/search-params.ts:117:   shared: "Shared Room",
038237| NOTE: Implementation detail supporting search page behavior.
038238| src/lib/search-params.ts:118:   shared_room: "Shared Room",
038239| NOTE: Implementation detail supporting search page behavior.
038240| src/lib/search-params.ts:119:   sharedroom: "Shared Room",
038241| NOTE: Implementation detail supporting search page behavior.
038242| src/lib/search-params.ts:120:   entire: "Entire Place",
038243| NOTE: Implementation detail supporting search page behavior.
038244| src/lib/search-params.ts:121:   entire_place: "Entire Place",
038245| NOTE: Implementation detail supporting search page behavior.
038246| src/lib/search-params.ts:122:   entireplace: "Entire Place",
038247| NOTE: Implementation detail supporting search page behavior.
038248| src/lib/search-params.ts:123:   whole: "Entire Place",
038249| NOTE: Implementation detail supporting search page behavior.
038250| src/lib/search-params.ts:124:   studio: "Entire Place",
038251| NOTE: Implementation detail supporting search page behavior.
038252| src/lib/search-params.ts:125: };
038253| NOTE: Implementation detail supporting search page behavior.
038254| src/lib/search-params.ts:126: export const VALID_SORT_OPTIONS = [
038255| NOTE: Implementation detail supporting search page behavior.
038256| src/lib/search-params.ts:127:   "recommended",
038257| NOTE: Implementation detail supporting search page behavior.
038258| src/lib/search-params.ts:128:   "price_asc",
038259| NOTE: Implementation detail supporting search page behavior.
038260| src/lib/search-params.ts:129:   "price_desc",
038261| NOTE: Implementation detail supporting search page behavior.
038262| src/lib/search-params.ts:130:   "newest",
038263| NOTE: Implementation detail supporting search page behavior.
038264| src/lib/search-params.ts:131:   "rating",
038265| NOTE: Implementation detail supporting search page behavior.
038266| src/lib/search-params.ts:132: ] as const;
038267| NOTE: Implementation detail supporting search page behavior.
038268| src/lib/search-params.ts:133: 
038269| NOTE: Blank line for visual separation.
038270| src/lib/search-params.ts:134: const validSortOptions: SortOption[] = [
038271| NOTE: Local declaration used by search logic or UI.
038272| src/lib/search-params.ts:135:   "recommended",
038273| NOTE: Implementation detail supporting search page behavior.
038274| src/lib/search-params.ts:136:   "price_asc",
038275| NOTE: Implementation detail supporting search page behavior.
038276| src/lib/search-params.ts:137:   "price_desc",
038277| NOTE: Implementation detail supporting search page behavior.
038278| src/lib/search-params.ts:138:   "newest",
038279| NOTE: Implementation detail supporting search page behavior.
038280| src/lib/search-params.ts:139:   "rating",
038281| NOTE: Implementation detail supporting search page behavior.
038282| src/lib/search-params.ts:140: ];
038283| NOTE: Implementation detail supporting search page behavior.
038284| src/lib/search-params.ts:141: 
038285| NOTE: Blank line for visual separation.
038286| src/lib/search-params.ts:142: const getFirstValue = (
038287| NOTE: Local declaration used by search logic or UI.
038288| src/lib/search-params.ts:143:   value: string | string[] | undefined,
038289| NOTE: Implementation detail supporting search page behavior.
038290| src/lib/search-params.ts:144: ): string | undefined => {
038291| NOTE: Implementation detail supporting search page behavior.
038292| src/lib/search-params.ts:145:   if (Array.isArray(value)) {
038293| NOTE: Conditional logic controlling rendering or flow.
038294| src/lib/search-params.ts:146:     return value[0];
038295| NOTE: Return statement for component or helper output.
038296| src/lib/search-params.ts:147:   }
038297| NOTE: Implementation detail supporting search page behavior.
038298| src/lib/search-params.ts:148:   return value;
038299| NOTE: Return statement for component or helper output.
038300| src/lib/search-params.ts:149: };
038301| NOTE: Implementation detail supporting search page behavior.
038302| src/lib/search-params.ts:150: 
038303| NOTE: Blank line for visual separation.
038304| src/lib/search-params.ts:151: /**
038305| NOTE: Block comment line describing behavior or context.
038306| src/lib/search-params.ts:152:  * Get price parameter value supporting budget aliases.
038307| NOTE: Block comment line describing behavior or context.
038308| src/lib/search-params.ts:153:  * Canonical (minPrice/maxPrice) takes precedence over alias (minBudget/maxBudget).
038309| NOTE: Block comment line describing behavior or context.
038310| src/lib/search-params.ts:154:  * Price is stored and compared in dollars (not cents) - no conversion needed.
038311| NOTE: Block comment line describing behavior or context.
038312| src/lib/search-params.ts:155:  *
038313| NOTE: Block comment line describing behavior or context.
038314| src/lib/search-params.ts:156:  * @param params - URLSearchParams (client) or RawSearchParams (server)
038315| NOTE: Block comment line describing behavior or context.
038316| src/lib/search-params.ts:157:  * @param type - 'min' for minPrice/minBudget, 'max' for maxPrice/maxBudget
038317| NOTE: Block comment line describing behavior or context.
038318| src/lib/search-params.ts:158:  * @returns The parameter value string, or undefined if not present
038319| NOTE: Block comment line describing behavior or context.
038320| src/lib/search-params.ts:159:  */
038321| NOTE: Block comment line describing behavior or context.
038322| src/lib/search-params.ts:160: export function getPriceParam(
038323| NOTE: Exports helper or component function.
038324| src/lib/search-params.ts:161:   params: URLSearchParams | RawSearchParams,
038325| NOTE: Implementation detail supporting search page behavior.
038326| src/lib/search-params.ts:162:   type: "min" | "max",
038327| NOTE: Implementation detail supporting search page behavior.
038328| src/lib/search-params.ts:163: ): string | undefined {
038329| NOTE: Implementation detail supporting search page behavior.
038330| src/lib/search-params.ts:164:   const canonical = type === "min" ? "minPrice" : "maxPrice";
038331| NOTE: Local declaration used by search logic or UI.
038332| src/lib/search-params.ts:165:   const alias = type === "min" ? "minBudget" : "maxBudget";
038333| NOTE: Local declaration used by search logic or UI.
038334| src/lib/search-params.ts:166: 
038335| NOTE: Blank line for visual separation.
038336| src/lib/search-params.ts:167:   if (params instanceof URLSearchParams) {
038337| NOTE: Conditional logic controlling rendering or flow.
038338| src/lib/search-params.ts:168:     // Client-side: URLSearchParams
038339| NOTE: Line comment documents intent or constraints.
038340| src/lib/search-params.ts:169:     return params.get(canonical) || params.get(alias) || undefined;
038341| NOTE: Return statement for component or helper output.
038342| src/lib/search-params.ts:170:   }
038343| NOTE: Implementation detail supporting search page behavior.
038344| src/lib/search-params.ts:171:   // Server-side: RawSearchParams object
038345| NOTE: Line comment documents intent or constraints.
038346| src/lib/search-params.ts:172:   const canonicalValue = getFirstValue(
038347| NOTE: Local declaration used by search logic or UI.
038348| src/lib/search-params.ts:173:     params[canonical as keyof RawSearchParams] as string | string[] | undefined,
038349| NOTE: Implementation detail supporting search page behavior.
038350| src/lib/search-params.ts:174:   );
038351| NOTE: Implementation detail supporting search page behavior.
038352| src/lib/search-params.ts:175:   return (
038353| NOTE: Return statement for component or helper output.
038354| src/lib/search-params.ts:176:     canonicalValue ||
038355| NOTE: Implementation detail supporting search page behavior.
038356| src/lib/search-params.ts:177:     getFirstValue(
038357| NOTE: Implementation detail supporting search page behavior.
038358| src/lib/search-params.ts:178:       params[alias as keyof RawSearchParams] as string | string[] | undefined,
038359| NOTE: Implementation detail supporting search page behavior.
038360| src/lib/search-params.ts:179:     ) ||
038361| NOTE: Implementation detail supporting search page behavior.
038362| src/lib/search-params.ts:180:     undefined
038363| NOTE: Implementation detail supporting search page behavior.
038364| src/lib/search-params.ts:181:   );
038365| NOTE: Implementation detail supporting search page behavior.
038366| src/lib/search-params.ts:182: }
038367| NOTE: Implementation detail supporting search page behavior.
038368| src/lib/search-params.ts:183: 
038369| NOTE: Blank line for visual separation.
038370| src/lib/search-params.ts:184: const safeParseArray = (
038371| NOTE: Local declaration used by search logic or UI.
038372| src/lib/search-params.ts:185:   values: string | string[] | undefined,
038373| NOTE: Implementation detail supporting search page behavior.
038374| src/lib/search-params.ts:186:   allowlist: readonly string[],
038375| NOTE: Implementation detail supporting search page behavior.
038376| src/lib/search-params.ts:187:   maxItems: number = MAX_ARRAY_ITEMS,
038377| NOTE: Implementation detail supporting search page behavior.
038378| src/lib/search-params.ts:188: ): string[] | undefined => {
038379| NOTE: Implementation detail supporting search page behavior.
038380| src/lib/search-params.ts:189:   if (!values) return undefined;
038381| NOTE: Conditional logic controlling rendering or flow.
038382| src/lib/search-params.ts:190:   const allowMap = new Map(allowlist.map((item) => [item.toLowerCase(), item]));
038383| NOTE: Local declaration used by search logic or UI.
038384| src/lib/search-params.ts:191:   const list = (typeof values === "string" ? [values] : values).flatMap(
038385| NOTE: Local declaration used by search logic or UI.
038386| src/lib/search-params.ts:192:     (value) => value.split(","),
038387| NOTE: Implementation detail supporting search page behavior.
038388| src/lib/search-params.ts:193:   );
038389| NOTE: Implementation detail supporting search page behavior.
038390| src/lib/search-params.ts:194:   const validated = list
038391| NOTE: Local declaration used by search logic or UI.
038392| src/lib/search-params.ts:195:     .map((value) => value.trim())
038393| NOTE: Implementation detail supporting search page behavior.
038394| src/lib/search-params.ts:196:     .map((value) => allowMap.get(value.toLowerCase()))
038395| NOTE: Implementation detail supporting search page behavior.
038396| src/lib/search-params.ts:197:     .filter((value): value is string => Boolean(value));
038397| NOTE: Implementation detail supporting search page behavior.
038398| src/lib/search-params.ts:198:   const unique = [...new Set(validated)].slice(0, maxItems);
038399| NOTE: Local declaration used by search logic or UI.
038400| src/lib/search-params.ts:199:   return unique.length > 0 ? unique : undefined;
038401| NOTE: Return statement for component or helper output.
038402| src/lib/search-params.ts:200: };
038403| NOTE: Implementation detail supporting search page behavior.
038404| src/lib/search-params.ts:201: 
038405| NOTE: Blank line for visual separation.
038406| src/lib/search-params.ts:202: const safeParseEnum = <T extends string>(
038407| NOTE: Local declaration used by search logic or UI.
038408| src/lib/search-params.ts:203:   value: string | undefined,
038409| NOTE: Implementation detail supporting search page behavior.
038410| src/lib/search-params.ts:204:   allowlist: readonly T[],
038411| NOTE: Implementation detail supporting search page behavior.
038412| src/lib/search-params.ts:205:   defaultVal?: T,
038413| NOTE: Implementation detail supporting search page behavior.
038414| src/lib/search-params.ts:206:   aliases?: Record<string, string>,
038415| NOTE: Implementation detail supporting search page behavior.
038416| src/lib/search-params.ts:207: ): T | undefined => {
038417| NOTE: Implementation detail supporting search page behavior.
038418| src/lib/search-params.ts:208:   if (!value) return defaultVal;
038419| NOTE: Conditional logic controlling rendering or flow.
038420| src/lib/search-params.ts:209:   const trimmed = value.trim();
038421| NOTE: Local declaration used by search logic or UI.
038422| src/lib/search-params.ts:210:   const lowerTrimmed = trimmed.toLowerCase();
038423| NOTE: Local declaration used by search logic or UI.
038424| src/lib/search-params.ts:211: 
038425| NOTE: Blank line for visual separation.
038426| src/lib/search-params.ts:212:   // First check aliases to resolve alternative formats
038427| NOTE: Line comment documents intent or constraints.
038428| src/lib/search-params.ts:213:   if (aliases) {
038429| NOTE: Conditional logic controlling rendering or flow.
038430| src/lib/search-params.ts:214:     const aliasedValue = aliases[lowerTrimmed];
038431| NOTE: Local declaration used by search logic or UI.
038432| src/lib/search-params.ts:215:     if (aliasedValue && allowlist.includes(aliasedValue as T)) {
038433| NOTE: Conditional logic controlling rendering or flow.
038434| src/lib/search-params.ts:216:       return aliasedValue === "any" ? undefined : (aliasedValue as T);
038435| NOTE: Return statement for component or helper output.
038436| src/lib/search-params.ts:217:     }
038437| NOTE: Implementation detail supporting search page behavior.
038438| src/lib/search-params.ts:218:   }
038439| NOTE: Implementation detail supporting search page behavior.
038440| src/lib/search-params.ts:219: 
038441| NOTE: Blank line for visual separation.
038442| src/lib/search-params.ts:220:   // Case-insensitive matching: find the canonical form from allowlist
038443| NOTE: Line comment documents intent or constraints.
038444| src/lib/search-params.ts:221:   const allowMap = new Map(allowlist.map((item) => [item.toLowerCase(), item]));
038445| NOTE: Local declaration used by search logic or UI.
038446| src/lib/search-params.ts:222:   const canonical = allowMap.get(lowerTrimmed);
038447| NOTE: Local declaration used by search logic or UI.
038448| src/lib/search-params.ts:223:   if (canonical) {
038449| NOTE: Conditional logic controlling rendering or flow.
038450| src/lib/search-params.ts:224:     return canonical === "any" ? undefined : (canonical as T);
038451| NOTE: Return statement for component or helper output.
038452| src/lib/search-params.ts:225:   }
038453| NOTE: Implementation detail supporting search page behavior.
038454| src/lib/search-params.ts:226:   return defaultVal;
038455| NOTE: Return statement for component or helper output.
038456| src/lib/search-params.ts:227: };
038457| NOTE: Implementation detail supporting search page behavior.
038458| src/lib/search-params.ts:228: 
038459| NOTE: Blank line for visual separation.
038460| src/lib/search-params.ts:229: const safeParseFloat = (
038461| NOTE: Local declaration used by search logic or UI.
038462| src/lib/search-params.ts:230:   value: string | undefined,
038463| NOTE: Implementation detail supporting search page behavior.
038464| src/lib/search-params.ts:231:   min?: number,
038465| NOTE: Implementation detail supporting search page behavior.
038466| src/lib/search-params.ts:232:   max?: number,
038467| NOTE: Implementation detail supporting search page behavior.
038468| src/lib/search-params.ts:233: ): number | undefined => {
038469| NOTE: Implementation detail supporting search page behavior.
038470| src/lib/search-params.ts:234:   if (!value) return undefined;
038471| NOTE: Conditional logic controlling rendering or flow.
038472| src/lib/search-params.ts:235:   const trimmed = value.trim();
038473| NOTE: Local declaration used by search logic or UI.
038474| src/lib/search-params.ts:236:   if (!trimmed) return undefined;
038475| NOTE: Conditional logic controlling rendering or flow.
038476| src/lib/search-params.ts:237:   const parsed = parseFloat(trimmed);
038477| NOTE: Local declaration used by search logic or UI.
038478| src/lib/search-params.ts:238:   if (!Number.isFinite(parsed)) return undefined;
038479| NOTE: Conditional logic controlling rendering or flow.
038480| src/lib/search-params.ts:239:   let result = parsed;
038481| NOTE: Local declaration used by search logic or UI.
038482| src/lib/search-params.ts:240:   if (min !== undefined && result < min) result = min;
038483| NOTE: Conditional logic controlling rendering or flow.
038484| src/lib/search-params.ts:241:   if (max !== undefined && result > max) result = max;
038485| NOTE: Conditional logic controlling rendering or flow.
038486| src/lib/search-params.ts:242:   return result;
038487| NOTE: Return statement for component or helper output.
038488| src/lib/search-params.ts:243: };
038489| NOTE: Implementation detail supporting search page behavior.
038490| src/lib/search-params.ts:244: 
038491| NOTE: Blank line for visual separation.
038492| src/lib/search-params.ts:245: const safeParseInt = (
038493| NOTE: Local declaration used by search logic or UI.
038494| src/lib/search-params.ts:246:   value: string | undefined,
038495| NOTE: Implementation detail supporting search page behavior.
038496| src/lib/search-params.ts:247:   min?: number,
038497| NOTE: Implementation detail supporting search page behavior.
038498| src/lib/search-params.ts:248:   max?: number,
038499| NOTE: Implementation detail supporting search page behavior.
038500| src/lib/search-params.ts:249:   defaultVal?: number,
038501| NOTE: Implementation detail supporting search page behavior.
038502| src/lib/search-params.ts:250: ): number => {
038503| NOTE: Implementation detail supporting search page behavior.
038504| src/lib/search-params.ts:251:   if (!value) return defaultVal ?? 1;
038505| NOTE: Conditional logic controlling rendering or flow.
038506| src/lib/search-params.ts:252:   const trimmed = value.trim();
038507| NOTE: Local declaration used by search logic or UI.
038508| src/lib/search-params.ts:253:   if (!trimmed) return defaultVal ?? 1;
038509| NOTE: Conditional logic controlling rendering or flow.
038510| src/lib/search-params.ts:254:   const parsed = parseInt(trimmed, 10);
038511| NOTE: Local declaration used by search logic or UI.
038512| src/lib/search-params.ts:255:   if (isNaN(parsed)) return defaultVal ?? 1;
038513| NOTE: Conditional logic controlling rendering or flow.
038514| src/lib/search-params.ts:256:   if (!Number.isFinite(parsed)) return defaultVal ?? 1;
038515| NOTE: Conditional logic controlling rendering or flow.
038516| src/lib/search-params.ts:257:   let result = parsed;
038517| NOTE: Local declaration used by search logic or UI.
038518| src/lib/search-params.ts:258:   if (min !== undefined && result < min) result = min;
038519| NOTE: Conditional logic controlling rendering or flow.
038520| src/lib/search-params.ts:259:   if (max !== undefined && result > max) result = max;
038521| NOTE: Conditional logic controlling rendering or flow.
038522| src/lib/search-params.ts:260:   return result;
038523| NOTE: Return statement for component or helper output.
038524| src/lib/search-params.ts:261: };
038525| NOTE: Implementation detail supporting search page behavior.
038526| src/lib/search-params.ts:262: 
038527| NOTE: Blank line for visual separation.
038528| src/lib/search-params.ts:263: const safeParseBool = (value: string | undefined): boolean | undefined => {
038529| NOTE: Local declaration used by search logic or UI.
038530| src/lib/search-params.ts:264:   if (!value) return undefined;
038531| NOTE: Conditional logic controlling rendering or flow.
038532| src/lib/search-params.ts:265:   const trimmed = value.trim().toLowerCase();
038533| NOTE: Local declaration used by search logic or UI.
038534| src/lib/search-params.ts:266:   // Accept common truthy values: "1", "true", "yes", "on"
038535| NOTE: Line comment documents intent or constraints.
038536| src/lib/search-params.ts:267:   if (["1", "true", "yes", "on"].includes(trimmed)) return true;
038537| NOTE: Conditional logic controlling rendering or flow.
038538| src/lib/search-params.ts:268:   // Explicitly return undefined for falsy values (not false)
038539| NOTE: Line comment documents intent or constraints.
038540| src/lib/search-params.ts:269:   // This allows distinguishing "not set" from "explicitly disabled"
038541| NOTE: Line comment documents intent or constraints.
038542| src/lib/search-params.ts:270:   return undefined;
038543| NOTE: Return statement for component or helper output.
038544| src/lib/search-params.ts:271: };
038545| NOTE: Implementation detail supporting search page behavior.
038546| src/lib/search-params.ts:272: 
038547| NOTE: Blank line for visual separation.
038548| src/lib/search-params.ts:273: const safeParseDate = (value: string | undefined): string | undefined => {
038549| NOTE: Local declaration used by search logic or UI.
038550| src/lib/search-params.ts:274:   if (!value) return undefined;
038551| NOTE: Conditional logic controlling rendering or flow.
038552| src/lib/search-params.ts:275:   const trimmed = value.trim();
038553| NOTE: Local declaration used by search logic or UI.
038554| src/lib/search-params.ts:276:   if (!/^\d{4}-\d{2}-\d{2}$/.test(trimmed)) return undefined;
038555| NOTE: Conditional logic controlling rendering or flow.
038556| src/lib/search-params.ts:277:   const [yearStr, monthStr, dayStr] = trimmed.split("-");
038557| NOTE: Local declaration used by search logic or UI.
038558| src/lib/search-params.ts:278:   const year = parseInt(yearStr, 10);
038559| NOTE: Local declaration used by search logic or UI.
038560| src/lib/search-params.ts:279:   const month = parseInt(monthStr, 10);
038561| NOTE: Local declaration used by search logic or UI.
038562| src/lib/search-params.ts:280:   const day = parseInt(dayStr, 10);
038563| NOTE: Local declaration used by search logic or UI.
038564| src/lib/search-params.ts:281:   if (month < 1 || month > 12) return undefined;
038565| NOTE: Conditional logic controlling rendering or flow.
038566| src/lib/search-params.ts:282:   if (day < 1 || day > 31) return undefined;
038567| NOTE: Conditional logic controlling rendering or flow.
038568| src/lib/search-params.ts:283:   const date = new Date(year, month - 1, day);
038569| NOTE: Local declaration used by search logic or UI.
038570| src/lib/search-params.ts:284:   if (
038571| NOTE: Conditional logic controlling rendering or flow.
038572| src/lib/search-params.ts:285:     date.getFullYear() != year ||
038573| NOTE: Implementation detail supporting search page behavior.
038574| src/lib/search-params.ts:286:     date.getMonth() != month - 1 ||
038575| NOTE: Implementation detail supporting search page behavior.
038576| src/lib/search-params.ts:287:     date.getDate() != day
038577| NOTE: Implementation detail supporting search page behavior.
038578| src/lib/search-params.ts:288:   ) {
038579| NOTE: Implementation detail supporting search page behavior.
038580| src/lib/search-params.ts:289:     return undefined;
038581| NOTE: Return statement for component or helper output.
038582| src/lib/search-params.ts:290:   }
038583| NOTE: Implementation detail supporting search page behavior.
038584| src/lib/search-params.ts:291:   const today = new Date();
038585| NOTE: Local declaration used by search logic or UI.
038586| src/lib/search-params.ts:292:   today.setHours(0, 0, 0, 0);
038587| NOTE: Implementation detail supporting search page behavior.
038588| src/lib/search-params.ts:293:   if (date < today) return undefined;
038589| NOTE: Conditional logic controlling rendering or flow.
038590| src/lib/search-params.ts:294:   const maxDate = new Date();
038591| NOTE: Local declaration used by search logic or UI.
038592| src/lib/search-params.ts:295:   maxDate.setFullYear(maxDate.getFullYear() + 2);
038593| NOTE: Implementation detail supporting search page behavior.
038594| src/lib/search-params.ts:296:   if (date > maxDate) return undefined;
038595| NOTE: Conditional logic controlling rendering or flow.
038596| src/lib/search-params.ts:297:   return trimmed;
038597| NOTE: Return statement for component or helper output.
038598| src/lib/search-params.ts:298: };
038599| NOTE: Implementation detail supporting search page behavior.
038600| src/lib/search-params.ts:299: 
038601| NOTE: Blank line for visual separation.
038602| src/lib/search-params.ts:300: export function parseSearchParams(raw: RawSearchParams): ParsedSearchParams {
038603| NOTE: Exports helper or component function.
038604| src/lib/search-params.ts:301:   const rawQuery = getFirstValue(raw.q);
038605| NOTE: Local declaration used by search logic or UI.
038606| src/lib/search-params.ts:302:   const query = rawQuery ? rawQuery.trim() : "";
038607| NOTE: Local declaration used by search logic or UI.
038608| src/lib/search-params.ts:303:   const q = query || undefined;
038609| NOTE: Local declaration used by search logic or UI.
038610| src/lib/search-params.ts:304: 
038611| NOTE: Blank line for visual separation.
038612| src/lib/search-params.ts:305:   const requestedPage = safeParseInt(
038613| NOTE: Local declaration used by search logic or UI.
038614| src/lib/search-params.ts:306:     getFirstValue(raw.page),
038615| NOTE: Implementation detail supporting search page behavior.
038616| src/lib/search-params.ts:307:     1,
038617| NOTE: Implementation detail supporting search page behavior.
038618| src/lib/search-params.ts:308:     MAX_SAFE_PAGE,
038619| NOTE: Implementation detail supporting search page behavior.
038620| src/lib/search-params.ts:309:     1,
038621| NOTE: Implementation detail supporting search page behavior.
038622| src/lib/search-params.ts:310:   );
038623| NOTE: Implementation detail supporting search page behavior.
038624| src/lib/search-params.ts:311: 
038625| NOTE: Blank line for visual separation.
038626| src/lib/search-params.ts:312:   // Use getPriceParam to support budget aliases (minBudget/maxBudget)
038627| NOTE: Line comment documents intent or constraints.
038628| src/lib/search-params.ts:313:   // Canonical params (minPrice/maxPrice) take precedence over aliases
038629| NOTE: Line comment documents intent or constraints.
038630| src/lib/search-params.ts:314:   let validMinPrice = safeParseFloat(
038631| NOTE: Local declaration used by search logic or UI.
038632| src/lib/search-params.ts:315:     getPriceParam(raw, "min"),
038633| NOTE: Implementation detail supporting search page behavior.
038634| src/lib/search-params.ts:316:     0,
038635| NOTE: Implementation detail supporting search page behavior.
038636| src/lib/search-params.ts:317:     MAX_SAFE_PRICE,
038637| NOTE: Implementation detail supporting search page behavior.
038638| src/lib/search-params.ts:318:   );
038639| NOTE: Implementation detail supporting search page behavior.
038640| src/lib/search-params.ts:319:   let validMaxPrice = safeParseFloat(
038641| NOTE: Local declaration used by search logic or UI.
038642| src/lib/search-params.ts:320:     getPriceParam(raw, "max"),
038643| NOTE: Implementation detail supporting search page behavior.
038644| src/lib/search-params.ts:321:     0,
038645| NOTE: Implementation detail supporting search page behavior.
038646| src/lib/search-params.ts:322:     MAX_SAFE_PRICE,
038647| NOTE: Implementation detail supporting search page behavior.
038648| src/lib/search-params.ts:323:   );
038649| NOTE: Implementation detail supporting search page behavior.
038650| src/lib/search-params.ts:324: 
038651| NOTE: Blank line for visual separation.
038652| src/lib/search-params.ts:325:   if (
038653| NOTE: Conditional logic controlling rendering or flow.
038654| src/lib/search-params.ts:326:     validMinPrice !== undefined &&
038655| NOTE: Implementation detail supporting search page behavior.
038656| src/lib/search-params.ts:327:     validMaxPrice !== undefined &&
038657| NOTE: Implementation detail supporting search page behavior.
038658| src/lib/search-params.ts:328:     validMinPrice > validMaxPrice
038659| NOTE: Implementation detail supporting search page behavior.
038660| src/lib/search-params.ts:329:   ) {
038661| NOTE: Implementation detail supporting search page behavior.
038662| src/lib/search-params.ts:330:     [validMinPrice, validMaxPrice] = [validMaxPrice, validMinPrice];
038663| NOTE: Implementation detail supporting search page behavior.
038664| src/lib/search-params.ts:331:   }
038665| NOTE: Implementation detail supporting search page behavior.
038666| src/lib/search-params.ts:332: 
038667| NOTE: Blank line for visual separation.
038668| src/lib/search-params.ts:333:   const validLat = safeParseFloat(getFirstValue(raw.lat), -90, 90);
038669| NOTE: Local declaration used by search logic or UI.
038670| src/lib/search-params.ts:334:   const validLng = safeParseFloat(getFirstValue(raw.lng), -180, 180);
038671| NOTE: Local declaration used by search logic or UI.
038672| src/lib/search-params.ts:335:   let validMinLat = safeParseFloat(getFirstValue(raw.minLat), -90, 90);
038673| NOTE: Local declaration used by search logic or UI.
038674| src/lib/search-params.ts:336:   let validMaxLat = safeParseFloat(getFirstValue(raw.maxLat), -90, 90);
038675| NOTE: Local declaration used by search logic or UI.
038676| src/lib/search-params.ts:337:   const validMinLng = safeParseFloat(getFirstValue(raw.minLng), -180, 180);
038677| NOTE: Local declaration used by search logic or UI.
038678| src/lib/search-params.ts:338:   const validMaxLng = safeParseFloat(getFirstValue(raw.maxLng), -180, 180);
038679| NOTE: Local declaration used by search logic or UI.
038680| src/lib/search-params.ts:339: 
038681| NOTE: Blank line for visual separation.
038682| src/lib/search-params.ts:340:   if (
038683| NOTE: Conditional logic controlling rendering or flow.
038684| src/lib/search-params.ts:341:     validMinLat !== undefined &&
038685| NOTE: Implementation detail supporting search page behavior.
038686| src/lib/search-params.ts:342:     validMaxLat !== undefined &&
038687| NOTE: Implementation detail supporting search page behavior.
038688| src/lib/search-params.ts:343:     validMinLat > validMaxLat
038689| NOTE: Implementation detail supporting search page behavior.
038690| src/lib/search-params.ts:344:   ) {
038691| NOTE: Implementation detail supporting search page behavior.
038692| src/lib/search-params.ts:345:     [validMinLat, validMaxLat] = [validMaxLat, validMinLat];
038693| NOTE: Implementation detail supporting search page behavior.
038694| src/lib/search-params.ts:346:   }
038695| NOTE: Implementation detail supporting search page behavior.
038696| src/lib/search-params.ts:347: 
038697| NOTE: Blank line for visual separation.
038698| src/lib/search-params.ts:348:   const amenitiesList = safeParseArray(raw.amenities, VALID_AMENITIES);
038699| NOTE: Local declaration used by search logic or UI.
038700| src/lib/search-params.ts:349:   const houseRulesList = safeParseArray(raw.houseRules, VALID_HOUSE_RULES);
038701| NOTE: Local declaration used by search logic or UI.
038702| src/lib/search-params.ts:350: 
038703| NOTE: Blank line for visual separation.
038704| src/lib/search-params.ts:351:   const languagesList = (() => {
038705| NOTE: Local declaration used by search logic or UI.
038706| src/lib/search-params.ts:352:     const list = raw.languages
038707| NOTE: Local declaration used by search logic or UI.
038708| src/lib/search-params.ts:353:       ? Array.isArray(raw.languages)
038709| NOTE: Implementation detail supporting search page behavior.
038710| src/lib/search-params.ts:354:         ? raw.languages
038711| NOTE: Implementation detail supporting search page behavior.
038712| src/lib/search-params.ts:355:         : [raw.languages]
038713| NOTE: Implementation detail supporting search page behavior.
038714| src/lib/search-params.ts:356:       : [];
038715| NOTE: Implementation detail supporting search page behavior.
038716| src/lib/search-params.ts:357:     const flattened = list
038717| NOTE: Local declaration used by search logic or UI.
038718| src/lib/search-params.ts:358:       .flatMap((value) => String(value).split(","))
038719| NOTE: Implementation detail supporting search page behavior.
038720| src/lib/search-params.ts:359:       .map((value) => value.trim())
038721| NOTE: Implementation detail supporting search page behavior.
038722| src/lib/search-params.ts:360:       .filter((value) => value.length > 0 && value.length <= 32);
038723| NOTE: Implementation detail supporting search page behavior.
038724| src/lib/search-params.ts:361:     const normalized = normalizeLanguages(flattened);
038725| NOTE: Local declaration used by search logic or UI.
038726| src/lib/search-params.ts:362:     return Array.from(new Set(normalized)).slice(0, MAX_ARRAY_ITEMS);
038727| NOTE: Return statement for component or helper output.
038728| src/lib/search-params.ts:363:   })();
038729| NOTE: Implementation detail supporting search page behavior.
038730| src/lib/search-params.ts:364: 
038731| NOTE: Blank line for visual separation.
038732| src/lib/search-params.ts:365:   let bounds: FilterParams["bounds"];
038733| NOTE: Local declaration used by search logic or UI.
038734| src/lib/search-params.ts:366:   if (
038735| NOTE: Conditional logic controlling rendering or flow.
038736| src/lib/search-params.ts:367:     validMinLat !== undefined &&
038737| NOTE: Implementation detail supporting search page behavior.
038738| src/lib/search-params.ts:368:     validMaxLat !== undefined &&
038739| NOTE: Implementation detail supporting search page behavior.
038740| src/lib/search-params.ts:369:     validMinLng !== undefined &&
038741| NOTE: Implementation detail supporting search page behavior.
038742| src/lib/search-params.ts:370:     validMaxLng !== undefined
038743| NOTE: Implementation detail supporting search page behavior.
038744| src/lib/search-params.ts:371:   ) {
038745| NOTE: Implementation detail supporting search page behavior.
038746| src/lib/search-params.ts:372:     bounds = {
038747| NOTE: Implementation detail supporting search page behavior.
038748| src/lib/search-params.ts:373:       minLat: validMinLat,
038749| NOTE: Implementation detail supporting search page behavior.
038750| src/lib/search-params.ts:374:       maxLat: validMaxLat,
038751| NOTE: Implementation detail supporting search page behavior.
038752| src/lib/search-params.ts:375:       minLng: validMinLng,
038753| NOTE: Implementation detail supporting search page behavior.
038754| src/lib/search-params.ts:376:       maxLng: validMaxLng,
038755| NOTE: Implementation detail supporting search page behavior.
038756| src/lib/search-params.ts:377:     };
038757| NOTE: Implementation detail supporting search page behavior.
038758| src/lib/search-params.ts:378:   } else if (validLat !== undefined && validLng !== undefined) {
038759| NOTE: Implementation detail supporting search page behavior.
038760| src/lib/search-params.ts:379:     const latOffset = 0.09;
038761| NOTE: Local declaration used by search logic or UI.
038762| src/lib/search-params.ts:380:     const cosLat = Math.cos((validLat * Math.PI) / 180);
038763| NOTE: Local declaration used by search logic or UI.
038764| src/lib/search-params.ts:381:     const lngOffset = cosLat < 0.01 ? 180 : latOffset / cosLat;
038765| NOTE: Local declaration used by search logic or UI.
038766| src/lib/search-params.ts:382:     bounds = {
038767| NOTE: Implementation detail supporting search page behavior.
038768| src/lib/search-params.ts:383:       minLat: Math.max(-90, validLat - latOffset),
038769| NOTE: Implementation detail supporting search page behavior.
038770| src/lib/search-params.ts:384:       maxLat: Math.min(90, validLat + latOffset),
038771| NOTE: Implementation detail supporting search page behavior.
038772| src/lib/search-params.ts:385:       minLng: Math.max(-180, validLng - lngOffset),
038773| NOTE: Implementation detail supporting search page behavior.
038774| src/lib/search-params.ts:386:       maxLng: Math.min(180, validLng + lngOffset),
038775| NOTE: Implementation detail supporting search page behavior.
038776| src/lib/search-params.ts:387:     };
038777| NOTE: Implementation detail supporting search page behavior.
038778| src/lib/search-params.ts:388:   }
038779| NOTE: Implementation detail supporting search page behavior.
038780| src/lib/search-params.ts:389: 
038781| NOTE: Blank line for visual separation.
038782| src/lib/search-params.ts:390:   const sortOption: SortOption = validSortOptions.includes(
038783| NOTE: Local declaration used by search logic or UI.
038784| src/lib/search-params.ts:391:     getFirstValue(raw.sort) as SortOption,
038785| NOTE: Implementation detail supporting search page behavior.
038786| src/lib/search-params.ts:392:   )
038787| NOTE: Implementation detail supporting search page behavior.
038788| src/lib/search-params.ts:393:     ? (getFirstValue(raw.sort) as SortOption)
038789| NOTE: Implementation detail supporting search page behavior.
038790| src/lib/search-params.ts:394:     : "recommended";
038791| NOTE: Implementation detail supporting search page behavior.
038792| src/lib/search-params.ts:395: 
038793| NOTE: Blank line for visual separation.
038794| src/lib/search-params.ts:396:   const validMoveInDate = safeParseDate(getFirstValue(raw.moveInDate));
038795| NOTE: Local declaration used by search logic or UI.
038796| src/lib/search-params.ts:397:   const validRoomType = safeParseEnum(
038797| NOTE: Local declaration used by search logic or UI.
038798| src/lib/search-params.ts:398:     getFirstValue(raw.roomType),
038799| NOTE: Implementation detail supporting search page behavior.
038800| src/lib/search-params.ts:399:     VALID_ROOM_TYPES as readonly string[],
038801| NOTE: Implementation detail supporting search page behavior.
038802| src/lib/search-params.ts:400:     undefined,
038803| NOTE: Implementation detail supporting search page behavior.
038804| src/lib/search-params.ts:401:     ROOM_TYPE_ALIASES,
038805| NOTE: Implementation detail supporting search page behavior.
038806| src/lib/search-params.ts:402:   );
038807| NOTE: Implementation detail supporting search page behavior.
038808| src/lib/search-params.ts:403:   const validLeaseDuration = safeParseEnum(
038809| NOTE: Local declaration used by search logic or UI.
038810| src/lib/search-params.ts:404:     getFirstValue(raw.leaseDuration),
038811| NOTE: Implementation detail supporting search page behavior.
038812| src/lib/search-params.ts:405:     VALID_LEASE_DURATIONS as readonly string[],
038813| NOTE: Implementation detail supporting search page behavior.
038814| src/lib/search-params.ts:406:     undefined,
038815| NOTE: Implementation detail supporting search page behavior.
038816| src/lib/search-params.ts:407:     LEASE_DURATION_ALIASES,
038817| NOTE: Implementation detail supporting search page behavior.
038818| src/lib/search-params.ts:408:   );
038819| NOTE: Implementation detail supporting search page behavior.
038820| src/lib/search-params.ts:409: 
038821| NOTE: Blank line for visual separation.
038822| src/lib/search-params.ts:410:   const validNearMatches = safeParseBool(getFirstValue(raw.nearMatches));
038823| NOTE: Local declaration used by search logic or UI.
038824| src/lib/search-params.ts:411: 
038825| NOTE: Blank line for visual separation.
038826| src/lib/search-params.ts:412:   const filterParams: FilterParams = {
038827| NOTE: Local declaration used by search logic or UI.
038828| src/lib/search-params.ts:413:     query: q,
038829| NOTE: Implementation detail supporting search page behavior.
038830| src/lib/search-params.ts:414:     minPrice: validMinPrice,
038831| NOTE: Implementation detail supporting search page behavior.
038832| src/lib/search-params.ts:415:     maxPrice: validMaxPrice,
038833| NOTE: Implementation detail supporting search page behavior.
038834| src/lib/search-params.ts:416:     amenities: amenitiesList,
038835| NOTE: Implementation detail supporting search page behavior.
038836| src/lib/search-params.ts:417:     moveInDate: validMoveInDate,
038837| NOTE: Implementation detail supporting search page behavior.
038838| src/lib/search-params.ts:418:     leaseDuration: validLeaseDuration,
038839| NOTE: Implementation detail supporting search page behavior.
038840| src/lib/search-params.ts:419:     houseRules: houseRulesList,
038841| NOTE: Implementation detail supporting search page behavior.
038842| src/lib/search-params.ts:420:     languages: languagesList.length > 0 ? languagesList : undefined,
038843| NOTE: Implementation detail supporting search page behavior.
038844| src/lib/search-params.ts:421:     roomType: validRoomType,
038845| NOTE: Implementation detail supporting search page behavior.
038846| src/lib/search-params.ts:422:     bounds,
038847| NOTE: Implementation detail supporting search page behavior.
038848| src/lib/search-params.ts:423:     sort: sortOption,
038849| NOTE: Implementation detail supporting search page behavior.
038850| src/lib/search-params.ts:424:     nearMatches: validNearMatches,
038851| NOTE: Implementation detail supporting search page behavior.
038852| src/lib/search-params.ts:425:   };
038853| NOTE: Implementation detail supporting search page behavior.
038854| src/lib/search-params.ts:426: 
038855| NOTE: Blank line for visual separation.
038856| src/lib/search-params.ts:427:   return {
038857| NOTE: Return statement for component or helper output.
038858| src/lib/search-params.ts:428:     q,
038859| NOTE: Implementation detail supporting search page behavior.
038860| src/lib/search-params.ts:429:     requestedPage,
038861| NOTE: Implementation detail supporting search page behavior.
038862| src/lib/search-params.ts:430:     sortOption,
038863| NOTE: Implementation detail supporting search page behavior.
038864| src/lib/search-params.ts:431:     filterParams,
038865| NOTE: Implementation detail supporting search page behavior.
038866| src/lib/search-params.ts:432:   };
038867| NOTE: Implementation detail supporting search page behavior.
038868| src/lib/search-params.ts:433: }
038869| NOTE: Implementation detail supporting search page behavior.
038870| src/lib/search-params.ts:434: 
038871| NOTE: Blank line for visual separation.
038872| src/lib/search-params.ts:435: /**
038873| NOTE: Block comment line describing behavior or context.
038874| src/lib/search-params.ts:436:  * Validate and sanitize SearchFilters from untrusted input (e.g., client submissions).
038875| NOTE: Block comment line describing behavior or context.
038876| src/lib/search-params.ts:437:  * Used by server actions before storing filters in the database.
038877| NOTE: Block comment line describing behavior or context.
038878| src/lib/search-params.ts:438:  */
038879| NOTE: Block comment line describing behavior or context.
038880| src/lib/search-params.ts:439: export function validateSearchFilters(filters: unknown): FilterParams {
038881| NOTE: Exports helper or component function.
038882| src/lib/search-params.ts:440:   if (!filters || typeof filters !== "object") {
038883| NOTE: Conditional logic controlling rendering or flow.
038884| src/lib/search-params.ts:441:     return {};
038885| NOTE: Return statement for component or helper output.
038886| src/lib/search-params.ts:442:   }
038887| NOTE: Implementation detail supporting search page behavior.
038888| src/lib/search-params.ts:443: 
038889| NOTE: Blank line for visual separation.
038890| src/lib/search-params.ts:444:   const input = filters as Record<string, unknown>;
038891| NOTE: Local declaration used by search logic or UI.
038892| src/lib/search-params.ts:445:   const validated: FilterParams = {};
038893| NOTE: Local declaration used by search logic or UI.
038894| src/lib/search-params.ts:446: 
038895| NOTE: Blank line for visual separation.
038896| src/lib/search-params.ts:447:   // Query validation
038897| NOTE: Line comment documents intent or constraints.
038898| src/lib/search-params.ts:448:   if (typeof input.query === "string") {
038899| NOTE: Conditional logic controlling rendering or flow.
038900| src/lib/search-params.ts:449:     const trimmed = input.query.trim();
038901| NOTE: Local declaration used by search logic or UI.
038902| src/lib/search-params.ts:450:     if (trimmed.length > 0 && trimmed.length <= 200) {
038903| NOTE: Conditional logic controlling rendering or flow.
038904| src/lib/search-params.ts:451:       validated.query = trimmed;
038905| NOTE: Implementation detail supporting search page behavior.
038906| src/lib/search-params.ts:452:     }
038907| NOTE: Implementation detail supporting search page behavior.
038908| src/lib/search-params.ts:453:   }
038909| NOTE: Implementation detail supporting search page behavior.
038910| src/lib/search-params.ts:454: 
038911| NOTE: Blank line for visual separation.
038912| src/lib/search-params.ts:455:   // Price validation with MAX_SAFE_PRICE clamping
038913| NOTE: Line comment documents intent or constraints.
038914| src/lib/search-params.ts:456:   if (typeof input.minPrice === "number" && Number.isFinite(input.minPrice)) {
038915| NOTE: Conditional logic controlling rendering or flow.
038916| src/lib/search-params.ts:457:     validated.minPrice = Math.max(0, Math.min(input.minPrice, MAX_SAFE_PRICE));
038917| NOTE: Implementation detail supporting search page behavior.
038918| src/lib/search-params.ts:458:   }
038919| NOTE: Implementation detail supporting search page behavior.
038920| src/lib/search-params.ts:459:   if (typeof input.maxPrice === "number" && Number.isFinite(input.maxPrice)) {
038921| NOTE: Conditional logic controlling rendering or flow.
038922| src/lib/search-params.ts:460:     validated.maxPrice = Math.max(0, Math.min(input.maxPrice, MAX_SAFE_PRICE));
038923| NOTE: Implementation detail supporting search page behavior.
038924| src/lib/search-params.ts:461:   }
038925| NOTE: Implementation detail supporting search page behavior.
038926| src/lib/search-params.ts:462: 
038927| NOTE: Blank line for visual separation.
038928| src/lib/search-params.ts:463:   // Swap if min > max
038929| NOTE: Line comment documents intent or constraints.
038930| src/lib/search-params.ts:464:   if (
038931| NOTE: Conditional logic controlling rendering or flow.
038932| src/lib/search-params.ts:465:     validated.minPrice !== undefined &&
038933| NOTE: Implementation detail supporting search page behavior.
038934| src/lib/search-params.ts:466:     validated.maxPrice !== undefined &&
038935| NOTE: Implementation detail supporting search page behavior.
038936| src/lib/search-params.ts:467:     validated.minPrice > validated.maxPrice
038937| NOTE: Implementation detail supporting search page behavior.
038938| src/lib/search-params.ts:468:   ) {
038939| NOTE: Implementation detail supporting search page behavior.
038940| src/lib/search-params.ts:469:     [validated.minPrice, validated.maxPrice] = [
038941| NOTE: Implementation detail supporting search page behavior.
038942| src/lib/search-params.ts:470:       validated.maxPrice,
038943| NOTE: Implementation detail supporting search page behavior.
038944| src/lib/search-params.ts:471:       validated.minPrice,
038945| NOTE: Implementation detail supporting search page behavior.
038946| src/lib/search-params.ts:472:     ];
038947| NOTE: Implementation detail supporting search page behavior.
038948| src/lib/search-params.ts:473:   }
038949| NOTE: Implementation detail supporting search page behavior.
038950| src/lib/search-params.ts:474: 
038951| NOTE: Blank line for visual separation.
038952| src/lib/search-params.ts:475:   // Array field validation helper
038953| NOTE: Line comment documents intent or constraints.
038954| src/lib/search-params.ts:476:   const validateArrayField = (
038955| NOTE: Local declaration used by search logic or UI.
038956| src/lib/search-params.ts:477:     field: unknown,
038957| NOTE: Implementation detail supporting search page behavior.
038958| src/lib/search-params.ts:478:     allowlist: readonly string[],
038959| NOTE: Implementation detail supporting search page behavior.
038960| src/lib/search-params.ts:479:   ): string[] | undefined => {
038961| NOTE: Implementation detail supporting search page behavior.
038962| src/lib/search-params.ts:480:     if (!Array.isArray(field)) return undefined;
038963| NOTE: Conditional logic controlling rendering or flow.
038964| src/lib/search-params.ts:481:     const allowMap = new Map(
038965| NOTE: Local declaration used by search logic or UI.
038966| src/lib/search-params.ts:482:       allowlist.map((item) => [item.toLowerCase(), item]),
038967| NOTE: Implementation detail supporting search page behavior.
038968| src/lib/search-params.ts:483:     );
038969| NOTE: Implementation detail supporting search page behavior.
038970| src/lib/search-params.ts:484:     const validated = field
038971| NOTE: Local declaration used by search logic or UI.
038972| src/lib/search-params.ts:485:       .filter((v): v is string => typeof v === "string")
038973| NOTE: Implementation detail supporting search page behavior.
038974| src/lib/search-params.ts:486:       .map((v) => v.trim())
038975| NOTE: Implementation detail supporting search page behavior.
038976| src/lib/search-params.ts:487:       .map((v) => allowMap.get(v.toLowerCase()))
038977| NOTE: Implementation detail supporting search page behavior.
038978| src/lib/search-params.ts:488:       .filter((v): v is string => Boolean(v));
038979| NOTE: Implementation detail supporting search page behavior.
038980| src/lib/search-params.ts:489:     const unique = [...new Set(validated)].slice(0, MAX_ARRAY_ITEMS);
038981| NOTE: Local declaration used by search logic or UI.
038982| src/lib/search-params.ts:490:     return unique.length > 0 ? unique : undefined;
038983| NOTE: Return statement for component or helper output.
038984| src/lib/search-params.ts:491:   };
038985| NOTE: Implementation detail supporting search page behavior.
038986| src/lib/search-params.ts:492: 
038987| NOTE: Blank line for visual separation.
038988| src/lib/search-params.ts:493:   // Amenities validation
038989| NOTE: Line comment documents intent or constraints.
038990| src/lib/search-params.ts:494:   validated.amenities = validateArrayField(input.amenities, VALID_AMENITIES);
038991| NOTE: Implementation detail supporting search page behavior.
038992| src/lib/search-params.ts:495: 
038993| NOTE: Blank line for visual separation.
038994| src/lib/search-params.ts:496:   // House rules validation
038995| NOTE: Line comment documents intent or constraints.
038996| src/lib/search-params.ts:497:   validated.houseRules = validateArrayField(
038997| NOTE: Implementation detail supporting search page behavior.
038998| src/lib/search-params.ts:498:     input.houseRules,
038999| NOTE: Implementation detail supporting search page behavior.
039000| src/lib/search-params.ts:499:     VALID_HOUSE_RULES,
039001| NOTE: Implementation detail supporting search page behavior.
039002| src/lib/search-params.ts:500:   );
039003| NOTE: Implementation detail supporting search page behavior.
039004| src/lib/search-params.ts:501: 
039005| NOTE: Blank line for visual separation.
039006| src/lib/search-params.ts:502:   // Languages validation (uses normalizeLanguages for normalization)
039007| NOTE: Line comment documents intent or constraints.
039008| src/lib/search-params.ts:503:   if (Array.isArray(input.languages)) {
039009| NOTE: Conditional logic controlling rendering or flow.
039010| src/lib/search-params.ts:504:     const langList = input.languages
039011| NOTE: Local declaration used by search logic or UI.
039012| src/lib/search-params.ts:505:       .filter((v): v is string => typeof v === "string")
039013| NOTE: Implementation detail supporting search page behavior.
039014| src/lib/search-params.ts:506:       .map((v) => v.trim())
039015| NOTE: Implementation detail supporting search page behavior.
039016| src/lib/search-params.ts:507:       .filter((v) => v.length > 0 && v.length <= 32);
039017| NOTE: Implementation detail supporting search page behavior.
039018| src/lib/search-params.ts:508:     const normalized = normalizeLanguages(langList);
039019| NOTE: Local declaration used by search logic or UI.
039020| src/lib/search-params.ts:509:     const unique = [...new Set(normalized)].slice(0, MAX_ARRAY_ITEMS);
039021| NOTE: Local declaration used by search logic or UI.
039022| src/lib/search-params.ts:510:     if (unique.length > 0) {
039023| NOTE: Conditional logic controlling rendering or flow.
039024| src/lib/search-params.ts:511:       validated.languages = unique;
039025| NOTE: Implementation detail supporting search page behavior.
039026| src/lib/search-params.ts:512:     }
039027| NOTE: Implementation detail supporting search page behavior.
039028| src/lib/search-params.ts:513:   }
039029| NOTE: Implementation detail supporting search page behavior.
039030| src/lib/search-params.ts:514: 
039031| NOTE: Blank line for visual separation.
039032| src/lib/search-params.ts:515:   // Enum field validation helper
039033| NOTE: Line comment documents intent or constraints.
039034| src/lib/search-params.ts:516:   const validateEnumField = (
039035| NOTE: Local declaration used by search logic or UI.
039036| src/lib/search-params.ts:517:     field: unknown,
039037| NOTE: Implementation detail supporting search page behavior.
039038| src/lib/search-params.ts:518:     allowlist: readonly string[],
039039| NOTE: Implementation detail supporting search page behavior.
039040| src/lib/search-params.ts:519:   ): string | undefined => {
039041| NOTE: Implementation detail supporting search page behavior.
039042| src/lib/search-params.ts:520:     if (typeof field !== "string") return undefined;
039043| NOTE: Conditional logic controlling rendering or flow.
039044| src/lib/search-params.ts:521:     const trimmed = field.trim();
039045| NOTE: Local declaration used by search logic or UI.
039046| src/lib/search-params.ts:522:     if (!allowlist.includes(trimmed)) return undefined;
039047| NOTE: Conditional logic controlling rendering or flow.
039048| src/lib/search-params.ts:523:     return trimmed === "any" ? undefined : trimmed;
039049| NOTE: Return statement for component or helper output.
039050| src/lib/search-params.ts:524:   };
039051| NOTE: Implementation detail supporting search page behavior.
039052| src/lib/search-params.ts:525: 
039053| NOTE: Blank line for visual separation.
039054| src/lib/search-params.ts:526:   // Room type validation
039055| NOTE: Line comment documents intent or constraints.
039056| src/lib/search-params.ts:527:   validated.roomType = validateEnumField(input.roomType, VALID_ROOM_TYPES);
039057| NOTE: Implementation detail supporting search page behavior.
039058| src/lib/search-params.ts:528: 
039059| NOTE: Blank line for visual separation.
039060| src/lib/search-params.ts:529:   // Lease duration validation
039061| NOTE: Line comment documents intent or constraints.
039062| src/lib/search-params.ts:530:   validated.leaseDuration = validateEnumField(
039063| NOTE: Implementation detail supporting search page behavior.
039064| src/lib/search-params.ts:531:     input.leaseDuration,
039065| NOTE: Implementation detail supporting search page behavior.
039066| src/lib/search-params.ts:532:     VALID_LEASE_DURATIONS,
039067| NOTE: Implementation detail supporting search page behavior.
039068| src/lib/search-params.ts:533:   );
039069| NOTE: Implementation detail supporting search page behavior.
039070| src/lib/search-params.ts:534: 
039071| NOTE: Blank line for visual separation.
039072| src/lib/search-params.ts:535:   // Move-in date validation (reuse safeParseDate logic)
039073| NOTE: Line comment documents intent or constraints.
039074| src/lib/search-params.ts:536:   if (typeof input.moveInDate === "string") {
039075| NOTE: Conditional logic controlling rendering or flow.
039076| src/lib/search-params.ts:537:     validated.moveInDate = safeParseDate(input.moveInDate);
039077| NOTE: Implementation detail supporting search page behavior.
039078| src/lib/search-params.ts:538:   }
039079| NOTE: Implementation detail supporting search page behavior.
039080| src/lib/search-params.ts:539: 
039081| NOTE: Blank line for visual separation.
039082| src/lib/search-params.ts:540:   // Sort validation
039083| NOTE: Line comment documents intent or constraints.
039084| src/lib/search-params.ts:541:   if (typeof input.sort === "string") {
039085| NOTE: Conditional logic controlling rendering or flow.
039086| src/lib/search-params.ts:542:     const trimmed = input.sort.trim();
039087| NOTE: Local declaration used by search logic or UI.
039088| src/lib/search-params.ts:543:     if (validSortOptions.includes(trimmed as SortOption)) {
039089| NOTE: Conditional logic controlling rendering or flow.
039090| src/lib/search-params.ts:544:       validated.sort = trimmed as SortOption;
039091| NOTE: Implementation detail supporting search page behavior.
039092| src/lib/search-params.ts:545:     }
039093| NOTE: Implementation detail supporting search page behavior.
039094| src/lib/search-params.ts:546:   }
039095| NOTE: Implementation detail supporting search page behavior.
039096| src/lib/search-params.ts:547: 
039097| NOTE: Blank line for visual separation.
039098| src/lib/search-params.ts:548:   // Near matches validation
039099| NOTE: Line comment documents intent or constraints.
039100| src/lib/search-params.ts:549:   if (input.nearMatches === true) {
039101| NOTE: Conditional logic controlling rendering or flow.
039102| src/lib/search-params.ts:550:     validated.nearMatches = true;
039103| NOTE: Implementation detail supporting search page behavior.
039104| src/lib/search-params.ts:551:   }
039105| NOTE: Implementation detail supporting search page behavior.
039106| src/lib/search-params.ts:552: 
039107| NOTE: Blank line for visual separation.
039108| src/lib/search-params.ts:553:   // Bounds validation
039109| NOTE: Line comment documents intent or constraints.
039110| src/lib/search-params.ts:554:   if (input.bounds && typeof input.bounds === "object") {
039111| NOTE: Conditional logic controlling rendering or flow.
039112| src/lib/search-params.ts:555:     const b = input.bounds as Record<string, unknown>;
039113| NOTE: Local declaration used by search logic or UI.
039114| src/lib/search-params.ts:556:     if (
039115| NOTE: Conditional logic controlling rendering or flow.
039116| src/lib/search-params.ts:557:       typeof b.minLat === "number" &&
039117| NOTE: Implementation detail supporting search page behavior.
039118| src/lib/search-params.ts:558:       Number.isFinite(b.minLat) &&
039119| NOTE: Implementation detail supporting search page behavior.
039120| src/lib/search-params.ts:559:       typeof b.maxLat === "number" &&
039121| NOTE: Implementation detail supporting search page behavior.
039122| src/lib/search-params.ts:560:       Number.isFinite(b.maxLat) &&
039123| NOTE: Implementation detail supporting search page behavior.
039124| src/lib/search-params.ts:561:       typeof b.minLng === "number" &&
039125| NOTE: Implementation detail supporting search page behavior.
039126| src/lib/search-params.ts:562:       Number.isFinite(b.minLng) &&
039127| NOTE: Implementation detail supporting search page behavior.
039128| src/lib/search-params.ts:563:       typeof b.maxLng === "number" &&
039129| NOTE: Implementation detail supporting search page behavior.
039130| src/lib/search-params.ts:564:       Number.isFinite(b.maxLng)
039131| NOTE: Implementation detail supporting search page behavior.
039132| src/lib/search-params.ts:565:     ) {
039133| NOTE: Implementation detail supporting search page behavior.
039134| src/lib/search-params.ts:566:       validated.bounds = {
039135| NOTE: Implementation detail supporting search page behavior.
039136| src/lib/search-params.ts:567:         minLat: Math.max(-90, Math.min(90, b.minLat)),
039137| NOTE: Implementation detail supporting search page behavior.
039138| src/lib/search-params.ts:568:         maxLat: Math.max(-90, Math.min(90, b.maxLat)),
039139| NOTE: Implementation detail supporting search page behavior.
039140| src/lib/search-params.ts:569:         minLng: Math.max(-180, Math.min(180, b.minLng)),
039141| NOTE: Implementation detail supporting search page behavior.
039142| src/lib/search-params.ts:570:         maxLng: Math.max(-180, Math.min(180, b.maxLng)),
039143| NOTE: Implementation detail supporting search page behavior.
039144| src/lib/search-params.ts:571:       };
039145| NOTE: Implementation detail supporting search page behavior.
039146| src/lib/search-params.ts:572:       // Swap if min > max
039147| NOTE: Line comment documents intent or constraints.
039148| src/lib/search-params.ts:573:       if (validated.bounds.minLat > validated.bounds.maxLat) {
039149| NOTE: Conditional logic controlling rendering or flow.
039150| src/lib/search-params.ts:574:         [validated.bounds.minLat, validated.bounds.maxLat] = [
039151| NOTE: Implementation detail supporting search page behavior.
039152| src/lib/search-params.ts:575:           validated.bounds.maxLat,
039153| NOTE: Implementation detail supporting search page behavior.
039154| src/lib/search-params.ts:576:           validated.bounds.minLat,
039155| NOTE: Implementation detail supporting search page behavior.
039156| src/lib/search-params.ts:577:         ];
039157| NOTE: Implementation detail supporting search page behavior.
039158| src/lib/search-params.ts:578:       }
039159| NOTE: Implementation detail supporting search page behavior.
039160| src/lib/search-params.ts:579:     }
039161| NOTE: Implementation detail supporting search page behavior.
039162| src/lib/search-params.ts:580:   }
039163| NOTE: Implementation detail supporting search page behavior.
039164| src/lib/search-params.ts:581: 
039165| NOTE: Blank line for visual separation.
039166| src/lib/search-params.ts:582:   return validated;
039167| NOTE: Return statement for component or helper output.
039168| src/lib/search-params.ts:583: }
039169| NOTE: Implementation detail supporting search page behavior.
039170| FILE END: src/lib/search-params.ts
039171| 
039172| FILE START: src/lib/search-utils.ts
039173| FILE ROLE: Auto-discovered dependency in search page graph.
039174| src/lib/search-utils.ts:1: // Search utility functions and types (client-safe)
039175| NOTE: Line comment documents intent or constraints.
039176| src/lib/search-utils.ts:2: 
039177| NOTE: Blank line for visual separation.
039178| src/lib/search-utils.ts:3: export interface SearchFilters {
039179| NOTE: Implementation detail supporting search page behavior.
039180| src/lib/search-utils.ts:4:   query?: string;
039181| NOTE: Implementation detail supporting search page behavior.
039182| src/lib/search-utils.ts:5:   minPrice?: number;
039183| NOTE: Implementation detail supporting search page behavior.
039184| src/lib/search-utils.ts:6:   maxPrice?: number;
039185| NOTE: Implementation detail supporting search page behavior.
039186| src/lib/search-utils.ts:7:   amenities?: string[];
039187| NOTE: Implementation detail supporting search page behavior.
039188| src/lib/search-utils.ts:8:   moveInDate?: string;
039189| NOTE: Implementation detail supporting search page behavior.
039190| src/lib/search-utils.ts:9:   leaseDuration?: string;
039191| NOTE: Implementation detail supporting search page behavior.
039192| src/lib/search-utils.ts:10:   houseRules?: string[];
039193| NOTE: Implementation detail supporting search page behavior.
039194| src/lib/search-utils.ts:11:   roomType?: string;
039195| NOTE: Implementation detail supporting search page behavior.
039196| src/lib/search-utils.ts:12:   languages?: string[];
039197| NOTE: Implementation detail supporting search page behavior.
039198| src/lib/search-utils.ts:13:   lat?: number;
039199| NOTE: Implementation detail supporting search page behavior.
039200| src/lib/search-utils.ts:14:   lng?: number;
039201| NOTE: Implementation detail supporting search page behavior.
039202| src/lib/search-utils.ts:15:   minLat?: number;
039203| NOTE: Implementation detail supporting search page behavior.
039204| src/lib/search-utils.ts:16:   maxLat?: number;
039205| NOTE: Implementation detail supporting search page behavior.
039206| src/lib/search-utils.ts:17:   minLng?: number;
039207| NOTE: Implementation detail supporting search page behavior.
039208| src/lib/search-utils.ts:18:   maxLng?: number;
039209| NOTE: Implementation detail supporting search page behavior.
039210| src/lib/search-utils.ts:19:   sort?: string;
039211| NOTE: Implementation detail supporting search page behavior.
039212| src/lib/search-utils.ts:20:   city?: string;
039213| NOTE: Implementation detail supporting search page behavior.
039214| src/lib/search-utils.ts:21: }
039215| NOTE: Implementation detail supporting search page behavior.
039216| src/lib/search-utils.ts:22: 
039217| NOTE: Blank line for visual separation.
039218| src/lib/search-utils.ts:23: // Build search URL from filters
039219| NOTE: Line comment documents intent or constraints.
039220| src/lib/search-utils.ts:24: export function buildSearchUrl(filters: SearchFilters): string {
039221| NOTE: Exports helper or component function.
039222| src/lib/search-utils.ts:25:   const params = new URLSearchParams();
039223| NOTE: Local declaration used by search logic or UI.
039224| src/lib/search-utils.ts:26: 
039225| NOTE: Blank line for visual separation.
039226| src/lib/search-utils.ts:27:   if (filters.query) params.set("q", filters.query);
039227| NOTE: Conditional logic controlling rendering or flow.
039228| src/lib/search-utils.ts:28:   if (filters.minPrice !== undefined)
039229| NOTE: Conditional logic controlling rendering or flow.
039230| src/lib/search-utils.ts:29:     params.set("minPrice", filters.minPrice.toString());
039231| NOTE: Implementation detail supporting search page behavior.
039232| src/lib/search-utils.ts:30:   if (filters.maxPrice !== undefined)
039233| NOTE: Conditional logic controlling rendering or flow.
039234| src/lib/search-utils.ts:31:     params.set("maxPrice", filters.maxPrice.toString());
039235| NOTE: Implementation detail supporting search page behavior.
039236| src/lib/search-utils.ts:32:   if (filters.amenities?.length)
039237| NOTE: Conditional logic controlling rendering or flow.
039238| src/lib/search-utils.ts:33:     filters.amenities.forEach((amenity) => params.append("amenities", amenity));
039239| NOTE: Implementation detail supporting search page behavior.
039240| src/lib/search-utils.ts:34:   if (filters.moveInDate) params.set("moveInDate", filters.moveInDate);
039241| NOTE: Conditional logic controlling rendering or flow.
039242| src/lib/search-utils.ts:35:   if (filters.leaseDuration) params.set("leaseDuration", filters.leaseDuration);
039243| NOTE: Conditional logic controlling rendering or flow.
039244| src/lib/search-utils.ts:36:   if (filters.houseRules?.length)
039245| NOTE: Conditional logic controlling rendering or flow.
039246| src/lib/search-utils.ts:37:     filters.houseRules.forEach((rule) => params.append("houseRules", rule));
039247| NOTE: Implementation detail supporting search page behavior.
039248| src/lib/search-utils.ts:38:   if (filters.roomType) params.set("roomType", filters.roomType);
039249| NOTE: Conditional logic controlling rendering or flow.
039250| src/lib/search-utils.ts:39:   if (filters.languages?.length)
039251| NOTE: Conditional logic controlling rendering or flow.
039252| src/lib/search-utils.ts:40:     filters.languages.forEach((language) =>
039253| NOTE: Implementation detail supporting search page behavior.
039254| src/lib/search-utils.ts:41:       params.append("languages", language),
039255| NOTE: Implementation detail supporting search page behavior.
039256| src/lib/search-utils.ts:42:     );
039257| NOTE: Implementation detail supporting search page behavior.
039258| src/lib/search-utils.ts:43:   if (filters.sort) params.set("sort", filters.sort);
039259| NOTE: Conditional logic controlling rendering or flow.
039260| src/lib/search-utils.ts:44:   if (typeof filters.lat === "number" && Number.isFinite(filters.lat))
039261| NOTE: Conditional logic controlling rendering or flow.
039262| src/lib/search-utils.ts:45:     params.set("lat", filters.lat.toString());
039263| NOTE: Implementation detail supporting search page behavior.
039264| src/lib/search-utils.ts:46:   if (typeof filters.lng === "number" && Number.isFinite(filters.lng))
039265| NOTE: Conditional logic controlling rendering or flow.
039266| src/lib/search-utils.ts:47:     params.set("lng", filters.lng.toString());
039267| NOTE: Implementation detail supporting search page behavior.
039268| src/lib/search-utils.ts:48:   if (typeof filters.minLat === "number" && Number.isFinite(filters.minLat))
039269| NOTE: Conditional logic controlling rendering or flow.
039270| src/lib/search-utils.ts:49:     params.set("minLat", filters.minLat.toString());
039271| NOTE: Implementation detail supporting search page behavior.
039272| src/lib/search-utils.ts:50:   if (typeof filters.maxLat === "number" && Number.isFinite(filters.maxLat))
039273| NOTE: Conditional logic controlling rendering or flow.
039274| src/lib/search-utils.ts:51:     params.set("maxLat", filters.maxLat.toString());
039275| NOTE: Implementation detail supporting search page behavior.
039276| src/lib/search-utils.ts:52:   if (typeof filters.minLng === "number" && Number.isFinite(filters.minLng))
039277| NOTE: Conditional logic controlling rendering or flow.
039278| src/lib/search-utils.ts:53:     params.set("minLng", filters.minLng.toString());
039279| NOTE: Implementation detail supporting search page behavior.
039280| src/lib/search-utils.ts:54:   if (typeof filters.maxLng === "number" && Number.isFinite(filters.maxLng))
039281| NOTE: Conditional logic controlling rendering or flow.
039282| src/lib/search-utils.ts:55:     params.set("maxLng", filters.maxLng.toString());
039283| NOTE: Implementation detail supporting search page behavior.
039284| src/lib/search-utils.ts:56: 
039285| NOTE: Blank line for visual separation.
039286| src/lib/search-utils.ts:57:   return `/search?${params.toString()}`;
039287| NOTE: Return statement for component or helper output.
039288| src/lib/search-utils.ts:58: }
039289| NOTE: Implementation detail supporting search page behavior.
039290| FILE END: src/lib/search-utils.ts
039291| 
039292| FILE START: src/lib/search/cursor.ts
039293| FILE ROLE: Auto-discovered dependency in search page graph.
039294| src/lib/search/cursor.ts:1: /**
039295| NOTE: Block comment line describing behavior or context.
039296| src/lib/search/cursor.ts:2:  * Search API v2 - Keyset Cursor Utilities
039297| NOTE: Block comment line describing behavior or context.
039298| src/lib/search/cursor.ts:3:  *
039299| NOTE: Block comment line describing behavior or context.
039300| src/lib/search/cursor.ts:4:  * Provides stable keyset/cursor pagination to prevent result drift
039301| NOTE: Block comment line describing behavior or context.
039302| src/lib/search/cursor.ts:5:  * (duplicates/missing items) when inventory changes during scrolling.
039303| NOTE: Block comment line describing behavior or context.
039304| src/lib/search/cursor.ts:6:  *
039305| NOTE: Block comment line describing behavior or context.
039306| src/lib/search/cursor.ts:7:  * Key design decisions:
039307| NOTE: Block comment line describing behavior or context.
039308| src/lib/search/cursor.ts:8:  * - Versioned cursor format for future compatibility
039309| NOTE: Block comment line describing behavior or context.
039310| src/lib/search/cursor.ts:9:  * - Sort-specific key values stored in ORDER BY sequence
039311| NOTE: Block comment line describing behavior or context.
039312| src/lib/search/cursor.ts:10:  * - Float/decimal values stored as strings to preserve DB precision
039313| NOTE: Block comment line describing behavior or context.
039314| src/lib/search/cursor.ts:11:  * - Tie-breaker (id) ensures deterministic ordering
039315| NOTE: Block comment line describing behavior or context.
039316| src/lib/search/cursor.ts:12:  */
039317| NOTE: Block comment line describing behavior or context.
039318| src/lib/search/cursor.ts:13: 
039319| NOTE: Blank line for visual separation.
039320| src/lib/search/cursor.ts:14: import { z } from "zod";
039321| NOTE: Imports dependency for this module.
039322| src/lib/search/cursor.ts:15: 
039323| NOTE: Blank line for visual separation.
039324| src/lib/search/cursor.ts:16: // ============================================================================
039325| NOTE: Line comment documents intent or constraints.
039326| src/lib/search/cursor.ts:17: // Types
039327| NOTE: Line comment documents intent or constraints.
039328| src/lib/search/cursor.ts:18: // ============================================================================
039329| NOTE: Line comment documents intent or constraints.
039330| src/lib/search/cursor.ts:19: 
039331| NOTE: Blank line for visual separation.
039332| src/lib/search/cursor.ts:20: /**
039333| NOTE: Block comment line describing behavior or context.
039334| src/lib/search/cursor.ts:21:  * Valid sort options for search v2.
039335| NOTE: Block comment line describing behavior or context.
039336| src/lib/search/cursor.ts:22:  * Must match the sort options in search-doc-queries.ts
039337| NOTE: Block comment line describing behavior or context.
039338| src/lib/search/cursor.ts:23:  */
039339| NOTE: Block comment line describing behavior or context.
039340| src/lib/search/cursor.ts:24: export type SortOption =
039341| NOTE: Implementation detail supporting search page behavior.
039342| src/lib/search/cursor.ts:25:   | "recommended"
039343| NOTE: Implementation detail supporting search page behavior.
039344| src/lib/search/cursor.ts:26:   | "newest"
039345| NOTE: Implementation detail supporting search page behavior.
039346| src/lib/search/cursor.ts:27:   | "price_asc"
039347| NOTE: Implementation detail supporting search page behavior.
039348| src/lib/search/cursor.ts:28:   | "price_desc"
039349| NOTE: Implementation detail supporting search page behavior.
039350| src/lib/search/cursor.ts:29:   | "rating";
039351| NOTE: Implementation detail supporting search page behavior.
039352| src/lib/search/cursor.ts:30: 
039353| NOTE: Blank line for visual separation.
039354| src/lib/search/cursor.ts:31: export const SORT_OPTIONS: readonly SortOption[] = [
039355| NOTE: Implementation detail supporting search page behavior.
039356| src/lib/search/cursor.ts:32:   "recommended",
039357| NOTE: Implementation detail supporting search page behavior.
039358| src/lib/search/cursor.ts:33:   "newest",
039359| NOTE: Implementation detail supporting search page behavior.
039360| src/lib/search/cursor.ts:34:   "price_asc",
039361| NOTE: Implementation detail supporting search page behavior.
039362| src/lib/search/cursor.ts:35:   "price_desc",
039363| NOTE: Implementation detail supporting search page behavior.
039364| src/lib/search/cursor.ts:36:   "rating",
039365| NOTE: Implementation detail supporting search page behavior.
039366| src/lib/search/cursor.ts:37: ] as const;
039367| NOTE: Implementation detail supporting search page behavior.
039368| src/lib/search/cursor.ts:38: 
039369| NOTE: Blank line for visual separation.
039370| src/lib/search/cursor.ts:39: /**
039371| NOTE: Block comment line describing behavior or context.
039372| src/lib/search/cursor.ts:40:  * Keyset cursor structure for pagination.
039373| NOTE: Block comment line describing behavior or context.
039374| src/lib/search/cursor.ts:41:  *
039375| NOTE: Block comment line describing behavior or context.
039376| src/lib/search/cursor.ts:42:  * - v: Version number for future format changes
039377| NOTE: Block comment line describing behavior or context.
039378| src/lib/search/cursor.ts:43:  * - s: Sort option to validate cursor matches current query
039379| NOTE: Block comment line describing behavior or context.
039380| src/lib/search/cursor.ts:44:  * - k: Key values in ORDER BY column sequence (as strings for float precision)
039381| NOTE: Block comment line describing behavior or context.
039382| src/lib/search/cursor.ts:45:  * - id: Tie-breaker listing ID (CUID)
039383| NOTE: Block comment line describing behavior or context.
039384| src/lib/search/cursor.ts:46:  */
039385| NOTE: Block comment line describing behavior or context.
039386| src/lib/search/cursor.ts:47: export interface KeysetCursor {
039387| NOTE: Implementation detail supporting search page behavior.
039388| src/lib/search/cursor.ts:48:   v: 1;
039389| NOTE: Implementation detail supporting search page behavior.
039390| src/lib/search/cursor.ts:49:   s: SortOption;
039391| NOTE: Implementation detail supporting search page behavior.
039392| src/lib/search/cursor.ts:50:   k: (string | null)[];
039393| NOTE: Implementation detail supporting search page behavior.
039394| src/lib/search/cursor.ts:51:   id: string;
039395| NOTE: Implementation detail supporting search page behavior.
039396| src/lib/search/cursor.ts:52: }
039397| NOTE: Implementation detail supporting search page behavior.
039398| src/lib/search/cursor.ts:53: 
039399| NOTE: Blank line for visual separation.
039400| src/lib/search/cursor.ts:54: // ============================================================================
039401| NOTE: Line comment documents intent or constraints.
039402| src/lib/search/cursor.ts:55: // Zod Schema
039403| NOTE: Line comment documents intent or constraints.
039404| src/lib/search/cursor.ts:56: // ============================================================================
039405| NOTE: Line comment documents intent or constraints.
039406| src/lib/search/cursor.ts:57: 
039407| NOTE: Blank line for visual separation.
039408| src/lib/search/cursor.ts:58: /**
039409| NOTE: Block comment line describing behavior or context.
039410| src/lib/search/cursor.ts:59:  * Zod schema for validating decoded cursor payloads.
039411| NOTE: Block comment line describing behavior or context.
039412| src/lib/search/cursor.ts:60:  * Strict validation ensures malformed cursors are rejected.
039413| NOTE: Block comment line describing behavior or context.
039414| src/lib/search/cursor.ts:61:  */
039415| NOTE: Block comment line describing behavior or context.
039416| src/lib/search/cursor.ts:62: const KeysetCursorSchema = z
039417| NOTE: Local declaration used by search logic or UI.
039418| src/lib/search/cursor.ts:63:   .object({
039419| NOTE: Implementation detail supporting search page behavior.
039420| src/lib/search/cursor.ts:64:     v: z.literal(1),
039421| NOTE: Implementation detail supporting search page behavior.
039422| src/lib/search/cursor.ts:65:     s: z.enum(["recommended", "newest", "price_asc", "price_desc", "rating"]),
039423| NOTE: Implementation detail supporting search page behavior.
039424| src/lib/search/cursor.ts:66:     k: z.array(z.union([z.string(), z.null()])),
039425| NOTE: Implementation detail supporting search page behavior.
039426| src/lib/search/cursor.ts:67:     id: z.string().min(1),
039427| NOTE: Implementation detail supporting search page behavior.
039428| src/lib/search/cursor.ts:68:   })
039429| NOTE: Implementation detail supporting search page behavior.
039430| src/lib/search/cursor.ts:69:   .strict();
039431| NOTE: Implementation detail supporting search page behavior.
039432| src/lib/search/cursor.ts:70: 
039433| NOTE: Blank line for visual separation.
039434| src/lib/search/cursor.ts:71: /**
039435| NOTE: Block comment line describing behavior or context.
039436| src/lib/search/cursor.ts:72:  * Expected key counts per sort option.
039437| NOTE: Block comment line describing behavior or context.
039438| src/lib/search/cursor.ts:73:  * Used for validation to ensure cursor matches sort requirements.
039439| NOTE: Block comment line describing behavior or context.
039440| src/lib/search/cursor.ts:74:  */
039441| NOTE: Block comment line describing behavior or context.
039442| src/lib/search/cursor.ts:75: const EXPECTED_KEY_COUNTS: Record<SortOption, number> = {
039443| NOTE: Local declaration used by search logic or UI.
039444| src/lib/search/cursor.ts:76:   recommended: 2, // recommended_score, listing_created_at
039445| NOTE: Implementation detail supporting search page behavior.
039446| src/lib/search/cursor.ts:77:   newest: 1, // listing_created_at
039447| NOTE: Implementation detail supporting search page behavior.
039448| src/lib/search/cursor.ts:78:   price_asc: 2, // price, listing_created_at
039449| NOTE: Implementation detail supporting search page behavior.
039450| src/lib/search/cursor.ts:79:   price_desc: 2, // price, listing_created_at
039451| NOTE: Implementation detail supporting search page behavior.
039452| src/lib/search/cursor.ts:80:   rating: 3, // avg_rating, review_count, listing_created_at
039453| NOTE: Implementation detail supporting search page behavior.
039454| src/lib/search/cursor.ts:81: };
039455| NOTE: Implementation detail supporting search page behavior.
039456| src/lib/search/cursor.ts:82: 
039457| NOTE: Blank line for visual separation.
039458| src/lib/search/cursor.ts:83: // ============================================================================
039459| NOTE: Line comment documents intent or constraints.
039460| src/lib/search/cursor.ts:84: // Encoding/Decoding
039461| NOTE: Line comment documents intent or constraints.
039462| src/lib/search/cursor.ts:85: // ============================================================================
039463| NOTE: Line comment documents intent or constraints.
039464| src/lib/search/cursor.ts:86: 
039465| NOTE: Blank line for visual separation.
039466| src/lib/search/cursor.ts:87: /**
039467| NOTE: Block comment line describing behavior or context.
039468| src/lib/search/cursor.ts:88:  * Encode a keyset cursor as a base64url string.
039469| NOTE: Block comment line describing behavior or context.
039470| src/lib/search/cursor.ts:89:  *
039471| NOTE: Block comment line describing behavior or context.
039472| src/lib/search/cursor.ts:90:  * @param cursor - The keyset cursor object
039473| NOTE: Block comment line describing behavior or context.
039474| src/lib/search/cursor.ts:91:  * @returns Base64url encoded cursor string
039475| NOTE: Block comment line describing behavior or context.
039476| src/lib/search/cursor.ts:92:  */
039477| NOTE: Block comment line describing behavior or context.
039478| src/lib/search/cursor.ts:93: export function encodeKeysetCursor(cursor: KeysetCursor): string {
039479| NOTE: Exports helper or component function.
039480| src/lib/search/cursor.ts:94:   const payload = JSON.stringify(cursor);
039481| NOTE: Local declaration used by search logic or UI.
039482| src/lib/search/cursor.ts:95:   return Buffer.from(payload).toString("base64url");
039483| NOTE: Return statement for component or helper output.
039484| src/lib/search/cursor.ts:96: }
039485| NOTE: Implementation detail supporting search page behavior.
039486| src/lib/search/cursor.ts:97: 
039487| NOTE: Blank line for visual separation.
039488| src/lib/search/cursor.ts:98: /**
039489| NOTE: Block comment line describing behavior or context.
039490| src/lib/search/cursor.ts:99:  * Decode a base64url string to a keyset cursor.
039491| NOTE: Block comment line describing behavior or context.
039492| src/lib/search/cursor.ts:100:  *
039493| NOTE: Block comment line describing behavior or context.
039494| src/lib/search/cursor.ts:101:  * Returns null if:
039495| NOTE: Block comment line describing behavior or context.
039496| src/lib/search/cursor.ts:102:  * - Cursor is not valid base64url
039497| NOTE: Block comment line describing behavior or context.
039498| src/lib/search/cursor.ts:103:  * - JSON parsing fails
039499| NOTE: Block comment line describing behavior or context.
039500| src/lib/search/cursor.ts:104:  * - Schema validation fails
039501| NOTE: Block comment line describing behavior or context.
039502| src/lib/search/cursor.ts:105:  * - Sort option doesn't match expected
039503| NOTE: Block comment line describing behavior or context.
039504| src/lib/search/cursor.ts:106:  * - Key count doesn't match sort requirements
039505| NOTE: Block comment line describing behavior or context.
039506| src/lib/search/cursor.ts:107:  *
039507| NOTE: Block comment line describing behavior or context.
039508| src/lib/search/cursor.ts:108:  * @param cursorStr - Base64url encoded cursor string
039509| NOTE: Block comment line describing behavior or context.
039510| src/lib/search/cursor.ts:109:  * @param expectedSort - Optional sort option to validate against
039511| NOTE: Block comment line describing behavior or context.
039512| src/lib/search/cursor.ts:110:  * @returns Decoded cursor or null if invalid
039513| NOTE: Block comment line describing behavior or context.
039514| src/lib/search/cursor.ts:111:  */
039515| NOTE: Block comment line describing behavior or context.
039516| src/lib/search/cursor.ts:112: export function decodeKeysetCursor(
039517| NOTE: Exports helper or component function.
039518| src/lib/search/cursor.ts:113:   cursorStr: string,
039519| NOTE: Implementation detail supporting search page behavior.
039520| src/lib/search/cursor.ts:114:   expectedSort?: SortOption,
039521| NOTE: Implementation detail supporting search page behavior.
039522| src/lib/search/cursor.ts:115: ): KeysetCursor | null {
039523| NOTE: Implementation detail supporting search page behavior.
039524| src/lib/search/cursor.ts:116:   try {
039525| NOTE: Implementation detail supporting search page behavior.
039526| src/lib/search/cursor.ts:117:     const payload = Buffer.from(cursorStr, "base64url").toString("utf-8");
039527| NOTE: Local declaration used by search logic or UI.
039528| src/lib/search/cursor.ts:118:     const parsed = JSON.parse(payload);
039529| NOTE: Local declaration used by search logic or UI.
039530| src/lib/search/cursor.ts:119: 
039531| NOTE: Blank line for visual separation.
039532| src/lib/search/cursor.ts:120:     // Validate against Zod schema
039533| NOTE: Line comment documents intent or constraints.
039534| src/lib/search/cursor.ts:121:     const result = KeysetCursorSchema.safeParse(parsed);
039535| NOTE: Local declaration used by search logic or UI.
039536| src/lib/search/cursor.ts:122:     if (!result.success) {
039537| NOTE: Conditional logic controlling rendering or flow.
039538| src/lib/search/cursor.ts:123:       return null;
039539| NOTE: Return statement for component or helper output.
039540| src/lib/search/cursor.ts:124:     }
039541| NOTE: Implementation detail supporting search page behavior.
039542| src/lib/search/cursor.ts:125: 
039543| NOTE: Blank line for visual separation.
039544| src/lib/search/cursor.ts:126:     const cursor = result.data;
039545| NOTE: Local declaration used by search logic or UI.
039546| src/lib/search/cursor.ts:127: 
039547| NOTE: Blank line for visual separation.
039548| src/lib/search/cursor.ts:128:     // Validate sort matches if expected sort is provided
039549| NOTE: Line comment documents intent or constraints.
039550| src/lib/search/cursor.ts:129:     if (expectedSort && cursor.s !== expectedSort) {
039551| NOTE: Conditional logic controlling rendering or flow.
039552| src/lib/search/cursor.ts:130:       return null;
039553| NOTE: Return statement for component or helper output.
039554| src/lib/search/cursor.ts:131:     }
039555| NOTE: Implementation detail supporting search page behavior.
039556| src/lib/search/cursor.ts:132: 
039557| NOTE: Blank line for visual separation.
039558| src/lib/search/cursor.ts:133:     // Validate key count matches sort requirements
039559| NOTE: Line comment documents intent or constraints.
039560| src/lib/search/cursor.ts:134:     const expectedKeyCount = EXPECTED_KEY_COUNTS[cursor.s];
039561| NOTE: Local declaration used by search logic or UI.
039562| src/lib/search/cursor.ts:135:     if (cursor.k.length !== expectedKeyCount) {
039563| NOTE: Conditional logic controlling rendering or flow.
039564| src/lib/search/cursor.ts:136:       return null;
039565| NOTE: Return statement for component or helper output.
039566| src/lib/search/cursor.ts:137:     }
039567| NOTE: Implementation detail supporting search page behavior.
039568| src/lib/search/cursor.ts:138: 
039569| NOTE: Blank line for visual separation.
039570| src/lib/search/cursor.ts:139:     return cursor;
039571| NOTE: Return statement for component or helper output.
039572| src/lib/search/cursor.ts:140:   } catch {
039573| NOTE: Implementation detail supporting search page behavior.
039574| src/lib/search/cursor.ts:141:     return null;
039575| NOTE: Return statement for component or helper output.
039576| src/lib/search/cursor.ts:142:   }
039577| NOTE: Implementation detail supporting search page behavior.
039578| src/lib/search/cursor.ts:143: }
039579| NOTE: Implementation detail supporting search page behavior.
039580| src/lib/search/cursor.ts:144: 
039581| NOTE: Blank line for visual separation.
039582| src/lib/search/cursor.ts:145: // ============================================================================
039583| NOTE: Line comment documents intent or constraints.
039584| src/lib/search/cursor.ts:146: // Cursor Building from Query Results
039585| NOTE: Line comment documents intent or constraints.
039586| src/lib/search/cursor.ts:147: // ============================================================================
039587| NOTE: Line comment documents intent or constraints.
039588| src/lib/search/cursor.ts:148: 
039589| NOTE: Blank line for visual separation.
039590| src/lib/search/cursor.ts:149: /**
039591| NOTE: Block comment line describing behavior or context.
039592| src/lib/search/cursor.ts:150:  * Row data needed to build a cursor.
039593| NOTE: Block comment line describing behavior or context.
039594| src/lib/search/cursor.ts:151:  * All numeric values should be converted to strings for precision.
039595| NOTE: Block comment line describing behavior or context.
039596| src/lib/search/cursor.ts:152:  */
039597| NOTE: Block comment line describing behavior or context.
039598| src/lib/search/cursor.ts:153: export interface CursorRowData {
039599| NOTE: Implementation detail supporting search page behavior.
039600| src/lib/search/cursor.ts:154:   id: string;
039601| NOTE: Implementation detail supporting search page behavior.
039602| src/lib/search/cursor.ts:155:   listing_created_at: string; // ISO date string
039603| NOTE: Implementation detail supporting search page behavior.
039604| src/lib/search/cursor.ts:156:   recommended_score?: string | null; // As string for float precision
039605| NOTE: Implementation detail supporting search page behavior.
039606| src/lib/search/cursor.ts:157:   price?: string | null; // As string for decimal precision
039607| NOTE: Implementation detail supporting search page behavior.
039608| src/lib/search/cursor.ts:158:   avg_rating?: string | null; // As string for float precision
039609| NOTE: Implementation detail supporting search page behavior.
039610| src/lib/search/cursor.ts:159:   review_count?: string | null; // As string (integer)
039611| NOTE: Implementation detail supporting search page behavior.
039612| src/lib/search/cursor.ts:160: }
039613| NOTE: Implementation detail supporting search page behavior.
039614| src/lib/search/cursor.ts:161: 
039615| NOTE: Blank line for visual separation.
039616| src/lib/search/cursor.ts:162: /**
039617| NOTE: Block comment line describing behavior or context.
039618| src/lib/search/cursor.ts:163:  * Build a keyset cursor from the last row of a query result.
039619| NOTE: Block comment line describing behavior or context.
039620| src/lib/search/cursor.ts:164:  *
039621| NOTE: Block comment line describing behavior or context.
039622| src/lib/search/cursor.ts:165:  * Key values are stored as strings to preserve exact DB representation
039623| NOTE: Block comment line describing behavior or context.
039624| src/lib/search/cursor.ts:166:  * and avoid float precision issues during JSON roundtrip.
039625| NOTE: Block comment line describing behavior or context.
039626| src/lib/search/cursor.ts:167:  *
039627| NOTE: Block comment line describing behavior or context.
039628| src/lib/search/cursor.ts:168:  * @param row - The last row from query results
039629| NOTE: Block comment line describing behavior or context.
039630| src/lib/search/cursor.ts:169:  * @param sort - The sort option used for the query
039631| NOTE: Block comment line describing behavior or context.
039632| src/lib/search/cursor.ts:170:  * @returns KeysetCursor ready for encoding
039633| NOTE: Block comment line describing behavior or context.
039634| src/lib/search/cursor.ts:171:  */
039635| NOTE: Block comment line describing behavior or context.
039636| src/lib/search/cursor.ts:172: export function buildCursorFromRow(
039637| NOTE: Exports helper or component function.
039638| src/lib/search/cursor.ts:173:   row: CursorRowData,
039639| NOTE: Implementation detail supporting search page behavior.
039640| src/lib/search/cursor.ts:174:   sort: SortOption,
039641| NOTE: Implementation detail supporting search page behavior.
039642| src/lib/search/cursor.ts:175: ): KeysetCursor {
039643| NOTE: Implementation detail supporting search page behavior.
039644| src/lib/search/cursor.ts:176:   let keys: (string | null)[];
039645| NOTE: Local declaration used by search logic or UI.
039646| src/lib/search/cursor.ts:177: 
039647| NOTE: Blank line for visual separation.
039648| src/lib/search/cursor.ts:178:   switch (sort) {
039649| NOTE: Implementation detail supporting search page behavior.
039650| src/lib/search/cursor.ts:179:     case "recommended":
039651| NOTE: Implementation detail supporting search page behavior.
039652| src/lib/search/cursor.ts:180:       // ORDER BY: recommended_score DESC, listing_created_at DESC, id ASC
039653| NOTE: Line comment documents intent or constraints.
039654| src/lib/search/cursor.ts:181:       keys = [row.recommended_score ?? null, row.listing_created_at];
039655| NOTE: Implementation detail supporting search page behavior.
039656| src/lib/search/cursor.ts:182:       break;
039657| NOTE: Implementation detail supporting search page behavior.
039658| src/lib/search/cursor.ts:183: 
039659| NOTE: Blank line for visual separation.
039660| src/lib/search/cursor.ts:184:     case "newest":
039661| NOTE: Implementation detail supporting search page behavior.
039662| src/lib/search/cursor.ts:185:       // ORDER BY: listing_created_at DESC, id ASC
039663| NOTE: Line comment documents intent or constraints.
039664| src/lib/search/cursor.ts:186:       keys = [row.listing_created_at];
039665| NOTE: Implementation detail supporting search page behavior.
039666| src/lib/search/cursor.ts:187:       break;
039667| NOTE: Implementation detail supporting search page behavior.
039668| src/lib/search/cursor.ts:188: 
039669| NOTE: Blank line for visual separation.
039670| src/lib/search/cursor.ts:189:     case "price_asc":
039671| NOTE: Implementation detail supporting search page behavior.
039672| src/lib/search/cursor.ts:190:     case "price_desc":
039673| NOTE: Implementation detail supporting search page behavior.
039674| src/lib/search/cursor.ts:191:       // ORDER BY: price ASC/DESC, listing_created_at DESC, id ASC
039675| NOTE: Line comment documents intent or constraints.
039676| src/lib/search/cursor.ts:192:       keys = [row.price ?? null, row.listing_created_at];
039677| NOTE: Implementation detail supporting search page behavior.
039678| src/lib/search/cursor.ts:193:       break;
039679| NOTE: Implementation detail supporting search page behavior.
039680| src/lib/search/cursor.ts:194: 
039681| NOTE: Blank line for visual separation.
039682| src/lib/search/cursor.ts:195:     case "rating":
039683| NOTE: Implementation detail supporting search page behavior.
039684| src/lib/search/cursor.ts:196:       // ORDER BY: avg_rating DESC, review_count DESC, listing_created_at DESC, id ASC
039685| NOTE: Line comment documents intent or constraints.
039686| src/lib/search/cursor.ts:197:       keys = [
039687| NOTE: Implementation detail supporting search page behavior.
039688| src/lib/search/cursor.ts:198:         row.avg_rating ?? null,
039689| NOTE: Implementation detail supporting search page behavior.
039690| src/lib/search/cursor.ts:199:         row.review_count ?? null,
039691| NOTE: Implementation detail supporting search page behavior.
039692| src/lib/search/cursor.ts:200:         row.listing_created_at,
039693| NOTE: Implementation detail supporting search page behavior.
039694| src/lib/search/cursor.ts:201:       ];
039695| NOTE: Implementation detail supporting search page behavior.
039696| src/lib/search/cursor.ts:202:       break;
039697| NOTE: Implementation detail supporting search page behavior.
039698| src/lib/search/cursor.ts:203: 
039699| NOTE: Blank line for visual separation.
039700| src/lib/search/cursor.ts:204:     default:
039701| NOTE: Implementation detail supporting search page behavior.
039702| src/lib/search/cursor.ts:205:       // Fallback to recommended
039703| NOTE: Line comment documents intent or constraints.
039704| src/lib/search/cursor.ts:206:       keys = [row.recommended_score ?? null, row.listing_created_at];
039705| NOTE: Implementation detail supporting search page behavior.
039706| src/lib/search/cursor.ts:207:   }
039707| NOTE: Implementation detail supporting search page behavior.
039708| src/lib/search/cursor.ts:208: 
039709| NOTE: Blank line for visual separation.
039710| src/lib/search/cursor.ts:209:   return {
039711| NOTE: Return statement for component or helper output.
039712| src/lib/search/cursor.ts:210:     v: 1,
039713| NOTE: Implementation detail supporting search page behavior.
039714| src/lib/search/cursor.ts:211:     s: sort,
039715| NOTE: Implementation detail supporting search page behavior.
039716| src/lib/search/cursor.ts:212:     k: keys,
039717| NOTE: Implementation detail supporting search page behavior.
039718| src/lib/search/cursor.ts:213:     id: row.id,
039719| NOTE: Implementation detail supporting search page behavior.
039720| src/lib/search/cursor.ts:214:   };
039721| NOTE: Implementation detail supporting search page behavior.
039722| src/lib/search/cursor.ts:215: }
039723| NOTE: Implementation detail supporting search page behavior.
039724| src/lib/search/cursor.ts:216: 
039725| NOTE: Blank line for visual separation.
039726| src/lib/search/cursor.ts:217: // ============================================================================
039727| NOTE: Line comment documents intent or constraints.
039728| src/lib/search/cursor.ts:218: // Legacy Cursor Detection
039729| NOTE: Line comment documents intent or constraints.
039730| src/lib/search/cursor.ts:219: // ============================================================================
039731| NOTE: Line comment documents intent or constraints.
039732| src/lib/search/cursor.ts:220: 
039733| NOTE: Blank line for visual separation.
039734| src/lib/search/cursor.ts:221: /**
039735| NOTE: Block comment line describing behavior or context.
039736| src/lib/search/cursor.ts:222:  * Legacy cursor format from offset-based pagination.
039737| NOTE: Block comment line describing behavior or context.
039738| src/lib/search/cursor.ts:223:  * Used for backward compatibility during migration.
039739| NOTE: Block comment line describing behavior or context.
039740| src/lib/search/cursor.ts:224:  */
039741| NOTE: Block comment line describing behavior or context.
039742| src/lib/search/cursor.ts:225: interface LegacyCursor {
039743| NOTE: Type declaration for search data contracts.
039744| src/lib/search/cursor.ts:226:   p: number;
039745| NOTE: Implementation detail supporting search page behavior.
039746| src/lib/search/cursor.ts:227: }
039747| NOTE: Implementation detail supporting search page behavior.
039748| src/lib/search/cursor.ts:228: 
039749| NOTE: Blank line for visual separation.
039750| src/lib/search/cursor.ts:229: /**
039751| NOTE: Block comment line describing behavior or context.
039752| src/lib/search/cursor.ts:230:  * Check if a cursor string is a legacy offset-based cursor.
039753| NOTE: Block comment line describing behavior or context.
039754| src/lib/search/cursor.ts:231:  *
039755| NOTE: Block comment line describing behavior or context.
039756| src/lib/search/cursor.ts:232:  * @param cursorStr - Base64url encoded cursor string
039757| NOTE: Block comment line describing behavior or context.
039758| src/lib/search/cursor.ts:233:  * @returns Page number if legacy cursor, null otherwise
039759| NOTE: Block comment line describing behavior or context.
039760| src/lib/search/cursor.ts:234:  */
039761| NOTE: Block comment line describing behavior or context.
039762| src/lib/search/cursor.ts:235: export function decodeLegacyCursor(cursorStr: string): number | null {
039763| NOTE: Exports helper or component function.
039764| src/lib/search/cursor.ts:236:   try {
039765| NOTE: Implementation detail supporting search page behavior.
039766| src/lib/search/cursor.ts:237:     const payload = Buffer.from(cursorStr, "base64url").toString("utf-8");
039767| NOTE: Local declaration used by search logic or UI.
039768| src/lib/search/cursor.ts:238:     const parsed = JSON.parse(payload) as unknown;
039769| NOTE: Local declaration used by search logic or UI.
039770| src/lib/search/cursor.ts:239: 
039771| NOTE: Blank line for visual separation.
039772| src/lib/search/cursor.ts:240:     // Legacy format: { p: number }
039773| NOTE: Line comment documents intent or constraints.
039774| src/lib/search/cursor.ts:241:     if (
039775| NOTE: Conditional logic controlling rendering or flow.
039776| src/lib/search/cursor.ts:242:       parsed !== null &&
039777| NOTE: Implementation detail supporting search page behavior.
039778| src/lib/search/cursor.ts:243:       typeof parsed === "object" &&
039779| NOTE: Implementation detail supporting search page behavior.
039780| src/lib/search/cursor.ts:244:       "p" in parsed &&
039781| NOTE: Implementation detail supporting search page behavior.
039782| src/lib/search/cursor.ts:245:       typeof (parsed as LegacyCursor).p === "number" &&
039783| NOTE: Implementation detail supporting search page behavior.
039784| src/lib/search/cursor.ts:246:       (parsed as LegacyCursor).p > 0 &&
039785| NOTE: Implementation detail supporting search page behavior.
039786| src/lib/search/cursor.ts:247:       !("v" in parsed) // Distinguish from keyset cursor
039787| NOTE: Implementation detail supporting search page behavior.
039788| src/lib/search/cursor.ts:248:     ) {
039789| NOTE: Implementation detail supporting search page behavior.
039790| src/lib/search/cursor.ts:249:       return (parsed as LegacyCursor).p;
039791| NOTE: Return statement for component or helper output.
039792| src/lib/search/cursor.ts:250:     }
039793| NOTE: Implementation detail supporting search page behavior.
039794| src/lib/search/cursor.ts:251:     return null;
039795| NOTE: Return statement for component or helper output.
039796| src/lib/search/cursor.ts:252:   } catch {
039797| NOTE: Implementation detail supporting search page behavior.
039798| src/lib/search/cursor.ts:253:     return null;
039799| NOTE: Return statement for component or helper output.
039800| src/lib/search/cursor.ts:254:   }
039801| NOTE: Implementation detail supporting search page behavior.
039802| src/lib/search/cursor.ts:255: }
039803| NOTE: Implementation detail supporting search page behavior.
039804| src/lib/search/cursor.ts:256: 
039805| NOTE: Blank line for visual separation.
039806| src/lib/search/cursor.ts:257: /**
039807| NOTE: Block comment line describing behavior or context.
039808| src/lib/search/cursor.ts:258:  * Attempt to decode a cursor, detecting whether it's keyset or legacy format.
039809| NOTE: Block comment line describing behavior or context.
039810| src/lib/search/cursor.ts:259:  *
039811| NOTE: Block comment line describing behavior or context.
039812| src/lib/search/cursor.ts:260:  * This enables backward compatibility during rollout:
039813| NOTE: Block comment line describing behavior or context.
039814| src/lib/search/cursor.ts:261:  * - Legacy cursors ({p: n}) \u2192 return page number for offset fetch
039815| NOTE: Block comment line describing behavior or context.
039816| src/lib/search/cursor.ts:262:  * - Keyset cursors \u2192 return cursor for keyset fetch
039817| NOTE: Block comment line describing behavior or context.
039818| src/lib/search/cursor.ts:263:  *
039819| NOTE: Block comment line describing behavior or context.
039820| src/lib/search/cursor.ts:264:  * @param cursorStr - Base64url encoded cursor string
039821| NOTE: Block comment line describing behavior or context.
039822| src/lib/search/cursor.ts:265:  * @param expectedSort - Sort option to validate keyset cursor against
039823| NOTE: Block comment line describing behavior or context.
039824| src/lib/search/cursor.ts:266:  * @returns Object with either 'keyset' or 'legacy' property, or null if invalid
039825| NOTE: Block comment line describing behavior or context.
039826| src/lib/search/cursor.ts:267:  */
039827| NOTE: Block comment line describing behavior or context.
039828| src/lib/search/cursor.ts:268: export function decodeCursorAny(
039829| NOTE: Exports helper or component function.
039830| src/lib/search/cursor.ts:269:   cursorStr: string,
039831| NOTE: Implementation detail supporting search page behavior.
039832| src/lib/search/cursor.ts:270:   expectedSort: SortOption,
039833| NOTE: Implementation detail supporting search page behavior.
039834| src/lib/search/cursor.ts:271: ):
039835| NOTE: Implementation detail supporting search page behavior.
039836| src/lib/search/cursor.ts:272:   | { type: "keyset"; cursor: KeysetCursor }
039837| NOTE: Implementation detail supporting search page behavior.
039838| src/lib/search/cursor.ts:273:   | { type: "legacy"; page: number }
039839| NOTE: Implementation detail supporting search page behavior.
039840| src/lib/search/cursor.ts:274:   | null {
039841| NOTE: Implementation detail supporting search page behavior.
039842| src/lib/search/cursor.ts:275:   // Try keyset first (newer format)
039843| NOTE: Line comment documents intent or constraints.
039844| src/lib/search/cursor.ts:276:   const keysetCursor = decodeKeysetCursor(cursorStr, expectedSort);
039845| NOTE: Local declaration used by search logic or UI.
039846| src/lib/search/cursor.ts:277:   if (keysetCursor) {
039847| NOTE: Conditional logic controlling rendering or flow.
039848| src/lib/search/cursor.ts:278:     return { type: "keyset", cursor: keysetCursor };
039849| NOTE: Return statement for component or helper output.
039850| src/lib/search/cursor.ts:279:   }
039851| NOTE: Implementation detail supporting search page behavior.
039852| src/lib/search/cursor.ts:280: 
039853| NOTE: Blank line for visual separation.
039854| src/lib/search/cursor.ts:281:   // Fall back to legacy format
039855| NOTE: Line comment documents intent or constraints.
039856| src/lib/search/cursor.ts:282:   const legacyPage = decodeLegacyCursor(cursorStr);
039857| NOTE: Local declaration used by search logic or UI.
039858| src/lib/search/cursor.ts:283:   if (legacyPage !== null) {
039859| NOTE: Conditional logic controlling rendering or flow.
039860| src/lib/search/cursor.ts:284:     return { type: "legacy", page: legacyPage };
039861| NOTE: Return statement for component or helper output.
039862| src/lib/search/cursor.ts:285:   }
039863| NOTE: Implementation detail supporting search page behavior.
039864| src/lib/search/cursor.ts:286: 
039865| NOTE: Blank line for visual separation.
039866| src/lib/search/cursor.ts:287:   return null;
039867| NOTE: Return statement for component or helper output.
039868| src/lib/search/cursor.ts:288: }
039869| NOTE: Implementation detail supporting search page behavior.
039870| FILE END: src/lib/search/cursor.ts
039871| 
039872| FILE START: src/lib/search/hash.ts
039873| FILE ROLE: Auto-discovered dependency in search page graph.
039874| src/lib/search/hash.ts:1: /**
039875| NOTE: Block comment line describing behavior or context.
039876| src/lib/search/hash.ts:2:  * Search API v2 - Query Hash and Cursor Utilities
039877| NOTE: Block comment line describing behavior or context.
039878| src/lib/search/hash.ts:3:  *
039879| NOTE: Block comment line describing behavior or context.
039880| src/lib/search/hash.ts:4:  * Provides stable cache key generation and cursor encoding for pagination.
039881| NOTE: Block comment line describing behavior or context.
039882| src/lib/search/hash.ts:5:  */
039883| NOTE: Block comment line describing behavior or context.
039884| src/lib/search/hash.ts:6: 
039885| NOTE: Blank line for visual separation.
039886| src/lib/search/hash.ts:7: import { createHash } from "crypto";
039887| NOTE: Imports dependency for this module.
039888| src/lib/search/hash.ts:8: import { BOUNDS_EPSILON } from "./types";
039889| NOTE: Imports dependency for this module.
039890| src/lib/search/hash.ts:9: 
039891| NOTE: Blank line for visual separation.
039892| src/lib/search/hash.ts:10: // ============================================================================
039893| NOTE: Line comment documents intent or constraints.
039894| src/lib/search/hash.ts:11: // Keyset Cursor Re-exports
039895| NOTE: Line comment documents intent or constraints.
039896| src/lib/search/hash.ts:12: // ============================================================================
039897| NOTE: Line comment documents intent or constraints.
039898| src/lib/search/hash.ts:13: 
039899| NOTE: Blank line for visual separation.
039900| src/lib/search/hash.ts:14: // Re-export keyset cursor utilities for backward compatibility
039901| NOTE: Line comment documents intent or constraints.
039902| src/lib/search/hash.ts:15: // New code should import directly from cursor.ts
039903| NOTE: Line comment documents intent or constraints.
039904| src/lib/search/hash.ts:16: export {
039905| NOTE: Implementation detail supporting search page behavior.
039906| src/lib/search/hash.ts:17:   encodeKeysetCursor,
039907| NOTE: Implementation detail supporting search page behavior.
039908| src/lib/search/hash.ts:18:   decodeKeysetCursor,
039909| NOTE: Implementation detail supporting search page behavior.
039910| src/lib/search/hash.ts:19:   buildCursorFromRow,
039911| NOTE: Implementation detail supporting search page behavior.
039912| src/lib/search/hash.ts:20:   decodeCursorAny,
039913| NOTE: Implementation detail supporting search page behavior.
039914| src/lib/search/hash.ts:21:   decodeLegacyCursor,
039915| NOTE: Implementation detail supporting search page behavior.
039916| src/lib/search/hash.ts:22:   SORT_OPTIONS,
039917| NOTE: Implementation detail supporting search page behavior.
039918| src/lib/search/hash.ts:23:   type KeysetCursor,
039919| NOTE: Type declaration for search data contracts.
039920| src/lib/search/hash.ts:24:   type SortOption,
039921| NOTE: Type declaration for search data contracts.
039922| src/lib/search/hash.ts:25:   type CursorRowData,
039923| NOTE: Type declaration for search data contracts.
039924| src/lib/search/hash.ts:26: } from "./cursor";
039925| NOTE: Implementation detail supporting search page behavior.
039926| src/lib/search/hash.ts:27: 
039927| NOTE: Blank line for visual separation.
039928| src/lib/search/hash.ts:28: // ============================================================================
039929| NOTE: Line comment documents intent or constraints.
039930| src/lib/search/hash.ts:29: // Query Hash Generation
039931| NOTE: Line comment documents intent or constraints.
039932| src/lib/search/hash.ts:30: // ============================================================================
039933| NOTE: Line comment documents intent or constraints.
039934| src/lib/search/hash.ts:31: 
039935| NOTE: Blank line for visual separation.
039936| src/lib/search/hash.ts:32: /**
039937| NOTE: Block comment line describing behavior or context.
039938| src/lib/search/hash.ts:33:  * Filter parameters used for hash generation.
039939| NOTE: Block comment line describing behavior or context.
039940| src/lib/search/hash.ts:34:  * Matches the shape from parseSearchParams().
039941| NOTE: Block comment line describing behavior or context.
039942| src/lib/search/hash.ts:35:  */
039943| NOTE: Block comment line describing behavior or context.
039944| src/lib/search/hash.ts:36: export interface HashableFilterParams {
039945| NOTE: Implementation detail supporting search page behavior.
039946| src/lib/search/hash.ts:37:   query?: string;
039947| NOTE: Implementation detail supporting search page behavior.
039948| src/lib/search/hash.ts:38:   minPrice?: number;
039949| NOTE: Implementation detail supporting search page behavior.
039950| src/lib/search/hash.ts:39:   maxPrice?: number;
039951| NOTE: Implementation detail supporting search page behavior.
039952| src/lib/search/hash.ts:40:   amenities?: string[];
039953| NOTE: Implementation detail supporting search page behavior.
039954| src/lib/search/hash.ts:41:   houseRules?: string[];
039955| NOTE: Implementation detail supporting search page behavior.
039956| src/lib/search/hash.ts:42:   languages?: string[];
039957| NOTE: Implementation detail supporting search page behavior.
039958| src/lib/search/hash.ts:43:   roomType?: string;
039959| NOTE: Implementation detail supporting search page behavior.
039960| src/lib/search/hash.ts:44:   leaseDuration?: string;
039961| NOTE: Implementation detail supporting search page behavior.
039962| src/lib/search/hash.ts:45:   moveInDate?: string;
039963| NOTE: Implementation detail supporting search page behavior.
039964| src/lib/search/hash.ts:46:   bounds?: {
039965| NOTE: Implementation detail supporting search page behavior.
039966| src/lib/search/hash.ts:47:     minLat: number;
039967| NOTE: Implementation detail supporting search page behavior.
039968| src/lib/search/hash.ts:48:     maxLat: number;
039969| NOTE: Implementation detail supporting search page behavior.
039970| src/lib/search/hash.ts:49:     minLng: number;
039971| NOTE: Implementation detail supporting search page behavior.
039972| src/lib/search/hash.ts:50:     maxLng: number;
039973| NOTE: Implementation detail supporting search page behavior.
039974| src/lib/search/hash.ts:51:   };
039975| NOTE: Implementation detail supporting search page behavior.
039976| src/lib/search/hash.ts:52:   nearMatches?: boolean;
039977| NOTE: Implementation detail supporting search page behavior.
039978| src/lib/search/hash.ts:53: }
039979| NOTE: Implementation detail supporting search page behavior.
039980| src/lib/search/hash.ts:54: 
039981| NOTE: Blank line for visual separation.
039982| src/lib/search/hash.ts:55: /**
039983| NOTE: Block comment line describing behavior or context.
039984| src/lib/search/hash.ts:56:  * Quantize a coordinate value using BOUNDS_EPSILON for cache stability.
039985| NOTE: Block comment line describing behavior or context.
039986| src/lib/search/hash.ts:57:  * This ensures nearby queries (within ~100m) hit the same cache key.
039987| NOTE: Block comment line describing behavior or context.
039988| src/lib/search/hash.ts:58:  */
039989| NOTE: Block comment line describing behavior or context.
039990| src/lib/search/hash.ts:59: function quantizeBound(value: number): number {
039991| NOTE: Defines a helper or component function.
039992| src/lib/search/hash.ts:60:   return Math.round(value / BOUNDS_EPSILON) * BOUNDS_EPSILON;
039993| NOTE: Return statement for component or helper output.
039994| src/lib/search/hash.ts:61: }
039995| NOTE: Implementation detail supporting search page behavior.
039996| src/lib/search/hash.ts:62: 
039997| NOTE: Blank line for visual separation.
039998| src/lib/search/hash.ts:63: /**
039999| NOTE: Block comment line describing behavior or context.
040000| src/lib/search/hash.ts:64:  * Generate a stable 16-character hash from filter parameters.
040001| NOTE: Block comment line describing behavior or context.
040002| src/lib/search/hash.ts:65:  *
040003| NOTE: Block comment line describing behavior or context.
040004| src/lib/search/hash.ts:66:  * Key features:
040005| NOTE: Block comment line describing behavior or context.
040006| src/lib/search/hash.ts:67:  * - Bounds quantized with BOUNDS_EPSILON (0.001) for ~100m cache tolerance
040007| NOTE: Block comment line describing behavior or context.
040008| src/lib/search/hash.ts:68:  * - Arrays sorted for order-independence
040009| NOTE: Block comment line describing behavior or context.
040010| src/lib/search/hash.ts:69:  * - Strings lowercased for case-insensitivity
040011| NOTE: Block comment line describing behavior or context.
040012| src/lib/search/hash.ts:70:  * - Excludes pagination params (page, limit, cursor) for reusability
040013| NOTE: Block comment line describing behavior or context.
040014| src/lib/search/hash.ts:71:  */
040015| NOTE: Block comment line describing behavior or context.
040016| src/lib/search/hash.ts:72: export function generateQueryHash(params: HashableFilterParams): string {
040017| NOTE: Exports helper or component function.
040018| src/lib/search/hash.ts:73:   // Normalize params for stable hashing
040019| NOTE: Line comment documents intent or constraints.
040020| src/lib/search/hash.ts:74:   const normalized = {
040021| NOTE: Local declaration used by search logic or UI.
040022| src/lib/search/hash.ts:75:     q: (params.query ?? "").toLowerCase().trim(),
040023| NOTE: Implementation detail supporting search page behavior.
040024| src/lib/search/hash.ts:76:     minPrice: params.minPrice ?? null,
040025| NOTE: Implementation detail supporting search page behavior.
040026| src/lib/search/hash.ts:77:     maxPrice: params.maxPrice ?? null,
040027| NOTE: Implementation detail supporting search page behavior.
040028| src/lib/search/hash.ts:78:     amenities: [...(params.amenities ?? [])].sort(),
040029| NOTE: Implementation detail supporting search page behavior.
040030| src/lib/search/hash.ts:79:     houseRules: [...(params.houseRules ?? [])].sort(),
040031| NOTE: Implementation detail supporting search page behavior.
040032| src/lib/search/hash.ts:80:     languages: [...(params.languages ?? [])].sort(),
040033| NOTE: Implementation detail supporting search page behavior.
040034| src/lib/search/hash.ts:81:     roomType: (params.roomType ?? "").toLowerCase(),
040035| NOTE: Implementation detail supporting search page behavior.
040036| src/lib/search/hash.ts:82:     leaseDuration: (params.leaseDuration ?? "").toLowerCase(),
040037| NOTE: Implementation detail supporting search page behavior.
040038| src/lib/search/hash.ts:83:     moveInDate: params.moveInDate ?? "",
040039| NOTE: Implementation detail supporting search page behavior.
040040| src/lib/search/hash.ts:84:     nearMatches: params.nearMatches ?? false,
040041| NOTE: Implementation detail supporting search page behavior.
040042| src/lib/search/hash.ts:85:     // Quantize bounds for cache stability
040043| NOTE: Line comment documents intent or constraints.
040044| src/lib/search/hash.ts:86:     bounds: params.bounds
040045| NOTE: Implementation detail supporting search page behavior.
040046| src/lib/search/hash.ts:87:       ? {
040047| NOTE: Implementation detail supporting search page behavior.
040048| src/lib/search/hash.ts:88:           minLat: quantizeBound(params.bounds.minLat),
040049| NOTE: Implementation detail supporting search page behavior.
040050| src/lib/search/hash.ts:89:           maxLat: quantizeBound(params.bounds.maxLat),
040051| NOTE: Implementation detail supporting search page behavior.
040052| src/lib/search/hash.ts:90:           minLng: quantizeBound(params.bounds.minLng),
040053| NOTE: Implementation detail supporting search page behavior.
040054| src/lib/search/hash.ts:91:           maxLng: quantizeBound(params.bounds.maxLng),
040055| NOTE: Implementation detail supporting search page behavior.
040056| src/lib/search/hash.ts:92:         }
040057| NOTE: Implementation detail supporting search page behavior.
040058| src/lib/search/hash.ts:93:       : null,
040059| NOTE: Implementation detail supporting search page behavior.
040060| src/lib/search/hash.ts:94:   };
040061| NOTE: Implementation detail supporting search page behavior.
040062| src/lib/search/hash.ts:95: 
040063| NOTE: Blank line for visual separation.
040064| src/lib/search/hash.ts:96:   // Generate SHA256 hash and truncate to 16 chars
040065| NOTE: Line comment documents intent or constraints.
040066| src/lib/search/hash.ts:97:   const hash = createHash("sha256")
040067| NOTE: Local declaration used by search logic or UI.
040068| src/lib/search/hash.ts:98:     .update(JSON.stringify(normalized))
040069| NOTE: Implementation detail supporting search page behavior.
040070| src/lib/search/hash.ts:99:     .digest("hex");
040071| NOTE: Implementation detail supporting search page behavior.
040072| src/lib/search/hash.ts:100: 
040073| NOTE: Blank line for visual separation.
040074| src/lib/search/hash.ts:101:   return hash.slice(0, 16);
040075| NOTE: Return statement for component or helper output.
040076| src/lib/search/hash.ts:102: }
040077| NOTE: Implementation detail supporting search page behavior.
040078| src/lib/search/hash.ts:103: 
040079| NOTE: Blank line for visual separation.
040080| src/lib/search/hash.ts:104: // ============================================================================
040081| NOTE: Line comment documents intent or constraints.
040082| src/lib/search/hash.ts:105: // Cursor Encoding/Decoding
040083| NOTE: Line comment documents intent or constraints.
040084| src/lib/search/hash.ts:106: // ============================================================================
040085| NOTE: Line comment documents intent or constraints.
040086| src/lib/search/hash.ts:107: 
040087| NOTE: Blank line for visual separation.
040088| src/lib/search/hash.ts:108: /**
040089| NOTE: Block comment line describing behavior or context.
040090| src/lib/search/hash.ts:109:  * Encode a page number as a base64url cursor.
040091| NOTE: Block comment line describing behavior or context.
040092| src/lib/search/hash.ts:110:  * Used for opaque pagination tokens in the API response.
040093| NOTE: Block comment line describing behavior or context.
040094| src/lib/search/hash.ts:111:  */
040095| NOTE: Block comment line describing behavior or context.
040096| src/lib/search/hash.ts:112: export function encodeCursor(page: number): string {
040097| NOTE: Exports helper or component function.
040098| src/lib/search/hash.ts:113:   const payload = JSON.stringify({ p: page });
040099| NOTE: Local declaration used by search logic or UI.
040100| src/lib/search/hash.ts:114:   return Buffer.from(payload).toString("base64url");
040101| NOTE: Return statement for component or helper output.
040102| src/lib/search/hash.ts:115: }
040103| NOTE: Implementation detail supporting search page behavior.
040104| src/lib/search/hash.ts:116: 
040105| NOTE: Blank line for visual separation.
040106| src/lib/search/hash.ts:117: /**
040107| NOTE: Block comment line describing behavior or context.
040108| src/lib/search/hash.ts:118:  * Decode a base64url cursor to a page number.
040109| NOTE: Block comment line describing behavior or context.
040110| src/lib/search/hash.ts:119:  * Returns null if the cursor is invalid or malformed.
040111| NOTE: Block comment line describing behavior or context.
040112| src/lib/search/hash.ts:120:  */
040113| NOTE: Block comment line describing behavior or context.
040114| src/lib/search/hash.ts:121: export function decodeCursor(cursor: string): number | null {
040115| NOTE: Exports helper or component function.
040116| src/lib/search/hash.ts:122:   try {
040117| NOTE: Implementation detail supporting search page behavior.
040118| src/lib/search/hash.ts:123:     const payload = Buffer.from(cursor, "base64url").toString("utf-8");
040119| NOTE: Local declaration used by search logic or UI.
040120| src/lib/search/hash.ts:124:     const parsed = JSON.parse(payload);
040121| NOTE: Local declaration used by search logic or UI.
040122| src/lib/search/hash.ts:125: 
040123| NOTE: Blank line for visual separation.
040124| src/lib/search/hash.ts:126:     if (typeof parsed?.p === "number" && parsed.p > 0) {
040125| NOTE: Conditional logic controlling rendering or flow.
040126| src/lib/search/hash.ts:127:       return parsed.p;
040127| NOTE: Return statement for component or helper output.
040128| src/lib/search/hash.ts:128:     }
040129| NOTE: Implementation detail supporting search page behavior.
040130| src/lib/search/hash.ts:129:     return null;
040131| NOTE: Return statement for component or helper output.
040132| src/lib/search/hash.ts:130:   } catch {
040133| NOTE: Implementation detail supporting search page behavior.
040134| src/lib/search/hash.ts:131:     return null;
040135| NOTE: Return statement for component or helper output.
040136| src/lib/search/hash.ts:132:   }
040137| NOTE: Implementation detail supporting search page behavior.
040138| src/lib/search/hash.ts:133: }
040139| NOTE: Implementation detail supporting search page behavior.
040140| FILE END: src/lib/search/hash.ts
040141| 
040142| FILE START: src/lib/search/ranking/index.ts
040143| FILE ROLE: Auto-discovered dependency in search page graph.
040144| src/lib/search/ranking/index.ts:1: /**
040145| NOTE: Block comment line describing behavior or context.
040146| src/lib/search/ranking/index.ts:2:  * Search Ranking Module
040147| NOTE: Block comment line describing behavior or context.
040148| src/lib/search/ranking/index.ts:3:  *
040149| NOTE: Block comment line describing behavior or context.
040150| src/lib/search/ranking/index.ts:4:  * Provides score-based ranking for map pin tiering.
040151| NOTE: Block comment line describing behavior or context.
040152| src/lib/search/ranking/index.ts:5:  * V1 uses heuristic signals; designed for future ML integration.
040153| NOTE: Block comment line describing behavior or context.
040154| src/lib/search/ranking/index.ts:6:  *
040155| NOTE: Block comment line describing behavior or context.
040156| src/lib/search/ranking/index.ts:7:  * Usage:
040157| NOTE: Block comment line describing behavior or context.
040158| src/lib/search/ranking/index.ts:8:  *   import { isRankingEnabled, buildScoreMap, computeMedianPrice } from '@/lib/search/ranking';
040159| NOTE: Block comment line describing behavior or context.
040160| src/lib/search/ranking/index.ts:9:  *
040161| NOTE: Block comment line describing behavior or context.
040162| src/lib/search/ranking/index.ts:10:  *   if (isRankingEnabled(params.ranker)) {
040163| NOTE: Block comment line describing behavior or context.
040164| src/lib/search/ranking/index.ts:11:  *     const context = {
040165| NOTE: Block comment line describing behavior or context.
040166| src/lib/search/ranking/index.ts:12:  *       sort: params.sort,
040167| NOTE: Block comment line describing behavior or context.
040168| src/lib/search/ranking/index.ts:13:  *       center: getBoundsCenter(bounds),
040169| NOTE: Block comment line describing behavior or context.
040170| src/lib/search/ranking/index.ts:14:  *       localMedianPrice: computeMedianPrice(mapListings),
040171| NOTE: Block comment line describing behavior or context.
040172| src/lib/search/ranking/index.ts:15:  *     };
040173| NOTE: Block comment line describing behavior or context.
040174| src/lib/search/ranking/index.ts:16:  *     const scoreMap = buildScoreMap(mapListings, context);
040175| NOTE: Block comment line describing behavior or context.
040176| src/lib/search/ranking/index.ts:17:  *     // Pass scoreMap to transformToPins for score-based tiering
040177| NOTE: Block comment line describing behavior or context.
040178| src/lib/search/ranking/index.ts:18:  *   }
040179| NOTE: Block comment line describing behavior or context.
040180| src/lib/search/ranking/index.ts:19:  */
040181| NOTE: Block comment line describing behavior or context.
040182| src/lib/search/ranking/index.ts:20: 
040183| NOTE: Blank line for visual separation.
040184| src/lib/search/ranking/index.ts:21: import { features } from "@/lib/env";
040185| NOTE: Imports dependency for this module.
040186| src/lib/search/ranking/index.ts:22: 
040187| NOTE: Blank line for visual separation.
040188| src/lib/search/ranking/index.ts:23: // Re-export types
040189| NOTE: Line comment documents intent or constraints.
040190| src/lib/search/ranking/index.ts:24: export type {
040191| NOTE: Implementation detail supporting search page behavior.
040192| src/lib/search/ranking/index.ts:25:   RankingContext,
040193| NOTE: Implementation detail supporting search page behavior.
040194| src/lib/search/ranking/index.ts:26:   RankingWeights,
040195| NOTE: Implementation detail supporting search page behavior.
040196| src/lib/search/ranking/index.ts:27:   SignalValues,
040197| NOTE: Implementation detail supporting search page behavior.
040198| src/lib/search/ranking/index.ts:28:   DebugSignals,
040199| NOTE: Implementation detail supporting search page behavior.
040200| src/lib/search/ranking/index.ts:29:   RankableListing,
040201| NOTE: Implementation detail supporting search page behavior.
040202| src/lib/search/ranking/index.ts:30:   RankingConfig,
040203| NOTE: Implementation detail supporting search page behavior.
040204| src/lib/search/ranking/index.ts:31: } from "./types";
040205| NOTE: Implementation detail supporting search page behavior.
040206| src/lib/search/ranking/index.ts:32: 
040207| NOTE: Blank line for visual separation.
040208| src/lib/search/ranking/index.ts:33: // Re-export scoring functions
040209| NOTE: Line comment documents intent or constraints.
040210| src/lib/search/ranking/index.ts:34: export {
040211| NOTE: Implementation detail supporting search page behavior.
040212| src/lib/search/ranking/index.ts:35:   DEFAULT_WEIGHTS,
040213| NOTE: Implementation detail supporting search page behavior.
040214| src/lib/search/ranking/index.ts:36:   computeScore,
040215| NOTE: Implementation detail supporting search page behavior.
040216| src/lib/search/ranking/index.ts:37:   computeSignals,
040217| NOTE: Implementation detail supporting search page behavior.
040218| src/lib/search/ranking/index.ts:38:   normalizeRecommendedScore,
040219| NOTE: Implementation detail supporting search page behavior.
040220| src/lib/search/ranking/index.ts:39:   normalizeRating,
040221| NOTE: Implementation detail supporting search page behavior.
040222| src/lib/search/ranking/index.ts:40:   normalizePriceCompetitiveness,
040223| NOTE: Implementation detail supporting search page behavior.
040224| src/lib/search/ranking/index.ts:41:   normalizeRecency,
040225| NOTE: Implementation detail supporting search page behavior.
040226| src/lib/search/ranking/index.ts:42:   normalizeDistance,
040227| NOTE: Implementation detail supporting search page behavior.
040228| src/lib/search/ranking/index.ts:43:   computeMedianPrice,
040229| NOTE: Implementation detail supporting search page behavior.
040230| src/lib/search/ranking/index.ts:44:   getBoundsCenter,
040231| NOTE: Implementation detail supporting search page behavior.
040232| src/lib/search/ranking/index.ts:45: } from "./score";
040233| NOTE: Implementation detail supporting search page behavior.
040234| src/lib/search/ranking/index.ts:46: 
040235| NOTE: Blank line for visual separation.
040236| src/lib/search/ranking/index.ts:47: // Re-export ranking functions
040237| NOTE: Line comment documents intent or constraints.
040238| src/lib/search/ranking/index.ts:48: export { buildScoreMap, rankListings, getDebugSignals } from "./rank";
040239| NOTE: Implementation detail supporting search page behavior.
040240| src/lib/search/ranking/index.ts:49: 
040241| NOTE: Blank line for visual separation.
040242| src/lib/search/ranking/index.ts:50: /**
040243| NOTE: Block comment line describing behavior or context.
040244| src/lib/search/ranking/index.ts:51:  * Current ranking version for A/B testing and debugging.
040245| NOTE: Block comment line describing behavior or context.
040246| src/lib/search/ranking/index.ts:52:  */
040247| NOTE: Block comment line describing behavior or context.
040248| src/lib/search/ranking/index.ts:53: export const RANKING_VERSION = "v1-heuristic";
040249| NOTE: Implementation detail supporting search page behavior.
040250| src/lib/search/ranking/index.ts:54: 
040251| NOTE: Blank line for visual separation.
040252| src/lib/search/ranking/index.ts:55: /**
040253| NOTE: Block comment line describing behavior or context.
040254| src/lib/search/ranking/index.ts:56:  * Check if ranking is enabled.
040255| NOTE: Block comment line describing behavior or context.
040256| src/lib/search/ranking/index.ts:57:  * Supports URL override for dev testing.
040257| NOTE: Block comment line describing behavior or context.
040258| src/lib/search/ranking/index.ts:58:  *
040259| NOTE: Block comment line describing behavior or context.
040260| src/lib/search/ranking/index.ts:59:  * @param urlRanker - Value of ?ranker= query param (optional)
040261| NOTE: Block comment line describing behavior or context.
040262| src/lib/search/ranking/index.ts:60:  * @returns true if ranking should be applied
040263| NOTE: Block comment line describing behavior or context.
040264| src/lib/search/ranking/index.ts:61:  */
040265| NOTE: Block comment line describing behavior or context.
040266| src/lib/search/ranking/index.ts:62: export function isRankingEnabled(urlRanker?: string | null): boolean {
040267| NOTE: Exports helper or component function.
040268| src/lib/search/ranking/index.ts:63:   // URL override (dev only) - explicit enable
040269| NOTE: Line comment documents intent or constraints.
040270| src/lib/search/ranking/index.ts:64:   if (urlRanker === "1" || urlRanker === "true") return true;
040271| NOTE: Conditional logic controlling rendering or flow.
040272| src/lib/search/ranking/index.ts:65: 
040273| NOTE: Blank line for visual separation.
040274| src/lib/search/ranking/index.ts:66:   // URL override (dev only) - explicit disable
040275| NOTE: Line comment documents intent or constraints.
040276| src/lib/search/ranking/index.ts:67:   if (urlRanker === "0" || urlRanker === "false") return false;
040277| NOTE: Conditional logic controlling rendering or flow.
040278| src/lib/search/ranking/index.ts:68: 
040279| NOTE: Blank line for visual separation.
040280| src/lib/search/ranking/index.ts:69:   // Fall back to env feature flag
040281| NOTE: Line comment documents intent or constraints.
040282| src/lib/search/ranking/index.ts:70:   return features.searchRanking;
040283| NOTE: Return statement for component or helper output.
040284| src/lib/search/ranking/index.ts:71: }
040285| NOTE: Implementation detail supporting search page behavior.
040286| FILE END: src/lib/search/ranking/index.ts
040287| 
040288| FILE START: src/lib/search/ranking/rank.ts
040289| FILE ROLE: Auto-discovered dependency in search page graph.
040290| src/lib/search/ranking/rank.ts:1: /**
040291| NOTE: Block comment line describing behavior or context.
040292| src/lib/search/ranking/rank.ts:2:  * Search Ranking Module - Ranking Functions
040293| NOTE: Block comment line describing behavior or context.
040294| src/lib/search/ranking/rank.ts:3:  *
040295| NOTE: Block comment line describing behavior or context.
040296| src/lib/search/ranking/rank.ts:4:  * Converts scores to ranks and builds score/rank maps for listings.
040297| NOTE: Block comment line describing behavior or context.
040298| src/lib/search/ranking/rank.ts:5:  * Ensures deterministic ordering with stable tie-breaking.
040299| NOTE: Block comment line describing behavior or context.
040300| src/lib/search/ranking/rank.ts:6:  */
040301| NOTE: Block comment line describing behavior or context.
040302| src/lib/search/ranking/rank.ts:7: 
040303| NOTE: Blank line for visual separation.
040304| src/lib/search/ranking/rank.ts:8: import type {
040305| NOTE: Imports dependency for this module.
040306| src/lib/search/ranking/rank.ts:9:   DebugSignals,
040307| NOTE: Implementation detail supporting search page behavior.
040308| src/lib/search/ranking/rank.ts:10:   RankableListing,
040309| NOTE: Implementation detail supporting search page behavior.
040310| src/lib/search/ranking/rank.ts:11:   RankingContext,
040311| NOTE: Implementation detail supporting search page behavior.
040312| src/lib/search/ranking/rank.ts:12:   RankingWeights,
040313| NOTE: Implementation detail supporting search page behavior.
040314| src/lib/search/ranking/rank.ts:13: } from "./types";
040315| NOTE: Implementation detail supporting search page behavior.
040316| src/lib/search/ranking/rank.ts:14: import { computeScore, computeSignals, DEFAULT_WEIGHTS } from "./score";
040317| NOTE: Imports dependency for this module.
040318| src/lib/search/ranking/rank.ts:15: 
040319| NOTE: Blank line for visual separation.
040320| src/lib/search/ranking/rank.ts:16: /**
040321| NOTE: Block comment line describing behavior or context.
040322| src/lib/search/ranking/rank.ts:17:  * Build a map of listing ID to score.
040323| NOTE: Block comment line describing behavior or context.
040324| src/lib/search/ranking/rank.ts:18:  *
040325| NOTE: Block comment line describing behavior or context.
040326| src/lib/search/ranking/rank.ts:19:  * @param listings - Array of listings to score
040327| NOTE: Block comment line describing behavior or context.
040328| src/lib/search/ranking/rank.ts:20:  * @param context - Ranking context (sort, center, medianPrice)
040329| NOTE: Block comment line describing behavior or context.
040330| src/lib/search/ranking/rank.ts:21:  * @param weights - Optional custom weights (defaults to DEFAULT_WEIGHTS)
040331| NOTE: Block comment line describing behavior or context.
040332| src/lib/search/ranking/rank.ts:22:  * @returns Map of listing ID to score (0-1, higher = better)
040333| NOTE: Block comment line describing behavior or context.
040334| src/lib/search/ranking/rank.ts:23:  */
040335| NOTE: Block comment line describing behavior or context.
040336| src/lib/search/ranking/rank.ts:24: export function buildScoreMap<T extends RankableListing>(
040337| NOTE: Exports helper or component function.
040338| src/lib/search/ranking/rank.ts:25:   listings: T[],
040339| NOTE: Implementation detail supporting search page behavior.
040340| src/lib/search/ranking/rank.ts:26:   context: RankingContext,
040341| NOTE: Implementation detail supporting search page behavior.
040342| src/lib/search/ranking/rank.ts:27:   weights: RankingWeights = DEFAULT_WEIGHTS,
040343| NOTE: Implementation detail supporting search page behavior.
040344| src/lib/search/ranking/rank.ts:28: ): Map<string, number> {
040345| NOTE: Implementation detail supporting search page behavior.
040346| src/lib/search/ranking/rank.ts:29:   const map = new Map<string, number>();
040347| NOTE: Local declaration used by search logic or UI.
040348| src/lib/search/ranking/rank.ts:30: 
040349| NOTE: Blank line for visual separation.
040350| src/lib/search/ranking/rank.ts:31:   for (const listing of listings) {
040351| NOTE: Implementation detail supporting search page behavior.
040352| src/lib/search/ranking/rank.ts:32:     map.set(listing.id, computeScore(listing, context, weights));
040353| NOTE: Implementation detail supporting search page behavior.
040354| src/lib/search/ranking/rank.ts:33:   }
040355| NOTE: Implementation detail supporting search page behavior.
040356| src/lib/search/ranking/rank.ts:34: 
040357| NOTE: Blank line for visual separation.
040358| src/lib/search/ranking/rank.ts:35:   return map;
040359| NOTE: Return statement for component or helper output.
040360| src/lib/search/ranking/rank.ts:36: }
040361| NOTE: Implementation detail supporting search page behavior.
040362| src/lib/search/ranking/rank.ts:37: 
040363| NOTE: Blank line for visual separation.
040364| src/lib/search/ranking/rank.ts:38: /**
040365| NOTE: Block comment line describing behavior or context.
040366| src/lib/search/ranking/rank.ts:39:  * Rank listings by score in descending order.
040367| NOTE: Block comment line describing behavior or context.
040368| src/lib/search/ranking/rank.ts:40:  * Returns a new sorted array without modifying the original.
040369| NOTE: Block comment line describing behavior or context.
040370| src/lib/search/ranking/rank.ts:41:  * Uses stable tie-breaking by ID for determinism.
040371| NOTE: Block comment line describing behavior or context.
040372| src/lib/search/ranking/rank.ts:42:  *
040373| NOTE: Block comment line describing behavior or context.
040374| src/lib/search/ranking/rank.ts:43:  * @param candidates - Array of listings to rank
040375| NOTE: Block comment line describing behavior or context.
040376| src/lib/search/ranking/rank.ts:44:  * @param scoreMap - Map of listing ID to score
040377| NOTE: Block comment line describing behavior or context.
040378| src/lib/search/ranking/rank.ts:45:  * @returns New array sorted by score (descending), then by ID (ascending)
040379| NOTE: Block comment line describing behavior or context.
040380| src/lib/search/ranking/rank.ts:46:  */
040381| NOTE: Block comment line describing behavior or context.
040382| src/lib/search/ranking/rank.ts:47: export function rankListings<T extends { id: string }>(
040383| NOTE: Exports helper or component function.
040384| src/lib/search/ranking/rank.ts:48:   candidates: T[],
040385| NOTE: Implementation detail supporting search page behavior.
040386| src/lib/search/ranking/rank.ts:49:   scoreMap: Map<string, number>,
040387| NOTE: Implementation detail supporting search page behavior.
040388| src/lib/search/ranking/rank.ts:50: ): T[] {
040389| NOTE: Implementation detail supporting search page behavior.
040390| src/lib/search/ranking/rank.ts:51:   return [...candidates].sort((a, b) => {
040391| NOTE: Return statement for component or helper output.
040392| src/lib/search/ranking/rank.ts:52:     const scoreA = scoreMap.get(a.id) ?? 0;
040393| NOTE: Local declaration used by search logic or UI.
040394| src/lib/search/ranking/rank.ts:53:     const scoreB = scoreMap.get(b.id) ?? 0;
040395| NOTE: Local declaration used by search logic or UI.
040396| src/lib/search/ranking/rank.ts:54: 
040397| NOTE: Blank line for visual separation.
040398| src/lib/search/ranking/rank.ts:55:     // Higher score wins
040399| NOTE: Line comment documents intent or constraints.
040400| src/lib/search/ranking/rank.ts:56:     if (scoreB !== scoreA) return scoreB - scoreA;
040401| NOTE: Conditional logic controlling rendering or flow.
040402| src/lib/search/ranking/rank.ts:57: 
040403| NOTE: Blank line for visual separation.
040404| src/lib/search/ranking/rank.ts:58:     // Stable tie-break by ID (deterministic)
040405| NOTE: Line comment documents intent or constraints.
040406| src/lib/search/ranking/rank.ts:59:     return a.id.localeCompare(b.id);
040407| NOTE: Return statement for component or helper output.
040408| src/lib/search/ranking/rank.ts:60:   });
040409| NOTE: Implementation detail supporting search page behavior.
040410| src/lib/search/ranking/rank.ts:61: }
040411| NOTE: Implementation detail supporting search page behavior.
040412| src/lib/search/ranking/rank.ts:62: 
040413| NOTE: Blank line for visual separation.
040414| src/lib/search/ranking/rank.ts:63: /**
040415| NOTE: Block comment line describing behavior or context.
040416| src/lib/search/ranking/rank.ts:64:  * Get debug signals for top N listings.
040417| NOTE: Block comment line describing behavior or context.
040418| src/lib/search/ranking/rank.ts:65:  * Only includes ID and normalized signal values (0-1) - no PII.
040419| NOTE: Block comment line describing behavior or context.
040420| src/lib/search/ranking/rank.ts:66:  *
040421| NOTE: Block comment line describing behavior or context.
040422| src/lib/search/ranking/rank.ts:67:  * @param listings - Array of listings with scores
040423| NOTE: Block comment line describing behavior or context.
040424| src/lib/search/ranking/rank.ts:68:  * @param scoreMap - Map of listing ID to score
040425| NOTE: Block comment line describing behavior or context.
040426| src/lib/search/ranking/rank.ts:69:  * @param context - Ranking context
040427| NOTE: Block comment line describing behavior or context.
040428| src/lib/search/ranking/rank.ts:70:  * @param limit - Maximum number of entries to return (default: 5)
040429| NOTE: Block comment line describing behavior or context.
040430| src/lib/search/ranking/rank.ts:71:  * @returns Array of debug signal objects (capped at limit)
040431| NOTE: Block comment line describing behavior or context.
040432| src/lib/search/ranking/rank.ts:72:  */
040433| NOTE: Block comment line describing behavior or context.
040434| src/lib/search/ranking/rank.ts:73: export function getDebugSignals<T extends RankableListing>(
040435| NOTE: Exports helper or component function.
040436| src/lib/search/ranking/rank.ts:74:   listings: T[],
040437| NOTE: Implementation detail supporting search page behavior.
040438| src/lib/search/ranking/rank.ts:75:   scoreMap: Map<string, number>,
040439| NOTE: Implementation detail supporting search page behavior.
040440| src/lib/search/ranking/rank.ts:76:   context: RankingContext,
040441| NOTE: Implementation detail supporting search page behavior.
040442| src/lib/search/ranking/rank.ts:77:   limit: number = 5,
040443| NOTE: Implementation detail supporting search page behavior.
040444| src/lib/search/ranking/rank.ts:78: ): DebugSignals[] {
040445| NOTE: Implementation detail supporting search page behavior.
040446| src/lib/search/ranking/rank.ts:79:   // Sort by score to get top listings
040447| NOTE: Line comment documents intent or constraints.
040448| src/lib/search/ranking/rank.ts:80:   const ranked = rankListings(listings, scoreMap);
040449| NOTE: Local declaration used by search logic or UI.
040450| src/lib/search/ranking/rank.ts:81: 
040451| NOTE: Blank line for visual separation.
040452| src/lib/search/ranking/rank.ts:82:   // Take only top N
040453| NOTE: Line comment documents intent or constraints.
040454| src/lib/search/ranking/rank.ts:83:   const topListings = ranked.slice(0, limit);
040455| NOTE: Local declaration used by search logic or UI.
040456| src/lib/search/ranking/rank.ts:84: 
040457| NOTE: Blank line for visual separation.
040458| src/lib/search/ranking/rank.ts:85:   return topListings.map((listing) => {
040459| NOTE: Return statement for component or helper output.
040460| src/lib/search/ranking/rank.ts:86:     const signals = computeSignals(listing, context);
040461| NOTE: Local declaration used by search logic or UI.
040462| src/lib/search/ranking/rank.ts:87:     const total = scoreMap.get(listing.id) ?? 0;
040463| NOTE: Local declaration used by search logic or UI.
040464| src/lib/search/ranking/rank.ts:88: 
040465| NOTE: Blank line for visual separation.
040466| src/lib/search/ranking/rank.ts:89:     return {
040467| NOTE: Return statement for component or helper output.
040468| src/lib/search/ranking/rank.ts:90:       id: listing.id,
040469| NOTE: Implementation detail supporting search page behavior.
040470| src/lib/search/ranking/rank.ts:91:       quality: round(signals.quality),
040471| NOTE: Implementation detail supporting search page behavior.
040472| src/lib/search/ranking/rank.ts:92:       rating: round(signals.rating),
040473| NOTE: Implementation detail supporting search page behavior.
040474| src/lib/search/ranking/rank.ts:93:       price: round(signals.price),
040475| NOTE: Implementation detail supporting search page behavior.
040476| src/lib/search/ranking/rank.ts:94:       recency: round(signals.recency),
040477| NOTE: Implementation detail supporting search page behavior.
040478| src/lib/search/ranking/rank.ts:95:       geo: round(signals.geo),
040479| NOTE: Implementation detail supporting search page behavior.
040480| src/lib/search/ranking/rank.ts:96:       total: round(total),
040481| NOTE: Implementation detail supporting search page behavior.
040482| src/lib/search/ranking/rank.ts:97:     };
040483| NOTE: Implementation detail supporting search page behavior.
040484| src/lib/search/ranking/rank.ts:98:   });
040485| NOTE: Implementation detail supporting search page behavior.
040486| src/lib/search/ranking/rank.ts:99: }
040487| NOTE: Implementation detail supporting search page behavior.
040488| src/lib/search/ranking/rank.ts:100: 
040489| NOTE: Blank line for visual separation.
040490| src/lib/search/ranking/rank.ts:101: /**
040491| NOTE: Block comment line describing behavior or context.
040492| src/lib/search/ranking/rank.ts:102:  * Round to 2 decimal places for debug output.
040493| NOTE: Block comment line describing behavior or context.
040494| src/lib/search/ranking/rank.ts:103:  */
040495| NOTE: Block comment line describing behavior or context.
040496| src/lib/search/ranking/rank.ts:104: function round(n: number): number {
040497| NOTE: Defines a helper or component function.
040498| src/lib/search/ranking/rank.ts:105:   return Math.round(n * 100) / 100;
040499| NOTE: Return statement for component or helper output.
040500| src/lib/search/ranking/rank.ts:106: }
040501| NOTE: Implementation detail supporting search page behavior.
040502| FILE END: src/lib/search/ranking/rank.ts
040503| 
040504| FILE START: src/lib/search/ranking/score.ts
040505| FILE ROLE: Auto-discovered dependency in search page graph.
040506| src/lib/search/ranking/score.ts:1: /**
040507| NOTE: Block comment line describing behavior or context.
040508| src/lib/search/ranking/score.ts:2:  * Search Ranking Module - Scoring Functions
040509| NOTE: Block comment line describing behavior or context.
040510| src/lib/search/ranking/score.ts:3:  *
040511| NOTE: Block comment line describing behavior or context.
040512| src/lib/search/ranking/score.ts:4:  * Computes normalized (0-1) scores for each ranking signal.
040513| NOTE: Block comment line describing behavior or context.
040514| src/lib/search/ranking/score.ts:5:  * All signals are designed to be interpretable and tunable.
040515| NOTE: Block comment line describing behavior or context.
040516| src/lib/search/ranking/score.ts:6:  */
040517| NOTE: Block comment line describing behavior or context.
040518| src/lib/search/ranking/score.ts:7: 
040519| NOTE: Blank line for visual separation.
040520| src/lib/search/ranking/score.ts:8: import type {
040521| NOTE: Imports dependency for this module.
040522| src/lib/search/ranking/score.ts:9:   RankableListing,
040523| NOTE: Implementation detail supporting search page behavior.
040524| src/lib/search/ranking/score.ts:10:   RankingContext,
040525| NOTE: Implementation detail supporting search page behavior.
040526| src/lib/search/ranking/score.ts:11:   RankingWeights,
040527| NOTE: Implementation detail supporting search page behavior.
040528| src/lib/search/ranking/score.ts:12:   SignalValues,
040529| NOTE: Implementation detail supporting search page behavior.
040530| src/lib/search/ranking/score.ts:13: } from "./types";
040531| NOTE: Implementation detail supporting search page behavior.
040532| src/lib/search/ranking/score.ts:14: 
040533| NOTE: Blank line for visual separation.
040534| src/lib/search/ranking/score.ts:15: /**
040535| NOTE: Block comment line describing behavior or context.
040536| src/lib/search/ranking/score.ts:16:  * Default weights for v1 heuristic ranker.
040537| NOTE: Block comment line describing behavior or context.
040538| src/lib/search/ranking/score.ts:17:  * Sum = 1.0 for normalized final scores.
040539| NOTE: Block comment line describing behavior or context.
040540| src/lib/search/ranking/score.ts:18:  */
040541| NOTE: Block comment line describing behavior or context.
040542| src/lib/search/ranking/score.ts:19: export const DEFAULT_WEIGHTS: RankingWeights = {
040543| NOTE: Implementation detail supporting search page behavior.
040544| src/lib/search/ranking/score.ts:20:   quality: 0.25, // Pre-computed recommended_score
040545| NOTE: Implementation detail supporting search page behavior.
040546| src/lib/search/ranking/score.ts:21:   rating: 0.25, // Rating with review confidence
040547| NOTE: Implementation detail supporting search page behavior.
040548| src/lib/search/ranking/score.ts:22:   price: 0.15, // Price competitiveness
040549| NOTE: Implementation detail supporting search page behavior.
040550| src/lib/search/ranking/score.ts:23:   recency: 0.15, // Listing freshness
040551| NOTE: Implementation detail supporting search page behavior.
040552| src/lib/search/ranking/score.ts:24:   geo: 0.2, // Distance from center
040553| NOTE: Implementation detail supporting search page behavior.
040554| src/lib/search/ranking/score.ts:25: };
040555| NOTE: Implementation detail supporting search page behavior.
040556| src/lib/search/ranking/score.ts:26: 
040557| NOTE: Blank line for visual separation.
040558| src/lib/search/ranking/score.ts:27: /**
040559| NOTE: Block comment line describing behavior or context.
040560| src/lib/search/ranking/score.ts:28:  * Compute the overall ranking score for a listing.
040561| NOTE: Block comment line describing behavior or context.
040562| src/lib/search/ranking/score.ts:29:  * Returns a value between 0 and 1 (higher = better).
040563| NOTE: Block comment line describing behavior or context.
040564| src/lib/search/ranking/score.ts:30:  */
040565| NOTE: Block comment line describing behavior or context.
040566| src/lib/search/ranking/score.ts:31: export function computeScore(
040567| NOTE: Exports helper or component function.
040568| src/lib/search/ranking/score.ts:32:   listing: RankableListing,
040569| NOTE: Implementation detail supporting search page behavior.
040570| src/lib/search/ranking/score.ts:33:   context: RankingContext,
040571| NOTE: Implementation detail supporting search page behavior.
040572| src/lib/search/ranking/score.ts:34:   weights: RankingWeights = DEFAULT_WEIGHTS,
040573| NOTE: Implementation detail supporting search page behavior.
040574| src/lib/search/ranking/score.ts:35: ): number {
040575| NOTE: Implementation detail supporting search page behavior.
040576| src/lib/search/ranking/score.ts:36:   const signals = computeSignals(listing, context);
040577| NOTE: Local declaration used by search logic or UI.
040578| src/lib/search/ranking/score.ts:37: 
040579| NOTE: Blank line for visual separation.
040580| src/lib/search/ranking/score.ts:38:   return (
040581| NOTE: Return statement for component or helper output.
040582| src/lib/search/ranking/score.ts:39:     weights.quality * signals.quality +
040583| NOTE: Implementation detail supporting search page behavior.
040584| src/lib/search/ranking/score.ts:40:     weights.rating * signals.rating +
040585| NOTE: Implementation detail supporting search page behavior.
040586| src/lib/search/ranking/score.ts:41:     weights.price * signals.price +
040587| NOTE: Implementation detail supporting search page behavior.
040588| src/lib/search/ranking/score.ts:42:     weights.recency * signals.recency +
040589| NOTE: Implementation detail supporting search page behavior.
040590| src/lib/search/ranking/score.ts:43:     weights.geo * signals.geo
040591| NOTE: Implementation detail supporting search page behavior.
040592| src/lib/search/ranking/score.ts:44:   );
040593| NOTE: Implementation detail supporting search page behavior.
040594| src/lib/search/ranking/score.ts:45: }
040595| NOTE: Implementation detail supporting search page behavior.
040596| src/lib/search/ranking/score.ts:46: 
040597| NOTE: Blank line for visual separation.
040598| src/lib/search/ranking/score.ts:47: /**
040599| NOTE: Block comment line describing behavior or context.
040600| src/lib/search/ranking/score.ts:48:  * Compute all individual signal values for a listing.
040601| NOTE: Block comment line describing behavior or context.
040602| src/lib/search/ranking/score.ts:49:  * All signals are normalized to 0-1 range.
040603| NOTE: Block comment line describing behavior or context.
040604| src/lib/search/ranking/score.ts:50:  */
040605| NOTE: Block comment line describing behavior or context.
040606| src/lib/search/ranking/score.ts:51: export function computeSignals(
040607| NOTE: Exports helper or component function.
040608| src/lib/search/ranking/score.ts:52:   listing: RankableListing,
040609| NOTE: Implementation detail supporting search page behavior.
040610| src/lib/search/ranking/score.ts:53:   context: RankingContext,
040611| NOTE: Implementation detail supporting search page behavior.
040612| src/lib/search/ranking/score.ts:54: ): SignalValues {
040613| NOTE: Implementation detail supporting search page behavior.
040614| src/lib/search/ranking/score.ts:55:   return {
040615| NOTE: Return statement for component or helper output.
040616| src/lib/search/ranking/score.ts:56:     quality: normalizeRecommendedScore(listing.recommendedScore),
040617| NOTE: Implementation detail supporting search page behavior.
040618| src/lib/search/ranking/score.ts:57:     rating: normalizeRating(listing.avgRating, listing.reviewCount),
040619| NOTE: Implementation detail supporting search page behavior.
040620| src/lib/search/ranking/score.ts:58:     price: normalizePriceCompetitiveness(
040621| NOTE: Implementation detail supporting search page behavior.
040622| src/lib/search/ranking/score.ts:59:       listing.price,
040623| NOTE: Implementation detail supporting search page behavior.
040624| src/lib/search/ranking/score.ts:60:       context.localMedianPrice,
040625| NOTE: Implementation detail supporting search page behavior.
040626| src/lib/search/ranking/score.ts:61:     ),
040627| NOTE: Implementation detail supporting search page behavior.
040628| src/lib/search/ranking/score.ts:62:     recency: normalizeRecency(listing.createdAt),
040629| NOTE: Implementation detail supporting search page behavior.
040630| src/lib/search/ranking/score.ts:63:     geo: normalizeDistance(listing.lat, listing.lng, context.center),
040631| NOTE: Implementation detail supporting search page behavior.
040632| src/lib/search/ranking/score.ts:64:   };
040633| NOTE: Implementation detail supporting search page behavior.
040634| src/lib/search/ranking/score.ts:65: }
040635| NOTE: Implementation detail supporting search page behavior.
040636| src/lib/search/ranking/score.ts:66: 
040637| NOTE: Blank line for visual separation.
040638| src/lib/search/ranking/score.ts:67: /**
040639| NOTE: Block comment line describing behavior or context.
040640| src/lib/search/ranking/score.ts:68:  * Normalize recommended_score using sigmoid.
040641| NOTE: Block comment line describing behavior or context.
040642| src/lib/search/ranking/score.ts:69:  * Typical range: 0-200, maps to 0-1 with midpoint around 50.
040643| NOTE: Block comment line describing behavior or context.
040644| src/lib/search/ranking/score.ts:70:  *
040645| NOTE: Block comment line describing behavior or context.
040646| src/lib/search/ranking/score.ts:71:  * @param score - Pre-computed recommended_score (avg_rating*20 + view_count*0.1 + review_count*5)
040647| NOTE: Block comment line describing behavior or context.
040648| src/lib/search/ranking/score.ts:72:  * @returns Normalized value 0-1
040649| NOTE: Block comment line describing behavior or context.
040650| src/lib/search/ranking/score.ts:73:  */
040651| NOTE: Block comment line describing behavior or context.
040652| src/lib/search/ranking/score.ts:74: export function normalizeRecommendedScore(
040653| NOTE: Exports helper or component function.
040654| src/lib/search/ranking/score.ts:75:   score: number | null | undefined,
040655| NOTE: Implementation detail supporting search page behavior.
040656| src/lib/search/ranking/score.ts:76: ): number {
040657| NOTE: Implementation detail supporting search page behavior.
040658| src/lib/search/ranking/score.ts:77:   if (score == null || score <= 0) return 0.3; // Neutral default for missing data
040659| NOTE: Conditional logic controlling rendering or flow.
040660| src/lib/search/ranking/score.ts:78: 
040661| NOTE: Blank line for visual separation.
040662| src/lib/search/ranking/score.ts:79:   // Sigmoid normalization: 1 / (1 + e^(-k*(x-midpoint)))
040663| NOTE: Line comment documents intent or constraints.
040664| src/lib/search/ranking/score.ts:80:   // k=0.04 gives good spread, midpoint=50 centers the curve
040665| NOTE: Line comment documents intent or constraints.
040666| src/lib/search/ranking/score.ts:81:   const k = 0.04;
040667| NOTE: Local declaration used by search logic or UI.
040668| src/lib/search/ranking/score.ts:82:   const midpoint = 50;
040669| NOTE: Local declaration used by search logic or UI.
040670| src/lib/search/ranking/score.ts:83:   return 1 / (1 + Math.exp(-k * (score - midpoint)));
040671| NOTE: Return statement for component or helper output.
040672| src/lib/search/ranking/score.ts:84: }
040673| NOTE: Implementation detail supporting search page behavior.
040674| src/lib/search/ranking/score.ts:85: 
040675| NOTE: Blank line for visual separation.
040676| src/lib/search/ranking/score.ts:86: /**
040677| NOTE: Block comment line describing behavior or context.
040678| src/lib/search/ranking/score.ts:87:  * Normalize rating with review count confidence.
040679| NOTE: Block comment line describing behavior or context.
040680| src/lib/search/ranking/score.ts:88:  * Uses Bayesian average to handle low review counts.
040681| NOTE: Block comment line describing behavior or context.
040682| src/lib/search/ranking/score.ts:89:  *
040683| NOTE: Block comment line describing behavior or context.
040684| src/lib/search/ranking/score.ts:90:  * @param rating - Average rating 0-5
040685| NOTE: Block comment line describing behavior or context.
040686| src/lib/search/ranking/score.ts:91:  * @param reviewCount - Number of reviews
040687| NOTE: Block comment line describing behavior or context.
040688| src/lib/search/ranking/score.ts:92:  * @returns Normalized value 0-1
040689| NOTE: Block comment line describing behavior or context.
040690| src/lib/search/ranking/score.ts:93:  */
040691| NOTE: Block comment line describing behavior or context.
040692| src/lib/search/ranking/score.ts:94: export function normalizeRating(
040693| NOTE: Exports helper or component function.
040694| src/lib/search/ranking/score.ts:95:   rating: number | null | undefined,
040695| NOTE: Implementation detail supporting search page behavior.
040696| src/lib/search/ranking/score.ts:96:   reviewCount: number | null | undefined,
040697| NOTE: Implementation detail supporting search page behavior.
040698| src/lib/search/ranking/score.ts:97: ): number {
040699| NOTE: Implementation detail supporting search page behavior.
040700| src/lib/search/ranking/score.ts:98:   if (rating == null) return 0.5; // Neutral for no rating
040701| NOTE: Conditional logic controlling rendering or flow.
040702| src/lib/search/ranking/score.ts:99: 
040703| NOTE: Blank line for visual separation.
040704| src/lib/search/ranking/score.ts:100:   const count = reviewCount ?? 0;
040705| NOTE: Local declaration used by search logic or UI.
040706| src/lib/search/ranking/score.ts:101:   const prior = 3.5; // Prior average rating
040707| NOTE: Local declaration used by search logic or UI.
040708| src/lib/search/ranking/score.ts:102:   const minReviews = 5; // Minimum reviews for full confidence
040709| NOTE: Local declaration used by search logic or UI.
040710| src/lib/search/ranking/score.ts:103: 
040711| NOTE: Blank line for visual separation.
040712| src/lib/search/ranking/score.ts:104:   // Bayesian average: (prior * minReviews + rating * count) / (minReviews + count)
040713| NOTE: Line comment documents intent or constraints.
040714| src/lib/search/ranking/score.ts:105:   const adjustedRating =
040715| NOTE: Local declaration used by search logic or UI.
040716| src/lib/search/ranking/score.ts:106:     (prior * minReviews + rating * count) / (minReviews + count);
040717| NOTE: Implementation detail supporting search page behavior.
040718| src/lib/search/ranking/score.ts:107: 
040719| NOTE: Blank line for visual separation.
040720| src/lib/search/ranking/score.ts:108:   // Normalize 0-5 to 0-1
040721| NOTE: Line comment documents intent or constraints.
040722| src/lib/search/ranking/score.ts:109:   return Math.min(1, Math.max(0, adjustedRating / 5));
040723| NOTE: Return statement for component or helper output.
040724| src/lib/search/ranking/score.ts:110: }
040725| NOTE: Implementation detail supporting search page behavior.
040726| src/lib/search/ranking/score.ts:111: 
040727| NOTE: Blank line for visual separation.
040728| src/lib/search/ranking/score.ts:112: /**
040729| NOTE: Block comment line describing behavior or context.
040730| src/lib/search/ranking/score.ts:113:  * Normalize price competitiveness relative to local median.
040731| NOTE: Block comment line describing behavior or context.
040732| src/lib/search/ranking/score.ts:114:  * Returns highest score (1.0) at median, decays toward extremes.
040733| NOTE: Block comment line describing behavior or context.
040734| src/lib/search/ranking/score.ts:115:  *
040735| NOTE: Block comment line describing behavior or context.
040736| src/lib/search/ranking/score.ts:116:  * @param price - Listing price
040737| NOTE: Block comment line describing behavior or context.
040738| src/lib/search/ranking/score.ts:117:  * @param medianPrice - Median price from map candidates
040739| NOTE: Block comment line describing behavior or context.
040740| src/lib/search/ranking/score.ts:118:  * @returns Normalized value 0-1 (1.0 = at median, lower for extremes)
040741| NOTE: Block comment line describing behavior or context.
040742| src/lib/search/ranking/score.ts:119:  */
040743| NOTE: Block comment line describing behavior or context.
040744| src/lib/search/ranking/score.ts:120: export function normalizePriceCompetitiveness(
040745| NOTE: Exports helper or component function.
040746| src/lib/search/ranking/score.ts:121:   price: number | null | undefined,
040747| NOTE: Implementation detail supporting search page behavior.
040748| src/lib/search/ranking/score.ts:122:   medianPrice: number | null | undefined,
040749| NOTE: Implementation detail supporting search page behavior.
040750| src/lib/search/ranking/score.ts:123: ): number {
040751| NOTE: Implementation detail supporting search page behavior.
040752| src/lib/search/ranking/score.ts:124:   if (price == null || medianPrice == null || medianPrice <= 0) {
040753| NOTE: Conditional logic controlling rendering or flow.
040754| src/lib/search/ranking/score.ts:125:     return 0.5; // Neutral for missing data
040755| NOTE: Return statement for component or helper output.
040756| src/lib/search/ranking/score.ts:126:   }
040757| NOTE: Implementation detail supporting search page behavior.
040758| src/lib/search/ranking/score.ts:127: 
040759| NOTE: Blank line for visual separation.
040760| src/lib/search/ranking/score.ts:128:   // Ratio of price to median (1.0 = at median)
040761| NOTE: Line comment documents intent or constraints.
040762| src/lib/search/ranking/score.ts:129:   const ratio = price / medianPrice;
040763| NOTE: Local declaration used by search logic or UI.
040764| src/lib/search/ranking/score.ts:130: 
040765| NOTE: Blank line for visual separation.
040766| src/lib/search/ranking/score.ts:131:   // Gaussian-like decay from median
040767| NOTE: Line comment documents intent or constraints.
040768| src/lib/search/ranking/score.ts:132:   // exp(-((ln(ratio))^2) / (2 * sigma^2))
040769| NOTE: Line comment documents intent or constraints.
040770| src/lib/search/ranking/score.ts:133:   // sigma = 0.5 gives reasonable spread
040771| NOTE: Line comment documents intent or constraints.
040772| src/lib/search/ranking/score.ts:134:   const sigma = 0.5;
040773| NOTE: Local declaration used by search logic or UI.
040774| src/lib/search/ranking/score.ts:135:   const logRatio = Math.log(ratio);
040775| NOTE: Local declaration used by search logic or UI.
040776| src/lib/search/ranking/score.ts:136:   return Math.exp(-(logRatio * logRatio) / (2 * sigma * sigma));
040777| NOTE: Return statement for component or helper output.
040778| src/lib/search/ranking/score.ts:137: }
040779| NOTE: Implementation detail supporting search page behavior.
040780| src/lib/search/ranking/score.ts:138: 
040781| NOTE: Blank line for visual separation.
040782| src/lib/search/ranking/score.ts:139: /**
040783| NOTE: Block comment line describing behavior or context.
040784| src/lib/search/ranking/score.ts:140:  * Normalize listing recency using exponential decay.
040785| NOTE: Block comment line describing behavior or context.
040786| src/lib/search/ranking/score.ts:141:  * Newer listings score higher.
040787| NOTE: Block comment line describing behavior or context.
040788| src/lib/search/ranking/score.ts:142:  *
040789| NOTE: Block comment line describing behavior or context.
040790| src/lib/search/ranking/score.ts:143:  * @param createdAt - Listing creation timestamp
040791| NOTE: Block comment line describing behavior or context.
040792| src/lib/search/ranking/score.ts:144:  * @returns Normalized value 0-1 (1.0 = brand new, decays over time)
040793| NOTE: Block comment line describing behavior or context.
040794| src/lib/search/ranking/score.ts:145:  */
040795| NOTE: Block comment line describing behavior or context.
040796| src/lib/search/ranking/score.ts:146: export function normalizeRecency(
040797| NOTE: Exports helper or component function.
040798| src/lib/search/ranking/score.ts:147:   createdAt: Date | string | null | undefined,
040799| NOTE: Implementation detail supporting search page behavior.
040800| src/lib/search/ranking/score.ts:148: ): number {
040801| NOTE: Implementation detail supporting search page behavior.
040802| src/lib/search/ranking/score.ts:149:   if (createdAt == null) return 0.5; // Neutral for missing data
040803| NOTE: Conditional logic controlling rendering or flow.
040804| src/lib/search/ranking/score.ts:150: 
040805| NOTE: Blank line for visual separation.
040806| src/lib/search/ranking/score.ts:151:   const created =
040807| NOTE: Local declaration used by search logic or UI.
040808| src/lib/search/ranking/score.ts:152:     typeof createdAt === "string" ? new Date(createdAt) : createdAt;
040809| NOTE: Implementation detail supporting search page behavior.
040810| src/lib/search/ranking/score.ts:153:   const now = Date.now();
040811| NOTE: Local declaration used by search logic or UI.
040812| src/lib/search/ranking/score.ts:154:   const ageMs = now - created.getTime();
040813| NOTE: Local declaration used by search logic or UI.
040814| src/lib/search/ranking/score.ts:155: 
040815| NOTE: Blank line for visual separation.
040816| src/lib/search/ranking/score.ts:156:   if (ageMs <= 0) return 1.0; // Future dates get max score
040817| NOTE: Conditional logic controlling rendering or flow.
040818| src/lib/search/ranking/score.ts:157: 
040819| NOTE: Blank line for visual separation.
040820| src/lib/search/ranking/score.ts:158:   // Half-life of 30 days (in milliseconds)
040821| NOTE: Line comment documents intent or constraints.
040822| src/lib/search/ranking/score.ts:159:   const halfLifeMs = 30 * 24 * 60 * 60 * 1000;
040823| NOTE: Local declaration used by search logic or UI.
040824| src/lib/search/ranking/score.ts:160: 
040825| NOTE: Blank line for visual separation.
040826| src/lib/search/ranking/score.ts:161:   // Exponential decay: 0.5^(age / halfLife)
040827| NOTE: Line comment documents intent or constraints.
040828| src/lib/search/ranking/score.ts:162:   // After 30 days: 0.5, 60 days: 0.25, 90 days: 0.125
040829| NOTE: Line comment documents intent or constraints.
040830| src/lib/search/ranking/score.ts:163:   return Math.pow(0.5, ageMs / halfLifeMs);
040831| NOTE: Return statement for component or helper output.
040832| src/lib/search/ranking/score.ts:164: }
040833| NOTE: Implementation detail supporting search page behavior.
040834| src/lib/search/ranking/score.ts:165: 
040835| NOTE: Blank line for visual separation.
040836| src/lib/search/ranking/score.ts:166: /**
040837| NOTE: Block comment line describing behavior or context.
040838| src/lib/search/ranking/score.ts:167:  * Normalize distance from map center using exponential decay.
040839| NOTE: Block comment line describing behavior or context.
040840| src/lib/search/ranking/score.ts:168:  * Closer listings score higher.
040841| NOTE: Block comment line describing behavior or context.
040842| src/lib/search/ranking/score.ts:169:  *
040843| NOTE: Block comment line describing behavior or context.
040844| src/lib/search/ranking/score.ts:170:  * @param lat - Listing latitude
040845| NOTE: Block comment line describing behavior or context.
040846| src/lib/search/ranking/score.ts:171:  * @param lng - Listing longitude
040847| NOTE: Block comment line describing behavior or context.
040848| src/lib/search/ranking/score.ts:172:  * @param center - Map center point
040849| NOTE: Block comment line describing behavior or context.
040850| src/lib/search/ranking/score.ts:173:  * @returns Normalized value 0-1 (1.0 = at center, decays with distance)
040851| NOTE: Block comment line describing behavior or context.
040852| src/lib/search/ranking/score.ts:174:  */
040853| NOTE: Block comment line describing behavior or context.
040854| src/lib/search/ranking/score.ts:175: export function normalizeDistance(
040855| NOTE: Exports helper or component function.
040856| src/lib/search/ranking/score.ts:176:   lat: number | null | undefined,
040857| NOTE: Implementation detail supporting search page behavior.
040858| src/lib/search/ranking/score.ts:177:   lng: number | null | undefined,
040859| NOTE: Implementation detail supporting search page behavior.
040860| src/lib/search/ranking/score.ts:178:   center: { lat: number; lng: number } | undefined,
040861| NOTE: Implementation detail supporting search page behavior.
040862| src/lib/search/ranking/score.ts:179: ): number {
040863| NOTE: Implementation detail supporting search page behavior.
040864| src/lib/search/ranking/score.ts:180:   // No geo scoring if center is not provided (skip signal)
040865| NOTE: Line comment documents intent or constraints.
040866| src/lib/search/ranking/score.ts:181:   if (center == null) return 0.5;
040867| NOTE: Conditional logic controlling rendering or flow.
040868| src/lib/search/ranking/score.ts:182: 
040869| NOTE: Blank line for visual separation.
040870| src/lib/search/ranking/score.ts:183:   if (lat == null || lng == null) return 0.3; // Lower score for missing coords
040871| NOTE: Conditional logic controlling rendering or flow.
040872| src/lib/search/ranking/score.ts:184: 
040873| NOTE: Blank line for visual separation.
040874| src/lib/search/ranking/score.ts:185:   // Haversine distance in km
040875| NOTE: Line comment documents intent or constraints.
040876| src/lib/search/ranking/score.ts:186:   const distanceKm = haversineDistance(lat, lng, center.lat, center.lng);
040877| NOTE: Local declaration used by search logic or UI.
040878| src/lib/search/ranking/score.ts:187: 
040879| NOTE: Blank line for visual separation.
040880| src/lib/search/ranking/score.ts:188:   // Exponential decay with half-distance of 5km
040881| NOTE: Line comment documents intent or constraints.
040882| src/lib/search/ranking/score.ts:189:   // At 5km: 0.5, 10km: 0.25, 15km: 0.125
040883| NOTE: Line comment documents intent or constraints.
040884| src/lib/search/ranking/score.ts:190:   const halfDistanceKm = 5;
040885| NOTE: Local declaration used by search logic or UI.
040886| src/lib/search/ranking/score.ts:191:   return Math.pow(0.5, distanceKm / halfDistanceKm);
040887| NOTE: Return statement for component or helper output.
040888| src/lib/search/ranking/score.ts:192: }
040889| NOTE: Implementation detail supporting search page behavior.
040890| src/lib/search/ranking/score.ts:193: 
040891| NOTE: Blank line for visual separation.
040892| src/lib/search/ranking/score.ts:194: /**
040893| NOTE: Block comment line describing behavior or context.
040894| src/lib/search/ranking/score.ts:195:  * Calculate Haversine distance between two points in km.
040895| NOTE: Block comment line describing behavior or context.
040896| src/lib/search/ranking/score.ts:196:  */
040897| NOTE: Block comment line describing behavior or context.
040898| src/lib/search/ranking/score.ts:197: function haversineDistance(
040899| NOTE: Defines a helper or component function.
040900| src/lib/search/ranking/score.ts:198:   lat1: number,
040901| NOTE: Implementation detail supporting search page behavior.
040902| src/lib/search/ranking/score.ts:199:   lng1: number,
040903| NOTE: Implementation detail supporting search page behavior.
040904| src/lib/search/ranking/score.ts:200:   lat2: number,
040905| NOTE: Implementation detail supporting search page behavior.
040906| src/lib/search/ranking/score.ts:201:   lng2: number,
040907| NOTE: Implementation detail supporting search page behavior.
040908| src/lib/search/ranking/score.ts:202: ): number {
040909| NOTE: Implementation detail supporting search page behavior.
040910| src/lib/search/ranking/score.ts:203:   const R = 6371; // Earth radius in km
040911| NOTE: Local declaration used by search logic or UI.
040912| src/lib/search/ranking/score.ts:204:   const dLat = toRad(lat2 - lat1);
040913| NOTE: Local declaration used by search logic or UI.
040914| src/lib/search/ranking/score.ts:205:   const dLng = toRad(lng2 - lng1);
040915| NOTE: Local declaration used by search logic or UI.
040916| src/lib/search/ranking/score.ts:206: 
040917| NOTE: Blank line for visual separation.
040918| src/lib/search/ranking/score.ts:207:   const a =
040919| NOTE: Local declaration used by search logic or UI.
040920| src/lib/search/ranking/score.ts:208:     Math.sin(dLat / 2) * Math.sin(dLat / 2) +
040921| NOTE: Implementation detail supporting search page behavior.
040922| src/lib/search/ranking/score.ts:209:     Math.cos(toRad(lat1)) *
040923| NOTE: Implementation detail supporting search page behavior.
040924| src/lib/search/ranking/score.ts:210:       Math.cos(toRad(lat2)) *
040925| NOTE: Implementation detail supporting search page behavior.
040926| src/lib/search/ranking/score.ts:211:       Math.sin(dLng / 2) *
040927| NOTE: Implementation detail supporting search page behavior.
040928| src/lib/search/ranking/score.ts:212:       Math.sin(dLng / 2);
040929| NOTE: Implementation detail supporting search page behavior.
040930| src/lib/search/ranking/score.ts:213: 
040931| NOTE: Blank line for visual separation.
040932| src/lib/search/ranking/score.ts:214:   const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
040933| NOTE: Local declaration used by search logic or UI.
040934| src/lib/search/ranking/score.ts:215:   return R * c;
040935| NOTE: Return statement for component or helper output.
040936| src/lib/search/ranking/score.ts:216: }
040937| NOTE: Implementation detail supporting search page behavior.
040938| src/lib/search/ranking/score.ts:217: 
040939| NOTE: Blank line for visual separation.
040940| src/lib/search/ranking/score.ts:218: function toRad(deg: number): number {
040941| NOTE: Defines a helper or component function.
040942| src/lib/search/ranking/score.ts:219:   return deg * (Math.PI / 180);
040943| NOTE: Return statement for component or helper output.
040944| src/lib/search/ranking/score.ts:220: }
040945| NOTE: Implementation detail supporting search page behavior.
040946| src/lib/search/ranking/score.ts:221: 
040947| NOTE: Blank line for visual separation.
040948| src/lib/search/ranking/score.ts:222: /**
040949| NOTE: Block comment line describing behavior or context.
040950| src/lib/search/ranking/score.ts:223:  * Compute median price from a list of listings.
040951| NOTE: Block comment line describing behavior or context.
040952| src/lib/search/ranking/score.ts:224:  * Used to determine local price competitiveness.
040953| NOTE: Block comment line describing behavior or context.
040954| src/lib/search/ranking/score.ts:225:  *
040955| NOTE: Block comment line describing behavior or context.
040956| src/lib/search/ranking/score.ts:226:  * @param listings - Array of listings with price field
040957| NOTE: Block comment line describing behavior or context.
040958| src/lib/search/ranking/score.ts:227:  * @returns Median price or undefined if no valid prices
040959| NOTE: Block comment line describing behavior or context.
040960| src/lib/search/ranking/score.ts:228:  */
040961| NOTE: Block comment line describing behavior or context.
040962| src/lib/search/ranking/score.ts:229: export function computeMedianPrice(
040963| NOTE: Exports helper or component function.
040964| src/lib/search/ranking/score.ts:230:   listings: Array<{ price?: number | null }>,
040965| NOTE: Implementation detail supporting search page behavior.
040966| src/lib/search/ranking/score.ts:231: ): number | undefined {
040967| NOTE: Implementation detail supporting search page behavior.
040968| src/lib/search/ranking/score.ts:232:   const prices = listings
040969| NOTE: Local declaration used by search logic or UI.
040970| src/lib/search/ranking/score.ts:233:     .map((l) => l.price)
040971| NOTE: Implementation detail supporting search page behavior.
040972| src/lib/search/ranking/score.ts:234:     .filter((p): p is number => p != null && p > 0)
040973| NOTE: Implementation detail supporting search page behavior.
040974| src/lib/search/ranking/score.ts:235:     .sort((a, b) => a - b);
040975| NOTE: Implementation detail supporting search page behavior.
040976| src/lib/search/ranking/score.ts:236: 
040977| NOTE: Blank line for visual separation.
040978| src/lib/search/ranking/score.ts:237:   if (prices.length === 0) return undefined;
040979| NOTE: Conditional logic controlling rendering or flow.
040980| src/lib/search/ranking/score.ts:238: 
040981| NOTE: Blank line for visual separation.
040982| src/lib/search/ranking/score.ts:239:   const mid = Math.floor(prices.length / 2);
040983| NOTE: Local declaration used by search logic or UI.
040984| src/lib/search/ranking/score.ts:240:   return prices.length % 2 !== 0
040985| NOTE: Return statement for component or helper output.
040986| src/lib/search/ranking/score.ts:241:     ? prices[mid]
040987| NOTE: Implementation detail supporting search page behavior.
040988| src/lib/search/ranking/score.ts:242:     : (prices[mid - 1] + prices[mid]) / 2;
040989| NOTE: Implementation detail supporting search page behavior.
040990| src/lib/search/ranking/score.ts:243: }
040991| NOTE: Implementation detail supporting search page behavior.
040992| src/lib/search/ranking/score.ts:244: 
040993| NOTE: Blank line for visual separation.
040994| src/lib/search/ranking/score.ts:245: /**
040995| NOTE: Block comment line describing behavior or context.
040996| src/lib/search/ranking/score.ts:246:  * Get center point from map bounds.
040997| NOTE: Block comment line describing behavior or context.
040998| src/lib/search/ranking/score.ts:247:  *
040999| NOTE: Block comment line describing behavior or context.
041000| src/lib/search/ranking/score.ts:248:  * @param bounds - Map bounds object with sw/ne corners
041001| NOTE: Block comment line describing behavior or context.
041002| src/lib/search/ranking/score.ts:249:  * @returns Center point or undefined
041003| NOTE: Block comment line describing behavior or context.
041004| src/lib/search/ranking/score.ts:250:  */
041005| NOTE: Block comment line describing behavior or context.
041006| src/lib/search/ranking/score.ts:251: export function getBoundsCenter(bounds: {
041007| NOTE: Exports helper or component function.
041008| src/lib/search/ranking/score.ts:252:   sw: { lat: number; lng: number };
041009| NOTE: Implementation detail supporting search page behavior.
041010| src/lib/search/ranking/score.ts:253:   ne: { lat: number; lng: number };
041011| NOTE: Implementation detail supporting search page behavior.
041012| src/lib/search/ranking/score.ts:254: }): { lat: number; lng: number } {
041013| NOTE: Implementation detail supporting search page behavior.
041014| src/lib/search/ranking/score.ts:255:   return {
041015| NOTE: Return statement for component or helper output.
041016| src/lib/search/ranking/score.ts:256:     lat: (bounds.sw.lat + bounds.ne.lat) / 2,
041017| NOTE: Implementation detail supporting search page behavior.
041018| src/lib/search/ranking/score.ts:257:     lng: (bounds.sw.lng + bounds.ne.lng) / 2,
041019| NOTE: Implementation detail supporting search page behavior.
041020| src/lib/search/ranking/score.ts:258:   };
041021| NOTE: Implementation detail supporting search page behavior.
041022| src/lib/search/ranking/score.ts:259: }
041023| NOTE: Implementation detail supporting search page behavior.
041024| FILE END: src/lib/search/ranking/score.ts
041025| 
041026| FILE START: src/lib/search/ranking/types.ts
041027| FILE ROLE: Auto-discovered dependency in search page graph.
041028| src/lib/search/ranking/types.ts:1: /**
041029| NOTE: Block comment line describing behavior or context.
041030| src/lib/search/ranking/types.ts:2:  * Search Ranking Module - Type Definitions
041031| NOTE: Block comment line describing behavior or context.
041032| src/lib/search/ranking/types.ts:3:  *
041033| NOTE: Block comment line describing behavior or context.
041034| src/lib/search/ranking/types.ts:4:  * Types for the heuristic-based ranking system that scores listings
041035| NOTE: Block comment line describing behavior or context.
041036| src/lib/search/ranking/types.ts:5:  * for map pin tiering. Designed for future extensibility to ML-based ranking.
041037| NOTE: Block comment line describing behavior or context.
041038| src/lib/search/ranking/types.ts:6:  */
041039| NOTE: Block comment line describing behavior or context.
041040| src/lib/search/ranking/types.ts:7: 
041041| NOTE: Blank line for visual separation.
041042| src/lib/search/ranking/types.ts:8: /**
041043| NOTE: Block comment line describing behavior or context.
041044| src/lib/search/ranking/types.ts:9:  * Context passed to scoring functions.
041045| NOTE: Block comment line describing behavior or context.
041046| src/lib/search/ranking/types.ts:10:  * Contains information about the search context that influences scoring.
041047| NOTE: Block comment line describing behavior or context.
041048| src/lib/search/ranking/types.ts:11:  */
041049| NOTE: Block comment line describing behavior or context.
041050| src/lib/search/ranking/types.ts:12: export interface RankingContext {
041051| NOTE: Implementation detail supporting search page behavior.
041052| src/lib/search/ranking/types.ts:13:   /** Current sort option (affects signal weighting) */
041053| NOTE: Block comment line describing behavior or context.
041054| src/lib/search/ranking/types.ts:14:   sort: string;
041055| NOTE: Implementation detail supporting search page behavior.
041056| src/lib/search/ranking/types.ts:15:   /** Map center point for distance scoring (optional - skip geo signal if absent) */
041057| NOTE: Block comment line describing behavior or context.
041058| src/lib/search/ranking/types.ts:16:   center?: { lat: number; lng: number };
041059| NOTE: Implementation detail supporting search page behavior.
041060| src/lib/search/ranking/types.ts:17:   /** Median price from map candidates for price competitiveness (optional) */
041061| NOTE: Block comment line describing behavior or context.
041062| src/lib/search/ranking/types.ts:18:   localMedianPrice?: number;
041063| NOTE: Implementation detail supporting search page behavior.
041064| src/lib/search/ranking/types.ts:19:   /** Enable debug output (limited to 5 pins, no PII) */
041065| NOTE: Block comment line describing behavior or context.
041066| src/lib/search/ranking/types.ts:20:   debug?: boolean;
041067| NOTE: Implementation detail supporting search page behavior.
041068| src/lib/search/ranking/types.ts:21: }
041069| NOTE: Implementation detail supporting search page behavior.
041070| src/lib/search/ranking/types.ts:22: 
041071| NOTE: Blank line for visual separation.
041072| src/lib/search/ranking/types.ts:23: /**
041073| NOTE: Block comment line describing behavior or context.
041074| src/lib/search/ranking/types.ts:24:  * Weights for each ranking signal.
041075| NOTE: Block comment line describing behavior or context.
041076| src/lib/search/ranking/types.ts:25:  * All weights should sum to 1.0 for normalized scoring.
041077| NOTE: Block comment line describing behavior or context.
041078| src/lib/search/ranking/types.ts:26:  */
041079| NOTE: Block comment line describing behavior or context.
041080| src/lib/search/ranking/types.ts:27: export interface RankingWeights {
041081| NOTE: Implementation detail supporting search page behavior.
041082| src/lib/search/ranking/types.ts:28:   /** Pre-computed quality score from SearchDoc (avg_rating*20 + view_count*0.1 + review_count*5) */
041083| NOTE: Block comment line describing behavior or context.
041084| src/lib/search/ranking/types.ts:29:   quality: number;
041085| NOTE: Implementation detail supporting search page behavior.
041086| src/lib/search/ranking/types.ts:30:   /** Rating with review count confidence adjustment */
041087| NOTE: Block comment line describing behavior or context.
041088| src/lib/search/ranking/types.ts:31:   rating: number;
041089| NOTE: Implementation detail supporting search page behavior.
041090| src/lib/search/ranking/types.ts:32:   /** Price competitiveness relative to local median */
041091| NOTE: Block comment line describing behavior or context.
041092| src/lib/search/ranking/types.ts:33:   price: number;
041093| NOTE: Implementation detail supporting search page behavior.
041094| src/lib/search/ranking/types.ts:34:   /** Listing recency (newer = higher) */
041095| NOTE: Block comment line describing behavior or context.
041096| src/lib/search/ranking/types.ts:35:   recency: number;
041097| NOTE: Implementation detail supporting search page behavior.
041098| src/lib/search/ranking/types.ts:36:   /** Distance from map center (closer = higher) */
041099| NOTE: Block comment line describing behavior or context.
041100| src/lib/search/ranking/types.ts:37:   geo: number;
041101| NOTE: Implementation detail supporting search page behavior.
041102| src/lib/search/ranking/types.ts:38: }
041103| NOTE: Implementation detail supporting search page behavior.
041104| src/lib/search/ranking/types.ts:39: 
041105| NOTE: Blank line for visual separation.
041106| src/lib/search/ranking/types.ts:40: /**
041107| NOTE: Block comment line describing behavior or context.
041108| src/lib/search/ranking/types.ts:41:  * Individual signal values (all normalized to 0-1 range).
041109| NOTE: Block comment line describing behavior or context.
041110| src/lib/search/ranking/types.ts:42:  */
041111| NOTE: Block comment line describing behavior or context.
041112| src/lib/search/ranking/types.ts:43: export interface SignalValues {
041113| NOTE: Implementation detail supporting search page behavior.
041114| src/lib/search/ranking/types.ts:44:   quality: number;
041115| NOTE: Implementation detail supporting search page behavior.
041116| src/lib/search/ranking/types.ts:45:   rating: number;
041117| NOTE: Implementation detail supporting search page behavior.
041118| src/lib/search/ranking/types.ts:46:   price: number;
041119| NOTE: Implementation detail supporting search page behavior.
041120| src/lib/search/ranking/types.ts:47:   recency: number;
041121| NOTE: Implementation detail supporting search page behavior.
041122| src/lib/search/ranking/types.ts:48:   geo: number;
041123| NOTE: Implementation detail supporting search page behavior.
041124| src/lib/search/ranking/types.ts:49: }
041125| NOTE: Implementation detail supporting search page behavior.
041126| src/lib/search/ranking/types.ts:50: 
041127| NOTE: Blank line for visual separation.
041128| src/lib/search/ranking/types.ts:51: /**
041129| NOTE: Block comment line describing behavior or context.
041130| src/lib/search/ranking/types.ts:52:  * Debug output for a single listing (no PII).
041131| NOTE: Block comment line describing behavior or context.
041132| src/lib/search/ranking/types.ts:53:  * Only includes id and normalized signal values.
041133| NOTE: Block comment line describing behavior or context.
041134| src/lib/search/ranking/types.ts:54:  */
041135| NOTE: Block comment line describing behavior or context.
041136| src/lib/search/ranking/types.ts:55: export interface DebugSignals {
041137| NOTE: Implementation detail supporting search page behavior.
041138| src/lib/search/ranking/types.ts:56:   id: string;
041139| NOTE: Implementation detail supporting search page behavior.
041140| src/lib/search/ranking/types.ts:57:   quality: number;
041141| NOTE: Implementation detail supporting search page behavior.
041142| src/lib/search/ranking/types.ts:58:   rating: number;
041143| NOTE: Implementation detail supporting search page behavior.
041144| src/lib/search/ranking/types.ts:59:   price: number;
041145| NOTE: Implementation detail supporting search page behavior.
041146| src/lib/search/ranking/types.ts:60:   recency: number;
041147| NOTE: Implementation detail supporting search page behavior.
041148| src/lib/search/ranking/types.ts:61:   geo: number;
041149| NOTE: Implementation detail supporting search page behavior.
041150| src/lib/search/ranking/types.ts:62:   total: number;
041151| NOTE: Implementation detail supporting search page behavior.
041152| src/lib/search/ranking/types.ts:63: }
041153| NOTE: Implementation detail supporting search page behavior.
041154| src/lib/search/ranking/types.ts:64: 
041155| NOTE: Blank line for visual separation.
041156| src/lib/search/ranking/types.ts:65: /**
041157| NOTE: Block comment line describing behavior or context.
041158| src/lib/search/ranking/types.ts:66:  * Minimum fields required from a listing for ranking.
041159| NOTE: Block comment line describing behavior or context.
041160| src/lib/search/ranking/types.ts:67:  * Uses optional fields since not all may be present.
041161| NOTE: Block comment line describing behavior or context.
041162| src/lib/search/ranking/types.ts:68:  */
041163| NOTE: Block comment line describing behavior or context.
041164| src/lib/search/ranking/types.ts:69: export interface RankableListing {
041165| NOTE: Implementation detail supporting search page behavior.
041166| src/lib/search/ranking/types.ts:70:   id: string;
041167| NOTE: Implementation detail supporting search page behavior.
041168| src/lib/search/ranking/types.ts:71:   /** Pre-computed recommended score from SearchDoc */
041169| NOTE: Block comment line describing behavior or context.
041170| src/lib/search/ranking/types.ts:72:   recommendedScore?: number | null;
041171| NOTE: Implementation detail supporting search page behavior.
041172| src/lib/search/ranking/types.ts:73:   /** Average rating 0-5 */
041173| NOTE: Block comment line describing behavior or context.
041174| src/lib/search/ranking/types.ts:74:   avgRating?: number | null;
041175| NOTE: Implementation detail supporting search page behavior.
041176| src/lib/search/ranking/types.ts:75:   /** Number of reviews */
041177| NOTE: Block comment line describing behavior or context.
041178| src/lib/search/ranking/types.ts:76:   reviewCount?: number | null;
041179| NOTE: Implementation detail supporting search page behavior.
041180| src/lib/search/ranking/types.ts:77:   /** Price per period */
041181| NOTE: Block comment line describing behavior or context.
041182| src/lib/search/ranking/types.ts:78:   price?: number | null;
041183| NOTE: Implementation detail supporting search page behavior.
041184| src/lib/search/ranking/types.ts:79:   /** Listing creation timestamp */
041185| NOTE: Block comment line describing behavior or context.
041186| src/lib/search/ranking/types.ts:80:   createdAt?: Date | string | null;
041187| NOTE: Implementation detail supporting search page behavior.
041188| src/lib/search/ranking/types.ts:81:   /** Latitude for geo scoring */
041189| NOTE: Block comment line describing behavior or context.
041190| src/lib/search/ranking/types.ts:82:   lat?: number | null;
041191| NOTE: Implementation detail supporting search page behavior.
041192| src/lib/search/ranking/types.ts:83:   /** Longitude for geo scoring */
041193| NOTE: Block comment line describing behavior or context.
041194| src/lib/search/ranking/types.ts:84:   lng?: number | null;
041195| NOTE: Implementation detail supporting search page behavior.
041196| src/lib/search/ranking/types.ts:85: }
041197| NOTE: Implementation detail supporting search page behavior.
041198| src/lib/search/ranking/types.ts:86: 
041199| NOTE: Blank line for visual separation.
041200| src/lib/search/ranking/types.ts:87: /**
041201| NOTE: Block comment line describing behavior or context.
041202| src/lib/search/ranking/types.ts:88:  * Ranking configuration for version tracking and tuning.
041203| NOTE: Block comment line describing behavior or context.
041204| src/lib/search/ranking/types.ts:89:  */
041205| NOTE: Block comment line describing behavior or context.
041206| src/lib/search/ranking/types.ts:90: export interface RankingConfig {
041207| NOTE: Implementation detail supporting search page behavior.
041208| src/lib/search/ranking/types.ts:91:   /** Version identifier for A/B testing and debugging */
041209| NOTE: Block comment line describing behavior or context.
041210| src/lib/search/ranking/types.ts:92:   version: string;
041211| NOTE: Implementation detail supporting search page behavior.
041212| src/lib/search/ranking/types.ts:93:   /** Signal weights */
041213| NOTE: Block comment line describing behavior or context.
041214| src/lib/search/ranking/types.ts:94:   weights: RankingWeights;
041215| NOTE: Implementation detail supporting search page behavior.
041216| src/lib/search/ranking/types.ts:95: }
041217| NOTE: Implementation detail supporting search page behavior.
041218| FILE END: src/lib/search/ranking/types.ts
041219| 
041220| FILE START: src/lib/search/search-doc-queries.ts
041221| FILE ROLE: Auto-discovered dependency in search page graph.
041222| src/lib/search/search-doc-queries.ts:1: /**
041223| NOTE: Block comment line describing behavior or context.
041224| src/lib/search/search-doc-queries.ts:2:  * SearchDoc Query Functions
041225| NOTE: Block comment line describing behavior or context.
041226| src/lib/search/search-doc-queries.ts:3:  *
041227| NOTE: Block comment line describing behavior or context.
041228| src/lib/search/search-doc-queries.ts:4:  * Optimized queries reading from denormalized listing_search_docs table.
041229| NOTE: Block comment line describing behavior or context.
041230| src/lib/search/search-doc-queries.ts:5:  * Replaces multi-table joins with single-table reads for faster search.
041231| NOTE: Block comment line describing behavior or context.
041232| src/lib/search/search-doc-queries.ts:6:  *
041233| NOTE: Block comment line describing behavior or context.
041234| src/lib/search/search-doc-queries.ts:7:  * Feature flag: ENABLE_SEARCH_DOC=true or ?searchDoc=1 URL override
041235| NOTE: Block comment line describing behavior or context.
041236| src/lib/search/search-doc-queries.ts:8:  *
041237| NOTE: Block comment line describing behavior or context.
041238| src/lib/search/search-doc-queries.ts:9:  * Performance improvements:
041239| NOTE: Block comment line describing behavior or context.
041240| src/lib/search/search-doc-queries.ts:10:  * - No JOINs: Single table read vs Listing + Location + Review
041241| NOTE: Block comment line describing behavior or context.
041242| src/lib/search/search-doc-queries.ts:11:  * - Precomputed: lat/lng, avg_rating, recommended_score already calculated
041243| NOTE: Block comment line describing behavior or context.
041244| src/lib/search/search-doc-queries.ts:12:  * - GIN indexes: Direct @> containment for amenities/rules/languages
041245| NOTE: Block comment line describing behavior or context.
041246| src/lib/search/search-doc-queries.ts:13:  * - PostGIS: geography type with GIST index for spatial queries
041247| NOTE: Block comment line describing behavior or context.
041248| src/lib/search/search-doc-queries.ts:14:  */
041249| NOTE: Block comment line describing behavior or context.
041250| src/lib/search/search-doc-queries.ts:15: 
041251| NOTE: Blank line for visual separation.
041252| src/lib/search/search-doc-queries.ts:16: import { prisma } from "@/lib/prisma";
041253| NOTE: Imports dependency for this module.
041254| src/lib/search/search-doc-queries.ts:17: import { wrapDatabaseError } from "@/lib/errors";
041255| NOTE: Imports dependency for this module.
041256| src/lib/search/search-doc-queries.ts:18: import { unstable_cache } from "next/cache";
041257| NOTE: Imports dependency for this module.
041258| src/lib/search/search-doc-queries.ts:19: import type {
041259| NOTE: Imports dependency for this module.
041260| src/lib/search/search-doc-queries.ts:20:   FilterParams,
041261| NOTE: Implementation detail supporting search page behavior.
041262| src/lib/search/search-doc-queries.ts:21:   ListingData,
041263| NOTE: Implementation detail supporting search page behavior.
041264| src/lib/search/search-doc-queries.ts:22:   MapListingData,
041265| NOTE: Implementation detail supporting search page behavior.
041266| src/lib/search/search-doc-queries.ts:23:   PaginatedResultHybrid,
041267| NOTE: Implementation detail supporting search page behavior.
041268| src/lib/search/search-doc-queries.ts:24: } from "@/lib/data";
041269| NOTE: Implementation detail supporting search page behavior.
041270| src/lib/search/search-doc-queries.ts:25: import {
041271| NOTE: Imports dependency for this module.
041272| src/lib/search/search-doc-queries.ts:26:   sanitizeSearchQuery,
041273| NOTE: Implementation detail supporting search page behavior.
041274| src/lib/search/search-doc-queries.ts:27:   isValidQuery,
041275| NOTE: Implementation detail supporting search page behavior.
041276| src/lib/search/search-doc-queries.ts:28:   crossesAntimeridian,
041277| NOTE: Implementation detail supporting search page behavior.
041278| src/lib/search/search-doc-queries.ts:29: } from "@/lib/data";
041279| NOTE: Implementation detail supporting search page behavior.
041280| src/lib/search/search-doc-queries.ts:30: import {
041281| NOTE: Imports dependency for this module.
041282| src/lib/search/search-doc-queries.ts:31:   LOW_RESULTS_THRESHOLD,
041283| NOTE: Implementation detail supporting search page behavior.
041284| src/lib/search/search-doc-queries.ts:32:   expandFiltersForNearMatches,
041285| NOTE: Implementation detail supporting search page behavior.
041286| src/lib/search/search-doc-queries.ts:33:   isNearMatch,
041287| NOTE: Implementation detail supporting search page behavior.
041288| src/lib/search/search-doc-queries.ts:34: } from "@/lib/near-matches";
041289| NOTE: Implementation detail supporting search page behavior.
041290| src/lib/search/search-doc-queries.ts:35: import { features } from "@/lib/env";
041291| NOTE: Imports dependency for this module.
041292| src/lib/search/search-doc-queries.ts:36: import type { KeysetCursor, SortOption, CursorRowData } from "./cursor";
041293| NOTE: Imports dependency for this module.
041294| src/lib/search/search-doc-queries.ts:37: import { buildCursorFromRow, encodeKeysetCursor } from "./cursor";
041295| NOTE: Imports dependency for this module.
041296| src/lib/search/search-doc-queries.ts:38: 
041297| NOTE: Blank line for visual separation.
041298| src/lib/search/search-doc-queries.ts:39: // Maximum results to return for map markers
041299| NOTE: Line comment documents intent or constraints.
041300| src/lib/search/search-doc-queries.ts:40: const MAX_MAP_MARKERS = 200;
041301| NOTE: Local declaration used by search logic or UI.
041302| src/lib/search/search-doc-queries.ts:41: 
041303| NOTE: Blank line for visual separation.
041304| src/lib/search/search-doc-queries.ts:42: // Threshold for full COUNT vs hybrid mode
041305| NOTE: Line comment documents intent or constraints.
041306| src/lib/search/search-doc-queries.ts:43: const HYBRID_COUNT_THRESHOLD = 100;
041307| NOTE: Local declaration used by search logic or UI.
041308| src/lib/search/search-doc-queries.ts:44: 
041309| NOTE: Blank line for visual separation.
041310| src/lib/search/search-doc-queries.ts:45: // ============================================
041311| NOTE: Line comment documents intent or constraints.
041312| src/lib/search/search-doc-queries.ts:46: // Cache Key Generators
041313| NOTE: Line comment documents intent or constraints.
041314| src/lib/search/search-doc-queries.ts:47: // ============================================
041315| NOTE: Line comment documents intent or constraints.
041316| src/lib/search/search-doc-queries.ts:48: 
041317| NOTE: Blank line for visual separation.
041318| src/lib/search/search-doc-queries.ts:49: function createSearchDocListCacheKey(params: FilterParams): string {
041319| NOTE: Defines a helper or component function.
041320| src/lib/search/search-doc-queries.ts:50:   const normalized = {
041321| NOTE: Local declaration used by search logic or UI.
041322| src/lib/search/search-doc-queries.ts:51:     q: params.query?.toLowerCase().trim() || "",
041323| NOTE: Implementation detail supporting search page behavior.
041324| src/lib/search/search-doc-queries.ts:52:     minPrice: params.minPrice ?? "",
041325| NOTE: Implementation detail supporting search page behavior.
041326| src/lib/search/search-doc-queries.ts:53:     maxPrice: params.maxPrice ?? "",
041327| NOTE: Implementation detail supporting search page behavior.
041328| src/lib/search/search-doc-queries.ts:54:     amenities: [...(params.amenities || [])].sort().join(","),
041329| NOTE: Implementation detail supporting search page behavior.
041330| src/lib/search/search-doc-queries.ts:55:     houseRules: [...(params.houseRules || [])].sort().join(","),
041331| NOTE: Implementation detail supporting search page behavior.
041332| src/lib/search/search-doc-queries.ts:56:     languages: [...(params.languages || [])].sort().join(","),
041333| NOTE: Implementation detail supporting search page behavior.
041334| src/lib/search/search-doc-queries.ts:57:     roomType: params.roomType?.toLowerCase() || "",
041335| NOTE: Implementation detail supporting search page behavior.
041336| src/lib/search/search-doc-queries.ts:58:     leaseDuration: params.leaseDuration?.toLowerCase() || "",
041337| NOTE: Implementation detail supporting search page behavior.
041338| src/lib/search/search-doc-queries.ts:59:     moveInDate: params.moveInDate || "",
041339| NOTE: Implementation detail supporting search page behavior.
041340| src/lib/search/search-doc-queries.ts:60:     bounds: params.bounds
041341| NOTE: Implementation detail supporting search page behavior.
041342| src/lib/search/search-doc-queries.ts:61:       ? `${params.bounds.minLng.toFixed(4)},${params.bounds.minLat.toFixed(4)},${params.bounds.maxLng.toFixed(4)},${params.bounds.maxLat.toFixed(4)}`
041343| NOTE: Implementation detail supporting search page behavior.
041344| src/lib/search/search-doc-queries.ts:62:       : "",
041345| NOTE: Implementation detail supporting search page behavior.
041346| src/lib/search/search-doc-queries.ts:63:     page: params.page ?? 1,
041347| NOTE: Implementation detail supporting search page behavior.
041348| src/lib/search/search-doc-queries.ts:64:     limit: params.limit ?? 12,
041349| NOTE: Implementation detail supporting search page behavior.
041350| src/lib/search/search-doc-queries.ts:65:     sort: params.sort || "recommended",
041351| NOTE: Implementation detail supporting search page behavior.
041352| src/lib/search/search-doc-queries.ts:66:     nearMatches: params.nearMatches ?? false,
041353| NOTE: Implementation detail supporting search page behavior.
041354| src/lib/search/search-doc-queries.ts:67:   };
041355| NOTE: Implementation detail supporting search page behavior.
041356| src/lib/search/search-doc-queries.ts:68:   return JSON.stringify(normalized);
041357| NOTE: Return statement for component or helper output.
041358| src/lib/search/search-doc-queries.ts:69: }
041359| NOTE: Implementation detail supporting search page behavior.
041360| src/lib/search/search-doc-queries.ts:70: 
041361| NOTE: Blank line for visual separation.
041362| src/lib/search/search-doc-queries.ts:71: function createSearchDocMapCacheKey(params: FilterParams): string {
041363| NOTE: Defines a helper or component function.
041364| src/lib/search/search-doc-queries.ts:72:   const normalized = {
041365| NOTE: Local declaration used by search logic or UI.
041366| src/lib/search/search-doc-queries.ts:73:     q: params.query?.toLowerCase().trim() || "",
041367| NOTE: Implementation detail supporting search page behavior.
041368| src/lib/search/search-doc-queries.ts:74:     minPrice: params.minPrice ?? "",
041369| NOTE: Implementation detail supporting search page behavior.
041370| src/lib/search/search-doc-queries.ts:75:     maxPrice: params.maxPrice ?? "",
041371| NOTE: Implementation detail supporting search page behavior.
041372| src/lib/search/search-doc-queries.ts:76:     amenities: [...(params.amenities || [])].sort().join(","),
041373| NOTE: Implementation detail supporting search page behavior.
041374| src/lib/search/search-doc-queries.ts:77:     houseRules: [...(params.houseRules || [])].sort().join(","),
041375| NOTE: Implementation detail supporting search page behavior.
041376| src/lib/search/search-doc-queries.ts:78:     languages: [...(params.languages || [])].sort().join(","),
041377| NOTE: Implementation detail supporting search page behavior.
041378| src/lib/search/search-doc-queries.ts:79:     roomType: params.roomType?.toLowerCase() || "",
041379| NOTE: Implementation detail supporting search page behavior.
041380| src/lib/search/search-doc-queries.ts:80:     leaseDuration: params.leaseDuration?.toLowerCase() || "",
041381| NOTE: Implementation detail supporting search page behavior.
041382| src/lib/search/search-doc-queries.ts:81:     moveInDate: params.moveInDate || "",
041383| NOTE: Implementation detail supporting search page behavior.
041384| src/lib/search/search-doc-queries.ts:82:     bounds: params.bounds
041385| NOTE: Implementation detail supporting search page behavior.
041386| src/lib/search/search-doc-queries.ts:83:       ? `${params.bounds.minLng.toFixed(4)},${params.bounds.minLat.toFixed(4)},${params.bounds.maxLng.toFixed(4)},${params.bounds.maxLat.toFixed(4)}`
041387| NOTE: Implementation detail supporting search page behavior.
041388| src/lib/search/search-doc-queries.ts:84:       : "",
041389| NOTE: Implementation detail supporting search page behavior.
041390| src/lib/search/search-doc-queries.ts:85:   };
041391| NOTE: Implementation detail supporting search page behavior.
041392| src/lib/search/search-doc-queries.ts:86:   return JSON.stringify(normalized);
041393| NOTE: Return statement for component or helper output.
041394| src/lib/search/search-doc-queries.ts:87: }
041395| NOTE: Implementation detail supporting search page behavior.
041396| src/lib/search/search-doc-queries.ts:88: 
041397| NOTE: Blank line for visual separation.
041398| src/lib/search/search-doc-queries.ts:89: function createSearchDocCountCacheKey(params: FilterParams): string {
041399| NOTE: Defines a helper or component function.
041400| src/lib/search/search-doc-queries.ts:90:   const normalized = {
041401| NOTE: Local declaration used by search logic or UI.
041402| src/lib/search/search-doc-queries.ts:91:     q: params.query?.toLowerCase().trim() || "",
041403| NOTE: Implementation detail supporting search page behavior.
041404| src/lib/search/search-doc-queries.ts:92:     minPrice: params.minPrice ?? "",
041405| NOTE: Implementation detail supporting search page behavior.
041406| src/lib/search/search-doc-queries.ts:93:     maxPrice: params.maxPrice ?? "",
041407| NOTE: Implementation detail supporting search page behavior.
041408| src/lib/search/search-doc-queries.ts:94:     amenities: [...(params.amenities || [])].sort().join(","),
041409| NOTE: Implementation detail supporting search page behavior.
041410| src/lib/search/search-doc-queries.ts:95:     houseRules: [...(params.houseRules || [])].sort().join(","),
041411| NOTE: Implementation detail supporting search page behavior.
041412| src/lib/search/search-doc-queries.ts:96:     languages: [...(params.languages || [])].sort().join(","),
041413| NOTE: Implementation detail supporting search page behavior.
041414| src/lib/search/search-doc-queries.ts:97:     roomType: params.roomType?.toLowerCase() || "",
041415| NOTE: Implementation detail supporting search page behavior.
041416| src/lib/search/search-doc-queries.ts:98:     leaseDuration: params.leaseDuration?.toLowerCase() || "",
041417| NOTE: Implementation detail supporting search page behavior.
041418| src/lib/search/search-doc-queries.ts:99:     moveInDate: params.moveInDate || "",
041419| NOTE: Implementation detail supporting search page behavior.
041420| src/lib/search/search-doc-queries.ts:100:     bounds: params.bounds
041421| NOTE: Implementation detail supporting search page behavior.
041422| src/lib/search/search-doc-queries.ts:101:       ? `${params.bounds.minLng.toFixed(4)},${params.bounds.minLat.toFixed(4)},${params.bounds.maxLng.toFixed(4)},${params.bounds.maxLat.toFixed(4)}`
041423| NOTE: Implementation detail supporting search page behavior.
041424| src/lib/search/search-doc-queries.ts:102:       : "",
041425| NOTE: Implementation detail supporting search page behavior.
041426| src/lib/search/search-doc-queries.ts:103:     // NOTE: No page or limit - intentionally excluded for cross-page caching
041427| NOTE: Line comment documents intent or constraints.
041428| src/lib/search/search-doc-queries.ts:104:   };
041429| NOTE: Implementation detail supporting search page behavior.
041430| src/lib/search/search-doc-queries.ts:105:   return JSON.stringify(normalized);
041431| NOTE: Return statement for component or helper output.
041432| src/lib/search/search-doc-queries.ts:106: }
041433| NOTE: Implementation detail supporting search page behavior.
041434| src/lib/search/search-doc-queries.ts:107: 
041435| NOTE: Blank line for visual separation.
041436| src/lib/search/search-doc-queries.ts:108: // ============================================
041437| NOTE: Line comment documents intent or constraints.
041438| src/lib/search/search-doc-queries.ts:109: // Helper: Parse date string to Date
041439| NOTE: Line comment documents intent or constraints.
041440| src/lib/search/search-doc-queries.ts:110: // ============================================
041441| NOTE: Line comment documents intent or constraints.
041442| src/lib/search/search-doc-queries.ts:111: 
041443| NOTE: Blank line for visual separation.
041444| src/lib/search/search-doc-queries.ts:112: function parseDateOnly(value: string): Date {
041445| NOTE: Defines a helper or component function.
041446| src/lib/search/search-doc-queries.ts:113:   const [year, month, day] = value.split("-").map(Number);
041447| NOTE: Local declaration used by search logic or UI.
041448| src/lib/search/search-doc-queries.ts:114:   return new Date(year, month - 1, day);
041449| NOTE: Return statement for component or helper output.
041450| src/lib/search/search-doc-queries.ts:115: }
041451| NOTE: Implementation detail supporting search page behavior.
041452| src/lib/search/search-doc-queries.ts:116: 
041453| NOTE: Blank line for visual separation.
041454| src/lib/search/search-doc-queries.ts:117: // ============================================
041455| NOTE: Line comment documents intent or constraints.
041456| src/lib/search/search-doc-queries.ts:118: // Keyset Pagination Helpers
041457| NOTE: Line comment documents intent or constraints.
041458| src/lib/search/search-doc-queries.ts:119: // ============================================
041459| NOTE: Line comment documents intent or constraints.
041460| src/lib/search/search-doc-queries.ts:120: 
041461| NOTE: Blank line for visual separation.
041462| src/lib/search/search-doc-queries.ts:121: /**
041463| NOTE: Block comment line describing behavior or context.
041464| src/lib/search/search-doc-queries.ts:122:  * Build keyset WHERE clause for cursor-based pagination.
041465| NOTE: Block comment line describing behavior or context.
041466| src/lib/search/search-doc-queries.ts:123:  *
041467| NOTE: Block comment line describing behavior or context.
041468| src/lib/search/search-doc-queries.ts:124:  * CRITICAL: Do NOT use PostgreSQL tuple comparison (a, b) < (x, y).
041469| NOTE: Block comment line describing behavior or context.
041470| src/lib/search/search-doc-queries.ts:125:  * Tuple comparisons use ASC/ASC semantics and don't work for mixed DESC/ASC.
041471| NOTE: Block comment line describing behavior or context.
041472| src/lib/search/search-doc-queries.ts:126:  * Use explicit OR-chains that respect each column's sort direction.
041473| NOTE: Block comment line describing behavior or context.
041474| src/lib/search/search-doc-queries.ts:127:  *
041475| NOTE: Block comment line describing behavior or context.
041476| src/lib/search/search-doc-queries.ts:128:  * @param cursor - The keyset cursor from the previous page
041477| NOTE: Block comment line describing behavior or context.
041478| src/lib/search/search-doc-queries.ts:129:  * @param sort - The sort option being used
041479| NOTE: Block comment line describing behavior or context.
041480| src/lib/search/search-doc-queries.ts:130:  * @param startParamIndex - Starting parameter index for SQL placeholders
041481| NOTE: Block comment line describing behavior or context.
041482| src/lib/search/search-doc-queries.ts:131:  * @returns Object with WHERE clause fragment and params
041483| NOTE: Block comment line describing behavior or context.
041484| src/lib/search/search-doc-queries.ts:132:  */
041485| NOTE: Block comment line describing behavior or context.
041486| src/lib/search/search-doc-queries.ts:133: function buildKeysetWhereClause(
041487| NOTE: Defines a helper or component function.
041488| src/lib/search/search-doc-queries.ts:134:   cursor: KeysetCursor,
041489| NOTE: Implementation detail supporting search page behavior.
041490| src/lib/search/search-doc-queries.ts:135:   sort: SortOption,
041491| NOTE: Implementation detail supporting search page behavior.
041492| src/lib/search/search-doc-queries.ts:136:   startParamIndex: number,
041493| NOTE: Implementation detail supporting search page behavior.
041494| src/lib/search/search-doc-queries.ts:137: ): { clause: string; params: unknown[]; nextParamIndex: number } {
041495| NOTE: Implementation detail supporting search page behavior.
041496| src/lib/search/search-doc-queries.ts:138:   const params: unknown[] = [];
041497| NOTE: Local declaration used by search logic or UI.
041498| src/lib/search/search-doc-queries.ts:139:   let paramIndex = startParamIndex;
041499| NOTE: Local declaration used by search logic or UI.
041500| src/lib/search/search-doc-queries.ts:140: 
041501| NOTE: Blank line for visual separation.
041502| src/lib/search/search-doc-queries.ts:141:   // Helper to get next param placeholder
041503| NOTE: Line comment documents intent or constraints.
041504| src/lib/search/search-doc-queries.ts:142:   const nextParam = () => `$${paramIndex++}`;
041505| NOTE: Local declaration used by search logic or UI.
041506| src/lib/search/search-doc-queries.ts:143: 
041507| NOTE: Blank line for visual separation.
041508| src/lib/search/search-doc-queries.ts:144:   let clause: string;
041509| NOTE: Local declaration used by search logic or UI.
041510| src/lib/search/search-doc-queries.ts:145: 
041511| NOTE: Blank line for visual separation.
041512| src/lib/search/search-doc-queries.ts:146:   switch (sort) {
041513| NOTE: Implementation detail supporting search page behavior.
041514| src/lib/search/search-doc-queries.ts:147:     case "recommended": {
041515| NOTE: Implementation detail supporting search page behavior.
041516| src/lib/search/search-doc-queries.ts:148:       // ORDER BY: recommended_score DESC, listing_created_at DESC, id ASC
041517| NOTE: Line comment documents intent or constraints.
041518| src/lib/search/search-doc-queries.ts:149:       // k[0] = recommended_score, k[1] = listing_created_at
041519| NOTE: Line comment documents intent or constraints.
041520| src/lib/search/search-doc-queries.ts:150:       const scoreParam = nextParam();
041521| NOTE: Local declaration used by search logic or UI.
041522| src/lib/search/search-doc-queries.ts:151:       const dateParam = nextParam();
041523| NOTE: Local declaration used by search logic or UI.
041524| src/lib/search/search-doc-queries.ts:152:       const idParam = nextParam();
041525| NOTE: Local declaration used by search logic or UI.
041526| src/lib/search/search-doc-queries.ts:153: 
041527| NOTE: Blank line for visual separation.
041528| src/lib/search/search-doc-queries.ts:154:       // Cast string cursor values back to proper types
041529| NOTE: Line comment documents intent or constraints.
041530| src/lib/search/search-doc-queries.ts:155:       params.push(
041531| NOTE: Implementation detail supporting search page behavior.
041532| src/lib/search/search-doc-queries.ts:156:         cursor.k[0] !== null ? parseFloat(cursor.k[0]) : null,
041533| NOTE: Implementation detail supporting search page behavior.
041534| src/lib/search/search-doc-queries.ts:157:         cursor.k[1],
041535| NOTE: Implementation detail supporting search page behavior.
041536| src/lib/search/search-doc-queries.ts:158:         cursor.id,
041537| NOTE: Implementation detail supporting search page behavior.
041538| src/lib/search/search-doc-queries.ts:159:       );
041539| NOTE: Implementation detail supporting search page behavior.
041540| src/lib/search/search-doc-queries.ts:160: 
041541| NOTE: Blank line for visual separation.
041542| src/lib/search/search-doc-queries.ts:161:       clause = `(
041543| NOTE: Implementation detail supporting search page behavior.
041544| src/lib/search/search-doc-queries.ts:162:         (d.recommended_score < ${scoreParam}::float8)
041545| NOTE: Implementation detail supporting search page behavior.
041546| src/lib/search/search-doc-queries.ts:163:         OR (d.recommended_score = ${scoreParam}::float8 AND d.listing_created_at < ${dateParam}::timestamptz)
041547| NOTE: Implementation detail supporting search page behavior.
041548| src/lib/search/search-doc-queries.ts:164:         OR (d.recommended_score = ${scoreParam}::float8 AND d.listing_created_at = ${dateParam}::timestamptz AND d.id > ${idParam})
041549| NOTE: Implementation detail supporting search page behavior.
041550| src/lib/search/search-doc-queries.ts:165:       )`;
041551| NOTE: Implementation detail supporting search page behavior.
041552| src/lib/search/search-doc-queries.ts:166:       break;
041553| NOTE: Implementation detail supporting search page behavior.
041554| src/lib/search/search-doc-queries.ts:167:     }
041555| NOTE: Implementation detail supporting search page behavior.
041556| src/lib/search/search-doc-queries.ts:168: 
041557| NOTE: Blank line for visual separation.
041558| src/lib/search/search-doc-queries.ts:169:     case "newest": {
041559| NOTE: Implementation detail supporting search page behavior.
041560| src/lib/search/search-doc-queries.ts:170:       // ORDER BY: listing_created_at DESC, id ASC
041561| NOTE: Line comment documents intent or constraints.
041562| src/lib/search/search-doc-queries.ts:171:       // k[0] = listing_created_at
041563| NOTE: Line comment documents intent or constraints.
041564| src/lib/search/search-doc-queries.ts:172:       const dateParam = nextParam();
041565| NOTE: Local declaration used by search logic or UI.
041566| src/lib/search/search-doc-queries.ts:173:       const idParam = nextParam();
041567| NOTE: Local declaration used by search logic or UI.
041568| src/lib/search/search-doc-queries.ts:174: 
041569| NOTE: Blank line for visual separation.
041570| src/lib/search/search-doc-queries.ts:175:       params.push(cursor.k[0], cursor.id);
041571| NOTE: Implementation detail supporting search page behavior.
041572| src/lib/search/search-doc-queries.ts:176: 
041573| NOTE: Blank line for visual separation.
041574| src/lib/search/search-doc-queries.ts:177:       clause = `(
041575| NOTE: Implementation detail supporting search page behavior.
041576| src/lib/search/search-doc-queries.ts:178:         (d.listing_created_at < ${dateParam}::timestamptz)
041577| NOTE: Implementation detail supporting search page behavior.
041578| src/lib/search/search-doc-queries.ts:179:         OR (d.listing_created_at = ${dateParam}::timestamptz AND d.id > ${idParam})
041579| NOTE: Implementation detail supporting search page behavior.
041580| src/lib/search/search-doc-queries.ts:180:       )`;
041581| NOTE: Implementation detail supporting search page behavior.
041582| src/lib/search/search-doc-queries.ts:181:       break;
041583| NOTE: Implementation detail supporting search page behavior.
041584| src/lib/search/search-doc-queries.ts:182:     }
041585| NOTE: Implementation detail supporting search page behavior.
041586| src/lib/search/search-doc-queries.ts:183: 
041587| NOTE: Blank line for visual separation.
041588| src/lib/search/search-doc-queries.ts:184:     case "price_asc": {
041589| NOTE: Implementation detail supporting search page behavior.
041590| src/lib/search/search-doc-queries.ts:185:       // ORDER BY: price ASC NULLS LAST, listing_created_at DESC, id ASC
041591| NOTE: Line comment documents intent or constraints.
041592| src/lib/search/search-doc-queries.ts:186:       // k[0] = price, k[1] = listing_created_at
041593| NOTE: Line comment documents intent or constraints.
041594| src/lib/search/search-doc-queries.ts:187:       const priceParam = nextParam();
041595| NOTE: Local declaration used by search logic or UI.
041596| src/lib/search/search-doc-queries.ts:188:       const dateParam = nextParam();
041597| NOTE: Local declaration used by search logic or UI.
041598| src/lib/search/search-doc-queries.ts:189:       const idParam = nextParam();
041599| NOTE: Local declaration used by search logic or UI.
041600| src/lib/search/search-doc-queries.ts:190: 
041601| NOTE: Blank line for visual separation.
041602| src/lib/search/search-doc-queries.ts:191:       params.push(
041603| NOTE: Implementation detail supporting search page behavior.
041604| src/lib/search/search-doc-queries.ts:192:         cursor.k[0] !== null ? parseFloat(cursor.k[0]) : null,
041605| NOTE: Implementation detail supporting search page behavior.
041606| src/lib/search/search-doc-queries.ts:193:         cursor.k[1],
041607| NOTE: Implementation detail supporting search page behavior.
041608| src/lib/search/search-doc-queries.ts:194:         cursor.id,
041609| NOTE: Implementation detail supporting search page behavior.
041610| src/lib/search/search-doc-queries.ts:195:       );
041611| NOTE: Implementation detail supporting search page behavior.
041612| src/lib/search/search-doc-queries.ts:196: 
041613| NOTE: Blank line for visual separation.
041614| src/lib/search/search-doc-queries.ts:197:       // For ASC NULLS LAST: values after cursor are > cursor OR cursor is NOT NULL and value IS NULL
041615| NOTE: Line comment documents intent or constraints.
041616| src/lib/search/search-doc-queries.ts:198:       clause = `(
041617| NOTE: Implementation detail supporting search page behavior.
041618| src/lib/search/search-doc-queries.ts:199:         (d.price > ${priceParam}::numeric OR (d.price IS NULL AND ${priceParam}::numeric IS NOT NULL))
041619| NOTE: Implementation detail supporting search page behavior.
041620| src/lib/search/search-doc-queries.ts:200:         OR (d.price = ${priceParam}::numeric AND d.listing_created_at < ${dateParam}::timestamptz)
041621| NOTE: Implementation detail supporting search page behavior.
041622| src/lib/search/search-doc-queries.ts:201:         OR (d.price = ${priceParam}::numeric AND d.listing_created_at = ${dateParam}::timestamptz AND d.id > ${idParam})
041623| NOTE: Implementation detail supporting search page behavior.
041624| src/lib/search/search-doc-queries.ts:202:       )`;
041625| NOTE: Implementation detail supporting search page behavior.
041626| src/lib/search/search-doc-queries.ts:203:       break;
041627| NOTE: Implementation detail supporting search page behavior.
041628| src/lib/search/search-doc-queries.ts:204:     }
041629| NOTE: Implementation detail supporting search page behavior.
041630| src/lib/search/search-doc-queries.ts:205: 
041631| NOTE: Blank line for visual separation.
041632| src/lib/search/search-doc-queries.ts:206:     case "price_desc": {
041633| NOTE: Implementation detail supporting search page behavior.
041634| src/lib/search/search-doc-queries.ts:207:       // ORDER BY: price DESC NULLS LAST, listing_created_at DESC, id ASC
041635| NOTE: Line comment documents intent or constraints.
041636| src/lib/search/search-doc-queries.ts:208:       // k[0] = price, k[1] = listing_created_at
041637| NOTE: Line comment documents intent or constraints.
041638| src/lib/search/search-doc-queries.ts:209:       const priceParam = nextParam();
041639| NOTE: Local declaration used by search logic or UI.
041640| src/lib/search/search-doc-queries.ts:210:       const dateParam = nextParam();
041641| NOTE: Local declaration used by search logic or UI.
041642| src/lib/search/search-doc-queries.ts:211:       const idParam = nextParam();
041643| NOTE: Local declaration used by search logic or UI.
041644| src/lib/search/search-doc-queries.ts:212: 
041645| NOTE: Blank line for visual separation.
041646| src/lib/search/search-doc-queries.ts:213:       params.push(
041647| NOTE: Implementation detail supporting search page behavior.
041648| src/lib/search/search-doc-queries.ts:214:         cursor.k[0] !== null ? parseFloat(cursor.k[0]) : null,
041649| NOTE: Implementation detail supporting search page behavior.
041650| src/lib/search/search-doc-queries.ts:215:         cursor.k[1],
041651| NOTE: Implementation detail supporting search page behavior.
041652| src/lib/search/search-doc-queries.ts:216:         cursor.id,
041653| NOTE: Implementation detail supporting search page behavior.
041654| src/lib/search/search-doc-queries.ts:217:       );
041655| NOTE: Implementation detail supporting search page behavior.
041656| src/lib/search/search-doc-queries.ts:218: 
041657| NOTE: Blank line for visual separation.
041658| src/lib/search/search-doc-queries.ts:219:       // For DESC NULLS LAST: values after cursor are < cursor OR cursor is NULL (at end)
041659| NOTE: Line comment documents intent or constraints.
041660| src/lib/search/search-doc-queries.ts:220:       clause = `(
041661| NOTE: Implementation detail supporting search page behavior.
041662| src/lib/search/search-doc-queries.ts:221:         (d.price < ${priceParam}::numeric)
041663| NOTE: Implementation detail supporting search page behavior.
041664| src/lib/search/search-doc-queries.ts:222:         OR (d.price = ${priceParam}::numeric AND d.listing_created_at < ${dateParam}::timestamptz)
041665| NOTE: Implementation detail supporting search page behavior.
041666| src/lib/search/search-doc-queries.ts:223:         OR (d.price = ${priceParam}::numeric AND d.listing_created_at = ${dateParam}::timestamptz AND d.id > ${idParam})
041667| NOTE: Implementation detail supporting search page behavior.
041668| src/lib/search/search-doc-queries.ts:224:         OR (${priceParam}::numeric IS NULL AND d.price IS NOT NULL)
041669| NOTE: Implementation detail supporting search page behavior.
041670| src/lib/search/search-doc-queries.ts:225:       )`;
041671| NOTE: Implementation detail supporting search page behavior.
041672| src/lib/search/search-doc-queries.ts:226:       break;
041673| NOTE: Implementation detail supporting search page behavior.
041674| src/lib/search/search-doc-queries.ts:227:     }
041675| NOTE: Implementation detail supporting search page behavior.
041676| src/lib/search/search-doc-queries.ts:228: 
041677| NOTE: Blank line for visual separation.
041678| src/lib/search/search-doc-queries.ts:229:     case "rating": {
041679| NOTE: Implementation detail supporting search page behavior.
041680| src/lib/search/search-doc-queries.ts:230:       // ORDER BY: avg_rating DESC NULLS LAST, review_count DESC, listing_created_at DESC, id ASC
041681| NOTE: Line comment documents intent or constraints.
041682| src/lib/search/search-doc-queries.ts:231:       // k[0] = avg_rating, k[1] = review_count, k[2] = listing_created_at
041683| NOTE: Line comment documents intent or constraints.
041684| src/lib/search/search-doc-queries.ts:232:       const ratingParam = nextParam();
041685| NOTE: Local declaration used by search logic or UI.
041686| src/lib/search/search-doc-queries.ts:233:       const countParam = nextParam();
041687| NOTE: Local declaration used by search logic or UI.
041688| src/lib/search/search-doc-queries.ts:234:       const dateParam = nextParam();
041689| NOTE: Local declaration used by search logic or UI.
041690| src/lib/search/search-doc-queries.ts:235:       const idParam = nextParam();
041691| NOTE: Local declaration used by search logic or UI.
041692| src/lib/search/search-doc-queries.ts:236: 
041693| NOTE: Blank line for visual separation.
041694| src/lib/search/search-doc-queries.ts:237:       params.push(
041695| NOTE: Implementation detail supporting search page behavior.
041696| src/lib/search/search-doc-queries.ts:238:         cursor.k[0] !== null ? parseFloat(cursor.k[0]) : null,
041697| NOTE: Implementation detail supporting search page behavior.
041698| src/lib/search/search-doc-queries.ts:239:         cursor.k[1] !== null ? parseInt(cursor.k[1], 10) : null,
041699| NOTE: Implementation detail supporting search page behavior.
041700| src/lib/search/search-doc-queries.ts:240:         cursor.k[2],
041701| NOTE: Implementation detail supporting search page behavior.
041702| src/lib/search/search-doc-queries.ts:241:         cursor.id,
041703| NOTE: Implementation detail supporting search page behavior.
041704| src/lib/search/search-doc-queries.ts:242:       );
041705| NOTE: Implementation detail supporting search page behavior.
041706| src/lib/search/search-doc-queries.ts:243: 
041707| NOTE: Blank line for visual separation.
041708| src/lib/search/search-doc-queries.ts:244:       clause = `(
041709| NOTE: Implementation detail supporting search page behavior.
041710| src/lib/search/search-doc-queries.ts:245:         (d.avg_rating < ${ratingParam}::float8)
041711| NOTE: Implementation detail supporting search page behavior.
041712| src/lib/search/search-doc-queries.ts:246:         OR (d.avg_rating = ${ratingParam}::float8 AND d.review_count < ${countParam}::int)
041713| NOTE: Implementation detail supporting search page behavior.
041714| src/lib/search/search-doc-queries.ts:247:         OR (d.avg_rating = ${ratingParam}::float8 AND d.review_count = ${countParam}::int AND d.listing_created_at < ${dateParam}::timestamptz)
041715| NOTE: Implementation detail supporting search page behavior.
041716| src/lib/search/search-doc-queries.ts:248:         OR (d.avg_rating = ${ratingParam}::float8 AND d.review_count = ${countParam}::int AND d.listing_created_at = ${dateParam}::timestamptz AND d.id > ${idParam})
041717| NOTE: Implementation detail supporting search page behavior.
041718| src/lib/search/search-doc-queries.ts:249:         OR (${ratingParam}::float8 IS NULL AND d.avg_rating IS NOT NULL)
041719| NOTE: Implementation detail supporting search page behavior.
041720| src/lib/search/search-doc-queries.ts:250:       )`;
041721| NOTE: Implementation detail supporting search page behavior.
041722| src/lib/search/search-doc-queries.ts:251:       break;
041723| NOTE: Implementation detail supporting search page behavior.
041724| src/lib/search/search-doc-queries.ts:252:     }
041725| NOTE: Implementation detail supporting search page behavior.
041726| src/lib/search/search-doc-queries.ts:253: 
041727| NOTE: Blank line for visual separation.
041728| src/lib/search/search-doc-queries.ts:254:     default:
041729| NOTE: Implementation detail supporting search page behavior.
041730| src/lib/search/search-doc-queries.ts:255:       // Fallback to recommended sort
041731| NOTE: Line comment documents intent or constraints.
041732| src/lib/search/search-doc-queries.ts:256:       return buildKeysetWhereClause(
041733| NOTE: Return statement for component or helper output.
041734| src/lib/search/search-doc-queries.ts:257:         { ...cursor, s: "recommended" },
041735| NOTE: Implementation detail supporting search page behavior.
041736| src/lib/search/search-doc-queries.ts:258:         "recommended",
041737| NOTE: Implementation detail supporting search page behavior.
041738| src/lib/search/search-doc-queries.ts:259:         startParamIndex,
041739| NOTE: Implementation detail supporting search page behavior.
041740| src/lib/search/search-doc-queries.ts:260:       );
041741| NOTE: Implementation detail supporting search page behavior.
041742| src/lib/search/search-doc-queries.ts:261:   }
041743| NOTE: Implementation detail supporting search page behavior.
041744| src/lib/search/search-doc-queries.ts:262: 
041745| NOTE: Blank line for visual separation.
041746| src/lib/search/search-doc-queries.ts:263:   return { clause, params, nextParamIndex: paramIndex };
041747| NOTE: Return statement for component or helper output.
041748| src/lib/search/search-doc-queries.ts:264: }
041749| NOTE: Implementation detail supporting search page behavior.
041750| src/lib/search/search-doc-queries.ts:265: 
041751| NOTE: Blank line for visual separation.
041752| src/lib/search/search-doc-queries.ts:266: // ============================================
041753| NOTE: Line comment documents intent or constraints.
041754| src/lib/search/search-doc-queries.ts:267: // Build WHERE conditions for SearchDoc queries
041755| NOTE: Line comment documents intent or constraints.
041756| src/lib/search/search-doc-queries.ts:268: // ============================================
041757| NOTE: Line comment documents intent or constraints.
041758| src/lib/search/search-doc-queries.ts:269: 
041759| NOTE: Blank line for visual separation.
041760| src/lib/search/search-doc-queries.ts:270: interface WhereBuilder {
041761| NOTE: Type declaration for search data contracts.
041762| src/lib/search/search-doc-queries.ts:271:   conditions: string[];
041763| NOTE: Implementation detail supporting search page behavior.
041764| src/lib/search/search-doc-queries.ts:272:   params: unknown[];
041765| NOTE: Implementation detail supporting search page behavior.
041766| src/lib/search/search-doc-queries.ts:273:   paramIndex: number;
041767| NOTE: Implementation detail supporting search page behavior.
041768| src/lib/search/search-doc-queries.ts:274: }
041769| NOTE: Implementation detail supporting search page behavior.
041770| src/lib/search/search-doc-queries.ts:275: 
041771| NOTE: Blank line for visual separation.
041772| src/lib/search/search-doc-queries.ts:276: function buildSearchDocWhereConditions(
041773| NOTE: Defines a helper or component function.
041774| src/lib/search/search-doc-queries.ts:277:   filterParams: FilterParams,
041775| NOTE: Implementation detail supporting search page behavior.
041776| src/lib/search/search-doc-queries.ts:278: ): WhereBuilder {
041777| NOTE: Implementation detail supporting search page behavior.
041778| src/lib/search/search-doc-queries.ts:279:   const {
041779| NOTE: Local declaration used by search logic or UI.
041780| src/lib/search/search-doc-queries.ts:280:     query,
041781| NOTE: Implementation detail supporting search page behavior.
041782| src/lib/search/search-doc-queries.ts:281:     minPrice,
041783| NOTE: Implementation detail supporting search page behavior.
041784| src/lib/search/search-doc-queries.ts:282:     maxPrice,
041785| NOTE: Implementation detail supporting search page behavior.
041786| src/lib/search/search-doc-queries.ts:283:     amenities,
041787| NOTE: Implementation detail supporting search page behavior.
041788| src/lib/search/search-doc-queries.ts:284:     moveInDate,
041789| NOTE: Implementation detail supporting search page behavior.
041790| src/lib/search/search-doc-queries.ts:285:     leaseDuration,
041791| NOTE: Implementation detail supporting search page behavior.
041792| src/lib/search/search-doc-queries.ts:286:     houseRules,
041793| NOTE: Implementation detail supporting search page behavior.
041794| src/lib/search/search-doc-queries.ts:287:     roomType,
041795| NOTE: Implementation detail supporting search page behavior.
041796| src/lib/search/search-doc-queries.ts:288:     languages,
041797| NOTE: Implementation detail supporting search page behavior.
041798| src/lib/search/search-doc-queries.ts:289:     bounds,
041799| NOTE: Implementation detail supporting search page behavior.
041800| src/lib/search/search-doc-queries.ts:290:   } = filterParams;
041801| NOTE: Implementation detail supporting search page behavior.
041802| src/lib/search/search-doc-queries.ts:291: 
041803| NOTE: Blank line for visual separation.
041804| src/lib/search/search-doc-queries.ts:292:   // Base conditions for SearchDoc
041805| NOTE: Line comment documents intent or constraints.
041806| src/lib/search/search-doc-queries.ts:293:   const conditions: string[] = [
041807| NOTE: Local declaration used by search logic or UI.
041808| src/lib/search/search-doc-queries.ts:294:     "d.available_slots > 0",
041809| NOTE: Implementation detail supporting search page behavior.
041810| src/lib/search/search-doc-queries.ts:295:     "d.status = 'ACTIVE'",
041811| NOTE: Implementation detail supporting search page behavior.
041812| src/lib/search/search-doc-queries.ts:296:     "d.lat IS NOT NULL",
041813| NOTE: Implementation detail supporting search page behavior.
041814| src/lib/search/search-doc-queries.ts:297:     "d.lng IS NOT NULL",
041815| NOTE: Implementation detail supporting search page behavior.
041816| src/lib/search/search-doc-queries.ts:298:   ];
041817| NOTE: Implementation detail supporting search page behavior.
041818| src/lib/search/search-doc-queries.ts:299:   const params: unknown[] = [];
041819| NOTE: Local declaration used by search logic or UI.
041820| src/lib/search/search-doc-queries.ts:300:   let paramIndex = 1;
041821| NOTE: Local declaration used by search logic or UI.
041822| src/lib/search/search-doc-queries.ts:301: 
041823| NOTE: Blank line for visual separation.
041824| src/lib/search/search-doc-queries.ts:302:   // Geographic bounds filter using PostGIS geography
041825| NOTE: Line comment documents intent or constraints.
041826| src/lib/search/search-doc-queries.ts:303:   if (bounds) {
041827| NOTE: Conditional logic controlling rendering or flow.
041828| src/lib/search/search-doc-queries.ts:304:     if (crossesAntimeridian(bounds.minLng, bounds.maxLng)) {
041829| NOTE: Conditional logic controlling rendering or flow.
041830| src/lib/search/search-doc-queries.ts:305:       // Antimeridian crossing: split into two ranges
041831| NOTE: Line comment documents intent or constraints.
041832| src/lib/search/search-doc-queries.ts:306:       conditions.push(`(
041833| NOTE: Implementation detail supporting search page behavior.
041834| src/lib/search/search-doc-queries.ts:307:         d.location_geog && ST_MakeEnvelope($${paramIndex}, $${paramIndex + 1}, 180, $${paramIndex + 2}, 4326)::geography
041835| NOTE: Implementation detail supporting search page behavior.
041836| src/lib/search/search-doc-queries.ts:308:         OR d.location_geog && ST_MakeEnvelope(-180, $${paramIndex + 1}, $${paramIndex + 3}, $${paramIndex + 2}, 4326)::geography
041837| NOTE: Implementation detail supporting search page behavior.
041838| src/lib/search/search-doc-queries.ts:309:       )`);
041839| NOTE: Implementation detail supporting search page behavior.
041840| src/lib/search/search-doc-queries.ts:310:       params.push(bounds.minLng, bounds.minLat, bounds.maxLat, bounds.maxLng);
041841| NOTE: Implementation detail supporting search page behavior.
041842| src/lib/search/search-doc-queries.ts:311:       paramIndex += 4;
041843| NOTE: Implementation detail supporting search page behavior.
041844| src/lib/search/search-doc-queries.ts:312:     } else {
041845| NOTE: Implementation detail supporting search page behavior.
041846| src/lib/search/search-doc-queries.ts:313:       // Normal bounding box using geography operator
041847| NOTE: Line comment documents intent or constraints.
041848| src/lib/search/search-doc-queries.ts:314:       conditions.push(
041849| NOTE: Implementation detail supporting search page behavior.
041850| src/lib/search/search-doc-queries.ts:315:         `d.location_geog && ST_MakeEnvelope($${paramIndex}, $${paramIndex + 1}, $${paramIndex + 2}, $${paramIndex + 3}, 4326)::geography`,
041851| NOTE: Implementation detail supporting search page behavior.
041852| src/lib/search/search-doc-queries.ts:316:       );
041853| NOTE: Implementation detail supporting search page behavior.
041854| src/lib/search/search-doc-queries.ts:317:       params.push(bounds.minLng, bounds.minLat, bounds.maxLng, bounds.maxLat);
041855| NOTE: Implementation detail supporting search page behavior.
041856| src/lib/search/search-doc-queries.ts:318:       paramIndex += 4;
041857| NOTE: Implementation detail supporting search page behavior.
041858| src/lib/search/search-doc-queries.ts:319:     }
041859| NOTE: Implementation detail supporting search page behavior.
041860| src/lib/search/search-doc-queries.ts:320:   }
041861| NOTE: Implementation detail supporting search page behavior.
041862| src/lib/search/search-doc-queries.ts:321: 
041863| NOTE: Blank line for visual separation.
041864| src/lib/search/search-doc-queries.ts:322:   // Price range filter
041865| NOTE: Line comment documents intent or constraints.
041866| src/lib/search/search-doc-queries.ts:323:   if (minPrice !== undefined && minPrice !== null) {
041867| NOTE: Conditional logic controlling rendering or flow.
041868| src/lib/search/search-doc-queries.ts:324:     conditions.push(`d.price >= $${paramIndex++}`);
041869| NOTE: Implementation detail supporting search page behavior.
041870| src/lib/search/search-doc-queries.ts:325:     params.push(minPrice);
041871| NOTE: Implementation detail supporting search page behavior.
041872| src/lib/search/search-doc-queries.ts:326:   }
041873| NOTE: Implementation detail supporting search page behavior.
041874| src/lib/search/search-doc-queries.ts:327:   if (maxPrice !== undefined && maxPrice !== null) {
041875| NOTE: Conditional logic controlling rendering or flow.
041876| src/lib/search/search-doc-queries.ts:328:     conditions.push(`d.price <= $${paramIndex++}`);
041877| NOTE: Implementation detail supporting search page behavior.
041878| src/lib/search/search-doc-queries.ts:329:     params.push(maxPrice);
041879| NOTE: Implementation detail supporting search page behavior.
041880| src/lib/search/search-doc-queries.ts:330:   }
041881| NOTE: Implementation detail supporting search page behavior.
041882| src/lib/search/search-doc-queries.ts:331: 
041883| NOTE: Blank line for visual separation.
041884| src/lib/search/search-doc-queries.ts:332:   // Text search filter (searches title, description, city, state)
041885| NOTE: Line comment documents intent or constraints.
041886| src/lib/search/search-doc-queries.ts:333:   if (query && isValidQuery(query)) {
041887| NOTE: Conditional logic controlling rendering or flow.
041888| src/lib/search/search-doc-queries.ts:334:     const sanitizedQuery = sanitizeSearchQuery(query);
041889| NOTE: Local declaration used by search logic or UI.
041890| src/lib/search/search-doc-queries.ts:335:     if (sanitizedQuery) {
041891| NOTE: Conditional logic controlling rendering or flow.
041892| src/lib/search/search-doc-queries.ts:336:       const searchPattern = `%${sanitizedQuery}%`;
041893| NOTE: Local declaration used by search logic or UI.
041894| src/lib/search/search-doc-queries.ts:337:       conditions.push(`(
041895| NOTE: Implementation detail supporting search page behavior.
041896| src/lib/search/search-doc-queries.ts:338:         LOWER(d.title) LIKE LOWER($${paramIndex}) OR
041897| NOTE: Implementation detail supporting search page behavior.
041898| src/lib/search/search-doc-queries.ts:339:         LOWER(d.description) LIKE LOWER($${paramIndex}) OR
041899| NOTE: Implementation detail supporting search page behavior.
041900| src/lib/search/search-doc-queries.ts:340:         LOWER(d.city) LIKE LOWER($${paramIndex}) OR
041901| NOTE: Implementation detail supporting search page behavior.
041902| src/lib/search/search-doc-queries.ts:341:         LOWER(d.state) LIKE LOWER($${paramIndex})
041903| NOTE: Implementation detail supporting search page behavior.
041904| src/lib/search/search-doc-queries.ts:342:       )`);
041905| NOTE: Implementation detail supporting search page behavior.
041906| src/lib/search/search-doc-queries.ts:343:       params.push(searchPattern);
041907| NOTE: Implementation detail supporting search page behavior.
041908| src/lib/search/search-doc-queries.ts:344:       paramIndex++;
041909| NOTE: Implementation detail supporting search page behavior.
041910| src/lib/search/search-doc-queries.ts:345:     }
041911| NOTE: Implementation detail supporting search page behavior.
041912| src/lib/search/search-doc-queries.ts:346:   }
041913| NOTE: Implementation detail supporting search page behavior.
041914| src/lib/search/search-doc-queries.ts:347: 
041915| NOTE: Blank line for visual separation.
041916| src/lib/search/search-doc-queries.ts:348:   // Room type filter (uses lowercase comparison)
041917| NOTE: Line comment documents intent or constraints.
041918| src/lib/search/search-doc-queries.ts:349:   if (roomType) {
041919| NOTE: Conditional logic controlling rendering or flow.
041920| src/lib/search/search-doc-queries.ts:350:     conditions.push(`LOWER(d.room_type) = LOWER($${paramIndex++})`);
041921| NOTE: Implementation detail supporting search page behavior.
041922| src/lib/search/search-doc-queries.ts:351:     params.push(roomType);
041923| NOTE: Implementation detail supporting search page behavior.
041924| src/lib/search/search-doc-queries.ts:352:   }
041925| NOTE: Implementation detail supporting search page behavior.
041926| src/lib/search/search-doc-queries.ts:353: 
041927| NOTE: Blank line for visual separation.
041928| src/lib/search/search-doc-queries.ts:354:   // Lease duration filter (uses lowercase comparison)
041929| NOTE: Line comment documents intent or constraints.
041930| src/lib/search/search-doc-queries.ts:355:   if (leaseDuration) {
041931| NOTE: Conditional logic controlling rendering or flow.
041932| src/lib/search/search-doc-queries.ts:356:     conditions.push(`LOWER(d.lease_duration) = LOWER($${paramIndex++})`);
041933| NOTE: Implementation detail supporting search page behavior.
041934| src/lib/search/search-doc-queries.ts:357:     params.push(leaseDuration);
041935| NOTE: Implementation detail supporting search page behavior.
041936| src/lib/search/search-doc-queries.ts:358:   }
041937| NOTE: Implementation detail supporting search page behavior.
041938| src/lib/search/search-doc-queries.ts:359: 
041939| NOTE: Blank line for visual separation.
041940| src/lib/search/search-doc-queries.ts:360:   // Move-in date filter
041941| NOTE: Line comment documents intent or constraints.
041942| src/lib/search/search-doc-queries.ts:361:   if (moveInDate) {
041943| NOTE: Conditional logic controlling rendering or flow.
041944| src/lib/search/search-doc-queries.ts:362:     conditions.push(
041945| NOTE: Implementation detail supporting search page behavior.
041946| src/lib/search/search-doc-queries.ts:363:       `(d.move_in_date IS NULL OR d.move_in_date <= $${paramIndex++})`,
041947| NOTE: Implementation detail supporting search page behavior.
041948| src/lib/search/search-doc-queries.ts:364:     );
041949| NOTE: Implementation detail supporting search page behavior.
041950| src/lib/search/search-doc-queries.ts:365:     params.push(parseDateOnly(moveInDate));
041951| NOTE: Implementation detail supporting search page behavior.
041952| src/lib/search/search-doc-queries.ts:366:   }
041953| NOTE: Implementation detail supporting search page behavior.
041954| src/lib/search/search-doc-queries.ts:367: 
041955| NOTE: Blank line for visual separation.
041956| src/lib/search/search-doc-queries.ts:368:   // Languages filter (OR logic) - uses lowercase arrays with GIN index
041957| NOTE: Line comment documents intent or constraints.
041958| src/lib/search/search-doc-queries.ts:369:   if (languages?.length) {
041959| NOTE: Conditional logic controlling rendering or flow.
041960| src/lib/search/search-doc-queries.ts:370:     const normalized = languages
041961| NOTE: Local declaration used by search logic or UI.
041962| src/lib/search/search-doc-queries.ts:371:       .map((l) => l.trim().toLowerCase())
041963| NOTE: Implementation detail supporting search page behavior.
041964| src/lib/search/search-doc-queries.ts:372:       .filter(Boolean);
041965| NOTE: Implementation detail supporting search page behavior.
041966| src/lib/search/search-doc-queries.ts:373:     if (normalized.length > 0) {
041967| NOTE: Conditional logic controlling rendering or flow.
041968| src/lib/search/search-doc-queries.ts:374:       // GIN array overlap - returns true if any element matches
041969| NOTE: Line comment documents intent or constraints.
041970| src/lib/search/search-doc-queries.ts:375:       conditions.push(
041971| NOTE: Implementation detail supporting search page behavior.
041972| src/lib/search/search-doc-queries.ts:376:         `d.household_languages_lower && $${paramIndex++}::text[]`,
041973| NOTE: Implementation detail supporting search page behavior.
041974| src/lib/search/search-doc-queries.ts:377:       );
041975| NOTE: Implementation detail supporting search page behavior.
041976| src/lib/search/search-doc-queries.ts:378:       params.push(normalized);
041977| NOTE: Implementation detail supporting search page behavior.
041978| src/lib/search/search-doc-queries.ts:379:     }
041979| NOTE: Implementation detail supporting search page behavior.
041980| src/lib/search/search-doc-queries.ts:380:   }
041981| NOTE: Implementation detail supporting search page behavior.
041982| src/lib/search/search-doc-queries.ts:381: 
041983| NOTE: Blank line for visual separation.
041984| src/lib/search/search-doc-queries.ts:382:   // Amenities filter (AND logic) - uses lowercase arrays with GIN index
041985| NOTE: Line comment documents intent or constraints.
041986| src/lib/search/search-doc-queries.ts:383:   // Uses partial match pattern - 'pool' matches 'pool access'
041987| NOTE: Line comment documents intent or constraints.
041988| src/lib/search/search-doc-queries.ts:384:   if (amenities?.length) {
041989| NOTE: Conditional logic controlling rendering or flow.
041990| src/lib/search/search-doc-queries.ts:385:     const normalizedAmenities = amenities
041991| NOTE: Local declaration used by search logic or UI.
041992| src/lib/search/search-doc-queries.ts:386:       .map((a) => a.trim().toLowerCase())
041993| NOTE: Implementation detail supporting search page behavior.
041994| src/lib/search/search-doc-queries.ts:387:       .filter(Boolean);
041995| NOTE: Implementation detail supporting search page behavior.
041996| src/lib/search/search-doc-queries.ts:388:     if (normalizedAmenities.length > 0) {
041997| NOTE: Conditional logic controlling rendering or flow.
041998| src/lib/search/search-doc-queries.ts:389:       // For each search term, ensure at least one amenity contains it
041999| NOTE: Line comment documents intent or constraints.
042000| src/lib/search/search-doc-queries.ts:390:       conditions.push(`NOT EXISTS (
042001| NOTE: Implementation detail supporting search page behavior.
042002| src/lib/search/search-doc-queries.ts:391:         SELECT 1 FROM unnest($${paramIndex++}::text[]) AS search_term
042003| NOTE: Implementation detail supporting search page behavior.
042004| src/lib/search/search-doc-queries.ts:392:         WHERE NOT EXISTS (
042005| NOTE: Implementation detail supporting search page behavior.
042006| src/lib/search/search-doc-queries.ts:393:           SELECT 1 FROM unnest(d.amenities_lower) AS la
042007| NOTE: Implementation detail supporting search page behavior.
042008| src/lib/search/search-doc-queries.ts:394:           WHERE la LIKE '%' || search_term || '%'
042009| NOTE: Implementation detail supporting search page behavior.
042010| src/lib/search/search-doc-queries.ts:395:         )
042011| NOTE: Implementation detail supporting search page behavior.
042012| src/lib/search/search-doc-queries.ts:396:       )`);
042013| NOTE: Implementation detail supporting search page behavior.
042014| src/lib/search/search-doc-queries.ts:397:       params.push(normalizedAmenities);
042015| NOTE: Implementation detail supporting search page behavior.
042016| src/lib/search/search-doc-queries.ts:398:     }
042017| NOTE: Implementation detail supporting search page behavior.
042018| src/lib/search/search-doc-queries.ts:399:   }
042019| NOTE: Implementation detail supporting search page behavior.
042020| src/lib/search/search-doc-queries.ts:400: 
042021| NOTE: Blank line for visual separation.
042022| src/lib/search/search-doc-queries.ts:401:   // House rules filter (AND logic) - uses lowercase arrays with GIN index
042023| NOTE: Line comment documents intent or constraints.
042024| src/lib/search/search-doc-queries.ts:402:   if (houseRules?.length) {
042025| NOTE: Conditional logic controlling rendering or flow.
042026| src/lib/search/search-doc-queries.ts:403:     const normalizedRules = houseRules
042027| NOTE: Local declaration used by search logic or UI.
042028| src/lib/search/search-doc-queries.ts:404:       .map((r) => r.trim().toLowerCase())
042029| NOTE: Implementation detail supporting search page behavior.
042030| src/lib/search/search-doc-queries.ts:405:       .filter(Boolean);
042031| NOTE: Implementation detail supporting search page behavior.
042032| src/lib/search/search-doc-queries.ts:406:     if (normalizedRules.length > 0) {
042033| NOTE: Conditional logic controlling rendering or flow.
042034| src/lib/search/search-doc-queries.ts:407:       // Exact match containment using @> operator
042035| NOTE: Line comment documents intent or constraints.
042036| src/lib/search/search-doc-queries.ts:408:       conditions.push(`d.house_rules_lower @> $${paramIndex++}::text[]`);
042037| NOTE: Implementation detail supporting search page behavior.
042038| src/lib/search/search-doc-queries.ts:409:       params.push(normalizedRules);
042039| NOTE: Implementation detail supporting search page behavior.
042040| src/lib/search/search-doc-queries.ts:410:     }
042041| NOTE: Implementation detail supporting search page behavior.
042042| src/lib/search/search-doc-queries.ts:411:   }
042043| NOTE: Implementation detail supporting search page behavior.
042044| src/lib/search/search-doc-queries.ts:412: 
042045| NOTE: Blank line for visual separation.
042046| src/lib/search/search-doc-queries.ts:413:   return { conditions, params, paramIndex };
042047| NOTE: Return statement for component or helper output.
042048| src/lib/search/search-doc-queries.ts:414: }
042049| NOTE: Implementation detail supporting search page behavior.
042050| src/lib/search/search-doc-queries.ts:415: 
042051| NOTE: Blank line for visual separation.
042052| src/lib/search/search-doc-queries.ts:416: // ============================================
042053| NOTE: Line comment documents intent or constraints.
042054| src/lib/search/search-doc-queries.ts:417: // Limited Count Query (Hybrid Pagination)
042055| NOTE: Line comment documents intent or constraints.
042056| src/lib/search/search-doc-queries.ts:418: // ============================================
042057| NOTE: Line comment documents intent or constraints.
042058| src/lib/search/search-doc-queries.ts:419: 
042059| NOTE: Blank line for visual separation.
042060| src/lib/search/search-doc-queries.ts:420: async function getSearchDocLimitedCountInternal(
042061| NOTE: Implementation detail supporting search page behavior.
042062| src/lib/search/search-doc-queries.ts:421:   params: FilterParams,
042063| NOTE: Implementation detail supporting search page behavior.
042064| src/lib/search/search-doc-queries.ts:422: ): Promise<number | null> {
042065| NOTE: Implementation detail supporting search page behavior.
042066| src/lib/search/search-doc-queries.ts:423:   const { conditions, params: queryParams } =
042067| NOTE: Local declaration used by search logic or UI.
042068| src/lib/search/search-doc-queries.ts:424:     buildSearchDocWhereConditions(params);
042069| NOTE: Implementation detail supporting search page behavior.
042070| src/lib/search/search-doc-queries.ts:425:   const whereClause = conditions.join(" AND ");
042071| NOTE: Local declaration used by search logic or UI.
042072| src/lib/search/search-doc-queries.ts:426: 
042073| NOTE: Blank line for visual separation.
042074| src/lib/search/search-doc-queries.ts:427:   // Use subquery with LIMIT 101 to efficiently check if count > threshold
042075| NOTE: Line comment documents intent or constraints.
042076| src/lib/search/search-doc-queries.ts:428:   const limitedCountQuery = `
042077| NOTE: Local declaration used by search logic or UI.
042078| src/lib/search/search-doc-queries.ts:429:     SELECT COUNT(*) as count
042079| NOTE: Implementation detail supporting search page behavior.
042080| src/lib/search/search-doc-queries.ts:430:     FROM (
042081| NOTE: Implementation detail supporting search page behavior.
042082| src/lib/search/search-doc-queries.ts:431:       SELECT d.id
042083| NOTE: Implementation detail supporting search page behavior.
042084| src/lib/search/search-doc-queries.ts:432:       FROM listing_search_docs d
042085| NOTE: Implementation detail supporting search page behavior.
042086| src/lib/search/search-doc-queries.ts:433:       WHERE ${whereClause}
042087| NOTE: Implementation detail supporting search page behavior.
042088| src/lib/search/search-doc-queries.ts:434:       LIMIT ${HYBRID_COUNT_THRESHOLD + 1}
042089| NOTE: Implementation detail supporting search page behavior.
042090| src/lib/search/search-doc-queries.ts:435:     ) subq
042091| NOTE: Implementation detail supporting search page behavior.
042092| src/lib/search/search-doc-queries.ts:436:   `;
042093| NOTE: Implementation detail supporting search page behavior.
042094| src/lib/search/search-doc-queries.ts:437: 
042095| NOTE: Blank line for visual separation.
042096| src/lib/search/search-doc-queries.ts:438:   const result = await prisma.$queryRawUnsafe<{ count: bigint }[]>(
042097| NOTE: Local declaration used by search logic or UI.
042098| src/lib/search/search-doc-queries.ts:439:     limitedCountQuery,
042099| NOTE: Implementation detail supporting search page behavior.
042100| src/lib/search/search-doc-queries.ts:440:     ...queryParams,
042101| NOTE: Implementation detail supporting search page behavior.
042102| src/lib/search/search-doc-queries.ts:441:   );
042103| NOTE: Implementation detail supporting search page behavior.
042104| src/lib/search/search-doc-queries.ts:442: 
042105| NOTE: Blank line for visual separation.
042106| src/lib/search/search-doc-queries.ts:443:   const count = Number(result[0]?.count || 0);
042107| NOTE: Local declaration used by search logic or UI.
042108| src/lib/search/search-doc-queries.ts:444: 
042109| NOTE: Blank line for visual separation.
042110| src/lib/search/search-doc-queries.ts:445:   // If count > threshold, return null (unknown total)
042111| NOTE: Line comment documents intent or constraints.
042112| src/lib/search/search-doc-queries.ts:446:   if (count > HYBRID_COUNT_THRESHOLD) {
042113| NOTE: Conditional logic controlling rendering or flow.
042114| src/lib/search/search-doc-queries.ts:447:     return null;
042115| NOTE: Return statement for component or helper output.
042116| src/lib/search/search-doc-queries.ts:448:   }
042117| NOTE: Implementation detail supporting search page behavior.
042118| src/lib/search/search-doc-queries.ts:449: 
042119| NOTE: Blank line for visual separation.
042120| src/lib/search/search-doc-queries.ts:450:   return count;
042121| NOTE: Return statement for component or helper output.
042122| src/lib/search/search-doc-queries.ts:451: }
042123| NOTE: Implementation detail supporting search page behavior.
042124| src/lib/search/search-doc-queries.ts:452: 
042125| NOTE: Blank line for visual separation.
042126| src/lib/search/search-doc-queries.ts:453: async function getSearchDocLimitedCount(
042127| NOTE: Implementation detail supporting search page behavior.
042128| src/lib/search/search-doc-queries.ts:454:   params: FilterParams,
042129| NOTE: Implementation detail supporting search page behavior.
042130| src/lib/search/search-doc-queries.ts:455: ): Promise<number | null> {
042131| NOTE: Implementation detail supporting search page behavior.
042132| src/lib/search/search-doc-queries.ts:456:   const cacheKey = createSearchDocCountCacheKey(params);
042133| NOTE: Local declaration used by search logic or UI.
042134| src/lib/search/search-doc-queries.ts:457: 
042135| NOTE: Blank line for visual separation.
042136| src/lib/search/search-doc-queries.ts:458:   const cachedFn = unstable_cache(
042137| NOTE: Local declaration used by search logic or UI.
042138| src/lib/search/search-doc-queries.ts:459:     async () => getSearchDocLimitedCountInternal(params),
042139| NOTE: Implementation detail supporting search page behavior.
042140| src/lib/search/search-doc-queries.ts:460:     ["searchdoc-limited-count", cacheKey],
042141| NOTE: Implementation detail supporting search page behavior.
042142| src/lib/search/search-doc-queries.ts:461:     { revalidate: 60 },
042143| NOTE: Implementation detail supporting search page behavior.
042144| src/lib/search/search-doc-queries.ts:462:   );
042145| NOTE: Implementation detail supporting search page behavior.
042146| src/lib/search/search-doc-queries.ts:463: 
042147| NOTE: Blank line for visual separation.
042148| src/lib/search/search-doc-queries.ts:464:   return cachedFn();
042149| NOTE: Return statement for component or helper output.
042150| src/lib/search/search-doc-queries.ts:465: }
042151| NOTE: Implementation detail supporting search page behavior.
042152| src/lib/search/search-doc-queries.ts:466: 
042153| NOTE: Blank line for visual separation.
042154| src/lib/search/search-doc-queries.ts:467: // ============================================
042155| NOTE: Line comment documents intent or constraints.
042156| src/lib/search/search-doc-queries.ts:468: // Map Listings Query (SearchDoc)
042157| NOTE: Line comment documents intent or constraints.
042158| src/lib/search/search-doc-queries.ts:469: // ============================================
042159| NOTE: Line comment documents intent or constraints.
042160| src/lib/search/search-doc-queries.ts:470: 
042161| NOTE: Blank line for visual separation.
042162| src/lib/search/search-doc-queries.ts:471: async function getSearchDocMapListingsInternal(
042163| NOTE: Implementation detail supporting search page behavior.
042164| src/lib/search/search-doc-queries.ts:472:   params: FilterParams,
042165| NOTE: Implementation detail supporting search page behavior.
042166| src/lib/search/search-doc-queries.ts:473: ): Promise<MapListingData[]> {
042167| NOTE: Implementation detail supporting search page behavior.
042168| src/lib/search/search-doc-queries.ts:474:   const {
042169| NOTE: Local declaration used by search logic or UI.
042170| src/lib/search/search-doc-queries.ts:475:     conditions,
042171| NOTE: Implementation detail supporting search page behavior.
042172| src/lib/search/search-doc-queries.ts:476:     params: queryParams,
042173| NOTE: Implementation detail supporting search page behavior.
042174| src/lib/search/search-doc-queries.ts:477:     paramIndex,
042175| NOTE: Implementation detail supporting search page behavior.
042176| src/lib/search/search-doc-queries.ts:478:   } = buildSearchDocWhereConditions(params);
042177| NOTE: Implementation detail supporting search page behavior.
042178| src/lib/search/search-doc-queries.ts:479:   const whereClause = conditions.join(" AND ");
042179| NOTE: Local declaration used by search logic or UI.
042180| src/lib/search/search-doc-queries.ts:480: 
042181| NOTE: Blank line for visual separation.
042182| src/lib/search/search-doc-queries.ts:481:   // Query with minimal fields for map markers
042183| NOTE: Line comment documents intent or constraints.
042184| src/lib/search/search-doc-queries.ts:482:   // Uses precomputed lat/lng from SearchDoc (no ST_X/ST_Y needed)
042185| NOTE: Line comment documents intent or constraints.
042186| src/lib/search/search-doc-queries.ts:483:   const sqlQuery = `
042187| NOTE: Local declaration used by search logic or UI.
042188| src/lib/search/search-doc-queries.ts:484:     SELECT
042189| NOTE: Implementation detail supporting search page behavior.
042190| src/lib/search/search-doc-queries.ts:485:       d.id,
042191| NOTE: Implementation detail supporting search page behavior.
042192| src/lib/search/search-doc-queries.ts:486:       d.title,
042193| NOTE: Implementation detail supporting search page behavior.
042194| src/lib/search/search-doc-queries.ts:487:       d.price,
042195| NOTE: Implementation detail supporting search page behavior.
042196| src/lib/search/search-doc-queries.ts:488:       d.available_slots as "availableSlots",
042197| NOTE: Implementation detail supporting search page behavior.
042198| src/lib/search/search-doc-queries.ts:489:       d.owner_id as "ownerId",
042199| NOTE: Implementation detail supporting search page behavior.
042200| src/lib/search/search-doc-queries.ts:490:       d.images[1] as "primaryImage",
042201| NOTE: Implementation detail supporting search page behavior.
042202| src/lib/search/search-doc-queries.ts:491:       d.lat,
042203| NOTE: Implementation detail supporting search page behavior.
042204| src/lib/search/search-doc-queries.ts:492:       d.lng
042205| NOTE: Implementation detail supporting search page behavior.
042206| src/lib/search/search-doc-queries.ts:493:     FROM listing_search_docs d
042207| NOTE: Implementation detail supporting search page behavior.
042208| src/lib/search/search-doc-queries.ts:494:     WHERE ${whereClause}
042209| NOTE: Implementation detail supporting search page behavior.
042210| src/lib/search/search-doc-queries.ts:495:     ORDER BY d.listing_created_at DESC
042211| NOTE: Implementation detail supporting search page behavior.
042212| src/lib/search/search-doc-queries.ts:496:     LIMIT $${paramIndex}
042213| NOTE: Implementation detail supporting search page behavior.
042214| src/lib/search/search-doc-queries.ts:497:   `;
042215| NOTE: Implementation detail supporting search page behavior.
042216| src/lib/search/search-doc-queries.ts:498: 
042217| NOTE: Blank line for visual separation.
042218| src/lib/search/search-doc-queries.ts:499:   try {
042219| NOTE: Implementation detail supporting search page behavior.
042220| src/lib/search/search-doc-queries.ts:500:     const listings = await prisma.$queryRawUnsafe<any[]>(
042221| NOTE: Local declaration used by search logic or UI.
042222| src/lib/search/search-doc-queries.ts:501:       sqlQuery,
042223| NOTE: Implementation detail supporting search page behavior.
042224| src/lib/search/search-doc-queries.ts:502:       ...queryParams,
042225| NOTE: Implementation detail supporting search page behavior.
042226| src/lib/search/search-doc-queries.ts:503:       MAX_MAP_MARKERS,
042227| NOTE: Implementation detail supporting search page behavior.
042228| src/lib/search/search-doc-queries.ts:504:     );
042229| NOTE: Implementation detail supporting search page behavior.
042230| src/lib/search/search-doc-queries.ts:505: 
042231| NOTE: Blank line for visual separation.
042232| src/lib/search/search-doc-queries.ts:506:     return listings.map((l) => ({
042233| NOTE: Return statement for component or helper output.
042234| src/lib/search/search-doc-queries.ts:507:       id: l.id,
042235| NOTE: Implementation detail supporting search page behavior.
042236| src/lib/search/search-doc-queries.ts:508:       title: l.title,
042237| NOTE: Implementation detail supporting search page behavior.
042238| src/lib/search/search-doc-queries.ts:509:       price: Number(l.price),
042239| NOTE: Implementation detail supporting search page behavior.
042240| src/lib/search/search-doc-queries.ts:510:       availableSlots: l.availableSlots,
042241| NOTE: Implementation detail supporting search page behavior.
042242| src/lib/search/search-doc-queries.ts:511:       ownerId: l.ownerId,
042243| NOTE: Implementation detail supporting search page behavior.
042244| src/lib/search/search-doc-queries.ts:512:       images: l.primaryImage ? [l.primaryImage] : [],
042245| NOTE: Implementation detail supporting search page behavior.
042246| src/lib/search/search-doc-queries.ts:513:       location: {
042247| NOTE: Implementation detail supporting search page behavior.
042248| src/lib/search/search-doc-queries.ts:514:         lat: Number(l.lat) || 0,
042249| NOTE: Implementation detail supporting search page behavior.
042250| src/lib/search/search-doc-queries.ts:515:         lng: Number(l.lng) || 0,
042251| NOTE: Implementation detail supporting search page behavior.
042252| src/lib/search/search-doc-queries.ts:516:       },
042253| NOTE: Implementation detail supporting search page behavior.
042254| src/lib/search/search-doc-queries.ts:517:     }));
042255| NOTE: Implementation detail supporting search page behavior.
042256| src/lib/search/search-doc-queries.ts:518:   } catch (error) {
042257| NOTE: Implementation detail supporting search page behavior.
042258| src/lib/search/search-doc-queries.ts:519:     const dataError = wrapDatabaseError(error, "getSearchDocMapListings");
042259| NOTE: Local declaration used by search logic or UI.
042260| src/lib/search/search-doc-queries.ts:520:     dataError.log({
042261| NOTE: Implementation detail supporting search page behavior.
042262| src/lib/search/search-doc-queries.ts:521:       operation: "getSearchDocMapListings",
042263| NOTE: Implementation detail supporting search page behavior.
042264| src/lib/search/search-doc-queries.ts:522:       hasBounds: !!params?.bounds,
042265| NOTE: Implementation detail supporting search page behavior.
042266| src/lib/search/search-doc-queries.ts:523:     });
042267| NOTE: Implementation detail supporting search page behavior.
042268| src/lib/search/search-doc-queries.ts:524:     throw dataError;
042269| NOTE: Implementation detail supporting search page behavior.
042270| src/lib/search/search-doc-queries.ts:525:   }
042271| NOTE: Implementation detail supporting search page behavior.
042272| src/lib/search/search-doc-queries.ts:526: }
042273| NOTE: Implementation detail supporting search page behavior.
042274| src/lib/search/search-doc-queries.ts:527: 
042275| NOTE: Blank line for visual separation.
042276| src/lib/search/search-doc-queries.ts:528: /**
042277| NOTE: Block comment line describing behavior or context.
042278| src/lib/search/search-doc-queries.ts:529:  * Get map listings from SearchDoc (denormalized table).
042279| NOTE: Block comment line describing behavior or context.
042280| src/lib/search/search-doc-queries.ts:530:  * Cached with 60s TTL.
042281| NOTE: Block comment line describing behavior or context.
042282| src/lib/search/search-doc-queries.ts:531:  */
042283| NOTE: Block comment line describing behavior or context.
042284| src/lib/search/search-doc-queries.ts:532: export async function getSearchDocMapListings(
042285| NOTE: Implementation detail supporting search page behavior.
042286| src/lib/search/search-doc-queries.ts:533:   params: FilterParams = {},
042287| NOTE: Implementation detail supporting search page behavior.
042288| src/lib/search/search-doc-queries.ts:534: ): Promise<MapListingData[]> {
042289| NOTE: Implementation detail supporting search page behavior.
042290| src/lib/search/search-doc-queries.ts:535:   const cacheKey = createSearchDocMapCacheKey(params);
042291| NOTE: Local declaration used by search logic or UI.
042292| src/lib/search/search-doc-queries.ts:536: 
042293| NOTE: Blank line for visual separation.
042294| src/lib/search/search-doc-queries.ts:537:   const cachedFn = unstable_cache(
042295| NOTE: Local declaration used by search logic or UI.
042296| src/lib/search/search-doc-queries.ts:538:     async () => getSearchDocMapListingsInternal(params),
042297| NOTE: Implementation detail supporting search page behavior.
042298| src/lib/search/search-doc-queries.ts:539:     ["searchdoc-map-listings", cacheKey],
042299| NOTE: Implementation detail supporting search page behavior.
042300| src/lib/search/search-doc-queries.ts:540:     { revalidate: 60 },
042301| NOTE: Implementation detail supporting search page behavior.
042302| src/lib/search/search-doc-queries.ts:541:   );
042303| NOTE: Implementation detail supporting search page behavior.
042304| src/lib/search/search-doc-queries.ts:542: 
042305| NOTE: Blank line for visual separation.
042306| src/lib/search/search-doc-queries.ts:543:   return cachedFn();
042307| NOTE: Return statement for component or helper output.
042308| src/lib/search/search-doc-queries.ts:544: }
042309| NOTE: Implementation detail supporting search page behavior.
042310| src/lib/search/search-doc-queries.ts:545: 
042311| NOTE: Blank line for visual separation.
042312| src/lib/search/search-doc-queries.ts:546: // ============================================
042313| NOTE: Line comment documents intent or constraints.
042314| src/lib/search/search-doc-queries.ts:547: // Paginated Listings Query (SearchDoc)
042315| NOTE: Line comment documents intent or constraints.
042316| src/lib/search/search-doc-queries.ts:548: // ============================================
042317| NOTE: Line comment documents intent or constraints.
042318| src/lib/search/search-doc-queries.ts:549: 
042319| NOTE: Blank line for visual separation.
042320| src/lib/search/search-doc-queries.ts:550: async function getSearchDocListingsPaginatedInternal(
042321| NOTE: Implementation detail supporting search page behavior.
042322| src/lib/search/search-doc-queries.ts:551:   params: FilterParams = {},
042323| NOTE: Implementation detail supporting search page behavior.
042324| src/lib/search/search-doc-queries.ts:552: ): Promise<PaginatedResultHybrid<ListingData>> {
042325| NOTE: Implementation detail supporting search page behavior.
042326| src/lib/search/search-doc-queries.ts:553:   const { sort = "recommended", page = 1, limit = 12, nearMatches } = params;
042327| NOTE: Local declaration used by search logic or UI.
042328| src/lib/search/search-doc-queries.ts:554: 
042329| NOTE: Blank line for visual separation.
042330| src/lib/search/search-doc-queries.ts:555:   try {
042331| NOTE: Implementation detail supporting search page behavior.
042332| src/lib/search/search-doc-queries.ts:556:     const {
042333| NOTE: Local declaration used by search logic or UI.
042334| src/lib/search/search-doc-queries.ts:557:       conditions,
042335| NOTE: Implementation detail supporting search page behavior.
042336| src/lib/search/search-doc-queries.ts:558:       params: queryParams,
042337| NOTE: Implementation detail supporting search page behavior.
042338| src/lib/search/search-doc-queries.ts:559:       paramIndex: startParamIndex,
042339| NOTE: Implementation detail supporting search page behavior.
042340| src/lib/search/search-doc-queries.ts:560:     } = buildSearchDocWhereConditions(params);
042341| NOTE: Implementation detail supporting search page behavior.
042342| src/lib/search/search-doc-queries.ts:561:     const whereClause = conditions.join(" AND ");
042343| NOTE: Local declaration used by search logic or UI.
042344| src/lib/search/search-doc-queries.ts:562: 
042345| NOTE: Blank line for visual separation.
042346| src/lib/search/search-doc-queries.ts:563:     // Build ORDER BY clause based on sort option
042347| NOTE: Line comment documents intent or constraints.
042348| src/lib/search/search-doc-queries.ts:564:     // Uses precomputed recommended_score for efficiency
042349| NOTE: Line comment documents intent or constraints.
042350| src/lib/search/search-doc-queries.ts:565:     // IMPORTANT: All ORDER BY clauses include `id ASC` as final tie-breaker
042351| NOTE: Line comment documents intent or constraints.
042352| src/lib/search/search-doc-queries.ts:566:     // for deterministic keyset pagination
042353| NOTE: Line comment documents intent or constraints.
042354| src/lib/search/search-doc-queries.ts:567:     let orderByClause: string;
042355| NOTE: Local declaration used by search logic or UI.
042356| src/lib/search/search-doc-queries.ts:568:     switch (sort) {
042357| NOTE: Implementation detail supporting search page behavior.
042358| src/lib/search/search-doc-queries.ts:569:       case "price_asc":
042359| NOTE: Implementation detail supporting search page behavior.
042360| src/lib/search/search-doc-queries.ts:570:         orderByClause =
042361| NOTE: Implementation detail supporting search page behavior.
042362| src/lib/search/search-doc-queries.ts:571:           "d.price ASC NULLS LAST, d.listing_created_at DESC, d.id ASC";
042363| NOTE: Implementation detail supporting search page behavior.
042364| src/lib/search/search-doc-queries.ts:572:         break;
042365| NOTE: Implementation detail supporting search page behavior.
042366| src/lib/search/search-doc-queries.ts:573:       case "price_desc":
042367| NOTE: Implementation detail supporting search page behavior.
042368| src/lib/search/search-doc-queries.ts:574:         orderByClause =
042369| NOTE: Implementation detail supporting search page behavior.
042370| src/lib/search/search-doc-queries.ts:575:           "d.price DESC NULLS LAST, d.listing_created_at DESC, d.id ASC";
042371| NOTE: Implementation detail supporting search page behavior.
042372| src/lib/search/search-doc-queries.ts:576:         break;
042373| NOTE: Implementation detail supporting search page behavior.
042374| src/lib/search/search-doc-queries.ts:577:       case "newest":
042375| NOTE: Implementation detail supporting search page behavior.
042376| src/lib/search/search-doc-queries.ts:578:         orderByClause = "d.listing_created_at DESC, d.id ASC";
042377| NOTE: Implementation detail supporting search page behavior.
042378| src/lib/search/search-doc-queries.ts:579:         break;
042379| NOTE: Implementation detail supporting search page behavior.
042380| src/lib/search/search-doc-queries.ts:580:       case "rating":
042381| NOTE: Implementation detail supporting search page behavior.
042382| src/lib/search/search-doc-queries.ts:581:         orderByClause =
042383| NOTE: Implementation detail supporting search page behavior.
042384| src/lib/search/search-doc-queries.ts:582:           "d.avg_rating DESC NULLS LAST, d.review_count DESC, d.listing_created_at DESC, d.id ASC";
042385| NOTE: Implementation detail supporting search page behavior.
042386| src/lib/search/search-doc-queries.ts:583:         break;
042387| NOTE: Implementation detail supporting search page behavior.
042388| src/lib/search/search-doc-queries.ts:584:       case "recommended":
042389| NOTE: Implementation detail supporting search page behavior.
042390| src/lib/search/search-doc-queries.ts:585:       default:
042391| NOTE: Implementation detail supporting search page behavior.
042392| src/lib/search/search-doc-queries.ts:586:         // Use precomputed recommended_score for efficiency
042393| NOTE: Line comment documents intent or constraints.
042394| src/lib/search/search-doc-queries.ts:587:         orderByClause =
042395| NOTE: Implementation detail supporting search page behavior.
042396| src/lib/search/search-doc-queries.ts:588:           "d.recommended_score DESC, d.listing_created_at DESC, d.id ASC";
042397| NOTE: Implementation detail supporting search page behavior.
042398| src/lib/search/search-doc-queries.ts:589:         break;
042399| NOTE: Implementation detail supporting search page behavior.
042400| src/lib/search/search-doc-queries.ts:590:     }
042401| NOTE: Implementation detail supporting search page behavior.
042402| src/lib/search/search-doc-queries.ts:591: 
042403| NOTE: Blank line for visual separation.
042404| src/lib/search/search-doc-queries.ts:592:     // Hybrid pagination: Use getLimitedCount for efficient counting
042405| NOTE: Line comment documents intent or constraints.
042406| src/lib/search/search-doc-queries.ts:593:     const limitedCount = await getSearchDocLimitedCount(params);
042407| NOTE: Local declaration used by search logic or UI.
042408| src/lib/search/search-doc-queries.ts:594: 
042409| NOTE: Blank line for visual separation.
042410| src/lib/search/search-doc-queries.ts:595:     const total = limitedCount;
042411| NOTE: Local declaration used by search logic or UI.
042412| src/lib/search/search-doc-queries.ts:596:     const totalPages =
042413| NOTE: Local declaration used by search logic or UI.
042414| src/lib/search/search-doc-queries.ts:597:       limitedCount !== null ? Math.ceil(limitedCount / limit) : null;
042415| NOTE: Implementation detail supporting search page behavior.
042416| src/lib/search/search-doc-queries.ts:598: 
042417| NOTE: Blank line for visual separation.
042418| src/lib/search/search-doc-queries.ts:599:     // Calculate safe page
042419| NOTE: Line comment documents intent or constraints.
042420| src/lib/search/search-doc-queries.ts:600:     let safePage: number;
042421| NOTE: Local declaration used by search logic or UI.
042422| src/lib/search/search-doc-queries.ts:601:     if (totalPages !== null) {
042423| NOTE: Conditional logic controlling rendering or flow.
042424| src/lib/search/search-doc-queries.ts:602:       safePage = totalPages > 0 ? Math.max(1, Math.min(page, totalPages)) : 1;
042425| NOTE: Implementation detail supporting search page behavior.
042426| src/lib/search/search-doc-queries.ts:603:     } else {
042427| NOTE: Implementation detail supporting search page behavior.
042428| src/lib/search/search-doc-queries.ts:604:       safePage = Math.max(1, page);
042429| NOTE: Implementation detail supporting search page behavior.
042430| src/lib/search/search-doc-queries.ts:605:     }
042431| NOTE: Implementation detail supporting search page behavior.
042432| src/lib/search/search-doc-queries.ts:606:     const offset = (safePage - 1) * limit;
042433| NOTE: Local declaration used by search logic or UI.
042434| src/lib/search/search-doc-queries.ts:607: 
042435| NOTE: Blank line for visual separation.
042436| src/lib/search/search-doc-queries.ts:608:     // Fetch limit+1 items to determine hasNextPage
042437| NOTE: Line comment documents intent or constraints.
042438| src/lib/search/search-doc-queries.ts:609:     const fetchLimit = limit + 1;
042439| NOTE: Local declaration used by search logic or UI.
042440| src/lib/search/search-doc-queries.ts:610:     let paramIndex = startParamIndex;
042441| NOTE: Local declaration used by search logic or UI.
042442| src/lib/search/search-doc-queries.ts:611: 
042443| NOTE: Blank line for visual separation.
042444| src/lib/search/search-doc-queries.ts:612:     // Main query - reads from denormalized SearchDoc
042445| NOTE: Line comment documents intent or constraints.
042446| src/lib/search/search-doc-queries.ts:613:     const dataQuery = `
042447| NOTE: Local declaration used by search logic or UI.
042448| src/lib/search/search-doc-queries.ts:614:       SELECT
042449| NOTE: Implementation detail supporting search page behavior.
042450| src/lib/search/search-doc-queries.ts:615:         d.id,
042451| NOTE: Implementation detail supporting search page behavior.
042452| src/lib/search/search-doc-queries.ts:616:         d.title,
042453| NOTE: Implementation detail supporting search page behavior.
042454| src/lib/search/search-doc-queries.ts:617:         d.description,
042455| NOTE: Implementation detail supporting search page behavior.
042456| src/lib/search/search-doc-queries.ts:618:         d.price,
042457| NOTE: Implementation detail supporting search page behavior.
042458| src/lib/search/search-doc-queries.ts:619:         d.images,
042459| NOTE: Implementation detail supporting search page behavior.
042460| src/lib/search/search-doc-queries.ts:620:         d.available_slots as "availableSlots",
042461| NOTE: Implementation detail supporting search page behavior.
042462| src/lib/search/search-doc-queries.ts:621:         d.total_slots as "totalSlots",
042463| NOTE: Implementation detail supporting search page behavior.
042464| src/lib/search/search-doc-queries.ts:622:         d.amenities,
042465| NOTE: Implementation detail supporting search page behavior.
042466| src/lib/search/search-doc-queries.ts:623:         d.house_rules as "houseRules",
042467| NOTE: Implementation detail supporting search page behavior.
042468| src/lib/search/search-doc-queries.ts:624:         d.household_languages as "householdLanguages",
042469| NOTE: Implementation detail supporting search page behavior.
042470| src/lib/search/search-doc-queries.ts:625:         d.primary_home_language as "primaryHomeLanguage",
042471| NOTE: Implementation detail supporting search page behavior.
042472| src/lib/search/search-doc-queries.ts:626:         d.lease_duration as "leaseDuration",
042473| NOTE: Implementation detail supporting search page behavior.
042474| src/lib/search/search-doc-queries.ts:627:         d.room_type as "roomType",
042475| NOTE: Implementation detail supporting search page behavior.
042476| src/lib/search/search-doc-queries.ts:628:         d.move_in_date as "moveInDate",
042477| NOTE: Implementation detail supporting search page behavior.
042478| src/lib/search/search-doc-queries.ts:629:         d.owner_id as "ownerId",
042479| NOTE: Implementation detail supporting search page behavior.
042480| src/lib/search/search-doc-queries.ts:630:         d.listing_created_at as "createdAt",
042481| NOTE: Implementation detail supporting search page behavior.
042482| src/lib/search/search-doc-queries.ts:631:         d.view_count as "viewCount",
042483| NOTE: Implementation detail supporting search page behavior.
042484| src/lib/search/search-doc-queries.ts:632:         d.address,
042485| NOTE: Implementation detail supporting search page behavior.
042486| src/lib/search/search-doc-queries.ts:633:         d.city,
042487| NOTE: Implementation detail supporting search page behavior.
042488| src/lib/search/search-doc-queries.ts:634:         d.state,
042489| NOTE: Implementation detail supporting search page behavior.
042490| src/lib/search/search-doc-queries.ts:635:         d.zip,
042491| NOTE: Implementation detail supporting search page behavior.
042492| src/lib/search/search-doc-queries.ts:636:         d.lat,
042493| NOTE: Implementation detail supporting search page behavior.
042494| src/lib/search/search-doc-queries.ts:637:         d.lng,
042495| NOTE: Implementation detail supporting search page behavior.
042496| src/lib/search/search-doc-queries.ts:638:         d.avg_rating as "avgRating",
042497| NOTE: Implementation detail supporting search page behavior.
042498| src/lib/search/search-doc-queries.ts:639:         d.review_count as "reviewCount"
042499| NOTE: Implementation detail supporting search page behavior.
042500| src/lib/search/search-doc-queries.ts:640:       FROM listing_search_docs d
042501| NOTE: Implementation detail supporting search page behavior.
042502| src/lib/search/search-doc-queries.ts:641:       WHERE ${whereClause}
042503| NOTE: Implementation detail supporting search page behavior.
042504| src/lib/search/search-doc-queries.ts:642:       ORDER BY ${orderByClause}
042505| NOTE: Implementation detail supporting search page behavior.
042506| src/lib/search/search-doc-queries.ts:643:       LIMIT $${paramIndex++} OFFSET $${paramIndex++}
042507| NOTE: Implementation detail supporting search page behavior.
042508| src/lib/search/search-doc-queries.ts:644:     `;
042509| NOTE: Implementation detail supporting search page behavior.
042510| src/lib/search/search-doc-queries.ts:645: 
042511| NOTE: Blank line for visual separation.
042512| src/lib/search/search-doc-queries.ts:646:     const dataParams = [...queryParams, fetchLimit, offset];
042513| NOTE: Local declaration used by search logic or UI.
042514| src/lib/search/search-doc-queries.ts:647: 
042515| NOTE: Blank line for visual separation.
042516| src/lib/search/search-doc-queries.ts:648:     const listings = await prisma.$queryRawUnsafe<any[]>(
042517| NOTE: Local declaration used by search logic or UI.
042518| src/lib/search/search-doc-queries.ts:649:       dataQuery,
042519| NOTE: Implementation detail supporting search page behavior.
042520| src/lib/search/search-doc-queries.ts:650:       ...dataParams,
042521| NOTE: Implementation detail supporting search page behavior.
042522| src/lib/search/search-doc-queries.ts:651:     );
042523| NOTE: Implementation detail supporting search page behavior.
042524| src/lib/search/search-doc-queries.ts:652: 
042525| NOTE: Blank line for visual separation.
042526| src/lib/search/search-doc-queries.ts:653:     // Map results to ListingData
042527| NOTE: Line comment documents intent or constraints.
042528| src/lib/search/search-doc-queries.ts:654:     const results = listings.map((l) => ({
042529| NOTE: Local declaration used by search logic or UI.
042530| src/lib/search/search-doc-queries.ts:655:       id: l.id,
042531| NOTE: Implementation detail supporting search page behavior.
042532| src/lib/search/search-doc-queries.ts:656:       title: l.title,
042533| NOTE: Implementation detail supporting search page behavior.
042534| src/lib/search/search-doc-queries.ts:657:       description: l.description,
042535| NOTE: Implementation detail supporting search page behavior.
042536| src/lib/search/search-doc-queries.ts:658:       price: Number(l.price),
042537| NOTE: Implementation detail supporting search page behavior.
042538| src/lib/search/search-doc-queries.ts:659:       images: l.images || [],
042539| NOTE: Implementation detail supporting search page behavior.
042540| src/lib/search/search-doc-queries.ts:660:       availableSlots: l.availableSlots,
042541| NOTE: Implementation detail supporting search page behavior.
042542| src/lib/search/search-doc-queries.ts:661:       totalSlots: l.totalSlots,
042543| NOTE: Implementation detail supporting search page behavior.
042544| src/lib/search/search-doc-queries.ts:662:       amenities: l.amenities || [],
042545| NOTE: Implementation detail supporting search page behavior.
042546| src/lib/search/search-doc-queries.ts:663:       houseRules: l.houseRules || [],
042547| NOTE: Implementation detail supporting search page behavior.
042548| src/lib/search/search-doc-queries.ts:664:       householdLanguages: l.householdLanguages || [],
042549| NOTE: Implementation detail supporting search page behavior.
042550| src/lib/search/search-doc-queries.ts:665:       primaryHomeLanguage: l.primaryHomeLanguage,
042551| NOTE: Implementation detail supporting search page behavior.
042552| src/lib/search/search-doc-queries.ts:666:       leaseDuration: l.leaseDuration,
042553| NOTE: Implementation detail supporting search page behavior.
042554| src/lib/search/search-doc-queries.ts:667:       roomType: l.roomType,
042555| NOTE: Implementation detail supporting search page behavior.
042556| src/lib/search/search-doc-queries.ts:668:       moveInDate: l.moveInDate ? new Date(l.moveInDate) : undefined,
042557| NOTE: Implementation detail supporting search page behavior.
042558| src/lib/search/search-doc-queries.ts:669:       ownerId: l.ownerId,
042559| NOTE: Implementation detail supporting search page behavior.
042560| src/lib/search/search-doc-queries.ts:670:       createdAt: l.createdAt ? new Date(l.createdAt) : new Date(),
042561| NOTE: Implementation detail supporting search page behavior.
042562| src/lib/search/search-doc-queries.ts:671:       viewCount: Number(l.viewCount) || 0,
042563| NOTE: Implementation detail supporting search page behavior.
042564| src/lib/search/search-doc-queries.ts:672:       avgRating: Number(l.avgRating) || 0,
042565| NOTE: Implementation detail supporting search page behavior.
042566| src/lib/search/search-doc-queries.ts:673:       reviewCount: Number(l.reviewCount) || 0,
042567| NOTE: Implementation detail supporting search page behavior.
042568| src/lib/search/search-doc-queries.ts:674:       location: {
042569| NOTE: Implementation detail supporting search page behavior.
042570| src/lib/search/search-doc-queries.ts:675:         address: l.address,
042571| NOTE: Implementation detail supporting search page behavior.
042572| src/lib/search/search-doc-queries.ts:676:         city: l.city,
042573| NOTE: Implementation detail supporting search page behavior.
042574| src/lib/search/search-doc-queries.ts:677:         state: l.state,
042575| NOTE: Implementation detail supporting search page behavior.
042576| src/lib/search/search-doc-queries.ts:678:         zip: l.zip,
042577| NOTE: Implementation detail supporting search page behavior.
042578| src/lib/search/search-doc-queries.ts:679:         lat: Number(l.lat) || 0,
042579| NOTE: Implementation detail supporting search page behavior.
042580| src/lib/search/search-doc-queries.ts:680:         lng: Number(l.lng) || 0,
042581| NOTE: Implementation detail supporting search page behavior.
042582| src/lib/search/search-doc-queries.ts:681:       },
042583| NOTE: Implementation detail supporting search page behavior.
042584| src/lib/search/search-doc-queries.ts:682:     }));
042585| NOTE: Implementation detail supporting search page behavior.
042586| src/lib/search/search-doc-queries.ts:683: 
042587| NOTE: Blank line for visual separation.
042588| src/lib/search/search-doc-queries.ts:684:     // Determine hasNextPage using limit+1 pattern
042589| NOTE: Line comment documents intent or constraints.
042590| src/lib/search/search-doc-queries.ts:685:     const hasNextPage = results.length > limit;
042591| NOTE: Local declaration used by search logic or UI.
042592| src/lib/search/search-doc-queries.ts:686: 
042593| NOTE: Blank line for visual separation.
042594| src/lib/search/search-doc-queries.ts:687:     // Only return `limit` items
042595| NOTE: Line comment documents intent or constraints.
042596| src/lib/search/search-doc-queries.ts:688:     let items: ListingData[] = hasNextPage ? results.slice(0, limit) : results;
042597| NOTE: Local declaration used by search logic or UI.
042598| src/lib/search/search-doc-queries.ts:689: 
042599| NOTE: Blank line for visual separation.
042600| src/lib/search/search-doc-queries.ts:690:     // Near-match expansion: if enabled and low results on page 1, fetch near matches
042601| NOTE: Line comment documents intent or constraints.
042602| src/lib/search/search-doc-queries.ts:691:     let nearMatchCount = 0;
042603| NOTE: Local declaration used by search logic or UI.
042604| src/lib/search/search-doc-queries.ts:692:     let nearMatchExpansion: string | undefined;
042605| NOTE: Local declaration used by search logic or UI.
042606| src/lib/search/search-doc-queries.ts:693: 
042607| NOTE: Blank line for visual separation.
042608| src/lib/search/search-doc-queries.ts:694:     if (
042609| NOTE: Conditional logic controlling rendering or flow.
042610| src/lib/search/search-doc-queries.ts:695:       nearMatches &&
042611| NOTE: Implementation detail supporting search page behavior.
042612| src/lib/search/search-doc-queries.ts:696:       items.length < LOW_RESULTS_THRESHOLD &&
042613| NOTE: Implementation detail supporting search page behavior.
042614| src/lib/search/search-doc-queries.ts:697:       items.length > 0 &&
042615| NOTE: Implementation detail supporting search page behavior.
042616| src/lib/search/search-doc-queries.ts:698:       safePage === 1
042617| NOTE: Implementation detail supporting search page behavior.
042618| src/lib/search/search-doc-queries.ts:699:     ) {
042619| NOTE: Implementation detail supporting search page behavior.
042620| src/lib/search/search-doc-queries.ts:700:       const expansion = expandFiltersForNearMatches(params);
042621| NOTE: Local declaration used by search logic or UI.
042622| src/lib/search/search-doc-queries.ts:701: 
042623| NOTE: Blank line for visual separation.
042624| src/lib/search/search-doc-queries.ts:702:       if (expansion.expandedDimension !== null) {
042625| NOTE: Conditional logic controlling rendering or flow.
042626| src/lib/search/search-doc-queries.ts:703:         nearMatchExpansion = expansion.expansionDescription ?? undefined;
042627| NOTE: Implementation detail supporting search page behavior.
042628| src/lib/search/search-doc-queries.ts:704: 
042629| NOTE: Blank line for visual separation.
042630| src/lib/search/search-doc-queries.ts:705:         // Run expanded query (without nearMatches flag to prevent recursion)
042631| NOTE: Line comment documents intent or constraints.
042632| src/lib/search/search-doc-queries.ts:706:         const expandedResult = await getSearchDocListingsPaginatedInternal({
042633| NOTE: Local declaration used by search logic or UI.
042634| src/lib/search/search-doc-queries.ts:707:           ...expansion.expanded,
042635| NOTE: Implementation detail supporting search page behavior.
042636| src/lib/search/search-doc-queries.ts:708:           nearMatches: false,
042637| NOTE: Implementation detail supporting search page behavior.
042638| src/lib/search/search-doc-queries.ts:709:           page: 1,
042639| NOTE: Implementation detail supporting search page behavior.
042640| src/lib/search/search-doc-queries.ts:710:           limit: LOW_RESULTS_THRESHOLD * 2,
042641| NOTE: Implementation detail supporting search page behavior.
042642| src/lib/search/search-doc-queries.ts:711:         });
042643| NOTE: Implementation detail supporting search page behavior.
042644| src/lib/search/search-doc-queries.ts:712: 
042645| NOTE: Blank line for visual separation.
042646| src/lib/search/search-doc-queries.ts:713:         // Get IDs of exact matches to dedupe
042647| NOTE: Line comment documents intent or constraints.
042648| src/lib/search/search-doc-queries.ts:714:         const exactIds = new Set(items.map((item) => item.id));
042649| NOTE: Local declaration used by search logic or UI.
042650| src/lib/search/search-doc-queries.ts:715: 
042651| NOTE: Blank line for visual separation.
042652| src/lib/search/search-doc-queries.ts:716:         // Filter to only near matches and tag them
042653| NOTE: Line comment documents intent or constraints.
042654| src/lib/search/search-doc-queries.ts:717:         const nearMatchItems = expandedResult.items
042655| NOTE: Local declaration used by search logic or UI.
042656| src/lib/search/search-doc-queries.ts:718:           .filter((item) => !exactIds.has(item.id))
042657| NOTE: Implementation detail supporting search page behavior.
042658| src/lib/search/search-doc-queries.ts:719:           .slice(0, LOW_RESULTS_THRESHOLD)
042659| NOTE: Implementation detail supporting search page behavior.
042660| src/lib/search/search-doc-queries.ts:720:           .map((item) => {
042661| NOTE: Implementation detail supporting search page behavior.
042662| src/lib/search/search-doc-queries.ts:721:             const availableFromStr = item.moveInDate
042663| NOTE: Local declaration used by search logic or UI.
042664| src/lib/search/search-doc-queries.ts:722:               ? item.moveInDate.toISOString().split("T")[0]
042665| NOTE: Implementation detail supporting search page behavior.
042666| src/lib/search/search-doc-queries.ts:723:               : null;
042667| NOTE: Implementation detail supporting search page behavior.
042668| src/lib/search/search-doc-queries.ts:724:             const isNearMatchResult = isNearMatch(
042669| NOTE: Local declaration used by search logic or UI.
042670| src/lib/search/search-doc-queries.ts:725:               { price: item.price, available_from: availableFromStr },
042671| NOTE: Implementation detail supporting search page behavior.
042672| src/lib/search/search-doc-queries.ts:726:               params,
042673| NOTE: Implementation detail supporting search page behavior.
042674| src/lib/search/search-doc-queries.ts:727:               expansion.expandedDimension,
042675| NOTE: Implementation detail supporting search page behavior.
042676| src/lib/search/search-doc-queries.ts:728:             );
042677| NOTE: Implementation detail supporting search page behavior.
042678| src/lib/search/search-doc-queries.ts:729:             return {
042679| NOTE: Return statement for component or helper output.
042680| src/lib/search/search-doc-queries.ts:730:               ...item,
042681| NOTE: Implementation detail supporting search page behavior.
042682| src/lib/search/search-doc-queries.ts:731:               isNearMatch: isNearMatchResult,
042683| NOTE: Implementation detail supporting search page behavior.
042684| src/lib/search/search-doc-queries.ts:732:             };
042685| NOTE: Implementation detail supporting search page behavior.
042686| src/lib/search/search-doc-queries.ts:733:           })
042687| NOTE: Implementation detail supporting search page behavior.
042688| src/lib/search/search-doc-queries.ts:734:           .filter((item) => item.isNearMatch);
042689| NOTE: Implementation detail supporting search page behavior.
042690| src/lib/search/search-doc-queries.ts:735: 
042691| NOTE: Blank line for visual separation.
042692| src/lib/search/search-doc-queries.ts:736:         nearMatchCount = nearMatchItems.length;
042693| NOTE: Implementation detail supporting search page behavior.
042694| src/lib/search/search-doc-queries.ts:737: 
042695| NOTE: Blank line for visual separation.
042696| src/lib/search/search-doc-queries.ts:738:         // Merge results: exact matches first, then near matches
042697| NOTE: Line comment documents intent or constraints.
042698| src/lib/search/search-doc-queries.ts:739:         items = [...items, ...nearMatchItems];
042699| NOTE: Implementation detail supporting search page behavior.
042700| src/lib/search/search-doc-queries.ts:740:       }
042701| NOTE: Implementation detail supporting search page behavior.
042702| src/lib/search/search-doc-queries.ts:741:     }
042703| NOTE: Implementation detail supporting search page behavior.
042704| src/lib/search/search-doc-queries.ts:742: 
042705| NOTE: Blank line for visual separation.
042706| src/lib/search/search-doc-queries.ts:743:     return {
042707| NOTE: Return statement for component or helper output.
042708| src/lib/search/search-doc-queries.ts:744:       items,
042709| NOTE: Implementation detail supporting search page behavior.
042710| src/lib/search/search-doc-queries.ts:745:       total,
042711| NOTE: Implementation detail supporting search page behavior.
042712| src/lib/search/search-doc-queries.ts:746:       totalPages,
042713| NOTE: Implementation detail supporting search page behavior.
042714| src/lib/search/search-doc-queries.ts:747:       hasNextPage,
042715| NOTE: Implementation detail supporting search page behavior.
042716| src/lib/search/search-doc-queries.ts:748:       hasPrevPage: safePage > 1,
042717| NOTE: Implementation detail supporting search page behavior.
042718| src/lib/search/search-doc-queries.ts:749:       page: safePage,
042719| NOTE: Implementation detail supporting search page behavior.
042720| src/lib/search/search-doc-queries.ts:750:       limit,
042721| NOTE: Implementation detail supporting search page behavior.
042722| src/lib/search/search-doc-queries.ts:751:       nearMatchCount: nearMatchCount > 0 ? nearMatchCount : undefined,
042723| NOTE: Implementation detail supporting search page behavior.
042724| src/lib/search/search-doc-queries.ts:752:       nearMatchExpansion,
042725| NOTE: Implementation detail supporting search page behavior.
042726| src/lib/search/search-doc-queries.ts:753:     };
042727| NOTE: Implementation detail supporting search page behavior.
042728| src/lib/search/search-doc-queries.ts:754:   } catch (error) {
042729| NOTE: Implementation detail supporting search page behavior.
042730| src/lib/search/search-doc-queries.ts:755:     const dataError = wrapDatabaseError(error, "getSearchDocListingsPaginated");
042731| NOTE: Local declaration used by search logic or UI.
042732| src/lib/search/search-doc-queries.ts:756:     dataError.log({
042733| NOTE: Implementation detail supporting search page behavior.
042734| src/lib/search/search-doc-queries.ts:757:       operation: "getSearchDocListingsPaginated",
042735| NOTE: Implementation detail supporting search page behavior.
042736| src/lib/search/search-doc-queries.ts:758:       hasQuery: !!params.query,
042737| NOTE: Implementation detail supporting search page behavior.
042738| src/lib/search/search-doc-queries.ts:759:       hasBounds: !!params.bounds,
042739| NOTE: Implementation detail supporting search page behavior.
042740| src/lib/search/search-doc-queries.ts:760:       page: params.page,
042741| NOTE: Implementation detail supporting search page behavior.
042742| src/lib/search/search-doc-queries.ts:761:       sortOption: params.sort,
042743| NOTE: Implementation detail supporting search page behavior.
042744| src/lib/search/search-doc-queries.ts:762:     });
042745| NOTE: Implementation detail supporting search page behavior.
042746| src/lib/search/search-doc-queries.ts:763:     throw dataError;
042747| NOTE: Implementation detail supporting search page behavior.
042748| src/lib/search/search-doc-queries.ts:764:   }
042749| NOTE: Implementation detail supporting search page behavior.
042750| src/lib/search/search-doc-queries.ts:765: }
042751| NOTE: Implementation detail supporting search page behavior.
042752| src/lib/search/search-doc-queries.ts:766: 
042753| NOTE: Blank line for visual separation.
042754| src/lib/search/search-doc-queries.ts:767: /**
042755| NOTE: Block comment line describing behavior or context.
042756| src/lib/search/search-doc-queries.ts:768:  * Get paginated listings from SearchDoc (denormalized table).
042757| NOTE: Block comment line describing behavior or context.
042758| src/lib/search/search-doc-queries.ts:769:  * Cached with 60s TTL. Uses hybrid pagination for cost efficiency.
042759| NOTE: Block comment line describing behavior or context.
042760| src/lib/search/search-doc-queries.ts:770:  */
042761| NOTE: Block comment line describing behavior or context.
042762| src/lib/search/search-doc-queries.ts:771: export async function getSearchDocListingsPaginated(
042763| NOTE: Implementation detail supporting search page behavior.
042764| src/lib/search/search-doc-queries.ts:772:   params: FilterParams = {},
042765| NOTE: Implementation detail supporting search page behavior.
042766| src/lib/search/search-doc-queries.ts:773: ): Promise<PaginatedResultHybrid<ListingData>> {
042767| NOTE: Implementation detail supporting search page behavior.
042768| src/lib/search/search-doc-queries.ts:774:   const cacheKey = createSearchDocListCacheKey(params);
042769| NOTE: Local declaration used by search logic or UI.
042770| src/lib/search/search-doc-queries.ts:775: 
042771| NOTE: Blank line for visual separation.
042772| src/lib/search/search-doc-queries.ts:776:   const cachedFn = unstable_cache(
042773| NOTE: Local declaration used by search logic or UI.
042774| src/lib/search/search-doc-queries.ts:777:     async () => getSearchDocListingsPaginatedInternal(params),
042775| NOTE: Implementation detail supporting search page behavior.
042776| src/lib/search/search-doc-queries.ts:778:     ["searchdoc-listings-paginated", cacheKey],
042777| NOTE: Implementation detail supporting search page behavior.
042778| src/lib/search/search-doc-queries.ts:779:     { revalidate: 60 },
042779| NOTE: Implementation detail supporting search page behavior.
042780| src/lib/search/search-doc-queries.ts:780:   );
042781| NOTE: Implementation detail supporting search page behavior.
042782| src/lib/search/search-doc-queries.ts:781: 
042783| NOTE: Blank line for visual separation.
042784| src/lib/search/search-doc-queries.ts:782:   return cachedFn();
042785| NOTE: Return statement for component or helper output.
042786| src/lib/search/search-doc-queries.ts:783: }
042787| NOTE: Implementation detail supporting search page behavior.
042788| src/lib/search/search-doc-queries.ts:784: 
042789| NOTE: Blank line for visual separation.
042790| src/lib/search/search-doc-queries.ts:785: // ============================================
042791| NOTE: Line comment documents intent or constraints.
042792| src/lib/search/search-doc-queries.ts:786: // Keyset Paginated Listings Query (SearchDoc)
042793| NOTE: Line comment documents intent or constraints.
042794| src/lib/search/search-doc-queries.ts:787: // ============================================
042795| NOTE: Line comment documents intent or constraints.
042796| src/lib/search/search-doc-queries.ts:788: 
042797| NOTE: Blank line for visual separation.
042798| src/lib/search/search-doc-queries.ts:789: /**
042799| NOTE: Block comment line describing behavior or context.
042800| src/lib/search/search-doc-queries.ts:790:  * Extended result type with keyset cursor support.
042801| NOTE: Block comment line describing behavior or context.
042802| src/lib/search/search-doc-queries.ts:791:  * Used by v2 API for stable cursor-based pagination.
042803| NOTE: Block comment line describing behavior or context.
042804| src/lib/search/search-doc-queries.ts:792:  */
042805| NOTE: Block comment line describing behavior or context.
042806| src/lib/search/search-doc-queries.ts:793: export interface KeysetPaginatedResult<T> extends PaginatedResultHybrid<T> {
042807| NOTE: Implementation detail supporting search page behavior.
042808| src/lib/search/search-doc-queries.ts:794:   nextCursor: string | null;
042809| NOTE: Implementation detail supporting search page behavior.
042810| src/lib/search/search-doc-queries.ts:795: }
042811| NOTE: Implementation detail supporting search page behavior.
042812| src/lib/search/search-doc-queries.ts:796: 
042813| NOTE: Blank line for visual separation.
042814| src/lib/search/search-doc-queries.ts:797: /**
042815| NOTE: Block comment line describing behavior or context.
042816| src/lib/search/search-doc-queries.ts:798:  * Get paginated listings using keyset cursor pagination.
042817| NOTE: Block comment line describing behavior or context.
042818| src/lib/search/search-doc-queries.ts:799:  *
042819| NOTE: Block comment line describing behavior or context.
042820| src/lib/search/search-doc-queries.ts:800:  * When cursor is provided, uses keyset WHERE clause instead of OFFSET
042821| NOTE: Block comment line describing behavior or context.
042822| src/lib/search/search-doc-queries.ts:801:  * for stable pagination that prevents result drift.
042823| NOTE: Block comment line describing behavior or context.
042824| src/lib/search/search-doc-queries.ts:802:  *
042825| NOTE: Block comment line describing behavior or context.
042826| src/lib/search/search-doc-queries.ts:803:  * Feature flag: ENABLE_SEARCH_KEYSET=true
042827| NOTE: Block comment line describing behavior or context.
042828| src/lib/search/search-doc-queries.ts:804:  *
042829| NOTE: Block comment line describing behavior or context.
042830| src/lib/search/search-doc-queries.ts:805:  * @param params - Filter parameters
042831| NOTE: Block comment line describing behavior or context.
042832| src/lib/search/search-doc-queries.ts:806:  * @param cursor - Optional decoded keyset cursor from previous page
042833| NOTE: Block comment line describing behavior or context.
042834| src/lib/search/search-doc-queries.ts:807:  * @returns Paginated results with nextCursor for next page
042835| NOTE: Block comment line describing behavior or context.
042836| src/lib/search/search-doc-queries.ts:808:  */
042837| NOTE: Block comment line describing behavior or context.
042838| src/lib/search/search-doc-queries.ts:809: export async function getSearchDocListingsWithKeyset(
042839| NOTE: Implementation detail supporting search page behavior.
042840| src/lib/search/search-doc-queries.ts:810:   params: FilterParams = {},
042841| NOTE: Implementation detail supporting search page behavior.
042842| src/lib/search/search-doc-queries.ts:811:   cursor: KeysetCursor | null = null,
042843| NOTE: Implementation detail supporting search page behavior.
042844| src/lib/search/search-doc-queries.ts:812: ): Promise<KeysetPaginatedResult<ListingData>> {
042845| NOTE: Implementation detail supporting search page behavior.
042846| src/lib/search/search-doc-queries.ts:813:   const { sort = "recommended", limit = 12 } = params;
042847| NOTE: Local declaration used by search logic or UI.
042848| src/lib/search/search-doc-queries.ts:814:   const sortOption = sort as SortOption;
042849| NOTE: Local declaration used by search logic or UI.
042850| src/lib/search/search-doc-queries.ts:815: 
042851| NOTE: Blank line for visual separation.
042852| src/lib/search/search-doc-queries.ts:816:   // If keyset is disabled or no cursor, use offset-based pagination
042853| NOTE: Line comment documents intent or constraints.
042854| src/lib/search/search-doc-queries.ts:817:   if (!features.searchKeyset || !cursor) {
042855| NOTE: Conditional logic controlling rendering or flow.
042856| src/lib/search/search-doc-queries.ts:818:     const result = await getSearchDocListingsPaginated(params);
042857| NOTE: Local declaration used by search logic or UI.
042858| src/lib/search/search-doc-queries.ts:819: 
042859| NOTE: Blank line for visual separation.
042860| src/lib/search/search-doc-queries.ts:820:     // Note: For offset-based fallback, we don't have raw row data to build keyset cursor
042861| NOTE: Line comment documents intent or constraints.
042862| src/lib/search/search-doc-queries.ts:821:     // Return null and the service layer will fall back to legacy cursor format
042863| NOTE: Line comment documents intent or constraints.
042864| src/lib/search/search-doc-queries.ts:822:     return {
042865| NOTE: Return statement for component or helper output.
042866| src/lib/search/search-doc-queries.ts:823:       ...result,
042867| NOTE: Implementation detail supporting search page behavior.
042868| src/lib/search/search-doc-queries.ts:824:       nextCursor: null,
042869| NOTE: Implementation detail supporting search page behavior.
042870| src/lib/search/search-doc-queries.ts:825:     };
042871| NOTE: Implementation detail supporting search page behavior.
042872| src/lib/search/search-doc-queries.ts:826:   }
042873| NOTE: Implementation detail supporting search page behavior.
042874| src/lib/search/search-doc-queries.ts:827: 
042875| NOTE: Blank line for visual separation.
042876| src/lib/search/search-doc-queries.ts:828:   // Keyset pagination is enabled and we have a cursor
042877| NOTE: Line comment documents intent or constraints.
042878| src/lib/search/search-doc-queries.ts:829:   try {
042879| NOTE: Implementation detail supporting search page behavior.
042880| src/lib/search/search-doc-queries.ts:830:     const {
042881| NOTE: Local declaration used by search logic or UI.
042882| src/lib/search/search-doc-queries.ts:831:       conditions,
042883| NOTE: Implementation detail supporting search page behavior.
042884| src/lib/search/search-doc-queries.ts:832:       params: queryParams,
042885| NOTE: Implementation detail supporting search page behavior.
042886| src/lib/search/search-doc-queries.ts:833:       paramIndex: startParamIndex,
042887| NOTE: Implementation detail supporting search page behavior.
042888| src/lib/search/search-doc-queries.ts:834:     } = buildSearchDocWhereConditions(params);
042889| NOTE: Implementation detail supporting search page behavior.
042890| src/lib/search/search-doc-queries.ts:835: 
042891| NOTE: Blank line for visual separation.
042892| src/lib/search/search-doc-queries.ts:836:     // Add keyset WHERE clause
042893| NOTE: Line comment documents intent or constraints.
042894| src/lib/search/search-doc-queries.ts:837:     const keysetResult = buildKeysetWhereClause(
042895| NOTE: Local declaration used by search logic or UI.
042896| src/lib/search/search-doc-queries.ts:838:       cursor,
042897| NOTE: Implementation detail supporting search page behavior.
042898| src/lib/search/search-doc-queries.ts:839:       sortOption,
042899| NOTE: Implementation detail supporting search page behavior.
042900| src/lib/search/search-doc-queries.ts:840:       startParamIndex,
042901| NOTE: Implementation detail supporting search page behavior.
042902| src/lib/search/search-doc-queries.ts:841:     );
042903| NOTE: Implementation detail supporting search page behavior.
042904| src/lib/search/search-doc-queries.ts:842:     conditions.push(keysetResult.clause);
042905| NOTE: Implementation detail supporting search page behavior.
042906| src/lib/search/search-doc-queries.ts:843:     const allParams = [...queryParams, ...keysetResult.params];
042907| NOTE: Local declaration used by search logic or UI.
042908| src/lib/search/search-doc-queries.ts:844:     let paramIndex = keysetResult.nextParamIndex;
042909| NOTE: Local declaration used by search logic or UI.
042910| src/lib/search/search-doc-queries.ts:845: 
042911| NOTE: Blank line for visual separation.
042912| src/lib/search/search-doc-queries.ts:846:     const whereClause = conditions.join(" AND ");
042913| NOTE: Local declaration used by search logic or UI.
042914| src/lib/search/search-doc-queries.ts:847: 
042915| NOTE: Blank line for visual separation.
042916| src/lib/search/search-doc-queries.ts:848:     // Build ORDER BY clause (same as offset-based)
042917| NOTE: Line comment documents intent or constraints.
042918| src/lib/search/search-doc-queries.ts:849:     let orderByClause: string;
042919| NOTE: Local declaration used by search logic or UI.
042920| src/lib/search/search-doc-queries.ts:850:     switch (sortOption) {
042921| NOTE: Implementation detail supporting search page behavior.
042922| src/lib/search/search-doc-queries.ts:851:       case "price_asc":
042923| NOTE: Implementation detail supporting search page behavior.
042924| src/lib/search/search-doc-queries.ts:852:         orderByClause =
042925| NOTE: Implementation detail supporting search page behavior.
042926| src/lib/search/search-doc-queries.ts:853:           "d.price ASC NULLS LAST, d.listing_created_at DESC, d.id ASC";
042927| NOTE: Implementation detail supporting search page behavior.
042928| src/lib/search/search-doc-queries.ts:854:         break;
042929| NOTE: Implementation detail supporting search page behavior.
042930| src/lib/search/search-doc-queries.ts:855:       case "price_desc":
042931| NOTE: Implementation detail supporting search page behavior.
042932| src/lib/search/search-doc-queries.ts:856:         orderByClause =
042933| NOTE: Implementation detail supporting search page behavior.
042934| src/lib/search/search-doc-queries.ts:857:           "d.price DESC NULLS LAST, d.listing_created_at DESC, d.id ASC";
042935| NOTE: Implementation detail supporting search page behavior.
042936| src/lib/search/search-doc-queries.ts:858:         break;
042937| NOTE: Implementation detail supporting search page behavior.
042938| src/lib/search/search-doc-queries.ts:859:       case "newest":
042939| NOTE: Implementation detail supporting search page behavior.
042940| src/lib/search/search-doc-queries.ts:860:         orderByClause = "d.listing_created_at DESC, d.id ASC";
042941| NOTE: Implementation detail supporting search page behavior.
042942| src/lib/search/search-doc-queries.ts:861:         break;
042943| NOTE: Implementation detail supporting search page behavior.
042944| src/lib/search/search-doc-queries.ts:862:       case "rating":
042945| NOTE: Implementation detail supporting search page behavior.
042946| src/lib/search/search-doc-queries.ts:863:         orderByClause =
042947| NOTE: Implementation detail supporting search page behavior.
042948| src/lib/search/search-doc-queries.ts:864:           "d.avg_rating DESC NULLS LAST, d.review_count DESC, d.listing_created_at DESC, d.id ASC";
042949| NOTE: Implementation detail supporting search page behavior.
042950| src/lib/search/search-doc-queries.ts:865:         break;
042951| NOTE: Implementation detail supporting search page behavior.
042952| src/lib/search/search-doc-queries.ts:866:       case "recommended":
042953| NOTE: Implementation detail supporting search page behavior.
042954| src/lib/search/search-doc-queries.ts:867:       default:
042955| NOTE: Implementation detail supporting search page behavior.
042956| src/lib/search/search-doc-queries.ts:868:         orderByClause =
042957| NOTE: Implementation detail supporting search page behavior.
042958| src/lib/search/search-doc-queries.ts:869:           "d.recommended_score DESC, d.listing_created_at DESC, d.id ASC";
042959| NOTE: Implementation detail supporting search page behavior.
042960| src/lib/search/search-doc-queries.ts:870:         break;
042961| NOTE: Implementation detail supporting search page behavior.
042962| src/lib/search/search-doc-queries.ts:871:     }
042963| NOTE: Implementation detail supporting search page behavior.
042964| src/lib/search/search-doc-queries.ts:872: 
042965| NOTE: Blank line for visual separation.
042966| src/lib/search/search-doc-queries.ts:873:     // Fetch limit+1 items to determine hasNextPage
042967| NOTE: Line comment documents intent or constraints.
042968| src/lib/search/search-doc-queries.ts:874:     const fetchLimit = limit + 1;
042969| NOTE: Local declaration used by search logic or UI.
042970| src/lib/search/search-doc-queries.ts:875: 
042971| NOTE: Blank line for visual separation.
042972| src/lib/search/search-doc-queries.ts:876:     // Main query with cursor row data columns for building next cursor
042973| NOTE: Line comment documents intent or constraints.
042974| src/lib/search/search-doc-queries.ts:877:     // Note: Numeric values are cast to text to preserve precision for cursor encoding
042975| NOTE: Line comment documents intent or constraints.
042976| src/lib/search/search-doc-queries.ts:878:     const dataQuery = `
042977| NOTE: Local declaration used by search logic or UI.
042978| src/lib/search/search-doc-queries.ts:879:       SELECT
042979| NOTE: Implementation detail supporting search page behavior.
042980| src/lib/search/search-doc-queries.ts:880:         d.id,
042981| NOTE: Implementation detail supporting search page behavior.
042982| src/lib/search/search-doc-queries.ts:881:         d.title,
042983| NOTE: Implementation detail supporting search page behavior.
042984| src/lib/search/search-doc-queries.ts:882:         d.description,
042985| NOTE: Implementation detail supporting search page behavior.
042986| src/lib/search/search-doc-queries.ts:883:         d.price,
042987| NOTE: Implementation detail supporting search page behavior.
042988| src/lib/search/search-doc-queries.ts:884:         d.images,
042989| NOTE: Implementation detail supporting search page behavior.
042990| src/lib/search/search-doc-queries.ts:885:         d.available_slots as "availableSlots",
042991| NOTE: Implementation detail supporting search page behavior.
042992| src/lib/search/search-doc-queries.ts:886:         d.total_slots as "totalSlots",
042993| NOTE: Implementation detail supporting search page behavior.
042994| src/lib/search/search-doc-queries.ts:887:         d.amenities,
042995| NOTE: Implementation detail supporting search page behavior.
042996| src/lib/search/search-doc-queries.ts:888:         d.house_rules as "houseRules",
042997| NOTE: Implementation detail supporting search page behavior.
042998| src/lib/search/search-doc-queries.ts:889:         d.household_languages as "householdLanguages",
042999| NOTE: Implementation detail supporting search page behavior.
043000| src/lib/search/search-doc-queries.ts:890:         d.primary_home_language as "primaryHomeLanguage",
043001| NOTE: Implementation detail supporting search page behavior.
043002| src/lib/search/search-doc-queries.ts:891:         d.lease_duration as "leaseDuration",
043003| NOTE: Implementation detail supporting search page behavior.
043004| src/lib/search/search-doc-queries.ts:892:         d.room_type as "roomType",
043005| NOTE: Implementation detail supporting search page behavior.
043006| src/lib/search/search-doc-queries.ts:893:         d.move_in_date as "moveInDate",
043007| NOTE: Implementation detail supporting search page behavior.
043008| src/lib/search/search-doc-queries.ts:894:         d.owner_id as "ownerId",
043009| NOTE: Implementation detail supporting search page behavior.
043010| src/lib/search/search-doc-queries.ts:895:         d.listing_created_at as "createdAt",
043011| NOTE: Implementation detail supporting search page behavior.
043012| src/lib/search/search-doc-queries.ts:896:         d.view_count as "viewCount",
043013| NOTE: Implementation detail supporting search page behavior.
043014| src/lib/search/search-doc-queries.ts:897:         d.address,
043015| NOTE: Implementation detail supporting search page behavior.
043016| src/lib/search/search-doc-queries.ts:898:         d.city,
043017| NOTE: Implementation detail supporting search page behavior.
043018| src/lib/search/search-doc-queries.ts:899:         d.state,
043019| NOTE: Implementation detail supporting search page behavior.
043020| src/lib/search/search-doc-queries.ts:900:         d.zip,
043021| NOTE: Implementation detail supporting search page behavior.
043022| src/lib/search/search-doc-queries.ts:901:         d.lat,
043023| NOTE: Implementation detail supporting search page behavior.
043024| src/lib/search/search-doc-queries.ts:902:         d.lng,
043025| NOTE: Implementation detail supporting search page behavior.
043026| src/lib/search/search-doc-queries.ts:903:         d.avg_rating as "avgRating",
043027| NOTE: Implementation detail supporting search page behavior.
043028| src/lib/search/search-doc-queries.ts:904:         d.review_count as "reviewCount",
043029| NOTE: Implementation detail supporting search page behavior.
043030| src/lib/search/search-doc-queries.ts:905:         -- Cursor row data columns (text for float precision)
043031| NOTE: Implementation detail supporting search page behavior.
043032| src/lib/search/search-doc-queries.ts:906:         d.recommended_score::text as "_cursorRecommendedScore",
043033| NOTE: Implementation detail supporting search page behavior.
043034| src/lib/search/search-doc-queries.ts:907:         d.price::text as "_cursorPrice",
043035| NOTE: Implementation detail supporting search page behavior.
043036| src/lib/search/search-doc-queries.ts:908:         d.avg_rating::text as "_cursorAvgRating",
043037| NOTE: Implementation detail supporting search page behavior.
043038| src/lib/search/search-doc-queries.ts:909:         d.review_count::text as "_cursorReviewCount",
043039| NOTE: Implementation detail supporting search page behavior.
043040| src/lib/search/search-doc-queries.ts:910:         d.listing_created_at::text as "_cursorCreatedAt"
043041| NOTE: Implementation detail supporting search page behavior.
043042| src/lib/search/search-doc-queries.ts:911:       FROM listing_search_docs d
043043| NOTE: Implementation detail supporting search page behavior.
043044| src/lib/search/search-doc-queries.ts:912:       WHERE ${whereClause}
043045| NOTE: Implementation detail supporting search page behavior.
043046| src/lib/search/search-doc-queries.ts:913:       ORDER BY ${orderByClause}
043047| NOTE: Implementation detail supporting search page behavior.
043048| src/lib/search/search-doc-queries.ts:914:       LIMIT $${paramIndex++}
043049| NOTE: Implementation detail supporting search page behavior.
043050| src/lib/search/search-doc-queries.ts:915:     `;
043051| NOTE: Implementation detail supporting search page behavior.
043052| src/lib/search/search-doc-queries.ts:916: 
043053| NOTE: Blank line for visual separation.
043054| src/lib/search/search-doc-queries.ts:917:     const dataParams = [...allParams, fetchLimit];
043055| NOTE: Local declaration used by search logic or UI.
043056| src/lib/search/search-doc-queries.ts:918: 
043057| NOTE: Blank line for visual separation.
043058| src/lib/search/search-doc-queries.ts:919:     const listings = await prisma.$queryRawUnsafe<any[]>(
043059| NOTE: Local declaration used by search logic or UI.
043060| src/lib/search/search-doc-queries.ts:920:       dataQuery,
043061| NOTE: Implementation detail supporting search page behavior.
043062| src/lib/search/search-doc-queries.ts:921:       ...dataParams,
043063| NOTE: Implementation detail supporting search page behavior.
043064| src/lib/search/search-doc-queries.ts:922:     );
043065| NOTE: Implementation detail supporting search page behavior.
043066| src/lib/search/search-doc-queries.ts:923: 
043067| NOTE: Blank line for visual separation.
043068| src/lib/search/search-doc-queries.ts:924:     // Map results to ListingData
043069| NOTE: Line comment documents intent or constraints.
043070| src/lib/search/search-doc-queries.ts:925:     const results = listings.map((l) => ({
043071| NOTE: Local declaration used by search logic or UI.
043072| src/lib/search/search-doc-queries.ts:926:       id: l.id,
043073| NOTE: Implementation detail supporting search page behavior.
043074| src/lib/search/search-doc-queries.ts:927:       title: l.title,
043075| NOTE: Implementation detail supporting search page behavior.
043076| src/lib/search/search-doc-queries.ts:928:       description: l.description,
043077| NOTE: Implementation detail supporting search page behavior.
043078| src/lib/search/search-doc-queries.ts:929:       price: Number(l.price),
043079| NOTE: Implementation detail supporting search page behavior.
043080| src/lib/search/search-doc-queries.ts:930:       images: l.images || [],
043081| NOTE: Implementation detail supporting search page behavior.
043082| src/lib/search/search-doc-queries.ts:931:       availableSlots: l.availableSlots,
043083| NOTE: Implementation detail supporting search page behavior.
043084| src/lib/search/search-doc-queries.ts:932:       totalSlots: l.totalSlots,
043085| NOTE: Implementation detail supporting search page behavior.
043086| src/lib/search/search-doc-queries.ts:933:       amenities: l.amenities || [],
043087| NOTE: Implementation detail supporting search page behavior.
043088| src/lib/search/search-doc-queries.ts:934:       houseRules: l.houseRules || [],
043089| NOTE: Implementation detail supporting search page behavior.
043090| src/lib/search/search-doc-queries.ts:935:       householdLanguages: l.householdLanguages || [],
043091| NOTE: Implementation detail supporting search page behavior.
043092| src/lib/search/search-doc-queries.ts:936:       primaryHomeLanguage: l.primaryHomeLanguage,
043093| NOTE: Implementation detail supporting search page behavior.
043094| src/lib/search/search-doc-queries.ts:937:       leaseDuration: l.leaseDuration,
043095| NOTE: Implementation detail supporting search page behavior.
043096| src/lib/search/search-doc-queries.ts:938:       roomType: l.roomType,
043097| NOTE: Implementation detail supporting search page behavior.
043098| src/lib/search/search-doc-queries.ts:939:       moveInDate: l.moveInDate ? new Date(l.moveInDate) : undefined,
043099| NOTE: Implementation detail supporting search page behavior.
043100| src/lib/search/search-doc-queries.ts:940:       ownerId: l.ownerId,
043101| NOTE: Implementation detail supporting search page behavior.
043102| src/lib/search/search-doc-queries.ts:941:       createdAt: l.createdAt ? new Date(l.createdAt) : new Date(),
043103| NOTE: Implementation detail supporting search page behavior.
043104| src/lib/search/search-doc-queries.ts:942:       viewCount: Number(l.viewCount) || 0,
043105| NOTE: Implementation detail supporting search page behavior.
043106| src/lib/search/search-doc-queries.ts:943:       avgRating: Number(l.avgRating) || 0,
043107| NOTE: Implementation detail supporting search page behavior.
043108| src/lib/search/search-doc-queries.ts:944:       reviewCount: Number(l.reviewCount) || 0,
043109| NOTE: Implementation detail supporting search page behavior.
043110| src/lib/search/search-doc-queries.ts:945:       location: {
043111| NOTE: Implementation detail supporting search page behavior.
043112| src/lib/search/search-doc-queries.ts:946:         address: l.address,
043113| NOTE: Implementation detail supporting search page behavior.
043114| src/lib/search/search-doc-queries.ts:947:         city: l.city,
043115| NOTE: Implementation detail supporting search page behavior.
043116| src/lib/search/search-doc-queries.ts:948:         state: l.state,
043117| NOTE: Implementation detail supporting search page behavior.
043118| src/lib/search/search-doc-queries.ts:949:         zip: l.zip,
043119| NOTE: Implementation detail supporting search page behavior.
043120| src/lib/search/search-doc-queries.ts:950:         lat: Number(l.lat) || 0,
043121| NOTE: Implementation detail supporting search page behavior.
043122| src/lib/search/search-doc-queries.ts:951:         lng: Number(l.lng) || 0,
043123| NOTE: Implementation detail supporting search page behavior.
043124| src/lib/search/search-doc-queries.ts:952:       },
043125| NOTE: Implementation detail supporting search page behavior.
043126| src/lib/search/search-doc-queries.ts:953:     }));
043127| NOTE: Implementation detail supporting search page behavior.
043128| src/lib/search/search-doc-queries.ts:954: 
043129| NOTE: Blank line for visual separation.
043130| src/lib/search/search-doc-queries.ts:955:     // Determine hasNextPage using limit+1 pattern
043131| NOTE: Line comment documents intent or constraints.
043132| src/lib/search/search-doc-queries.ts:956:     const hasNextPage = results.length > limit;
043133| NOTE: Local declaration used by search logic or UI.
043134| src/lib/search/search-doc-queries.ts:957: 
043135| NOTE: Blank line for visual separation.
043136| src/lib/search/search-doc-queries.ts:958:     // Only return `limit` items
043137| NOTE: Line comment documents intent or constraints.
043138| src/lib/search/search-doc-queries.ts:959:     let items: ListingData[] = hasNextPage ? results.slice(0, limit) : results;
043139| NOTE: Local declaration used by search logic or UI.
043140| src/lib/search/search-doc-queries.ts:960: 
043141| NOTE: Blank line for visual separation.
043142| src/lib/search/search-doc-queries.ts:961:     // Build nextCursor from the last item
043143| NOTE: Line comment documents intent or constraints.
043144| src/lib/search/search-doc-queries.ts:962:     let nextCursor: string | null = null;
043145| NOTE: Local declaration used by search logic or UI.
043146| src/lib/search/search-doc-queries.ts:963:     if (hasNextPage && listings.length > 0) {
043147| NOTE: Conditional logic controlling rendering or flow.
043148| src/lib/search/search-doc-queries.ts:964:       // Use the last item within limit (not the extra one)
043149| NOTE: Line comment documents intent or constraints.
043150| src/lib/search/search-doc-queries.ts:965:       const lastRawItem = listings[limit - 1];
043151| NOTE: Local declaration used by search logic or UI.
043152| src/lib/search/search-doc-queries.ts:966:       const cursorRowData: CursorRowData = {
043153| NOTE: Local declaration used by search logic or UI.
043154| src/lib/search/search-doc-queries.ts:967:         id: lastRawItem.id,
043155| NOTE: Implementation detail supporting search page behavior.
043156| src/lib/search/search-doc-queries.ts:968:         listing_created_at: lastRawItem._cursorCreatedAt,
043157| NOTE: Implementation detail supporting search page behavior.
043158| src/lib/search/search-doc-queries.ts:969:         recommended_score: lastRawItem._cursorRecommendedScore,
043159| NOTE: Implementation detail supporting search page behavior.
043160| src/lib/search/search-doc-queries.ts:970:         price: lastRawItem._cursorPrice,
043161| NOTE: Implementation detail supporting search page behavior.
043162| src/lib/search/search-doc-queries.ts:971:         avg_rating: lastRawItem._cursorAvgRating,
043163| NOTE: Implementation detail supporting search page behavior.
043164| src/lib/search/search-doc-queries.ts:972:         review_count: lastRawItem._cursorReviewCount,
043165| NOTE: Implementation detail supporting search page behavior.
043166| src/lib/search/search-doc-queries.ts:973:       };
043167| NOTE: Implementation detail supporting search page behavior.
043168| src/lib/search/search-doc-queries.ts:974:       const keysetCursor = buildCursorFromRow(cursorRowData, sortOption);
043169| NOTE: Local declaration used by search logic or UI.
043170| src/lib/search/search-doc-queries.ts:975:       nextCursor = encodeKeysetCursor(keysetCursor);
043171| NOTE: Implementation detail supporting search page behavior.
043172| src/lib/search/search-doc-queries.ts:976:     }
043173| NOTE: Implementation detail supporting search page behavior.
043174| src/lib/search/search-doc-queries.ts:977: 
043175| NOTE: Blank line for visual separation.
043176| src/lib/search/search-doc-queries.ts:978:     // Near-match expansion for keyset pagination (only on first page, i.e., no cursor)
043177| NOTE: Line comment documents intent or constraints.
043178| src/lib/search/search-doc-queries.ts:979:     // Since we have a cursor, we're not on the first page, so skip near-match logic
043179| NOTE: Line comment documents intent or constraints.
043180| src/lib/search/search-doc-queries.ts:980:     // Near matches are only shown on page 1 which uses offset-based pagination
043181| NOTE: Line comment documents intent or constraints.
043182| src/lib/search/search-doc-queries.ts:981: 
043183| NOTE: Blank line for visual separation.
043184| src/lib/search/search-doc-queries.ts:982:     // Hybrid count - use cached count for consistency
043185| NOTE: Line comment documents intent or constraints.
043186| src/lib/search/search-doc-queries.ts:983:     const limitedCount = await getSearchDocLimitedCount(params);
043187| NOTE: Local declaration used by search logic or UI.
043188| src/lib/search/search-doc-queries.ts:984:     const total = limitedCount;
043189| NOTE: Local declaration used by search logic or UI.
043190| src/lib/search/search-doc-queries.ts:985:     const totalPages =
043191| NOTE: Local declaration used by search logic or UI.
043192| src/lib/search/search-doc-queries.ts:986:       limitedCount !== null ? Math.ceil(limitedCount / limit) : null;
043193| NOTE: Implementation detail supporting search page behavior.
043194| src/lib/search/search-doc-queries.ts:987: 
043195| NOTE: Blank line for visual separation.
043196| src/lib/search/search-doc-queries.ts:988:     return {
043197| NOTE: Return statement for component or helper output.
043198| src/lib/search/search-doc-queries.ts:989:       items,
043199| NOTE: Implementation detail supporting search page behavior.
043200| src/lib/search/search-doc-queries.ts:990:       total,
043201| NOTE: Implementation detail supporting search page behavior.
043202| src/lib/search/search-doc-queries.ts:991:       totalPages,
043203| NOTE: Implementation detail supporting search page behavior.
043204| src/lib/search/search-doc-queries.ts:992:       hasNextPage,
043205| NOTE: Implementation detail supporting search page behavior.
043206| src/lib/search/search-doc-queries.ts:993:       hasPrevPage: true, // Always true for keyset pagination (we have a cursor)
043207| NOTE: Implementation detail supporting search page behavior.
043208| src/lib/search/search-doc-queries.ts:994:       page: null as unknown as number, // Page number is not meaningful for keyset
043209| NOTE: Implementation detail supporting search page behavior.
043210| src/lib/search/search-doc-queries.ts:995:       limit,
043211| NOTE: Implementation detail supporting search page behavior.
043212| src/lib/search/search-doc-queries.ts:996:       nextCursor,
043213| NOTE: Implementation detail supporting search page behavior.
043214| src/lib/search/search-doc-queries.ts:997:     };
043215| NOTE: Implementation detail supporting search page behavior.
043216| src/lib/search/search-doc-queries.ts:998:   } catch (error) {
043217| NOTE: Implementation detail supporting search page behavior.
043218| src/lib/search/search-doc-queries.ts:999:     const dataError = wrapDatabaseError(
043219| NOTE: Local declaration used by search logic or UI.
043220| src/lib/search/search-doc-queries.ts:1000:       error,
043221| NOTE: Implementation detail supporting search page behavior.
043222| src/lib/search/search-doc-queries.ts:1001:       "getSearchDocListingsWithKeyset",
043223| NOTE: Implementation detail supporting search page behavior.
043224| src/lib/search/search-doc-queries.ts:1002:     );
043225| NOTE: Implementation detail supporting search page behavior.
043226| src/lib/search/search-doc-queries.ts:1003:     dataError.log({
043227| NOTE: Implementation detail supporting search page behavior.
043228| src/lib/search/search-doc-queries.ts:1004:       operation: "getSearchDocListingsWithKeyset",
043229| NOTE: Implementation detail supporting search page behavior.
043230| src/lib/search/search-doc-queries.ts:1005:       hasQuery: !!params.query,
043231| NOTE: Implementation detail supporting search page behavior.
043232| src/lib/search/search-doc-queries.ts:1006:       hasBounds: !!params.bounds,
043233| NOTE: Implementation detail supporting search page behavior.
043234| src/lib/search/search-doc-queries.ts:1007:       sortOption: sort,
043235| NOTE: Implementation detail supporting search page behavior.
043236| src/lib/search/search-doc-queries.ts:1008:       hasCursor: !!cursor,
043237| NOTE: Implementation detail supporting search page behavior.
043238| src/lib/search/search-doc-queries.ts:1009:     });
043239| NOTE: Implementation detail supporting search page behavior.
043240| src/lib/search/search-doc-queries.ts:1010:     throw dataError;
043241| NOTE: Implementation detail supporting search page behavior.
043242| src/lib/search/search-doc-queries.ts:1011:   }
043243| NOTE: Implementation detail supporting search page behavior.
043244| src/lib/search/search-doc-queries.ts:1012: }
043245| NOTE: Implementation detail supporting search page behavior.
043246| src/lib/search/search-doc-queries.ts:1013: 
043247| NOTE: Blank line for visual separation.
043248| src/lib/search/search-doc-queries.ts:1014: /**
043249| NOTE: Block comment line describing behavior or context.
043250| src/lib/search/search-doc-queries.ts:1015:  * Get first page of listings with keyset cursor support.
043251| NOTE: Block comment line describing behavior or context.
043252| src/lib/search/search-doc-queries.ts:1016:  *
043253| NOTE: Block comment line describing behavior or context.
043254| src/lib/search/search-doc-queries.ts:1017:  * This is used for initial page load (no cursor) but returns a keyset cursor
043255| NOTE: Block comment line describing behavior or context.
043256| src/lib/search/search-doc-queries.ts:1018:  * for subsequent pages.
043257| NOTE: Block comment line describing behavior or context.
043258| src/lib/search/search-doc-queries.ts:1019:  *
043259| NOTE: Block comment line describing behavior or context.
043260| src/lib/search/search-doc-queries.ts:1020:  * @param params - Filter parameters
043261| NOTE: Block comment line describing behavior or context.
043262| src/lib/search/search-doc-queries.ts:1021:  * @returns Paginated results with nextCursor for next page
043263| NOTE: Block comment line describing behavior or context.
043264| src/lib/search/search-doc-queries.ts:1022:  */
043265| NOTE: Block comment line describing behavior or context.
043266| src/lib/search/search-doc-queries.ts:1023: export async function getSearchDocListingsFirstPage(
043267| NOTE: Implementation detail supporting search page behavior.
043268| src/lib/search/search-doc-queries.ts:1024:   params: FilterParams = {},
043269| NOTE: Implementation detail supporting search page behavior.
043270| src/lib/search/search-doc-queries.ts:1025: ): Promise<KeysetPaginatedResult<ListingData>> {
043271| NOTE: Implementation detail supporting search page behavior.
043272| src/lib/search/search-doc-queries.ts:1026:   const { sort = "recommended", limit = 12, nearMatches } = params;
043273| NOTE: Local declaration used by search logic or UI.
043274| src/lib/search/search-doc-queries.ts:1027:   const sortOption = sort as SortOption;
043275| NOTE: Local declaration used by search logic or UI.
043276| src/lib/search/search-doc-queries.ts:1028: 
043277| NOTE: Blank line for visual separation.
043278| src/lib/search/search-doc-queries.ts:1029:   // If keyset is disabled, use offset-based pagination
043279| NOTE: Line comment documents intent or constraints.
043280| src/lib/search/search-doc-queries.ts:1030:   if (!features.searchKeyset) {
043281| NOTE: Conditional logic controlling rendering or flow.
043282| src/lib/search/search-doc-queries.ts:1031:     const result = await getSearchDocListingsPaginated(params);
043283| NOTE: Local declaration used by search logic or UI.
043284| src/lib/search/search-doc-queries.ts:1032:     return {
043285| NOTE: Return statement for component or helper output.
043286| src/lib/search/search-doc-queries.ts:1033:       ...result,
043287| NOTE: Implementation detail supporting search page behavior.
043288| src/lib/search/search-doc-queries.ts:1034:       nextCursor: null,
043289| NOTE: Implementation detail supporting search page behavior.
043290| src/lib/search/search-doc-queries.ts:1035:     };
043291| NOTE: Implementation detail supporting search page behavior.
043292| src/lib/search/search-doc-queries.ts:1036:   }
043293| NOTE: Implementation detail supporting search page behavior.
043294| src/lib/search/search-doc-queries.ts:1037: 
043295| NOTE: Blank line for visual separation.
043296| src/lib/search/search-doc-queries.ts:1038:   try {
043297| NOTE: Implementation detail supporting search page behavior.
043298| src/lib/search/search-doc-queries.ts:1039:     const {
043299| NOTE: Local declaration used by search logic or UI.
043300| src/lib/search/search-doc-queries.ts:1040:       conditions,
043301| NOTE: Implementation detail supporting search page behavior.
043302| src/lib/search/search-doc-queries.ts:1041:       params: queryParams,
043303| NOTE: Implementation detail supporting search page behavior.
043304| src/lib/search/search-doc-queries.ts:1042:       paramIndex: startParamIndex,
043305| NOTE: Implementation detail supporting search page behavior.
043306| src/lib/search/search-doc-queries.ts:1043:     } = buildSearchDocWhereConditions(params);
043307| NOTE: Implementation detail supporting search page behavior.
043308| src/lib/search/search-doc-queries.ts:1044:     const whereClause = conditions.join(" AND ");
043309| NOTE: Local declaration used by search logic or UI.
043310| src/lib/search/search-doc-queries.ts:1045: 
043311| NOTE: Blank line for visual separation.
043312| src/lib/search/search-doc-queries.ts:1046:     // Build ORDER BY clause
043313| NOTE: Line comment documents intent or constraints.
043314| src/lib/search/search-doc-queries.ts:1047:     let orderByClause: string;
043315| NOTE: Local declaration used by search logic or UI.
043316| src/lib/search/search-doc-queries.ts:1048:     switch (sortOption) {
043317| NOTE: Implementation detail supporting search page behavior.
043318| src/lib/search/search-doc-queries.ts:1049:       case "price_asc":
043319| NOTE: Implementation detail supporting search page behavior.
043320| src/lib/search/search-doc-queries.ts:1050:         orderByClause =
043321| NOTE: Implementation detail supporting search page behavior.
043322| src/lib/search/search-doc-queries.ts:1051:           "d.price ASC NULLS LAST, d.listing_created_at DESC, d.id ASC";
043323| NOTE: Implementation detail supporting search page behavior.
043324| src/lib/search/search-doc-queries.ts:1052:         break;
043325| NOTE: Implementation detail supporting search page behavior.
043326| src/lib/search/search-doc-queries.ts:1053:       case "price_desc":
043327| NOTE: Implementation detail supporting search page behavior.
043328| src/lib/search/search-doc-queries.ts:1054:         orderByClause =
043329| NOTE: Implementation detail supporting search page behavior.
043330| src/lib/search/search-doc-queries.ts:1055:           "d.price DESC NULLS LAST, d.listing_created_at DESC, d.id ASC";
043331| NOTE: Implementation detail supporting search page behavior.
043332| src/lib/search/search-doc-queries.ts:1056:         break;
043333| NOTE: Implementation detail supporting search page behavior.
043334| src/lib/search/search-doc-queries.ts:1057:       case "newest":
043335| NOTE: Implementation detail supporting search page behavior.
043336| src/lib/search/search-doc-queries.ts:1058:         orderByClause = "d.listing_created_at DESC, d.id ASC";
043337| NOTE: Implementation detail supporting search page behavior.
043338| src/lib/search/search-doc-queries.ts:1059:         break;
043339| NOTE: Implementation detail supporting search page behavior.
043340| src/lib/search/search-doc-queries.ts:1060:       case "rating":
043341| NOTE: Implementation detail supporting search page behavior.
043342| src/lib/search/search-doc-queries.ts:1061:         orderByClause =
043343| NOTE: Implementation detail supporting search page behavior.
043344| src/lib/search/search-doc-queries.ts:1062:           "d.avg_rating DESC NULLS LAST, d.review_count DESC, d.listing_created_at DESC, d.id ASC";
043345| NOTE: Implementation detail supporting search page behavior.
043346| src/lib/search/search-doc-queries.ts:1063:         break;
043347| NOTE: Implementation detail supporting search page behavior.
043348| src/lib/search/search-doc-queries.ts:1064:       case "recommended":
043349| NOTE: Implementation detail supporting search page behavior.
043350| src/lib/search/search-doc-queries.ts:1065:       default:
043351| NOTE: Implementation detail supporting search page behavior.
043352| src/lib/search/search-doc-queries.ts:1066:         orderByClause =
043353| NOTE: Implementation detail supporting search page behavior.
043354| src/lib/search/search-doc-queries.ts:1067:           "d.recommended_score DESC, d.listing_created_at DESC, d.id ASC";
043355| NOTE: Implementation detail supporting search page behavior.
043356| src/lib/search/search-doc-queries.ts:1068:         break;
043357| NOTE: Implementation detail supporting search page behavior.
043358| src/lib/search/search-doc-queries.ts:1069:     }
043359| NOTE: Implementation detail supporting search page behavior.
043360| src/lib/search/search-doc-queries.ts:1070: 
043361| NOTE: Blank line for visual separation.
043362| src/lib/search/search-doc-queries.ts:1071:     // Hybrid count
043363| NOTE: Line comment documents intent or constraints.
043364| src/lib/search/search-doc-queries.ts:1072:     const limitedCount = await getSearchDocLimitedCount(params);
043365| NOTE: Local declaration used by search logic or UI.
043366| src/lib/search/search-doc-queries.ts:1073:     const total = limitedCount;
043367| NOTE: Local declaration used by search logic or UI.
043368| src/lib/search/search-doc-queries.ts:1074:     const totalPages =
043369| NOTE: Local declaration used by search logic or UI.
043370| src/lib/search/search-doc-queries.ts:1075:       limitedCount !== null ? Math.ceil(limitedCount / limit) : null;
043371| NOTE: Implementation detail supporting search page behavior.
043372| src/lib/search/search-doc-queries.ts:1076: 
043373| NOTE: Blank line for visual separation.
043374| src/lib/search/search-doc-queries.ts:1077:     // Fetch limit+1 items to determine hasNextPage
043375| NOTE: Line comment documents intent or constraints.
043376| src/lib/search/search-doc-queries.ts:1078:     const fetchLimit = limit + 1;
043377| NOTE: Local declaration used by search logic or UI.
043378| src/lib/search/search-doc-queries.ts:1079:     let paramIndex = startParamIndex;
043379| NOTE: Local declaration used by search logic or UI.
043380| src/lib/search/search-doc-queries.ts:1080: 
043381| NOTE: Blank line for visual separation.
043382| src/lib/search/search-doc-queries.ts:1081:     // Main query with cursor row data columns
043383| NOTE: Line comment documents intent or constraints.
043384| src/lib/search/search-doc-queries.ts:1082:     const dataQuery = `
043385| NOTE: Local declaration used by search logic or UI.
043386| src/lib/search/search-doc-queries.ts:1083:       SELECT
043387| NOTE: Implementation detail supporting search page behavior.
043388| src/lib/search/search-doc-queries.ts:1084:         d.id,
043389| NOTE: Implementation detail supporting search page behavior.
043390| src/lib/search/search-doc-queries.ts:1085:         d.title,
043391| NOTE: Implementation detail supporting search page behavior.
043392| src/lib/search/search-doc-queries.ts:1086:         d.description,
043393| NOTE: Implementation detail supporting search page behavior.
043394| src/lib/search/search-doc-queries.ts:1087:         d.price,
043395| NOTE: Implementation detail supporting search page behavior.
043396| src/lib/search/search-doc-queries.ts:1088:         d.images,
043397| NOTE: Implementation detail supporting search page behavior.
043398| src/lib/search/search-doc-queries.ts:1089:         d.available_slots as "availableSlots",
043399| NOTE: Implementation detail supporting search page behavior.
043400| src/lib/search/search-doc-queries.ts:1090:         d.total_slots as "totalSlots",
043401| NOTE: Implementation detail supporting search page behavior.
043402| src/lib/search/search-doc-queries.ts:1091:         d.amenities,
043403| NOTE: Implementation detail supporting search page behavior.
043404| src/lib/search/search-doc-queries.ts:1092:         d.house_rules as "houseRules",
043405| NOTE: Implementation detail supporting search page behavior.
043406| src/lib/search/search-doc-queries.ts:1093:         d.household_languages as "householdLanguages",
043407| NOTE: Implementation detail supporting search page behavior.
043408| src/lib/search/search-doc-queries.ts:1094:         d.primary_home_language as "primaryHomeLanguage",
043409| NOTE: Implementation detail supporting search page behavior.
043410| src/lib/search/search-doc-queries.ts:1095:         d.lease_duration as "leaseDuration",
043411| NOTE: Implementation detail supporting search page behavior.
043412| src/lib/search/search-doc-queries.ts:1096:         d.room_type as "roomType",
043413| NOTE: Implementation detail supporting search page behavior.
043414| src/lib/search/search-doc-queries.ts:1097:         d.move_in_date as "moveInDate",
043415| NOTE: Implementation detail supporting search page behavior.
043416| src/lib/search/search-doc-queries.ts:1098:         d.owner_id as "ownerId",
043417| NOTE: Implementation detail supporting search page behavior.
043418| src/lib/search/search-doc-queries.ts:1099:         d.listing_created_at as "createdAt",
043419| NOTE: Implementation detail supporting search page behavior.
043420| src/lib/search/search-doc-queries.ts:1100:         d.view_count as "viewCount",
043421| NOTE: Implementation detail supporting search page behavior.
043422| src/lib/search/search-doc-queries.ts:1101:         d.address,
043423| NOTE: Implementation detail supporting search page behavior.
043424| src/lib/search/search-doc-queries.ts:1102:         d.city,
043425| NOTE: Implementation detail supporting search page behavior.
043426| src/lib/search/search-doc-queries.ts:1103:         d.state,
043427| NOTE: Implementation detail supporting search page behavior.
043428| src/lib/search/search-doc-queries.ts:1104:         d.zip,
043429| NOTE: Implementation detail supporting search page behavior.
043430| src/lib/search/search-doc-queries.ts:1105:         d.lat,
043431| NOTE: Implementation detail supporting search page behavior.
043432| src/lib/search/search-doc-queries.ts:1106:         d.lng,
043433| NOTE: Implementation detail supporting search page behavior.
043434| src/lib/search/search-doc-queries.ts:1107:         d.avg_rating as "avgRating",
043435| NOTE: Implementation detail supporting search page behavior.
043436| src/lib/search/search-doc-queries.ts:1108:         d.review_count as "reviewCount",
043437| NOTE: Implementation detail supporting search page behavior.
043438| src/lib/search/search-doc-queries.ts:1109:         -- Cursor row data columns (text for float precision)
043439| NOTE: Implementation detail supporting search page behavior.
043440| src/lib/search/search-doc-queries.ts:1110:         d.recommended_score::text as "_cursorRecommendedScore",
043441| NOTE: Implementation detail supporting search page behavior.
043442| src/lib/search/search-doc-queries.ts:1111:         d.price::text as "_cursorPrice",
043443| NOTE: Implementation detail supporting search page behavior.
043444| src/lib/search/search-doc-queries.ts:1112:         d.avg_rating::text as "_cursorAvgRating",
043445| NOTE: Implementation detail supporting search page behavior.
043446| src/lib/search/search-doc-queries.ts:1113:         d.review_count::text as "_cursorReviewCount",
043447| NOTE: Implementation detail supporting search page behavior.
043448| src/lib/search/search-doc-queries.ts:1114:         d.listing_created_at::text as "_cursorCreatedAt"
043449| NOTE: Implementation detail supporting search page behavior.
043450| src/lib/search/search-doc-queries.ts:1115:       FROM listing_search_docs d
043451| NOTE: Implementation detail supporting search page behavior.
043452| src/lib/search/search-doc-queries.ts:1116:       WHERE ${whereClause}
043453| NOTE: Implementation detail supporting search page behavior.
043454| src/lib/search/search-doc-queries.ts:1117:       ORDER BY ${orderByClause}
043455| NOTE: Implementation detail supporting search page behavior.
043456| src/lib/search/search-doc-queries.ts:1118:       LIMIT $${paramIndex++}
043457| NOTE: Implementation detail supporting search page behavior.
043458| src/lib/search/search-doc-queries.ts:1119:     `;
043459| NOTE: Implementation detail supporting search page behavior.
043460| src/lib/search/search-doc-queries.ts:1120: 
043461| NOTE: Blank line for visual separation.
043462| src/lib/search/search-doc-queries.ts:1121:     const dataParams = [...queryParams, fetchLimit];
043463| NOTE: Local declaration used by search logic or UI.
043464| src/lib/search/search-doc-queries.ts:1122: 
043465| NOTE: Blank line for visual separation.
043466| src/lib/search/search-doc-queries.ts:1123:     const listings = await prisma.$queryRawUnsafe<any[]>(
043467| NOTE: Local declaration used by search logic or UI.
043468| src/lib/search/search-doc-queries.ts:1124:       dataQuery,
043469| NOTE: Implementation detail supporting search page behavior.
043470| src/lib/search/search-doc-queries.ts:1125:       ...dataParams,
043471| NOTE: Implementation detail supporting search page behavior.
043472| src/lib/search/search-doc-queries.ts:1126:     );
043473| NOTE: Implementation detail supporting search page behavior.
043474| src/lib/search/search-doc-queries.ts:1127: 
043475| NOTE: Blank line for visual separation.
043476| src/lib/search/search-doc-queries.ts:1128:     // Map results to ListingData
043477| NOTE: Line comment documents intent or constraints.
043478| src/lib/search/search-doc-queries.ts:1129:     const results = listings.map((l) => ({
043479| NOTE: Local declaration used by search logic or UI.
043480| src/lib/search/search-doc-queries.ts:1130:       id: l.id,
043481| NOTE: Implementation detail supporting search page behavior.
043482| src/lib/search/search-doc-queries.ts:1131:       title: l.title,
043483| NOTE: Implementation detail supporting search page behavior.
043484| src/lib/search/search-doc-queries.ts:1132:       description: l.description,
043485| NOTE: Implementation detail supporting search page behavior.
043486| src/lib/search/search-doc-queries.ts:1133:       price: Number(l.price),
043487| NOTE: Implementation detail supporting search page behavior.
043488| src/lib/search/search-doc-queries.ts:1134:       images: l.images || [],
043489| NOTE: Implementation detail supporting search page behavior.
043490| src/lib/search/search-doc-queries.ts:1135:       availableSlots: l.availableSlots,
043491| NOTE: Implementation detail supporting search page behavior.
043492| src/lib/search/search-doc-queries.ts:1136:       totalSlots: l.totalSlots,
043493| NOTE: Implementation detail supporting search page behavior.
043494| src/lib/search/search-doc-queries.ts:1137:       amenities: l.amenities || [],
043495| NOTE: Implementation detail supporting search page behavior.
043496| src/lib/search/search-doc-queries.ts:1138:       houseRules: l.houseRules || [],
043497| NOTE: Implementation detail supporting search page behavior.
043498| src/lib/search/search-doc-queries.ts:1139:       householdLanguages: l.householdLanguages || [],
043499| NOTE: Implementation detail supporting search page behavior.
043500| src/lib/search/search-doc-queries.ts:1140:       primaryHomeLanguage: l.primaryHomeLanguage,
043501| NOTE: Implementation detail supporting search page behavior.
043502| src/lib/search/search-doc-queries.ts:1141:       leaseDuration: l.leaseDuration,
043503| NOTE: Implementation detail supporting search page behavior.
043504| src/lib/search/search-doc-queries.ts:1142:       roomType: l.roomType,
043505| NOTE: Implementation detail supporting search page behavior.
043506| src/lib/search/search-doc-queries.ts:1143:       moveInDate: l.moveInDate ? new Date(l.moveInDate) : undefined,
043507| NOTE: Implementation detail supporting search page behavior.
043508| src/lib/search/search-doc-queries.ts:1144:       ownerId: l.ownerId,
043509| NOTE: Implementation detail supporting search page behavior.
043510| src/lib/search/search-doc-queries.ts:1145:       createdAt: l.createdAt ? new Date(l.createdAt) : new Date(),
043511| NOTE: Implementation detail supporting search page behavior.
043512| src/lib/search/search-doc-queries.ts:1146:       viewCount: Number(l.viewCount) || 0,
043513| NOTE: Implementation detail supporting search page behavior.
043514| src/lib/search/search-doc-queries.ts:1147:       avgRating: Number(l.avgRating) || 0,
043515| NOTE: Implementation detail supporting search page behavior.
043516| src/lib/search/search-doc-queries.ts:1148:       reviewCount: Number(l.reviewCount) || 0,
043517| NOTE: Implementation detail supporting search page behavior.
043518| src/lib/search/search-doc-queries.ts:1149:       location: {
043519| NOTE: Implementation detail supporting search page behavior.
043520| src/lib/search/search-doc-queries.ts:1150:         address: l.address,
043521| NOTE: Implementation detail supporting search page behavior.
043522| src/lib/search/search-doc-queries.ts:1151:         city: l.city,
043523| NOTE: Implementation detail supporting search page behavior.
043524| src/lib/search/search-doc-queries.ts:1152:         state: l.state,
043525| NOTE: Implementation detail supporting search page behavior.
043526| src/lib/search/search-doc-queries.ts:1153:         zip: l.zip,
043527| NOTE: Implementation detail supporting search page behavior.
043528| src/lib/search/search-doc-queries.ts:1154:         lat: Number(l.lat) || 0,
043529| NOTE: Implementation detail supporting search page behavior.
043530| src/lib/search/search-doc-queries.ts:1155:         lng: Number(l.lng) || 0,
043531| NOTE: Implementation detail supporting search page behavior.
043532| src/lib/search/search-doc-queries.ts:1156:       },
043533| NOTE: Implementation detail supporting search page behavior.
043534| src/lib/search/search-doc-queries.ts:1157:     }));
043535| NOTE: Implementation detail supporting search page behavior.
043536| src/lib/search/search-doc-queries.ts:1158: 
043537| NOTE: Blank line for visual separation.
043538| src/lib/search/search-doc-queries.ts:1159:     // Determine hasNextPage using limit+1 pattern
043539| NOTE: Line comment documents intent or constraints.
043540| src/lib/search/search-doc-queries.ts:1160:     const hasNextPage = results.length > limit;
043541| NOTE: Local declaration used by search logic or UI.
043542| src/lib/search/search-doc-queries.ts:1161: 
043543| NOTE: Blank line for visual separation.
043544| src/lib/search/search-doc-queries.ts:1162:     // Only return `limit` items
043545| NOTE: Line comment documents intent or constraints.
043546| src/lib/search/search-doc-queries.ts:1163:     let items: ListingData[] = hasNextPage ? results.slice(0, limit) : results;
043547| NOTE: Local declaration used by search logic or UI.
043548| src/lib/search/search-doc-queries.ts:1164: 
043549| NOTE: Blank line for visual separation.
043550| src/lib/search/search-doc-queries.ts:1165:     // Near-match expansion: if enabled and low results on page 1, fetch near matches
043551| NOTE: Line comment documents intent or constraints.
043552| src/lib/search/search-doc-queries.ts:1166:     let nearMatchCount = 0;
043553| NOTE: Local declaration used by search logic or UI.
043554| src/lib/search/search-doc-queries.ts:1167:     let nearMatchExpansion: string | undefined;
043555| NOTE: Local declaration used by search logic or UI.
043556| src/lib/search/search-doc-queries.ts:1168: 
043557| NOTE: Blank line for visual separation.
043558| src/lib/search/search-doc-queries.ts:1169:     if (
043559| NOTE: Conditional logic controlling rendering or flow.
043560| src/lib/search/search-doc-queries.ts:1170:       nearMatches &&
043561| NOTE: Implementation detail supporting search page behavior.
043562| src/lib/search/search-doc-queries.ts:1171:       items.length < LOW_RESULTS_THRESHOLD &&
043563| NOTE: Implementation detail supporting search page behavior.
043564| src/lib/search/search-doc-queries.ts:1172:       items.length > 0
043565| NOTE: Implementation detail supporting search page behavior.
043566| src/lib/search/search-doc-queries.ts:1173:     ) {
043567| NOTE: Implementation detail supporting search page behavior.
043568| src/lib/search/search-doc-queries.ts:1174:       const expansion = expandFiltersForNearMatches(params);
043569| NOTE: Local declaration used by search logic or UI.
043570| src/lib/search/search-doc-queries.ts:1175: 
043571| NOTE: Blank line for visual separation.
043572| src/lib/search/search-doc-queries.ts:1176:       if (expansion.expandedDimension !== null) {
043573| NOTE: Conditional logic controlling rendering or flow.
043574| src/lib/search/search-doc-queries.ts:1177:         nearMatchExpansion = expansion.expansionDescription ?? undefined;
043575| NOTE: Implementation detail supporting search page behavior.
043576| src/lib/search/search-doc-queries.ts:1178: 
043577| NOTE: Blank line for visual separation.
043578| src/lib/search/search-doc-queries.ts:1179:         // Run expanded query (without nearMatches flag to prevent recursion)
043579| NOTE: Line comment documents intent or constraints.
043580| src/lib/search/search-doc-queries.ts:1180:         const expandedResult = await getSearchDocListingsFirstPage({
043581| NOTE: Local declaration used by search logic or UI.
043582| src/lib/search/search-doc-queries.ts:1181:           ...expansion.expanded,
043583| NOTE: Implementation detail supporting search page behavior.
043584| src/lib/search/search-doc-queries.ts:1182:           nearMatches: false,
043585| NOTE: Implementation detail supporting search page behavior.
043586| src/lib/search/search-doc-queries.ts:1183:           page: 1,
043587| NOTE: Implementation detail supporting search page behavior.
043588| src/lib/search/search-doc-queries.ts:1184:           limit: LOW_RESULTS_THRESHOLD * 2,
043589| NOTE: Implementation detail supporting search page behavior.
043590| src/lib/search/search-doc-queries.ts:1185:         });
043591| NOTE: Implementation detail supporting search page behavior.
043592| src/lib/search/search-doc-queries.ts:1186: 
043593| NOTE: Blank line for visual separation.
043594| src/lib/search/search-doc-queries.ts:1187:         // Get IDs of exact matches to dedupe
043595| NOTE: Line comment documents intent or constraints.
043596| src/lib/search/search-doc-queries.ts:1188:         const exactIds = new Set(items.map((item) => item.id));
043597| NOTE: Local declaration used by search logic or UI.
043598| src/lib/search/search-doc-queries.ts:1189: 
043599| NOTE: Blank line for visual separation.
043600| src/lib/search/search-doc-queries.ts:1190:         // Filter to only near matches and tag them
043601| NOTE: Line comment documents intent or constraints.
043602| src/lib/search/search-doc-queries.ts:1191:         const nearMatchItems = expandedResult.items
043603| NOTE: Local declaration used by search logic or UI.
043604| src/lib/search/search-doc-queries.ts:1192:           .filter((item) => !exactIds.has(item.id))
043605| NOTE: Implementation detail supporting search page behavior.
043606| src/lib/search/search-doc-queries.ts:1193:           .slice(0, LOW_RESULTS_THRESHOLD)
043607| NOTE: Implementation detail supporting search page behavior.
043608| src/lib/search/search-doc-queries.ts:1194:           .map((item) => {
043609| NOTE: Implementation detail supporting search page behavior.
043610| src/lib/search/search-doc-queries.ts:1195:             const availableFromStr = item.moveInDate
043611| NOTE: Local declaration used by search logic or UI.
043612| src/lib/search/search-doc-queries.ts:1196:               ? item.moveInDate.toISOString().split("T")[0]
043613| NOTE: Implementation detail supporting search page behavior.
043614| src/lib/search/search-doc-queries.ts:1197:               : null;
043615| NOTE: Implementation detail supporting search page behavior.
043616| src/lib/search/search-doc-queries.ts:1198:             const isNearMatchResult = isNearMatch(
043617| NOTE: Local declaration used by search logic or UI.
043618| src/lib/search/search-doc-queries.ts:1199:               { price: item.price, available_from: availableFromStr },
043619| NOTE: Implementation detail supporting search page behavior.
043620| src/lib/search/search-doc-queries.ts:1200:               params,
043621| NOTE: Implementation detail supporting search page behavior.
043622| src/lib/search/search-doc-queries.ts:1201:               expansion.expandedDimension,
043623| NOTE: Implementation detail supporting search page behavior.
043624| src/lib/search/search-doc-queries.ts:1202:             );
043625| NOTE: Implementation detail supporting search page behavior.
043626| src/lib/search/search-doc-queries.ts:1203:             return {
043627| NOTE: Return statement for component or helper output.
043628| src/lib/search/search-doc-queries.ts:1204:               ...item,
043629| NOTE: Implementation detail supporting search page behavior.
043630| src/lib/search/search-doc-queries.ts:1205:               isNearMatch: isNearMatchResult,
043631| NOTE: Implementation detail supporting search page behavior.
043632| src/lib/search/search-doc-queries.ts:1206:             };
043633| NOTE: Implementation detail supporting search page behavior.
043634| src/lib/search/search-doc-queries.ts:1207:           })
043635| NOTE: Implementation detail supporting search page behavior.
043636| src/lib/search/search-doc-queries.ts:1208:           .filter((item) => item.isNearMatch);
043637| NOTE: Implementation detail supporting search page behavior.
043638| src/lib/search/search-doc-queries.ts:1209: 
043639| NOTE: Blank line for visual separation.
043640| src/lib/search/search-doc-queries.ts:1210:         nearMatchCount = nearMatchItems.length;
043641| NOTE: Implementation detail supporting search page behavior.
043642| src/lib/search/search-doc-queries.ts:1211: 
043643| NOTE: Blank line for visual separation.
043644| src/lib/search/search-doc-queries.ts:1212:         // Merge results: exact matches first, then near matches
043645| NOTE: Line comment documents intent or constraints.
043646| src/lib/search/search-doc-queries.ts:1213:         items = [...items, ...nearMatchItems];
043647| NOTE: Implementation detail supporting search page behavior.
043648| src/lib/search/search-doc-queries.ts:1214:       }
043649| NOTE: Implementation detail supporting search page behavior.
043650| src/lib/search/search-doc-queries.ts:1215:     }
043651| NOTE: Implementation detail supporting search page behavior.
043652| src/lib/search/search-doc-queries.ts:1216: 
043653| NOTE: Blank line for visual separation.
043654| src/lib/search/search-doc-queries.ts:1217:     // Build nextCursor from the last item
043655| NOTE: Line comment documents intent or constraints.
043656| src/lib/search/search-doc-queries.ts:1218:     let nextCursor: string | null = null;
043657| NOTE: Local declaration used by search logic or UI.
043658| src/lib/search/search-doc-queries.ts:1219:     if (hasNextPage && listings.length > 0) {
043659| NOTE: Conditional logic controlling rendering or flow.
043660| src/lib/search/search-doc-queries.ts:1220:       // Use the last item within limit (not the extra one)
043661| NOTE: Line comment documents intent or constraints.
043662| src/lib/search/search-doc-queries.ts:1221:       const lastRawItem = listings[Math.min(limit - 1, listings.length - 1)];
043663| NOTE: Local declaration used by search logic or UI.
043664| src/lib/search/search-doc-queries.ts:1222:       const cursorRowData: CursorRowData = {
043665| NOTE: Local declaration used by search logic or UI.
043666| src/lib/search/search-doc-queries.ts:1223:         id: lastRawItem.id,
043667| NOTE: Implementation detail supporting search page behavior.
043668| src/lib/search/search-doc-queries.ts:1224:         listing_created_at: lastRawItem._cursorCreatedAt,
043669| NOTE: Implementation detail supporting search page behavior.
043670| src/lib/search/search-doc-queries.ts:1225:         recommended_score: lastRawItem._cursorRecommendedScore,
043671| NOTE: Implementation detail supporting search page behavior.
043672| src/lib/search/search-doc-queries.ts:1226:         price: lastRawItem._cursorPrice,
043673| NOTE: Implementation detail supporting search page behavior.
043674| src/lib/search/search-doc-queries.ts:1227:         avg_rating: lastRawItem._cursorAvgRating,
043675| NOTE: Implementation detail supporting search page behavior.
043676| src/lib/search/search-doc-queries.ts:1228:         review_count: lastRawItem._cursorReviewCount,
043677| NOTE: Implementation detail supporting search page behavior.
043678| src/lib/search/search-doc-queries.ts:1229:       };
043679| NOTE: Implementation detail supporting search page behavior.
043680| src/lib/search/search-doc-queries.ts:1230:       const keysetCursor = buildCursorFromRow(cursorRowData, sortOption);
043681| NOTE: Local declaration used by search logic or UI.
043682| src/lib/search/search-doc-queries.ts:1231:       nextCursor = encodeKeysetCursor(keysetCursor);
043683| NOTE: Implementation detail supporting search page behavior.
043684| src/lib/search/search-doc-queries.ts:1232:     }
043685| NOTE: Implementation detail supporting search page behavior.
043686| src/lib/search/search-doc-queries.ts:1233: 
043687| NOTE: Blank line for visual separation.
043688| src/lib/search/search-doc-queries.ts:1234:     return {
043689| NOTE: Return statement for component or helper output.
043690| src/lib/search/search-doc-queries.ts:1235:       items,
043691| NOTE: Implementation detail supporting search page behavior.
043692| src/lib/search/search-doc-queries.ts:1236:       total,
043693| NOTE: Implementation detail supporting search page behavior.
043694| src/lib/search/search-doc-queries.ts:1237:       totalPages,
043695| NOTE: Implementation detail supporting search page behavior.
043696| src/lib/search/search-doc-queries.ts:1238:       hasNextPage,
043697| NOTE: Implementation detail supporting search page behavior.
043698| src/lib/search/search-doc-queries.ts:1239:       hasPrevPage: false, // First page has no previous
043699| NOTE: Implementation detail supporting search page behavior.
043700| src/lib/search/search-doc-queries.ts:1240:       page: 1,
043701| NOTE: Implementation detail supporting search page behavior.
043702| src/lib/search/search-doc-queries.ts:1241:       limit,
043703| NOTE: Implementation detail supporting search page behavior.
043704| src/lib/search/search-doc-queries.ts:1242:       nearMatchCount: nearMatchCount > 0 ? nearMatchCount : undefined,
043705| NOTE: Implementation detail supporting search page behavior.
043706| src/lib/search/search-doc-queries.ts:1243:       nearMatchExpansion,
043707| NOTE: Implementation detail supporting search page behavior.
043708| src/lib/search/search-doc-queries.ts:1244:       nextCursor,
043709| NOTE: Implementation detail supporting search page behavior.
043710| src/lib/search/search-doc-queries.ts:1245:     };
043711| NOTE: Implementation detail supporting search page behavior.
043712| src/lib/search/search-doc-queries.ts:1246:   } catch (error) {
043713| NOTE: Implementation detail supporting search page behavior.
043714| src/lib/search/search-doc-queries.ts:1247:     const dataError = wrapDatabaseError(error, "getSearchDocListingsFirstPage");
043715| NOTE: Local declaration used by search logic or UI.
043716| src/lib/search/search-doc-queries.ts:1248:     dataError.log({
043717| NOTE: Implementation detail supporting search page behavior.
043718| src/lib/search/search-doc-queries.ts:1249:       operation: "getSearchDocListingsFirstPage",
043719| NOTE: Implementation detail supporting search page behavior.
043720| src/lib/search/search-doc-queries.ts:1250:       hasQuery: !!params.query,
043721| NOTE: Implementation detail supporting search page behavior.
043722| src/lib/search/search-doc-queries.ts:1251:       hasBounds: !!params.bounds,
043723| NOTE: Implementation detail supporting search page behavior.
043724| src/lib/search/search-doc-queries.ts:1252:       sortOption: sort,
043725| NOTE: Implementation detail supporting search page behavior.
043726| src/lib/search/search-doc-queries.ts:1253:     });
043727| NOTE: Implementation detail supporting search page behavior.
043728| src/lib/search/search-doc-queries.ts:1254:     throw dataError;
043729| NOTE: Implementation detail supporting search page behavior.
043730| src/lib/search/search-doc-queries.ts:1255:   }
043731| NOTE: Implementation detail supporting search page behavior.
043732| src/lib/search/search-doc-queries.ts:1256: }
043733| NOTE: Implementation detail supporting search page behavior.
043734| src/lib/search/search-doc-queries.ts:1257: 
043735| NOTE: Blank line for visual separation.
043736| src/lib/search/search-doc-queries.ts:1258: // ============================================
043737| NOTE: Line comment documents intent or constraints.
043738| src/lib/search/search-doc-queries.ts:1259: // Feature Flag Check
043739| NOTE: Line comment documents intent or constraints.
043740| src/lib/search/search-doc-queries.ts:1260: // ============================================
043741| NOTE: Line comment documents intent or constraints.
043742| src/lib/search/search-doc-queries.ts:1261: 
043743| NOTE: Blank line for visual separation.
043744| src/lib/search/search-doc-queries.ts:1262: /**
043745| NOTE: Block comment line describing behavior or context.
043746| src/lib/search/search-doc-queries.ts:1263:  * Check if SearchDoc feature is enabled.
043747| NOTE: Block comment line describing behavior or context.
043748| src/lib/search/search-doc-queries.ts:1264:  * Controlled by:
043749| NOTE: Block comment line describing behavior or context.
043750| src/lib/search/search-doc-queries.ts:1265:  * - ENABLE_SEARCH_DOC env var (global enable)
043751| NOTE: Block comment line describing behavior or context.
043752| src/lib/search/search-doc-queries.ts:1266:  * - ?searchDoc=1 URL param (per-request override for testing)
043753| NOTE: Block comment line describing behavior or context.
043754| src/lib/search/search-doc-queries.ts:1267:  */
043755| NOTE: Block comment line describing behavior or context.
043756| src/lib/search/search-doc-queries.ts:1268: export function isSearchDocEnabled(urlSearchDoc?: string | null): boolean {
043757| NOTE: Exports helper or component function.
043758| src/lib/search/search-doc-queries.ts:1269:   // URL override for testing (allows ?searchDoc=1 to enable on specific requests)
043759| NOTE: Line comment documents intent or constraints.
043760| src/lib/search/search-doc-queries.ts:1270:   if (urlSearchDoc === "1" || urlSearchDoc === "true") {
043761| NOTE: Conditional logic controlling rendering or flow.
043762| src/lib/search/search-doc-queries.ts:1271:     return true;
043763| NOTE: Return statement for component or helper output.
043764| src/lib/search/search-doc-queries.ts:1272:   }
043765| NOTE: Implementation detail supporting search page behavior.
043766| src/lib/search/search-doc-queries.ts:1273:   if (urlSearchDoc === "0" || urlSearchDoc === "false") {
043767| NOTE: Conditional logic controlling rendering or flow.
043768| src/lib/search/search-doc-queries.ts:1274:     return false;
043769| NOTE: Return statement for component or helper output.
043770| src/lib/search/search-doc-queries.ts:1275:   }
043771| NOTE: Implementation detail supporting search page behavior.
043772| src/lib/search/search-doc-queries.ts:1276: 
043773| NOTE: Blank line for visual separation.
043774| src/lib/search/search-doc-queries.ts:1277:   // Global env var
043775| NOTE: Line comment documents intent or constraints.
043776| src/lib/search/search-doc-queries.ts:1278:   return process.env.ENABLE_SEARCH_DOC === "true";
043777| NOTE: Return statement for component or helper output.
043778| src/lib/search/search-doc-queries.ts:1279: }
043779| NOTE: Implementation detail supporting search page behavior.
043780| FILE END: src/lib/search/search-doc-queries.ts
043781| 
043782| FILE START: src/lib/search/search-v2-service.ts
043783| FILE ROLE: Auto-discovered dependency in search page graph.
043784| src/lib/search/search-v2-service.ts:1: /**
043785| NOTE: Block comment line describing behavior or context.
043786| src/lib/search/search-v2-service.ts:2:  * Search API v2 - Shared Server Function
043787| NOTE: Block comment line describing behavior or context.
043788| src/lib/search/search-v2-service.ts:3:  *
043789| NOTE: Block comment line describing behavior or context.
043790| src/lib/search/search-v2-service.ts:4:  * Extracted from /api/search/v2/route.ts for direct server-side invocation.
043791| NOTE: Block comment line describing behavior or context.
043792| src/lib/search/search-v2-service.ts:5:  * Avoids HTTP self-call overhead when page.tsx needs unified search data.
043793| NOTE: Block comment line describing behavior or context.
043794| src/lib/search/search-v2-service.ts:6:  */
043795| NOTE: Block comment line describing behavior or context.
043796| src/lib/search/search-v2-service.ts:7: 
043797| NOTE: Blank line for visual separation.
043798| src/lib/search/search-v2-service.ts:8: import { getListingsPaginated, getMapListings } from "@/lib/data";
043799| NOTE: Imports dependency for this module.
043800| src/lib/search/search-v2-service.ts:9: import { parseSearchParams } from "@/lib/search-params";
043801| NOTE: Imports dependency for this module.
043802| src/lib/search/search-v2-service.ts:10: import { features } from "@/lib/env";
043803| NOTE: Imports dependency for this module.
043804| src/lib/search/search-v2-service.ts:11: import {
043805| NOTE: Imports dependency for this module.
043806| src/lib/search/search-v2-service.ts:12:   isSearchDocEnabled,
043807| NOTE: Implementation detail supporting search page behavior.
043808| src/lib/search/search-v2-service.ts:13:   getSearchDocListingsPaginated,
043809| NOTE: Implementation detail supporting search page behavior.
043810| src/lib/search/search-v2-service.ts:14:   getSearchDocMapListings,
043811| NOTE: Implementation detail supporting search page behavior.
043812| src/lib/search/search-v2-service.ts:15:   getSearchDocListingsWithKeyset,
043813| NOTE: Implementation detail supporting search page behavior.
043814| src/lib/search/search-v2-service.ts:16:   getSearchDocListingsFirstPage,
043815| NOTE: Implementation detail supporting search page behavior.
043816| src/lib/search/search-v2-service.ts:17: } from "@/lib/search/search-doc-queries";
043817| NOTE: Implementation detail supporting search page behavior.
043818| src/lib/search/search-v2-service.ts:18: import {
043819| NOTE: Imports dependency for this module.
043820| src/lib/search/search-v2-service.ts:19:   generateQueryHash,
043821| NOTE: Implementation detail supporting search page behavior.
043822| src/lib/search/search-v2-service.ts:20:   encodeCursor,
043823| NOTE: Implementation detail supporting search page behavior.
043824| src/lib/search/search-v2-service.ts:21:   decodeCursor,
043825| NOTE: Implementation detail supporting search page behavior.
043826| src/lib/search/search-v2-service.ts:22:   decodeCursorAny,
043827| NOTE: Implementation detail supporting search page behavior.
043828| src/lib/search/search-v2-service.ts:23:   type KeysetCursor,
043829| NOTE: Type declaration for search data contracts.
043830| src/lib/search/search-v2-service.ts:24:   type SortOption,
043831| NOTE: Type declaration for search data contracts.
043832| src/lib/search/search-v2-service.ts:25: } from "@/lib/search/hash";
043833| NOTE: Implementation detail supporting search page behavior.
043834| src/lib/search/search-v2-service.ts:26: import {
043835| NOTE: Imports dependency for this module.
043836| src/lib/search/search-v2-service.ts:27:   transformToListItems,
043837| NOTE: Implementation detail supporting search page behavior.
043838| src/lib/search/search-v2-service.ts:28:   transformToMapResponse,
043839| NOTE: Implementation detail supporting search page behavior.
043840| src/lib/search/search-v2-service.ts:29:   determineMode,
043841| NOTE: Implementation detail supporting search page behavior.
043842| src/lib/search/search-v2-service.ts:30:   shouldIncludePins,
043843| NOTE: Implementation detail supporting search page behavior.
043844| src/lib/search/search-v2-service.ts:31: } from "@/lib/search/transform";
043845| NOTE: Implementation detail supporting search page behavior.
043846| src/lib/search/search-v2-service.ts:32: import {
043847| NOTE: Imports dependency for this module.
043848| src/lib/search/search-v2-service.ts:33:   isRankingEnabled,
043849| NOTE: Implementation detail supporting search page behavior.
043850| src/lib/search/search-v2-service.ts:34:   buildScoreMap,
043851| NOTE: Implementation detail supporting search page behavior.
043852| src/lib/search/search-v2-service.ts:35:   computeMedianPrice,
043853| NOTE: Implementation detail supporting search page behavior.
043854| src/lib/search/search-v2-service.ts:36:   getBoundsCenter,
043855| NOTE: Implementation detail supporting search page behavior.
043856| src/lib/search/search-v2-service.ts:37:   getDebugSignals,
043857| NOTE: Implementation detail supporting search page behavior.
043858| src/lib/search/search-v2-service.ts:38:   RANKING_VERSION,
043859| NOTE: Implementation detail supporting search page behavior.
043860| src/lib/search/search-v2-service.ts:39:   type RankingContext,
043861| NOTE: Type declaration for search data contracts.
043862| src/lib/search/search-v2-service.ts:40:   type RankableListing,
043863| NOTE: Type declaration for search data contracts.
043864| src/lib/search/search-v2-service.ts:41: } from "@/lib/search/ranking";
043865| NOTE: Implementation detail supporting search page behavior.
043866| src/lib/search/search-v2-service.ts:42: import type { SearchV2Response } from "@/lib/search/types";
043867| NOTE: Imports dependency for this module.
043868| src/lib/search/search-v2-service.ts:43: import type { PaginatedResultHybrid, ListingData } from "@/lib/data";
043869| NOTE: Imports dependency for this module.
043870| src/lib/search/search-v2-service.ts:44: 
043871| NOTE: Blank line for visual separation.
043872| src/lib/search/search-v2-service.ts:45: export interface SearchV2Params {
043873| NOTE: Implementation detail supporting search page behavior.
043874| src/lib/search/search-v2-service.ts:46:   /** Raw search params from URL (will be parsed internally) */
043875| NOTE: Block comment line describing behavior or context.
043876| src/lib/search/search-v2-service.ts:47:   rawParams: Record<string, string>;
043877| NOTE: Implementation detail supporting search page behavior.
043878| src/lib/search/search-v2-service.ts:48:   /** Items per page (optional, defaults to service's internal default) */
043879| NOTE: Block comment line describing behavior or context.
043880| src/lib/search/search-v2-service.ts:49:   limit?: number;
043881| NOTE: Implementation detail supporting search page behavior.
043882| src/lib/search/search-v2-service.ts:50: }
043883| NOTE: Implementation detail supporting search page behavior.
043884| src/lib/search/search-v2-service.ts:51: 
043885| NOTE: Blank line for visual separation.
043886| src/lib/search/search-v2-service.ts:52: export interface SearchV2Result {
043887| NOTE: Implementation detail supporting search page behavior.
043888| src/lib/search/search-v2-service.ts:53:   /** Full v2 response on success */
043889| NOTE: Block comment line describing behavior or context.
043890| src/lib/search/search-v2-service.ts:54:   response: SearchV2Response | null;
043891| NOTE: Implementation detail supporting search page behavior.
043892| src/lib/search/search-v2-service.ts:55:   /**
043893| NOTE: Block comment line describing behavior or context.
043894| src/lib/search/search-v2-service.ts:56:    * Raw paginated result with full ListingData for ListingCard rendering.
043895| NOTE: Block comment line describing behavior or context.
043896| src/lib/search/search-v2-service.ts:57:    * The v2 list.items is a simplified shape, but ListingCard needs full data.
043897| NOTE: Block comment line describing behavior or context.
043898| src/lib/search/search-v2-service.ts:58:    */
043899| NOTE: Block comment line describing behavior or context.
043900| src/lib/search/search-v2-service.ts:59:   paginatedResult: PaginatedResultHybrid<ListingData> | null;
043901| NOTE: Implementation detail supporting search page behavior.
043902| src/lib/search/search-v2-service.ts:60:   /** Error message if failed */
043903| NOTE: Block comment line describing behavior or context.
043904| src/lib/search/search-v2-service.ts:61:   error?: string;
043905| NOTE: Implementation detail supporting search page behavior.
043906| src/lib/search/search-v2-service.ts:62: }
043907| NOTE: Implementation detail supporting search page behavior.
043908| src/lib/search/search-v2-service.ts:63: 
043909| NOTE: Blank line for visual separation.
043910| src/lib/search/search-v2-service.ts:64: /**
043911| NOTE: Block comment line describing behavior or context.
043912| src/lib/search/search-v2-service.ts:65:  * Execute unified search and return v2 response shape.
043913| NOTE: Block comment line describing behavior or context.
043914| src/lib/search/search-v2-service.ts:66:  *
043915| NOTE: Block comment line describing behavior or context.
043916| src/lib/search/search-v2-service.ts:67:  * This is the core search logic extracted from the API route handler.
043917| NOTE: Block comment line describing behavior or context.
043918| src/lib/search/search-v2-service.ts:68:  * Called directly by page.tsx for SSR, avoiding HTTP self-call overhead.
043919| NOTE: Block comment line describing behavior or context.
043920| src/lib/search/search-v2-service.ts:69:  *
043921| NOTE: Block comment line describing behavior or context.
043922| src/lib/search/search-v2-service.ts:70:  * @param params - Search parameters from URL
043923| NOTE: Block comment line describing behavior or context.
043924| src/lib/search/search-v2-service.ts:71:  * @returns SearchV2Result with response or error
043925| NOTE: Block comment line describing behavior or context.
043926| src/lib/search/search-v2-service.ts:72:  */
043927| NOTE: Block comment line describing behavior or context.
043928| src/lib/search/search-v2-service.ts:73: export async function executeSearchV2(
043929| NOTE: Implementation detail supporting search page behavior.
043930| src/lib/search/search-v2-service.ts:74:   params: SearchV2Params,
043931| NOTE: Implementation detail supporting search page behavior.
043932| src/lib/search/search-v2-service.ts:75: ): Promise<SearchV2Result> {
043933| NOTE: Implementation detail supporting search page behavior.
043934| src/lib/search/search-v2-service.ts:76:   try {
043935| NOTE: Implementation detail supporting search page behavior.
043936| src/lib/search/search-v2-service.ts:77:     // Parse and validate search params
043937| NOTE: Line comment documents intent or constraints.
043938| src/lib/search/search-v2-service.ts:78:     const parsed = parseSearchParams(params.rawParams);
043939| NOTE: Local declaration used by search logic or UI.
043940| src/lib/search/search-v2-service.ts:79: 
043941| NOTE: Blank line for visual separation.
043942| src/lib/search/search-v2-service.ts:80:     // Check if features are enabled
043943| NOTE: Line comment documents intent or constraints.
043944| src/lib/search/search-v2-service.ts:81:     const useSearchDoc = isSearchDocEnabled(params.rawParams.searchDoc);
043945| NOTE: Local declaration used by search logic or UI.
043946| src/lib/search/search-v2-service.ts:82:     const useKeyset = features.searchKeyset && useSearchDoc;
043947| NOTE: Local declaration used by search logic or UI.
043948| src/lib/search/search-v2-service.ts:83: 
043949| NOTE: Blank line for visual separation.
043950| src/lib/search/search-v2-service.ts:84:     // Get sort option from parsed params (default to recommended)
043951| NOTE: Line comment documents intent or constraints.
043952| src/lib/search/search-v2-service.ts:85:     const sortOption: SortOption =
043953| NOTE: Local declaration used by search logic or UI.
043954| src/lib/search/search-v2-service.ts:86:       (parsed.filterParams.sort as SortOption) || "recommended";
043955| NOTE: Implementation detail supporting search page behavior.
043956| src/lib/search/search-v2-service.ts:87: 
043957| NOTE: Blank line for visual separation.
043958| src/lib/search/search-v2-service.ts:88:     // Handle cursor-based pagination
043959| NOTE: Line comment documents intent or constraints.
043960| src/lib/search/search-v2-service.ts:89:     const cursorStr = params.rawParams.cursor;
043961| NOTE: Local declaration used by search logic or UI.
043962| src/lib/search/search-v2-service.ts:90:     let page = parsed.requestedPage;
043963| NOTE: Local declaration used by search logic or UI.
043964| src/lib/search/search-v2-service.ts:91:     let keysetCursor: KeysetCursor | null = null;
043965| NOTE: Local declaration used by search logic or UI.
043966| src/lib/search/search-v2-service.ts:92: 
043967| NOTE: Blank line for visual separation.
043968| src/lib/search/search-v2-service.ts:93:     if (cursorStr && useKeyset) {
043969| NOTE: Conditional logic controlling rendering or flow.
043970| src/lib/search/search-v2-service.ts:94:       // Try to decode as keyset or legacy cursor
043971| NOTE: Line comment documents intent or constraints.
043972| src/lib/search/search-v2-service.ts:95:       const decoded = decodeCursorAny(cursorStr, sortOption);
043973| NOTE: Local declaration used by search logic or UI.
043974| src/lib/search/search-v2-service.ts:96:       if (decoded?.type === "keyset") {
043975| NOTE: Conditional logic controlling rendering or flow.
043976| src/lib/search/search-v2-service.ts:97:         keysetCursor = decoded.cursor;
043977| NOTE: Implementation detail supporting search page behavior.
043978| src/lib/search/search-v2-service.ts:98:       } else if (decoded?.type === "legacy") {
043979| NOTE: Implementation detail supporting search page behavior.
043980| src/lib/search/search-v2-service.ts:99:         // Legacy cursor - use page number, but return keyset cursor going forward
043981| NOTE: Line comment documents intent or constraints.
043982| src/lib/search/search-v2-service.ts:100:         page = decoded.page;
043983| NOTE: Implementation detail supporting search page behavior.
043984| src/lib/search/search-v2-service.ts:101:       }
043985| NOTE: Implementation detail supporting search page behavior.
043986| src/lib/search/search-v2-service.ts:102:       // If invalid cursor, start from beginning (page 1, no keyset cursor)
043987| NOTE: Line comment documents intent or constraints.
043988| src/lib/search/search-v2-service.ts:103:     } else if (cursorStr) {
043989| NOTE: Implementation detail supporting search page behavior.
043990| src/lib/search/search-v2-service.ts:104:       // Keyset disabled - use legacy cursor decoding
043991| NOTE: Line comment documents intent or constraints.
043992| src/lib/search/search-v2-service.ts:105:       const decodedPage = decodeCursor(cursorStr);
043993| NOTE: Local declaration used by search logic or UI.
043994| src/lib/search/search-v2-service.ts:106:       if (decodedPage !== null) {
043995| NOTE: Conditional logic controlling rendering or flow.
043996| src/lib/search/search-v2-service.ts:107:         page = decodedPage;
043997| NOTE: Implementation detail supporting search page behavior.
043998| src/lib/search/search-v2-service.ts:108:       }
043999| NOTE: Implementation detail supporting search page behavior.
044000| src/lib/search/search-v2-service.ts:109:     }
044001| NOTE: Implementation detail supporting search page behavior.
044002| src/lib/search/search-v2-service.ts:110: 
044003| NOTE: Blank line for visual separation.
044004| src/lib/search/search-v2-service.ts:111:     // Build filter params with page and limit
044005| NOTE: Line comment documents intent or constraints.
044006| src/lib/search/search-v2-service.ts:112:     const filterParams = {
044007| NOTE: Local declaration used by search logic or UI.
044008| src/lib/search/search-v2-service.ts:113:       ...parsed.filterParams,
044009| NOTE: Implementation detail supporting search page behavior.
044010| src/lib/search/search-v2-service.ts:114:       page,
044011| NOTE: Implementation detail supporting search page behavior.
044012| src/lib/search/search-v2-service.ts:115:       ...(params.limit && { limit: params.limit }),
044013| NOTE: Implementation detail supporting search page behavior.
044014| src/lib/search/search-v2-service.ts:116:     };
044015| NOTE: Implementation detail supporting search page behavior.
044016| src/lib/search/search-v2-service.ts:117: 
044017| NOTE: Blank line for visual separation.
044018| src/lib/search/search-v2-service.ts:118:     // Fetch list data based on keyset mode
044019| NOTE: Line comment documents intent or constraints.
044020| src/lib/search/search-v2-service.ts:119:     let listResult: PaginatedResultHybrid<ListingData>;
044021| NOTE: Local declaration used by search logic or UI.
044022| src/lib/search/search-v2-service.ts:120:     let nextCursor: string | null;
044023| NOTE: Local declaration used by search logic or UI.
044024| src/lib/search/search-v2-service.ts:121: 
044025| NOTE: Blank line for visual separation.
044026| src/lib/search/search-v2-service.ts:122:     if (useKeyset) {
044027| NOTE: Conditional logic controlling rendering or flow.
044028| src/lib/search/search-v2-service.ts:123:       // Keyset pagination path
044029| NOTE: Line comment documents intent or constraints.
044030| src/lib/search/search-v2-service.ts:124:       if (keysetCursor) {
044031| NOTE: Conditional logic controlling rendering or flow.
044032| src/lib/search/search-v2-service.ts:125:         // Use keyset cursor for stable pagination
044033| NOTE: Line comment documents intent or constraints.
044034| src/lib/search/search-v2-service.ts:126:         const keysetResult = await getSearchDocListingsWithKeyset(
044035| NOTE: Local declaration used by search logic or UI.
044036| src/lib/search/search-v2-service.ts:127:           filterParams,
044037| NOTE: Implementation detail supporting search page behavior.
044038| src/lib/search/search-v2-service.ts:128:           keysetCursor,
044039| NOTE: Implementation detail supporting search page behavior.
044040| src/lib/search/search-v2-service.ts:129:         );
044041| NOTE: Implementation detail supporting search page behavior.
044042| src/lib/search/search-v2-service.ts:130:         listResult = keysetResult;
044043| NOTE: Implementation detail supporting search page behavior.
044044| src/lib/search/search-v2-service.ts:131:         nextCursor = keysetResult.nextCursor;
044045| NOTE: Implementation detail supporting search page behavior.
044046| src/lib/search/search-v2-service.ts:132:       } else {
044047| NOTE: Implementation detail supporting search page behavior.
044048| src/lib/search/search-v2-service.ts:133:         // First page or invalid cursor - get first page with keyset cursor
044049| NOTE: Line comment documents intent or constraints.
044050| src/lib/search/search-v2-service.ts:134:         const firstPageResult =
044051| NOTE: Local declaration used by search logic or UI.
044052| src/lib/search/search-v2-service.ts:135:           await getSearchDocListingsFirstPage(filterParams);
044053| NOTE: Implementation detail supporting search page behavior.
044054| src/lib/search/search-v2-service.ts:136:         listResult = firstPageResult;
044055| NOTE: Implementation detail supporting search page behavior.
044056| src/lib/search/search-v2-service.ts:137:         nextCursor = firstPageResult.nextCursor;
044057| NOTE: Implementation detail supporting search page behavior.
044058| src/lib/search/search-v2-service.ts:138:       }
044059| NOTE: Implementation detail supporting search page behavior.
044060| src/lib/search/search-v2-service.ts:139:     } else {
044061| NOTE: Implementation detail supporting search page behavior.
044062| src/lib/search/search-v2-service.ts:140:       // Offset pagination path (legacy or SearchDoc disabled)
044063| NOTE: Line comment documents intent or constraints.
044064| src/lib/search/search-v2-service.ts:141:       listResult = useSearchDoc
044065| NOTE: Implementation detail supporting search page behavior.
044066| src/lib/search/search-v2-service.ts:142:         ? await getSearchDocListingsPaginated(filterParams)
044067| NOTE: Implementation detail supporting search page behavior.
044068| src/lib/search/search-v2-service.ts:143:         : await getListingsPaginated(filterParams);
044069| NOTE: Implementation detail supporting search page behavior.
044070| src/lib/search/search-v2-service.ts:144:       nextCursor = listResult.hasNextPage ? encodeCursor(page + 1) : null;
044071| NOTE: Implementation detail supporting search page behavior.
044072| src/lib/search/search-v2-service.ts:145:     }
044073| NOTE: Implementation detail supporting search page behavior.
044074| src/lib/search/search-v2-service.ts:146: 
044075| NOTE: Blank line for visual separation.
044076| src/lib/search/search-v2-service.ts:147:     // Fetch map data (independent of pagination mode)
044077| NOTE: Line comment documents intent or constraints.
044078| src/lib/search/search-v2-service.ts:148:     const mapListings = useSearchDoc
044079| NOTE: Local declaration used by search logic or UI.
044080| src/lib/search/search-v2-service.ts:149:       ? await getSearchDocMapListings(filterParams)
044081| NOTE: Implementation detail supporting search page behavior.
044082| src/lib/search/search-v2-service.ts:150:       : await getMapListings(filterParams);
044083| NOTE: Implementation detail supporting search page behavior.
044084| src/lib/search/search-v2-service.ts:151: 
044085| NOTE: Blank line for visual separation.
044086| src/lib/search/search-v2-service.ts:152:     // Determine mode based on mapListings count (not list total)
044087| NOTE: Line comment documents intent or constraints.
044088| src/lib/search/search-v2-service.ts:153:     const mode = determineMode(mapListings.length);
044089| NOTE: Local declaration used by search logic or UI.
044090| src/lib/search/search-v2-service.ts:154: 
044091| NOTE: Blank line for visual separation.
044092| src/lib/search/search-v2-service.ts:155:     // Generate query hash for caching (excludes pagination)
044093| NOTE: Line comment documents intent or constraints.
044094| src/lib/search/search-v2-service.ts:156:     const queryHash = generateQueryHash({
044095| NOTE: Local declaration used by search logic or UI.
044096| src/lib/search/search-v2-service.ts:157:       query: parsed.filterParams.query,
044097| NOTE: Implementation detail supporting search page behavior.
044098| src/lib/search/search-v2-service.ts:158:       minPrice: parsed.filterParams.minPrice,
044099| NOTE: Implementation detail supporting search page behavior.
044100| src/lib/search/search-v2-service.ts:159:       maxPrice: parsed.filterParams.maxPrice,
044101| NOTE: Implementation detail supporting search page behavior.
044102| src/lib/search/search-v2-service.ts:160:       amenities: parsed.filterParams.amenities,
044103| NOTE: Implementation detail supporting search page behavior.
044104| src/lib/search/search-v2-service.ts:161:       houseRules: parsed.filterParams.houseRules,
044105| NOTE: Implementation detail supporting search page behavior.
044106| src/lib/search/search-v2-service.ts:162:       languages: parsed.filterParams.languages,
044107| NOTE: Implementation detail supporting search page behavior.
044108| src/lib/search/search-v2-service.ts:163:       roomType: parsed.filterParams.roomType,
044109| NOTE: Implementation detail supporting search page behavior.
044110| src/lib/search/search-v2-service.ts:164:       leaseDuration: parsed.filterParams.leaseDuration,
044111| NOTE: Implementation detail supporting search page behavior.
044112| src/lib/search/search-v2-service.ts:165:       moveInDate: parsed.filterParams.moveInDate,
044113| NOTE: Implementation detail supporting search page behavior.
044114| src/lib/search/search-v2-service.ts:166:       bounds: parsed.filterParams.bounds,
044115| NOTE: Implementation detail supporting search page behavior.
044116| src/lib/search/search-v2-service.ts:167:       nearMatches: parsed.filterParams.nearMatches,
044117| NOTE: Implementation detail supporting search page behavior.
044118| src/lib/search/search-v2-service.ts:168:     });
044119| NOTE: Implementation detail supporting search page behavior.
044120| src/lib/search/search-v2-service.ts:169: 
044121| NOTE: Blank line for visual separation.
044122| src/lib/search/search-v2-service.ts:170:     // Transform list items
044123| NOTE: Line comment documents intent or constraints.
044124| src/lib/search/search-v2-service.ts:171:     const listItems = transformToListItems(listResult.items);
044125| NOTE: Local declaration used by search logic or UI.
044126| src/lib/search/search-v2-service.ts:172: 
044127| NOTE: Blank line for visual separation.
044128| src/lib/search/search-v2-service.ts:173:     // Check if ranking is enabled (URL override or env flag)
044129| NOTE: Line comment documents intent or constraints.
044130| src/lib/search/search-v2-service.ts:174:     const rankerEnabled = isRankingEnabled(params.rawParams.ranker);
044131| NOTE: Local declaration used by search logic or UI.
044132| src/lib/search/search-v2-service.ts:175:     const debugRank = params.rawParams.debugRank === "1";
044133| NOTE: Local declaration used by search logic or UI.
044134| src/lib/search/search-v2-service.ts:176: 
044135| NOTE: Blank line for visual separation.
044136| src/lib/search/search-v2-service.ts:177:     // Compute scoreMap for pin tiering when ranking is enabled and in pins mode
044137| NOTE: Line comment documents intent or constraints.
044138| src/lib/search/search-v2-service.ts:178:     let scoreMap: Map<string, number> | undefined;
044139| NOTE: Local declaration used by search logic or UI.
044140| src/lib/search/search-v2-service.ts:179:     let debugSignals:
044141| NOTE: Local declaration used by search logic or UI.
044142| src/lib/search/search-v2-service.ts:180:       | Array<{
044143| NOTE: Implementation detail supporting search page behavior.
044144| src/lib/search/search-v2-service.ts:181:           id: string;
044145| NOTE: Implementation detail supporting search page behavior.
044146| src/lib/search/search-v2-service.ts:182:           quality: number;
044147| NOTE: Implementation detail supporting search page behavior.
044148| src/lib/search/search-v2-service.ts:183:           rating: number;
044149| NOTE: Implementation detail supporting search page behavior.
044150| src/lib/search/search-v2-service.ts:184:           price: number;
044151| NOTE: Implementation detail supporting search page behavior.
044152| src/lib/search/search-v2-service.ts:185:           recency: number;
044153| NOTE: Implementation detail supporting search page behavior.
044154| src/lib/search/search-v2-service.ts:186:           geo: number;
044155| NOTE: Implementation detail supporting search page behavior.
044156| src/lib/search/search-v2-service.ts:187:           total: number;
044157| NOTE: Implementation detail supporting search page behavior.
044158| src/lib/search/search-v2-service.ts:188:         }>
044159| NOTE: Implementation detail supporting search page behavior.
044160| src/lib/search/search-v2-service.ts:189:       | undefined;
044161| NOTE: Implementation detail supporting search page behavior.
044162| src/lib/search/search-v2-service.ts:190: 
044163| NOTE: Blank line for visual separation.
044164| src/lib/search/search-v2-service.ts:191:     if (rankerEnabled && shouldIncludePins(mapListings.length)) {
044165| NOTE: Conditional logic controlling rendering or flow.
044166| src/lib/search/search-v2-service.ts:192:       // Adapt mapListings to RankableListing interface
044167| NOTE: Line comment documents intent or constraints.
044168| src/lib/search/search-v2-service.ts:193:       const rankableListings: RankableListing[] = mapListings.map(
044169| NOTE: Local declaration used by search logic or UI.
044170| src/lib/search/search-v2-service.ts:194:         (listing) => ({
044171| NOTE: Implementation detail supporting search page behavior.
044172| src/lib/search/search-v2-service.ts:195:           id: listing.id,
044173| NOTE: Implementation detail supporting search page behavior.
044174| src/lib/search/search-v2-service.ts:196:           price: listing.price,
044175| NOTE: Implementation detail supporting search page behavior.
044176| src/lib/search/search-v2-service.ts:197:           lat: listing.location.lat,
044177| NOTE: Implementation detail supporting search page behavior.
044178| src/lib/search/search-v2-service.ts:198:           lng: listing.location.lng,
044179| NOTE: Implementation detail supporting search page behavior.
044180| src/lib/search/search-v2-service.ts:199:           // SearchDoc fields (may be undefined for legacy path)
044181| NOTE: Line comment documents intent or constraints.
044182| src/lib/search/search-v2-service.ts:200:           recommendedScore: (listing as { recommendedScore?: number | null })
044183| NOTE: Implementation detail supporting search page behavior.
044184| src/lib/search/search-v2-service.ts:201:             .recommendedScore,
044185| NOTE: Implementation detail supporting search page behavior.
044186| src/lib/search/search-v2-service.ts:202:           avgRating: (listing as { avgRating?: number | null }).avgRating,
044187| NOTE: Implementation detail supporting search page behavior.
044188| src/lib/search/search-v2-service.ts:203:           reviewCount: (listing as { reviewCount?: number | null }).reviewCount,
044189| NOTE: Implementation detail supporting search page behavior.
044190| src/lib/search/search-v2-service.ts:204:           createdAt: (listing as { createdAt?: Date | string | null })
044191| NOTE: Implementation detail supporting search page behavior.
044192| src/lib/search/search-v2-service.ts:205:             .createdAt,
044193| NOTE: Implementation detail supporting search page behavior.
044194| src/lib/search/search-v2-service.ts:206:         }),
044195| NOTE: Implementation detail supporting search page behavior.
044196| src/lib/search/search-v2-service.ts:207:       );
044197| NOTE: Implementation detail supporting search page behavior.
044198| src/lib/search/search-v2-service.ts:208: 
044199| NOTE: Blank line for visual separation.
044200| src/lib/search/search-v2-service.ts:209:       // Build ranking context from map candidates
044201| NOTE: Line comment documents intent or constraints.
044202| src/lib/search/search-v2-service.ts:210:       // Convert filterParams bounds format to sw/ne format for getBoundsCenter
044203| NOTE: Line comment documents intent or constraints.
044204| src/lib/search/search-v2-service.ts:211:       const boundsForRanking = parsed.filterParams.bounds
044205| NOTE: Local declaration used by search logic or UI.
044206| src/lib/search/search-v2-service.ts:212:         ? {
044207| NOTE: Implementation detail supporting search page behavior.
044208| src/lib/search/search-v2-service.ts:213:             sw: {
044209| NOTE: Implementation detail supporting search page behavior.
044210| src/lib/search/search-v2-service.ts:214:               lat: parsed.filterParams.bounds.minLat,
044211| NOTE: Implementation detail supporting search page behavior.
044212| src/lib/search/search-v2-service.ts:215:               lng: parsed.filterParams.bounds.minLng,
044213| NOTE: Implementation detail supporting search page behavior.
044214| src/lib/search/search-v2-service.ts:216:             },
044215| NOTE: Implementation detail supporting search page behavior.
044216| src/lib/search/search-v2-service.ts:217:             ne: {
044217| NOTE: Implementation detail supporting search page behavior.
044218| src/lib/search/search-v2-service.ts:218:               lat: parsed.filterParams.bounds.maxLat,
044219| NOTE: Implementation detail supporting search page behavior.
044220| src/lib/search/search-v2-service.ts:219:               lng: parsed.filterParams.bounds.maxLng,
044221| NOTE: Implementation detail supporting search page behavior.
044222| src/lib/search/search-v2-service.ts:220:             },
044223| NOTE: Implementation detail supporting search page behavior.
044224| src/lib/search/search-v2-service.ts:221:           }
044225| NOTE: Implementation detail supporting search page behavior.
044226| src/lib/search/search-v2-service.ts:222:         : undefined;
044227| NOTE: Implementation detail supporting search page behavior.
044228| src/lib/search/search-v2-service.ts:223: 
044229| NOTE: Blank line for visual separation.
044230| src/lib/search/search-v2-service.ts:224:       const context: RankingContext = {
044231| NOTE: Local declaration used by search logic or UI.
044232| src/lib/search/search-v2-service.ts:225:         sort: sortOption,
044233| NOTE: Implementation detail supporting search page behavior.
044234| src/lib/search/search-v2-service.ts:226:         center: boundsForRanking
044235| NOTE: Implementation detail supporting search page behavior.
044236| src/lib/search/search-v2-service.ts:227:           ? getBoundsCenter(boundsForRanking)
044237| NOTE: Implementation detail supporting search page behavior.
044238| src/lib/search/search-v2-service.ts:228:           : undefined,
044239| NOTE: Implementation detail supporting search page behavior.
044240| src/lib/search/search-v2-service.ts:229:         localMedianPrice: computeMedianPrice(rankableListings),
044241| NOTE: Implementation detail supporting search page behavior.
044242| src/lib/search/search-v2-service.ts:230:       };
044243| NOTE: Implementation detail supporting search page behavior.
044244| src/lib/search/search-v2-service.ts:231: 
044245| NOTE: Blank line for visual separation.
044246| src/lib/search/search-v2-service.ts:232:       // Compute scores for pin tiering
044247| NOTE: Line comment documents intent or constraints.
044248| src/lib/search/search-v2-service.ts:233:       scoreMap = buildScoreMap(rankableListings, context);
044249| NOTE: Implementation detail supporting search page behavior.
044250| src/lib/search/search-v2-service.ts:234: 
044251| NOTE: Blank line for visual separation.
044252| src/lib/search/search-v2-service.ts:235:       // Generate debug signals if requested (no PII, capped to 5)
044253| NOTE: Line comment documents intent or constraints.
044254| src/lib/search/search-v2-service.ts:236:       if (debugRank) {
044255| NOTE: Conditional logic controlling rendering or flow.
044256| src/lib/search/search-v2-service.ts:237:         debugSignals = getDebugSignals(rankableListings, scoreMap, context, 5);
044257| NOTE: Implementation detail supporting search page behavior.
044258| src/lib/search/search-v2-service.ts:238:       }
044259| NOTE: Implementation detail supporting search page behavior.
044260| src/lib/search/search-v2-service.ts:239:     }
044261| NOTE: Implementation detail supporting search page behavior.
044262| src/lib/search/search-v2-service.ts:240: 
044263| NOTE: Blank line for visual separation.
044264| src/lib/search/search-v2-service.ts:241:     // Transform map data (geojson always, pins only when sparse)
044265| NOTE: Line comment documents intent or constraints.
044266| src/lib/search/search-v2-service.ts:242:     // Pass scoreMap for score-based pin tiering when ranking is enabled
044267| NOTE: Line comment documents intent or constraints.
044268| src/lib/search/search-v2-service.ts:243:     const mapResponse = transformToMapResponse(mapListings, scoreMap);
044269| NOTE: Local declaration used by search logic or UI.
044270| src/lib/search/search-v2-service.ts:244: 
044271| NOTE: Blank line for visual separation.
044272| src/lib/search/search-v2-service.ts:245:     // Build response
044273| NOTE: Line comment documents intent or constraints.
044274| src/lib/search/search-v2-service.ts:246:     const response: SearchV2Response = {
044275| NOTE: Local declaration used by search logic or UI.
044276| src/lib/search/search-v2-service.ts:247:       meta: {
044277| NOTE: Implementation detail supporting search page behavior.
044278| src/lib/search/search-v2-service.ts:248:         queryHash,
044279| NOTE: Implementation detail supporting search page behavior.
044280| src/lib/search/search-v2-service.ts:249:         generatedAt: new Date().toISOString(),
044281| NOTE: Implementation detail supporting search page behavior.
044282| src/lib/search/search-v2-service.ts:250:         mode,
044283| NOTE: Implementation detail supporting search page behavior.
044284| src/lib/search/search-v2-service.ts:251:         // Debug fields (only when debugRank=1)
044285| NOTE: Line comment documents intent or constraints.
044286| src/lib/search/search-v2-service.ts:252:         ...(debugRank && rankerEnabled
044287| NOTE: Implementation detail supporting search page behavior.
044288| src/lib/search/search-v2-service.ts:253:           ? {
044289| NOTE: Implementation detail supporting search page behavior.
044290| src/lib/search/search-v2-service.ts:254:               rankingVersion: RANKING_VERSION,
044291| NOTE: Implementation detail supporting search page behavior.
044292| src/lib/search/search-v2-service.ts:255:               rankingEnabled: true,
044293| NOTE: Implementation detail supporting search page behavior.
044294| src/lib/search/search-v2-service.ts:256:               topSignals: debugSignals,
044295| NOTE: Implementation detail supporting search page behavior.
044296| src/lib/search/search-v2-service.ts:257:             }
044297| NOTE: Implementation detail supporting search page behavior.
044298| src/lib/search/search-v2-service.ts:258:           : {}),
044299| NOTE: Implementation detail supporting search page behavior.
044300| src/lib/search/search-v2-service.ts:259:       },
044301| NOTE: Implementation detail supporting search page behavior.
044302| src/lib/search/search-v2-service.ts:260:       list: {
044303| NOTE: Implementation detail supporting search page behavior.
044304| src/lib/search/search-v2-service.ts:261:         items: listItems,
044305| NOTE: Implementation detail supporting search page behavior.
044306| src/lib/search/search-v2-service.ts:262:         nextCursor,
044307| NOTE: Implementation detail supporting search page behavior.
044308| src/lib/search/search-v2-service.ts:263:         total: listResult.total,
044309| NOTE: Implementation detail supporting search page behavior.
044310| src/lib/search/search-v2-service.ts:264:       },
044311| NOTE: Implementation detail supporting search page behavior.
044312| src/lib/search/search-v2-service.ts:265:       map: mapResponse,
044313| NOTE: Implementation detail supporting search page behavior.
044314| src/lib/search/search-v2-service.ts:266:     };
044315| NOTE: Implementation detail supporting search page behavior.
044316| src/lib/search/search-v2-service.ts:267: 
044317| NOTE: Blank line for visual separation.
044318| src/lib/search/search-v2-service.ts:268:     return { response, paginatedResult: listResult };
044319| NOTE: Return statement for component or helper output.
044320| src/lib/search/search-v2-service.ts:269:   } catch (error) {
044321| NOTE: Implementation detail supporting search page behavior.
044322| src/lib/search/search-v2-service.ts:270:     // Log without PII (no user data, just error context)
044323| NOTE: Line comment documents intent or constraints.
044324| src/lib/search/search-v2-service.ts:271:     console.error("SearchV2 service error:", {
044325| NOTE: Implementation detail supporting search page behavior.
044326| src/lib/search/search-v2-service.ts:272:       error: error instanceof Error ? error.message : "Unknown error",
044327| NOTE: Implementation detail supporting search page behavior.
044328| src/lib/search/search-v2-service.ts:273:     });
044329| NOTE: Implementation detail supporting search page behavior.
044330| src/lib/search/search-v2-service.ts:274:     return {
044331| NOTE: Return statement for component or helper output.
044332| src/lib/search/search-v2-service.ts:275:       response: null,
044333| NOTE: Implementation detail supporting search page behavior.
044334| src/lib/search/search-v2-service.ts:276:       paginatedResult: null,
044335| NOTE: Implementation detail supporting search page behavior.
044336| src/lib/search/search-v2-service.ts:277:       error: "Failed to fetch search results",
044337| NOTE: Implementation detail supporting search page behavior.
044338| src/lib/search/search-v2-service.ts:278:     };
044339| NOTE: Implementation detail supporting search page behavior.
044340| src/lib/search/search-v2-service.ts:279:   }
044341| NOTE: Implementation detail supporting search page behavior.
044342| src/lib/search/search-v2-service.ts:280: }
044343| NOTE: Implementation detail supporting search page behavior.
044344| FILE END: src/lib/search/search-v2-service.ts
044345| 
044346| FILE START: src/lib/search/transform.ts
044347| FILE ROLE: Auto-discovered dependency in search page graph.
044348| src/lib/search/transform.ts:1: /**
044349| NOTE: Block comment line describing behavior or context.
044350| src/lib/search/transform.ts:2:  * Search API v2 - Transform Utilities
044351| NOTE: Block comment line describing behavior or context.
044352| src/lib/search/transform.ts:3:  *
044353| NOTE: Block comment line describing behavior or context.
044354| src/lib/search/transform.ts:4:  * Transforms existing data shapes to v2 response format.
044355| NOTE: Block comment line describing behavior or context.
044356| src/lib/search/transform.ts:5:  * Includes GeoJSON generation and pin tiering logic.
044357| NOTE: Block comment line describing behavior or context.
044358| src/lib/search/transform.ts:6:  */
044359| NOTE: Block comment line describing behavior or context.
044360| src/lib/search/transform.ts:7: 
044361| NOTE: Blank line for visual separation.
044362| src/lib/search/transform.ts:8: import type { FeatureCollection, Point } from "geojson";
044363| NOTE: Imports dependency for this module.
044364| src/lib/search/transform.ts:9: import type { ListingData, MapListingData } from "@/lib/data";
044365| NOTE: Imports dependency for this module.
044366| src/lib/search/transform.ts:10: import {
044367| NOTE: Imports dependency for this module.
044368| src/lib/search/transform.ts:11:   groupListingsByCoord,
044369| NOTE: Implementation detail supporting search page behavior.
044370| src/lib/search/transform.ts:12:   buildRankMapFromScores,
044371| NOTE: Implementation detail supporting search page behavior.
044372| src/lib/search/transform.ts:13:   computeTieredGroups,
044373| NOTE: Implementation detail supporting search page behavior.
044374| src/lib/search/transform.ts:14:   getPrimaryPinLimit,
044375| NOTE: Implementation detail supporting search page behavior.
044376| src/lib/search/transform.ts:15:   getBestListingInGroup,
044377| NOTE: Implementation detail supporting search page behavior.
044378| src/lib/search/transform.ts:16:   type MapMarkerListing,
044379| NOTE: Type declaration for search data contracts.
044380| src/lib/search/transform.ts:17: } from "@/lib/maps/marker-utils";
044381| NOTE: Implementation detail supporting search page behavior.
044382| src/lib/search/transform.ts:18: import {
044383| NOTE: Imports dependency for this module.
044384| src/lib/search/transform.ts:19:   CLUSTER_THRESHOLD,
044385| NOTE: Implementation detail supporting search page behavior.
044386| src/lib/search/transform.ts:20:   type SearchV2ListItem,
044387| NOTE: Type declaration for search data contracts.
044388| src/lib/search/transform.ts:21:   type SearchV2GeoJSON,
044389| NOTE: Type declaration for search data contracts.
044390| src/lib/search/transform.ts:22:   type SearchV2Pin,
044391| NOTE: Type declaration for search data contracts.
044392| src/lib/search/transform.ts:23:   type SearchV2Mode,
044393| NOTE: Type declaration for search data contracts.
044394| src/lib/search/transform.ts:24:   type SearchV2FeatureProperties,
044395| NOTE: Type declaration for search data contracts.
044396| src/lib/search/transform.ts:25: } from "./types";
044397| NOTE: Implementation detail supporting search page behavior.
044398| src/lib/search/transform.ts:26: 
044399| NOTE: Blank line for visual separation.
044400| src/lib/search/transform.ts:27: // ============================================================================
044401| NOTE: Line comment documents intent or constraints.
044402| src/lib/search/transform.ts:28: // Mode Determination
044403| NOTE: Line comment documents intent or constraints.
044404| src/lib/search/transform.ts:29: // ============================================================================
044405| NOTE: Line comment documents intent or constraints.
044406| src/lib/search/transform.ts:30: 
044407| NOTE: Blank line for visual separation.
044408| src/lib/search/transform.ts:31: /**
044409| NOTE: Block comment line describing behavior or context.
044410| src/lib/search/transform.ts:32:  * Determine response mode based on mapListings count.
044411| NOTE: Block comment line describing behavior or context.
044412| src/lib/search/transform.ts:33:  * Uses CLUSTER_THRESHOLD (50) as the boundary.
044413| NOTE: Block comment line describing behavior or context.
044414| src/lib/search/transform.ts:34:  *
044415| NOTE: Block comment line describing behavior or context.
044416| src/lib/search/transform.ts:35:  * @param mapListingsCount - Number of listings in the map viewport
044417| NOTE: Block comment line describing behavior or context.
044418| src/lib/search/transform.ts:36:  * @returns 'geojson' if >=50, 'pins' if <50
044419| NOTE: Block comment line describing behavior or context.
044420| src/lib/search/transform.ts:37:  */
044421| NOTE: Block comment line describing behavior or context.
044422| src/lib/search/transform.ts:38: export function determineMode(mapListingsCount: number): SearchV2Mode {
044423| NOTE: Exports helper or component function.
044424| src/lib/search/transform.ts:39:   return mapListingsCount >= CLUSTER_THRESHOLD ? "geojson" : "pins";
044425| NOTE: Return statement for component or helper output.
044426| src/lib/search/transform.ts:40: }
044427| NOTE: Implementation detail supporting search page behavior.
044428| src/lib/search/transform.ts:41: 
044429| NOTE: Blank line for visual separation.
044430| src/lib/search/transform.ts:42: /**
044431| NOTE: Block comment line describing behavior or context.
044432| src/lib/search/transform.ts:43:  * Check if pins should be included in the response.
044433| NOTE: Block comment line describing behavior or context.
044434| src/lib/search/transform.ts:44:  * Pins are only included when the result set is sparse (<50 listings).
044435| NOTE: Block comment line describing behavior or context.
044436| src/lib/search/transform.ts:45:  *
044437| NOTE: Block comment line describing behavior or context.
044438| src/lib/search/transform.ts:46:  * @param mapListingsCount - Number of listings in the map viewport
044439| NOTE: Block comment line describing behavior or context.
044440| src/lib/search/transform.ts:47:  * @returns true if pins should be included
044441| NOTE: Block comment line describing behavior or context.
044442| src/lib/search/transform.ts:48:  */
044443| NOTE: Block comment line describing behavior or context.
044444| src/lib/search/transform.ts:49: export function shouldIncludePins(mapListingsCount: number): boolean {
044445| NOTE: Exports helper or component function.
044446| src/lib/search/transform.ts:50:   return mapListingsCount < CLUSTER_THRESHOLD;
044447| NOTE: Return statement for component or helper output.
044448| src/lib/search/transform.ts:51: }
044449| NOTE: Implementation detail supporting search page behavior.
044450| src/lib/search/transform.ts:52: 
044451| NOTE: Blank line for visual separation.
044452| src/lib/search/transform.ts:53: // ============================================================================
044453| NOTE: Line comment documents intent or constraints.
044454| src/lib/search/transform.ts:54: // List Item Transform
044455| NOTE: Line comment documents intent or constraints.
044456| src/lib/search/transform.ts:55: // ============================================================================
044457| NOTE: Line comment documents intent or constraints.
044458| src/lib/search/transform.ts:56: 
044459| NOTE: Blank line for visual separation.
044460| src/lib/search/transform.ts:57: /**
044461| NOTE: Block comment line describing behavior or context.
044462| src/lib/search/transform.ts:58:  * Transform a ListingData to SearchV2ListItem format.
044463| NOTE: Block comment line describing behavior or context.
044464| src/lib/search/transform.ts:59:  *
044465| NOTE: Block comment line describing behavior or context.
044466| src/lib/search/transform.ts:60:  * @param listing - Full listing data from getListingsPaginated
044467| NOTE: Block comment line describing behavior or context.
044468| src/lib/search/transform.ts:61:  * @returns Formatted list item for v2 response
044469| NOTE: Block comment line describing behavior or context.
044470| src/lib/search/transform.ts:62:  */
044471| NOTE: Block comment line describing behavior or context.
044472| src/lib/search/transform.ts:63: export function transformToListItem(listing: ListingData): SearchV2ListItem {
044473| NOTE: Exports helper or component function.
044474| src/lib/search/transform.ts:64:   const badges: string[] = [];
044475| NOTE: Local declaration used by search logic or UI.
044476| src/lib/search/transform.ts:65: 
044477| NOTE: Blank line for visual separation.
044478| src/lib/search/transform.ts:66:   // Add near-match badge if applicable
044479| NOTE: Line comment documents intent or constraints.
044480| src/lib/search/transform.ts:67:   if (listing.isNearMatch) {
044481| NOTE: Conditional logic controlling rendering or flow.
044482| src/lib/search/transform.ts:68:     badges.push("near-match");
044483| NOTE: Implementation detail supporting search page behavior.
044484| src/lib/search/transform.ts:69:   }
044485| NOTE: Implementation detail supporting search page behavior.
044486| src/lib/search/transform.ts:70: 
044487| NOTE: Blank line for visual separation.
044488| src/lib/search/transform.ts:71:   // Add multi-room badge if multiple slots
044489| NOTE: Line comment documents intent or constraints.
044490| src/lib/search/transform.ts:72:   if (listing.totalSlots > 1) {
044491| NOTE: Conditional logic controlling rendering or flow.
044492| src/lib/search/transform.ts:73:     badges.push("multi-room");
044493| NOTE: Implementation detail supporting search page behavior.
044494| src/lib/search/transform.ts:74:   }
044495| NOTE: Implementation detail supporting search page behavior.
044496| src/lib/search/transform.ts:75: 
044497| NOTE: Blank line for visual separation.
044498| src/lib/search/transform.ts:76:   return {
044499| NOTE: Return statement for component or helper output.
044500| src/lib/search/transform.ts:77:     id: listing.id,
044501| NOTE: Implementation detail supporting search page behavior.
044502| src/lib/search/transform.ts:78:     title: listing.title,
044503| NOTE: Implementation detail supporting search page behavior.
044504| src/lib/search/transform.ts:79:     price: listing.price,
044505| NOTE: Implementation detail supporting search page behavior.
044506| src/lib/search/transform.ts:80:     image: listing.images[0] ?? null,
044507| NOTE: Implementation detail supporting search page behavior.
044508| src/lib/search/transform.ts:81:     lat: listing.location.lat,
044509| NOTE: Implementation detail supporting search page behavior.
044510| src/lib/search/transform.ts:82:     lng: listing.location.lng,
044511| NOTE: Implementation detail supporting search page behavior.
044512| src/lib/search/transform.ts:83:     badges: badges.length > 0 ? badges : undefined,
044513| NOTE: Implementation detail supporting search page behavior.
044514| src/lib/search/transform.ts:84:     // scoreHint is reserved for future relevance scoring
044515| NOTE: Line comment documents intent or constraints.
044516| src/lib/search/transform.ts:85:   };
044517| NOTE: Implementation detail supporting search page behavior.
044518| src/lib/search/transform.ts:86: }
044519| NOTE: Implementation detail supporting search page behavior.
044520| src/lib/search/transform.ts:87: 
044521| NOTE: Blank line for visual separation.
044522| src/lib/search/transform.ts:88: /**
044523| NOTE: Block comment line describing behavior or context.
044524| src/lib/search/transform.ts:89:  * Transform an array of ListingData to SearchV2ListItem array.
044525| NOTE: Block comment line describing behavior or context.
044526| src/lib/search/transform.ts:90:  *
044527| NOTE: Block comment line describing behavior or context.
044528| src/lib/search/transform.ts:91:  * @param listings - Array of listing data
044529| NOTE: Block comment line describing behavior or context.
044530| src/lib/search/transform.ts:92:  * @returns Array of formatted list items
044531| NOTE: Block comment line describing behavior or context.
044532| src/lib/search/transform.ts:93:  */
044533| NOTE: Block comment line describing behavior or context.
044534| src/lib/search/transform.ts:94: export function transformToListItems(
044535| NOTE: Exports helper or component function.
044536| src/lib/search/transform.ts:95:   listings: ListingData[],
044537| NOTE: Implementation detail supporting search page behavior.
044538| src/lib/search/transform.ts:96: ): SearchV2ListItem[] {
044539| NOTE: Implementation detail supporting search page behavior.
044540| src/lib/search/transform.ts:97:   return listings.map(transformToListItem);
044541| NOTE: Return statement for component or helper output.
044542| src/lib/search/transform.ts:98: }
044543| NOTE: Implementation detail supporting search page behavior.
044544| src/lib/search/transform.ts:99: 
044545| NOTE: Blank line for visual separation.
044546| src/lib/search/transform.ts:100: // ============================================================================
044547| NOTE: Line comment documents intent or constraints.
044548| src/lib/search/transform.ts:101: // GeoJSON Transform
044549| NOTE: Line comment documents intent or constraints.
044550| src/lib/search/transform.ts:102: // ============================================================================
044551| NOTE: Line comment documents intent or constraints.
044552| src/lib/search/transform.ts:103: 
044553| NOTE: Blank line for visual separation.
044554| src/lib/search/transform.ts:104: /**
044555| NOTE: Block comment line describing behavior or context.
044556| src/lib/search/transform.ts:105:  * Transform MapListingData array to GeoJSON FeatureCollection.
044557| NOTE: Block comment line describing behavior or context.
044558| src/lib/search/transform.ts:106:  * This is ALWAYS returned in the v2 response for Mapbox client-side clustering.
044559| NOTE: Block comment line describing behavior or context.
044560| src/lib/search/transform.ts:107:  *
044561| NOTE: Block comment line describing behavior or context.
044562| src/lib/search/transform.ts:108:  * @param listings - Array of map listing data
044563| NOTE: Block comment line describing behavior or context.
044564| src/lib/search/transform.ts:109:  * @returns GeoJSON FeatureCollection with Point features
044565| NOTE: Block comment line describing behavior or context.
044566| src/lib/search/transform.ts:110:  */
044567| NOTE: Block comment line describing behavior or context.
044568| src/lib/search/transform.ts:111: export function transformToGeoJSON(
044569| NOTE: Exports helper or component function.
044570| src/lib/search/transform.ts:112:   listings: MapListingData[],
044571| NOTE: Implementation detail supporting search page behavior.
044572| src/lib/search/transform.ts:113: ): SearchV2GeoJSON {
044573| NOTE: Implementation detail supporting search page behavior.
044574| src/lib/search/transform.ts:114:   const features = listings.map((listing) => ({
044575| NOTE: Local declaration used by search logic or UI.
044576| src/lib/search/transform.ts:115:     type: "Feature" as const,
044577| NOTE: Implementation detail supporting search page behavior.
044578| src/lib/search/transform.ts:116:     geometry: {
044579| NOTE: Implementation detail supporting search page behavior.
044580| src/lib/search/transform.ts:117:       type: "Point" as const,
044581| NOTE: Implementation detail supporting search page behavior.
044582| src/lib/search/transform.ts:118:       coordinates: [listing.location.lng, listing.location.lat] as [
044583| NOTE: Implementation detail supporting search page behavior.
044584| src/lib/search/transform.ts:119:         number,
044585| NOTE: Implementation detail supporting search page behavior.
044586| src/lib/search/transform.ts:120:         number,
044587| NOTE: Implementation detail supporting search page behavior.
044588| src/lib/search/transform.ts:121:       ],
044589| NOTE: Implementation detail supporting search page behavior.
044590| src/lib/search/transform.ts:122:     },
044591| NOTE: Implementation detail supporting search page behavior.
044592| src/lib/search/transform.ts:123:     properties: {
044593| NOTE: Implementation detail supporting search page behavior.
044594| src/lib/search/transform.ts:124:       id: listing.id,
044595| NOTE: Implementation detail supporting search page behavior.
044596| src/lib/search/transform.ts:125:       title: listing.title,
044597| NOTE: Implementation detail supporting search page behavior.
044598| src/lib/search/transform.ts:126:       price: listing.price,
044599| NOTE: Implementation detail supporting search page behavior.
044600| src/lib/search/transform.ts:127:       image: listing.images[0] ?? null,
044601| NOTE: Implementation detail supporting search page behavior.
044602| src/lib/search/transform.ts:128:     } satisfies SearchV2FeatureProperties,
044603| NOTE: Implementation detail supporting search page behavior.
044604| src/lib/search/transform.ts:129:   }));
044605| NOTE: Implementation detail supporting search page behavior.
044606| src/lib/search/transform.ts:130: 
044607| NOTE: Blank line for visual separation.
044608| src/lib/search/transform.ts:131:   return {
044609| NOTE: Return statement for component or helper output.
044610| src/lib/search/transform.ts:132:     type: "FeatureCollection",
044611| NOTE: Implementation detail supporting search page behavior.
044612| src/lib/search/transform.ts:133:     features,
044613| NOTE: Implementation detail supporting search page behavior.
044614| src/lib/search/transform.ts:134:   } as FeatureCollection<Point, SearchV2FeatureProperties>;
044615| NOTE: Implementation detail supporting search page behavior.
044616| src/lib/search/transform.ts:135: }
044617| NOTE: Implementation detail supporting search page behavior.
044618| src/lib/search/transform.ts:136: 
044619| NOTE: Blank line for visual separation.
044620| src/lib/search/transform.ts:137: // ============================================================================
044621| NOTE: Line comment documents intent or constraints.
044622| src/lib/search/transform.ts:138: // Pin Transform
044623| NOTE: Line comment documents intent or constraints.
044624| src/lib/search/transform.ts:139: // ============================================================================
044625| NOTE: Line comment documents intent or constraints.
044626| src/lib/search/transform.ts:140: 
044627| NOTE: Blank line for visual separation.
044628| src/lib/search/transform.ts:141: /**
044629| NOTE: Block comment line describing behavior or context.
044630| src/lib/search/transform.ts:142:  * Adapt MapListingData to MapMarkerListing interface for marker-utils.
044631| NOTE: Block comment line describing behavior or context.
044632| src/lib/search/transform.ts:143:  */
044633| NOTE: Block comment line describing behavior or context.
044634| src/lib/search/transform.ts:144: function adaptToMarkerListing(listing: MapListingData): MapMarkerListing {
044635| NOTE: Defines a helper or component function.
044636| src/lib/search/transform.ts:145:   return {
044637| NOTE: Return statement for component or helper output.
044638| src/lib/search/transform.ts:146:     id: listing.id,
044639| NOTE: Implementation detail supporting search page behavior.
044640| src/lib/search/transform.ts:147:     title: listing.title,
044641| NOTE: Implementation detail supporting search page behavior.
044642| src/lib/search/transform.ts:148:     price: listing.price,
044643| NOTE: Implementation detail supporting search page behavior.
044644| src/lib/search/transform.ts:149:     availableSlots: listing.availableSlots,
044645| NOTE: Implementation detail supporting search page behavior.
044646| src/lib/search/transform.ts:150:     ownerId: listing.ownerId,
044647| NOTE: Implementation detail supporting search page behavior.
044648| src/lib/search/transform.ts:151:     images: listing.images,
044649| NOTE: Implementation detail supporting search page behavior.
044650| src/lib/search/transform.ts:152:     location: listing.location,
044651| NOTE: Implementation detail supporting search page behavior.
044652| src/lib/search/transform.ts:153:   };
044653| NOTE: Implementation detail supporting search page behavior.
044654| src/lib/search/transform.ts:154: }
044655| NOTE: Implementation detail supporting search page behavior.
044656| src/lib/search/transform.ts:155: 
044657| NOTE: Blank line for visual separation.
044658| src/lib/search/transform.ts:156: /**
044659| NOTE: Block comment line describing behavior or context.
044660| src/lib/search/transform.ts:157:  * Transform MapListingData array to tiered pins for sparse result sets.
044661| NOTE: Block comment line describing behavior or context.
044662| src/lib/search/transform.ts:158:  * Uses existing marker-utils functions for grouping and tiering.
044663| NOTE: Block comment line describing behavior or context.
044664| src/lib/search/transform.ts:159:  *
044665| NOTE: Block comment line describing behavior or context.
044666| src/lib/search/transform.ts:160:  * Pin tiering uses getPrimaryPinLimit() which:
044667| NOTE: Block comment line describing behavior or context.
044668| src/lib/search/transform.ts:161:  * - Defaults to 40 (code default, docs specify 15 for architecture)
044669| NOTE: Block comment line describing behavior or context.
044670| src/lib/search/transform.ts:162:  * - Can be overridden via NEXT_PUBLIC_PRIMARY_PINS env var
044671| NOTE: Block comment line describing behavior or context.
044672| src/lib/search/transform.ts:163:  * - Is clamped to 10-120 range
044673| NOTE: Block comment line describing behavior or context.
044674| src/lib/search/transform.ts:164:  *
044675| NOTE: Block comment line describing behavior or context.
044676| src/lib/search/transform.ts:165:  * @param listings - Array of map listing data
044677| NOTE: Block comment line describing behavior or context.
044678| src/lib/search/transform.ts:166:  * @returns Array of tiered pins with primary/mini classification
044679| NOTE: Block comment line describing behavior or context.
044680| src/lib/search/transform.ts:167:  */
044681| NOTE: Block comment line describing behavior or context.
044682| src/lib/search/transform.ts:168: export function transformToPins(
044683| NOTE: Exports helper or component function.
044684| src/lib/search/transform.ts:169:   listings: MapListingData[],
044685| NOTE: Implementation detail supporting search page behavior.
044686| src/lib/search/transform.ts:170:   scoreMap?: Map<string, number>,
044687| NOTE: Implementation detail supporting search page behavior.
044688| src/lib/search/transform.ts:171: ): SearchV2Pin[] {
044689| NOTE: Implementation detail supporting search page behavior.
044690| src/lib/search/transform.ts:172:   if (listings.length === 0) {
044691| NOTE: Conditional logic controlling rendering or flow.
044692| src/lib/search/transform.ts:173:     return [];
044693| NOTE: Return statement for component or helper output.
044694| src/lib/search/transform.ts:174:   }
044695| NOTE: Implementation detail supporting search page behavior.
044696| src/lib/search/transform.ts:175: 
044697| NOTE: Blank line for visual separation.
044698| src/lib/search/transform.ts:176:   // Adapt to marker-utils interface
044699| NOTE: Line comment documents intent or constraints.
044700| src/lib/search/transform.ts:177:   const markerListings = listings.map(adaptToMarkerListing);
044701| NOTE: Local declaration used by search logic or UI.
044702| src/lib/search/transform.ts:178: 
044703| NOTE: Blank line for visual separation.
044704| src/lib/search/transform.ts:179:   // Get primary limit (respects NEXT_PUBLIC_PRIMARY_PINS env var)
044705| NOTE: Line comment documents intent or constraints.
044706| src/lib/search/transform.ts:180:   const primaryLimit = getPrimaryPinLimit();
044707| NOTE: Local declaration used by search logic or UI.
044708| src/lib/search/transform.ts:181: 
044709| NOTE: Blank line for visual separation.
044710| src/lib/search/transform.ts:182:   // Group by coordinate
044711| NOTE: Line comment documents intent or constraints.
044712| src/lib/search/transform.ts:183:   const groups = groupListingsByCoord(markerListings);
044713| NOTE: Local declaration used by search logic or UI.
044714| src/lib/search/transform.ts:184: 
044715| NOTE: Blank line for visual separation.
044716| src/lib/search/transform.ts:185:   // Build rank map - uses score-based ranking if scoreMap provided, else position-based
044717| NOTE: Line comment documents intent or constraints.
044718| src/lib/search/transform.ts:186:   const rankMap = buildRankMapFromScores(markerListings, scoreMap);
044719| NOTE: Local declaration used by search logic or UI.
044720| src/lib/search/transform.ts:187: 
044721| NOTE: Blank line for visual separation.
044722| src/lib/search/transform.ts:188:   // Compute tiered groups
044723| NOTE: Line comment documents intent or constraints.
044724| src/lib/search/transform.ts:189:   const tieredGroups = computeTieredGroups(groups, rankMap, primaryLimit);
044725| NOTE: Local declaration used by search logic or UI.
044726| src/lib/search/transform.ts:190: 
044727| NOTE: Blank line for visual separation.
044728| src/lib/search/transform.ts:191:   // Transform to v2 pin format
044729| NOTE: Line comment documents intent or constraints.
044730| src/lib/search/transform.ts:192:   return tieredGroups.map((group) => {
044731| NOTE: Return statement for component or helper output.
044732| src/lib/search/transform.ts:193:     // Explicitly pick best listing by lowest rank (highest score), not just [0]
044733| NOTE: Line comment documents intent or constraints.
044734| src/lib/search/transform.ts:194:     const bestListing = getBestListingInGroup(group.listings, rankMap);
044735| NOTE: Local declaration used by search logic or UI.
044736| src/lib/search/transform.ts:195:     return {
044737| NOTE: Return statement for component or helper output.
044738| src/lib/search/transform.ts:196:       id: bestListing.id,
044739| NOTE: Implementation detail supporting search page behavior.
044740| src/lib/search/transform.ts:197:       lat: group.lat,
044741| NOTE: Implementation detail supporting search page behavior.
044742| src/lib/search/transform.ts:198:       lng: group.lng,
044743| NOTE: Implementation detail supporting search page behavior.
044744| src/lib/search/transform.ts:199:       price: bestListing.price,
044745| NOTE: Implementation detail supporting search page behavior.
044746| src/lib/search/transform.ts:200:       tier: group.tier,
044747| NOTE: Implementation detail supporting search page behavior.
044748| src/lib/search/transform.ts:201:       stackCount: group.listings.length > 1 ? group.listings.length : undefined,
044749| NOTE: Implementation detail supporting search page behavior.
044750| src/lib/search/transform.ts:202:     };
044751| NOTE: Implementation detail supporting search page behavior.
044752| src/lib/search/transform.ts:203:   });
044753| NOTE: Implementation detail supporting search page behavior.
044754| src/lib/search/transform.ts:204: }
044755| NOTE: Implementation detail supporting search page behavior.
044756| src/lib/search/transform.ts:205: 
044757| NOTE: Blank line for visual separation.
044758| src/lib/search/transform.ts:206: // ============================================================================
044759| NOTE: Line comment documents intent or constraints.
044760| src/lib/search/transform.ts:207: // Combined Transform Helper
044761| NOTE: Line comment documents intent or constraints.
044762| src/lib/search/transform.ts:208: // ============================================================================
044763| NOTE: Line comment documents intent or constraints.
044764| src/lib/search/transform.ts:209: 
044765| NOTE: Blank line for visual separation.
044766| src/lib/search/transform.ts:210: /**
044767| NOTE: Block comment line describing behavior or context.
044768| src/lib/search/transform.ts:211:  * Transform map listings to v2 map response shape.
044769| NOTE: Block comment line describing behavior or context.
044770| src/lib/search/transform.ts:212:  * Always includes geojson, conditionally includes pins based on count.
044771| NOTE: Block comment line describing behavior or context.
044772| src/lib/search/transform.ts:213:  *
044773| NOTE: Block comment line describing behavior or context.
044774| src/lib/search/transform.ts:214:  * @param listings - Array of map listing data
044775| NOTE: Block comment line describing behavior or context.
044776| src/lib/search/transform.ts:215:  * @param scoreMap - Optional score map for ranking-based pin tiering
044777| NOTE: Block comment line describing behavior or context.
044778| src/lib/search/transform.ts:216:  * @returns Object with geojson (always) and pins (when sparse)
044779| NOTE: Block comment line describing behavior or context.
044780| src/lib/search/transform.ts:217:  */
044781| NOTE: Block comment line describing behavior or context.
044782| src/lib/search/transform.ts:218: export function transformToMapResponse(
044783| NOTE: Exports helper or component function.
044784| src/lib/search/transform.ts:219:   listings: MapListingData[],
044785| NOTE: Implementation detail supporting search page behavior.
044786| src/lib/search/transform.ts:220:   scoreMap?: Map<string, number>,
044787| NOTE: Implementation detail supporting search page behavior.
044788| src/lib/search/transform.ts:221: ): {
044789| NOTE: Implementation detail supporting search page behavior.
044790| src/lib/search/transform.ts:222:   geojson: SearchV2GeoJSON;
044791| NOTE: Implementation detail supporting search page behavior.
044792| src/lib/search/transform.ts:223:   pins?: SearchV2Pin[];
044793| NOTE: Implementation detail supporting search page behavior.
044794| src/lib/search/transform.ts:224: } {
044795| NOTE: Implementation detail supporting search page behavior.
044796| src/lib/search/transform.ts:225:   const geojson = transformToGeoJSON(listings);
044797| NOTE: Local declaration used by search logic or UI.
044798| src/lib/search/transform.ts:226: 
044799| NOTE: Blank line for visual separation.
044800| src/lib/search/transform.ts:227:   if (shouldIncludePins(listings.length)) {
044801| NOTE: Conditional logic controlling rendering or flow.
044802| src/lib/search/transform.ts:228:     return {
044803| NOTE: Return statement for component or helper output.
044804| src/lib/search/transform.ts:229:       geojson,
044805| NOTE: Implementation detail supporting search page behavior.
044806| src/lib/search/transform.ts:230:       pins: transformToPins(listings, scoreMap),
044807| NOTE: Implementation detail supporting search page behavior.
044808| src/lib/search/transform.ts:231:     };
044809| NOTE: Implementation detail supporting search page behavior.
044810| src/lib/search/transform.ts:232:   }
044811| NOTE: Implementation detail supporting search page behavior.
044812| src/lib/search/transform.ts:233: 
044813| NOTE: Blank line for visual separation.
044814| src/lib/search/transform.ts:234:   return { geojson };
044815| NOTE: Return statement for component or helper output.
044816| src/lib/search/transform.ts:235: }
044817| NOTE: Implementation detail supporting search page behavior.
044818| FILE END: src/lib/search/transform.ts
044819| 
044820| FILE START: src/lib/search/types.ts
044821| FILE ROLE: Auto-discovered dependency in search page graph.
044822| src/lib/search/types.ts:1: /**
044823| NOTE: Block comment line describing behavior or context.
044824| src/lib/search/types.ts:2:  * Search API v2 - Shared Types and Constants
044825| NOTE: Block comment line describing behavior or context.
044826| src/lib/search/types.ts:3:  *
044827| NOTE: Block comment line describing behavior or context.
044828| src/lib/search/types.ts:4:  * Provides a unified response format combining list results and map data
044829| NOTE: Block comment line describing behavior or context.
044830| src/lib/search/types.ts:5:  * in a single endpoint, behind a feature flag.
044831| NOTE: Block comment line describing behavior or context.
044832| src/lib/search/types.ts:6:  */
044833| NOTE: Block comment line describing behavior or context.
044834| src/lib/search/types.ts:7: 
044835| NOTE: Blank line for visual separation.
044836| src/lib/search/types.ts:8: import type { Feature, FeatureCollection, Point } from "geojson";
044837| NOTE: Imports dependency for this module.
044838| src/lib/search/types.ts:9: 
044839| NOTE: Blank line for visual separation.
044840| src/lib/search/types.ts:10: // ============================================================================
044841| NOTE: Line comment documents intent or constraints.
044842| src/lib/search/types.ts:11: // Constants
044843| NOTE: Line comment documents intent or constraints.
044844| src/lib/search/types.ts:12: // ============================================================================
044845| NOTE: Line comment documents intent or constraints.
044846| src/lib/search/types.ts:13: 
044847| NOTE: Blank line for visual separation.
044848| src/lib/search/types.ts:14: /** Threshold for determining mode: >= 50 = 'geojson', < 50 = 'pins' */
044849| NOTE: Block comment line describing behavior or context.
044850| src/lib/search/types.ts:15: export const CLUSTER_THRESHOLD = 50;
044851| NOTE: Implementation detail supporting search page behavior.
044852| src/lib/search/types.ts:16: 
044853| NOTE: Blank line for visual separation.
044854| src/lib/search/types.ts:17: /** Bounds quantization for cache key normalization (~100m precision) */
044855| NOTE: Block comment line describing behavior or context.
044856| src/lib/search/types.ts:18: export const BOUNDS_EPSILON = 0.001;
044857| NOTE: Implementation detail supporting search page behavior.
044858| src/lib/search/types.ts:19: 
044859| NOTE: Blank line for visual separation.
044860| src/lib/search/types.ts:20: // ============================================================================
044861| NOTE: Line comment documents intent or constraints.
044862| src/lib/search/types.ts:21: // Response Types
044863| NOTE: Line comment documents intent or constraints.
044864| src/lib/search/types.ts:22: // ============================================================================
044865| NOTE: Line comment documents intent or constraints.
044866| src/lib/search/types.ts:23: 
044867| NOTE: Blank line for visual separation.
044868| src/lib/search/types.ts:24: /** Mode determines whether pins array is included (always have geojson) */
044869| NOTE: Block comment line describing behavior or context.
044870| src/lib/search/types.ts:25: export type SearchV2Mode = "geojson" | "pins";
044871| NOTE: Implementation detail supporting search page behavior.
044872| src/lib/search/types.ts:26: 
044873| NOTE: Blank line for visual separation.
044874| src/lib/search/types.ts:27: /** Properties for GeoJSON point features */
044875| NOTE: Block comment line describing behavior or context.
044876| src/lib/search/types.ts:28: export interface SearchV2FeatureProperties {
044877| NOTE: Implementation detail supporting search page behavior.
044878| src/lib/search/types.ts:29:   id: string;
044879| NOTE: Implementation detail supporting search page behavior.
044880| src/lib/search/types.ts:30:   title: string;
044881| NOTE: Implementation detail supporting search page behavior.
044882| src/lib/search/types.ts:31:   price: number | null;
044883| NOTE: Implementation detail supporting search page behavior.
044884| src/lib/search/types.ts:32:   image: string | null;
044885| NOTE: Implementation detail supporting search page behavior.
044886| src/lib/search/types.ts:33: }
044887| NOTE: Implementation detail supporting search page behavior.
044888| src/lib/search/types.ts:34: 
044889| NOTE: Blank line for visual separation.
044890| src/lib/search/types.ts:35: /** A single point feature for the map */
044891| NOTE: Block comment line describing behavior or context.
044892| src/lib/search/types.ts:36: export type SearchV2Feature = Feature<Point, SearchV2FeatureProperties>;
044893| NOTE: Implementation detail supporting search page behavior.
044894| src/lib/search/types.ts:37: 
044895| NOTE: Blank line for visual separation.
044896| src/lib/search/types.ts:38: /** GeoJSON FeatureCollection for Mapbox clustering */
044897| NOTE: Block comment line describing behavior or context.
044898| src/lib/search/types.ts:39: export type SearchV2GeoJSON = FeatureCollection<
044899| NOTE: Implementation detail supporting search page behavior.
044900| src/lib/search/types.ts:40:   Point,
044901| NOTE: Implementation detail supporting search page behavior.
044902| src/lib/search/types.ts:41:   SearchV2FeatureProperties
044903| NOTE: Implementation detail supporting search page behavior.
044904| src/lib/search/types.ts:42: >;
044905| NOTE: Implementation detail supporting search page behavior.
044906| src/lib/search/types.ts:43: 
044907| NOTE: Blank line for visual separation.
044908| src/lib/search/types.ts:44: /** List item in v2 response */
044909| NOTE: Block comment line describing behavior or context.
044910| src/lib/search/types.ts:45: export interface SearchV2ListItem {
044911| NOTE: Implementation detail supporting search page behavior.
044912| src/lib/search/types.ts:46:   id: string;
044913| NOTE: Implementation detail supporting search page behavior.
044914| src/lib/search/types.ts:47:   title: string;
044915| NOTE: Implementation detail supporting search page behavior.
044916| src/lib/search/types.ts:48:   price: number | null;
044917| NOTE: Implementation detail supporting search page behavior.
044918| src/lib/search/types.ts:49:   image: string | null;
044919| NOTE: Implementation detail supporting search page behavior.
044920| src/lib/search/types.ts:50:   lat: number;
044921| NOTE: Implementation detail supporting search page behavior.
044922| src/lib/search/types.ts:51:   lng: number;
044923| NOTE: Implementation detail supporting search page behavior.
044924| src/lib/search/types.ts:52:   /** Badges like 'near-match', 'multi-room' */
044925| NOTE: Block comment line describing behavior or context.
044926| src/lib/search/types.ts:53:   badges?: string[];
044927| NOTE: Implementation detail supporting search page behavior.
044928| src/lib/search/types.ts:54:   /** Relevance score hint for debugging/sorting */
044929| NOTE: Block comment line describing behavior or context.
044930| src/lib/search/types.ts:55:   scoreHint?: number | null;
044931| NOTE: Implementation detail supporting search page behavior.
044932| src/lib/search/types.ts:56: }
044933| NOTE: Implementation detail supporting search page behavior.
044934| src/lib/search/types.ts:57: 
044935| NOTE: Blank line for visual separation.
044936| src/lib/search/types.ts:58: /** Pin with tier information for sparse results */
044937| NOTE: Block comment line describing behavior or context.
044938| src/lib/search/types.ts:59: export interface SearchV2Pin {
044939| NOTE: Implementation detail supporting search page behavior.
044940| src/lib/search/types.ts:60:   id: string;
044941| NOTE: Implementation detail supporting search page behavior.
044942| src/lib/search/types.ts:61:   lat: number;
044943| NOTE: Implementation detail supporting search page behavior.
044944| src/lib/search/types.ts:62:   lng: number;
044945| NOTE: Implementation detail supporting search page behavior.
044946| src/lib/search/types.ts:63:   price?: number | null;
044947| NOTE: Implementation detail supporting search page behavior.
044948| src/lib/search/types.ts:64:   /** Primary pins are larger, mini pins are smaller */
044949| NOTE: Block comment line describing behavior or context.
044950| src/lib/search/types.ts:65:   tier?: "primary" | "mini";
044951| NOTE: Implementation detail supporting search page behavior.
044952| src/lib/search/types.ts:66:   /** Number of listings at this location */
044953| NOTE: Block comment line describing behavior or context.
044954| src/lib/search/types.ts:67:   stackCount?: number;
044955| NOTE: Implementation detail supporting search page behavior.
044956| src/lib/search/types.ts:68: }
044957| NOTE: Implementation detail supporting search page behavior.
044958| src/lib/search/types.ts:69: 
044959| NOTE: Blank line for visual separation.
044960| src/lib/search/types.ts:70: /** Debug signals for ranking (only in debug mode, no PII) */
044961| NOTE: Block comment line describing behavior or context.
044962| src/lib/search/types.ts:71: export interface SearchV2DebugSignals {
044963| NOTE: Implementation detail supporting search page behavior.
044964| src/lib/search/types.ts:72:   id: string;
044965| NOTE: Implementation detail supporting search page behavior.
044966| src/lib/search/types.ts:73:   quality: number;
044967| NOTE: Implementation detail supporting search page behavior.
044968| src/lib/search/types.ts:74:   rating: number;
044969| NOTE: Implementation detail supporting search page behavior.
044970| src/lib/search/types.ts:75:   price: number;
044971| NOTE: Implementation detail supporting search page behavior.
044972| src/lib/search/types.ts:76:   recency: number;
044973| NOTE: Implementation detail supporting search page behavior.
044974| src/lib/search/types.ts:77:   geo: number;
044975| NOTE: Implementation detail supporting search page behavior.
044976| src/lib/search/types.ts:78:   total: number;
044977| NOTE: Implementation detail supporting search page behavior.
044978| src/lib/search/types.ts:79: }
044979| NOTE: Implementation detail supporting search page behavior.
044980| src/lib/search/types.ts:80: 
044981| NOTE: Blank line for visual separation.
044982| src/lib/search/types.ts:81: /** Metadata about the search response */
044983| NOTE: Block comment line describing behavior or context.
044984| src/lib/search/types.ts:82: export interface SearchV2Meta {
044985| NOTE: Implementation detail supporting search page behavior.
044986| src/lib/search/types.ts:83:   /** 16-char SHA256 hash of query params (bounds quantized with BOUNDS_EPSILON) */
044987| NOTE: Block comment line describing behavior or context.
044988| src/lib/search/types.ts:84:   queryHash: string;
044989| NOTE: Implementation detail supporting search page behavior.
044990| src/lib/search/types.ts:85:   /** ISO timestamp when response was generated */
044991| NOTE: Block comment line describing behavior or context.
044992| src/lib/search/types.ts:86:   generatedAt: string;
044993| NOTE: Implementation detail supporting search page behavior.
044994| src/lib/search/types.ts:87:   /** Mode based on mapListings.length: 'geojson' if >= 50, 'pins' if < 50 */
044995| NOTE: Block comment line describing behavior or context.
044996| src/lib/search/types.ts:88:   mode: SearchV2Mode;
044997| NOTE: Implementation detail supporting search page behavior.
044998| src/lib/search/types.ts:89:   /** Ranking version (debug only, when ?debugRank=1) */
044999| NOTE: Block comment line describing behavior or context.
045000| src/lib/search/types.ts:90:   rankingVersion?: string;
045001| NOTE: Implementation detail supporting search page behavior.
045002| src/lib/search/types.ts:91:   /** Whether ranking was applied (debug only) */
045003| NOTE: Block comment line describing behavior or context.
045004| src/lib/search/types.ts:92:   rankingEnabled?: boolean;
045005| NOTE: Implementation detail supporting search page behavior.
045006| src/lib/search/types.ts:93:   /** Top signals for debugging (capped at 5, no PII, debug only) */
045007| NOTE: Block comment line describing behavior or context.
045008| src/lib/search/types.ts:94:   topSignals?: SearchV2DebugSignals[];
045009| NOTE: Implementation detail supporting search page behavior.
045010| src/lib/search/types.ts:95: }
045011| NOTE: Implementation detail supporting search page behavior.
045012| src/lib/search/types.ts:96: 
045013| NOTE: Blank line for visual separation.
045014| src/lib/search/types.ts:97: /** List section of the response */
045015| NOTE: Block comment line describing behavior or context.
045016| src/lib/search/types.ts:98: export interface SearchV2List {
045017| NOTE: Implementation detail supporting search page behavior.
045018| src/lib/search/types.ts:99:   items: SearchV2ListItem[];
045019| NOTE: Implementation detail supporting search page behavior.
045020| src/lib/search/types.ts:100:   /** Base64url encoded cursor for next page, null if no more pages */
045021| NOTE: Block comment line describing behavior or context.
045022| src/lib/search/types.ts:101:   nextCursor: string | null;
045023| NOTE: Implementation detail supporting search page behavior.
045024| src/lib/search/types.ts:102:   /** Exact total if \u2264100, null if >100 (hybrid count optimization) */
045025| NOTE: Block comment line describing behavior or context.
045026| src/lib/search/types.ts:103:   total?: number | null;
045027| NOTE: Implementation detail supporting search page behavior.
045028| src/lib/search/types.ts:104: }
045029| NOTE: Implementation detail supporting search page behavior.
045030| src/lib/search/types.ts:105: 
045031| NOTE: Blank line for visual separation.
045032| src/lib/search/types.ts:106: /** Map section of the response */
045033| NOTE: Block comment line describing behavior or context.
045034| src/lib/search/types.ts:107: export interface SearchV2Map {
045035| NOTE: Implementation detail supporting search page behavior.
045036| src/lib/search/types.ts:108:   /** ALWAYS present - GeoJSON FeatureCollection for Mapbox <Source cluster={true}> */
045037| NOTE: Block comment line describing behavior or context.
045038| src/lib/search/types.ts:109:   geojson: SearchV2GeoJSON;
045039| NOTE: Implementation detail supporting search page behavior.
045040| src/lib/search/types.ts:110:   /** ONLY when mode='pins' (sparse, <50 mapListings) - tiered pins for true-marker rendering */
045041| NOTE: Block comment line describing behavior or context.
045042| src/lib/search/types.ts:111:   pins?: SearchV2Pin[];
045043| NOTE: Implementation detail supporting search page behavior.
045044| src/lib/search/types.ts:112: }
045045| NOTE: Implementation detail supporting search page behavior.
045046| src/lib/search/types.ts:113: 
045047| NOTE: Blank line for visual separation.
045048| src/lib/search/types.ts:114: /** Complete v2 search response */
045049| NOTE: Block comment line describing behavior or context.
045050| src/lib/search/types.ts:115: export interface SearchV2Response {
045051| NOTE: Implementation detail supporting search page behavior.
045052| src/lib/search/types.ts:116:   meta: SearchV2Meta;
045053| NOTE: Implementation detail supporting search page behavior.
045054| src/lib/search/types.ts:117:   list: SearchV2List;
045055| NOTE: Implementation detail supporting search page behavior.
045056| src/lib/search/types.ts:118:   map: SearchV2Map;
045057| NOTE: Implementation detail supporting search page behavior.
045058| src/lib/search/types.ts:119: }
045059| NOTE: Implementation detail supporting search page behavior.
045060| FILE END: src/lib/search/types.ts
045061| 
045062| FILE START: src/lib/utils.ts
045063| FILE ROLE: Auto-discovered dependency in search page graph.
045064| src/lib/utils.ts:1: import { type ClassValue, clsx } from "clsx";
045065| NOTE: Imports dependency for this module.
045066| src/lib/utils.ts:2: import { twMerge } from "tailwind-merge";
045067| NOTE: Imports dependency for this module.
045068| src/lib/utils.ts:3: 
045069| NOTE: Blank line for visual separation.
045070| src/lib/utils.ts:4: export function cn(...inputs: ClassValue[]) {
045071| NOTE: Exports helper or component function.
045072| src/lib/utils.ts:5:   return twMerge(clsx(inputs));
045073| NOTE: Return statement for component or helper output.
045074| src/lib/utils.ts:6: }
045075| NOTE: Implementation detail supporting search page behavior.
045076| src/lib/utils.ts:7: 
045077| NOTE: Blank line for visual separation.
045078| src/lib/utils.ts:8: /**
045079| NOTE: Block comment line describing behavior or context.
045080| src/lib/utils.ts:9:  * Parse a YYYY-MM-DD date string as local date (not UTC)
045081| NOTE: Block comment line describing behavior or context.
045082| src/lib/utils.ts:10:  * Fixes timezone bug where new Date("2025-01-15") is parsed as UTC midnight
045083| NOTE: Block comment line describing behavior or context.
045084| src/lib/utils.ts:11:  * which can appear as the previous day in timezones behind UTC
045085| NOTE: Block comment line describing behavior or context.
045086| src/lib/utils.ts:12:  */
045087| NOTE: Block comment line describing behavior or context.
045088| src/lib/utils.ts:13: export function parseLocalDate(dateStr: string): Date {
045089| NOTE: Exports helper or component function.
045090| src/lib/utils.ts:14:   if (!dateStr) return new Date();
045091| NOTE: Conditional logic controlling rendering or flow.
045092| src/lib/utils.ts:15:   const [year, month, day] = dateStr.split("-").map(Number);
045093| NOTE: Local declaration used by search logic or UI.
045094| src/lib/utils.ts:16:   return new Date(year, month - 1, day);
045095| NOTE: Return statement for component or helper output.
045096| src/lib/utils.ts:17: }
045097| NOTE: Implementation detail supporting search page behavior.
045098| src/lib/utils.ts:18: 
045099| NOTE: Blank line for visual separation.
045100| src/lib/utils.ts:19: /**
045101| NOTE: Block comment line describing behavior or context.
045102| src/lib/utils.ts:20:  * Parse an ISO date string (from server) or Date object as local date
045103| NOTE: Block comment line describing behavior or context.
045104| src/lib/utils.ts:21:  * Extracts the YYYY-MM-DD portion and parses as local time
045105| NOTE: Block comment line describing behavior or context.
045106| src/lib/utils.ts:22:  * Handles: Date objects, ISO strings, and YYYY-MM-DD strings
045107| NOTE: Block comment line describing behavior or context.
045108| src/lib/utils.ts:23:  */
045109| NOTE: Block comment line describing behavior or context.
045110| src/lib/utils.ts:24: export function parseISODateAsLocal(dateInput: string | Date): Date {
045111| NOTE: Exports helper or component function.
045112| src/lib/utils.ts:25:   if (!dateInput) return new Date();
045113| NOTE: Conditional logic controlling rendering or flow.
045114| src/lib/utils.ts:26: 
045115| NOTE: Blank line for visual separation.
045116| src/lib/utils.ts:27:   // If it's already a Date object, extract local date parts
045117| NOTE: Line comment documents intent or constraints.
045118| src/lib/utils.ts:28:   if (dateInput instanceof Date) {
045119| NOTE: Conditional logic controlling rendering or flow.
045120| src/lib/utils.ts:29:     return new Date(
045121| NOTE: Return statement for component or helper output.
045122| src/lib/utils.ts:30:       dateInput.getFullYear(),
045123| NOTE: Implementation detail supporting search page behavior.
045124| src/lib/utils.ts:31:       dateInput.getMonth(),
045125| NOTE: Implementation detail supporting search page behavior.
045126| src/lib/utils.ts:32:       dateInput.getDate(),
045127| NOTE: Implementation detail supporting search page behavior.
045128| src/lib/utils.ts:33:     );
045129| NOTE: Implementation detail supporting search page behavior.
045130| src/lib/utils.ts:34:   }
045131| NOTE: Implementation detail supporting search page behavior.
045132| src/lib/utils.ts:35: 
045133| NOTE: Blank line for visual separation.
045134| src/lib/utils.ts:36:   // Handle both ISO strings (2025-01-15T00:00:00.000Z) and date-only strings (2025-01-15)
045135| NOTE: Line comment documents intent or constraints.
045136| src/lib/utils.ts:37:   const dateOnly = dateInput.includes("T")
045137| NOTE: Local declaration used by search logic or UI.
045138| src/lib/utils.ts:38:     ? dateInput.split("T")[0]
045139| NOTE: Implementation detail supporting search page behavior.
045140| src/lib/utils.ts:39:     : dateInput;
045141| NOTE: Implementation detail supporting search page behavior.
045142| src/lib/utils.ts:40:   return parseLocalDate(dateOnly);
045143| NOTE: Return statement for component or helper output.
045144| src/lib/utils.ts:41: }
045145| NOTE: Implementation detail supporting search page behavior.
045146| src/lib/utils.ts:42: 
045147| NOTE: Blank line for visual separation.
045148| src/lib/utils.ts:43: /**
045149| NOTE: Block comment line describing behavior or context.
045150| src/lib/utils.ts:44:  * Format a Date object to YYYY-MM-DD string using local date parts
045151| NOTE: Block comment line describing behavior or context.
045152| src/lib/utils.ts:45:  * Avoids timezone issues with toISOString()
045153| NOTE: Block comment line describing behavior or context.
045154| src/lib/utils.ts:46:  */
045155| NOTE: Block comment line describing behavior or context.
045156| src/lib/utils.ts:47: export function formatDateToYMD(date: Date): string {
045157| NOTE: Exports helper or component function.
045158| src/lib/utils.ts:48:   const year = date.getFullYear();
045159| NOTE: Local declaration used by search logic or UI.
045160| src/lib/utils.ts:49:   const month = String(date.getMonth() + 1).padStart(2, "0");
045161| NOTE: Local declaration used by search logic or UI.
045162| src/lib/utils.ts:50:   const day = String(date.getDate()).padStart(2, "0");
045163| NOTE: Local declaration used by search logic or UI.
045164| src/lib/utils.ts:51:   return `${year}-${month}-${day}`;
045165| NOTE: Return statement for component or helper output.
045166| src/lib/utils.ts:52: }
045167| NOTE: Implementation detail supporting search page behavior.
045168| FILE END: src/lib/utils.ts
045169| 
045170| FILE START: src/lib/validation.ts
045171| FILE ROLE: Auto-discovered dependency in search page graph.
045172| src/lib/validation.ts:1: /**
045173| NOTE: Block comment line describing behavior or context.
045174| src/lib/validation.ts:2:  * Bounds Validation Utility
045175| NOTE: Block comment line describing behavior or context.
045176| src/lib/validation.ts:3:  *
045177| NOTE: Block comment line describing behavior or context.
045178| src/lib/validation.ts:4:  * Validates and parses map bounding box parameters to prevent:
045179| NOTE: Block comment line describing behavior or context.
045180| src/lib/validation.ts:5:  * - NaN/Infinity attacks
045181| NOTE: Block comment line describing behavior or context.
045182| src/lib/validation.ts:6:  * - World-query full-table scans
045183| NOTE: Block comment line describing behavior or context.
045184| src/lib/validation.ts:7:  * - Out-of-range coordinates
045185| NOTE: Block comment line describing behavior or context.
045186| src/lib/validation.ts:8:  */
045187| NOTE: Block comment line describing behavior or context.
045188| src/lib/validation.ts:9: 
045189| NOTE: Blank line for visual separation.
045190| src/lib/validation.ts:10: export interface MapBounds {
045191| NOTE: Implementation detail supporting search page behavior.
045192| src/lib/validation.ts:11:   minLng: number;
045193| NOTE: Implementation detail supporting search page behavior.
045194| src/lib/validation.ts:12:   maxLng: number;
045195| NOTE: Implementation detail supporting search page behavior.
045196| src/lib/validation.ts:13:   minLat: number;
045197| NOTE: Implementation detail supporting search page behavior.
045198| src/lib/validation.ts:14:   maxLat: number;
045199| NOTE: Implementation detail supporting search page behavior.
045200| src/lib/validation.ts:15: }
045201| NOTE: Implementation detail supporting search page behavior.
045202| src/lib/validation.ts:16: 
045203| NOTE: Blank line for visual separation.
045204| src/lib/validation.ts:17: export interface BoundsValidationResult {
045205| NOTE: Implementation detail supporting search page behavior.
045206| src/lib/validation.ts:18:   valid: boolean;
045207| NOTE: Implementation detail supporting search page behavior.
045208| src/lib/validation.ts:19:   bounds?: MapBounds;
045209| NOTE: Implementation detail supporting search page behavior.
045210| src/lib/validation.ts:20:   error?: string;
045211| NOTE: Implementation detail supporting search page behavior.
045212| src/lib/validation.ts:21: }
045213| NOTE: Implementation detail supporting search page behavior.
045214| src/lib/validation.ts:22: 
045215| NOTE: Blank line for visual separation.
045216| src/lib/validation.ts:23: // Web Mercator practical limits
045217| NOTE: Line comment documents intent or constraints.
045218| src/lib/validation.ts:24: const LAT_MIN = -85;
045219| NOTE: Local declaration used by search logic or UI.
045220| src/lib/validation.ts:25: const LAT_MAX = 85;
045221| NOTE: Local declaration used by search logic or UI.
045222| src/lib/validation.ts:26: const LNG_MIN = -180;
045223| NOTE: Local declaration used by search logic or UI.
045224| src/lib/validation.ts:27: const LNG_MAX = 180;
045225| NOTE: Local declaration used by search logic or UI.
045226| src/lib/validation.ts:28: 
045227| NOTE: Blank line for visual separation.
045228| src/lib/validation.ts:29: // Maximum viewport span (5\u00B0 ~550km allows regional views with clustering)
045229| NOTE: Line comment documents intent or constraints.
045230| src/lib/validation.ts:30: // Increased from 2 to match Airbnb-style behavior: show markers at wider zoom
045231| NOTE: Line comment documents intent or constraints.
045232| src/lib/validation.ts:31: const MAX_LAT_SPAN = 5;
045233| NOTE: Local declaration used by search logic or UI.
045234| src/lib/validation.ts:32: const MAX_LNG_SPAN = 5;
045235| NOTE: Local declaration used by search logic or UI.
045236| src/lib/validation.ts:33: 
045237| NOTE: Blank line for visual separation.
045238| src/lib/validation.ts:34: /**
045239| NOTE: Block comment line describing behavior or context.
045240| src/lib/validation.ts:35:  * Validates and parses bounding box parameters from URL query string.
045241| NOTE: Block comment line describing behavior or context.
045242| src/lib/validation.ts:36:  *
045243| NOTE: Block comment line describing behavior or context.
045244| src/lib/validation.ts:37:  * @returns BoundsValidationResult with either valid bounds or an error message
045245| NOTE: Block comment line describing behavior or context.
045246| src/lib/validation.ts:38:  */
045247| NOTE: Block comment line describing behavior or context.
045248| src/lib/validation.ts:39: export function validateAndParseBounds(
045249| NOTE: Exports helper or component function.
045250| src/lib/validation.ts:40:   minLng: string | null,
045251| NOTE: Implementation detail supporting search page behavior.
045252| src/lib/validation.ts:41:   maxLng: string | null,
045253| NOTE: Implementation detail supporting search page behavior.
045254| src/lib/validation.ts:42:   minLat: string | null,
045255| NOTE: Implementation detail supporting search page behavior.
045256| src/lib/validation.ts:43:   maxLat: string | null,
045257| NOTE: Implementation detail supporting search page behavior.
045258| src/lib/validation.ts:44: ): BoundsValidationResult {
045259| NOTE: Implementation detail supporting search page behavior.
045260| src/lib/validation.ts:45:   // Require all four bounds - no full-table scans allowed
045261| NOTE: Line comment documents intent or constraints.
045262| src/lib/validation.ts:46:   if (!minLng || !maxLng || !minLat || !maxLat) {
045263| NOTE: Conditional logic controlling rendering or flow.
045264| src/lib/validation.ts:47:     return {
045265| NOTE: Return statement for component or helper output.
045266| src/lib/validation.ts:48:       valid: false,
045267| NOTE: Implementation detail supporting search page behavior.
045268| src/lib/validation.ts:49:       error: "All bounds parameters required (minLng, maxLng, minLat, maxLat)",
045269| NOTE: Implementation detail supporting search page behavior.
045270| src/lib/validation.ts:50:     };
045271| NOTE: Implementation detail supporting search page behavior.
045272| src/lib/validation.ts:51:   }
045273| NOTE: Implementation detail supporting search page behavior.
045274| src/lib/validation.ts:52: 
045275| NOTE: Blank line for visual separation.
045276| src/lib/validation.ts:53:   const parsed = {
045277| NOTE: Local declaration used by search logic or UI.
045278| src/lib/validation.ts:54:     minLng: parseFloat(minLng),
045279| NOTE: Implementation detail supporting search page behavior.
045280| src/lib/validation.ts:55:     maxLng: parseFloat(maxLng),
045281| NOTE: Implementation detail supporting search page behavior.
045282| src/lib/validation.ts:56:     minLat: parseFloat(minLat),
045283| NOTE: Implementation detail supporting search page behavior.
045284| src/lib/validation.ts:57:     maxLat: parseFloat(maxLat),
045285| NOTE: Implementation detail supporting search page behavior.
045286| src/lib/validation.ts:58:   };
045287| NOTE: Implementation detail supporting search page behavior.
045288| src/lib/validation.ts:59: 
045289| NOTE: Blank line for visual separation.
045290| src/lib/validation.ts:60:   // NaN/Infinity check
045291| NOTE: Line comment documents intent or constraints.
045292| src/lib/validation.ts:61:   if (Object.values(parsed).some((v) => !Number.isFinite(v))) {
045293| NOTE: Conditional logic controlling rendering or flow.
045294| src/lib/validation.ts:62:     return { valid: false, error: "Invalid coordinate values" };
045295| NOTE: Return statement for component or helper output.
045296| src/lib/validation.ts:63:   }
045297| NOTE: Implementation detail supporting search page behavior.
045298| src/lib/validation.ts:64: 
045299| NOTE: Blank line for visual separation.
045300| src/lib/validation.ts:65:   // Range checks
045301| NOTE: Line comment documents intent or constraints.
045302| src/lib/validation.ts:66:   if (parsed.minLat < LAT_MIN || parsed.maxLat > LAT_MAX) {
045303| NOTE: Conditional logic controlling rendering or flow.
045304| src/lib/validation.ts:67:     return { valid: false, error: "Latitude out of range" };
045305| NOTE: Return statement for component or helper output.
045306| src/lib/validation.ts:68:   }
045307| NOTE: Implementation detail supporting search page behavior.
045308| src/lib/validation.ts:69:   if (parsed.minLng < LNG_MIN || parsed.maxLng > LNG_MAX) {
045309| NOTE: Conditional logic controlling rendering or flow.
045310| src/lib/validation.ts:70:     return { valid: false, error: "Longitude out of range" };
045311| NOTE: Return statement for component or helper output.
045312| src/lib/validation.ts:71:   }
045313| NOTE: Implementation detail supporting search page behavior.
045314| src/lib/validation.ts:72: 
045315| NOTE: Blank line for visual separation.
045316| src/lib/validation.ts:73:   // Latitude order check (minLat should be < maxLat)
045317| NOTE: Line comment documents intent or constraints.
045318| src/lib/validation.ts:74:   if (parsed.minLat >= parsed.maxLat) {
045319| NOTE: Conditional logic controlling rendering or flow.
045320| src/lib/validation.ts:75:     return { valid: false, error: "Invalid latitude range" };
045321| NOTE: Return statement for component or helper output.
045322| src/lib/validation.ts:76:   }
045323| NOTE: Implementation detail supporting search page behavior.
045324| src/lib/validation.ts:77: 
045325| NOTE: Blank line for visual separation.
045326| src/lib/validation.ts:78:   // Viewport size check (handle antimeridian crossing)
045327| NOTE: Line comment documents intent or constraints.
045328| src/lib/validation.ts:79:   const crossesAntimeridian = parsed.minLng > parsed.maxLng;
045329| NOTE: Local declaration used by search logic or UI.
045330| src/lib/validation.ts:80:   const lngSpan = crossesAntimeridian
045331| NOTE: Local declaration used by search logic or UI.
045332| src/lib/validation.ts:81:     ? 180 - parsed.minLng + (parsed.maxLng + 180)
045333| NOTE: Implementation detail supporting search page behavior.
045334| src/lib/validation.ts:82:     : parsed.maxLng - parsed.minLng;
045335| NOTE: Implementation detail supporting search page behavior.
045336| src/lib/validation.ts:83:   const latSpan = parsed.maxLat - parsed.minLat;
045337| NOTE: Local declaration used by search logic or UI.
045338| src/lib/validation.ts:84: 
045339| NOTE: Blank line for visual separation.
045340| src/lib/validation.ts:85:   if (latSpan > MAX_LAT_SPAN || lngSpan > MAX_LNG_SPAN) {
045341| NOTE: Conditional logic controlling rendering or flow.
045342| src/lib/validation.ts:86:     return { valid: false, error: "Viewport too large. Zoom in further." };
045343| NOTE: Return statement for component or helper output.
045344| src/lib/validation.ts:87:   }
045345| NOTE: Implementation detail supporting search page behavior.
045346| src/lib/validation.ts:88: 
045347| NOTE: Blank line for visual separation.
045348| src/lib/validation.ts:89:   return { valid: true, bounds: parsed };
045349| NOTE: Return statement for component or helper output.
045350| src/lib/validation.ts:90: }
045351| NOTE: Implementation detail supporting search page behavior.
045352| FILE END: src/lib/validation.ts
045353| 
045354| FILE START: src/lib/with-rate-limit-redis.ts
045355| FILE ROLE: Auto-discovered dependency in search page graph.
045356| src/lib/with-rate-limit-redis.ts:1: /**
045357| NOTE: Block comment line describing behavior or context.
045358| src/lib/with-rate-limit-redis.ts:2:  * Redis-backed rate limiting wrapper for API routes.
045359| NOTE: Block comment line describing behavior or context.
045360| src/lib/with-rate-limit-redis.ts:3:  *
045361| NOTE: Block comment line describing behavior or context.
045362| src/lib/with-rate-limit-redis.ts:4:  * Uses Upstash Redis for distributed rate limiting with fail-closed behavior.
045363| NOTE: Block comment line describing behavior or context.
045364| src/lib/with-rate-limit-redis.ts:5:  * On Redis errors in production, requests are denied to prevent abuse.
045365| NOTE: Block comment line describing behavior or context.
045366| src/lib/with-rate-limit-redis.ts:6:  */
045367| NOTE: Block comment line describing behavior or context.
045368| src/lib/with-rate-limit-redis.ts:7: 
045369| NOTE: Blank line for visual separation.
045370| src/lib/with-rate-limit-redis.ts:8: import { NextResponse } from "next/server";
045371| NOTE: Imports dependency for this module.
045372| src/lib/with-rate-limit-redis.ts:9: import {
045373| NOTE: Imports dependency for this module.
045374| src/lib/with-rate-limit-redis.ts:10:   checkChatRateLimit,
045375| NOTE: Implementation detail supporting search page behavior.
045376| src/lib/with-rate-limit-redis.ts:11:   checkMapRateLimit,
045377| NOTE: Implementation detail supporting search page behavior.
045378| src/lib/with-rate-limit-redis.ts:12:   checkMetricsRateLimit,
045379| NOTE: Implementation detail supporting search page behavior.
045380| src/lib/with-rate-limit-redis.ts:13:   checkSearchCountRateLimit,
045381| NOTE: Implementation detail supporting search page behavior.
045382| src/lib/with-rate-limit-redis.ts:14: } from "./rate-limit-redis";
045383| NOTE: Implementation detail supporting search page behavior.
045384| src/lib/with-rate-limit-redis.ts:15: import { getClientIP } from "./rate-limit";
045385| NOTE: Imports dependency for this module.
045386| src/lib/with-rate-limit-redis.ts:16: import { getRequestId } from "./request-context";
045387| NOTE: Imports dependency for this module.
045388| src/lib/with-rate-limit-redis.ts:17: 
045389| NOTE: Blank line for visual separation.
045390| src/lib/with-rate-limit-redis.ts:18: export type RedisRateLimitType = "chat" | "map" | "metrics" | "search-count";
045391| NOTE: Implementation detail supporting search page behavior.
045392| src/lib/with-rate-limit-redis.ts:19: 
045393| NOTE: Blank line for visual separation.
045394| src/lib/with-rate-limit-redis.ts:20: interface RateLimitRedisOptions {
045395| NOTE: Type declaration for search data contracts.
045396| src/lib/with-rate-limit-redis.ts:21:   /** The rate limit type to check */
045397| NOTE: Block comment line describing behavior or context.
045398| src/lib/with-rate-limit-redis.ts:22:   type: RedisRateLimitType;
045399| NOTE: Implementation detail supporting search page behavior.
045400| src/lib/with-rate-limit-redis.ts:23:   /** Custom identifier (overrides default IP-based) */
045401| NOTE: Block comment line describing behavior or context.
045402| src/lib/with-rate-limit-redis.ts:24:   getIdentifier?: (request: Request) => string | Promise<string>;
045403| NOTE: Implementation detail supporting search page behavior.
045404| src/lib/with-rate-limit-redis.ts:25: }
045405| NOTE: Implementation detail supporting search page behavior.
045406| src/lib/with-rate-limit-redis.ts:26: 
045407| NOTE: Blank line for visual separation.
045408| src/lib/with-rate-limit-redis.ts:27: // Rate limit configurations for response headers
045409| NOTE: Line comment documents intent or constraints.
045410| src/lib/with-rate-limit-redis.ts:28: const RATE_LIMIT_CONFIGS: Record<
045411| NOTE: Local declaration used by search logic or UI.
045412| src/lib/with-rate-limit-redis.ts:29:   RedisRateLimitType,
045413| NOTE: Implementation detail supporting search page behavior.
045414| src/lib/with-rate-limit-redis.ts:30:   { burstLimit: number; sustainedLimit: number }
045415| NOTE: Implementation detail supporting search page behavior.
045416| src/lib/with-rate-limit-redis.ts:31: > = {
045417| NOTE: Implementation detail supporting search page behavior.
045418| src/lib/with-rate-limit-redis.ts:32:   chat: { burstLimit: 5, sustainedLimit: 30 },
045419| NOTE: Implementation detail supporting search page behavior.
045420| src/lib/with-rate-limit-redis.ts:33:   map: { burstLimit: 60, sustainedLimit: 300 },
045421| NOTE: Implementation detail supporting search page behavior.
045422| src/lib/with-rate-limit-redis.ts:34:   metrics: { burstLimit: 100, sustainedLimit: 500 },
045423| NOTE: Implementation detail supporting search page behavior.
045424| src/lib/with-rate-limit-redis.ts:35:   "search-count": { burstLimit: 30, sustainedLimit: 200 },
045425| NOTE: Implementation detail supporting search page behavior.
045426| src/lib/with-rate-limit-redis.ts:36: };
045427| NOTE: Implementation detail supporting search page behavior.
045428| src/lib/with-rate-limit-redis.ts:37: 
045429| NOTE: Blank line for visual separation.
045430| src/lib/with-rate-limit-redis.ts:38: /**
045431| NOTE: Block comment line describing behavior or context.
045432| src/lib/with-rate-limit-redis.ts:39:  * Wrapper function to add Redis-backed rate limiting to API route handlers.
045433| NOTE: Block comment line describing behavior or context.
045434| src/lib/with-rate-limit-redis.ts:40:  *
045435| NOTE: Block comment line describing behavior or context.
045436| src/lib/with-rate-limit-redis.ts:41:  * FAIL-CLOSED: On Redis errors in production, returns 429 to prevent abuse.
045437| NOTE: Block comment line describing behavior or context.
045438| src/lib/with-rate-limit-redis.ts:42:  *
045439| NOTE: Block comment line describing behavior or context.
045440| src/lib/with-rate-limit-redis.ts:43:  * @example
045441| NOTE: Block comment line describing behavior or context.
045442| src/lib/with-rate-limit-redis.ts:44:  * export async function GET(request: Request) {
045443| NOTE: Block comment line describing behavior or context.
045444| src/lib/with-rate-limit-redis.ts:45:  *   const rateLimitResponse = await withRateLimitRedis(request, { type: 'map' });
045445| NOTE: Block comment line describing behavior or context.
045446| src/lib/with-rate-limit-redis.ts:46:  *   if (rateLimitResponse) return rateLimitResponse;
045447| NOTE: Block comment line describing behavior or context.
045448| src/lib/with-rate-limit-redis.ts:47:  *
045449| NOTE: Block comment line describing behavior or context.
045450| src/lib/with-rate-limit-redis.ts:48:  *   // Your handler logic...
045451| NOTE: Block comment line describing behavior or context.
045452| src/lib/with-rate-limit-redis.ts:49:  * }
045453| NOTE: Block comment line describing behavior or context.
045454| src/lib/with-rate-limit-redis.ts:50:  */
045455| NOTE: Block comment line describing behavior or context.
045456| src/lib/with-rate-limit-redis.ts:51: export async function withRateLimitRedis(
045457| NOTE: Implementation detail supporting search page behavior.
045458| src/lib/with-rate-limit-redis.ts:52:   request: Request,
045459| NOTE: Implementation detail supporting search page behavior.
045460| src/lib/with-rate-limit-redis.ts:53:   options: RateLimitRedisOptions,
045461| NOTE: Implementation detail supporting search page behavior.
045462| src/lib/with-rate-limit-redis.ts:54: ): Promise<NextResponse | null> {
045463| NOTE: Implementation detail supporting search page behavior.
045464| src/lib/with-rate-limit-redis.ts:55:   const { type, getIdentifier } = options;
045465| NOTE: Local declaration used by search logic or UI.
045466| src/lib/with-rate-limit-redis.ts:56:   const config = RATE_LIMIT_CONFIGS[type];
045467| NOTE: Local declaration used by search logic or UI.
045468| src/lib/with-rate-limit-redis.ts:57: 
045469| NOTE: Blank line for visual separation.
045470| src/lib/with-rate-limit-redis.ts:58:   // Get identifier
045471| NOTE: Line comment documents intent or constraints.
045472| src/lib/with-rate-limit-redis.ts:59:   let identifier: string;
045473| NOTE: Local declaration used by search logic or UI.
045474| src/lib/with-rate-limit-redis.ts:60:   if (getIdentifier) {
045475| NOTE: Conditional logic controlling rendering or flow.
045476| src/lib/with-rate-limit-redis.ts:61:     identifier = await getIdentifier(request);
045477| NOTE: Implementation detail supporting search page behavior.
045478| src/lib/with-rate-limit-redis.ts:62:   } else {
045479| NOTE: Implementation detail supporting search page behavior.
045480| src/lib/with-rate-limit-redis.ts:63:     identifier = getClientIP(request);
045481| NOTE: Implementation detail supporting search page behavior.
045482| src/lib/with-rate-limit-redis.ts:64:   }
045483| NOTE: Implementation detail supporting search page behavior.
045484| src/lib/with-rate-limit-redis.ts:65: 
045485| NOTE: Blank line for visual separation.
045486| src/lib/with-rate-limit-redis.ts:66:   // Check rate limit based on type
045487| NOTE: Line comment documents intent or constraints.
045488| src/lib/with-rate-limit-redis.ts:67:   let result;
045489| NOTE: Local declaration used by search logic or UI.
045490| src/lib/with-rate-limit-redis.ts:68:   switch (type) {
045491| NOTE: Implementation detail supporting search page behavior.
045492| src/lib/with-rate-limit-redis.ts:69:     case "chat":
045493| NOTE: Implementation detail supporting search page behavior.
045494| src/lib/with-rate-limit-redis.ts:70:       result = await checkChatRateLimit(identifier);
045495| NOTE: Implementation detail supporting search page behavior.
045496| src/lib/with-rate-limit-redis.ts:71:       break;
045497| NOTE: Implementation detail supporting search page behavior.
045498| src/lib/with-rate-limit-redis.ts:72:     case "map":
045499| NOTE: Implementation detail supporting search page behavior.
045500| src/lib/with-rate-limit-redis.ts:73:       result = await checkMapRateLimit(identifier);
045501| NOTE: Implementation detail supporting search page behavior.
045502| src/lib/with-rate-limit-redis.ts:74:       break;
045503| NOTE: Implementation detail supporting search page behavior.
045504| src/lib/with-rate-limit-redis.ts:75:     case "metrics":
045505| NOTE: Implementation detail supporting search page behavior.
045506| src/lib/with-rate-limit-redis.ts:76:       result = await checkMetricsRateLimit(identifier);
045507| NOTE: Implementation detail supporting search page behavior.
045508| src/lib/with-rate-limit-redis.ts:77:       break;
045509| NOTE: Implementation detail supporting search page behavior.
045510| src/lib/with-rate-limit-redis.ts:78:     case "search-count":
045511| NOTE: Implementation detail supporting search page behavior.
045512| src/lib/with-rate-limit-redis.ts:79:       result = await checkSearchCountRateLimit(identifier);
045513| NOTE: Implementation detail supporting search page behavior.
045514| src/lib/with-rate-limit-redis.ts:80:       break;
045515| NOTE: Implementation detail supporting search page behavior.
045516| src/lib/with-rate-limit-redis.ts:81:   }
045517| NOTE: Implementation detail supporting search page behavior.
045518| src/lib/with-rate-limit-redis.ts:82: 
045519| NOTE: Blank line for visual separation.
045520| src/lib/with-rate-limit-redis.ts:83:   if (!result.success) {
045521| NOTE: Conditional logic controlling rendering or flow.
045522| src/lib/with-rate-limit-redis.ts:84:     return NextResponse.json(
045523| NOTE: Return statement for component or helper output.
045524| src/lib/with-rate-limit-redis.ts:85:       {
045525| NOTE: Implementation detail supporting search page behavior.
045526| src/lib/with-rate-limit-redis.ts:86:         error: "Too many requests",
045527| NOTE: Implementation detail supporting search page behavior.
045528| src/lib/with-rate-limit-redis.ts:87:         message: "Please wait before making more requests",
045529| NOTE: Implementation detail supporting search page behavior.
045530| src/lib/with-rate-limit-redis.ts:88:         retryAfter: result.retryAfter,
045531| NOTE: Implementation detail supporting search page behavior.
045532| src/lib/with-rate-limit-redis.ts:89:       },
045533| NOTE: Implementation detail supporting search page behavior.
045534| src/lib/with-rate-limit-redis.ts:90:       {
045535| NOTE: Implementation detail supporting search page behavior.
045536| src/lib/with-rate-limit-redis.ts:91:         status: 429,
045537| NOTE: Implementation detail supporting search page behavior.
045538| src/lib/with-rate-limit-redis.ts:92:         headers: {
045539| NOTE: Implementation detail supporting search page behavior.
045540| src/lib/with-rate-limit-redis.ts:93:           "Retry-After": String(result.retryAfter || 60),
045541| NOTE: Implementation detail supporting search page behavior.
045542| src/lib/with-rate-limit-redis.ts:94:           "X-RateLimit-Limit": String(config.burstLimit),
045543| NOTE: Implementation detail supporting search page behavior.
045544| src/lib/with-rate-limit-redis.ts:95:           "X-RateLimit-Remaining": "0",
045545| NOTE: Implementation detail supporting search page behavior.
045546| src/lib/with-rate-limit-redis.ts:96:           "x-request-id": getRequestId(),
045547| NOTE: Implementation detail supporting search page behavior.
045548| src/lib/with-rate-limit-redis.ts:97:         },
045549| NOTE: Implementation detail supporting search page behavior.
045550| src/lib/with-rate-limit-redis.ts:98:       },
045551| NOTE: Implementation detail supporting search page behavior.
045552| src/lib/with-rate-limit-redis.ts:99:     );
045553| NOTE: Implementation detail supporting search page behavior.
045554| src/lib/with-rate-limit-redis.ts:100:   }
045555| NOTE: Implementation detail supporting search page behavior.
045556| src/lib/with-rate-limit-redis.ts:101: 
045557| NOTE: Blank line for visual separation.
045558| src/lib/with-rate-limit-redis.ts:102:   return null; // No rate limit hit, proceed with handler
045559| NOTE: Return statement for component or helper output.
045560| src/lib/with-rate-limit-redis.ts:103: }
045561| NOTE: Implementation detail supporting search page behavior.
045562| src/lib/with-rate-limit-redis.ts:104: 
045563| NOTE: Blank line for visual separation.
045564| src/lib/with-rate-limit-redis.ts:105: /**
045565| NOTE: Block comment line describing behavior or context.
045566| src/lib/with-rate-limit-redis.ts:106:  * Add rate limit headers to a successful response (Redis version).
045567| NOTE: Block comment line describing behavior or context.
045568| src/lib/with-rate-limit-redis.ts:107:  */
045569| NOTE: Block comment line describing behavior or context.
045570| src/lib/with-rate-limit-redis.ts:108: export function addRedisRateLimitHeaders(
045571| NOTE: Exports helper or component function.
045572| src/lib/with-rate-limit-redis.ts:109:   response: NextResponse,
045573| NOTE: Implementation detail supporting search page behavior.
045574| src/lib/with-rate-limit-redis.ts:110:   type: RedisRateLimitType,
045575| NOTE: Implementation detail supporting search page behavior.
045576| src/lib/with-rate-limit-redis.ts:111: ): NextResponse {
045577| NOTE: Implementation detail supporting search page behavior.
045578| src/lib/with-rate-limit-redis.ts:112:   const config = RATE_LIMIT_CONFIGS[type];
045579| NOTE: Local declaration used by search logic or UI.
045580| src/lib/with-rate-limit-redis.ts:113:   response.headers.set("X-RateLimit-Limit", String(config.burstLimit));
045581| NOTE: Implementation detail supporting search page behavior.
045582| src/lib/with-rate-limit-redis.ts:114:   // Note: Redis rate limiters don't expose remaining count easily
045583| NOTE: Line comment documents intent or constraints.
045584| src/lib/with-rate-limit-redis.ts:115:   // For now, we omit X-RateLimit-Remaining on success responses
045585| NOTE: Line comment documents intent or constraints.
045586| src/lib/with-rate-limit-redis.ts:116:   return response;
045587| NOTE: Return statement for component or helper output.
045588| src/lib/with-rate-limit-redis.ts:117: }
045589| NOTE: Implementation detail supporting search page behavior.
045590| FILE END: src/lib/with-rate-limit-redis.ts
045591| 
045592| FILE START: src/lib/with-rate-limit.ts
045593| FILE ROLE: Auto-discovered dependency in search page graph.
045594| src/lib/with-rate-limit.ts:1: import { NextResponse } from "next/server";
045595| NOTE: Imports dependency for this module.
045596| src/lib/with-rate-limit.ts:2: import {
045597| NOTE: Imports dependency for this module.
045598| src/lib/with-rate-limit.ts:3:   checkRateLimit,
045599| NOTE: Implementation detail supporting search page behavior.
045600| src/lib/with-rate-limit.ts:4:   getClientIP,
045601| NOTE: Implementation detail supporting search page behavior.
045602| src/lib/with-rate-limit.ts:5:   getClientIPFromHeaders,
045603| NOTE: Implementation detail supporting search page behavior.
045604| src/lib/with-rate-limit.ts:6:   type RATE_LIMITS,
045605| NOTE: Type declaration for search data contracts.
045606| src/lib/with-rate-limit.ts:7: } from "./rate-limit";
045607| NOTE: Implementation detail supporting search page behavior.
045608| src/lib/with-rate-limit.ts:8: import { getRequestId } from "./request-context";
045609| NOTE: Imports dependency for this module.
045610| src/lib/with-rate-limit.ts:9: 
045611| NOTE: Blank line for visual separation.
045612| src/lib/with-rate-limit.ts:10: type RateLimitKey = keyof typeof RATE_LIMITS;
045613| NOTE: Type declaration for search data contracts.
045614| src/lib/with-rate-limit.ts:11: 
045615| NOTE: Blank line for visual separation.
045616| src/lib/with-rate-limit.ts:12: interface RateLimitOptions {
045617| NOTE: Type declaration for search data contracts.
045618| src/lib/with-rate-limit.ts:13:   /** The rate limit configuration key from RATE_LIMITS */
045619| NOTE: Block comment line describing behavior or context.
045620| src/lib/with-rate-limit.ts:14:   type: RateLimitKey;
045621| NOTE: Implementation detail supporting search page behavior.
045622| src/lib/with-rate-limit.ts:15:   /** Custom identifier (overrides default IP-based) */
045623| NOTE: Block comment line describing behavior or context.
045624| src/lib/with-rate-limit.ts:16:   getIdentifier?: (request: Request) => string | Promise<string>;
045625| NOTE: Implementation detail supporting search page behavior.
045626| src/lib/with-rate-limit.ts:17:   /** Custom endpoint name (defaults to request path) */
045627| NOTE: Block comment line describing behavior or context.
045628| src/lib/with-rate-limit.ts:18:   endpoint?: string;
045629| NOTE: Implementation detail supporting search page behavior.
045630| src/lib/with-rate-limit.ts:19: }
045631| NOTE: Implementation detail supporting search page behavior.
045632| src/lib/with-rate-limit.ts:20: 
045633| NOTE: Blank line for visual separation.
045634| src/lib/with-rate-limit.ts:21: /**
045635| NOTE: Block comment line describing behavior or context.
045636| src/lib/with-rate-limit.ts:22:  * Wrapper function to add rate limiting to API route handlers
045637| NOTE: Block comment line describing behavior or context.
045638| src/lib/with-rate-limit.ts:23:  *
045639| NOTE: Block comment line describing behavior or context.
045640| src/lib/with-rate-limit.ts:24:  * @example
045641| NOTE: Block comment line describing behavior or context.
045642| src/lib/with-rate-limit.ts:25:  * export async function POST(request: Request) {
045643| NOTE: Block comment line describing behavior or context.
045644| src/lib/with-rate-limit.ts:26:  *   const rateLimitResponse = await withRateLimit(request, { type: 'register' });
045645| NOTE: Block comment line describing behavior or context.
045646| src/lib/with-rate-limit.ts:27:  *   if (rateLimitResponse) return rateLimitResponse;
045647| NOTE: Block comment line describing behavior or context.
045648| src/lib/with-rate-limit.ts:28:  *
045649| NOTE: Block comment line describing behavior or context.
045650| src/lib/with-rate-limit.ts:29:  *   // Your handler logic...
045651| NOTE: Block comment line describing behavior or context.
045652| src/lib/with-rate-limit.ts:30:  * }
045653| NOTE: Block comment line describing behavior or context.
045654| src/lib/with-rate-limit.ts:31:  */
045655| NOTE: Block comment line describing behavior or context.
045656| src/lib/with-rate-limit.ts:32: export async function withRateLimit(
045657| NOTE: Implementation detail supporting search page behavior.
045658| src/lib/with-rate-limit.ts:33:   request: Request,
045659| NOTE: Implementation detail supporting search page behavior.
045660| src/lib/with-rate-limit.ts:34:   options: RateLimitOptions,
045661| NOTE: Implementation detail supporting search page behavior.
045662| src/lib/with-rate-limit.ts:35: ): Promise<NextResponse | null> {
045663| NOTE: Implementation detail supporting search page behavior.
045664| src/lib/with-rate-limit.ts:36:   const { type, getIdentifier, endpoint } = options;
045665| NOTE: Local declaration used by search logic or UI.
045666| src/lib/with-rate-limit.ts:37: 
045667| NOTE: Blank line for visual separation.
045668| src/lib/with-rate-limit.ts:38:   // Import here to avoid circular dependency
045669| NOTE: Line comment documents intent or constraints.
045670| src/lib/with-rate-limit.ts:39:   const { RATE_LIMITS } = await import("./rate-limit");
045671| NOTE: Local declaration used by search logic or UI.
045672| src/lib/with-rate-limit.ts:40:   const config = RATE_LIMITS[type];
045673| NOTE: Local declaration used by search logic or UI.
045674| src/lib/with-rate-limit.ts:41: 
045675| NOTE: Blank line for visual separation.
045676| src/lib/with-rate-limit.ts:42:   // Get identifier
045677| NOTE: Line comment documents intent or constraints.
045678| src/lib/with-rate-limit.ts:43:   let identifier: string;
045679| NOTE: Local declaration used by search logic or UI.
045680| src/lib/with-rate-limit.ts:44:   if (getIdentifier) {
045681| NOTE: Conditional logic controlling rendering or flow.
045682| src/lib/with-rate-limit.ts:45:     identifier = await getIdentifier(request);
045683| NOTE: Implementation detail supporting search page behavior.
045684| src/lib/with-rate-limit.ts:46:   } else {
045685| NOTE: Implementation detail supporting search page behavior.
045686| src/lib/with-rate-limit.ts:47:     identifier = getClientIP(request);
045687| NOTE: Implementation detail supporting search page behavior.
045688| src/lib/with-rate-limit.ts:48:   }
045689| NOTE: Implementation detail supporting search page behavior.
045690| src/lib/with-rate-limit.ts:49: 
045691| NOTE: Blank line for visual separation.
045692| src/lib/with-rate-limit.ts:50:   // Get endpoint name
045693| NOTE: Line comment documents intent or constraints.
045694| src/lib/with-rate-limit.ts:51:   const endpointName = endpoint || new URL(request.url).pathname;
045695| NOTE: Local declaration used by search logic or UI.
045696| src/lib/with-rate-limit.ts:52: 
045697| NOTE: Blank line for visual separation.
045698| src/lib/with-rate-limit.ts:53:   const result = await checkRateLimit(identifier, endpointName, config);
045699| NOTE: Local declaration used by search logic or UI.
045700| src/lib/with-rate-limit.ts:54: 
045701| NOTE: Blank line for visual separation.
045702| src/lib/with-rate-limit.ts:55:   if (!result.success) {
045703| NOTE: Conditional logic controlling rendering or flow.
045704| src/lib/with-rate-limit.ts:56:     // P2-05 FIX: Include x-request-id for complete request tracing on 429 responses
045705| NOTE: Line comment documents intent or constraints.
045706| src/lib/with-rate-limit.ts:57:     return NextResponse.json(
045707| NOTE: Return statement for component or helper output.
045708| src/lib/with-rate-limit.ts:58:       {
045709| NOTE: Implementation detail supporting search page behavior.
045710| src/lib/with-rate-limit.ts:59:         error: "Too many requests",
045711| NOTE: Implementation detail supporting search page behavior.
045712| src/lib/with-rate-limit.ts:60:         message: "Please wait before making more requests",
045713| NOTE: Implementation detail supporting search page behavior.
045714| src/lib/with-rate-limit.ts:61:         retryAfter: result.retryAfter,
045715| NOTE: Implementation detail supporting search page behavior.
045716| src/lib/with-rate-limit.ts:62:       },
045717| NOTE: Implementation detail supporting search page behavior.
045718| src/lib/with-rate-limit.ts:63:       {
045719| NOTE: Implementation detail supporting search page behavior.
045720| src/lib/with-rate-limit.ts:64:         status: 429,
045721| NOTE: Implementation detail supporting search page behavior.
045722| src/lib/with-rate-limit.ts:65:         headers: {
045723| NOTE: Implementation detail supporting search page behavior.
045724| src/lib/with-rate-limit.ts:66:           "Retry-After": String(result.retryAfter || 60),
045725| NOTE: Implementation detail supporting search page behavior.
045726| src/lib/with-rate-limit.ts:67:           "X-RateLimit-Limit": String(config.limit),
045727| NOTE: Implementation detail supporting search page behavior.
045728| src/lib/with-rate-limit.ts:68:           "X-RateLimit-Remaining": "0",
045729| NOTE: Implementation detail supporting search page behavior.
045730| src/lib/with-rate-limit.ts:69:           "X-RateLimit-Reset": result.resetAt.toISOString(),
045731| NOTE: Implementation detail supporting search page behavior.
045732| src/lib/with-rate-limit.ts:70:           "x-request-id": getRequestId(),
045733| NOTE: Implementation detail supporting search page behavior.
045734| src/lib/with-rate-limit.ts:71:         },
045735| NOTE: Implementation detail supporting search page behavior.
045736| src/lib/with-rate-limit.ts:72:       },
045737| NOTE: Implementation detail supporting search page behavior.
045738| src/lib/with-rate-limit.ts:73:     );
045739| NOTE: Implementation detail supporting search page behavior.
045740| src/lib/with-rate-limit.ts:74:   }
045741| NOTE: Implementation detail supporting search page behavior.
045742| src/lib/with-rate-limit.ts:75: 
045743| NOTE: Blank line for visual separation.
045744| src/lib/with-rate-limit.ts:76:   return null; // No rate limit hit, proceed with handler
045745| NOTE: Return statement for component or helper output.
045746| src/lib/with-rate-limit.ts:77: }
045747| NOTE: Implementation detail supporting search page behavior.
045748| src/lib/with-rate-limit.ts:78: 
045749| NOTE: Blank line for visual separation.
045750| src/lib/with-rate-limit.ts:79: /**
045751| NOTE: Block comment line describing behavior or context.
045752| src/lib/with-rate-limit.ts:80:  * Add rate limit headers to a successful response
045753| NOTE: Block comment line describing behavior or context.
045754| src/lib/with-rate-limit.ts:81:  */
045755| NOTE: Block comment line describing behavior or context.
045756| src/lib/with-rate-limit.ts:82: export function addRateLimitHeaders(
045757| NOTE: Exports helper or component function.
045758| src/lib/with-rate-limit.ts:83:   response: NextResponse,
045759| NOTE: Implementation detail supporting search page behavior.
045760| src/lib/with-rate-limit.ts:84:   remaining: number,
045761| NOTE: Implementation detail supporting search page behavior.
045762| src/lib/with-rate-limit.ts:85:   limit: number,
045763| NOTE: Implementation detail supporting search page behavior.
045764| src/lib/with-rate-limit.ts:86:   resetAt: Date,
045765| NOTE: Implementation detail supporting search page behavior.
045766| src/lib/with-rate-limit.ts:87: ): NextResponse {
045767| NOTE: Implementation detail supporting search page behavior.
045768| src/lib/with-rate-limit.ts:88:   response.headers.set("X-RateLimit-Limit", String(limit));
045769| NOTE: Implementation detail supporting search page behavior.
045770| src/lib/with-rate-limit.ts:89:   response.headers.set("X-RateLimit-Remaining", String(remaining));
045771| NOTE: Implementation detail supporting search page behavior.
045772| src/lib/with-rate-limit.ts:90:   response.headers.set("X-RateLimit-Reset", resetAt.toISOString());
045773| NOTE: Implementation detail supporting search page behavior.
045774| src/lib/with-rate-limit.ts:91:   return response;
045775| NOTE: Return statement for component or helper output.
045776| src/lib/with-rate-limit.ts:92: }
045777| NOTE: Implementation detail supporting search page behavior.
045778| src/lib/with-rate-limit.ts:93: 
045779| NOTE: Blank line for visual separation.
045780| src/lib/with-rate-limit.ts:94: export interface ServerComponentRateLimitResult {
045781| NOTE: Implementation detail supporting search page behavior.
045782| src/lib/with-rate-limit.ts:95:   allowed: boolean;
045783| NOTE: Implementation detail supporting search page behavior.
045784| src/lib/with-rate-limit.ts:96:   remaining: number;
045785| NOTE: Implementation detail supporting search page behavior.
045786| src/lib/with-rate-limit.ts:97:   retryAfter?: number;
045787| NOTE: Implementation detail supporting search page behavior.
045788| src/lib/with-rate-limit.ts:98: }
045789| NOTE: Implementation detail supporting search page behavior.
045790| src/lib/with-rate-limit.ts:99: 
045791| NOTE: Blank line for visual separation.
045792| src/lib/with-rate-limit.ts:100: /**
045793| NOTE: Block comment line describing behavior or context.
045794| src/lib/with-rate-limit.ts:101:  * Check rate limit for Server Components (which can't access Request object)
045795| NOTE: Block comment line describing behavior or context.
045796| src/lib/with-rate-limit.ts:102:  * Uses Headers object from next/headers instead.
045797| NOTE: Block comment line describing behavior or context.
045798| src/lib/with-rate-limit.ts:103:  *
045799| NOTE: Block comment line describing behavior or context.
045800| src/lib/with-rate-limit.ts:104:  * @example
045801| NOTE: Block comment line describing behavior or context.
045802| src/lib/with-rate-limit.ts:105:  * import { headers } from 'next/headers';
045803| NOTE: Block comment line describing behavior or context.
045804| src/lib/with-rate-limit.ts:106:  *
045805| NOTE: Block comment line describing behavior or context.
045806| src/lib/with-rate-limit.ts:107:  * export default async function SearchPage() {
045807| NOTE: Block comment line describing behavior or context.
045808| src/lib/with-rate-limit.ts:108:  *   const headersList = await headers();
045809| NOTE: Block comment line describing behavior or context.
045810| src/lib/with-rate-limit.ts:109:  *   const rateLimit = await checkServerComponentRateLimit(headersList, 'search', '/search');
045811| NOTE: Block comment line describing behavior or context.
045812| src/lib/with-rate-limit.ts:110:  *   if (!rateLimit.allowed) {
045813| NOTE: Block comment line describing behavior or context.
045814| src/lib/with-rate-limit.ts:111:  *     return <RateLimitError retryAfter={rateLimit.retryAfter} />;
045815| NOTE: Block comment line describing behavior or context.
045816| src/lib/with-rate-limit.ts:112:  *   }
045817| NOTE: Block comment line describing behavior or context.
045818| src/lib/with-rate-limit.ts:113:  *   // Your page logic...
045819| NOTE: Block comment line describing behavior or context.
045820| src/lib/with-rate-limit.ts:114:  * }
045821| NOTE: Block comment line describing behavior or context.
045822| src/lib/with-rate-limit.ts:115:  */
045823| NOTE: Block comment line describing behavior or context.
045824| src/lib/with-rate-limit.ts:116: export async function checkServerComponentRateLimit(
045825| NOTE: Implementation detail supporting search page behavior.
045826| src/lib/with-rate-limit.ts:117:   headersList: Headers,
045827| NOTE: Implementation detail supporting search page behavior.
045828| src/lib/with-rate-limit.ts:118:   type: RateLimitKey,
045829| NOTE: Implementation detail supporting search page behavior.
045830| src/lib/with-rate-limit.ts:119:   endpoint: string,
045831| NOTE: Implementation detail supporting search page behavior.
045832| src/lib/with-rate-limit.ts:120: ): Promise<ServerComponentRateLimitResult> {
045833| NOTE: Implementation detail supporting search page behavior.
045834| src/lib/with-rate-limit.ts:121:   // Import here to avoid circular dependency
045835| NOTE: Line comment documents intent or constraints.
045836| src/lib/with-rate-limit.ts:122:   const { RATE_LIMITS } = await import("./rate-limit");
045837| NOTE: Local declaration used by search logic or UI.
045838| src/lib/with-rate-limit.ts:123:   const config = RATE_LIMITS[type];
045839| NOTE: Local declaration used by search logic or UI.
045840| src/lib/with-rate-limit.ts:124: 
045841| NOTE: Blank line for visual separation.
045842| src/lib/with-rate-limit.ts:125:   // Get identifier from headers
045843| NOTE: Line comment documents intent or constraints.
045844| src/lib/with-rate-limit.ts:126:   const identifier = getClientIPFromHeaders(headersList);
045845| NOTE: Local declaration used by search logic or UI.
045846| src/lib/with-rate-limit.ts:127: 
045847| NOTE: Blank line for visual separation.
045848| src/lib/with-rate-limit.ts:128:   const result = await checkRateLimit(identifier, endpoint, config);
045849| NOTE: Local declaration used by search logic or UI.
045850| src/lib/with-rate-limit.ts:129: 
045851| NOTE: Blank line for visual separation.
045852| src/lib/with-rate-limit.ts:130:   return {
045853| NOTE: Return statement for component or helper output.
045854| src/lib/with-rate-limit.ts:131:     allowed: result.success,
045855| NOTE: Implementation detail supporting search page behavior.
045856| src/lib/with-rate-limit.ts:132:     remaining: result.remaining,
045857| NOTE: Implementation detail supporting search page behavior.
045858| src/lib/with-rate-limit.ts:133:     retryAfter: result.retryAfter,
045859| NOTE: Implementation detail supporting search page behavior.
045860| src/lib/with-rate-limit.ts:134:   };
045861| NOTE: Implementation detail supporting search page behavior.
045862| src/lib/with-rate-limit.ts:135: }
045863| NOTE: Implementation detail supporting search page behavior.
045864| FILE END: src/lib/with-rate-limit.ts
045865| 
045866| FILE START: src/types/pagination.ts
045867| FILE ROLE: Auto-discovered dependency in search page graph.
045868| src/types/pagination.ts:1: /**
045869| NOTE: Block comment line describing behavior or context.
045870| src/types/pagination.ts:2:  * Pagination Types for Hybrid Keyset/Offset Pagination
045871| NOTE: Block comment line describing behavior or context.
045872| src/types/pagination.ts:3:  *
045873| NOTE: Block comment line describing behavior or context.
045874| src/types/pagination.ts:4:  * Keyset pagination is used for stable sorts (newest, price_asc, price_desc)
045875| NOTE: Block comment line describing behavior or context.
045876| src/types/pagination.ts:5:  * Offset pagination is used for computed sorts (recommended, rating)
045877| NOTE: Block comment line describing behavior or context.
045878| src/types/pagination.ts:6:  *
045879| NOTE: Block comment line describing behavior or context.
045880| src/types/pagination.ts:7:  * This hybrid approach provides:
045881| NOTE: Block comment line describing behavior or context.
045882| src/types/pagination.ts:8:  * - No duplicate items across pages for keyset-eligible sorts
045883| NOTE: Block comment line describing behavior or context.
045884| src/types/pagination.ts:9:  * - Efficient queries without OFFSET performance degradation
045885| NOTE: Block comment line describing behavior or context.
045886| src/types/pagination.ts:10:  * - Full pagination UI for computed sorts where keyset isn't possible
045887| NOTE: Block comment line describing behavior or context.
045888| src/types/pagination.ts:11:  */
045889| NOTE: Block comment line describing behavior or context.
045890| src/types/pagination.ts:12: 
045891| NOTE: Blank line for visual separation.
045892| src/types/pagination.ts:13: /** Sorts eligible for keyset pagination (stable column values) */
045893| NOTE: Block comment line describing behavior or context.
045894| src/types/pagination.ts:14: export const KEYSET_SORTS = ["newest", "price_asc", "price_desc"] as const;
045895| NOTE: Implementation detail supporting search page behavior.
045896| src/types/pagination.ts:15: 
045897| NOTE: Blank line for visual separation.
045898| src/types/pagination.ts:16: /** Sorts that require offset pagination (computed aggregates) */
045899| NOTE: Block comment line describing behavior or context.
045900| src/types/pagination.ts:17: export const OFFSET_SORTS = ["recommended", "rating"] as const;
045901| NOTE: Implementation detail supporting search page behavior.
045902| src/types/pagination.ts:18: 
045903| NOTE: Blank line for visual separation.
045904| src/types/pagination.ts:19: export type KeysetSort = (typeof KEYSET_SORTS)[number];
045905| NOTE: Implementation detail supporting search page behavior.
045906| src/types/pagination.ts:20: export type OffsetSort = (typeof OFFSET_SORTS)[number];
045907| NOTE: Implementation detail supporting search page behavior.
045908| src/types/pagination.ts:21: export type SortOption = KeysetSort | OffsetSort;
045909| NOTE: Implementation detail supporting search page behavior.
045910| src/types/pagination.ts:22: 
045911| NOTE: Blank line for visual separation.
045912| src/types/pagination.ts:23: /**
045913| NOTE: Block comment line describing behavior or context.
045914| src/types/pagination.ts:24:  * Check if a sort option is eligible for keyset pagination.
045915| NOTE: Block comment line describing behavior or context.
045916| src/types/pagination.ts:25:  *
045917| NOTE: Block comment line describing behavior or context.
045918| src/types/pagination.ts:26:  * @param sort - The sort option to check
045919| NOTE: Block comment line describing behavior or context.
045920| src/types/pagination.ts:27:  * @returns true if keyset pagination can be used
045921| NOTE: Block comment line describing behavior or context.
045922| src/types/pagination.ts:28:  */
045923| NOTE: Block comment line describing behavior or context.
045924| src/types/pagination.ts:29: export function isKeysetEligible(sort: string): sort is KeysetSort {
045925| NOTE: Exports helper or component function.
045926| src/types/pagination.ts:30:   return KEYSET_SORTS.includes(sort as KeysetSort);
045927| NOTE: Return statement for component or helper output.
045928| src/types/pagination.ts:31: }
045929| NOTE: Implementation detail supporting search page behavior.
045930| src/types/pagination.ts:32: 
045931| NOTE: Blank line for visual separation.
045932| src/types/pagination.ts:33: /**
045933| NOTE: Block comment line describing behavior or context.
045934| src/types/pagination.ts:34:  * Cursor structure for keyset pagination.
045935| NOTE: Block comment line describing behavior or context.
045936| src/types/pagination.ts:35:  *
045937| NOTE: Block comment line describing behavior or context.
045938| src/types/pagination.ts:36:  * Contains the last item's sort value and ID for deterministic pagination.
045939| NOTE: Block comment line describing behavior or context.
045940| src/types/pagination.ts:37:  * The sortValue type depends on the sort:
045941| NOTE: Block comment line describing behavior or context.
045942| src/types/pagination.ts:38:  * - newest: Date ISO string (createdAt)
045943| NOTE: Block comment line describing behavior or context.
045944| src/types/pagination.ts:39:  * - price_asc/price_desc: number (price)
045945| NOTE: Block comment line describing behavior or context.
045946| src/types/pagination.ts:40:  */
045947| NOTE: Block comment line describing behavior or context.
045948| src/types/pagination.ts:41: export interface KeysetCursor {
045949| NOTE: Implementation detail supporting search page behavior.
045950| src/types/pagination.ts:42:   /** The sort column value (price or createdAt) */
045951| NOTE: Block comment line describing behavior or context.
045952| src/types/pagination.ts:43:   sortValue: number | string;
045953| NOTE: Implementation detail supporting search page behavior.
045954| src/types/pagination.ts:44:   /** The listing ID for tie-breaking */
045955| NOTE: Block comment line describing behavior or context.
045956| src/types/pagination.ts:45:   id: string;
045957| NOTE: Implementation detail supporting search page behavior.
045958| src/types/pagination.ts:46:   /** The sort type this cursor was created for */
045959| NOTE: Block comment line describing behavior or context.
045960| src/types/pagination.ts:47:   sort: KeysetSort;
045961| NOTE: Implementation detail supporting search page behavior.
045962| src/types/pagination.ts:48: }
045963| NOTE: Implementation detail supporting search page behavior.
045964| src/types/pagination.ts:49: 
045965| NOTE: Blank line for visual separation.
045966| src/types/pagination.ts:50: /**
045967| NOTE: Block comment line describing behavior or context.
045968| src/types/pagination.ts:51:  * Encode a cursor to a URL-safe base64 string.
045969| NOTE: Block comment line describing behavior or context.
045970| src/types/pagination.ts:52:  *
045971| NOTE: Block comment line describing behavior or context.
045972| src/types/pagination.ts:53:  * @param cursor - The cursor to encode
045973| NOTE: Block comment line describing behavior or context.
045974| src/types/pagination.ts:54:  * @returns URL-safe base64 encoded cursor string
045975| NOTE: Block comment line describing behavior or context.
045976| src/types/pagination.ts:55:  *
045977| NOTE: Block comment line describing behavior or context.
045978| src/types/pagination.ts:56:  * @example
045979| NOTE: Block comment line describing behavior or context.
045980| src/types/pagination.ts:57:  * ```ts
045981| NOTE: Block comment line describing behavior or context.
045982| src/types/pagination.ts:58:  * const cursor = { sortValue: 1200, id: "listing-123", sort: "price_asc" };
045983| NOTE: Block comment line describing behavior or context.
045984| src/types/pagination.ts:59:  * const encoded = encodeCursor(cursor);
045985| NOTE: Block comment line describing behavior or context.
045986| src/types/pagination.ts:60:  * // Returns: "eyJzb3J0VmFsdWUiOjEyMDAsImlkIjoibGlzdGluZy0xMjMiLCJzb3J0IjoicHJpY2VfYXNjIn0"
045987| NOTE: Block comment line describing behavior or context.
045988| src/types/pagination.ts:61:  * ```
045989| NOTE: Block comment line describing behavior or context.
045990| src/types/pagination.ts:62:  */
045991| NOTE: Block comment line describing behavior or context.
045992| src/types/pagination.ts:63: export function encodeCursor(cursor: KeysetCursor): string {
045993| NOTE: Exports helper or component function.
045994| src/types/pagination.ts:64:   const json = JSON.stringify(cursor);
045995| NOTE: Local declaration used by search logic or UI.
045996| src/types/pagination.ts:65:   // Use base64url encoding (URL-safe: no +, /, or = padding)
045997| NOTE: Line comment documents intent or constraints.
045998| src/types/pagination.ts:66:   return Buffer.from(json).toString("base64url");
045999| NOTE: Return statement for component or helper output.
046000| src/types/pagination.ts:67: }
046001| NOTE: Implementation detail supporting search page behavior.
046002| src/types/pagination.ts:68: 
046003| NOTE: Blank line for visual separation.
046004| src/types/pagination.ts:69: /**
046005| NOTE: Block comment line describing behavior or context.
046006| src/types/pagination.ts:70:  * Decode a cursor from a URL-safe base64 string.
046007| NOTE: Block comment line describing behavior or context.
046008| src/types/pagination.ts:71:  *
046009| NOTE: Block comment line describing behavior or context.
046010| src/types/pagination.ts:72:  * @param encoded - The encoded cursor string
046011| NOTE: Block comment line describing behavior or context.
046012| src/types/pagination.ts:73:  * @returns The decoded cursor, or null if invalid
046013| NOTE: Block comment line describing behavior or context.
046014| src/types/pagination.ts:74:  *
046015| NOTE: Block comment line describing behavior or context.
046016| src/types/pagination.ts:75:  * @example
046017| NOTE: Block comment line describing behavior or context.
046018| src/types/pagination.ts:76:  * ```ts
046019| NOTE: Block comment line describing behavior or context.
046020| src/types/pagination.ts:77:  * const cursor = decodeCursor("eyJzb3J0VmFsdWUiOjEyMDAsImlkIjoibGlzdGluZy0xMjMiLCJzb3J0IjoicHJpY2VfYXNjIn0");
046021| NOTE: Block comment line describing behavior or context.
046022| src/types/pagination.ts:78:  * // Returns: { sortValue: 1200, id: "listing-123", sort: "price_asc" }
046023| NOTE: Block comment line describing behavior or context.
046024| src/types/pagination.ts:79:  * ```
046025| NOTE: Block comment line describing behavior or context.
046026| src/types/pagination.ts:80:  */
046027| NOTE: Block comment line describing behavior or context.
046028| src/types/pagination.ts:81: export function decodeCursor(encoded: string): KeysetCursor | null {
046029| NOTE: Exports helper or component function.
046030| src/types/pagination.ts:82:   try {
046031| NOTE: Implementation detail supporting search page behavior.
046032| src/types/pagination.ts:83:     const json = Buffer.from(encoded, "base64url").toString("utf-8");
046033| NOTE: Local declaration used by search logic or UI.
046034| src/types/pagination.ts:84:     const parsed = JSON.parse(json);
046035| NOTE: Local declaration used by search logic or UI.
046036| src/types/pagination.ts:85: 
046037| NOTE: Blank line for visual separation.
046038| src/types/pagination.ts:86:     // Validate cursor structure
046039| NOTE: Line comment documents intent or constraints.
046040| src/types/pagination.ts:87:     if (!isValidCursor(parsed)) {
046041| NOTE: Conditional logic controlling rendering or flow.
046042| src/types/pagination.ts:88:       return null;
046043| NOTE: Return statement for component or helper output.
046044| src/types/pagination.ts:89:     }
046045| NOTE: Implementation detail supporting search page behavior.
046046| src/types/pagination.ts:90: 
046047| NOTE: Blank line for visual separation.
046048| src/types/pagination.ts:91:     return parsed;
046049| NOTE: Return statement for component or helper output.
046050| src/types/pagination.ts:92:   } catch {
046051| NOTE: Implementation detail supporting search page behavior.
046052| src/types/pagination.ts:93:     return null;
046053| NOTE: Return statement for component or helper output.
046054| src/types/pagination.ts:94:   }
046055| NOTE: Implementation detail supporting search page behavior.
046056| src/types/pagination.ts:95: }
046057| NOTE: Implementation detail supporting search page behavior.
046058| src/types/pagination.ts:96: 
046059| NOTE: Blank line for visual separation.
046060| src/types/pagination.ts:97: /**
046061| NOTE: Block comment line describing behavior or context.
046062| src/types/pagination.ts:98:  * Validate cursor structure at runtime.
046063| NOTE: Block comment line describing behavior or context.
046064| src/types/pagination.ts:99:  */
046065| NOTE: Block comment line describing behavior or context.
046066| src/types/pagination.ts:100: function isValidCursor(obj: unknown): obj is KeysetCursor {
046067| NOTE: Defines a helper or component function.
046068| src/types/pagination.ts:101:   if (!obj || typeof obj !== "object") return false;
046069| NOTE: Conditional logic controlling rendering or flow.
046070| src/types/pagination.ts:102: 
046071| NOTE: Blank line for visual separation.
046072| src/types/pagination.ts:103:   const cursor = obj as Record<string, unknown>;
046073| NOTE: Local declaration used by search logic or UI.
046074| src/types/pagination.ts:104: 
046075| NOTE: Blank line for visual separation.
046076| src/types/pagination.ts:105:   // Check required fields
046077| NOTE: Line comment documents intent or constraints.
046078| src/types/pagination.ts:106:   if (!("sortValue" in cursor) || !("id" in cursor) || !("sort" in cursor)) {
046079| NOTE: Conditional logic controlling rendering or flow.
046080| src/types/pagination.ts:107:     return false;
046081| NOTE: Return statement for component or helper output.
046082| src/types/pagination.ts:108:   }
046083| NOTE: Implementation detail supporting search page behavior.
046084| src/types/pagination.ts:109: 
046085| NOTE: Blank line for visual separation.
046086| src/types/pagination.ts:110:   // Validate types
046087| NOTE: Line comment documents intent or constraints.
046088| src/types/pagination.ts:111:   if (
046089| NOTE: Conditional logic controlling rendering or flow.
046090| src/types/pagination.ts:112:     typeof cursor.sortValue !== "number" &&
046091| NOTE: Implementation detail supporting search page behavior.
046092| src/types/pagination.ts:113:     typeof cursor.sortValue !== "string"
046093| NOTE: Implementation detail supporting search page behavior.
046094| src/types/pagination.ts:114:   ) {
046095| NOTE: Implementation detail supporting search page behavior.
046096| src/types/pagination.ts:115:     return false;
046097| NOTE: Return statement for component or helper output.
046098| src/types/pagination.ts:116:   }
046099| NOTE: Implementation detail supporting search page behavior.
046100| src/types/pagination.ts:117:   if (typeof cursor.id !== "string" || cursor.id.length === 0) {
046101| NOTE: Conditional logic controlling rendering or flow.
046102| src/types/pagination.ts:118:     return false;
046103| NOTE: Return statement for component or helper output.
046104| src/types/pagination.ts:119:   }
046105| NOTE: Implementation detail supporting search page behavior.
046106| src/types/pagination.ts:120:   if (!isKeysetEligible(cursor.sort as string)) {
046107| NOTE: Conditional logic controlling rendering or flow.
046108| src/types/pagination.ts:121:     return false;
046109| NOTE: Return statement for component or helper output.
046110| src/types/pagination.ts:122:   }
046111| NOTE: Implementation detail supporting search page behavior.
046112| src/types/pagination.ts:123: 
046113| NOTE: Blank line for visual separation.
046114| src/types/pagination.ts:124:   return true;
046115| NOTE: Return statement for component or helper output.
046116| src/types/pagination.ts:125: }
046117| NOTE: Implementation detail supporting search page behavior.
046118| src/types/pagination.ts:126: 
046119| NOTE: Blank line for visual separation.
046120| src/types/pagination.ts:127: /**
046121| NOTE: Block comment line describing behavior or context.
046122| src/types/pagination.ts:128:  * Create a cursor from a listing item.
046123| NOTE: Block comment line describing behavior or context.
046124| src/types/pagination.ts:129:  *
046125| NOTE: Block comment line describing behavior or context.
046126| src/types/pagination.ts:130:  * @param item - The listing item (must have id, price, createdAt)
046127| NOTE: Block comment line describing behavior or context.
046128| src/types/pagination.ts:131:  * @param sort - The sort type
046129| NOTE: Block comment line describing behavior or context.
046130| src/types/pagination.ts:132:  * @returns Encoded cursor string
046131| NOTE: Block comment line describing behavior or context.
046132| src/types/pagination.ts:133:  */
046133| NOTE: Block comment line describing behavior or context.
046134| src/types/pagination.ts:134: export function createCursorFromItem(
046135| NOTE: Exports helper or component function.
046136| src/types/pagination.ts:135:   item: { id: string; price?: number; createdAt?: Date | string },
046137| NOTE: Implementation detail supporting search page behavior.
046138| src/types/pagination.ts:136:   sort: KeysetSort,
046139| NOTE: Implementation detail supporting search page behavior.
046140| src/types/pagination.ts:137: ): string {
046141| NOTE: Implementation detail supporting search page behavior.
046142| src/types/pagination.ts:138:   let sortValue: number | string;
046143| NOTE: Local declaration used by search logic or UI.
046144| src/types/pagination.ts:139: 
046145| NOTE: Blank line for visual separation.
046146| src/types/pagination.ts:140:   switch (sort) {
046147| NOTE: Implementation detail supporting search page behavior.
046148| src/types/pagination.ts:141:     case "price_asc":
046149| NOTE: Implementation detail supporting search page behavior.
046150| src/types/pagination.ts:142:     case "price_desc":
046151| NOTE: Implementation detail supporting search page behavior.
046152| src/types/pagination.ts:143:       if (item.price === undefined) {
046153| NOTE: Conditional logic controlling rendering or flow.
046154| src/types/pagination.ts:144:         throw new Error("Price is required for price-based cursor");
046155| NOTE: Implementation detail supporting search page behavior.
046156| src/types/pagination.ts:145:       }
046157| NOTE: Implementation detail supporting search page behavior.
046158| src/types/pagination.ts:146:       sortValue = item.price;
046159| NOTE: Implementation detail supporting search page behavior.
046160| src/types/pagination.ts:147:       break;
046161| NOTE: Implementation detail supporting search page behavior.
046162| src/types/pagination.ts:148:     case "newest":
046163| NOTE: Implementation detail supporting search page behavior.
046164| src/types/pagination.ts:149:       if (!item.createdAt) {
046165| NOTE: Conditional logic controlling rendering or flow.
046166| src/types/pagination.ts:150:         throw new Error("createdAt is required for newest cursor");
046167| NOTE: Implementation detail supporting search page behavior.
046168| src/types/pagination.ts:151:       }
046169| NOTE: Implementation detail supporting search page behavior.
046170| src/types/pagination.ts:152:       sortValue =
046171| NOTE: Implementation detail supporting search page behavior.
046172| src/types/pagination.ts:153:         item.createdAt instanceof Date
046173| NOTE: Implementation detail supporting search page behavior.
046174| src/types/pagination.ts:154:           ? item.createdAt.toISOString()
046175| NOTE: Implementation detail supporting search page behavior.
046176| src/types/pagination.ts:155:           : item.createdAt;
046177| NOTE: Implementation detail supporting search page behavior.
046178| src/types/pagination.ts:156:       break;
046179| NOTE: Implementation detail supporting search page behavior.
046180| src/types/pagination.ts:157:   }
046181| NOTE: Implementation detail supporting search page behavior.
046182| src/types/pagination.ts:158: 
046183| NOTE: Blank line for visual separation.
046184| src/types/pagination.ts:159:   return encodeCursor({ sortValue, id: item.id, sort });
046185| NOTE: Return statement for component or helper output.
046186| src/types/pagination.ts:160: }
046187| NOTE: Implementation detail supporting search page behavior.
046188| src/types/pagination.ts:161: 
046189| NOTE: Blank line for visual separation.
046190| src/types/pagination.ts:162: /**
046191| NOTE: Block comment line describing behavior or context.
046192| src/types/pagination.ts:163:  * Keyset pagination result with cursor-based navigation.
046193| NOTE: Block comment line describing behavior or context.
046194| src/types/pagination.ts:164:  */
046195| NOTE: Block comment line describing behavior or context.
046196| src/types/pagination.ts:165: export interface KeysetPaginatedResult<T> {
046197| NOTE: Implementation detail supporting search page behavior.
046198| src/types/pagination.ts:166:   items: T[];
046199| NOTE: Implementation detail supporting search page behavior.
046200| src/types/pagination.ts:167:   /** Cursor for the next page (null if no more pages) */
046201| NOTE: Block comment line describing behavior or context.
046202| src/types/pagination.ts:168:   nextCursor: string | null;
046203| NOTE: Implementation detail supporting search page behavior.
046204| src/types/pagination.ts:169:   /** Whether there are more items after this page */
046205| NOTE: Block comment line describing behavior or context.
046206| src/types/pagination.ts:170:   hasNextPage: boolean;
046207| NOTE: Implementation detail supporting search page behavior.
046208| src/types/pagination.ts:171:   /** The sort used for this result */
046209| NOTE: Block comment line describing behavior or context.
046210| src/types/pagination.ts:172:   sort: KeysetSort;
046211| NOTE: Implementation detail supporting search page behavior.
046212| src/types/pagination.ts:173:   /** Items per page */
046213| NOTE: Block comment line describing behavior or context.
046214| src/types/pagination.ts:174:   limit: number;
046215| NOTE: Implementation detail supporting search page behavior.
046216| src/types/pagination.ts:175: }
046217| NOTE: Implementation detail supporting search page behavior.
046218| src/types/pagination.ts:176: 
046219| NOTE: Blank line for visual separation.
046220| src/types/pagination.ts:177: /**
046221| NOTE: Block comment line describing behavior or context.
046222| src/types/pagination.ts:178:  * Offset pagination result (for computed sorts).
046223| NOTE: Block comment line describing behavior or context.
046224| src/types/pagination.ts:179:  */
046225| NOTE: Block comment line describing behavior or context.
046226| src/types/pagination.ts:180: export interface OffsetPaginatedResult<T> {
046227| NOTE: Implementation detail supporting search page behavior.
046228| src/types/pagination.ts:181:   items: T[];
046229| NOTE: Implementation detail supporting search page behavior.
046230| src/types/pagination.ts:182:   /** Exact total if \u2264100, null if >100 (unknown) */
046231| NOTE: Block comment line describing behavior or context.
046232| src/types/pagination.ts:183:   total: number | null;
046233| NOTE: Implementation detail supporting search page behavior.
046234| src/types/pagination.ts:184:   /** Exact total pages if known, null otherwise */
046235| NOTE: Block comment line describing behavior or context.
046236| src/types/pagination.ts:185:   totalPages: number | null;
046237| NOTE: Implementation detail supporting search page behavior.
046238| src/types/pagination.ts:186:   /** Always known via limit+1 pattern */
046239| NOTE: Block comment line describing behavior or context.
046240| src/types/pagination.ts:187:   hasNextPage: boolean;
046241| NOTE: Implementation detail supporting search page behavior.
046242| src/types/pagination.ts:188:   /** Always known: page > 1 */
046243| NOTE: Block comment line describing behavior or context.
046244| src/types/pagination.ts:189:   hasPrevPage: boolean;
046245| NOTE: Implementation detail supporting search page behavior.
046246| src/types/pagination.ts:190:   /** Current page number (1-indexed) */
046247| NOTE: Block comment line describing behavior or context.
046248| src/types/pagination.ts:191:   page: number;
046249| NOTE: Implementation detail supporting search page behavior.
046250| src/types/pagination.ts:192:   /** Items per page */
046251| NOTE: Block comment line describing behavior or context.
046252| src/types/pagination.ts:193:   limit: number;
046253| NOTE: Implementation detail supporting search page behavior.
046254| src/types/pagination.ts:194:   /** The sort used for this result */
046255| NOTE: Block comment line describing behavior or context.
046256| src/types/pagination.ts:195:   sort: OffsetSort;
046257| NOTE: Implementation detail supporting search page behavior.
046258| src/types/pagination.ts:196: }
046259| NOTE: Implementation detail supporting search page behavior.
046260| src/types/pagination.ts:197: 
046261| NOTE: Blank line for visual separation.
046262| src/types/pagination.ts:198: /**
046263| NOTE: Block comment line describing behavior or context.
046264| src/types/pagination.ts:199:  * Union type for pagination results.
046265| NOTE: Block comment line describing behavior or context.
046266| src/types/pagination.ts:200:  * Use `isKeysetResult` to discriminate between types.
046267| NOTE: Block comment line describing behavior or context.
046268| src/types/pagination.ts:201:  */
046269| NOTE: Block comment line describing behavior or context.
046270| src/types/pagination.ts:202: export type PaginationResult<T> =
046271| NOTE: Implementation detail supporting search page behavior.
046272| src/types/pagination.ts:203:   | KeysetPaginatedResult<T>
046273| NOTE: Implementation detail supporting search page behavior.
046274| src/types/pagination.ts:204:   | OffsetPaginatedResult<T>;
046275| NOTE: Implementation detail supporting search page behavior.
046276| src/types/pagination.ts:205: 
046277| NOTE: Blank line for visual separation.
046278| src/types/pagination.ts:206: /**
046279| NOTE: Block comment line describing behavior or context.
046280| src/types/pagination.ts:207:  * Type guard to check if a result is keyset-paginated.
046281| NOTE: Block comment line describing behavior or context.
046282| src/types/pagination.ts:208:  */
046283| NOTE: Block comment line describing behavior or context.
046284| src/types/pagination.ts:209: export function isKeysetResult<T>(
046285| NOTE: Exports helper or component function.
046286| src/types/pagination.ts:210:   result: PaginationResult<T>,
046287| NOTE: Implementation detail supporting search page behavior.
046288| src/types/pagination.ts:211: ): result is KeysetPaginatedResult<T> {
046289| NOTE: Implementation detail supporting search page behavior.
046290| src/types/pagination.ts:212:   return "nextCursor" in result;
046291| NOTE: Return statement for component or helper output.
046292| src/types/pagination.ts:213: }
046293| NOTE: Implementation detail supporting search page behavior.
046294| src/types/pagination.ts:214: 
046295| NOTE: Blank line for visual separation.
046296| src/types/pagination.ts:215: /**
046297| NOTE: Block comment line describing behavior or context.
046298| src/types/pagination.ts:216:  * Type guard to check if a result is offset-paginated.
046299| NOTE: Block comment line describing behavior or context.
046300| src/types/pagination.ts:217:  */
046301| NOTE: Block comment line describing behavior or context.
046302| src/types/pagination.ts:218: export function isOffsetResult<T>(
046303| NOTE: Exports helper or component function.
046304| src/types/pagination.ts:219:   result: PaginationResult<T>,
046305| NOTE: Implementation detail supporting search page behavior.
046306| src/types/pagination.ts:220: ): result is OffsetPaginatedResult<T> {
046307| NOTE: Implementation detail supporting search page behavior.
046308| src/types/pagination.ts:221:   return "page" in result && "total" in result;
046309| NOTE: Return statement for component or helper output.
046310| src/types/pagination.ts:222: }
046311| NOTE: Implementation detail supporting search page behavior.
046312| FILE END: src/types/pagination.ts
