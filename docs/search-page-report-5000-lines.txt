0001| SECTION: REPORT METADATA
0002| Title: Roomshare Search Page Detailed Report
0003| Generated (local): 2026-01-13T15:56:55
0004| Scope: /search route UI and data flow (list view + persistent map + search form).
0005| Goal: Provide an in-detail, line-traceable report of search page behavior.
0006| 
0007| SECTION: HIGH-LEVEL ARCHITECTURE
0008| The /search route uses a persistent layout to keep the map mounted across navigation.
0009| The list results are rendered by a server component for SSR and SEO benefits.
0010| The header stays fixed and collapses on mobile; the search form drives URL state.
0011| SearchLayoutView mediates list vs map visibility and handles mobile toggles.
0012| PersistentMapWrapper loads Mapbox only when needed to reduce cost and bundle size.
0013| Search transitions use React transitions to keep the list visible during updates.
0014| 
0015| SECTION: DATA FLOW SUMMARY
0016| Incoming URL params are parsed and validated before any database queries run.
0017| Rate limiting is enforced early to protect search infrastructure.
0018| Search v2 can unify list + map data; v1 is used as fallback when v2 fails.
0019| List results are paginated and split into exact vs near-match groups.
0020| Map data is fetched client-side (or injected via v2 context) and throttled.
0021| Saved listing ids are fetched per user to decorate cards with saved state.
0022| 
0023| SECTION: UX STATES
0024| Skeletons render while list data is loading or suspended.
0025| Zero-results and low-results states offer suggestions and near-match toggles.
0026| Inline error banner supports soft retry without a full page reload.
0027| Full-page error boundary provides recovery when rendering fails.
0028| Result count announces via aria-live for accessibility.
0029| 
0030| SECTION: PERFORMANCE AND COST
0031| Map loading is deferred until the user opts in, saving Mapbox loads.
0032| Viewport validation prevents map API calls for invalid or overly wide bounds.
0033| Map fetches are throttled to protect rate limits and backend resources.
0034| List and map updates are coordinated to avoid flicker and redundant fetches.
0035| 
0036| SECTION: FILE INVENTORY (INCLUDED IN ANNOTATED LISTING)
0037| FILE: src/app/search/page.tsx | LINES: 364 | ROLE: Server component for /search results list, rate limiting, and v2/v1 fetch flow.
0038| FILE: src/app/search/layout.tsx | LINES: 64 | ROLE: Persistent layout for /search with header, map, and provider wiring.
0039| FILE: src/app/search/error.tsx | LINES: 65 | ROLE: Client error boundary for search results with retry and navigation.
0040| FILE: src/components/SearchLayoutView.tsx | LINES: 297 | ROLE: Client split-view controller for list/map and mobile toggles.
0041| FILE: src/components/SearchHeaderWrapper.tsx | LINES: 57 | ROLE: Collapsible mobile header wrapper for SearchForm.
0042| FILE: src/components/SearchForm.tsx | LINES: 1326 | ROLE: Search form UI, filters, and URL sync for the search experience.
0043| FILE: src/components/PersistentMapWrapper.tsx | LINES: 362 | ROLE: Lazy-loaded map wrapper with map data fetching and v2 context support.
0044| 
0045| SECTION: ANNOTATED LISTING
0046| Each source line is followed by a note that tags its role.
0047| 
0048| FILE START: src/app/search/page.tsx
0049| FILE ROLE: Server component for /search results list, rate limiting, and v2/v1 fetch flow.
0050| src/app/search/page.tsx:1: import { auth } from "@/auth";
0051| NOTE: Imports dependency for this module.
0052| src/app/search/page.tsx:2: import { getListingsPaginated, getSavedListingIds } from "@/lib/data";
0053| NOTE: Imports dependency for this module.
0054| src/app/search/page.tsx:3: import { Suspense } from "react";
0055| NOTE: Imports dependency for this module.
0056| src/app/search/page.tsx:4: import ListingCard from "@/components/listings/ListingCard";
0057| NOTE: Imports dependency for this module.
0058| src/app/search/page.tsx:5: import NearMatchSeparator from "@/components/listings/NearMatchSeparator";
0059| NOTE: Imports dependency for this module.
0060| src/app/search/page.tsx:6: import Pagination from "@/components/Pagination";
0061| NOTE: Imports dependency for this module.
0062| src/app/search/page.tsx:7: import SortSelect from "@/components/SortSelect";
0063| NOTE: Imports dependency for this module.
0064| src/app/search/page.tsx:8: import SaveSearchButton from "@/components/SaveSearchButton";
0065| NOTE: Imports dependency for this module.
0066| src/app/search/page.tsx:9: import ZeroResultsSuggestions from "@/components/ZeroResultsSuggestions";
0067| NOTE: Imports dependency for this module.
0068| src/app/search/page.tsx:10: import { SearchErrorBanner } from "@/components/SearchErrorBanner";
0069| NOTE: Imports dependency for this module.
0070| src/app/search/page.tsx:11: import { LowResultsGuidance } from "@/components/LowResultsGuidance";
0071| NOTE: Imports dependency for this module.
0072| src/app/search/page.tsx:12: import { Search, Clock, MapPin, Info } from "lucide-react";
0073| NOTE: Imports dependency for this module.
0074| src/app/search/page.tsx:13: import { headers } from "next/headers";
0075| NOTE: Imports dependency for this module.
0076| src/app/search/page.tsx:14: import { checkServerComponentRateLimit } from "@/lib/with-rate-limit";
0077| NOTE: Imports dependency for this module.
0078| src/app/search/page.tsx:15: import { parseSearchParams } from "@/lib/search-params";
0079| NOTE: Imports dependency for this module.
0080| src/app/search/page.tsx:16: import { features } from "@/lib/env";
0081| NOTE: Imports dependency for this module.
0082| src/app/search/page.tsx:17: import { executeSearchV2 } from "@/lib/search/search-v2-service";
0083| NOTE: Imports dependency for this module.
0084| src/app/search/page.tsx:18: import { V2MapDataSetter } from "@/components/search/V2MapDataSetter";
0085| NOTE: Imports dependency for this module.
0086| src/app/search/page.tsx:19: import type { V2MapData } from "@/contexts/SearchV2DataContext";
0087| NOTE: Imports dependency for this module.
0088| src/app/search/page.tsx:20: 
0089| NOTE: Blank line for visual separation.
0090| src/app/search/page.tsx:21: /**
0091| NOTE: Block comment line describing behavior or context.
0092| src/app/search/page.tsx:22:  * Search Page - Results List Only
0093| NOTE: Block comment line describing behavior or context.
0094| src/app/search/page.tsx:23:  *
0095| NOTE: Block comment line describing behavior or context.
0096| src/app/search/page.tsx:24:  * This page only renders the search results list.
0097| NOTE: Block comment line describing behavior or context.
0098| src/app/search/page.tsx:25:  * The header and map are rendered in layout.tsx (persistent).
0099| NOTE: Block comment line describing behavior or context.
0100| src/app/search/page.tsx:26:  *
0101| NOTE: Block comment line describing behavior or context.
0102| src/app/search/page.tsx:27:  * Benefits of this architecture:
0103| NOTE: Block comment line describing behavior or context.
0104| src/app/search/page.tsx:28:  * - Map stays mounted across URL changes (no Mapbox re-init = no extra billing)
0105| NOTE: Block comment line describing behavior or context.
0106| src/app/search/page.tsx:29:  * - Results can suspend independently via loading.tsx
0107| NOTE: Block comment line describing behavior or context.
0108| src/app/search/page.tsx:30:  * - Server-side data fetching for SEO and initial load performance
0109| NOTE: Block comment line describing behavior or context.
0110| src/app/search/page.tsx:31:  */
0111| NOTE: Block comment line describing behavior or context.
0112| src/app/search/page.tsx:32: 
0113| NOTE: Blank line for visual separation.
0114| src/app/search/page.tsx:33: // Skeleton component for listing cards during loading
0115| NOTE: Line comment documents intent or constraints.
0116| src/app/search/page.tsx:34: function ListingSkeleton() {
0117| NOTE: Defines a helper or component function.
0118| src/app/search/page.tsx:35:   return (
0119| NOTE: Return statement for component or helper output.
0120| src/app/search/page.tsx:36:     <div className="px-4 sm:px-6 py-4 sm:py-6 max-w-[840px] mx-auto pb-24 md:pb-6">
0121| NOTE: Tailwind classes define layout and styling.
0122| src/app/search/page.tsx:37:       <div className="flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6">
0123| NOTE: Tailwind classes define layout and styling.
0124| src/app/search/page.tsx:38:         <div>
0125| NOTE: JSX markup for search UI.
0126| src/app/search/page.tsx:39:           <div className="h-6 w-48 bg-zinc-200 dark:bg-zinc-700 rounded animate-pulse" />
0127| NOTE: Tailwind classes define layout and styling.
0128| src/app/search/page.tsx:40:           <div className="h-4 w-64 bg-zinc-100 dark:bg-zinc-800 rounded mt-2 animate-pulse" />
0129| NOTE: Tailwind classes define layout and styling.
0130| src/app/search/page.tsx:41:         </div>
0131| NOTE: JSX markup for search UI.
0132| src/app/search/page.tsx:42:         <div className="flex items-center gap-2 sm:gap-3">
0133| NOTE: Tailwind classes define layout and styling.
0134| src/app/search/page.tsx:43:           <div className="h-9 w-24 bg-zinc-100 dark:bg-zinc-800 rounded-lg animate-pulse" />
0135| NOTE: Tailwind classes define layout and styling.
0136| src/app/search/page.tsx:44:           <div className="h-9 w-32 bg-zinc-100 dark:bg-zinc-800 rounded-lg animate-pulse" />
0137| NOTE: Tailwind classes define layout and styling.
0138| src/app/search/page.tsx:45:         </div>
0139| NOTE: JSX markup for search UI.
0140| src/app/search/page.tsx:46:       </div>
0141| NOTE: JSX markup for search UI.
0142| src/app/search/page.tsx:47:       <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-x-6 sm:gap-y-8">
0143| NOTE: Tailwind classes define layout and styling.
0144| src/app/search/page.tsx:48:         {[...Array(6)].map((_, i) => (
0145| NOTE: Implementation detail supporting search page behavior.
0146| src/app/search/page.tsx:49:           <div
0147| NOTE: JSX markup for search UI.
0148| src/app/search/page.tsx:50:             key={i}
0149| NOTE: Implementation detail supporting search page behavior.
0150| src/app/search/page.tsx:51:             className="bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-100 dark:border-zinc-800 overflow-hidden animate-pulse"
0151| NOTE: Tailwind classes define layout and styling.
0152| src/app/search/page.tsx:52:           >
0153| NOTE: Implementation detail supporting search page behavior.
0154| src/app/search/page.tsx:53:             <div className="aspect-[4/3] bg-zinc-200 dark:bg-zinc-700" />
0155| NOTE: Tailwind classes define layout and styling.
0156| src/app/search/page.tsx:54:             <div className="p-4 space-y-3">
0157| NOTE: Tailwind classes define layout and styling.
0158| src/app/search/page.tsx:55:               <div className="h-5 bg-zinc-200 dark:bg-zinc-700 rounded w-3/4" />
0159| NOTE: Tailwind classes define layout and styling.
0160| src/app/search/page.tsx:56:               <div className="h-4 bg-zinc-100 dark:bg-zinc-800 rounded w-1/2" />
0161| NOTE: Tailwind classes define layout and styling.
0162| src/app/search/page.tsx:57:               <div className="flex justify-between items-center pt-2">
0163| NOTE: Tailwind classes define layout and styling.
0164| src/app/search/page.tsx:58:                 <div className="h-5 bg-zinc-200 dark:bg-zinc-700 rounded w-20" />
0165| NOTE: Tailwind classes define layout and styling.
0166| src/app/search/page.tsx:59:                 <div className="h-8 w-8 bg-zinc-100 dark:bg-zinc-800 rounded-full" />
0167| NOTE: Tailwind classes define layout and styling.
0168| src/app/search/page.tsx:60:               </div>
0169| NOTE: JSX markup for search UI.
0170| src/app/search/page.tsx:61:             </div>
0171| NOTE: JSX markup for search UI.
0172| src/app/search/page.tsx:62:           </div>
0173| NOTE: JSX markup for search UI.
0174| src/app/search/page.tsx:63:         ))}
0175| NOTE: Implementation detail supporting search page behavior.
0176| src/app/search/page.tsx:64:       </div>
0177| NOTE: JSX markup for search UI.
0178| src/app/search/page.tsx:65:     </div>
0179| NOTE: JSX markup for search UI.
0180| src/app/search/page.tsx:66:   );
0181| NOTE: Implementation detail supporting search page behavior.
0182| src/app/search/page.tsx:67: }
0183| NOTE: Implementation detail supporting search page behavior.
0184| src/app/search/page.tsx:68: 
0185| NOTE: Blank line for visual separation.
0186| src/app/search/page.tsx:69: const ITEMS_PER_PAGE = 12;
0187| NOTE: Local declaration used by search logic or UI.
0188| src/app/search/page.tsx:70: 
0189| NOTE: Blank line for visual separation.
0190| src/app/search/page.tsx:71: export default async function SearchPage({
0191| NOTE: Implementation detail supporting search page behavior.
0192| src/app/search/page.tsx:72:   searchParams,
0193| NOTE: Implementation detail supporting search page behavior.
0194| src/app/search/page.tsx:73: }: {
0195| NOTE: Implementation detail supporting search page behavior.
0196| src/app/search/page.tsx:74:   searchParams: Promise<{
0197| NOTE: Implementation detail supporting search page behavior.
0198| src/app/search/page.tsx:75:     q?: string;
0199| NOTE: Implementation detail supporting search page behavior.
0200| src/app/search/page.tsx:76:     minPrice?: string;
0201| NOTE: Implementation detail supporting search page behavior.
0202| src/app/search/page.tsx:77:     maxPrice?: string;
0203| NOTE: Implementation detail supporting search page behavior.
0204| src/app/search/page.tsx:78:     amenities?: string | string[];
0205| NOTE: Implementation detail supporting search page behavior.
0206| src/app/search/page.tsx:79:     moveInDate?: string;
0207| NOTE: Implementation detail supporting search page behavior.
0208| src/app/search/page.tsx:80:     leaseDuration?: string;
0209| NOTE: Implementation detail supporting search page behavior.
0210| src/app/search/page.tsx:81:     houseRules?: string | string[];
0211| NOTE: Implementation detail supporting search page behavior.
0212| src/app/search/page.tsx:82:     languages?: string | string[];
0213| NOTE: Implementation detail supporting search page behavior.
0214| src/app/search/page.tsx:83:     roomType?: string;
0215| NOTE: Implementation detail supporting search page behavior.
0216| src/app/search/page.tsx:84:     minLat?: string;
0217| NOTE: Implementation detail supporting search page behavior.
0218| src/app/search/page.tsx:85:     maxLat?: string;
0219| NOTE: Implementation detail supporting search page behavior.
0220| src/app/search/page.tsx:86:     minLng?: string;
0221| NOTE: Implementation detail supporting search page behavior.
0222| src/app/search/page.tsx:87:     maxLng?: string;
0223| NOTE: Implementation detail supporting search page behavior.
0224| src/app/search/page.tsx:88:     lat?: string;
0225| NOTE: Implementation detail supporting search page behavior.
0226| src/app/search/page.tsx:89:     lng?: string;
0227| NOTE: Implementation detail supporting search page behavior.
0228| src/app/search/page.tsx:90:     page?: string;
0229| NOTE: Implementation detail supporting search page behavior.
0230| src/app/search/page.tsx:91:     sort?: string;
0231| NOTE: Implementation detail supporting search page behavior.
0232| src/app/search/page.tsx:92:     nearMatches?: string;
0233| NOTE: Implementation detail supporting search page behavior.
0234| src/app/search/page.tsx:93:     /** Feature flag override for Search API v2 (unified list + map) */
0235| NOTE: Block comment line describing behavior or context.
0236| src/app/search/page.tsx:94:     searchV2?: string;
0237| NOTE: Implementation detail supporting search page behavior.
0238| src/app/search/page.tsx:95:   }>;
0239| NOTE: Implementation detail supporting search page behavior.
0240| src/app/search/page.tsx:96: }) {
0241| NOTE: Implementation detail supporting search page behavior.
0242| src/app/search/page.tsx:97:   const rawParams = await searchParams;
0243| NOTE: Local declaration used by search logic or UI.
0244| src/app/search/page.tsx:98: 
0245| NOTE: Blank line for visual separation.
0246| src/app/search/page.tsx:99:   // P0 fix: Rate limit check before any database queries
0247| NOTE: Line comment documents intent or constraints.
0248| src/app/search/page.tsx:100:   const headersList = await headers();
0249| NOTE: Local declaration used by search logic or UI.
0250| src/app/search/page.tsx:101:   const rateLimit = await checkServerComponentRateLimit(
0251| NOTE: Local declaration used by search logic or UI.
0252| src/app/search/page.tsx:102:     headersList,
0253| NOTE: Implementation detail supporting search page behavior.
0254| src/app/search/page.tsx:103:     "search",
0255| NOTE: Implementation detail supporting search page behavior.
0256| src/app/search/page.tsx:104:     "/search",
0257| NOTE: Implementation detail supporting search page behavior.
0258| src/app/search/page.tsx:105:   );
0259| NOTE: Implementation detail supporting search page behavior.
0260| src/app/search/page.tsx:106:   if (!rateLimit.allowed) {
0261| NOTE: Conditional logic controlling rendering or flow.
0262| src/app/search/page.tsx:107:     return (
0263| NOTE: Return statement for component or helper output.
0264| src/app/search/page.tsx:108:       <div className="min-h-screen flex items-center justify-center bg-zinc-50 dark:bg-zinc-950">
0265| NOTE: Tailwind classes define layout and styling.
0266| src/app/search/page.tsx:109:         <div className="text-center p-8 max-w-md">
0267| NOTE: Tailwind classes define layout and styling.
0268| src/app/search/page.tsx:110:           <div className="w-16 h-16 mx-auto mb-6 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center">
0269| NOTE: Tailwind classes define layout and styling.
0270| src/app/search/page.tsx:111:             <Clock className="w-8 h-8 text-amber-600 dark:text-amber-400" />
0271| NOTE: Tailwind classes define layout and styling.
0272| src/app/search/page.tsx:112:           </div>
0273| NOTE: JSX markup for search UI.
0274| src/app/search/page.tsx:113:           <h1 className="text-2xl font-bold text-zinc-900 dark:text-white mb-3">
0275| NOTE: Tailwind classes define layout and styling.
0276| src/app/search/page.tsx:114:             Too Many Requests
0277| NOTE: Implementation detail supporting search page behavior.
0278| src/app/search/page.tsx:115:           </h1>
0279| NOTE: JSX markup for search UI.
0280| src/app/search/page.tsx:116:           <p className="text-zinc-600 dark:text-zinc-400 mb-6">
0281| NOTE: Tailwind classes define layout and styling.
0282| src/app/search/page.tsx:117:             You are searching too quickly. Please wait a moment before trying
0283| NOTE: Implementation detail supporting search page behavior.
0284| src/app/search/page.tsx:118:             again.
0285| NOTE: Implementation detail supporting search page behavior.
0286| src/app/search/page.tsx:119:           </p>
0287| NOTE: JSX markup for search UI.
0288| src/app/search/page.tsx:120:           <p className="text-sm text-zinc-500 dark:text-zinc-500">
0289| NOTE: Tailwind classes define layout and styling.
0290| src/app/search/page.tsx:121:             Try again in {rateLimit.retryAfter || 60} seconds
0291| NOTE: Implementation detail supporting search page behavior.
0292| src/app/search/page.tsx:122:           </p>
0293| NOTE: JSX markup for search UI.
0294| src/app/search/page.tsx:123:         </div>
0295| NOTE: JSX markup for search UI.
0296| src/app/search/page.tsx:124:       </div>
0297| NOTE: JSX markup for search UI.
0298| src/app/search/page.tsx:125:     );
0299| NOTE: Implementation detail supporting search page behavior.
0300| src/app/search/page.tsx:126:   }
0301| NOTE: Implementation detail supporting search page behavior.
0302| src/app/search/page.tsx:127: 
0303| NOTE: Blank line for visual separation.
0304| src/app/search/page.tsx:128:   const session = await auth();
0305| NOTE: Local declaration used by search logic or UI.
0306| src/app/search/page.tsx:129:   const userId = session?.user?.id;
0307| NOTE: Local declaration used by search logic or UI.
0308| src/app/search/page.tsx:130: 
0309| NOTE: Blank line for visual separation.
0310| src/app/search/page.tsx:131:   const { q, filterParams, requestedPage, sortOption } =
0311| NOTE: Local declaration used by search logic or UI.
0312| src/app/search/page.tsx:132:     parseSearchParams(rawParams);
0313| NOTE: Implementation detail supporting search page behavior.
0314| src/app/search/page.tsx:133: 
0315| NOTE: Blank line for visual separation.
0316| src/app/search/page.tsx:134:   // Detect v2 mode: global feature flag OR URL param override (?searchV2=1)
0317| NOTE: Line comment documents intent or constraints.
0318| src/app/search/page.tsx:135:   const useV2 = features.searchV2 || rawParams.searchV2 === "1";
0319| NOTE: Local declaration used by search logic or UI.
0320| src/app/search/page.tsx:136: 
0321| NOTE: Blank line for visual separation.
0322| src/app/search/page.tsx:137:   // Fetch listings with error handling - graceful degradation instead of error boundary
0323| NOTE: Line comment documents intent or constraints.
0324| src/app/search/page.tsx:138:   let paginatedResult;
0325| NOTE: Local declaration used by search logic or UI.
0326| src/app/search/page.tsx:139:   let fetchError: string | null = null;
0327| NOTE: Local declaration used by search logic or UI.
0328| src/app/search/page.tsx:140:   let v2MapData: V2MapData | null = null;
0329| NOTE: Local declaration used by search logic or UI.
0330| src/app/search/page.tsx:141: 
0331| NOTE: Blank line for visual separation.
0332| src/app/search/page.tsx:142:   if (useV2) {
0333| NOTE: Conditional logic controlling rendering or flow.
0334| src/app/search/page.tsx:143:     // V2 path: unified fetch for list + map data
0335| NOTE: Line comment documents intent or constraints.
0336| src/app/search/page.tsx:144:     const v2Result = await executeSearchV2({
0337| NOTE: Local declaration used by search logic or UI.
0338| src/app/search/page.tsx:145:       rawParams: rawParams as Record<string, string>,
0339| NOTE: Implementation detail supporting search page behavior.
0340| src/app/search/page.tsx:146:       limit: ITEMS_PER_PAGE,
0341| NOTE: Implementation detail supporting search page behavior.
0342| src/app/search/page.tsx:147:     });
0343| NOTE: Implementation detail supporting search page behavior.
0344| src/app/search/page.tsx:148: 
0345| NOTE: Blank line for visual separation.
0346| src/app/search/page.tsx:149:     if (v2Result.response && v2Result.paginatedResult) {
0347| NOTE: Conditional logic controlling rendering or flow.
0348| src/app/search/page.tsx:150:       // Extract map data for context injection
0349| NOTE: Line comment documents intent or constraints.
0350| src/app/search/page.tsx:151:       v2MapData = {
0351| NOTE: Implementation detail supporting search page behavior.
0352| src/app/search/page.tsx:152:         geojson: v2Result.response.map.geojson,
0353| NOTE: Implementation detail supporting search page behavior.
0354| src/app/search/page.tsx:153:         pins: v2Result.response.map.pins,
0355| NOTE: Implementation detail supporting search page behavior.
0356| src/app/search/page.tsx:154:         mode: v2Result.response.meta.mode,
0357| NOTE: Implementation detail supporting search page behavior.
0358| src/app/search/page.tsx:155:       };
0359| NOTE: Implementation detail supporting search page behavior.
0360| src/app/search/page.tsx:156:       paginatedResult = v2Result.paginatedResult;
0361| NOTE: Implementation detail supporting search page behavior.
0362| src/app/search/page.tsx:157:     } else {
0363| NOTE: Implementation detail supporting search page behavior.
0364| src/app/search/page.tsx:158:       // V2 failed, fall back to v1 path
0365| NOTE: Line comment documents intent or constraints.
0366| src/app/search/page.tsx:159:       fetchError = v2Result.error || null;
0367| NOTE: Implementation detail supporting search page behavior.
0368| src/app/search/page.tsx:160:     }
0369| NOTE: Implementation detail supporting search page behavior.
0370| src/app/search/page.tsx:161:   }
0371| NOTE: Implementation detail supporting search page behavior.
0372| src/app/search/page.tsx:162: 
0373| NOTE: Blank line for visual separation.
0374| src/app/search/page.tsx:163:   // V1 path (or fallback when v2 fails)
0375| NOTE: Line comment documents intent or constraints.
0376| src/app/search/page.tsx:164:   if (!paginatedResult) {
0377| NOTE: Conditional logic controlling rendering or flow.
0378| src/app/search/page.tsx:165:     try {
0379| NOTE: Implementation detail supporting search page behavior.
0380| src/app/search/page.tsx:166:       paginatedResult = await getListingsPaginated({
0381| NOTE: Implementation detail supporting search page behavior.
0382| src/app/search/page.tsx:167:         ...filterParams,
0383| NOTE: Implementation detail supporting search page behavior.
0384| src/app/search/page.tsx:168:         page: requestedPage,
0385| NOTE: Implementation detail supporting search page behavior.
0386| src/app/search/page.tsx:169:         limit: ITEMS_PER_PAGE,
0387| NOTE: Implementation detail supporting search page behavior.
0388| src/app/search/page.tsx:170:       });
0389| NOTE: Implementation detail supporting search page behavior.
0390| src/app/search/page.tsx:171:     } catch (err) {
0391| NOTE: Implementation detail supporting search page behavior.
0392| src/app/search/page.tsx:172:       console.error("Search listings fetch failed:", err);
0393| NOTE: Implementation detail supporting search page behavior.
0394| src/app/search/page.tsx:173:       fetchError =
0395| NOTE: Implementation detail supporting search page behavior.
0396| src/app/search/page.tsx:174:         err instanceof Error
0397| NOTE: Implementation detail supporting search page behavior.
0398| src/app/search/page.tsx:175:           ? err.message
0399| NOTE: Implementation detail supporting search page behavior.
0400| src/app/search/page.tsx:176:           : "Unable to load listings. Please try again.";
0401| NOTE: Implementation detail supporting search page behavior.
0402| src/app/search/page.tsx:177:       // Provide empty fallback to render gracefully
0403| NOTE: Line comment documents intent or constraints.
0404| src/app/search/page.tsx:178:       paginatedResult = {
0405| NOTE: Implementation detail supporting search page behavior.
0406| src/app/search/page.tsx:179:         items: [],
0407| NOTE: Implementation detail supporting search page behavior.
0408| src/app/search/page.tsx:180:         total: 0,
0409| NOTE: Implementation detail supporting search page behavior.
0410| src/app/search/page.tsx:181:         totalPages: 0,
0411| NOTE: Implementation detail supporting search page behavior.
0412| src/app/search/page.tsx:182:         hasNextPage: false,
0413| NOTE: Implementation detail supporting search page behavior.
0414| src/app/search/page.tsx:183:         hasPrevPage: false,
0415| NOTE: Implementation detail supporting search page behavior.
0416| src/app/search/page.tsx:184:         page: requestedPage,
0417| NOTE: Implementation detail supporting search page behavior.
0418| src/app/search/page.tsx:185:       };
0419| NOTE: Implementation detail supporting search page behavior.
0420| src/app/search/page.tsx:186:     }
0421| NOTE: Implementation detail supporting search page behavior.
0422| src/app/search/page.tsx:187:   }
0423| NOTE: Implementation detail supporting search page behavior.
0424| src/app/search/page.tsx:188: 
0425| NOTE: Blank line for visual separation.
0426| src/app/search/page.tsx:189:   // Non-critical data - graceful degradation
0427| NOTE: Line comment documents intent or constraints.
0428| src/app/search/page.tsx:190:   // Note: Map data is now fetched client-side by PersistentMapWrapper in layout.tsx
0429| NOTE: Line comment documents intent or constraints.
0430| src/app/search/page.tsx:191:   const savedListingIds = userId
0431| NOTE: Local declaration used by search logic or UI.
0432| src/app/search/page.tsx:192:     ? await getSavedListingIds(userId).catch(() => [])
0433| NOTE: Implementation detail supporting search page behavior.
0434| src/app/search/page.tsx:193:     : [];
0435| NOTE: Implementation detail supporting search page behavior.
0436| src/app/search/page.tsx:194: 
0437| NOTE: Blank line for visual separation.
0438| src/app/search/page.tsx:195:   const {
0439| NOTE: Local declaration used by search logic or UI.
0440| src/app/search/page.tsx:196:     items: listings,
0441| NOTE: Implementation detail supporting search page behavior.
0442| src/app/search/page.tsx:197:     total,
0443| NOTE: Implementation detail supporting search page behavior.
0444| src/app/search/page.tsx:198:     totalPages,
0445| NOTE: Implementation detail supporting search page behavior.
0446| src/app/search/page.tsx:199:     hasNextPage,
0447| NOTE: Implementation detail supporting search page behavior.
0448| src/app/search/page.tsx:200:     hasPrevPage,
0449| NOTE: Implementation detail supporting search page behavior.
0450| src/app/search/page.tsx:201:     page: currentPage,
0451| NOTE: Implementation detail supporting search page behavior.
0452| src/app/search/page.tsx:202:     nearMatchCount,
0453| NOTE: Implementation detail supporting search page behavior.
0454| src/app/search/page.tsx:203:   } = paginatedResult;
0455| NOTE: Implementation detail supporting search page behavior.
0456| src/app/search/page.tsx:204: 
0457| NOTE: Blank line for visual separation.
0458| src/app/search/page.tsx:205:   // Filter suggestions are now lazy-loaded by ZeroResultsSuggestions component
0459| NOTE: Line comment documents intent or constraints.
0460| src/app/search/page.tsx:206: 
0461| NOTE: Blank line for visual separation.
0462| src/app/search/page.tsx:207:   const listContent = (
0463| NOTE: Local declaration used by search logic or UI.
0464| src/app/search/page.tsx:208:     <div className="flex flex-col">
0465| NOTE: Tailwind classes define layout and styling.
0466| src/app/search/page.tsx:209:       {/* Inject v2 map data into context for PersistentMapWrapper (renders nothing) */}
0467| NOTE: Implementation detail supporting search page behavior.
0468| src/app/search/page.tsx:210:       {v2MapData && <V2MapDataSetter data={v2MapData} />}
0469| NOTE: Implementation detail supporting search page behavior.
0470| src/app/search/page.tsx:211: 
0471| NOTE: Blank line for visual separation.
0472| src/app/search/page.tsx:212:       {/* Error banner - shows when fetch failed, with retry */}
0473| NOTE: Implementation detail supporting search page behavior.
0474| src/app/search/page.tsx:213:       {fetchError && <SearchErrorBanner message={fetchError} />}
0475| NOTE: Implementation detail supporting search page behavior.
0476| src/app/search/page.tsx:214: 
0477| NOTE: Blank line for visual separation.
0478| src/app/search/page.tsx:215:       <div className="px-4 sm:px-6 py-4 sm:py-6 max-w-[840px] mx-auto pb-24 md:pb-6">
0479| NOTE: Tailwind classes define layout and styling.
0480| src/app/search/page.tsx:216:         {/* Screen reader announcement for search results */}
0481| NOTE: Implementation detail supporting search page behavior.
0482| src/app/search/page.tsx:217:         <div aria-live="polite" aria-atomic="true" className="sr-only">
0483| NOTE: Tailwind classes define layout and styling.
0484| src/app/search/page.tsx:218:           {listings.length === 0
0485| NOTE: Implementation detail supporting search page behavior.
0486| src/app/search/page.tsx:219:             ? `No listings found${q ? ` for "${q}"` : ""}`
0487| NOTE: Implementation detail supporting search page behavior.
0488| src/app/search/page.tsx:220:             : total !== null
0489| NOTE: Implementation detail supporting search page behavior.
0490| src/app/search/page.tsx:221:               ? `Found ${total} ${total === 1 ? "listing" : "listings"}${q ? ` for "${q}"` : ""}`
0491| NOTE: Implementation detail supporting search page behavior.
0492| src/app/search/page.tsx:222:               : `Found 100+ listings${q ? ` for "${q}"` : ""}`}
0493| NOTE: Implementation detail supporting search page behavior.
0494| src/app/search/page.tsx:223:         </div>
0495| NOTE: JSX markup for search UI.
0496| src/app/search/page.tsx:224: 
0497| NOTE: Blank line for visual separation.
0498| src/app/search/page.tsx:225:         <div className="flex flex-col sm:flex-row sm:items-end justify-between gap-4 mb-6">
0499| NOTE: Tailwind classes define layout and styling.
0500| src/app/search/page.tsx:226:           <div>
0501| NOTE: JSX markup for search UI.
0502| src/app/search/page.tsx:227:             {/* tabIndex -1 allows programmatic focus for screen readers */}
0503| NOTE: Implementation detail supporting search page behavior.
0504| src/app/search/page.tsx:228:             <h1
0505| NOTE: JSX markup for search UI.
0506| src/app/search/page.tsx:229:               id="search-results-heading"
0507| NOTE: Implementation detail supporting search page behavior.
0508| src/app/search/page.tsx:230:               tabIndex={-1}
0509| NOTE: Implementation detail supporting search page behavior.
0510| src/app/search/page.tsx:231:               className="text-lg sm:text-xl font-semibold text-zinc-900 dark:text-white tracking-tight outline-none"
0511| NOTE: Tailwind classes define layout and styling.
0512| src/app/search/page.tsx:232:             >
0513| NOTE: Implementation detail supporting search page behavior.
0514| src/app/search/page.tsx:233:               {total !== null ? (
0515| NOTE: Implementation detail supporting search page behavior.
0516| src/app/search/page.tsx:234:                 <>
0517| NOTE: JSX markup for search UI.
0518| src/app/search/page.tsx:235:                   {total} {total === 1 ? "place" : "places"}{" "}
0519| NOTE: Implementation detail supporting search page behavior.
0520| src/app/search/page.tsx:236:                   {q ? `in "${q}"` : "available"}
0521| NOTE: Implementation detail supporting search page behavior.
0522| src/app/search/page.tsx:237:                 </>
0523| NOTE: JSX markup for search UI.
0524| src/app/search/page.tsx:238:               ) : (
0525| NOTE: Implementation detail supporting search page behavior.
0526| src/app/search/page.tsx:239:                 <>
0527| NOTE: JSX markup for search UI.
0528| src/app/search/page.tsx:240:                   <span className="inline-flex items-center gap-1.5 group relative">
0529| NOTE: Tailwind classes define layout and styling.
0530| src/app/search/page.tsx:241:                     100+
0531| NOTE: Implementation detail supporting search page behavior.
0532| src/app/search/page.tsx:242:                     <button
0533| NOTE: JSX markup for search UI.
0534| src/app/search/page.tsx:243:                       type="button"
0535| NOTE: Implementation detail supporting search page behavior.
0536| src/app/search/page.tsx:244:                       className="text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-1 rounded-full align-middle"
0537| NOTE: Tailwind classes define layout and styling.
0538| src/app/search/page.tsx:245:                       aria-label="Why 100+ results?"
0539| NOTE: Accessibility attribute for screen readers.
0540| src/app/search/page.tsx:246:                     >
0541| NOTE: Implementation detail supporting search page behavior.
0542| src/app/search/page.tsx:247:                       <Info className="w-4 h-4" />
0543| NOTE: Tailwind classes define layout and styling.
0544| src/app/search/page.tsx:248:                     </button>
0545| NOTE: JSX markup for search UI.
0546| src/app/search/page.tsx:249:                     {/* Tooltip - shows on hover/focus within group */}
0547| NOTE: Implementation detail supporting search page behavior.
0548| src/app/search/page.tsx:250:                     <span
0549| NOTE: JSX markup for search UI.
0550| src/app/search/page.tsx:251:                       role="tooltip"
0551| NOTE: Implementation detail supporting search page behavior.
0552| src/app/search/page.tsx:252:                       className="invisible group-hover:visible group-focus-within:visible absolute top-full left-0 mt-2 px-3 py-2 text-xs font-medium text-white bg-zinc-800 dark:bg-zinc-700 rounded-lg shadow-lg whitespace-nowrap z-50 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity"
0553| NOTE: Tailwind classes define layout and styling.
0554| src/app/search/page.tsx:253:                     >
0555| NOTE: Implementation detail supporting search page behavior.
0556| src/app/search/page.tsx:254:                       We limit counts to 100+ for faster searches.
0557| NOTE: Implementation detail supporting search page behavior.
0558| src/app/search/page.tsx:255:                       <br />
0559| NOTE: JSX markup for search UI.
0560| src/app/search/page.tsx:256:                       Refine your filters for an exact count.
0561| NOTE: Implementation detail supporting search page behavior.
0562| src/app/search/page.tsx:257:                       <span className="absolute bottom-full left-4 border-4 border-transparent border-b-zinc-800 dark:border-b-zinc-700" />
0563| NOTE: Tailwind classes define layout and styling.
0564| src/app/search/page.tsx:258:                     </span>
0565| NOTE: JSX markup for search UI.
0566| src/app/search/page.tsx:259:                   </span>{" "}
0567| NOTE: JSX markup for search UI.
0568| src/app/search/page.tsx:260:                   places {q ? `in "${q}"` : "available"}
0569| NOTE: Implementation detail supporting search page behavior.
0570| src/app/search/page.tsx:261:                 </>
0571| NOTE: JSX markup for search UI.
0572| src/app/search/page.tsx:262:               )}
0573| NOTE: Implementation detail supporting search page behavior.
0574| src/app/search/page.tsx:263:             </h1>
0575| NOTE: JSX markup for search UI.
0576| src/app/search/page.tsx:264:             {q ? (
0577| NOTE: Implementation detail supporting search page behavior.
0578| src/app/search/page.tsx:265:               <p className="text-sm text-zinc-500 dark:text-zinc-400 mt-1 flex items-center gap-1">
0579| NOTE: Tailwind classes define layout and styling.
0580| src/app/search/page.tsx:266:                 <MapPin className="w-3.5 h-3.5" />
0581| NOTE: Tailwind classes define layout and styling.
0582| src/app/search/page.tsx:267:                 <span>
0583| NOTE: JSX markup for search UI.
0584| src/app/search/page.tsx:268:                   Results pinned to <span className="font-medium">{q}</span>
0585| NOTE: Tailwind classes define layout and styling.
0586| src/app/search/page.tsx:269:                 </span>
0587| NOTE: JSX markup for search UI.
0588| src/app/search/page.tsx:270:               </p>
0589| NOTE: JSX markup for search UI.
0590| src/app/search/page.tsx:271:             ) : (
0591| NOTE: Implementation detail supporting search page behavior.
0592| src/app/search/page.tsx:272:               <p className="text-sm text-zinc-500 dark:text-zinc-400 mt-1">
0593| NOTE: Tailwind classes define layout and styling.
0594| src/app/search/page.tsx:273:                 Book a place that fits your lifestyle.
0595| NOTE: Implementation detail supporting search page behavior.
0596| src/app/search/page.tsx:274:               </p>
0597| NOTE: JSX markup for search UI.
0598| src/app/search/page.tsx:275:             )}
0599| NOTE: Implementation detail supporting search page behavior.
0600| src/app/search/page.tsx:276:           </div>
0601| NOTE: JSX markup for search UI.
0602| src/app/search/page.tsx:277: 
0603| NOTE: Blank line for visual separation.
0604| src/app/search/page.tsx:278:           <div className="flex items-center gap-2 sm:gap-3">
0605| NOTE: Tailwind classes define layout and styling.
0606| src/app/search/page.tsx:279:             <SaveSearchButton />
0607| NOTE: JSX markup for search UI.
0608| src/app/search/page.tsx:280:             <SortSelect currentSort={sortOption} />
0609| NOTE: JSX markup for search UI.
0610| src/app/search/page.tsx:281:           </div>
0611| NOTE: JSX markup for search UI.
0612| src/app/search/page.tsx:282:         </div>
0613| NOTE: JSX markup for search UI.
0614| src/app/search/page.tsx:283: 
0615| NOTE: Blank line for visual separation.
0616| src/app/search/page.tsx:284:         {listings.length === 0 ? (
0617| NOTE: Implementation detail supporting search page behavior.
0618| src/app/search/page.tsx:285:           <div className="flex flex-col items-center justify-center py-12 sm:py-20 border-2 border-dashed border-zinc-100 dark:border-zinc-800 rounded-2xl sm:rounded-3xl bg-zinc-50/50 dark:bg-zinc-900/50">
0619| NOTE: Tailwind classes define layout and styling.
0620| src/app/search/page.tsx:286:             <div className="w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-white dark:bg-zinc-800 flex items-center justify-center shadow-sm mb-4">
0621| NOTE: Tailwind classes define layout and styling.
0622| src/app/search/page.tsx:287:               <Search className="w-5 h-5 sm:w-6 sm:h-6 text-zinc-400" />
0623| NOTE: Tailwind classes define layout and styling.
0624| src/app/search/page.tsx:288:             </div>
0625| NOTE: JSX markup for search UI.
0626| src/app/search/page.tsx:289:             <h3 className="text-base sm:text-lg font-semibold text-zinc-900 dark:text-white mb-2">
0627| NOTE: Tailwind classes define layout and styling.
0628| src/app/search/page.tsx:290:               No matches found
0629| NOTE: Implementation detail supporting search page behavior.
0630| src/app/search/page.tsx:291:             </h3>
0631| NOTE: JSX markup for search UI.
0632| src/app/search/page.tsx:292:             <p className="text-zinc-500 dark:text-zinc-400 text-sm max-w-xs text-center px-4">
0633| NOTE: Tailwind classes define layout and styling.
0634| src/app/search/page.tsx:293:               We couldn't find any listings {q ? `for "${q}"` : ""}.
0635| NOTE: Implementation detail supporting search page behavior.
0636| src/app/search/page.tsx:294:             </p>
0637| NOTE: JSX markup for search UI.
0638| src/app/search/page.tsx:295: 
0639| NOTE: Blank line for visual separation.
0640| src/app/search/page.tsx:296:             {/* Smart filter suggestions - lazy loaded on user request */}
0641| NOTE: Implementation detail supporting search page behavior.
0642| src/app/search/page.tsx:297:             <div className="w-full max-w-sm px-4 mt-4">
0643| NOTE: Tailwind classes define layout and styling.
0644| src/app/search/page.tsx:298:               <Suspense fallback={null}>
0645| NOTE: JSX markup for search UI.
0646| src/app/search/page.tsx:299:                 <ZeroResultsSuggestions filterParams={filterParams} query={q} />
0647| NOTE: JSX markup for search UI.
0648| src/app/search/page.tsx:300:               </Suspense>
0649| NOTE: JSX markup for search UI.
0650| src/app/search/page.tsx:301:             </div>
0651| NOTE: JSX markup for search UI.
0652| src/app/search/page.tsx:302:           </div>
0653| NOTE: JSX markup for search UI.
0654| src/app/search/page.tsx:303:         ) : (
0655| NOTE: Implementation detail supporting search page behavior.
0656| src/app/search/page.tsx:304:           <>
0657| NOTE: JSX markup for search UI.
0658| src/app/search/page.tsx:305:             {/* Low results guidance - shows when 1-4 exact matches */}
0659| NOTE: Implementation detail supporting search page behavior.
0660| src/app/search/page.tsx:306:             <LowResultsGuidance
0661| NOTE: JSX markup for search UI.
0662| src/app/search/page.tsx:307:               resultCount={listings.filter((l) => !l.isNearMatch).length}
0663| NOTE: Implementation detail supporting search page behavior.
0664| src/app/search/page.tsx:308:               filterParams={filterParams}
0665| NOTE: Implementation detail supporting search page behavior.
0666| src/app/search/page.tsx:309:               nearMatchesEnabled={filterParams.nearMatches === true}
0667| NOTE: Implementation detail supporting search page behavior.
0668| src/app/search/page.tsx:310:               nearMatchCount={nearMatchCount}
0669| NOTE: Implementation detail supporting search page behavior.
0670| src/app/search/page.tsx:311:             />
0671| NOTE: Implementation detail supporting search page behavior.
0672| src/app/search/page.tsx:312: 
0673| NOTE: Blank line for visual separation.
0674| src/app/search/page.tsx:313:             <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-x-6 sm:gap-y-8">
0675| NOTE: Tailwind classes define layout and styling.
0676| src/app/search/page.tsx:314:               {/* Exact matches first */}
0677| NOTE: Implementation detail supporting search page behavior.
0678| src/app/search/page.tsx:315:               {listings
0679| NOTE: Implementation detail supporting search page behavior.
0680| src/app/search/page.tsx:316:                 .filter((listing) => !listing.isNearMatch)
0681| NOTE: Implementation detail supporting search page behavior.
0682| src/app/search/page.tsx:317:                 .map((listing) => (
0683| NOTE: Implementation detail supporting search page behavior.
0684| src/app/search/page.tsx:318:                   <ListingCard
0685| NOTE: JSX markup for search UI.
0686| src/app/search/page.tsx:319:                     key={listing.id}
0687| NOTE: Implementation detail supporting search page behavior.
0688| src/app/search/page.tsx:320:                     listing={listing}
0689| NOTE: Implementation detail supporting search page behavior.
0690| src/app/search/page.tsx:321:                     isSaved={savedListingIds.includes(listing.id)}
0691| NOTE: Implementation detail supporting search page behavior.
0692| src/app/search/page.tsx:322:                   />
0693| NOTE: Implementation detail supporting search page behavior.
0694| src/app/search/page.tsx:323:                 ))}
0695| NOTE: Implementation detail supporting search page behavior.
0696| src/app/search/page.tsx:324: 
0697| NOTE: Blank line for visual separation.
0698| src/app/search/page.tsx:325:               {/* Near-match separator and listings */}
0699| NOTE: Implementation detail supporting search page behavior.
0700| src/app/search/page.tsx:326:               {(nearMatchCount ?? 0) > 0 && (
0701| NOTE: Implementation detail supporting search page behavior.
0702| src/app/search/page.tsx:327:                 <>
0703| NOTE: JSX markup for search UI.
0704| src/app/search/page.tsx:328:                   <NearMatchSeparator nearMatchCount={nearMatchCount ?? 0} />
0705| NOTE: JSX markup for search UI.
0706| src/app/search/page.tsx:329:                   {listings
0707| NOTE: Implementation detail supporting search page behavior.
0708| src/app/search/page.tsx:330:                     .filter((listing) => listing.isNearMatch)
0709| NOTE: Implementation detail supporting search page behavior.
0710| src/app/search/page.tsx:331:                     .map((listing) => (
0711| NOTE: Implementation detail supporting search page behavior.
0712| src/app/search/page.tsx:332:                       <ListingCard
0713| NOTE: JSX markup for search UI.
0714| src/app/search/page.tsx:333:                         key={listing.id}
0715| NOTE: Implementation detail supporting search page behavior.
0716| src/app/search/page.tsx:334:                         listing={listing}
0717| NOTE: Implementation detail supporting search page behavior.
0718| src/app/search/page.tsx:335:                         isSaved={savedListingIds.includes(listing.id)}
0719| NOTE: Implementation detail supporting search page behavior.
0720| src/app/search/page.tsx:336:                       />
0721| NOTE: Implementation detail supporting search page behavior.
0722| src/app/search/page.tsx:337:                     ))}
0723| NOTE: Implementation detail supporting search page behavior.
0724| src/app/search/page.tsx:338:                 </>
0725| NOTE: JSX markup for search UI.
0726| src/app/search/page.tsx:339:               )}
0727| NOTE: Implementation detail supporting search page behavior.
0728| src/app/search/page.tsx:340:             </div>
0729| NOTE: JSX markup for search UI.
0730| src/app/search/page.tsx:341: 
0731| NOTE: Blank line for visual separation.
0732| src/app/search/page.tsx:342:             {/* Pagination */}
0733| NOTE: Implementation detail supporting search page behavior.
0734| src/app/search/page.tsx:343:             <Suspense fallback={null}>
0735| NOTE: JSX markup for search UI.
0736| src/app/search/page.tsx:344:               <Pagination
0737| NOTE: JSX markup for search UI.
0738| src/app/search/page.tsx:345:                 currentPage={currentPage}
0739| NOTE: Implementation detail supporting search page behavior.
0740| src/app/search/page.tsx:346:                 totalPages={totalPages}
0741| NOTE: Implementation detail supporting search page behavior.
0742| src/app/search/page.tsx:347:                 totalItems={total}
0743| NOTE: Implementation detail supporting search page behavior.
0744| src/app/search/page.tsx:348:                 itemsPerPage={ITEMS_PER_PAGE}
0745| NOTE: Implementation detail supporting search page behavior.
0746| src/app/search/page.tsx:349:                 hasNextPage={hasNextPage}
0747| NOTE: Implementation detail supporting search page behavior.
0748| src/app/search/page.tsx:350:                 hasPrevPage={hasPrevPage}
0749| NOTE: Implementation detail supporting search page behavior.
0750| src/app/search/page.tsx:351:               />
0751| NOTE: Implementation detail supporting search page behavior.
0752| src/app/search/page.tsx:352:             </Suspense>
0753| NOTE: JSX markup for search UI.
0754| src/app/search/page.tsx:353:           </>
0755| NOTE: JSX markup for search UI.
0756| src/app/search/page.tsx:354:         )}
0757| NOTE: Implementation detail supporting search page behavior.
0758| src/app/search/page.tsx:355:       </div>
0759| NOTE: JSX markup for search UI.
0760| src/app/search/page.tsx:356:     </div>
0761| NOTE: JSX markup for search UI.
0762| src/app/search/page.tsx:357:   );
0763| NOTE: Implementation detail supporting search page behavior.
0764| src/app/search/page.tsx:358: 
0765| NOTE: Blank line for visual separation.
0766| src/app/search/page.tsx:359:   // Note: Header and map are now in layout.tsx (persistent)
0767| NOTE: Line comment documents intent or constraints.
0768| src/app/search/page.tsx:360:   // This page only renders the results list content
0769| NOTE: Line comment documents intent or constraints.
0770| src/app/search/page.tsx:361:   // The layout's SearchLayoutView handles the split view structure
0771| NOTE: Line comment documents intent or constraints.
0772| src/app/search/page.tsx:362: 
0773| NOTE: Blank line for visual separation.
0774| src/app/search/page.tsx:363:   return listContent;
0775| NOTE: Return statement for component or helper output.
0776| src/app/search/page.tsx:364: }
0777| NOTE: Implementation detail supporting search page behavior.
0778| FILE END: src/app/search/page.tsx
0779| 
0780| FILE START: src/app/search/layout.tsx
0781| FILE ROLE: Persistent layout for /search with header, map, and provider wiring.
0782| src/app/search/layout.tsx:1: import SearchLayoutView from "@/components/SearchLayoutView";
0783| NOTE: Imports dependency for this module.
0784| src/app/search/layout.tsx:2: import SearchHeaderWrapper from "@/components/SearchHeaderWrapper";
0785| NOTE: Imports dependency for this module.
0786| src/app/search/layout.tsx:3: import { MapBoundsProvider } from "@/contexts/MapBoundsContext";
0787| NOTE: Imports dependency for this module.
0788| src/app/search/layout.tsx:4: import { SearchTransitionProvider } from "@/contexts/SearchTransitionContext";
0789| NOTE: Imports dependency for this module.
0790| src/app/search/layout.tsx:5: import { FilterStateProvider } from "@/contexts/FilterStateContext";
0791| NOTE: Imports dependency for this module.
0792| src/app/search/layout.tsx:6: import { ListingFocusProvider } from "@/contexts/ListingFocusContext";
0793| NOTE: Imports dependency for this module.
0794| src/app/search/layout.tsx:7: import { SearchV2DataProvider } from "@/contexts/SearchV2DataContext";
0795| NOTE: Imports dependency for this module.
0796| src/app/search/layout.tsx:8: import { MobileSearchProvider } from "@/contexts/MobileSearchContext";
0797| NOTE: Imports dependency for this module.
0798| src/app/search/layout.tsx:9: 
0799| NOTE: Blank line for visual separation.
0800| src/app/search/layout.tsx:10: /**
0801| NOTE: Block comment line describing behavior or context.
0802| src/app/search/layout.tsx:11:  * Search Layout - Persistent Map Architecture
0803| NOTE: Block comment line describing behavior or context.
0804| src/app/search/layout.tsx:12:  *
0805| NOTE: Block comment line describing behavior or context.
0806| src/app/search/layout.tsx:13:  * This layout keeps the map mounted across all /search navigations.
0807| NOTE: Block comment line describing behavior or context.
0808| src/app/search/layout.tsx:14:  * When URL params change (via router.replace), the map stays mounted
0809| NOTE: Block comment line describing behavior or context.
0810| src/app/search/layout.tsx:15:  * while only the page segment (results) re-renders.
0811| NOTE: Block comment line describing behavior or context.
0812| src/app/search/layout.tsx:16:  *
0813| NOTE: Block comment line describing behavior or context.
0814| src/app/search/layout.tsx:17:  * Key benefit: Prevents Mapbox re-initialization on every pan/zoom,
0815| NOTE: Block comment line describing behavior or context.
0816| src/app/search/layout.tsx:18:  * saving significant costs (Mapbox bills per map load, not per tile).
0817| NOTE: Block comment line describing behavior or context.
0818| src/app/search/layout.tsx:19:  *
0819| NOTE: Block comment line describing behavior or context.
0820| src/app/search/layout.tsx:20:  * Cost optimization (Phase 1):
0821| NOTE: Block comment line describing behavior or context.
0822| src/app/search/layout.tsx:21:  * - Map initialization is deferred until user opts in
0823| NOTE: Block comment line describing behavior or context.
0824| src/app/search/layout.tsx:22:  * - Mobile defaults to list-only view (no map init)
0825| NOTE: Block comment line describing behavior or context.
0826| src/app/search/layout.tsx:23:  * - Desktop has "Hide map" toggle to avoid map billing
0827| NOTE: Block comment line describing behavior or context.
0828| src/app/search/layout.tsx:24:  * - See SearchLayoutView for toggle logic
0829| NOTE: Block comment line describing behavior or context.
0830| src/app/search/layout.tsx:25:  *
0831| NOTE: Block comment line describing behavior or context.
0832| src/app/search/layout.tsx:26:  * Architecture:
0833| NOTE: Block comment line describing behavior or context.
0834| src/app/search/layout.tsx:27:  * - Layout (persistent): Contains header
0835| NOTE: Block comment line describing behavior or context.
0836| src/app/search/layout.tsx:28:  * - SearchLayoutView: Handles map toggle and rendering
0837| NOTE: Block comment line describing behavior or context.
0838| src/app/search/layout.tsx:29:  * - Page (can suspend): Contains the results list only
0839| NOTE: Block comment line describing behavior or context.
0840| src/app/search/layout.tsx:30:  * - loading.tsx: Shows skeleton for results only
0841| NOTE: Block comment line describing behavior or context.
0842| src/app/search/layout.tsx:31:  */
0843| NOTE: Block comment line describing behavior or context.
0844| src/app/search/layout.tsx:32: 
0845| NOTE: Blank line for visual separation.
0846| src/app/search/layout.tsx:33: export default function SearchLayout({
0847| NOTE: Exports main component for this module.
0848| src/app/search/layout.tsx:34:   children,
0849| NOTE: Implementation detail supporting search page behavior.
0850| src/app/search/layout.tsx:35: }: {
0851| NOTE: Implementation detail supporting search page behavior.
0852| src/app/search/layout.tsx:36:   children: React.ReactNode;
0853| NOTE: Implementation detail supporting search page behavior.
0854| src/app/search/layout.tsx:37: }) {
0855| NOTE: Implementation detail supporting search page behavior.
0856| src/app/search/layout.tsx:38:   return (
0857| NOTE: Return statement for component or helper output.
0858| src/app/search/layout.tsx:39:     <SearchTransitionProvider>
0859| NOTE: JSX markup for search UI.
0860| src/app/search/layout.tsx:40:       <FilterStateProvider>
0861| NOTE: JSX markup for search UI.
0862| src/app/search/layout.tsx:41:         <MobileSearchProvider>
0863| NOTE: JSX markup for search UI.
0864| src/app/search/layout.tsx:42:           <div className="h-screen-safe flex flex-col bg-white dark:bg-zinc-950 overflow-hidden">
0865| NOTE: Tailwind classes define layout and styling.
0866| src/app/search/layout.tsx:43:             {/* Search Header - Persistent across navigations, fixed position */}
0867| NOTE: Implementation detail supporting search page behavior.
0868| src/app/search/layout.tsx:44:             <header className="fixed top-0 left-0 right-0 w-full bg-white/80 dark:bg-zinc-900/80 backdrop-blur-xl border-b border-zinc-100 dark:border-zinc-800 z-50">
0869| NOTE: Tailwind classes define layout and styling.
0870| src/app/search/layout.tsx:45:               <SearchHeaderWrapper />
0871| NOTE: JSX markup for search UI.
0872| src/app/search/layout.tsx:46:             </header>
0873| NOTE: JSX markup for search UI.
0874| src/app/search/layout.tsx:47: 
0875| NOTE: Blank line for visual separation.
0876| src/app/search/layout.tsx:48:             {/* Main content with top padding to account for fixed header */}
0877| NOTE: Implementation detail supporting search page behavior.
0878| src/app/search/layout.tsx:49:             <div className="flex-1 flex flex-col pt-[72px] sm:pt-[88px] overflow-hidden">
0879| NOTE: Tailwind classes define layout and styling.
0880| src/app/search/layout.tsx:50:               {/* Split view: List (from page) + Map (managed by SearchLayoutView) */}
0881| NOTE: Implementation detail supporting search page behavior.
0882| src/app/search/layout.tsx:51:               <MapBoundsProvider>
0883| NOTE: JSX markup for search UI.
0884| src/app/search/layout.tsx:52:                 <ListingFocusProvider>
0885| NOTE: JSX markup for search UI.
0886| src/app/search/layout.tsx:53:                   <SearchV2DataProvider>
0887| NOTE: JSX markup for search UI.
0888| src/app/search/layout.tsx:54:                     <SearchLayoutView>{children}</SearchLayoutView>
0889| NOTE: JSX markup for search UI.
0890| src/app/search/layout.tsx:55:                   </SearchV2DataProvider>
0891| NOTE: JSX markup for search UI.
0892| src/app/search/layout.tsx:56:                 </ListingFocusProvider>
0893| NOTE: JSX markup for search UI.
0894| src/app/search/layout.tsx:57:               </MapBoundsProvider>
0895| NOTE: JSX markup for search UI.
0896| src/app/search/layout.tsx:58:             </div>
0897| NOTE: JSX markup for search UI.
0898| src/app/search/layout.tsx:59:           </div>
0899| NOTE: JSX markup for search UI.
0900| src/app/search/layout.tsx:60:         </MobileSearchProvider>
0901| NOTE: JSX markup for search UI.
0902| src/app/search/layout.tsx:61:       </FilterStateProvider>
0903| NOTE: JSX markup for search UI.
0904| src/app/search/layout.tsx:62:     </SearchTransitionProvider>
0905| NOTE: JSX markup for search UI.
0906| src/app/search/layout.tsx:63:   );
0907| NOTE: Implementation detail supporting search page behavior.
0908| src/app/search/layout.tsx:64: }
0909| NOTE: Implementation detail supporting search page behavior.
0910| FILE END: src/app/search/layout.tsx
0911| 
0912| FILE START: src/app/search/error.tsx
0913| FILE ROLE: Client error boundary for search results with retry and navigation.
0914| src/app/search/error.tsx:1: "use client";
0915| NOTE: Implementation detail supporting search page behavior.
0916| src/app/search/error.tsx:2: 
0917| NOTE: Blank line for visual separation.
0918| src/app/search/error.tsx:3: import { useEffect } from "react";
0919| NOTE: Imports dependency for this module.
0920| src/app/search/error.tsx:4: import Link from "next/link";
0921| NOTE: Imports dependency for this module.
0922| src/app/search/error.tsx:5: import { AlertCircle, RefreshCw, Home } from "lucide-react";
0923| NOTE: Imports dependency for this module.
0924| src/app/search/error.tsx:6: import { Button } from "@/components/ui/button";
0925| NOTE: Imports dependency for this module.
0926| src/app/search/error.tsx:7: 
0927| NOTE: Blank line for visual separation.
0928| src/app/search/error.tsx:8: export default function SearchError({
0929| NOTE: Exports main component for this module.
0930| src/app/search/error.tsx:9:   error,
0931| NOTE: Implementation detail supporting search page behavior.
0932| src/app/search/error.tsx:10:   reset,
0933| NOTE: Implementation detail supporting search page behavior.
0934| src/app/search/error.tsx:11: }: {
0935| NOTE: Implementation detail supporting search page behavior.
0936| src/app/search/error.tsx:12:   error: Error & { digest?: string };
0937| NOTE: Implementation detail supporting search page behavior.
0938| src/app/search/error.tsx:13:   reset: () => void;
0939| NOTE: Implementation detail supporting search page behavior.
0940| src/app/search/error.tsx:14: }) {
0941| NOTE: Implementation detail supporting search page behavior.
0942| src/app/search/error.tsx:15:   useEffect(() => {
0943| NOTE: Defines side effect for syncing with external state.
0944| src/app/search/error.tsx:16:     // Log the error to an error reporting service
0945| NOTE: Line comment documents intent or constraints.
0946| src/app/search/error.tsx:17:     console.error("Search page error:", error);
0947| NOTE: Implementation detail supporting search page behavior.
0948| src/app/search/error.tsx:18:   }, [error]);
0949| NOTE: Implementation detail supporting search page behavior.
0950| src/app/search/error.tsx:19: 
0951| NOTE: Blank line for visual separation.
0952| src/app/search/error.tsx:20:   return (
0953| NOTE: Return statement for component or helper output.
0954| src/app/search/error.tsx:21:     <div className="min-h-screen bg-white dark:bg-zinc-950 pt-20">
0955| NOTE: Tailwind classes define layout and styling.
0956| src/app/search/error.tsx:22:       <div className="max-w-lg mx-auto px-4 py-16 text-center">
0957| NOTE: Tailwind classes define layout and styling.
0958| src/app/search/error.tsx:23:         <div className="w-16 h-16 rounded-full bg-red-50 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-6">
0959| NOTE: Tailwind classes define layout and styling.
0960| src/app/search/error.tsx:24:           <AlertCircle className="w-8 h-8 text-red-500 dark:text-red-400" />
0961| NOTE: Tailwind classes define layout and styling.
0962| src/app/search/error.tsx:25:         </div>
0963| NOTE: JSX markup for search UI.
0964| src/app/search/error.tsx:26: 
0965| NOTE: Blank line for visual separation.
0966| src/app/search/error.tsx:27:         <h1 className="text-2xl font-bold text-zinc-900 dark:text-white mb-3">
0967| NOTE: Tailwind classes define layout and styling.
0968| src/app/search/error.tsx:28:           Something went wrong
0969| NOTE: Implementation detail supporting search page behavior.
0970| src/app/search/error.tsx:29:         </h1>
0971| NOTE: JSX markup for search UI.
0972| src/app/search/error.tsx:30: 
0973| NOTE: Blank line for visual separation.
0974| src/app/search/error.tsx:31:         <p className="text-zinc-600 dark:text-zinc-400 mb-8">
0975| NOTE: Tailwind classes define layout and styling.
0976| src/app/search/error.tsx:32:           We couldn&apos;t load the search results. This might be a temporary
0977| NOTE: Implementation detail supporting search page behavior.
0978| src/app/search/error.tsx:33:           issue with our servers.
0979| NOTE: Implementation detail supporting search page behavior.
0980| src/app/search/error.tsx:34:         </p>
0981| NOTE: JSX markup for search UI.
0982| src/app/search/error.tsx:35: 
0983| NOTE: Blank line for visual separation.
0984| src/app/search/error.tsx:36:         <div className="flex flex-col sm:flex-row gap-3 justify-center">
0985| NOTE: Tailwind classes define layout and styling.
0986| src/app/search/error.tsx:37:           <Button onClick={() => reset()} size="lg" className="gap-2">
0987| NOTE: Tailwind classes define layout and styling.
0988| src/app/search/error.tsx:38:             <RefreshCw className="w-4 h-4" />
0989| NOTE: Tailwind classes define layout and styling.
0990| src/app/search/error.tsx:39:             Try again
0991| NOTE: Implementation detail supporting search page behavior.
0992| src/app/search/error.tsx:40:           </Button>
0993| NOTE: JSX markup for search UI.
0994| src/app/search/error.tsx:41: 
0995| NOTE: Blank line for visual separation.
0996| src/app/search/error.tsx:42:           <Button asChild variant="outline" size="lg" className="gap-2">
0997| NOTE: Tailwind classes define layout and styling.
0998| src/app/search/error.tsx:43:             <Link href="/">
0999| NOTE: JSX markup for search UI.
1000| src/app/search/error.tsx:44:               <Home className="w-4 h-4" />
1001| NOTE: Tailwind classes define layout and styling.
1002| src/app/search/error.tsx:45:               Go home
1003| NOTE: Implementation detail supporting search page behavior.
1004| src/app/search/error.tsx:46:             </Link>
1005| NOTE: JSX markup for search UI.
1006| src/app/search/error.tsx:47:           </Button>
1007| NOTE: JSX markup for search UI.
1008| src/app/search/error.tsx:48:         </div>
1009| NOTE: JSX markup for search UI.
1010| src/app/search/error.tsx:49: 
1011| NOTE: Blank line for visual separation.
1012| src/app/search/error.tsx:50:         {/* Error details for debugging (hidden in production) */}
1013| NOTE: Implementation detail supporting search page behavior.
1014| src/app/search/error.tsx:51:         {process.env.NODE_ENV === "development" && (
1015| NOTE: Implementation detail supporting search page behavior.
1016| src/app/search/error.tsx:52:           <details className="mt-8 text-left bg-zinc-50 dark:bg-zinc-900 rounded-lg p-4">
1017| NOTE: Tailwind classes define layout and styling.
1018| src/app/search/error.tsx:53:             <summary className="text-sm font-medium text-zinc-700 dark:text-zinc-300 cursor-pointer">
1019| NOTE: Tailwind classes define layout and styling.
1020| src/app/search/error.tsx:54:               Error details (dev only)
1021| NOTE: Implementation detail supporting search page behavior.
1022| src/app/search/error.tsx:55:             </summary>
1023| NOTE: JSX markup for search UI.
1024| src/app/search/error.tsx:56:             <pre className="mt-2 text-xs text-red-600 dark:text-red-400 overflow-auto">
1025| NOTE: Tailwind classes define layout and styling.
1026| src/app/search/error.tsx:57:               {error.message}
1027| NOTE: Implementation detail supporting search page behavior.
1028| src/app/search/error.tsx:58:               {error.digest && `\nDigest: ${error.digest}`}
1029| NOTE: Implementation detail supporting search page behavior.
1030| src/app/search/error.tsx:59:             </pre>
1031| NOTE: JSX markup for search UI.
1032| src/app/search/error.tsx:60:           </details>
1033| NOTE: JSX markup for search UI.
1034| src/app/search/error.tsx:61:         )}
1035| NOTE: Implementation detail supporting search page behavior.
1036| src/app/search/error.tsx:62:       </div>
1037| NOTE: JSX markup for search UI.
1038| src/app/search/error.tsx:63:     </div>
1039| NOTE: JSX markup for search UI.
1040| src/app/search/error.tsx:64:   );
1041| NOTE: Implementation detail supporting search page behavior.
1042| src/app/search/error.tsx:65: }
1043| NOTE: Implementation detail supporting search page behavior.
1044| FILE END: src/app/search/error.tsx
1045| 
1046| FILE START: src/components/SearchLayoutView.tsx
1047| FILE ROLE: Client split-view controller for list/map and mobile toggles.
1048| src/components/SearchLayoutView.tsx:1: "use client";
1049| NOTE: Implementation detail supporting search page behavior.
1050| src/components/SearchLayoutView.tsx:2: 
1051| NOTE: Blank line for visual separation.
1052| src/components/SearchLayoutView.tsx:3: /**
1053| NOTE: Block comment line describing behavior or context.
1054| src/components/SearchLayoutView.tsx:4:  * SearchLayoutView - Layout-level view component for search page
1055| NOTE: Block comment line describing behavior or context.
1056| src/components/SearchLayoutView.tsx:5:  *
1057| NOTE: Block comment line describing behavior or context.
1058| src/components/SearchLayoutView.tsx:6:  * This component handles the mobile/desktop split view for the search page.
1059| NOTE: Block comment line describing behavior or context.
1060| src/components/SearchLayoutView.tsx:7:  * It's designed to work with the layout.tsx architecture where the map
1061| NOTE: Block comment line describing behavior or context.
1062| src/components/SearchLayoutView.tsx:8:  * is persistent and children (page content) can suspend independently.
1063| NOTE: Block comment line describing behavior or context.
1064| src/components/SearchLayoutView.tsx:9:  *
1065| NOTE: Block comment line describing behavior or context.
1066| src/components/SearchLayoutView.tsx:10:  * Cost optimization (Phase 1):
1067| NOTE: Block comment line describing behavior or context.
1068| src/components/SearchLayoutView.tsx:11:  * - Mobile defaults to list-only view (no map initialization)
1069| NOTE: Block comment line describing behavior or context.
1070| src/components/SearchLayoutView.tsx:12:  * - Desktop has "Hide map" toggle to opt out of map
1071| NOTE: Block comment line describing behavior or context.
1072| src/components/SearchLayoutView.tsx:13:  * - Map only loads when user chooses to see it
1073| NOTE: Block comment line describing behavior or context.
1074| src/components/SearchLayoutView.tsx:14:  * - Preference is persisted in localStorage
1075| NOTE: Block comment line describing behavior or context.
1076| src/components/SearchLayoutView.tsx:15:  *
1077| NOTE: Block comment line describing behavior or context.
1078| src/components/SearchLayoutView.tsx:16:  * Hydration race condition fix:
1079| NOTE: Block comment line describing behavior or context.
1080| src/components/SearchLayoutView.tsx:17:  * - During hydration (isLoading=true), showMap requests are queued
1081| NOTE: Block comment line describing behavior or context.
1082| src/components/SearchLayoutView.tsx:18:  * - After hydration completes, queued requests are executed
1083| NOTE: Block comment line describing behavior or context.
1084| src/components/SearchLayoutView.tsx:19:  * - This ensures "View on Map" button works even when clicked during hydration
1085| NOTE: Block comment line describing behavior or context.
1086| src/components/SearchLayoutView.tsx:20:  */
1087| NOTE: Block comment line describing behavior or context.
1088| src/components/SearchLayoutView.tsx:21: 
1089| NOTE: Blank line for visual separation.
1090| src/components/SearchLayoutView.tsx:22: import { Suspense, useRef, useEffect, useCallback } from "react";
1091| NOTE: Imports dependency for this module.
1092| src/components/SearchLayoutView.tsx:23: import { Map, List, X, MapIcon } from "lucide-react";
1093| NOTE: Imports dependency for this module.
1094| src/components/SearchLayoutView.tsx:24: import { cn } from "@/lib/utils";
1095| NOTE: Imports dependency for this module.
1096| src/components/SearchLayoutView.tsx:25: import { useMapPreference } from "@/hooks/useMapPreference";
1097| NOTE: Imports dependency for this module.
1098| src/components/SearchLayoutView.tsx:26: import { useMapMovedBanner } from "@/contexts/MapBoundsContext";
1099| NOTE: Imports dependency for this module.
1100| src/components/SearchLayoutView.tsx:27: import { useSearchTransitionSafe } from "@/contexts/SearchTransitionContext";
1101| NOTE: Imports dependency for this module.
1102| src/components/SearchLayoutView.tsx:28: import { MapMovedBanner } from "./map/MapMovedBanner";
1103| NOTE: Imports dependency for this module.
1104| src/components/SearchLayoutView.tsx:29: import { PendingFiltersBanner } from "./filters/PendingFiltersBanner";
1105| NOTE: Imports dependency for this module.
1106| src/components/SearchLayoutView.tsx:30: import { AppliedFilterChips } from "./filters/AppliedFilterChips";
1107| NOTE: Imports dependency for this module.
1108| src/components/SearchLayoutView.tsx:31: import PersistentMapWrapper from "./PersistentMapWrapper";
1109| NOTE: Imports dependency for this module.
1110| src/components/SearchLayoutView.tsx:32: import ListScrollBridge from "./listings/ListScrollBridge";
1111| NOTE: Imports dependency for this module.
1112| src/components/SearchLayoutView.tsx:33: import { SearchMapUIProvider } from "@/contexts/SearchMapUIContext";
1113| NOTE: Imports dependency for this module.
1114| src/components/SearchLayoutView.tsx:34: 
1115| NOTE: Blank line for visual separation.
1116| src/components/SearchLayoutView.tsx:35: interface SearchLayoutViewProps {
1117| NOTE: Type declaration for search data contracts.
1118| src/components/SearchLayoutView.tsx:36:   children: React.ReactNode;
1119| NOTE: Implementation detail supporting search page behavior.
1120| src/components/SearchLayoutView.tsx:37: }
1121| NOTE: Implementation detail supporting search page behavior.
1122| src/components/SearchLayoutView.tsx:38: 
1123| NOTE: Blank line for visual separation.
1124| src/components/SearchLayoutView.tsx:39: // Placeholder shown when map is hidden (desktop)
1125| NOTE: Line comment documents intent or constraints.
1126| src/components/SearchLayoutView.tsx:40: function MapPlaceholder({ onShowMap }: { onShowMap: () => void }) {
1127| NOTE: Defines a helper or component function.
1128| src/components/SearchLayoutView.tsx:41:   return (
1129| NOTE: Return statement for component or helper output.
1130| src/components/SearchLayoutView.tsx:42:     <div className="w-full h-full bg-zinc-50 dark:bg-zinc-900 flex items-center justify-center">
1131| NOTE: Tailwind classes define layout and styling.
1132| src/components/SearchLayoutView.tsx:43:       <button
1133| NOTE: JSX markup for search UI.
1134| src/components/SearchLayoutView.tsx:44:         onClick={onShowMap}
1135| NOTE: Implementation detail supporting search page behavior.
1136| src/components/SearchLayoutView.tsx:45:         className="flex flex-col items-center gap-3 p-6 rounded-2xl bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-sm hover:shadow-md hover:border-zinc-300 dark:hover:border-zinc-600 transition-all"
1137| NOTE: Tailwind classes define layout and styling.
1138| src/components/SearchLayoutView.tsx:46:       >
1139| NOTE: Implementation detail supporting search page behavior.
1140| src/components/SearchLayoutView.tsx:47:         <MapIcon className="w-10 h-10 text-zinc-400 dark:text-zinc-500" />
1141| NOTE: Tailwind classes define layout and styling.
1142| src/components/SearchLayoutView.tsx:48:         <span className="text-sm font-medium text-zinc-600 dark:text-zinc-400">
1143| NOTE: Tailwind classes define layout and styling.
1144| src/components/SearchLayoutView.tsx:49:           Show Map
1145| NOTE: Implementation detail supporting search page behavior.
1146| src/components/SearchLayoutView.tsx:50:         </span>
1147| NOTE: JSX markup for search UI.
1148| src/components/SearchLayoutView.tsx:51:       </button>
1149| NOTE: JSX markup for search UI.
1150| src/components/SearchLayoutView.tsx:52:     </div>
1151| NOTE: JSX markup for search UI.
1152| src/components/SearchLayoutView.tsx:53:   );
1153| NOTE: Implementation detail supporting search page behavior.
1154| src/components/SearchLayoutView.tsx:54: }
1155| NOTE: Implementation detail supporting search page behavior.
1156| src/components/SearchLayoutView.tsx:55: 
1157| NOTE: Blank line for visual separation.
1158| src/components/SearchLayoutView.tsx:56: // Loading fallback for map
1159| NOTE: Line comment documents intent or constraints.
1160| src/components/SearchLayoutView.tsx:57: function MapLoadingFallback() {
1161| NOTE: Defines a helper or component function.
1162| src/components/SearchLayoutView.tsx:58:   return (
1163| NOTE: Return statement for component or helper output.
1164| src/components/SearchLayoutView.tsx:59:     <div
1165| NOTE: JSX markup for search UI.
1166| src/components/SearchLayoutView.tsx:60:       className="w-full h-full bg-zinc-100 dark:bg-zinc-800 animate-pulse flex items-center justify-center"
1167| NOTE: Tailwind classes define layout and styling.
1168| src/components/SearchLayoutView.tsx:61:       data-testid="map-loading-fallback"
1169| NOTE: Implementation detail supporting search page behavior.
1170| src/components/SearchLayoutView.tsx:62:     >
1171| NOTE: Implementation detail supporting search page behavior.
1172| src/components/SearchLayoutView.tsx:63:       <div className="text-zinc-400 dark:text-zinc-500 text-sm">
1173| NOTE: Tailwind classes define layout and styling.
1174| src/components/SearchLayoutView.tsx:64:         Loading map...
1175| NOTE: Implementation detail supporting search page behavior.
1176| src/components/SearchLayoutView.tsx:65:       </div>
1177| NOTE: JSX markup for search UI.
1178| src/components/SearchLayoutView.tsx:66:     </div>
1179| NOTE: JSX markup for search UI.
1180| src/components/SearchLayoutView.tsx:67:   );
1181| NOTE: Implementation detail supporting search page behavior.
1182| src/components/SearchLayoutView.tsx:68: }
1183| NOTE: Implementation detail supporting search page behavior.
1184| src/components/SearchLayoutView.tsx:69: 
1185| NOTE: Blank line for visual separation.
1186| src/components/SearchLayoutView.tsx:70: /**
1187| NOTE: Block comment line describing behavior or context.
1188| src/components/SearchLayoutView.tsx:71:  * Small non-blocking badge shown during slow transitions.
1189| NOTE: Block comment line describing behavior or context.
1190| src/components/SearchLayoutView.tsx:72:  * Only appears after a delay to avoid flash for fast loads.
1191| NOTE: Block comment line describing behavior or context.
1192| src/components/SearchLayoutView.tsx:73:  */
1193| NOTE: Block comment line describing behavior or context.
1194| src/components/SearchLayoutView.tsx:74: function SlowTransitionBadge() {
1195| NOTE: Defines a helper or component function.
1196| src/components/SearchLayoutView.tsx:75:   return (
1197| NOTE: Return statement for component or helper output.
1198| src/components/SearchLayoutView.tsx:76:     <div
1199| NOTE: JSX markup for search UI.
1200| src/components/SearchLayoutView.tsx:77:       className="absolute top-4 left-1/2 -translate-x-1/2 z-10 pointer-events-none"
1201| NOTE: Tailwind classes define layout and styling.
1202| src/components/SearchLayoutView.tsx:78:       role="status"
1203| NOTE: Implementation detail supporting search page behavior.
1204| src/components/SearchLayoutView.tsx:79:       aria-live="polite"
1205| NOTE: Accessibility attribute for screen readers.
1206| src/components/SearchLayoutView.tsx:80:     >
1207| NOTE: Implementation detail supporting search page behavior.
1208| src/components/SearchLayoutView.tsx:81:       <span className="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-zinc-800 rounded-full shadow-md border border-zinc-200 dark:border-zinc-700 text-xs font-medium text-zinc-500 dark:text-zinc-400">
1209| NOTE: Tailwind classes define layout and styling.
1210| src/components/SearchLayoutView.tsx:82:         <span className="w-1.5 h-1.5 rounded-full bg-zinc-400 dark:bg-zinc-500 animate-pulse" />
1211| NOTE: Tailwind classes define layout and styling.
1212| src/components/SearchLayoutView.tsx:83:         Still loading...
1213| NOTE: Implementation detail supporting search page behavior.
1214| src/components/SearchLayoutView.tsx:84:       </span>
1215| NOTE: JSX markup for search UI.
1216| src/components/SearchLayoutView.tsx:85:     </div>
1217| NOTE: JSX markup for search UI.
1218| src/components/SearchLayoutView.tsx:86:   );
1219| NOTE: Implementation detail supporting search page behavior.
1220| src/components/SearchLayoutView.tsx:87: }
1221| NOTE: Implementation detail supporting search page behavior.
1222| src/components/SearchLayoutView.tsx:88: 
1223| NOTE: Blank line for visual separation.
1224| src/components/SearchLayoutView.tsx:89: export default function SearchLayoutView({ children }: SearchLayoutViewProps) {
1225| NOTE: Exports main component for this module.
1226| src/components/SearchLayoutView.tsx:90:   const {
1227| NOTE: Local declaration used by search logic or UI.
1228| src/components/SearchLayoutView.tsx:91:     shouldShowMap,
1229| NOTE: Implementation detail supporting search page behavior.
1230| src/components/SearchLayoutView.tsx:92:     shouldRenderMap,
1231| NOTE: Implementation detail supporting search page behavior.
1232| src/components/SearchLayoutView.tsx:93:     toggleMap,
1233| NOTE: Implementation detail supporting search page behavior.
1234| src/components/SearchLayoutView.tsx:94:     showMap,
1235| NOTE: Implementation detail supporting search page behavior.
1236| src/components/SearchLayoutView.tsx:95:     hideMap,
1237| NOTE: Implementation detail supporting search page behavior.
1238| src/components/SearchLayoutView.tsx:96:     isMobile,
1239| NOTE: Implementation detail supporting search page behavior.
1240| src/components/SearchLayoutView.tsx:97:     isLoading,
1241| NOTE: Implementation detail supporting search page behavior.
1242| src/components/SearchLayoutView.tsx:98:   } = useMapPreference();
1243| NOTE: Implementation detail supporting search page behavior.
1244| src/components/SearchLayoutView.tsx:99: 
1245| NOTE: Blank line for visual separation.
1246| src/components/SearchLayoutView.tsx:100:   const { showBanner, showLocationConflict, locationName, onSearch, onReset } =
1247| NOTE: Local declaration used by search logic or UI.
1248| src/components/SearchLayoutView.tsx:101:     useMapMovedBanner();
1249| NOTE: Implementation detail supporting search page behavior.
1250| src/components/SearchLayoutView.tsx:102:   const transitionContext = useSearchTransitionSafe();
1251| NOTE: Local declaration used by search logic or UI.
1252| src/components/SearchLayoutView.tsx:103:   const isPending = transitionContext?.isPending ?? false;
1253| NOTE: Local declaration used by search logic or UI.
1254| src/components/SearchLayoutView.tsx:104:   const isSlowTransition = transitionContext?.isSlowTransition ?? false;
1255| NOTE: Local declaration used by search logic or UI.
1256| src/components/SearchLayoutView.tsx:105: 
1257| NOTE: Blank line for visual separation.
1258| src/components/SearchLayoutView.tsx:106:   // Track pending showMap request during hydration
1259| NOTE: Line comment documents intent or constraints.
1260| src/components/SearchLayoutView.tsx:107:   // This ref persists across renders and is checked when hydration completes
1261| NOTE: Line comment documents intent or constraints.
1262| src/components/SearchLayoutView.tsx:108:   const pendingShowMapRef = useRef(false);
1263| NOTE: Uses ref for stable mutable storage between renders.
1264| src/components/SearchLayoutView.tsx:109: 
1265| NOTE: Blank line for visual separation.
1266| src/components/SearchLayoutView.tsx:110:   // Queued showMap function that works during hydration
1267| NOTE: Line comment documents intent or constraints.
1268| src/components/SearchLayoutView.tsx:111:   // Instead of being a no-op, it queues the request for later execution
1269| NOTE: Line comment documents intent or constraints.
1270| src/components/SearchLayoutView.tsx:112:   const queuedShowMap = useCallback(() => {
1271| NOTE: Memoizes callback to preserve references across renders.
1272| src/components/SearchLayoutView.tsx:113:     pendingShowMapRef.current = true;
1273| NOTE: Implementation detail supporting search page behavior.
1274| src/components/SearchLayoutView.tsx:114:   }, []);
1275| NOTE: Implementation detail supporting search page behavior.
1276| src/components/SearchLayoutView.tsx:115: 
1277| NOTE: Blank line for visual separation.
1278| src/components/SearchLayoutView.tsx:116:   // After hydration completes, execute any queued showMap requests
1279| NOTE: Line comment documents intent or constraints.
1280| src/components/SearchLayoutView.tsx:117:   // This effect runs when isLoading transitions from true to false
1281| NOTE: Line comment documents intent or constraints.
1282| src/components/SearchLayoutView.tsx:118:   useEffect(() => {
1283| NOTE: Defines side effect for syncing with external state.
1284| src/components/SearchLayoutView.tsx:119:     if (!isLoading && pendingShowMapRef.current) {
1285| NOTE: Conditional logic controlling rendering or flow.
1286| src/components/SearchLayoutView.tsx:120:       pendingShowMapRef.current = false;
1287| NOTE: Implementation detail supporting search page behavior.
1288| src/components/SearchLayoutView.tsx:121:       showMap();
1289| NOTE: Implementation detail supporting search page behavior.
1290| src/components/SearchLayoutView.tsx:122:     }
1291| NOTE: Implementation detail supporting search page behavior.
1292| src/components/SearchLayoutView.tsx:123:   }, [isLoading, showMap]);
1293| NOTE: Implementation detail supporting search page behavior.
1294| src/components/SearchLayoutView.tsx:124: 
1295| NOTE: Blank line for visual separation.
1296| src/components/SearchLayoutView.tsx:125:   // During hydration, show a neutral state to prevent flash
1297| NOTE: Line comment documents intent or constraints.
1298| src/components/SearchLayoutView.tsx:126:   // Wrap with provider (queued showMap) to maintain consistent context tree
1299| NOTE: Line comment documents intent or constraints.
1300| src/components/SearchLayoutView.tsx:127:   // Any showMap calls during this period will be queued and executed post-hydration
1301| NOTE: Line comment documents intent or constraints.
1302| src/components/SearchLayoutView.tsx:128:   if (isLoading) {
1303| NOTE: Conditional logic controlling rendering or flow.
1304| src/components/SearchLayoutView.tsx:129:     return (
1305| NOTE: Return statement for component or helper output.
1306| src/components/SearchLayoutView.tsx:130:       <SearchMapUIProvider showMap={queuedShowMap} shouldShowMap={false}>
1307| NOTE: JSX markup for search UI.
1308| src/components/SearchLayoutView.tsx:131:         <>
1309| NOTE: JSX markup for search UI.
1310| src/components/SearchLayoutView.tsx:132:           {/* Mobile: Show list by default during hydration */}
1311| NOTE: Implementation detail supporting search page behavior.
1312| src/components/SearchLayoutView.tsx:133:           <div className="md:hidden flex-1 flex overflow-hidden">
1313| NOTE: Tailwind classes define layout and styling.
1314| src/components/SearchLayoutView.tsx:134:             <div className="w-full h-full overflow-y-auto scrollbar-hide">
1315| NOTE: Tailwind classes define layout and styling.
1316| src/components/SearchLayoutView.tsx:135:               {children}
1317| NOTE: Implementation detail supporting search page behavior.
1318| src/components/SearchLayoutView.tsx:136:             </div>
1319| NOTE: JSX markup for search UI.
1320| src/components/SearchLayoutView.tsx:137:           </div>
1321| NOTE: JSX markup for search UI.
1322| src/components/SearchLayoutView.tsx:138: 
1323| NOTE: Blank line for visual separation.
1324| src/components/SearchLayoutView.tsx:139:           {/* Desktop: Show split view with loading placeholder during hydration */}
1325| NOTE: Implementation detail supporting search page behavior.
1326| src/components/SearchLayoutView.tsx:140:           <div className="hidden md:flex flex-1 overflow-hidden">
1327| NOTE: Tailwind classes define layout and styling.
1328| src/components/SearchLayoutView.tsx:141:             <div className="w-1/2 h-full overflow-y-auto scrollbar-hide">
1329| NOTE: Tailwind classes define layout and styling.
1330| src/components/SearchLayoutView.tsx:142:               {children}
1331| NOTE: Implementation detail supporting search page behavior.
1332| src/components/SearchLayoutView.tsx:143:             </div>
1333| NOTE: JSX markup for search UI.
1334| src/components/SearchLayoutView.tsx:144:             <div className="flex-1 relative border-l border-zinc-200 dark:border-zinc-800">
1335| NOTE: Tailwind classes define layout and styling.
1336| src/components/SearchLayoutView.tsx:145:               <MapLoadingFallback />
1337| NOTE: JSX markup for search UI.
1338| src/components/SearchLayoutView.tsx:146:             </div>
1339| NOTE: JSX markup for search UI.
1340| src/components/SearchLayoutView.tsx:147:           </div>
1341| NOTE: JSX markup for search UI.
1342| src/components/SearchLayoutView.tsx:148:         </>
1343| NOTE: JSX markup for search UI.
1344| src/components/SearchLayoutView.tsx:149:       </SearchMapUIProvider>
1345| NOTE: JSX markup for search UI.
1346| src/components/SearchLayoutView.tsx:150:     );
1347| NOTE: Implementation detail supporting search page behavior.
1348| src/components/SearchLayoutView.tsx:151:   }
1349| NOTE: Implementation detail supporting search page behavior.
1350| src/components/SearchLayoutView.tsx:152: 
1351| NOTE: Blank line for visual separation.
1352| src/components/SearchLayoutView.tsx:153:   return (
1353| NOTE: Return statement for component or helper output.
1354| src/components/SearchLayoutView.tsx:154:     <SearchMapUIProvider showMap={showMap} shouldShowMap={shouldShowMap}>
1355| NOTE: JSX markup for search UI.
1356| src/components/SearchLayoutView.tsx:155:       {/* Centralized scroll bridge - single owner of scroll-to-card behavior */}
1357| NOTE: Implementation detail supporting search page behavior.
1358| src/components/SearchLayoutView.tsx:156:       <ListScrollBridge />
1359| NOTE: JSX markup for search UI.
1360| src/components/SearchLayoutView.tsx:157: 
1361| NOTE: Blank line for visual separation.
1362| src/components/SearchLayoutView.tsx:158:       {/* Mobile View Toggle Button - Fixed at bottom */}
1363| NOTE: Implementation detail supporting search page behavior.
1364| src/components/SearchLayoutView.tsx:159:       <div className="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-50">
1365| NOTE: Tailwind classes define layout and styling.
1366| src/components/SearchLayoutView.tsx:160:         <button
1367| NOTE: JSX markup for search UI.
1368| src/components/SearchLayoutView.tsx:161:           onClick={toggleMap}
1369| NOTE: Implementation detail supporting search page behavior.
1370| src/components/SearchLayoutView.tsx:162:           className="flex items-center gap-2 px-5 py-3 bg-zinc-900 text-white rounded-full shadow-lg shadow-zinc-900/25 hover:bg-zinc-800 transition-colors touch-target"
1371| NOTE: Tailwind classes define layout and styling.
1372| src/components/SearchLayoutView.tsx:163:           aria-label={shouldShowMap ? "Show list view" : "Show map view"}
1373| NOTE: Accessibility attribute for screen readers.
1374| src/components/SearchLayoutView.tsx:164:         >
1375| NOTE: Implementation detail supporting search page behavior.
1376| src/components/SearchLayoutView.tsx:165:           {shouldShowMap ? (
1377| NOTE: Implementation detail supporting search page behavior.
1378| src/components/SearchLayoutView.tsx:166:             <>
1379| NOTE: JSX markup for search UI.
1380| src/components/SearchLayoutView.tsx:167:               <List className="w-5 h-5" />
1381| NOTE: Tailwind classes define layout and styling.
1382| src/components/SearchLayoutView.tsx:168:               <span className="text-sm font-medium">Show List</span>
1383| NOTE: Tailwind classes define layout and styling.
1384| src/components/SearchLayoutView.tsx:169:             </>
1385| NOTE: JSX markup for search UI.
1386| src/components/SearchLayoutView.tsx:170:           ) : (
1387| NOTE: Implementation detail supporting search page behavior.
1388| src/components/SearchLayoutView.tsx:171:             <>
1389| NOTE: JSX markup for search UI.
1390| src/components/SearchLayoutView.tsx:172:               <Map className="w-5 h-5" />
1391| NOTE: Tailwind classes define layout and styling.
1392| src/components/SearchLayoutView.tsx:173:               <span className="text-sm font-medium">Show Map</span>
1393| NOTE: Tailwind classes define layout and styling.
1394| src/components/SearchLayoutView.tsx:174:             </>
1395| NOTE: JSX markup for search UI.
1396| src/components/SearchLayoutView.tsx:175:           )}
1397| NOTE: Implementation detail supporting search page behavior.
1398| src/components/SearchLayoutView.tsx:176:         </button>
1399| NOTE: JSX markup for search UI.
1400| src/components/SearchLayoutView.tsx:177:       </div>
1401| NOTE: JSX markup for search UI.
1402| src/components/SearchLayoutView.tsx:178: 
1403| NOTE: Blank line for visual separation.
1404| src/components/SearchLayoutView.tsx:179:       {/* Mobile Views */}
1405| NOTE: Implementation detail supporting search page behavior.
1406| src/components/SearchLayoutView.tsx:180:       <div className="md:hidden flex-1 flex overflow-hidden">
1407| NOTE: Tailwind classes define layout and styling.
1408| src/components/SearchLayoutView.tsx:181:         {/* List View - shown when map is hidden */}
1409| NOTE: Implementation detail supporting search page behavior.
1410| src/components/SearchLayoutView.tsx:182:         {!shouldShowMap && (
1411| NOTE: Implementation detail supporting search page behavior.
1412| src/components/SearchLayoutView.tsx:183:           <div className="w-full h-full overflow-y-auto scrollbar-hide flex flex-col">
1413| NOTE: Tailwind classes define layout and styling.
1414| src/components/SearchLayoutView.tsx:184:             {/* Pending filters banner - shows when filters changed but not applied */}
1415| NOTE: Implementation detail supporting search page behavior.
1416| src/components/SearchLayoutView.tsx:185:             <PendingFiltersBanner />
1417| NOTE: JSX markup for search UI.
1418| src/components/SearchLayoutView.tsx:186:             {/* Applied filter chips - shows removable chips for active filters */}
1419| NOTE: Implementation detail supporting search page behavior.
1420| src/components/SearchLayoutView.tsx:187:             <AppliedFilterChips />
1421| NOTE: JSX markup for search UI.
1422| src/components/SearchLayoutView.tsx:188:             {/* Map moved banner - shows when user has panned map or location conflict */}
1423| NOTE: Implementation detail supporting search page behavior.
1424| src/components/SearchLayoutView.tsx:189:             {(showBanner || showLocationConflict) && (
1425| NOTE: Implementation detail supporting search page behavior.
1426| src/components/SearchLayoutView.tsx:190:               <MapMovedBanner
1427| NOTE: JSX markup for search UI.
1428| src/components/SearchLayoutView.tsx:191:                 variant="list"
1429| NOTE: Implementation detail supporting search page behavior.
1430| src/components/SearchLayoutView.tsx:192:                 onSearch={onSearch}
1431| NOTE: Implementation detail supporting search page behavior.
1432| src/components/SearchLayoutView.tsx:193:                 onReset={onReset}
1433| NOTE: Implementation detail supporting search page behavior.
1434| src/components/SearchLayoutView.tsx:194:                 isLocationConflict={showLocationConflict}
1435| NOTE: Implementation detail supporting search page behavior.
1436| src/components/SearchLayoutView.tsx:195:                 locationName={locationName}
1437| NOTE: Implementation detail supporting search page behavior.
1438| src/components/SearchLayoutView.tsx:196:               />
1439| NOTE: Implementation detail supporting search page behavior.
1440| src/components/SearchLayoutView.tsx:197:             )}
1441| NOTE: Implementation detail supporting search page behavior.
1442| src/components/SearchLayoutView.tsx:198:             <div
1443| NOTE: JSX markup for search UI.
1444| src/components/SearchLayoutView.tsx:199:               className={cn(
1445| NOTE: Tailwind classes define layout and styling.
1446| src/components/SearchLayoutView.tsx:200:                 "flex-1 relative transition-opacity duration-200",
1447| NOTE: Implementation detail supporting search page behavior.
1448| src/components/SearchLayoutView.tsx:201:                 isPending && "opacity-60 pointer-events-none",
1449| NOTE: Implementation detail supporting search page behavior.
1450| src/components/SearchLayoutView.tsx:202:               )}
1451| NOTE: Implementation detail supporting search page behavior.
1452| src/components/SearchLayoutView.tsx:203:               data-testid="search-results-container"
1453| NOTE: Implementation detail supporting search page behavior.
1454| src/components/SearchLayoutView.tsx:204:               aria-busy={isPending}
1455| NOTE: Accessibility attribute for screen readers.
1456| src/components/SearchLayoutView.tsx:205:             >
1457| NOTE: Implementation detail supporting search page behavior.
1458| src/components/SearchLayoutView.tsx:206:               {isSlowTransition && <SlowTransitionBadge />}
1459| NOTE: Implementation detail supporting search page behavior.
1460| src/components/SearchLayoutView.tsx:207:               {children}
1461| NOTE: Implementation detail supporting search page behavior.
1462| src/components/SearchLayoutView.tsx:208:             </div>
1463| NOTE: JSX markup for search UI.
1464| src/components/SearchLayoutView.tsx:209:           </div>
1465| NOTE: JSX markup for search UI.
1466| src/components/SearchLayoutView.tsx:210:         )}
1467| NOTE: Implementation detail supporting search page behavior.
1468| src/components/SearchLayoutView.tsx:211: 
1469| NOTE: Blank line for visual separation.
1470| src/components/SearchLayoutView.tsx:212:         {/* Map View - only rendered when user opts in */}
1471| NOTE: Implementation detail supporting search page behavior.
1472| src/components/SearchLayoutView.tsx:213:         {shouldShowMap && (
1473| NOTE: Implementation detail supporting search page behavior.
1474| src/components/SearchLayoutView.tsx:214:           <div className="w-full h-full">
1475| NOTE: Tailwind classes define layout and styling.
1476| src/components/SearchLayoutView.tsx:215:             <Suspense fallback={<MapLoadingFallback />}>
1477| NOTE: JSX markup for search UI.
1478| src/components/SearchLayoutView.tsx:216:               <PersistentMapWrapper shouldRenderMap={shouldRenderMap} />
1479| NOTE: JSX markup for search UI.
1480| src/components/SearchLayoutView.tsx:217:             </Suspense>
1481| NOTE: JSX markup for search UI.
1482| src/components/SearchLayoutView.tsx:218:           </div>
1483| NOTE: JSX markup for search UI.
1484| src/components/SearchLayoutView.tsx:219:         )}
1485| NOTE: Implementation detail supporting search page behavior.
1486| src/components/SearchLayoutView.tsx:220:       </div>
1487| NOTE: JSX markup for search UI.
1488| src/components/SearchLayoutView.tsx:221: 
1489| NOTE: Blank line for visual separation.
1490| src/components/SearchLayoutView.tsx:222:       {/* Desktop Split View */}
1491| NOTE: Implementation detail supporting search page behavior.
1492| src/components/SearchLayoutView.tsx:223:       <div className="hidden md:flex flex-1 overflow-hidden">
1493| NOTE: Tailwind classes define layout and styling.
1494| src/components/SearchLayoutView.tsx:224:         {/* Left Panel: List View (page content - can suspend) */}
1495| NOTE: Implementation detail supporting search page behavior.
1496| src/components/SearchLayoutView.tsx:225:         <div
1497| NOTE: JSX markup for search UI.
1498| src/components/SearchLayoutView.tsx:226:           className={`h-full overflow-y-auto scrollbar-hide transition-all duration-300 flex flex-col ${
1499| NOTE: Tailwind classes define layout and styling.
1500| src/components/SearchLayoutView.tsx:227:             shouldShowMap ? "w-1/2" : "w-full"
1501| NOTE: Implementation detail supporting search page behavior.
1502| src/components/SearchLayoutView.tsx:228:           }`}
1503| NOTE: Implementation detail supporting search page behavior.
1504| src/components/SearchLayoutView.tsx:229:         >
1505| NOTE: Implementation detail supporting search page behavior.
1506| src/components/SearchLayoutView.tsx:230:           {/* Pending filters banner - shows when filters changed but not applied */}
1507| NOTE: Implementation detail supporting search page behavior.
1508| src/components/SearchLayoutView.tsx:231:           <PendingFiltersBanner />
1509| NOTE: JSX markup for search UI.
1510| src/components/SearchLayoutView.tsx:232:           {/* Applied filter chips - shows removable chips for active filters */}
1511| NOTE: Implementation detail supporting search page behavior.
1512| src/components/SearchLayoutView.tsx:233:           <AppliedFilterChips />
1513| NOTE: JSX markup for search UI.
1514| src/components/SearchLayoutView.tsx:234:           {/* Map moved banner - shows when user has panned map or location conflict */}
1515| NOTE: Implementation detail supporting search page behavior.
1516| src/components/SearchLayoutView.tsx:235:           {(showBanner || showLocationConflict) && (
1517| NOTE: Implementation detail supporting search page behavior.
1518| src/components/SearchLayoutView.tsx:236:             <MapMovedBanner
1519| NOTE: JSX markup for search UI.
1520| src/components/SearchLayoutView.tsx:237:               variant="list"
1521| NOTE: Implementation detail supporting search page behavior.
1522| src/components/SearchLayoutView.tsx:238:               onSearch={onSearch}
1523| NOTE: Implementation detail supporting search page behavior.
1524| src/components/SearchLayoutView.tsx:239:               onReset={onReset}
1525| NOTE: Implementation detail supporting search page behavior.
1526| src/components/SearchLayoutView.tsx:240:               isLocationConflict={showLocationConflict}
1527| NOTE: Implementation detail supporting search page behavior.
1528| src/components/SearchLayoutView.tsx:241:               locationName={locationName}
1529| NOTE: Implementation detail supporting search page behavior.
1530| src/components/SearchLayoutView.tsx:242:             />
1531| NOTE: Implementation detail supporting search page behavior.
1532| src/components/SearchLayoutView.tsx:243:           )}
1533| NOTE: Implementation detail supporting search page behavior.
1534| src/components/SearchLayoutView.tsx:244:           <div
1535| NOTE: JSX markup for search UI.
1536| src/components/SearchLayoutView.tsx:245:             className={cn(
1537| NOTE: Tailwind classes define layout and styling.
1538| src/components/SearchLayoutView.tsx:246:               "flex-1 relative transition-opacity duration-200",
1539| NOTE: Implementation detail supporting search page behavior.
1540| src/components/SearchLayoutView.tsx:247:               isPending && "opacity-60 pointer-events-none",
1541| NOTE: Implementation detail supporting search page behavior.
1542| src/components/SearchLayoutView.tsx:248:             )}
1543| NOTE: Implementation detail supporting search page behavior.
1544| src/components/SearchLayoutView.tsx:249:             data-testid="search-results-container"
1545| NOTE: Implementation detail supporting search page behavior.
1546| src/components/SearchLayoutView.tsx:250:             aria-busy={isPending}
1547| NOTE: Accessibility attribute for screen readers.
1548| src/components/SearchLayoutView.tsx:251:           >
1549| NOTE: Implementation detail supporting search page behavior.
1550| src/components/SearchLayoutView.tsx:252:             {isSlowTransition && <SlowTransitionBadge />}
1551| NOTE: Implementation detail supporting search page behavior.
1552| src/components/SearchLayoutView.tsx:253:             {children}
1553| NOTE: Implementation detail supporting search page behavior.
1554| src/components/SearchLayoutView.tsx:254:           </div>
1555| NOTE: JSX markup for search UI.
1556| src/components/SearchLayoutView.tsx:255:         </div>
1557| NOTE: JSX markup for search UI.
1558| src/components/SearchLayoutView.tsx:256: 
1559| NOTE: Blank line for visual separation.
1560| src/components/SearchLayoutView.tsx:257:         {/* Right Panel: Map View (conditional) */}
1561| NOTE: Implementation detail supporting search page behavior.
1562| src/components/SearchLayoutView.tsx:258:         {shouldShowMap ? (
1563| NOTE: Implementation detail supporting search page behavior.
1564| src/components/SearchLayoutView.tsx:259:           <div className="flex-1 relative border-l border-zinc-200 dark:border-zinc-800">
1565| NOTE: Tailwind classes define layout and styling.
1566| src/components/SearchLayoutView.tsx:260:             {/* Hide Map button */}
1567| NOTE: Implementation detail supporting search page behavior.
1568| src/components/SearchLayoutView.tsx:261:             <button
1569| NOTE: JSX markup for search UI.
1570| src/components/SearchLayoutView.tsx:262:               onClick={hideMap}
1571| NOTE: Implementation detail supporting search page behavior.
1572| src/components/SearchLayoutView.tsx:263:               className="absolute top-3 right-3 z-10 flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-sm hover:bg-zinc-50 dark:hover:bg-zinc-700 transition-colors text-sm font-medium text-zinc-600 dark:text-zinc-300"
1573| NOTE: Tailwind classes define layout and styling.
1574| src/components/SearchLayoutView.tsx:264:               aria-label="Hide map"
1575| NOTE: Accessibility attribute for screen readers.
1576| src/components/SearchLayoutView.tsx:265:             >
1577| NOTE: Implementation detail supporting search page behavior.
1578| src/components/SearchLayoutView.tsx:266:               <X className="w-4 h-4" />
1579| NOTE: Tailwind classes define layout and styling.
1580| src/components/SearchLayoutView.tsx:267:               <span>Hide map</span>
1581| NOTE: JSX markup for search UI.
1582| src/components/SearchLayoutView.tsx:268:             </button>
1583| NOTE: JSX markup for search UI.
1584| src/components/SearchLayoutView.tsx:269: 
1585| NOTE: Blank line for visual separation.
1586| src/components/SearchLayoutView.tsx:270:             <Suspense fallback={<MapLoadingFallback />}>
1587| NOTE: JSX markup for search UI.
1588| src/components/SearchLayoutView.tsx:271:               <PersistentMapWrapper shouldRenderMap={shouldRenderMap} />
1589| NOTE: JSX markup for search UI.
1590| src/components/SearchLayoutView.tsx:272:             </Suspense>
1591| NOTE: JSX markup for search UI.
1592| src/components/SearchLayoutView.tsx:273:           </div>
1593| NOTE: JSX markup for search UI.
1594| src/components/SearchLayoutView.tsx:274:         ) : (
1595| NOTE: Implementation detail supporting search page behavior.
1596| src/components/SearchLayoutView.tsx:275:           // Map hidden - show placeholder with "Show Map" button
1597| NOTE: Line comment documents intent or constraints.
1598| src/components/SearchLayoutView.tsx:276:           <div className="w-[400px] min-w-[400px] border-l border-zinc-200 dark:border-zinc-800">
1599| NOTE: Tailwind classes define layout and styling.
1600| src/components/SearchLayoutView.tsx:277:             <MapPlaceholder onShowMap={showMap} />
1601| NOTE: JSX markup for search UI.
1602| src/components/SearchLayoutView.tsx:278:           </div>
1603| NOTE: JSX markup for search UI.
1604| src/components/SearchLayoutView.tsx:279:         )}
1605| NOTE: Implementation detail supporting search page behavior.
1606| src/components/SearchLayoutView.tsx:280:       </div>
1607| NOTE: JSX markup for search UI.
1608| src/components/SearchLayoutView.tsx:281: 
1609| NOTE: Blank line for visual separation.
1610| src/components/SearchLayoutView.tsx:282:       {/* Desktop FAB when map is completely hidden - alternative to placeholder */}
1611| NOTE: Implementation detail supporting search page behavior.
1612| src/components/SearchLayoutView.tsx:283:       {!shouldShowMap && !isMobile && (
1613| NOTE: Implementation detail supporting search page behavior.
1614| src/components/SearchLayoutView.tsx:284:         <div className="fixed bottom-6 right-6 z-50 hidden md:block">
1615| NOTE: Tailwind classes define layout and styling.
1616| src/components/SearchLayoutView.tsx:285:           <button
1617| NOTE: JSX markup for search UI.
1618| src/components/SearchLayoutView.tsx:286:             onClick={showMap}
1619| NOTE: Implementation detail supporting search page behavior.
1620| src/components/SearchLayoutView.tsx:287:             className="flex items-center gap-2 px-4 py-3 bg-zinc-900 text-white rounded-full shadow-lg shadow-zinc-900/25 hover:bg-zinc-800 transition-colors"
1621| NOTE: Tailwind classes define layout and styling.
1622| src/components/SearchLayoutView.tsx:288:             aria-label="Show map"
1623| NOTE: Accessibility attribute for screen readers.
1624| src/components/SearchLayoutView.tsx:289:           >
1625| NOTE: Implementation detail supporting search page behavior.
1626| src/components/SearchLayoutView.tsx:290:             <Map className="w-5 h-5" />
1627| NOTE: Tailwind classes define layout and styling.
1628| src/components/SearchLayoutView.tsx:291:             <span className="text-sm font-medium">Show Map</span>
1629| NOTE: Tailwind classes define layout and styling.
1630| src/components/SearchLayoutView.tsx:292:           </button>
1631| NOTE: JSX markup for search UI.
1632| src/components/SearchLayoutView.tsx:293:         </div>
1633| NOTE: JSX markup for search UI.
1634| src/components/SearchLayoutView.tsx:294:       )}
1635| NOTE: Implementation detail supporting search page behavior.
1636| src/components/SearchLayoutView.tsx:295:     </SearchMapUIProvider>
1637| NOTE: JSX markup for search UI.
1638| src/components/SearchLayoutView.tsx:296:   );
1639| NOTE: Implementation detail supporting search page behavior.
1640| src/components/SearchLayoutView.tsx:297: }
1641| NOTE: Implementation detail supporting search page behavior.
1642| FILE END: src/components/SearchLayoutView.tsx
1643| 
1644| FILE START: src/components/SearchHeaderWrapper.tsx
1645| FILE ROLE: Collapsible mobile header wrapper for SearchForm.
1646| src/components/SearchHeaderWrapper.tsx:1: "use client";
1647| NOTE: Implementation detail supporting search page behavior.
1648| src/components/SearchHeaderWrapper.tsx:2: 
1649| NOTE: Blank line for visual separation.
1650| src/components/SearchHeaderWrapper.tsx:3: /**
1651| NOTE: Block comment line describing behavior or context.
1652| src/components/SearchHeaderWrapper.tsx:4:  * SearchHeaderWrapper - Manages collapsible header on mobile
1653| NOTE: Block comment line describing behavior or context.
1654| src/components/SearchHeaderWrapper.tsx:5:  *
1655| NOTE: Block comment line describing behavior or context.
1656| src/components/SearchHeaderWrapper.tsx:6:  * On mobile:
1657| NOTE: Block comment line describing behavior or context.
1658| src/components/SearchHeaderWrapper.tsx:7:  * - Shows full SearchForm when at top or manually expanded
1659| NOTE: Block comment line describing behavior or context.
1660| src/components/SearchHeaderWrapper.tsx:8:  * - Shows collapsed bar when scrolled down
1661| NOTE: Block comment line describing behavior or context.
1662| src/components/SearchHeaderWrapper.tsx:9:  * - Collapsed bar shows location summary and filter access
1663| NOTE: Block comment line describing behavior or context.
1664| src/components/SearchHeaderWrapper.tsx:10:  *
1665| NOTE: Block comment line describing behavior or context.
1666| src/components/SearchHeaderWrapper.tsx:11:  * On desktop:
1667| NOTE: Block comment line describing behavior or context.
1668| src/components/SearchHeaderWrapper.tsx:12:  * - Always shows full SearchForm
1669| NOTE: Block comment line describing behavior or context.
1670| src/components/SearchHeaderWrapper.tsx:13:  */
1671| NOTE: Block comment line describing behavior or context.
1672| src/components/SearchHeaderWrapper.tsx:14: 
1673| NOTE: Blank line for visual separation.
1674| src/components/SearchHeaderWrapper.tsx:15: import { Suspense } from "react";
1675| NOTE: Imports dependency for this module.
1676| src/components/SearchHeaderWrapper.tsx:16: import { useScrollHeader } from "@/hooks/useScrollHeader";
1677| NOTE: Imports dependency for this module.
1678| src/components/SearchHeaderWrapper.tsx:17: import { useMobileSearch } from "@/contexts/MobileSearchContext";
1679| NOTE: Imports dependency for this module.
1680| src/components/SearchHeaderWrapper.tsx:18: import CollapsedMobileSearch from "@/components/CollapsedMobileSearch";
1681| NOTE: Imports dependency for this module.
1682| src/components/SearchHeaderWrapper.tsx:19: import SearchForm from "@/components/SearchForm";
1683| NOTE: Imports dependency for this module.
1684| src/components/SearchHeaderWrapper.tsx:20: 
1685| NOTE: Blank line for visual separation.
1686| src/components/SearchHeaderWrapper.tsx:21: export default function SearchHeaderWrapper() {
1687| NOTE: Exports main component for this module.
1688| src/components/SearchHeaderWrapper.tsx:22:   const { isCollapsed } = useScrollHeader({ threshold: 80 });
1689| NOTE: Local declaration used by search logic or UI.
1690| src/components/SearchHeaderWrapper.tsx:23:   const { isExpanded, expand, openFilters } = useMobileSearch();
1691| NOTE: Local declaration used by search logic or UI.
1692| src/components/SearchHeaderWrapper.tsx:24: 
1693| NOTE: Blank line for visual separation.
1694| src/components/SearchHeaderWrapper.tsx:25:   // Show collapsed bar on mobile when scrolled and not manually expanded
1695| NOTE: Line comment documents intent or constraints.
1696| src/components/SearchHeaderWrapper.tsx:26:   const showCollapsed = isCollapsed && !isExpanded;
1697| NOTE: Local declaration used by search logic or UI.
1698| src/components/SearchHeaderWrapper.tsx:27: 
1699| NOTE: Blank line for visual separation.
1700| src/components/SearchHeaderWrapper.tsx:28:   return (
1701| NOTE: Return statement for component or helper output.
1702| src/components/SearchHeaderWrapper.tsx:29:     <>
1703| NOTE: JSX markup for search UI.
1704| src/components/SearchHeaderWrapper.tsx:30:       {/* Full search form - hidden on mobile when collapsed */}
1705| NOTE: Implementation detail supporting search page behavior.
1706| src/components/SearchHeaderWrapper.tsx:31:       <div
1707| NOTE: JSX markup for search UI.
1708| src/components/SearchHeaderWrapper.tsx:32:         className={`transition-all duration-300 ease-out ${
1709| NOTE: Tailwind classes define layout and styling.
1710| src/components/SearchHeaderWrapper.tsx:33:           showCollapsed ? "md:block hidden" : "block"
1711| NOTE: Implementation detail supporting search page behavior.
1712| src/components/SearchHeaderWrapper.tsx:34:         }`}
1713| NOTE: Implementation detail supporting search page behavior.
1714| src/components/SearchHeaderWrapper.tsx:35:       >
1715| NOTE: Implementation detail supporting search page behavior.
1716| src/components/SearchHeaderWrapper.tsx:36:         <div className="w-full max-w-[1920px] mx-auto px-3 sm:px-4 md:px-6 py-3 sm:py-4">
1717| NOTE: Tailwind classes define layout and styling.
1718| src/components/SearchHeaderWrapper.tsx:37:           <Suspense
1719| NOTE: JSX markup for search UI.
1720| src/components/SearchHeaderWrapper.tsx:38:             fallback={
1721| NOTE: Implementation detail supporting search page behavior.
1722| src/components/SearchHeaderWrapper.tsx:39:               <div className="h-14 sm:h-16 w-full bg-zinc-100 dark:bg-zinc-800 animate-pulse rounded-full" />
1723| NOTE: Tailwind classes define layout and styling.
1724| src/components/SearchHeaderWrapper.tsx:40:             }
1725| NOTE: Implementation detail supporting search page behavior.
1726| src/components/SearchHeaderWrapper.tsx:41:           >
1727| NOTE: Implementation detail supporting search page behavior.
1728| src/components/SearchHeaderWrapper.tsx:42:             <SearchForm />
1729| NOTE: JSX markup for search UI.
1730| src/components/SearchHeaderWrapper.tsx:43:           </Suspense>
1731| NOTE: JSX markup for search UI.
1732| src/components/SearchHeaderWrapper.tsx:44:         </div>
1733| NOTE: JSX markup for search UI.
1734| src/components/SearchHeaderWrapper.tsx:45:       </div>
1735| NOTE: JSX markup for search UI.
1736| src/components/SearchHeaderWrapper.tsx:46: 
1737| NOTE: Blank line for visual separation.
1738| src/components/SearchHeaderWrapper.tsx:47:       {/* Collapsed search bar - visible on mobile only when collapsed */}
1739| NOTE: Implementation detail supporting search page behavior.
1740| src/components/SearchHeaderWrapper.tsx:48:       <div
1741| NOTE: JSX markup for search UI.
1742| src/components/SearchHeaderWrapper.tsx:49:         className={`transition-all duration-300 ease-out ${
1743| NOTE: Tailwind classes define layout and styling.
1744| src/components/SearchHeaderWrapper.tsx:50:           showCollapsed ? "md:hidden block py-2" : "hidden"
1745| NOTE: Implementation detail supporting search page behavior.
1746| src/components/SearchHeaderWrapper.tsx:51:         }`}
1747| NOTE: Implementation detail supporting search page behavior.
1748| src/components/SearchHeaderWrapper.tsx:52:       >
1749| NOTE: Implementation detail supporting search page behavior.
1750| src/components/SearchHeaderWrapper.tsx:53:         <CollapsedMobileSearch onExpand={expand} onOpenFilters={openFilters} />
1751| NOTE: JSX markup for search UI.
1752| src/components/SearchHeaderWrapper.tsx:54:       </div>
1753| NOTE: JSX markup for search UI.
1754| src/components/SearchHeaderWrapper.tsx:55:     </>
1755| NOTE: JSX markup for search UI.
1756| src/components/SearchHeaderWrapper.tsx:56:   );
1757| NOTE: Implementation detail supporting search page behavior.
1758| src/components/SearchHeaderWrapper.tsx:57: }
1759| NOTE: Implementation detail supporting search page behavior.
1760| FILE END: src/components/SearchHeaderWrapper.tsx
1761| 
1762| FILE START: src/components/SearchForm.tsx
1763| FILE ROLE: Search form UI, filters, and URL sync for the search experience.
1764| src/components/SearchForm.tsx:1: "use client";
1765| NOTE: Implementation detail supporting search page behavior.
1766| src/components/SearchForm.tsx:2: 
1767| NOTE: Blank line for visual separation.
1768| src/components/SearchForm.tsx:3: import { useState, useEffect, useRef, useCallback, useMemo } from "react";
1769| NOTE: Imports dependency for this module.
1770| src/components/SearchForm.tsx:4: import { createPortal } from "react-dom";
1771| NOTE: Imports dependency for this module.
1772| src/components/SearchForm.tsx:5: import { useRouter, useSearchParams } from "next/navigation";
1773| NOTE: Imports dependency for this module.
1774| src/components/SearchForm.tsx:6: import { Search, X, Clock, SlidersHorizontal, Loader2 } from "lucide-react";
1775| NOTE: Imports dependency for this module.
1776| src/components/SearchForm.tsx:7: import { useSearchTransitionSafe } from "@/contexts/SearchTransitionContext";
1777| NOTE: Imports dependency for this module.
1778| src/components/SearchForm.tsx:8: import { useFilterStateSafe } from "@/contexts/FilterStateContext";
1779| NOTE: Imports dependency for this module.
1780| src/components/SearchForm.tsx:9: import { useMobileSearch } from "@/contexts/MobileSearchContext";
1781| NOTE: Imports dependency for this module.
1782| src/components/SearchForm.tsx:10: import { useBatchedFilters } from "@/hooks/useBatchedFilters";
1783| NOTE: Imports dependency for this module.
1784| src/components/SearchForm.tsx:11: import { useDebouncedFilterCount } from "@/hooks/useDebouncedFilterCount";
1785| NOTE: Imports dependency for this module.
1786| src/components/SearchForm.tsx:12: import {
1787| NOTE: Imports dependency for this module.
1788| src/components/SearchForm.tsx:13:   useRecentSearches,
1789| NOTE: Implementation detail supporting search page behavior.
1790| src/components/SearchForm.tsx:14:   type RecentSearch,
1791| NOTE: Type declaration for search data contracts.
1792| src/components/SearchForm.tsx:15:   type RecentSearchFilters,
1793| NOTE: Type declaration for search data contracts.
1794| src/components/SearchForm.tsx:16: } from "@/hooks/useRecentSearches";
1795| NOTE: Implementation detail supporting search page behavior.
1796| src/components/SearchForm.tsx:17: import {
1797| NOTE: Imports dependency for this module.
1798| src/components/SearchForm.tsx:18:   useKeyboardShortcuts,
1799| NOTE: Implementation detail supporting search page behavior.
1800| src/components/SearchForm.tsx:19:   SEARCH_SHORTCUTS,
1801| NOTE: Implementation detail supporting search page behavior.
1802| src/components/SearchForm.tsx:20: } from "@/hooks/useKeyboardShortcuts";
1803| NOTE: Implementation detail supporting search page behavior.
1804| src/components/SearchForm.tsx:21: import { Button } from "@/components/ui/button";
1805| NOTE: Imports dependency for this module.
1806| src/components/SearchForm.tsx:22: import { Input } from "@/components/ui/input";
1807| NOTE: Imports dependency for this module.
1808| src/components/SearchForm.tsx:23: import { FocusTrap } from "@/components/ui/FocusTrap";
1809| NOTE: Imports dependency for this module.
1810| src/components/SearchForm.tsx:24: import { FilterStickyFooter } from "@/components/filters/FilterStickyFooter";
1811| NOTE: Imports dependency for this module.
1812| src/components/SearchForm.tsx:25: import LocationSearchInput, {
1813| NOTE: Imports dependency for this module.
1814| src/components/SearchForm.tsx:26:   type LocationSearchInputRef,
1815| NOTE: Type declaration for search data contracts.
1816| src/components/SearchForm.tsx:27: } from "@/components/LocationSearchInput";
1817| NOTE: Implementation detail supporting search page behavior.
1818| src/components/SearchForm.tsx:28: import { DatePicker } from "@/components/ui/date-picker";
1819| NOTE: Imports dependency for this module.
1820| src/components/SearchForm.tsx:29: import {
1821| NOTE: Imports dependency for this module.
1822| src/components/SearchForm.tsx:30:   SUPPORTED_LANGUAGES,
1823| NOTE: Implementation detail supporting search page behavior.
1824| src/components/SearchForm.tsx:31:   getLanguageName,
1825| NOTE: Implementation detail supporting search page behavior.
1826| src/components/SearchForm.tsx:32:   normalizeLanguages,
1827| NOTE: Implementation detail supporting search page behavior.
1828| src/components/SearchForm.tsx:33:   type LanguageCode,
1829| NOTE: Type declaration for search data contracts.
1830| src/components/SearchForm.tsx:34: } from "@/lib/languages";
1831| NOTE: Implementation detail supporting search page behavior.
1832| src/components/SearchForm.tsx:35: import {
1833| NOTE: Imports dependency for this module.
1834| src/components/SearchForm.tsx:36:   Select,
1835| NOTE: Implementation detail supporting search page behavior.
1836| src/components/SearchForm.tsx:37:   SelectContent,
1837| NOTE: Implementation detail supporting search page behavior.
1838| src/components/SearchForm.tsx:38:   SelectItem,
1839| NOTE: Implementation detail supporting search page behavior.
1840| src/components/SearchForm.tsx:39:   SelectTrigger,
1841| NOTE: Implementation detail supporting search page behavior.
1842| src/components/SearchForm.tsx:40:   SelectValue,
1843| NOTE: Implementation detail supporting search page behavior.
1844| src/components/SearchForm.tsx:41: } from "@/components/ui/select";
1845| NOTE: Implementation detail supporting search page behavior.
1846| src/components/SearchForm.tsx:42: import { sortOptions } from "@/components/SortSelect";
1847| NOTE: Imports dependency for this module.
1848| src/components/SearchForm.tsx:43: import type { SortOption } from "@/lib/data";
1849| NOTE: Imports dependency for this module.
1850| src/components/SearchForm.tsx:44: 
1851| NOTE: Blank line for visual separation.
1852| src/components/SearchForm.tsx:45: // Debounce delay in milliseconds
1853| NOTE: Line comment documents intent or constraints.
1854| src/components/SearchForm.tsx:46: const SEARCH_DEBOUNCE_MS = 300;
1855| NOTE: Local declaration used by search logic or UI.
1856| src/components/SearchForm.tsx:47: 
1857| NOTE: Blank line for visual separation.
1858| src/components/SearchForm.tsx:48: const AMENITY_OPTIONS = [
1859| NOTE: Local declaration used by search logic or UI.
1860| src/components/SearchForm.tsx:49:   "Wifi",
1861| NOTE: Implementation detail supporting search page behavior.
1862| src/components/SearchForm.tsx:50:   "AC",
1863| NOTE: Implementation detail supporting search page behavior.
1864| src/components/SearchForm.tsx:51:   "Parking",
1865| NOTE: Implementation detail supporting search page behavior.
1866| src/components/SearchForm.tsx:52:   "Washer",
1867| NOTE: Implementation detail supporting search page behavior.
1868| src/components/SearchForm.tsx:53:   "Dryer",
1869| NOTE: Implementation detail supporting search page behavior.
1870| src/components/SearchForm.tsx:54:   "Kitchen",
1871| NOTE: Implementation detail supporting search page behavior.
1872| src/components/SearchForm.tsx:55:   "Gym",
1873| NOTE: Implementation detail supporting search page behavior.
1874| src/components/SearchForm.tsx:56:   "Pool",
1875| NOTE: Implementation detail supporting search page behavior.
1876| src/components/SearchForm.tsx:57:   "Furnished",
1877| NOTE: Implementation detail supporting search page behavior.
1878| src/components/SearchForm.tsx:58: ] as const;
1879| NOTE: Implementation detail supporting search page behavior.
1880| src/components/SearchForm.tsx:59: const HOUSE_RULE_OPTIONS = [
1881| NOTE: Local declaration used by search logic or UI.
1882| src/components/SearchForm.tsx:60:   "Pets allowed",
1883| NOTE: Implementation detail supporting search page behavior.
1884| src/components/SearchForm.tsx:61:   "Smoking allowed",
1885| NOTE: Implementation detail supporting search page behavior.
1886| src/components/SearchForm.tsx:62:   "Couples allowed",
1887| NOTE: Implementation detail supporting search page behavior.
1888| src/components/SearchForm.tsx:63:   "Guests allowed",
1889| NOTE: Implementation detail supporting search page behavior.
1890| src/components/SearchForm.tsx:64: ] as const;
1891| NOTE: Implementation detail supporting search page behavior.
1892| src/components/SearchForm.tsx:65: const LEASE_DURATION_OPTIONS = [
1893| NOTE: Local declaration used by search logic or UI.
1894| src/components/SearchForm.tsx:66:   "any",
1895| NOTE: Implementation detail supporting search page behavior.
1896| src/components/SearchForm.tsx:67:   "Month-to-month",
1897| NOTE: Implementation detail supporting search page behavior.
1898| src/components/SearchForm.tsx:68:   "3 months",
1899| NOTE: Implementation detail supporting search page behavior.
1900| src/components/SearchForm.tsx:69:   "6 months",
1901| NOTE: Implementation detail supporting search page behavior.
1902| src/components/SearchForm.tsx:70:   "12 months",
1903| NOTE: Implementation detail supporting search page behavior.
1904| src/components/SearchForm.tsx:71:   "Flexible",
1905| NOTE: Implementation detail supporting search page behavior.
1906| src/components/SearchForm.tsx:72: ] as const;
1907| NOTE: Implementation detail supporting search page behavior.
1908| src/components/SearchForm.tsx:73: const ROOM_TYPE_OPTIONS = [
1909| NOTE: Local declaration used by search logic or UI.
1910| src/components/SearchForm.tsx:74:   "any",
1911| NOTE: Implementation detail supporting search page behavior.
1912| src/components/SearchForm.tsx:75:   "Private Room",
1913| NOTE: Implementation detail supporting search page behavior.
1914| src/components/SearchForm.tsx:76:   "Shared Room",
1915| NOTE: Implementation detail supporting search page behavior.
1916| src/components/SearchForm.tsx:77:   "Entire Place",
1917| NOTE: Implementation detail supporting search page behavior.
1918| src/components/SearchForm.tsx:78: ] as const;
1919| NOTE: Implementation detail supporting search page behavior.
1920| src/components/SearchForm.tsx:79: 
1921| NOTE: Blank line for visual separation.
1922| src/components/SearchForm.tsx:80: // URL-friendly aliases for enum values
1923| NOTE: Line comment documents intent or constraints.
1924| src/components/SearchForm.tsx:81: const LEASE_DURATION_ALIASES: Record<string, string> = {
1925| NOTE: Local declaration used by search logic or UI.
1926| src/components/SearchForm.tsx:82:   "month-to-month": "Month-to-month",
1927| NOTE: Implementation detail supporting search page behavior.
1928| src/components/SearchForm.tsx:83:   month_to_month: "Month-to-month",
1929| NOTE: Implementation detail supporting search page behavior.
1930| src/components/SearchForm.tsx:84:   mtm: "Month-to-month",
1931| NOTE: Implementation detail supporting search page behavior.
1932| src/components/SearchForm.tsx:85:   "3_months": "3 months",
1933| NOTE: Implementation detail supporting search page behavior.
1934| src/components/SearchForm.tsx:86:   "6_months": "6 months",
1935| NOTE: Implementation detail supporting search page behavior.
1936| src/components/SearchForm.tsx:87:   "12_months": "12 months",
1937| NOTE: Implementation detail supporting search page behavior.
1938| src/components/SearchForm.tsx:88:   "1_year": "12 months",
1939| NOTE: Implementation detail supporting search page behavior.
1940| src/components/SearchForm.tsx:89: };
1941| NOTE: Implementation detail supporting search page behavior.
1942| src/components/SearchForm.tsx:90: 
1943| NOTE: Blank line for visual separation.
1944| src/components/SearchForm.tsx:91: const ROOM_TYPE_ALIASES: Record<string, string> = {
1945| NOTE: Local declaration used by search logic or UI.
1946| src/components/SearchForm.tsx:92:   private: "Private Room",
1947| NOTE: Implementation detail supporting search page behavior.
1948| src/components/SearchForm.tsx:93:   private_room: "Private Room",
1949| NOTE: Implementation detail supporting search page behavior.
1950| src/components/SearchForm.tsx:94:   shared: "Shared Room",
1951| NOTE: Implementation detail supporting search page behavior.
1952| src/components/SearchForm.tsx:95:   shared_room: "Shared Room",
1953| NOTE: Implementation detail supporting search page behavior.
1954| src/components/SearchForm.tsx:96:   entire: "Entire Place",
1955| NOTE: Implementation detail supporting search page behavior.
1956| src/components/SearchForm.tsx:97:   entire_place: "Entire Place",
1957| NOTE: Implementation detail supporting search page behavior.
1958| src/components/SearchForm.tsx:98: };
1959| NOTE: Implementation detail supporting search page behavior.
1960| src/components/SearchForm.tsx:99: 
1961| NOTE: Blank line for visual separation.
1962| src/components/SearchForm.tsx:100: /**
1963| NOTE: Block comment line describing behavior or context.
1964| src/components/SearchForm.tsx:101:  * Validate a price input. Returns true if empty or a valid non-negative number.
1965| NOTE: Block comment line describing behavior or context.
1966| src/components/SearchForm.tsx:102:  */
1967| NOTE: Block comment line describing behavior or context.
1968| src/components/SearchForm.tsx:103: const isValidPrice = (value: string): boolean => {
1969| NOTE: Local declaration used by search logic or UI.
1970| src/components/SearchForm.tsx:104:   if (!value || value.trim() === "") return true;
1971| NOTE: Conditional logic controlling rendering or flow.
1972| src/components/SearchForm.tsx:105:   const num = parseFloat(value);
1973| NOTE: Local declaration used by search logic or UI.
1974| src/components/SearchForm.tsx:106:   return !isNaN(num) && isFinite(num) && num >= 0;
1975| NOTE: Return statement for component or helper output.
1976| src/components/SearchForm.tsx:107: };
1977| NOTE: Implementation detail supporting search page behavior.
1978| src/components/SearchForm.tsx:108: 
1979| NOTE: Blank line for visual separation.
1980| src/components/SearchForm.tsx:109: /**
1981| NOTE: Block comment line describing behavior or context.
1982| src/components/SearchForm.tsx:110:  * Validate a move-in date string. Returns the date if valid (today or future, within 2 years),
1983| NOTE: Block comment line describing behavior or context.
1984| src/components/SearchForm.tsx:111:  * otherwise returns empty string. This matches the server-side safeParseDate logic.
1985| NOTE: Block comment line describing behavior or context.
1986| src/components/SearchForm.tsx:112:  */
1987| NOTE: Block comment line describing behavior or context.
1988| src/components/SearchForm.tsx:113: const validateMoveInDate = (value: string | null): string => {
1989| NOTE: Local declaration used by search logic or UI.
1990| src/components/SearchForm.tsx:114:   if (!value) return "";
1991| NOTE: Conditional logic controlling rendering or flow.
1992| src/components/SearchForm.tsx:115:   const trimmed = value.trim();
1993| NOTE: Local declaration used by search logic or UI.
1994| src/components/SearchForm.tsx:116:   if (!/^\d{4}-\d{2}-\d{2}$/.test(trimmed)) return "";
1995| NOTE: Conditional logic controlling rendering or flow.
1996| src/components/SearchForm.tsx:117: 
1997| NOTE: Blank line for visual separation.
1998| src/components/SearchForm.tsx:118:   const [yearStr, monthStr, dayStr] = trimmed.split("-");
1999| NOTE: Local declaration used by search logic or UI.
2000| src/components/SearchForm.tsx:119:   const year = parseInt(yearStr, 10);
2001| NOTE: Local declaration used by search logic or UI.
2002| src/components/SearchForm.tsx:120:   const month = parseInt(monthStr, 10);
2003| NOTE: Local declaration used by search logic or UI.
2004| src/components/SearchForm.tsx:121:   const day = parseInt(dayStr, 10);
2005| NOTE: Local declaration used by search logic or UI.
2006| src/components/SearchForm.tsx:122: 
2007| NOTE: Blank line for visual separation.
2008| src/components/SearchForm.tsx:123:   if (month < 1 || month > 12) return "";
2009| NOTE: Conditional logic controlling rendering or flow.
2010| src/components/SearchForm.tsx:124:   if (day < 1 || day > 31) return "";
2011| NOTE: Conditional logic controlling rendering or flow.
2012| src/components/SearchForm.tsx:125: 
2013| NOTE: Blank line for visual separation.
2014| src/components/SearchForm.tsx:126:   const date = new Date(year, month - 1, day);
2015| NOTE: Local declaration used by search logic or UI.
2016| src/components/SearchForm.tsx:127:   if (
2017| NOTE: Conditional logic controlling rendering or flow.
2018| src/components/SearchForm.tsx:128:     date.getFullYear() !== year ||
2019| NOTE: Implementation detail supporting search page behavior.
2020| src/components/SearchForm.tsx:129:     date.getMonth() !== month - 1 ||
2021| NOTE: Implementation detail supporting search page behavior.
2022| src/components/SearchForm.tsx:130:     date.getDate() !== day
2023| NOTE: Implementation detail supporting search page behavior.
2024| src/components/SearchForm.tsx:131:   ) {
2025| NOTE: Implementation detail supporting search page behavior.
2026| src/components/SearchForm.tsx:132:     return "";
2027| NOTE: Return statement for component or helper output.
2028| src/components/SearchForm.tsx:133:   }
2029| NOTE: Implementation detail supporting search page behavior.
2030| src/components/SearchForm.tsx:134: 
2031| NOTE: Blank line for visual separation.
2032| src/components/SearchForm.tsx:135:   // Reject past dates
2033| NOTE: Line comment documents intent or constraints.
2034| src/components/SearchForm.tsx:136:   const today = new Date();
2035| NOTE: Local declaration used by search logic or UI.
2036| src/components/SearchForm.tsx:137:   today.setHours(0, 0, 0, 0);
2037| NOTE: Implementation detail supporting search page behavior.
2038| src/components/SearchForm.tsx:138:   if (date < today) return "";
2039| NOTE: Conditional logic controlling rendering or flow.
2040| src/components/SearchForm.tsx:139: 
2041| NOTE: Blank line for visual separation.
2042| src/components/SearchForm.tsx:140:   // Reject dates more than 2 years in the future
2043| NOTE: Line comment documents intent or constraints.
2044| src/components/SearchForm.tsx:141:   const maxDate = new Date();
2045| NOTE: Local declaration used by search logic or UI.
2046| src/components/SearchForm.tsx:142:   maxDate.setFullYear(maxDate.getFullYear() + 2);
2047| NOTE: Implementation detail supporting search page behavior.
2048| src/components/SearchForm.tsx:143:   if (date > maxDate) return "";
2049| NOTE: Conditional logic controlling rendering or flow.
2050| src/components/SearchForm.tsx:144: 
2051| NOTE: Blank line for visual separation.
2052| src/components/SearchForm.tsx:145:   return trimmed;
2053| NOTE: Return statement for component or helper output.
2054| src/components/SearchForm.tsx:146: };
2055| NOTE: Implementation detail supporting search page behavior.
2056| src/components/SearchForm.tsx:147: 
2057| NOTE: Blank line for visual separation.
2058| src/components/SearchForm.tsx:148: // Custom event for map fly-to
2059| NOTE: Line comment documents intent or constraints.
2060| src/components/SearchForm.tsx:149: export const MAP_FLY_TO_EVENT = "mapFlyToLocation";
2061| NOTE: Implementation detail supporting search page behavior.
2062| src/components/SearchForm.tsx:150: 
2063| NOTE: Blank line for visual separation.
2064| src/components/SearchForm.tsx:151: export interface MapFlyToEventDetail {
2065| NOTE: Implementation detail supporting search page behavior.
2066| src/components/SearchForm.tsx:152:   lat: number;
2067| NOTE: Implementation detail supporting search page behavior.
2068| src/components/SearchForm.tsx:153:   lng: number;
2069| NOTE: Implementation detail supporting search page behavior.
2070| src/components/SearchForm.tsx:154:   bbox?: [number, number, number, number];
2071| NOTE: Implementation detail supporting search page behavior.
2072| src/components/SearchForm.tsx:155:   zoom?: number;
2073| NOTE: Implementation detail supporting search page behavior.
2074| src/components/SearchForm.tsx:156:   /** Search location name for conflict detection */
2075| NOTE: Block comment line describing behavior or context.
2076| src/components/SearchForm.tsx:157:   locationName?: string;
2077| NOTE: Implementation detail supporting search page behavior.
2078| src/components/SearchForm.tsx:158: }
2079| NOTE: Implementation detail supporting search page behavior.
2080| src/components/SearchForm.tsx:159: 
2081| NOTE: Blank line for visual separation.
2082| src/components/SearchForm.tsx:160: export default function SearchForm({
2083| NOTE: Exports main component for this module.
2084| src/components/SearchForm.tsx:161:   variant = "default",
2085| NOTE: Implementation detail supporting search page behavior.
2086| src/components/SearchForm.tsx:162: }: {
2087| NOTE: Implementation detail supporting search page behavior.
2088| src/components/SearchForm.tsx:163:   variant?: "default" | "compact";
2089| NOTE: Implementation detail supporting search page behavior.
2090| src/components/SearchForm.tsx:164: }) {
2091| NOTE: Implementation detail supporting search page behavior.
2092| src/components/SearchForm.tsx:165:   const searchParams = useSearchParams();
2093| NOTE: Local declaration used by search logic or UI.
2094| src/components/SearchForm.tsx:166:   const parseParamList = (key: string): string[] => {
2095| NOTE: Local declaration used by search logic or UI.
2096| src/components/SearchForm.tsx:167:     const values = searchParams.getAll(key);
2097| NOTE: Local declaration used by search logic or UI.
2098| src/components/SearchForm.tsx:168:     if (values.length === 0) return [];
2099| NOTE: Conditional logic controlling rendering or flow.
2100| src/components/SearchForm.tsx:169:     return values
2101| NOTE: Return statement for component or helper output.
2102| src/components/SearchForm.tsx:170:       .flatMap((value) => value.split(","))
2103| NOTE: Implementation detail supporting search page behavior.
2104| src/components/SearchForm.tsx:171:       .map((value) => value.trim())
2105| NOTE: Implementation detail supporting search page behavior.
2106| src/components/SearchForm.tsx:172:       .filter(Boolean);
2107| NOTE: Implementation detail supporting search page behavior.
2108| src/components/SearchForm.tsx:173:   };
2109| NOTE: Implementation detail supporting search page behavior.
2110| src/components/SearchForm.tsx:174:   const normalizeByAllowlist = (
2111| NOTE: Local declaration used by search logic or UI.
2112| src/components/SearchForm.tsx:175:     values: string[],
2113| NOTE: Implementation detail supporting search page behavior.
2114| src/components/SearchForm.tsx:176:     allowlist: readonly string[],
2115| NOTE: Implementation detail supporting search page behavior.
2116| src/components/SearchForm.tsx:177:   ) => {
2117| NOTE: Implementation detail supporting search page behavior.
2118| src/components/SearchForm.tsx:178:     const allowMap = new Map(
2119| NOTE: Local declaration used by search logic or UI.
2120| src/components/SearchForm.tsx:179:       allowlist.map((item) => [item.toLowerCase(), item]),
2121| NOTE: Implementation detail supporting search page behavior.
2122| src/components/SearchForm.tsx:180:     );
2123| NOTE: Implementation detail supporting search page behavior.
2124| src/components/SearchForm.tsx:181:     const normalized = values
2125| NOTE: Local declaration used by search logic or UI.
2126| src/components/SearchForm.tsx:182:       .map((value) => allowMap.get(value.toLowerCase()))
2127| NOTE: Implementation detail supporting search page behavior.
2128| src/components/SearchForm.tsx:183:       .filter((value): value is string => Boolean(value));
2129| NOTE: Implementation detail supporting search page behavior.
2130| src/components/SearchForm.tsx:184:     return Array.from(new Set(normalized));
2131| NOTE: Return statement for component or helper output.
2132| src/components/SearchForm.tsx:185:   };
2133| NOTE: Implementation detail supporting search page behavior.
2134| src/components/SearchForm.tsx:186:   const parseEnumParam = (
2135| NOTE: Local declaration used by search logic or UI.
2136| src/components/SearchForm.tsx:187:     key: string,
2137| NOTE: Implementation detail supporting search page behavior.
2138| src/components/SearchForm.tsx:188:     allowlist: readonly string[],
2139| NOTE: Implementation detail supporting search page behavior.
2140| src/components/SearchForm.tsx:189:     aliases?: Record<string, string>,
2141| NOTE: Implementation detail supporting search page behavior.
2142| src/components/SearchForm.tsx:190:   ) => {
2143| NOTE: Implementation detail supporting search page behavior.
2144| src/components/SearchForm.tsx:191:     const value = searchParams.get(key);
2145| NOTE: Local declaration used by search logic or UI.
2146| src/components/SearchForm.tsx:192:     if (!value) return "";
2147| NOTE: Conditional logic controlling rendering or flow.
2148| src/components/SearchForm.tsx:193:     const trimmed = value.trim();
2149| NOTE: Local declaration used by search logic or UI.
2150| src/components/SearchForm.tsx:194:     // Check direct match first
2151| NOTE: Line comment documents intent or constraints.
2152| src/components/SearchForm.tsx:195:     if (allowlist.includes(trimmed)) return trimmed;
2153| NOTE: Conditional logic controlling rendering or flow.
2154| src/components/SearchForm.tsx:196:     // Check case-insensitive match
2155| NOTE: Line comment documents intent or constraints.
2156| src/components/SearchForm.tsx:197:     const lowerValue = trimmed.toLowerCase();
2157| NOTE: Local declaration used by search logic or UI.
2158| src/components/SearchForm.tsx:198:     const caseMatch = allowlist.find(
2159| NOTE: Local declaration used by search logic or UI.
2160| src/components/SearchForm.tsx:199:       (item) => item.toLowerCase() === lowerValue,
2161| NOTE: Implementation detail supporting search page behavior.
2162| src/components/SearchForm.tsx:200:     );
2163| NOTE: Implementation detail supporting search page behavior.
2164| src/components/SearchForm.tsx:201:     if (caseMatch) return caseMatch;
2165| NOTE: Conditional logic controlling rendering or flow.
2166| src/components/SearchForm.tsx:202:     // Check aliases if provided
2167| NOTE: Line comment documents intent or constraints.
2168| src/components/SearchForm.tsx:203:     if (aliases) {
2169| NOTE: Conditional logic controlling rendering or flow.
2170| src/components/SearchForm.tsx:204:       const aliasMatch = aliases[lowerValue];
2171| NOTE: Local declaration used by search logic or UI.
2172| src/components/SearchForm.tsx:205:       if (aliasMatch && allowlist.includes(aliasMatch)) return aliasMatch;
2173| NOTE: Conditional logic controlling rendering or flow.
2174| src/components/SearchForm.tsx:206:     }
2175| NOTE: Implementation detail supporting search page behavior.
2176| src/components/SearchForm.tsx:207:     // Invalid value - return empty string
2177| NOTE: Line comment documents intent or constraints.
2178| src/components/SearchForm.tsx:208:     return "";
2179| NOTE: Return statement for component or helper output.
2180| src/components/SearchForm.tsx:209:   };
2181| NOTE: Implementation detail supporting search page behavior.
2182| src/components/SearchForm.tsx:210:   const parseLanguages = () => {
2183| NOTE: Local declaration used by search logic or UI.
2184| src/components/SearchForm.tsx:211:     const normalized = normalizeLanguages(parseParamList("languages"));
2185| NOTE: Local declaration used by search logic or UI.
2186| src/components/SearchForm.tsx:212:     return Array.from(new Set(normalized));
2187| NOTE: Return statement for component or helper output.
2188| src/components/SearchForm.tsx:213:   };
2189| NOTE: Implementation detail supporting search page behavior.
2190| src/components/SearchForm.tsx:214:   const parseCoords = () => {
2191| NOTE: Local declaration used by search logic or UI.
2192| src/components/SearchForm.tsx:215:     const lat = searchParams.get("lat");
2193| NOTE: Local declaration used by search logic or UI.
2194| src/components/SearchForm.tsx:216:     const lng = searchParams.get("lng");
2195| NOTE: Local declaration used by search logic or UI.
2196| src/components/SearchForm.tsx:217:     if (!lat || !lng) return null;
2197| NOTE: Conditional logic controlling rendering or flow.
2198| src/components/SearchForm.tsx:218:     const parsedLat = parseFloat(lat);
2199| NOTE: Local declaration used by search logic or UI.
2200| src/components/SearchForm.tsx:219:     const parsedLng = parseFloat(lng);
2201| NOTE: Local declaration used by search logic or UI.
2202| src/components/SearchForm.tsx:220:     if (!Number.isFinite(parsedLat) || !Number.isFinite(parsedLng)) {
2203| NOTE: Conditional logic controlling rendering or flow.
2204| src/components/SearchForm.tsx:221:       return null;
2205| NOTE: Return statement for component or helper output.
2206| src/components/SearchForm.tsx:222:     }
2207| NOTE: Implementation detail supporting search page behavior.
2208| src/components/SearchForm.tsx:223:     return { lat: parsedLat, lng: parsedLng };
2209| NOTE: Return statement for component or helper output.
2210| src/components/SearchForm.tsx:224:   };
2211| NOTE: Implementation detail supporting search page behavior.
2212| src/components/SearchForm.tsx:225:   const [location, setLocation] = useState(searchParams.get("q") || "");
2213| NOTE: Initializes local state for search UI behavior.
2214| src/components/SearchForm.tsx:226:   const [showFilters, setShowFilters] = useState(false);
2215| NOTE: Initializes local state for search UI behavior.
2216| src/components/SearchForm.tsx:227: 
2217| NOTE: Blank line for visual separation.
2218| src/components/SearchForm.tsx:228:   const [selectedCoords, setSelectedCoords] = useState<{
2219| NOTE: Initializes local state for search UI behavior.
2220| src/components/SearchForm.tsx:229:     lat: number;
2221| NOTE: Implementation detail supporting search page behavior.
2222| src/components/SearchForm.tsx:230:     lng: number;
2223| NOTE: Implementation detail supporting search page behavior.
2224| src/components/SearchForm.tsx:231:     bbox?: [number, number, number, number];
2225| NOTE: Implementation detail supporting search page behavior.
2226| src/components/SearchForm.tsx:232:   } | null>(parseCoords);
2227| NOTE: Implementation detail supporting search page behavior.
2228| src/components/SearchForm.tsx:233: 
2229| NOTE: Blank line for visual separation.
2230| src/components/SearchForm.tsx:234:   // Batched filters - changes accumulate until Apply is clicked
2231| NOTE: Line comment documents intent or constraints.
2232| src/components/SearchForm.tsx:235:   const {
2233| NOTE: Local declaration used by search logic or UI.
2234| src/components/SearchForm.tsx:236:     pending: batchedFilters,
2235| NOTE: Implementation detail supporting search page behavior.
2236| src/components/SearchForm.tsx:237:     committed: committedFilters,
2237| NOTE: Implementation detail supporting search page behavior.
2238| src/components/SearchForm.tsx:238:     isDirty: filtersDirty,
2239| NOTE: Implementation detail supporting search page behavior.
2240| src/components/SearchForm.tsx:239:     changeCount: filtersChangeCount,
2241| NOTE: Implementation detail supporting search page behavior.
2242| src/components/SearchForm.tsx:240:     apply: applyBatchedFilters,
2243| NOTE: Implementation detail supporting search page behavior.
2244| src/components/SearchForm.tsx:241:     reset: resetBatchedFilters,
2245| NOTE: Implementation detail supporting search page behavior.
2246| src/components/SearchForm.tsx:242:     updateField: updateBatchedField,
2247| NOTE: Implementation detail supporting search page behavior.
2248| src/components/SearchForm.tsx:243:     toggleArrayItem: toggleBatchedArrayItem,
2249| NOTE: Implementation detail supporting search page behavior.
2250| src/components/SearchForm.tsx:244:   } = useBatchedFilters();
2251| NOTE: Implementation detail supporting search page behavior.
2252| src/components/SearchForm.tsx:245: 
2253| NOTE: Blank line for visual separation.
2254| src/components/SearchForm.tsx:246:   // Debounced count for "Show X listings" button in filter drawer
2255| NOTE: Line comment documents intent or constraints.
2256| src/components/SearchForm.tsx:247:   const {
2257| NOTE: Local declaration used by search logic or UI.
2258| src/components/SearchForm.tsx:248:     count: pendingCount,
2259| NOTE: Implementation detail supporting search page behavior.
2260| src/components/SearchForm.tsx:249:     previousCount,
2261| NOTE: Implementation detail supporting search page behavior.
2262| src/components/SearchForm.tsx:250:     baselineCount,
2263| NOTE: Implementation detail supporting search page behavior.
2264| src/components/SearchForm.tsx:251:     isLoading: isCountLoading,
2265| NOTE: Implementation detail supporting search page behavior.
2266| src/components/SearchForm.tsx:252:   } = useDebouncedFilterCount({
2267| NOTE: Implementation detail supporting search page behavior.
2268| src/components/SearchForm.tsx:253:     pending: batchedFilters,
2269| NOTE: Implementation detail supporting search page behavior.
2270| src/components/SearchForm.tsx:254:     isDirty: filtersDirty,
2271| NOTE: Implementation detail supporting search page behavior.
2272| src/components/SearchForm.tsx:255:     isDrawerOpen: showFilters,
2273| NOTE: Implementation detail supporting search page behavior.
2274| src/components/SearchForm.tsx:256:   });
2275| NOTE: Implementation detail supporting search page behavior.
2276| src/components/SearchForm.tsx:257: 
2277| NOTE: Blank line for visual separation.
2278| src/components/SearchForm.tsx:258:   // Sync filter state with context for external components (e.g., PendingFiltersBanner)
2279| NOTE: Line comment documents intent or constraints.
2280| src/components/SearchForm.tsx:259:   const filterStateContext = useFilterStateSafe();
2281| NOTE: Local declaration used by search logic or UI.
2282| src/components/SearchForm.tsx:260: 
2283| NOTE: Blank line for visual separation.
2284| src/components/SearchForm.tsx:261:   // Sync dirty state to context
2285| NOTE: Line comment documents intent or constraints.
2286| src/components/SearchForm.tsx:262:   useEffect(() => {
2287| NOTE: Defines side effect for syncing with external state.
2288| src/components/SearchForm.tsx:263:     if (filterStateContext) {
2289| NOTE: Conditional logic controlling rendering or flow.
2290| src/components/SearchForm.tsx:264:       filterStateContext.setDirtyState(filtersDirty, filtersChangeCount);
2291| NOTE: Implementation detail supporting search page behavior.
2292| src/components/SearchForm.tsx:265:     }
2293| NOTE: Implementation detail supporting search page behavior.
2294| src/components/SearchForm.tsx:266:   }, [filterStateContext, filtersDirty, filtersChangeCount]);
2295| NOTE: Implementation detail supporting search page behavior.
2296| src/components/SearchForm.tsx:267: 
2297| NOTE: Blank line for visual separation.
2298| src/components/SearchForm.tsx:268:   // Sync drawer open state to context
2299| NOTE: Line comment documents intent or constraints.
2300| src/components/SearchForm.tsx:269:   useEffect(() => {
2301| NOTE: Defines side effect for syncing with external state.
2302| src/components/SearchForm.tsx:270:     if (filterStateContext) {
2303| NOTE: Conditional logic controlling rendering or flow.
2304| src/components/SearchForm.tsx:271:       filterStateContext.setDrawerOpen(showFilters);
2305| NOTE: Implementation detail supporting search page behavior.
2306| src/components/SearchForm.tsx:272:     }
2307| NOTE: Implementation detail supporting search page behavior.
2308| src/components/SearchForm.tsx:273:   }, [filterStateContext, showFilters]);
2309| NOTE: Implementation detail supporting search page behavior.
2310| src/components/SearchForm.tsx:274: 
2311| NOTE: Blank line for visual separation.
2312| src/components/SearchForm.tsx:275:   // Register callback to open drawer from external components
2313| NOTE: Line comment documents intent or constraints.
2314| src/components/SearchForm.tsx:276:   useEffect(() => {
2315| NOTE: Defines side effect for syncing with external state.
2316| src/components/SearchForm.tsx:277:     if (filterStateContext) {
2317| NOTE: Conditional logic controlling rendering or flow.
2318| src/components/SearchForm.tsx:278:       filterStateContext.registerOpenDrawer(() => setShowFilters(true));
2319| NOTE: Implementation detail supporting search page behavior.
2320| src/components/SearchForm.tsx:279:     }
2321| NOTE: Implementation detail supporting search page behavior.
2322| src/components/SearchForm.tsx:280:   }, [filterStateContext]);
2323| NOTE: Implementation detail supporting search page behavior.
2324| src/components/SearchForm.tsx:281: 
2325| NOTE: Blank line for visual separation.
2326| src/components/SearchForm.tsx:282:   // Register callback to open filters from collapsed mobile header
2327| NOTE: Line comment documents intent or constraints.
2328| src/components/SearchForm.tsx:283:   // Destructure only the function needed to avoid infinite re-render loops
2329| NOTE: Line comment documents intent or constraints.
2330| src/components/SearchForm.tsx:284:   const { registerOpenFilters } = useMobileSearch();
2331| NOTE: Local declaration used by search logic or UI.
2332| src/components/SearchForm.tsx:285:   useEffect(() => {
2333| NOTE: Defines side effect for syncing with external state.
2334| src/components/SearchForm.tsx:286:     registerOpenFilters(() => setShowFilters(true));
2335| NOTE: Implementation detail supporting search page behavior.
2336| src/components/SearchForm.tsx:287:   }, [registerOpenFilters]);
2337| NOTE: Implementation detail supporting search page behavior.
2338| src/components/SearchForm.tsx:288: 
2339| NOTE: Blank line for visual separation.
2340| src/components/SearchForm.tsx:289:   // Local price state for main search bar (synced from batched filters)
2341| NOTE: Line comment documents intent or constraints.
2342| src/components/SearchForm.tsx:290:   // This allows the main form to show/edit price while keeping batched logic
2343| NOTE: Line comment documents intent or constraints.
2344| src/components/SearchForm.tsx:291:   const [localMinPrice, setLocalMinPrice] = useState(batchedFilters.minPrice);
2345| NOTE: Initializes local state for search UI behavior.
2346| src/components/SearchForm.tsx:292:   const [localMaxPrice, setLocalMaxPrice] = useState(batchedFilters.maxPrice);
2347| NOTE: Initializes local state for search UI behavior.
2348| src/components/SearchForm.tsx:293: 
2349| NOTE: Blank line for visual separation.
2350| src/components/SearchForm.tsx:294:   // Sync local price with batched filters when URL changes
2351| NOTE: Line comment documents intent or constraints.
2352| src/components/SearchForm.tsx:295:   useEffect(() => {
2353| NOTE: Defines side effect for syncing with external state.
2354| src/components/SearchForm.tsx:296:     setLocalMinPrice(committedFilters.minPrice);
2355| NOTE: Implementation detail supporting search page behavior.
2356| src/components/SearchForm.tsx:297:     setLocalMaxPrice(committedFilters.maxPrice);
2357| NOTE: Implementation detail supporting search page behavior.
2358| src/components/SearchForm.tsx:298:   }, [committedFilters.minPrice, committedFilters.maxPrice]);
2359| NOTE: Implementation detail supporting search page behavior.
2360| src/components/SearchForm.tsx:299: 
2361| NOTE: Blank line for visual separation.
2362| src/components/SearchForm.tsx:300:   const [hasMounted, setHasMounted] = useState(false);
2363| NOTE: Initializes local state for search UI behavior.
2364| src/components/SearchForm.tsx:301: 
2365| NOTE: Blank line for visual separation.
2366| src/components/SearchForm.tsx:302:   // Language search filter state
2367| NOTE: Line comment documents intent or constraints.
2368| src/components/SearchForm.tsx:303:   const [languageSearch, setLanguageSearch] = useState("");
2369| NOTE: Initializes local state for search UI behavior.
2370| src/components/SearchForm.tsx:304: 
2371| NOTE: Blank line for visual separation.
2372| src/components/SearchForm.tsx:305:   // Get all language codes from canonical list
2373| NOTE: Line comment documents intent or constraints.
2374| src/components/SearchForm.tsx:306:   const LANGUAGE_CODES = Object.keys(SUPPORTED_LANGUAGES) as LanguageCode[];
2375| NOTE: Local declaration used by search logic or UI.
2376| src/components/SearchForm.tsx:307: 
2377| NOTE: Blank line for visual separation.
2378| src/components/SearchForm.tsx:308:   // Filter languages based on search
2379| NOTE: Line comment documents intent or constraints.
2380| src/components/SearchForm.tsx:309:   const filteredLanguages = useMemo(() => {
2381| NOTE: Memoizes derived values to reduce re-render work.
2382| src/components/SearchForm.tsx:310:     if (!languageSearch.trim()) return LANGUAGE_CODES;
2383| NOTE: Conditional logic controlling rendering or flow.
2384| src/components/SearchForm.tsx:311:     const search = languageSearch.toLowerCase();
2385| NOTE: Local declaration used by search logic or UI.
2386| src/components/SearchForm.tsx:312:     return LANGUAGE_CODES.filter(
2387| NOTE: Return statement for component or helper output.
2388| src/components/SearchForm.tsx:313:       (code) =>
2389| NOTE: Implementation detail supporting search page behavior.
2390| src/components/SearchForm.tsx:314:         getLanguageName(code).toLowerCase().includes(search) ||
2391| NOTE: Implementation detail supporting search page behavior.
2392| src/components/SearchForm.tsx:315:         code.toLowerCase().includes(search),
2393| NOTE: Implementation detail supporting search page behavior.
2394| src/components/SearchForm.tsx:316:     );
2395| NOTE: Implementation detail supporting search page behavior.
2396| src/components/SearchForm.tsx:317:   }, [languageSearch]);
2397| NOTE: Implementation detail supporting search page behavior.
2398| src/components/SearchForm.tsx:318: 
2399| NOTE: Blank line for visual separation.
2400| src/components/SearchForm.tsx:319:   // Debounce and submission state to prevent race conditions
2401| NOTE: Line comment documents intent or constraints.
2402| src/components/SearchForm.tsx:320:   const [isSearching, setIsSearching] = useState(false);
2403| NOTE: Initializes local state for search UI behavior.
2404| src/components/SearchForm.tsx:321:   const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);
2405| NOTE: Uses ref for stable mutable storage between renders.
2406| src/components/SearchForm.tsx:322:   const lastSearchRef = useRef<string>(""); // Track last search to prevent duplicates
2407| NOTE: Uses ref for stable mutable storage between renders.
2408| src/components/SearchForm.tsx:323: 
2409| NOTE: Blank line for visual separation.
2410| src/components/SearchForm.tsx:324:   // Recent searches hook (P2-11)
2411| NOTE: Line comment documents intent or constraints.
2412| src/components/SearchForm.tsx:325:   const {
2413| NOTE: Local declaration used by search logic or UI.
2414| src/components/SearchForm.tsx:326:     recentSearches,
2415| NOTE: Implementation detail supporting search page behavior.
2416| src/components/SearchForm.tsx:327:     saveRecentSearch,
2417| NOTE: Implementation detail supporting search page behavior.
2418| src/components/SearchForm.tsx:328:     clearRecentSearches,
2419| NOTE: Implementation detail supporting search page behavior.
2420| src/components/SearchForm.tsx:329:     getFilterSummary,
2421| NOTE: Implementation detail supporting search page behavior.
2422| src/components/SearchForm.tsx:330:   } = useRecentSearches();
2423| NOTE: Implementation detail supporting search page behavior.
2424| src/components/SearchForm.tsx:331:   const [showRecentSearches, setShowRecentSearches] = useState(false);
2425| NOTE: Initializes local state for search UI behavior.
2426| src/components/SearchForm.tsx:332: 
2427| NOTE: Blank line for visual separation.
2428| src/components/SearchForm.tsx:333:   // Ref for programmatic focus on location search input (keyboard shortcuts)
2429| NOTE: Line comment documents intent or constraints.
2430| src/components/SearchForm.tsx:334:   const locationInputRef = useRef<LocationSearchInputRef>(null);
2431| NOTE: Uses ref for stable mutable storage between renders.
2432| src/components/SearchForm.tsx:335: 
2433| NOTE: Blank line for visual separation.
2434| src/components/SearchForm.tsx:336:   // Select a recent search - applies location, coords, and optionally filters
2435| NOTE: Line comment documents intent or constraints.
2436| src/components/SearchForm.tsx:337:   const selectRecentSearch = useCallback(
2437| NOTE: Memoizes callback to preserve references across renders.
2438| src/components/SearchForm.tsx:338:     (search: RecentSearch) => {
2439| NOTE: Implementation detail supporting search page behavior.
2440| src/components/SearchForm.tsx:339:       setLocation(search.location);
2441| NOTE: Implementation detail supporting search page behavior.
2442| src/components/SearchForm.tsx:340:       if (search.coords) {
2443| NOTE: Conditional logic controlling rendering or flow.
2444| src/components/SearchForm.tsx:341:         setSelectedCoords(search.coords);
2445| NOTE: Implementation detail supporting search page behavior.
2446| src/components/SearchForm.tsx:342:       }
2447| NOTE: Implementation detail supporting search page behavior.
2448| src/components/SearchForm.tsx:343:       // Optionally restore filters from the recent search
2449| NOTE: Line comment documents intent or constraints.
2450| src/components/SearchForm.tsx:344:       // This is a UX choice - we restore filters if they were saved
2451| NOTE: Line comment documents intent or constraints.
2452| src/components/SearchForm.tsx:345:       if (search.filters) {
2453| NOTE: Conditional logic controlling rendering or flow.
2454| src/components/SearchForm.tsx:346:         if (search.filters.minPrice) setLocalMinPrice(search.filters.minPrice);
2455| NOTE: Conditional logic controlling rendering or flow.
2456| src/components/SearchForm.tsx:347:         if (search.filters.maxPrice) setLocalMaxPrice(search.filters.maxPrice);
2457| NOTE: Conditional logic controlling rendering or flow.
2458| src/components/SearchForm.tsx:348:         // Note: For batched filters, we'd need to call setBatchedFilter for each
2459| NOTE: Line comment documents intent or constraints.
2460| src/components/SearchForm.tsx:349:         // but that could be jarring UX. For now, just restore location/coords.
2461| NOTE: Line comment documents intent or constraints.
2462| src/components/SearchForm.tsx:350:       }
2463| NOTE: Implementation detail supporting search page behavior.
2464| src/components/SearchForm.tsx:351:       setShowRecentSearches(false);
2465| NOTE: Implementation detail supporting search page behavior.
2466| src/components/SearchForm.tsx:352:     },
2467| NOTE: Implementation detail supporting search page behavior.
2468| src/components/SearchForm.tsx:353:     [setLocalMinPrice, setLocalMaxPrice],
2469| NOTE: Implementation detail supporting search page behavior.
2470| src/components/SearchForm.tsx:354:   );
2471| NOTE: Implementation detail supporting search page behavior.
2472| src/components/SearchForm.tsx:355: 
2473| NOTE: Blank line for visual separation.
2474| src/components/SearchForm.tsx:356:   // Set hasMounted after initial render
2475| NOTE: Line comment documents intent or constraints.
2476| src/components/SearchForm.tsx:357:   useEffect(() => {
2477| NOTE: Defines side effect for syncing with external state.
2478| src/components/SearchForm.tsx:358:     setHasMounted(true);
2479| NOTE: Implementation detail supporting search page behavior.
2480| src/components/SearchForm.tsx:359:   }, []);
2481| NOTE: Implementation detail supporting search page behavior.
2482| src/components/SearchForm.tsx:360: 
2483| NOTE: Blank line for visual separation.
2484| src/components/SearchForm.tsx:361:   // Sync non-batched state with URL params when they change (e.g., after navigation)
2485| NOTE: Line comment documents intent or constraints.
2486| src/components/SearchForm.tsx:362:   // Note: Batched filters are automatically synced by useBatchedFilters hook
2487| NOTE: Line comment documents intent or constraints.
2488| src/components/SearchForm.tsx:363:   useEffect(() => {
2489| NOTE: Defines side effect for syncing with external state.
2490| src/components/SearchForm.tsx:364:     const coords = parseCoords();
2491| NOTE: Local declaration used by search logic or UI.
2492| src/components/SearchForm.tsx:365:     if (coords) {
2493| NOTE: Conditional logic controlling rendering or flow.
2494| src/components/SearchForm.tsx:366:       setSelectedCoords(coords);
2495| NOTE: Implementation detail supporting search page behavior.
2496| src/components/SearchForm.tsx:367:     }
2497| NOTE: Implementation detail supporting search page behavior.
2498| src/components/SearchForm.tsx:368:     // Only sync location - batched filters handled by hook
2499| NOTE: Line comment documents intent or constraints.
2500| src/components/SearchForm.tsx:369:     setLocation(searchParams.get("q") || "");
2501| NOTE: Implementation detail supporting search page behavior.
2502| src/components/SearchForm.tsx:370:   }, [searchParams]);
2503| NOTE: Implementation detail supporting search page behavior.
2504| src/components/SearchForm.tsx:371: 
2505| NOTE: Blank line for visual separation.
2506| src/components/SearchForm.tsx:372:   const router = useRouter();
2507| NOTE: Local declaration used by search logic or UI.
2508| src/components/SearchForm.tsx:373:   const transitionContext = useSearchTransitionSafe();
2509| NOTE: Local declaration used by search logic or UI.
2510| src/components/SearchForm.tsx:374:   // Use transition-aware navigation when available, fallback to router
2511| NOTE: Line comment documents intent or constraints.
2512| src/components/SearchForm.tsx:375:   const navigate = useCallback(
2513| NOTE: Memoizes callback to preserve references across renders.
2514| src/components/SearchForm.tsx:376:     (url: string) => {
2515| NOTE: Implementation detail supporting search page behavior.
2516| src/components/SearchForm.tsx:377:       if (transitionContext) {
2517| NOTE: Conditional logic controlling rendering or flow.
2518| src/components/SearchForm.tsx:378:         transitionContext.navigateWithTransition(url);
2519| NOTE: Routing logic updates search URL state.
2520| src/components/SearchForm.tsx:379:       } else {
2521| NOTE: Implementation detail supporting search page behavior.
2522| src/components/SearchForm.tsx:380:         router.push(url, { scroll: false });
2523| NOTE: Routing logic updates search URL state.
2524| src/components/SearchForm.tsx:381:       }
2525| NOTE: Implementation detail supporting search page behavior.
2526| src/components/SearchForm.tsx:382:     },
2527| NOTE: Implementation detail supporting search page behavior.
2528| src/components/SearchForm.tsx:383:     [transitionContext, router],
2529| NOTE: Implementation detail supporting search page behavior.
2530| src/components/SearchForm.tsx:384:   );
2531| NOTE: Implementation detail supporting search page behavior.
2532| src/components/SearchForm.tsx:385: 
2533| NOTE: Blank line for visual separation.
2534| src/components/SearchForm.tsx:386:   // Get current sort from URL for mobile filter drawer
2535| NOTE: Line comment documents intent or constraints.
2536| src/components/SearchForm.tsx:387:   const currentSort = (searchParams.get("sort") as SortOption) || "recommended";
2537| NOTE: Local declaration used by search logic or UI.
2538| src/components/SearchForm.tsx:388: 
2539| NOTE: Blank line for visual separation.
2540| src/components/SearchForm.tsx:389:   // Handle sort change (instant apply like desktop)
2541| NOTE: Line comment documents intent or constraints.
2542| src/components/SearchForm.tsx:390:   const handleSortChange = useCallback(
2543| NOTE: Memoizes callback to preserve references across renders.
2544| src/components/SearchForm.tsx:391:     (newSort: SortOption) => {
2545| NOTE: Implementation detail supporting search page behavior.
2546| src/components/SearchForm.tsx:392:       const params = new URLSearchParams(searchParams.toString());
2547| NOTE: Local declaration used by search logic or UI.
2548| src/components/SearchForm.tsx:393:       if (newSort === "recommended") {
2549| NOTE: Conditional logic controlling rendering or flow.
2550| src/components/SearchForm.tsx:394:         params.delete("sort");
2551| NOTE: Implementation detail supporting search page behavior.
2552| src/components/SearchForm.tsx:395:       } else {
2553| NOTE: Implementation detail supporting search page behavior.
2554| src/components/SearchForm.tsx:396:         params.set("sort", newSort);
2555| NOTE: Implementation detail supporting search page behavior.
2556| src/components/SearchForm.tsx:397:       }
2557| NOTE: Implementation detail supporting search page behavior.
2558| src/components/SearchForm.tsx:398:       // Reset to page 1 when sorting changes
2559| NOTE: Line comment documents intent or constraints.
2560| src/components/SearchForm.tsx:399:       params.delete("page");
2561| NOTE: Implementation detail supporting search page behavior.
2562| src/components/SearchForm.tsx:400:       navigate(`/search?${params.toString()}`);
2563| NOTE: Routing logic updates search URL state.
2564| src/components/SearchForm.tsx:401:     },
2565| NOTE: Implementation detail supporting search page behavior.
2566| src/components/SearchForm.tsx:402:     [searchParams, navigate],
2567| NOTE: Routing logic updates search URL state.
2568| src/components/SearchForm.tsx:403:   );
2569| NOTE: Implementation detail supporting search page behavior.
2570| src/components/SearchForm.tsx:404: 
2571| NOTE: Blank line for visual separation.
2572| src/components/SearchForm.tsx:405:   const handleLocationSelect = (locationData: {
2573| NOTE: Local declaration used by search logic or UI.
2574| src/components/SearchForm.tsx:406:     name: string;
2575| NOTE: Implementation detail supporting search page behavior.
2576| src/components/SearchForm.tsx:407:     lat: number;
2577| NOTE: Implementation detail supporting search page behavior.
2578| src/components/SearchForm.tsx:408:     lng: number;
2579| NOTE: Implementation detail supporting search page behavior.
2580| src/components/SearchForm.tsx:409:     bbox?: [number, number, number, number];
2581| NOTE: Implementation detail supporting search page behavior.
2582| src/components/SearchForm.tsx:410:   }) => {
2583| NOTE: Implementation detail supporting search page behavior.
2584| src/components/SearchForm.tsx:411:     setSelectedCoords({
2585| NOTE: Implementation detail supporting search page behavior.
2586| src/components/SearchForm.tsx:412:       lat: locationData.lat,
2587| NOTE: Implementation detail supporting search page behavior.
2588| src/components/SearchForm.tsx:413:       lng: locationData.lng,
2589| NOTE: Implementation detail supporting search page behavior.
2590| src/components/SearchForm.tsx:414:       bbox: locationData.bbox,
2591| NOTE: Implementation detail supporting search page behavior.
2592| src/components/SearchForm.tsx:415:     });
2593| NOTE: Implementation detail supporting search page behavior.
2594| src/components/SearchForm.tsx:416: 
2595| NOTE: Blank line for visual separation.
2596| src/components/SearchForm.tsx:417:     // Dispatch custom event for map to fly to location
2597| NOTE: Line comment documents intent or constraints.
2598| src/components/SearchForm.tsx:418:     const event = new CustomEvent<MapFlyToEventDetail>(MAP_FLY_TO_EVENT, {
2599| NOTE: Local declaration used by search logic or UI.
2600| src/components/SearchForm.tsx:419:       detail: {
2601| NOTE: Implementation detail supporting search page behavior.
2602| src/components/SearchForm.tsx:420:         lat: locationData.lat,
2603| NOTE: Implementation detail supporting search page behavior.
2604| src/components/SearchForm.tsx:421:         lng: locationData.lng,
2605| NOTE: Implementation detail supporting search page behavior.
2606| src/components/SearchForm.tsx:422:         bbox: locationData.bbox,
2607| NOTE: Implementation detail supporting search page behavior.
2608| src/components/SearchForm.tsx:423:         zoom: 13,
2609| NOTE: Implementation detail supporting search page behavior.
2610| src/components/SearchForm.tsx:424:         locationName: locationData.name,
2611| NOTE: Implementation detail supporting search page behavior.
2612| src/components/SearchForm.tsx:425:       },
2613| NOTE: Implementation detail supporting search page behavior.
2614| src/components/SearchForm.tsx:426:     });
2615| NOTE: Implementation detail supporting search page behavior.
2616| src/components/SearchForm.tsx:427:     window.dispatchEvent(event);
2617| NOTE: Implementation detail supporting search page behavior.
2618| src/components/SearchForm.tsx:428:   };
2619| NOTE: Implementation detail supporting search page behavior.
2620| src/components/SearchForm.tsx:429: 
2621| NOTE: Blank line for visual separation.
2622| src/components/SearchForm.tsx:430:   // Build URL params from filter values (used by both main search and drawer apply)
2623| NOTE: Line comment documents intent or constraints.
2624| src/components/SearchForm.tsx:431:   const buildSearchParams = useCallback(
2625| NOTE: Memoizes callback to preserve references across renders.
2626| src/components/SearchForm.tsx:432:     (filterValues: {
2627| NOTE: Implementation detail supporting search page behavior.
2628| src/components/SearchForm.tsx:433:       minPrice: string;
2629| NOTE: Implementation detail supporting search page behavior.
2630| src/components/SearchForm.tsx:434:       maxPrice: string;
2631| NOTE: Implementation detail supporting search page behavior.
2632| src/components/SearchForm.tsx:435:       moveInDate: string;
2633| NOTE: Implementation detail supporting search page behavior.
2634| src/components/SearchForm.tsx:436:       leaseDuration: string;
2635| NOTE: Implementation detail supporting search page behavior.
2636| src/components/SearchForm.tsx:437:       roomType: string;
2637| NOTE: Implementation detail supporting search page behavior.
2638| src/components/SearchForm.tsx:438:       amenities: string[];
2639| NOTE: Implementation detail supporting search page behavior.
2640| src/components/SearchForm.tsx:439:       houseRules: string[];
2641| NOTE: Implementation detail supporting search page behavior.
2642| src/components/SearchForm.tsx:440:       languages: string[];
2643| NOTE: Implementation detail supporting search page behavior.
2644| src/components/SearchForm.tsx:441:     }) => {
2645| NOTE: Implementation detail supporting search page behavior.
2646| src/components/SearchForm.tsx:442:       const params = new URLSearchParams();
2647| NOTE: Local declaration used by search logic or UI.
2648| src/components/SearchForm.tsx:443: 
2649| NOTE: Blank line for visual separation.
2650| src/components/SearchForm.tsx:444:       // Preserve existing sort parameter from URL
2651| NOTE: Line comment documents intent or constraints.
2652| src/components/SearchForm.tsx:445:       const existingSort = searchParams.get("sort");
2653| NOTE: Local declaration used by search logic or UI.
2654| src/components/SearchForm.tsx:446:       if (
2655| NOTE: Conditional logic controlling rendering or flow.
2656| src/components/SearchForm.tsx:447:         existingSort &&
2657| NOTE: Implementation detail supporting search page behavior.
2658| src/components/SearchForm.tsx:448:         ["recommended", "price_asc", "price_desc", "newest", "rating"].includes(
2659| NOTE: Implementation detail supporting search page behavior.
2660| src/components/SearchForm.tsx:449:           existingSort,
2661| NOTE: Implementation detail supporting search page behavior.
2662| src/components/SearchForm.tsx:450:         )
2663| NOTE: Implementation detail supporting search page behavior.
2664| src/components/SearchForm.tsx:451:       ) {
2665| NOTE: Implementation detail supporting search page behavior.
2666| src/components/SearchForm.tsx:452:         params.set("sort", existingSort);
2667| NOTE: Implementation detail supporting search page behavior.
2668| src/components/SearchForm.tsx:453:       }
2669| NOTE: Implementation detail supporting search page behavior.
2670| src/components/SearchForm.tsx:454: 
2671| NOTE: Blank line for visual separation.
2672| src/components/SearchForm.tsx:455:       // Only include query if it has actual content (not just whitespace)
2673| NOTE: Line comment documents intent or constraints.
2674| src/components/SearchForm.tsx:456:       const trimmedLocation = location.trim();
2675| NOTE: Local declaration used by search logic or UI.
2676| src/components/SearchForm.tsx:457:       if (trimmedLocation && trimmedLocation.length >= 2) {
2677| NOTE: Conditional logic controlling rendering or flow.
2678| src/components/SearchForm.tsx:458:         params.set("q", trimmedLocation);
2679| NOTE: Implementation detail supporting search page behavior.
2680| src/components/SearchForm.tsx:459:       }
2681| NOTE: Implementation detail supporting search page behavior.
2682| src/components/SearchForm.tsx:460: 
2683| NOTE: Blank line for visual separation.
2684| src/components/SearchForm.tsx:461:       // Price validation with auto-swap if inverted
2685| NOTE: Line comment documents intent or constraints.
2686| src/components/SearchForm.tsx:462:       let finalMinPrice = filterValues.minPrice
2687| NOTE: Local declaration used by search logic or UI.
2688| src/components/SearchForm.tsx:463:         ? parseFloat(filterValues.minPrice)
2689| NOTE: Implementation detail supporting search page behavior.
2690| src/components/SearchForm.tsx:464:         : null;
2691| NOTE: Implementation detail supporting search page behavior.
2692| src/components/SearchForm.tsx:465:       let finalMaxPrice = filterValues.maxPrice
2693| NOTE: Local declaration used by search logic or UI.
2694| src/components/SearchForm.tsx:466:         ? parseFloat(filterValues.maxPrice)
2695| NOTE: Implementation detail supporting search page behavior.
2696| src/components/SearchForm.tsx:467:         : null;
2697| NOTE: Implementation detail supporting search page behavior.
2698| src/components/SearchForm.tsx:468: 
2699| NOTE: Blank line for visual separation.
2700| src/components/SearchForm.tsx:469:       // Enforce non-negative values
2701| NOTE: Line comment documents intent or constraints.
2702| src/components/SearchForm.tsx:470:       if (finalMinPrice !== null && finalMinPrice < 0) finalMinPrice = 0;
2703| NOTE: Conditional logic controlling rendering or flow.
2704| src/components/SearchForm.tsx:471:       if (finalMaxPrice !== null && finalMaxPrice < 0) finalMaxPrice = 0;
2705| NOTE: Conditional logic controlling rendering or flow.
2706| src/components/SearchForm.tsx:472: 
2707| NOTE: Blank line for visual separation.
2708| src/components/SearchForm.tsx:473:       // Auto-swap if min > max
2709| NOTE: Line comment documents intent or constraints.
2710| src/components/SearchForm.tsx:474:       if (
2711| NOTE: Conditional logic controlling rendering or flow.
2712| src/components/SearchForm.tsx:475:         finalMinPrice !== null &&
2713| NOTE: Implementation detail supporting search page behavior.
2714| src/components/SearchForm.tsx:476:         finalMaxPrice !== null &&
2715| NOTE: Implementation detail supporting search page behavior.
2716| src/components/SearchForm.tsx:477:         finalMinPrice > finalMaxPrice
2717| NOTE: Implementation detail supporting search page behavior.
2718| src/components/SearchForm.tsx:478:       ) {
2719| NOTE: Implementation detail supporting search page behavior.
2720| src/components/SearchForm.tsx:479:         [finalMinPrice, finalMaxPrice] = [finalMaxPrice, finalMinPrice];
2721| NOTE: Implementation detail supporting search page behavior.
2722| src/components/SearchForm.tsx:480:       }
2723| NOTE: Implementation detail supporting search page behavior.
2724| src/components/SearchForm.tsx:481: 
2725| NOTE: Blank line for visual separation.
2726| src/components/SearchForm.tsx:482:       if (finalMinPrice !== null)
2727| NOTE: Conditional logic controlling rendering or flow.
2728| src/components/SearchForm.tsx:483:         params.set("minPrice", finalMinPrice.toString());
2729| NOTE: Implementation detail supporting search page behavior.
2730| src/components/SearchForm.tsx:484:       if (finalMaxPrice !== null)
2731| NOTE: Conditional logic controlling rendering or flow.
2732| src/components/SearchForm.tsx:485:         params.set("maxPrice", finalMaxPrice.toString());
2733| NOTE: Implementation detail supporting search page behavior.
2734| src/components/SearchForm.tsx:486: 
2735| NOTE: Blank line for visual separation.
2736| src/components/SearchForm.tsx:487:       // Include coordinates if a location was selected from suggestions
2737| NOTE: Line comment documents intent or constraints.
2738| src/components/SearchForm.tsx:488:       // Only include if location text is not empty (prevents stale coords)
2739| NOTE: Line comment documents intent or constraints.
2740| src/components/SearchForm.tsx:489:       if (selectedCoords && trimmedLocation) {
2741| NOTE: Conditional logic controlling rendering or flow.
2742| src/components/SearchForm.tsx:490:         params.set("lat", selectedCoords.lat.toString());
2743| NOTE: Implementation detail supporting search page behavior.
2744| src/components/SearchForm.tsx:491:         params.set("lng", selectedCoords.lng.toString());
2745| NOTE: Implementation detail supporting search page behavior.
2746| src/components/SearchForm.tsx:492:       }
2747| NOTE: Implementation detail supporting search page behavior.
2748| src/components/SearchForm.tsx:493: 
2749| NOTE: Blank line for visual separation.
2750| src/components/SearchForm.tsx:494:       if (filterValues.moveInDate)
2751| NOTE: Conditional logic controlling rendering or flow.
2752| src/components/SearchForm.tsx:495:         params.set("moveInDate", filterValues.moveInDate);
2753| NOTE: Implementation detail supporting search page behavior.
2754| src/components/SearchForm.tsx:496:       if (filterValues.leaseDuration)
2755| NOTE: Conditional logic controlling rendering or flow.
2756| src/components/SearchForm.tsx:497:         params.set("leaseDuration", filterValues.leaseDuration);
2757| NOTE: Implementation detail supporting search page behavior.
2758| src/components/SearchForm.tsx:498:       if (filterValues.roomType) params.set("roomType", filterValues.roomType);
2759| NOTE: Conditional logic controlling rendering or flow.
2760| src/components/SearchForm.tsx:499:       filterValues.amenities.forEach((a) => params.append("amenities", a));
2761| NOTE: Implementation detail supporting search page behavior.
2762| src/components/SearchForm.tsx:500:       filterValues.houseRules.forEach((r) => params.append("houseRules", r));
2763| NOTE: Implementation detail supporting search page behavior.
2764| src/components/SearchForm.tsx:501:       filterValues.languages.forEach((l) => params.append("languages", l));
2765| NOTE: Implementation detail supporting search page behavior.
2766| src/components/SearchForm.tsx:502: 
2767| NOTE: Blank line for visual separation.
2768| src/components/SearchForm.tsx:503:       return params;
2769| NOTE: Return statement for component or helper output.
2770| src/components/SearchForm.tsx:504:     },
2771| NOTE: Implementation detail supporting search page behavior.
2772| src/components/SearchForm.tsx:505:     [searchParams, location, selectedCoords],
2773| NOTE: Implementation detail supporting search page behavior.
2774| src/components/SearchForm.tsx:506:   );
2775| NOTE: Implementation detail supporting search page behavior.
2776| src/components/SearchForm.tsx:507: 
2777| NOTE: Blank line for visual separation.
2778| src/components/SearchForm.tsx:508:   const handleSearch = useCallback(
2779| NOTE: Memoizes callback to preserve references across renders.
2780| src/components/SearchForm.tsx:509:     (e: React.FormEvent) => {
2781| NOTE: Implementation detail supporting search page behavior.
2782| src/components/SearchForm.tsx:510:       e.preventDefault();
2783| NOTE: Implementation detail supporting search page behavior.
2784| src/components/SearchForm.tsx:511: 
2785| NOTE: Blank line for visual separation.
2786| src/components/SearchForm.tsx:512:       // Clear any pending search timeout
2787| NOTE: Line comment documents intent or constraints.
2788| src/components/SearchForm.tsx:513:       if (searchTimeoutRef.current) {
2789| NOTE: Conditional logic controlling rendering or flow.
2790| src/components/SearchForm.tsx:514:         clearTimeout(searchTimeoutRef.current);
2791| NOTE: Implementation detail supporting search page behavior.
2792| src/components/SearchForm.tsx:515:       }
2793| NOTE: Implementation detail supporting search page behavior.
2794| src/components/SearchForm.tsx:516: 
2795| NOTE: Blank line for visual separation.
2796| src/components/SearchForm.tsx:517:       // Build URL from local price + committed batched filters
2797| NOTE: Line comment documents intent or constraints.
2798| src/components/SearchForm.tsx:518:       // Main form search uses committed filters, not pending (user must use Apply in drawer)
2799| NOTE: Line comment documents intent or constraints.
2800| src/components/SearchForm.tsx:519:       const params = buildSearchParams({
2801| NOTE: Local declaration used by search logic or UI.
2802| src/components/SearchForm.tsx:520:         minPrice: localMinPrice,
2803| NOTE: Implementation detail supporting search page behavior.
2804| src/components/SearchForm.tsx:521:         maxPrice: localMaxPrice,
2805| NOTE: Implementation detail supporting search page behavior.
2806| src/components/SearchForm.tsx:522:         moveInDate: committedFilters.moveInDate,
2807| NOTE: Implementation detail supporting search page behavior.
2808| src/components/SearchForm.tsx:523:         leaseDuration: committedFilters.leaseDuration,
2809| NOTE: Implementation detail supporting search page behavior.
2810| src/components/SearchForm.tsx:524:         roomType: committedFilters.roomType,
2811| NOTE: Implementation detail supporting search page behavior.
2812| src/components/SearchForm.tsx:525:         amenities: committedFilters.amenities,
2813| NOTE: Implementation detail supporting search page behavior.
2814| src/components/SearchForm.tsx:526:         houseRules: committedFilters.houseRules,
2815| NOTE: Implementation detail supporting search page behavior.
2816| src/components/SearchForm.tsx:527:         languages: committedFilters.languages,
2817| NOTE: Implementation detail supporting search page behavior.
2818| src/components/SearchForm.tsx:528:       });
2819| NOTE: Implementation detail supporting search page behavior.
2820| src/components/SearchForm.tsx:529: 
2821| NOTE: Blank line for visual separation.
2822| src/components/SearchForm.tsx:530:       const searchUrl = `/search?${params.toString()}`;
2823| NOTE: Local declaration used by search logic or UI.
2824| src/components/SearchForm.tsx:531: 
2825| NOTE: Blank line for visual separation.
2826| src/components/SearchForm.tsx:532:       // Prevent duplicate searches (same URL within debounce window)
2827| NOTE: Line comment documents intent or constraints.
2828| src/components/SearchForm.tsx:533:       if (searchUrl === lastSearchRef.current && isSearching) {
2829| NOTE: Conditional logic controlling rendering or flow.
2830| src/components/SearchForm.tsx:534:         return;
2831| NOTE: Implementation detail supporting search page behavior.
2832| src/components/SearchForm.tsx:535:       }
2833| NOTE: Implementation detail supporting search page behavior.
2834| src/components/SearchForm.tsx:536: 
2835| NOTE: Blank line for visual separation.
2836| src/components/SearchForm.tsx:537:       // Debounce the navigation to prevent race conditions
2837| NOTE: Line comment documents intent or constraints.
2838| src/components/SearchForm.tsx:538:       setIsSearching(true);
2839| NOTE: Implementation detail supporting search page behavior.
2840| src/components/SearchForm.tsx:539:       lastSearchRef.current = searchUrl;
2841| NOTE: Implementation detail supporting search page behavior.
2842| src/components/SearchForm.tsx:540: 
2843| NOTE: Blank line for visual separation.
2844| src/components/SearchForm.tsx:541:       // Save to recent searches when navigating (with filter state)
2845| NOTE: Line comment documents intent or constraints.
2846| src/components/SearchForm.tsx:542:       const trimmedLocation = location.trim();
2847| NOTE: Local declaration used by search logic or UI.
2848| src/components/SearchForm.tsx:543:       if (trimmedLocation) {
2849| NOTE: Conditional logic controlling rendering or flow.
2850| src/components/SearchForm.tsx:544:         const filters: RecentSearchFilters = {
2851| NOTE: Local declaration used by search logic or UI.
2852| src/components/SearchForm.tsx:545:           minPrice: localMinPrice || undefined,
2853| NOTE: Implementation detail supporting search page behavior.
2854| src/components/SearchForm.tsx:546:           maxPrice: localMaxPrice || undefined,
2855| NOTE: Implementation detail supporting search page behavior.
2856| src/components/SearchForm.tsx:547:           roomType: committedFilters.roomType || undefined,
2857| NOTE: Implementation detail supporting search page behavior.
2858| src/components/SearchForm.tsx:548:           leaseDuration: committedFilters.leaseDuration || undefined,
2859| NOTE: Implementation detail supporting search page behavior.
2860| src/components/SearchForm.tsx:549:           amenities:
2861| NOTE: Implementation detail supporting search page behavior.
2862| src/components/SearchForm.tsx:550:             committedFilters.amenities.length > 0
2863| NOTE: Implementation detail supporting search page behavior.
2864| src/components/SearchForm.tsx:551:               ? committedFilters.amenities
2865| NOTE: Implementation detail supporting search page behavior.
2866| src/components/SearchForm.tsx:552:               : undefined,
2867| NOTE: Implementation detail supporting search page behavior.
2868| src/components/SearchForm.tsx:553:           houseRules:
2869| NOTE: Implementation detail supporting search page behavior.
2870| src/components/SearchForm.tsx:554:             committedFilters.houseRules.length > 0
2871| NOTE: Implementation detail supporting search page behavior.
2872| src/components/SearchForm.tsx:555:               ? committedFilters.houseRules
2873| NOTE: Implementation detail supporting search page behavior.
2874| src/components/SearchForm.tsx:556:               : undefined,
2875| NOTE: Implementation detail supporting search page behavior.
2876| src/components/SearchForm.tsx:557:         };
2877| NOTE: Implementation detail supporting search page behavior.
2878| src/components/SearchForm.tsx:558:         saveRecentSearch(trimmedLocation, selectedCoords || undefined, filters);
2879| NOTE: Implementation detail supporting search page behavior.
2880| src/components/SearchForm.tsx:559:       }
2881| NOTE: Implementation detail supporting search page behavior.
2882| src/components/SearchForm.tsx:560: 
2883| NOTE: Blank line for visual separation.
2884| src/components/SearchForm.tsx:561:       // Close filter drawer on search
2885| NOTE: Line comment documents intent or constraints.
2886| src/components/SearchForm.tsx:562:       setShowFilters(false);
2887| NOTE: Implementation detail supporting search page behavior.
2888| src/components/SearchForm.tsx:563: 
2889| NOTE: Blank line for visual separation.
2890| src/components/SearchForm.tsx:564:       searchTimeoutRef.current = setTimeout(() => {
2891| NOTE: Implementation detail supporting search page behavior.
2892| src/components/SearchForm.tsx:565:         navigate(searchUrl);
2893| NOTE: Routing logic updates search URL state.
2894| src/components/SearchForm.tsx:566:         // Reset searching state after navigation starts
2895| NOTE: Line comment documents intent or constraints.
2896| src/components/SearchForm.tsx:567:         setTimeout(() => setIsSearching(false), 500);
2897| NOTE: Implementation detail supporting search page behavior.
2898| src/components/SearchForm.tsx:568:       }, SEARCH_DEBOUNCE_MS);
2899| NOTE: Implementation detail supporting search page behavior.
2900| src/components/SearchForm.tsx:569:     },
2901| NOTE: Implementation detail supporting search page behavior.
2902| src/components/SearchForm.tsx:570:     [
2903| NOTE: Implementation detail supporting search page behavior.
2904| src/components/SearchForm.tsx:571:       buildSearchParams,
2905| NOTE: Implementation detail supporting search page behavior.
2906| src/components/SearchForm.tsx:572:       localMinPrice,
2907| NOTE: Implementation detail supporting search page behavior.
2908| src/components/SearchForm.tsx:573:       localMaxPrice,
2909| NOTE: Implementation detail supporting search page behavior.
2910| src/components/SearchForm.tsx:574:       committedFilters,
2911| NOTE: Implementation detail supporting search page behavior.
2912| src/components/SearchForm.tsx:575:       location,
2913| NOTE: Implementation detail supporting search page behavior.
2914| src/components/SearchForm.tsx:576:       selectedCoords,
2915| NOTE: Implementation detail supporting search page behavior.
2916| src/components/SearchForm.tsx:577:       navigate,
2917| NOTE: Routing logic updates search URL state.
2918| src/components/SearchForm.tsx:578:       isSearching,
2919| NOTE: Implementation detail supporting search page behavior.
2920| src/components/SearchForm.tsx:579:       saveRecentSearch,
2921| NOTE: Implementation detail supporting search page behavior.
2922| src/components/SearchForm.tsx:580:     ],
2923| NOTE: Implementation detail supporting search page behavior.
2924| src/components/SearchForm.tsx:581:   );
2925| NOTE: Implementation detail supporting search page behavior.
2926| src/components/SearchForm.tsx:582: 
2927| NOTE: Blank line for visual separation.
2928| src/components/SearchForm.tsx:583:   // Handle Apply button in filter drawer - uses pending (batched) filter values
2929| NOTE: Line comment documents intent or constraints.
2930| src/components/SearchForm.tsx:584:   const handleApplyFilters = useCallback(() => {
2931| NOTE: Memoizes callback to preserve references across renders.
2932| src/components/SearchForm.tsx:585:     // Get pending filter values
2933| NOTE: Line comment documents intent or constraints.
2934| src/components/SearchForm.tsx:586:     const pendingValues = applyBatchedFilters();
2935| NOTE: Local declaration used by search logic or UI.
2936| src/components/SearchForm.tsx:587: 
2937| NOTE: Blank line for visual separation.
2938| src/components/SearchForm.tsx:588:     // Build URL from pending batched filters
2939| NOTE: Line comment documents intent or constraints.
2940| src/components/SearchForm.tsx:589:     const params = buildSearchParams(pendingValues);
2941| NOTE: Local declaration used by search logic or UI.
2942| src/components/SearchForm.tsx:590:     const searchUrl = `/search?${params.toString()}`;
2943| NOTE: Local declaration used by search logic or UI.
2944| src/components/SearchForm.tsx:591: 
2945| NOTE: Blank line for visual separation.
2946| src/components/SearchForm.tsx:592:     // Close filter drawer
2947| NOTE: Line comment documents intent or constraints.
2948| src/components/SearchForm.tsx:593:     setShowFilters(false);
2949| NOTE: Implementation detail supporting search page behavior.
2950| src/components/SearchForm.tsx:594: 
2951| NOTE: Blank line for visual separation.
2952| src/components/SearchForm.tsx:595:     // Navigate with transition
2953| NOTE: Line comment documents intent or constraints.
2954| src/components/SearchForm.tsx:596:     navigate(searchUrl);
2955| NOTE: Routing logic updates search URL state.
2956| src/components/SearchForm.tsx:597:   }, [applyBatchedFilters, buildSearchParams, navigate]);
2957| NOTE: Routing logic updates search URL state.
2958| src/components/SearchForm.tsx:598: 
2959| NOTE: Blank line for visual separation.
2960| src/components/SearchForm.tsx:599:   // Handle Reset button in filter drawer
2961| NOTE: Line comment documents intent or constraints.
2962| src/components/SearchForm.tsx:600:   const handleResetFilters = useCallback(() => {
2963| NOTE: Memoizes callback to preserve references across renders.
2964| src/components/SearchForm.tsx:601:     resetBatchedFilters();
2965| NOTE: Implementation detail supporting search page behavior.
2966| src/components/SearchForm.tsx:602:   }, [resetBatchedFilters]);
2967| NOTE: Implementation detail supporting search page behavior.
2968| src/components/SearchForm.tsx:603: 
2969| NOTE: Blank line for visual separation.
2970| src/components/SearchForm.tsx:604:   // Keyboard shortcuts (P2-12)
2971| NOTE: Line comment documents intent or constraints.
2972| src/components/SearchForm.tsx:605:   useKeyboardShortcuts([
2973| NOTE: Implementation detail supporting search page behavior.
2974| src/components/SearchForm.tsx:606:     {
2975| NOTE: Implementation detail supporting search page behavior.
2976| src/components/SearchForm.tsx:607:       ...SEARCH_SHORTCUTS.FOCUS_SEARCH,
2977| NOTE: Implementation detail supporting search page behavior.
2978| src/components/SearchForm.tsx:608:       action: () => locationInputRef.current?.focus(),
2979| NOTE: Implementation detail supporting search page behavior.
2980| src/components/SearchForm.tsx:609:     },
2981| NOTE: Implementation detail supporting search page behavior.
2982| src/components/SearchForm.tsx:610:     {
2983| NOTE: Implementation detail supporting search page behavior.
2984| src/components/SearchForm.tsx:611:       ...SEARCH_SHORTCUTS.CLOSE,
2985| NOTE: Implementation detail supporting search page behavior.
2986| src/components/SearchForm.tsx:612:       action: () => setShowFilters(false),
2987| NOTE: Implementation detail supporting search page behavior.
2988| src/components/SearchForm.tsx:613:       disabled: !showFilters, // Only active when drawer is open
2989| NOTE: Implementation detail supporting search page behavior.
2990| src/components/SearchForm.tsx:614:     },
2991| NOTE: Implementation detail supporting search page behavior.
2992| src/components/SearchForm.tsx:615:     {
2993| NOTE: Implementation detail supporting search page behavior.
2994| src/components/SearchForm.tsx:616:       ...SEARCH_SHORTCUTS.APPLY_FILTERS,
2995| NOTE: Implementation detail supporting search page behavior.
2996| src/components/SearchForm.tsx:617:       action: handleApplyFilters,
2997| NOTE: Implementation detail supporting search page behavior.
2998| src/components/SearchForm.tsx:618:       disabled: !showFilters || !filtersDirty, // Only active when drawer open with changes
2999| NOTE: Implementation detail supporting search page behavior.
3000| src/components/SearchForm.tsx:619:     },
3001| NOTE: Implementation detail supporting search page behavior.
3002| src/components/SearchForm.tsx:620:   ]);
3003| NOTE: Implementation detail supporting search page behavior.
3004| src/components/SearchForm.tsx:621: 
3005| NOTE: Blank line for visual separation.
3006| src/components/SearchForm.tsx:622:   // Cleanup timeout on unmount
3007| NOTE: Line comment documents intent or constraints.
3008| src/components/SearchForm.tsx:623:   useEffect(() => {
3009| NOTE: Defines side effect for syncing with external state.
3010| src/components/SearchForm.tsx:624:     return () => {
3011| NOTE: Return statement for component or helper output.
3012| src/components/SearchForm.tsx:625:       if (searchTimeoutRef.current) {
3013| NOTE: Conditional logic controlling rendering or flow.
3014| src/components/SearchForm.tsx:626:         clearTimeout(searchTimeoutRef.current);
3015| NOTE: Implementation detail supporting search page behavior.
3016| src/components/SearchForm.tsx:627:       }
3017| NOTE: Implementation detail supporting search page behavior.
3018| src/components/SearchForm.tsx:628:     };
3019| NOTE: Implementation detail supporting search page behavior.
3020| src/components/SearchForm.tsx:629:   }, []);
3021| NOTE: Implementation detail supporting search page behavior.
3022| src/components/SearchForm.tsx:630: 
3023| NOTE: Blank line for visual separation.
3024| src/components/SearchForm.tsx:631:   // Toggle functions now use batched filter hook
3025| NOTE: Line comment documents intent or constraints.
3026| src/components/SearchForm.tsx:632:   const toggleAmenity = useCallback(
3027| NOTE: Memoizes callback to preserve references across renders.
3028| src/components/SearchForm.tsx:633:     (amenity: string) => {
3029| NOTE: Implementation detail supporting search page behavior.
3030| src/components/SearchForm.tsx:634:       toggleBatchedArrayItem("amenities", amenity);
3031| NOTE: Implementation detail supporting search page behavior.
3032| src/components/SearchForm.tsx:635:     },
3033| NOTE: Implementation detail supporting search page behavior.
3034| src/components/SearchForm.tsx:636:     [toggleBatchedArrayItem],
3035| NOTE: Implementation detail supporting search page behavior.
3036| src/components/SearchForm.tsx:637:   );
3037| NOTE: Implementation detail supporting search page behavior.
3038| src/components/SearchForm.tsx:638: 
3039| NOTE: Blank line for visual separation.
3040| src/components/SearchForm.tsx:639:   const toggleHouseRule = useCallback(
3041| NOTE: Memoizes callback to preserve references across renders.
3042| src/components/SearchForm.tsx:640:     (rule: string) => {
3043| NOTE: Implementation detail supporting search page behavior.
3044| src/components/SearchForm.tsx:641:       toggleBatchedArrayItem("houseRules", rule);
3045| NOTE: Implementation detail supporting search page behavior.
3046| src/components/SearchForm.tsx:642:     },
3047| NOTE: Implementation detail supporting search page behavior.
3048| src/components/SearchForm.tsx:643:     [toggleBatchedArrayItem],
3049| NOTE: Implementation detail supporting search page behavior.
3050| src/components/SearchForm.tsx:644:   );
3051| NOTE: Implementation detail supporting search page behavior.
3052| src/components/SearchForm.tsx:645: 
3053| NOTE: Blank line for visual separation.
3054| src/components/SearchForm.tsx:646:   const toggleLanguage = useCallback(
3055| NOTE: Memoizes callback to preserve references across renders.
3056| src/components/SearchForm.tsx:647:     (lang: string) => {
3057| NOTE: Implementation detail supporting search page behavior.
3058| src/components/SearchForm.tsx:648:       toggleBatchedArrayItem("languages", lang);
3059| NOTE: Implementation detail supporting search page behavior.
3060| src/components/SearchForm.tsx:649:     },
3061| NOTE: Implementation detail supporting search page behavior.
3062| src/components/SearchForm.tsx:650:     [toggleBatchedArrayItem],
3063| NOTE: Implementation detail supporting search page behavior.
3064| src/components/SearchForm.tsx:651:   );
3065| NOTE: Implementation detail supporting search page behavior.
3066| src/components/SearchForm.tsx:652: 
3067| NOTE: Blank line for visual separation.
3068| src/components/SearchForm.tsx:653:   // Clear all filters and reset to defaults
3069| NOTE: Line comment documents intent or constraints.
3070| src/components/SearchForm.tsx:654:   const handleClearAllFilters = useCallback(() => {
3071| NOTE: Memoizes callback to preserve references across renders.
3072| src/components/SearchForm.tsx:655:     setLocation("");
3073| NOTE: Implementation detail supporting search page behavior.
3074| src/components/SearchForm.tsx:656:     setLocalMinPrice("");
3075| NOTE: Implementation detail supporting search page behavior.
3076| src/components/SearchForm.tsx:657:     setLocalMaxPrice("");
3077| NOTE: Implementation detail supporting search page behavior.
3078| src/components/SearchForm.tsx:658:     setSelectedCoords(null);
3079| NOTE: Implementation detail supporting search page behavior.
3080| src/components/SearchForm.tsx:659:     // Navigate to clean search page - this will reset batched filters via URL change
3081| NOTE: Line comment documents intent or constraints.
3082| src/components/SearchForm.tsx:660:     navigate("/search");
3083| NOTE: Routing logic updates search URL state.
3084| src/components/SearchForm.tsx:661:   }, [navigate]);
3085| NOTE: Routing logic updates search URL state.
3086| src/components/SearchForm.tsx:662: 
3087| NOTE: Blank line for visual separation.
3088| src/components/SearchForm.tsx:663:   // Count active filters for badge - uses committed (URL) values
3089| NOTE: Line comment documents intent or constraints.
3090| src/components/SearchForm.tsx:664:   // Split into two parts to avoid hydration mismatch
3091| NOTE: Line comment documents intent or constraints.
3092| src/components/SearchForm.tsx:665:   // Base count excludes moveInDate (no Date() calls, safe for SSR)
3093| NOTE: Line comment documents intent or constraints.
3094| src/components/SearchForm.tsx:666:   const baseFilterCount = [
3095| NOTE: Local declaration used by search logic or UI.
3096| src/components/SearchForm.tsx:667:     committedFilters.leaseDuration && committedFilters.leaseDuration !== "any",
3097| NOTE: Implementation detail supporting search page behavior.
3098| src/components/SearchForm.tsx:668:     committedFilters.roomType && committedFilters.roomType !== "any",
3099| NOTE: Implementation detail supporting search page behavior.
3100| src/components/SearchForm.tsx:669:     ...committedFilters.amenities,
3101| NOTE: Implementation detail supporting search page behavior.
3102| src/components/SearchForm.tsx:670:     ...committedFilters.houseRules,
3103| NOTE: Implementation detail supporting search page behavior.
3104| src/components/SearchForm.tsx:671:     ...committedFilters.languages,
3105| NOTE: Implementation detail supporting search page behavior.
3106| src/components/SearchForm.tsx:672:   ].filter(Boolean).length;
3107| NOTE: Implementation detail supporting search page behavior.
3108| src/components/SearchForm.tsx:673: 
3109| NOTE: Blank line for visual separation.
3110| src/components/SearchForm.tsx:674:   // moveInDate count only calculated after mount (uses Date() which differs server/client)
3111| NOTE: Line comment documents intent or constraints.
3112| src/components/SearchForm.tsx:675:   // IMPORTANT: Only call validateMoveInDate when hasMounted is true to avoid hydration mismatch
3113| NOTE: Line comment documents intent or constraints.
3114| src/components/SearchForm.tsx:676:   // The Date() comparison inside validateMoveInDate can produce different results on server vs client
3115| NOTE: Line comment documents intent or constraints.
3116| src/components/SearchForm.tsx:677:   const moveInDateCount = hasMounted
3117| NOTE: Local declaration used by search logic or UI.
3118| src/components/SearchForm.tsx:678:     ? validateMoveInDate(committedFilters.moveInDate)
3119| NOTE: Implementation detail supporting search page behavior.
3120| src/components/SearchForm.tsx:679:       ? 1
3121| NOTE: Implementation detail supporting search page behavior.
3122| src/components/SearchForm.tsx:680:       : 0
3123| NOTE: Implementation detail supporting search page behavior.
3124| src/components/SearchForm.tsx:681:     : 0;
3125| NOTE: Implementation detail supporting search page behavior.
3126| src/components/SearchForm.tsx:682:   const activeFilterCount = baseFilterCount + moveInDateCount;
3127| NOTE: Local declaration used by search logic or UI.
3128| src/components/SearchForm.tsx:683: 
3129| NOTE: Blank line for visual separation.
3130| src/components/SearchForm.tsx:684:   // Check if any filters are active (for "Clear all" button visibility)
3131| NOTE: Line comment documents intent or constraints.
3132| src/components/SearchForm.tsx:685:   const hasActiveFilters =
3133| NOTE: Local declaration used by search logic or UI.
3134| src/components/SearchForm.tsx:686:     location ||
3135| NOTE: Implementation detail supporting search page behavior.
3136| src/components/SearchForm.tsx:687:     committedFilters.minPrice ||
3137| NOTE: Implementation detail supporting search page behavior.
3138| src/components/SearchForm.tsx:688:     committedFilters.maxPrice ||
3139| NOTE: Implementation detail supporting search page behavior.
3140| src/components/SearchForm.tsx:689:     (committedFilters.leaseDuration &&
3141| NOTE: Implementation detail supporting search page behavior.
3142| src/components/SearchForm.tsx:690:       committedFilters.leaseDuration !== "any") ||
3143| NOTE: Implementation detail supporting search page behavior.
3144| src/components/SearchForm.tsx:691:     (committedFilters.roomType && committedFilters.roomType !== "any") ||
3145| NOTE: Implementation detail supporting search page behavior.
3146| src/components/SearchForm.tsx:692:     committedFilters.amenities.length > 0 ||
3147| NOTE: Implementation detail supporting search page behavior.
3148| src/components/SearchForm.tsx:693:     committedFilters.houseRules.length > 0 ||
3149| NOTE: Implementation detail supporting search page behavior.
3150| src/components/SearchForm.tsx:694:     committedFilters.languages.length > 0 ||
3151| NOTE: Implementation detail supporting search page behavior.
3152| src/components/SearchForm.tsx:695:     moveInDateCount > 0;
3153| NOTE: Implementation detail supporting search page behavior.
3154| src/components/SearchForm.tsx:696: 
3155| NOTE: Blank line for visual separation.
3156| src/components/SearchForm.tsx:697:   // Show warning when user has typed location but not selected from dropdown
3157| NOTE: Line comment documents intent or constraints.
3158| src/components/SearchForm.tsx:698:   const showLocationWarning = location.trim().length > 2 && !selectedCoords;
3159| NOTE: Local declaration used by search logic or UI.
3160| src/components/SearchForm.tsx:699: 
3161| NOTE: Blank line for visual separation.
3162| src/components/SearchForm.tsx:700:   // Handle Escape key to close filter drawer
3163| NOTE: Line comment documents intent or constraints.
3164| src/components/SearchForm.tsx:701:   useEffect(() => {
3165| NOTE: Defines side effect for syncing with external state.
3166| src/components/SearchForm.tsx:702:     const handleEscape = (e: KeyboardEvent) => {
3167| NOTE: Local declaration used by search logic or UI.
3168| src/components/SearchForm.tsx:703:       if (e.key === "Escape" && showFilters) {
3169| NOTE: Conditional logic controlling rendering or flow.
3170| src/components/SearchForm.tsx:704:         setShowFilters(false);
3171| NOTE: Implementation detail supporting search page behavior.
3172| src/components/SearchForm.tsx:705:       }
3173| NOTE: Implementation detail supporting search page behavior.
3174| src/components/SearchForm.tsx:706:     };
3175| NOTE: Implementation detail supporting search page behavior.
3176| src/components/SearchForm.tsx:707:     document.addEventListener("keydown", handleEscape);
3177| NOTE: Implementation detail supporting search page behavior.
3178| src/components/SearchForm.tsx:708:     return () => document.removeEventListener("keydown", handleEscape);
3179| NOTE: Return statement for component or helper output.
3180| src/components/SearchForm.tsx:709:   }, [showFilters]);
3181| NOTE: Implementation detail supporting search page behavior.
3182| src/components/SearchForm.tsx:710: 
3183| NOTE: Blank line for visual separation.
3184| src/components/SearchForm.tsx:711:   // Prevent body scroll when drawer is open
3185| NOTE: Line comment documents intent or constraints.
3186| src/components/SearchForm.tsx:712:   useEffect(() => {
3187| NOTE: Defines side effect for syncing with external state.
3188| src/components/SearchForm.tsx:713:     if (showFilters) {
3189| NOTE: Conditional logic controlling rendering or flow.
3190| src/components/SearchForm.tsx:714:       document.body.style.overflow = "hidden";
3191| NOTE: Implementation detail supporting search page behavior.
3192| src/components/SearchForm.tsx:715:     } else {
3193| NOTE: Implementation detail supporting search page behavior.
3194| src/components/SearchForm.tsx:716:       document.body.style.overflow = "";
3195| NOTE: Implementation detail supporting search page behavior.
3196| src/components/SearchForm.tsx:717:     }
3197| NOTE: Implementation detail supporting search page behavior.
3198| src/components/SearchForm.tsx:718:     return () => {
3199| NOTE: Return statement for component or helper output.
3200| src/components/SearchForm.tsx:719:       document.body.style.overflow = "";
3201| NOTE: Implementation detail supporting search page behavior.
3202| src/components/SearchForm.tsx:720:     };
3203| NOTE: Implementation detail supporting search page behavior.
3204| src/components/SearchForm.tsx:721:   }, [showFilters]);
3205| NOTE: Implementation detail supporting search page behavior.
3206| src/components/SearchForm.tsx:722: 
3207| NOTE: Blank line for visual separation.
3208| src/components/SearchForm.tsx:723:   const isCompact = variant === "compact";
3209| NOTE: Local declaration used by search logic or UI.
3210| src/components/SearchForm.tsx:724:   const minMoveInDate = new Date(
3211| NOTE: Local declaration used by search logic or UI.
3212| src/components/SearchForm.tsx:725:     Date.now() - new Date().getTimezoneOffset() * 60000,
3213| NOTE: Implementation detail supporting search page behavior.
3214| src/components/SearchForm.tsx:726:   )
3215| NOTE: Implementation detail supporting search page behavior.
3216| src/components/SearchForm.tsx:727:     .toISOString()
3217| NOTE: Implementation detail supporting search page behavior.
3218| src/components/SearchForm.tsx:728:     .split("T")[0];
3219| NOTE: Implementation detail supporting search page behavior.
3220| src/components/SearchForm.tsx:729: 
3221| NOTE: Blank line for visual separation.
3222| src/components/SearchForm.tsx:730:   return (
3223| NOTE: Return statement for component or helper output.
3224| src/components/SearchForm.tsx:731:     <div className={`w-full mx-auto ${isCompact ? "max-w-2xl" : "max-w-4xl"}`}>
3225| NOTE: Tailwind classes define layout and styling.
3226| src/components/SearchForm.tsx:732:       <form
3227| NOTE: JSX markup for search UI.
3228| src/components/SearchForm.tsx:733:         onSubmit={handleSearch}
3229| NOTE: Implementation detail supporting search page behavior.
3230| src/components/SearchForm.tsx:734:         className={`group relative flex flex-col md:flex-row md:items-center bg-white/90 dark:bg-zinc-900/90 backdrop-blur-xl rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.08),0_12px_40px_rgba(0,0,0,0.06)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.3),0_12px_40px_rgba(0,0,0,0.2)] border border-zinc-200/80 dark:border-zinc-700/80 hover:border-zinc-300 dark:hover:border-zinc-600 hover:shadow-[0_4px_20px_rgba(0,0,0,0.1),0_16px_48px_rgba(0,0,0,0.08)] dark:hover:shadow-[0_4px_20px_rgba(0,0,0,0.3),0_16px_48px_rgba(0,0,0,0.2)] transition-all duration-200 w-full ${isCompact ? "p-1" : "p-1.5 md:p-2 md:pr-2"}`}
3231| NOTE: Tailwind classes define layout and styling.
3232| src/components/SearchForm.tsx:735:         role="search"
3233| NOTE: Implementation detail supporting search page behavior.
3234| src/components/SearchForm.tsx:736:       >
3235| NOTE: Implementation detail supporting search page behavior.
3236| src/components/SearchForm.tsx:737:         {/* Location Input with Autocomplete - Airbnb-style stacked layout */}
3237| NOTE: Implementation detail supporting search page behavior.
3238| src/components/SearchForm.tsx:738:         <div
3239| NOTE: JSX markup for search UI.
3240| src/components/SearchForm.tsx:739:           className={`w-full md:flex-1 flex flex-col relative ${isCompact ? "px-4 py-2" : "px-5 sm:px-6 py-3 md:py-2"}`}
3241| NOTE: Tailwind classes define layout and styling.
3242| src/components/SearchForm.tsx:740:         >
3243| NOTE: Implementation detail supporting search page behavior.
3244| src/components/SearchForm.tsx:741:           {!isCompact && (
3245| NOTE: Implementation detail supporting search page behavior.
3246| src/components/SearchForm.tsx:742:             <span className="text-2xs font-bold text-zinc-900 dark:text-white uppercase tracking-wider mb-1">
3247| NOTE: Tailwind classes define layout and styling.
3248| src/components/SearchForm.tsx:743:               Where
3249| NOTE: Implementation detail supporting search page behavior.
3250| src/components/SearchForm.tsx:744:             </span>
3251| NOTE: JSX markup for search UI.
3252| src/components/SearchForm.tsx:745:           )}
3253| NOTE: Implementation detail supporting search page behavior.
3254| src/components/SearchForm.tsx:746:           <LocationSearchInput
3255| NOTE: JSX markup for search UI.
3256| src/components/SearchForm.tsx:747:             ref={locationInputRef}
3257| NOTE: Implementation detail supporting search page behavior.
3258| src/components/SearchForm.tsx:748:             value={location}
3259| NOTE: Implementation detail supporting search page behavior.
3260| src/components/SearchForm.tsx:749:             onChange={(value) => {
3261| NOTE: Implementation detail supporting search page behavior.
3262| src/components/SearchForm.tsx:750:               setLocation(value);
3263| NOTE: Implementation detail supporting search page behavior.
3264| src/components/SearchForm.tsx:751:               if (selectedCoords) setSelectedCoords(null);
3265| NOTE: Conditional logic controlling rendering or flow.
3266| src/components/SearchForm.tsx:752:               setShowRecentSearches(false);
3267| NOTE: Implementation detail supporting search page behavior.
3268| src/components/SearchForm.tsx:753:             }}
3269| NOTE: Implementation detail supporting search page behavior.
3270| src/components/SearchForm.tsx:754:             onLocationSelect={(data) => {
3271| NOTE: Implementation detail supporting search page behavior.
3272| src/components/SearchForm.tsx:755:               handleLocationSelect(data);
3273| NOTE: Implementation detail supporting search page behavior.
3274| src/components/SearchForm.tsx:756:               setShowRecentSearches(false);
3275| NOTE: Implementation detail supporting search page behavior.
3276| src/components/SearchForm.tsx:757:             }}
3277| NOTE: Implementation detail supporting search page behavior.
3278| src/components/SearchForm.tsx:758:             onFocus={() => {
3279| NOTE: Implementation detail supporting search page behavior.
3280| src/components/SearchForm.tsx:759:               if (recentSearches.length > 0 && !location) {
3281| NOTE: Conditional logic controlling rendering or flow.
3282| src/components/SearchForm.tsx:760:                 setShowRecentSearches(true);
3283| NOTE: Implementation detail supporting search page behavior.
3284| src/components/SearchForm.tsx:761:               }
3285| NOTE: Implementation detail supporting search page behavior.
3286| src/components/SearchForm.tsx:762:             }}
3287| NOTE: Implementation detail supporting search page behavior.
3288| src/components/SearchForm.tsx:763:             onBlur={() => {
3289| NOTE: Implementation detail supporting search page behavior.
3290| src/components/SearchForm.tsx:764:               // Delay hiding to allow click on recent search
3291| NOTE: Line comment documents intent or constraints.
3292| src/components/SearchForm.tsx:765:               setTimeout(() => setShowRecentSearches(false), 200);
3293| NOTE: Implementation detail supporting search page behavior.
3294| src/components/SearchForm.tsx:766:             }}
3295| NOTE: Implementation detail supporting search page behavior.
3296| src/components/SearchForm.tsx:767:             placeholder="Search destinations"
3297| NOTE: Implementation detail supporting search page behavior.
3298| src/components/SearchForm.tsx:768:             className={isCompact ? "text-sm" : "text-sm"}
3299| NOTE: Tailwind classes define layout and styling.
3300| src/components/SearchForm.tsx:769:           />
3301| NOTE: Implementation detail supporting search page behavior.
3302| src/components/SearchForm.tsx:770:           {/* Query length hint - show when exactly 1 character typed */}
3303| NOTE: Implementation detail supporting search page behavior.
3304| src/components/SearchForm.tsx:771:           {location.length === 1 && (
3305| NOTE: Implementation detail supporting search page behavior.
3306| src/components/SearchForm.tsx:772:             <p className="text-xs text-zinc-500 dark:text-zinc-400 mt-1">
3307| NOTE: Tailwind classes define layout and styling.
3308| src/components/SearchForm.tsx:773:               Type 2+ characters to search
3309| NOTE: Implementation detail supporting search page behavior.
3310| src/components/SearchForm.tsx:774:             </p>
3311| NOTE: JSX markup for search UI.
3312| src/components/SearchForm.tsx:775:           )}
3313| NOTE: Implementation detail supporting search page behavior.
3314| src/components/SearchForm.tsx:776: 
3315| NOTE: Blank line for visual separation.
3316| src/components/SearchForm.tsx:777:           {/* Recent Searches Dropdown */}
3317| NOTE: Implementation detail supporting search page behavior.
3318| src/components/SearchForm.tsx:778:           {showRecentSearches && recentSearches.length > 0 && (
3319| NOTE: Implementation detail supporting search page behavior.
3320| src/components/SearchForm.tsx:779:             <div className="absolute top-full left-0 right-0 mt-2 bg-white dark:bg-zinc-900 rounded-xl shadow-lg border border-zinc-200 dark:border-zinc-700 z-50 overflow-hidden">
3321| NOTE: Tailwind classes define layout and styling.
3322| src/components/SearchForm.tsx:780:               <div className="flex items-center justify-between px-4 py-2 border-b border-zinc-100 dark:border-zinc-800">
3323| NOTE: Tailwind classes define layout and styling.
3324| src/components/SearchForm.tsx:781:                 <span className="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase">
3325| NOTE: Tailwind classes define layout and styling.
3326| src/components/SearchForm.tsx:782:                   Recent Searches
3327| NOTE: Implementation detail supporting search page behavior.
3328| src/components/SearchForm.tsx:783:                 </span>
3329| NOTE: JSX markup for search UI.
3330| src/components/SearchForm.tsx:784:                 <button
3331| NOTE: JSX markup for search UI.
3332| src/components/SearchForm.tsx:785:                   type="button"
3333| NOTE: Implementation detail supporting search page behavior.
3334| src/components/SearchForm.tsx:786:                   onClick={(e) => {
3335| NOTE: Implementation detail supporting search page behavior.
3336| src/components/SearchForm.tsx:787:                     e.preventDefault();
3337| NOTE: Implementation detail supporting search page behavior.
3338| src/components/SearchForm.tsx:788:                     e.stopPropagation();
3339| NOTE: Implementation detail supporting search page behavior.
3340| src/components/SearchForm.tsx:789:                     clearRecentSearches();
3341| NOTE: Implementation detail supporting search page behavior.
3342| src/components/SearchForm.tsx:790:                   }}
3343| NOTE: Implementation detail supporting search page behavior.
3344| src/components/SearchForm.tsx:791:                   className="text-xs text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300 px-2 py-1 min-h-[44px] flex items-center"
3345| NOTE: Tailwind classes define layout and styling.
3346| src/components/SearchForm.tsx:792:                 >
3347| NOTE: Implementation detail supporting search page behavior.
3348| src/components/SearchForm.tsx:793:                   Clear
3349| NOTE: Implementation detail supporting search page behavior.
3350| src/components/SearchForm.tsx:794:                 </button>
3351| NOTE: JSX markup for search UI.
3352| src/components/SearchForm.tsx:795:               </div>
3353| NOTE: JSX markup for search UI.
3354| src/components/SearchForm.tsx:796:               <ul className="py-1">
3355| NOTE: Tailwind classes define layout and styling.
3356| src/components/SearchForm.tsx:797:                 {recentSearches.map((search) => {
3357| NOTE: Implementation detail supporting search page behavior.
3358| src/components/SearchForm.tsx:798:                   const filterSummary = getFilterSummary(search.filters);
3359| NOTE: Local declaration used by search logic or UI.
3360| src/components/SearchForm.tsx:799:                   return (
3361| NOTE: Return statement for component or helper output.
3362| src/components/SearchForm.tsx:800:                     <li key={search.id}>
3363| NOTE: JSX markup for search UI.
3364| src/components/SearchForm.tsx:801:                       <button
3365| NOTE: JSX markup for search UI.
3366| src/components/SearchForm.tsx:802:                         type="button"
3367| NOTE: Implementation detail supporting search page behavior.
3368| src/components/SearchForm.tsx:803:                         onClick={(e) => {
3369| NOTE: Implementation detail supporting search page behavior.
3370| src/components/SearchForm.tsx:804:                           e.preventDefault();
3371| NOTE: Implementation detail supporting search page behavior.
3372| src/components/SearchForm.tsx:805:                           e.stopPropagation();
3373| NOTE: Implementation detail supporting search page behavior.
3374| src/components/SearchForm.tsx:806:                           selectRecentSearch(search);
3375| NOTE: Implementation detail supporting search page behavior.
3376| src/components/SearchForm.tsx:807:                         }}
3377| NOTE: Implementation detail supporting search page behavior.
3378| src/components/SearchForm.tsx:808:                         className="w-full flex items-start gap-3 px-4 py-2.5 min-h-[44px] hover:bg-zinc-50 dark:hover:bg-zinc-800 text-left transition-colors"
3379| NOTE: Tailwind classes define layout and styling.
3380| src/components/SearchForm.tsx:809:                       >
3381| NOTE: Implementation detail supporting search page behavior.
3382| src/components/SearchForm.tsx:810:                         <Clock className="w-4 h-4 text-zinc-400 flex-shrink-0 mt-0.5" />
3383| NOTE: Tailwind classes define layout and styling.
3384| src/components/SearchForm.tsx:811:                         <div className="flex flex-col min-w-0">
3385| NOTE: Tailwind classes define layout and styling.
3386| src/components/SearchForm.tsx:812:                           <span className="text-sm text-zinc-700 dark:text-zinc-200 truncate">
3387| NOTE: Tailwind classes define layout and styling.
3388| src/components/SearchForm.tsx:813:                             {search.location}
3389| NOTE: Implementation detail supporting search page behavior.
3390| src/components/SearchForm.tsx:814:                           </span>
3391| NOTE: JSX markup for search UI.
3392| src/components/SearchForm.tsx:815:                           {filterSummary && (
3393| NOTE: Implementation detail supporting search page behavior.
3394| src/components/SearchForm.tsx:816:                             <span className="text-xs text-zinc-400 dark:text-zinc-500 truncate">
3395| NOTE: Tailwind classes define layout and styling.
3396| src/components/SearchForm.tsx:817:                               {filterSummary}
3397| NOTE: Implementation detail supporting search page behavior.
3398| src/components/SearchForm.tsx:818:                             </span>
3399| NOTE: JSX markup for search UI.
3400| src/components/SearchForm.tsx:819:                           )}
3401| NOTE: Implementation detail supporting search page behavior.
3402| src/components/SearchForm.tsx:820:                         </div>
3403| NOTE: JSX markup for search UI.
3404| src/components/SearchForm.tsx:821:                       </button>
3405| NOTE: JSX markup for search UI.
3406| src/components/SearchForm.tsx:822:                     </li>
3407| NOTE: JSX markup for search UI.
3408| src/components/SearchForm.tsx:823:                   );
3409| NOTE: Implementation detail supporting search page behavior.
3410| src/components/SearchForm.tsx:824:                 })}
3411| NOTE: Implementation detail supporting search page behavior.
3412| src/components/SearchForm.tsx:825:               </ul>
3413| NOTE: JSX markup for search UI.
3414| src/components/SearchForm.tsx:826:             </div>
3415| NOTE: JSX markup for search UI.
3416| src/components/SearchForm.tsx:827:           )}
3417| NOTE: Implementation detail supporting search page behavior.
3418| src/components/SearchForm.tsx:828:         </div>
3419| NOTE: JSX markup for search UI.
3420| src/components/SearchForm.tsx:829: 
3421| NOTE: Blank line for visual separation.
3422| src/components/SearchForm.tsx:830:         {/* Divider - Taller for better segmentation */}
3423| NOTE: Implementation detail supporting search page behavior.
3424| src/components/SearchForm.tsx:831:         <div
3425| NOTE: JSX markup for search UI.
3426| src/components/SearchForm.tsx:832:           className="hidden md:flex items-center self-stretch"
3427| NOTE: Tailwind classes define layout and styling.
3428| src/components/SearchForm.tsx:833:           aria-hidden="true"
3429| NOTE: Accessibility attribute for screen readers.
3430| src/components/SearchForm.tsx:834:         >
3431| NOTE: Implementation detail supporting search page behavior.
3432| src/components/SearchForm.tsx:835:           <div className="w-px h-10 bg-zinc-200 dark:bg-zinc-700"></div>
3433| NOTE: Tailwind classes define layout and styling.
3434| src/components/SearchForm.tsx:836:         </div>
3435| NOTE: JSX markup for search UI.
3436| src/components/SearchForm.tsx:837:         <div
3437| NOTE: JSX markup for search UI.
3438| src/components/SearchForm.tsx:838:           className="md:hidden w-[calc(100%-2rem)] mx-auto h-px bg-zinc-100 dark:bg-zinc-800"
3439| NOTE: Tailwind classes define layout and styling.
3440| src/components/SearchForm.tsx:839:           aria-hidden="true"
3441| NOTE: Accessibility attribute for screen readers.
3442| src/components/SearchForm.tsx:840:         ></div>
3443| NOTE: Implementation detail supporting search page behavior.
3444| src/components/SearchForm.tsx:841: 
3445| NOTE: Blank line for visual separation.
3446| src/components/SearchForm.tsx:842:         {/* Price Range Input - Airbnb-style stacked layout */}
3447| NOTE: Implementation detail supporting search page behavior.
3448| src/components/SearchForm.tsx:843:         <div
3449| NOTE: JSX markup for search UI.
3450| src/components/SearchForm.tsx:844:           className={`w-full md:flex-1 flex flex-col ${isCompact ? "px-4 py-2" : "px-5 sm:px-6 py-3 md:py-2"}`}
3451| NOTE: Tailwind classes define layout and styling.
3452| src/components/SearchForm.tsx:845:         >
3453| NOTE: Implementation detail supporting search page behavior.
3454| src/components/SearchForm.tsx:846:           {!isCompact && (
3455| NOTE: Implementation detail supporting search page behavior.
3456| src/components/SearchForm.tsx:847:             <label className="text-2xs font-bold text-zinc-900 dark:text-white uppercase tracking-wider mb-1">
3457| NOTE: Tailwind classes define layout and styling.
3458| src/components/SearchForm.tsx:848:               Budget
3459| NOTE: Implementation detail supporting search page behavior.
3460| src/components/SearchForm.tsx:849:             </label>
3461| NOTE: JSX markup for search UI.
3462| src/components/SearchForm.tsx:850:           )}
3463| NOTE: Implementation detail supporting search page behavior.
3464| src/components/SearchForm.tsx:851:           <div className="flex items-center gap-1.5 px-2 py-1 -mx-2 -my-1 rounded-lg transition-colors focus-within:bg-zinc-100/50 dark:focus-within:bg-zinc-800/50">
3465| NOTE: Tailwind classes define layout and styling.
3466| src/components/SearchForm.tsx:852:             <input
3467| NOTE: JSX markup for search UI.
3468| src/components/SearchForm.tsx:853:               id="search-budget-min"
3469| NOTE: Implementation detail supporting search page behavior.
3470| src/components/SearchForm.tsx:854:               type="number"
3471| NOTE: Implementation detail supporting search page behavior.
3472| src/components/SearchForm.tsx:855:               inputMode="numeric"
3473| NOTE: Implementation detail supporting search page behavior.
3474| src/components/SearchForm.tsx:856:               pattern="[0-9]*"
3475| NOTE: Implementation detail supporting search page behavior.
3476| src/components/SearchForm.tsx:857:               value={localMinPrice}
3477| NOTE: Implementation detail supporting search page behavior.
3478| src/components/SearchForm.tsx:858:               onChange={(e) => setLocalMinPrice(e.target.value)}
3479| NOTE: Implementation detail supporting search page behavior.
3480| src/components/SearchForm.tsx:859:               placeholder="Min"
3481| NOTE: Implementation detail supporting search page behavior.
3482| src/components/SearchForm.tsx:860:               className={`w-full bg-transparent border-none p-0 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-zinc-500 focus:ring-0 focus:outline-none outline-none ring-0 cursor-text appearance-none [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield] ${isCompact ? "text-sm" : "text-sm"}`}
3483| NOTE: Tailwind classes define layout and styling.
3484| src/components/SearchForm.tsx:861:               min="0"
3485| NOTE: Implementation detail supporting search page behavior.
3486| src/components/SearchForm.tsx:862:               step="50"
3487| NOTE: Implementation detail supporting search page behavior.
3488| src/components/SearchForm.tsx:863:               aria-label="Minimum budget"
3489| NOTE: Accessibility attribute for screen readers.
3490| src/components/SearchForm.tsx:864:             />
3491| NOTE: Implementation detail supporting search page behavior.
3492| src/components/SearchForm.tsx:865:             <span className="text-zinc-300 dark:text-zinc-600 text-sm">-</span>
3493| NOTE: Tailwind classes define layout and styling.
3494| src/components/SearchForm.tsx:866:             <input
3495| NOTE: JSX markup for search UI.
3496| src/components/SearchForm.tsx:867:               id="search-budget-max"
3497| NOTE: Implementation detail supporting search page behavior.
3498| src/components/SearchForm.tsx:868:               type="number"
3499| NOTE: Implementation detail supporting search page behavior.
3500| src/components/SearchForm.tsx:869:               inputMode="numeric"
3501| NOTE: Implementation detail supporting search page behavior.
3502| src/components/SearchForm.tsx:870:               pattern="[0-9]*"
3503| NOTE: Implementation detail supporting search page behavior.
3504| src/components/SearchForm.tsx:871:               value={localMaxPrice}
3505| NOTE: Implementation detail supporting search page behavior.
3506| src/components/SearchForm.tsx:872:               onChange={(e) => setLocalMaxPrice(e.target.value)}
3507| NOTE: Implementation detail supporting search page behavior.
3508| src/components/SearchForm.tsx:873:               placeholder="Max"
3509| NOTE: Implementation detail supporting search page behavior.
3510| src/components/SearchForm.tsx:874:               className={`w-full bg-transparent border-none p-0 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-zinc-500 focus:ring-0 focus:outline-none outline-none ring-0 cursor-text appearance-none [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield] ${isCompact ? "text-sm" : "text-sm"}`}
3511| NOTE: Tailwind classes define layout and styling.
3512| src/components/SearchForm.tsx:875:               min="0"
3513| NOTE: Implementation detail supporting search page behavior.
3514| src/components/SearchForm.tsx:876:               step="50"
3515| NOTE: Implementation detail supporting search page behavior.
3516| src/components/SearchForm.tsx:877:               aria-label="Maximum budget"
3517| NOTE: Accessibility attribute for screen readers.
3518| src/components/SearchForm.tsx:878:             />
3519| NOTE: Implementation detail supporting search page behavior.
3520| src/components/SearchForm.tsx:879:           </div>
3521| NOTE: JSX markup for search UI.
3522| src/components/SearchForm.tsx:880:           {/* Price validation feedback */}
3523| NOTE: Implementation detail supporting search page behavior.
3524| src/components/SearchForm.tsx:881:           {(!isValidPrice(localMinPrice) || !isValidPrice(localMaxPrice)) && (
3525| NOTE: Implementation detail supporting search page behavior.
3526| src/components/SearchForm.tsx:882:             <p
3527| NOTE: JSX markup for search UI.
3528| src/components/SearchForm.tsx:883:               className="text-xs text-red-500 dark:text-red-400 mt-1"
3529| NOTE: Tailwind classes define layout and styling.
3530| src/components/SearchForm.tsx:884:               role="alert"
3531| NOTE: Implementation detail supporting search page behavior.
3532| src/components/SearchForm.tsx:885:             >
3533| NOTE: Implementation detail supporting search page behavior.
3534| src/components/SearchForm.tsx:886:               {!isValidPrice(localMinPrice) && !isValidPrice(localMaxPrice)
3535| NOTE: Implementation detail supporting search page behavior.
3536| src/components/SearchForm.tsx:887:                 ? "Invalid min and max price"
3537| NOTE: Implementation detail supporting search page behavior.
3538| src/components/SearchForm.tsx:888:                 : !isValidPrice(localMinPrice)
3539| NOTE: Implementation detail supporting search page behavior.
3540| src/components/SearchForm.tsx:889:                   ? "Invalid min price"
3541| NOTE: Implementation detail supporting search page behavior.
3542| src/components/SearchForm.tsx:890:                   : "Invalid max price"}
3543| NOTE: Implementation detail supporting search page behavior.
3544| src/components/SearchForm.tsx:891:             </p>
3545| NOTE: JSX markup for search UI.
3546| src/components/SearchForm.tsx:892:           )}
3547| NOTE: Implementation detail supporting search page behavior.
3548| src/components/SearchForm.tsx:893:           <span id="budget-hint" className="sr-only">
3549| NOTE: Tailwind classes define layout and styling.
3550| src/components/SearchForm.tsx:894:             Enter minimum and maximum monthly budget in dollars
3551| NOTE: Implementation detail supporting search page behavior.
3552| src/components/SearchForm.tsx:895:           </span>
3553| NOTE: JSX markup for search UI.
3554| src/components/SearchForm.tsx:896:         </div>
3555| NOTE: JSX markup for search UI.
3556| src/components/SearchForm.tsx:897: 
3557| NOTE: Blank line for visual separation.
3558| src/components/SearchForm.tsx:898:         {/* Filters Toggle */}
3559| NOTE: Implementation detail supporting search page behavior.
3560| src/components/SearchForm.tsx:899:         {!isCompact && (
3561| NOTE: Implementation detail supporting search page behavior.
3562| src/components/SearchForm.tsx:900:           <>
3563| NOTE: JSX markup for search UI.
3564| src/components/SearchForm.tsx:901:             <div
3565| NOTE: JSX markup for search UI.
3566| src/components/SearchForm.tsx:902:               className="hidden md:flex items-center self-stretch mx-2"
3567| NOTE: Tailwind classes define layout and styling.
3568| src/components/SearchForm.tsx:903:               aria-hidden="true"
3569| NOTE: Accessibility attribute for screen readers.
3570| src/components/SearchForm.tsx:904:             >
3571| NOTE: Implementation detail supporting search page behavior.
3572| src/components/SearchForm.tsx:905:               <div className="w-px h-10 bg-zinc-200 dark:bg-zinc-700"></div>
3573| NOTE: Tailwind classes define layout and styling.
3574| src/components/SearchForm.tsx:906:             </div>
3575| NOTE: JSX markup for search UI.
3576| src/components/SearchForm.tsx:907:             <Button
3577| NOTE: JSX markup for search UI.
3578| src/components/SearchForm.tsx:908:               type="button"
3579| NOTE: Implementation detail supporting search page behavior.
3580| src/components/SearchForm.tsx:909:               variant="filter"
3581| NOTE: Implementation detail supporting search page behavior.
3582| src/components/SearchForm.tsx:910:               onClick={() => setShowFilters(!showFilters)}
3583| NOTE: Implementation detail supporting search page behavior.
3584| src/components/SearchForm.tsx:911:               data-active={activeFilterCount > 0}
3585| NOTE: Implementation detail supporting search page behavior.
3586| src/components/SearchForm.tsx:912:               className={`hidden sm:flex items-center gap-2 rounded-full h-10 px-5 transition-all duration-200 ${showFilters ? "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900 border-zinc-900 dark:border-white" : ""}`}
3587| NOTE: Tailwind classes define layout and styling.
3588| src/components/SearchForm.tsx:913:               aria-expanded={showFilters}
3589| NOTE: Accessibility attribute for screen readers.
3590| src/components/SearchForm.tsx:914:               aria-controls="search-filters"
3591| NOTE: Accessibility attribute for screen readers.
3592| src/components/SearchForm.tsx:915:             >
3593| NOTE: Implementation detail supporting search page behavior.
3594| src/components/SearchForm.tsx:916:               <SlidersHorizontal className="w-4 h-4" />
3595| NOTE: Tailwind classes define layout and styling.
3596| src/components/SearchForm.tsx:917:               Filters
3597| NOTE: Implementation detail supporting search page behavior.
3598| src/components/SearchForm.tsx:918:               {activeFilterCount > 0 && (
3599| NOTE: Implementation detail supporting search page behavior.
3600| src/components/SearchForm.tsx:919:                 <span
3601| NOTE: JSX markup for search UI.
3602| src/components/SearchForm.tsx:920:                   className={`ml-1.5 inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-xs font-semibold rounded-full transition-colors ${showFilters ? "bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white" : "bg-zinc-900 dark:bg-white text-white dark:text-zinc-900"}`}
3603| NOTE: Tailwind classes define layout and styling.
3604| src/components/SearchForm.tsx:921:                 >
3605| NOTE: Implementation detail supporting search page behavior.
3606| src/components/SearchForm.tsx:922:                   {activeFilterCount}
3607| NOTE: Implementation detail supporting search page behavior.
3608| src/components/SearchForm.tsx:923:                 </span>
3609| NOTE: JSX markup for search UI.
3610| src/components/SearchForm.tsx:924:               )}
3611| NOTE: Implementation detail supporting search page behavior.
3612| src/components/SearchForm.tsx:925:             </Button>
3613| NOTE: JSX markup for search UI.
3614| src/components/SearchForm.tsx:926:           </>
3615| NOTE: JSX markup for search UI.
3616| src/components/SearchForm.tsx:927:         )}
3617| NOTE: Implementation detail supporting search page behavior.
3618| src/components/SearchForm.tsx:928: 
3619| NOTE: Blank line for visual separation.
3620| src/components/SearchForm.tsx:929:         {/* Search Button */}
3621| NOTE: Implementation detail supporting search page behavior.
3622| src/components/SearchForm.tsx:930:         <div
3623| NOTE: JSX markup for search UI.
3624| src/components/SearchForm.tsx:931:           className={`flex items-center justify-center mt-2 md:mt-0 ${isCompact ? "p-0.5" : "p-1 md:ml-2"}`}
3625| NOTE: Tailwind classes define layout and styling.
3626| src/components/SearchForm.tsx:932:         >
3627| NOTE: Implementation detail supporting search page behavior.
3628| src/components/SearchForm.tsx:933:           <Button
3629| NOTE: JSX markup for search UI.
3630| src/components/SearchForm.tsx:934:             type="submit"
3631| NOTE: Implementation detail supporting search page behavior.
3632| src/components/SearchForm.tsx:935:             disabled={isSearching}
3633| NOTE: Implementation detail supporting search page behavior.
3634| src/components/SearchForm.tsx:936:             aria-label={isSearching ? "Searching..." : "Search listings"}
3635| NOTE: Accessibility attribute for screen readers.
3636| src/components/SearchForm.tsx:937:             aria-busy={isSearching}
3637| NOTE: Accessibility attribute for screen readers.
3638| src/components/SearchForm.tsx:938:             className={`rounded-full transition-all duration-200 hover:scale-[1.02] active:scale-[0.98] shadow-md ${isCompact ? "h-9 w-9 p-0" : "h-11 sm:h-12 w-full md:w-12"}`}
3639| NOTE: Tailwind classes define layout and styling.
3640| src/components/SearchForm.tsx:939:           >
3641| NOTE: Implementation detail supporting search page behavior.
3642| src/components/SearchForm.tsx:940:             {isSearching ? (
3643| NOTE: Implementation detail supporting search page behavior.
3644| src/components/SearchForm.tsx:941:               <Loader2
3645| NOTE: JSX markup for search UI.
3646| src/components/SearchForm.tsx:942:                 className={`animate-spin ${isCompact ? "w-4 h-4" : "w-5 h-5"}`}
3647| NOTE: Tailwind classes define layout and styling.
3648| src/components/SearchForm.tsx:943:               />
3649| NOTE: Implementation detail supporting search page behavior.
3650| src/components/SearchForm.tsx:944:             ) : (
3651| NOTE: Implementation detail supporting search page behavior.
3652| src/components/SearchForm.tsx:945:               <Search
3653| NOTE: JSX markup for search UI.
3654| src/components/SearchForm.tsx:946:                 className={`${isCompact ? "w-4 h-4" : "w-[22px] h-[22px]"}`}
3655| NOTE: Tailwind classes define layout and styling.
3656| src/components/SearchForm.tsx:947:                 strokeWidth={2.5}
3657| NOTE: Implementation detail supporting search page behavior.
3658| src/components/SearchForm.tsx:948:               />
3659| NOTE: Implementation detail supporting search page behavior.
3660| src/components/SearchForm.tsx:949:             )}
3661| NOTE: Implementation detail supporting search page behavior.
3662| src/components/SearchForm.tsx:950:             <span
3663| NOTE: JSX markup for search UI.
3664| src/components/SearchForm.tsx:951:               className={`md:hidden ml-2 font-medium text-sm ${isCompact ? "hidden" : ""}`}
3665| NOTE: Tailwind classes define layout and styling.
3666| src/components/SearchForm.tsx:952:             >
3667| NOTE: Implementation detail supporting search page behavior.
3668| src/components/SearchForm.tsx:953:               {isSearching ? "Searching..." : "Search"}
3669| NOTE: Implementation detail supporting search page behavior.
3670| src/components/SearchForm.tsx:954:             </span>
3671| NOTE: JSX markup for search UI.
3672| src/components/SearchForm.tsx:955:           </Button>
3673| NOTE: JSX markup for search UI.
3674| src/components/SearchForm.tsx:956:         </div>
3675| NOTE: JSX markup for search UI.
3676| src/components/SearchForm.tsx:957:       </form>
3677| NOTE: JSX markup for search UI.
3678| src/components/SearchForm.tsx:958: 
3679| NOTE: Blank line for visual separation.
3680| src/components/SearchForm.tsx:959:       {/* Location warning when user hasn't selected from dropdown */}
3681| NOTE: Implementation detail supporting search page behavior.
3682| src/components/SearchForm.tsx:960:       {showLocationWarning && !isCompact && (
3683| NOTE: Implementation detail supporting search page behavior.
3684| src/components/SearchForm.tsx:961:         <div className="mt-2 px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl text-sm text-amber-800 dark:text-amber-400 flex items-center gap-2">
3685| NOTE: Tailwind classes define layout and styling.
3686| src/components/SearchForm.tsx:962:           <svg
3687| NOTE: JSX markup for search UI.
3688| src/components/SearchForm.tsx:963:             className="w-4 h-4 flex-shrink-0"
3689| NOTE: Tailwind classes define layout and styling.
3690| src/components/SearchForm.tsx:964:             fill="none"
3691| NOTE: Implementation detail supporting search page behavior.
3692| src/components/SearchForm.tsx:965:             stroke="currentColor"
3693| NOTE: Implementation detail supporting search page behavior.
3694| src/components/SearchForm.tsx:966:             viewBox="0 0 24 24"
3695| NOTE: Implementation detail supporting search page behavior.
3696| src/components/SearchForm.tsx:967:           >
3697| NOTE: Implementation detail supporting search page behavior.
3698| src/components/SearchForm.tsx:968:             <path
3699| NOTE: JSX markup for search UI.
3700| src/components/SearchForm.tsx:969:               strokeLinecap="round"
3701| NOTE: Implementation detail supporting search page behavior.
3702| src/components/SearchForm.tsx:970:               strokeLinejoin="round"
3703| NOTE: Implementation detail supporting search page behavior.
3704| src/components/SearchForm.tsx:971:               strokeWidth={2}
3705| NOTE: Implementation detail supporting search page behavior.
3706| src/components/SearchForm.tsx:972:               d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
3707| NOTE: Implementation detail supporting search page behavior.
3708| src/components/SearchForm.tsx:973:             />
3709| NOTE: Implementation detail supporting search page behavior.
3710| src/components/SearchForm.tsx:974:           </svg>
3711| NOTE: JSX markup for search UI.
3712| src/components/SearchForm.tsx:975:           <span>
3713| NOTE: JSX markup for search UI.
3714| src/components/SearchForm.tsx:976:             Select a location from the dropdown for more accurate results
3715| NOTE: Implementation detail supporting search page behavior.
3716| src/components/SearchForm.tsx:977:           </span>
3717| NOTE: JSX markup for search UI.
3718| src/components/SearchForm.tsx:978:         </div>
3719| NOTE: JSX markup for search UI.
3720| src/components/SearchForm.tsx:979:       )}
3721| NOTE: Implementation detail supporting search page behavior.
3722| src/components/SearchForm.tsx:980: 
3723| NOTE: Blank line for visual separation.
3724| src/components/SearchForm.tsx:981:       {/* Filter Drawer Overlay - Rendered via Portal to escape stacking contexts */}
3725| NOTE: Implementation detail supporting search page behavior.
3726| src/components/SearchForm.tsx:982:       {showFilters &&
3727| NOTE: Implementation detail supporting search page behavior.
3728| src/components/SearchForm.tsx:983:         typeof document !== "undefined" &&
3729| NOTE: Implementation detail supporting search page behavior.
3730| src/components/SearchForm.tsx:984:         createPortal(
3731| NOTE: Implementation detail supporting search page behavior.
3732| src/components/SearchForm.tsx:985:           <div
3733| NOTE: JSX markup for search UI.
3734| src/components/SearchForm.tsx:986:             className="fixed inset-0 z-modal overflow-hidden"
3735| NOTE: Tailwind classes define layout and styling.
3736| src/components/SearchForm.tsx:987:             aria-labelledby="filter-drawer-title"
3737| NOTE: Accessibility attribute for screen readers.
3738| src/components/SearchForm.tsx:988:             role="dialog"
3739| NOTE: Implementation detail supporting search page behavior.
3740| src/components/SearchForm.tsx:989:             aria-modal="true"
3741| NOTE: Accessibility attribute for screen readers.
3742| src/components/SearchForm.tsx:990:           >
3743| NOTE: Implementation detail supporting search page behavior.
3744| src/components/SearchForm.tsx:991:             {/* Backdrop */}
3745| NOTE: Implementation detail supporting search page behavior.
3746| src/components/SearchForm.tsx:992:             <div
3747| NOTE: JSX markup for search UI.
3748| src/components/SearchForm.tsx:993:               className="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-300"
3749| NOTE: Tailwind classes define layout and styling.
3750| src/components/SearchForm.tsx:994:               onClick={() => setShowFilters(false)}
3751| NOTE: Implementation detail supporting search page behavior.
3752| src/components/SearchForm.tsx:995:               aria-label="Close filters"
3753| NOTE: Accessibility attribute for screen readers.
3754| src/components/SearchForm.tsx:996:             />
3755| NOTE: Implementation detail supporting search page behavior.
3756| src/components/SearchForm.tsx:997: 
3757| NOTE: Blank line for visual separation.
3758| src/components/SearchForm.tsx:998:             {/* Drawer Panel with Focus Trap for accessibility */}
3759| NOTE: Implementation detail supporting search page behavior.
3760| src/components/SearchForm.tsx:999:             <FocusTrap active={showFilters}>
3761| NOTE: JSX markup for search UI.
3762| src/components/SearchForm.tsx:1000:               <div
3763| NOTE: JSX markup for search UI.
3764| src/components/SearchForm.tsx:1001:                 id="search-filters"
3765| NOTE: Implementation detail supporting search page behavior.
3766| src/components/SearchForm.tsx:1002:                 className="absolute right-0 top-0 h-full w-full md:max-w-md bg-white dark:bg-zinc-900 shadow-2xl transform transition-transform duration-300 ease-out animate-in slide-in-from-right overflow-hidden flex flex-col"
3767| NOTE: Tailwind classes define layout and styling.
3768| src/components/SearchForm.tsx:1003:               >
3769| NOTE: Implementation detail supporting search page behavior.
3770| src/components/SearchForm.tsx:1004:                 {/* Note: FocusTrap wraps this - close button below will receive focus */}
3771| NOTE: Implementation detail supporting search page behavior.
3772| src/components/SearchForm.tsx:1005:                 {/* Drawer Header */}
3773| NOTE: Implementation detail supporting search page behavior.
3774| src/components/SearchForm.tsx:1006:                 <div className="flex items-center justify-between px-6 py-4 border-b border-zinc-100 dark:border-zinc-800 bg-white dark:bg-zinc-900">
3775| NOTE: Tailwind classes define layout and styling.
3776| src/components/SearchForm.tsx:1007:                   <h2
3777| NOTE: JSX markup for search UI.
3778| src/components/SearchForm.tsx:1008:                     id="filter-drawer-title"
3779| NOTE: Implementation detail supporting search page behavior.
3780| src/components/SearchForm.tsx:1009:                     className="text-lg font-semibold text-zinc-900 dark:text-white"
3781| NOTE: Tailwind classes define layout and styling.
3782| src/components/SearchForm.tsx:1010:                   >
3783| NOTE: Implementation detail supporting search page behavior.
3784| src/components/SearchForm.tsx:1011:                     Filters
3785| NOTE: Implementation detail supporting search page behavior.
3786| src/components/SearchForm.tsx:1012:                     {activeFilterCount > 0 && (
3787| NOTE: Implementation detail supporting search page behavior.
3788| src/components/SearchForm.tsx:1013:                       <span className="ml-2 inline-flex items-center justify-center min-w-[24px] h-6 px-2 text-sm font-semibold rounded-full bg-zinc-900 dark:bg-white text-white dark:text-zinc-900">
3789| NOTE: Tailwind classes define layout and styling.
3790| src/components/SearchForm.tsx:1014:                         {activeFilterCount}
3791| NOTE: Implementation detail supporting search page behavior.
3792| src/components/SearchForm.tsx:1015:                       </span>
3793| NOTE: JSX markup for search UI.
3794| src/components/SearchForm.tsx:1016:                     )}
3795| NOTE: Implementation detail supporting search page behavior.
3796| src/components/SearchForm.tsx:1017:                   </h2>
3797| NOTE: JSX markup for search UI.
3798| src/components/SearchForm.tsx:1018:                   <div className="flex items-center gap-2">
3799| NOTE: Tailwind classes define layout and styling.
3800| src/components/SearchForm.tsx:1019:                     {/* Clear all button - shows when filters are active or pending changes exist */}
3801| NOTE: Implementation detail supporting search page behavior.
3802| src/components/SearchForm.tsx:1020:                     {(hasActiveFilters || filtersDirty) && (
3803| NOTE: Implementation detail supporting search page behavior.
3804| src/components/SearchForm.tsx:1021:                       <Button
3805| NOTE: JSX markup for search UI.
3806| src/components/SearchForm.tsx:1022:                         variant="ghost"
3807| NOTE: Implementation detail supporting search page behavior.
3808| src/components/SearchForm.tsx:1023:                         size="sm"
3809| NOTE: Implementation detail supporting search page behavior.
3810| src/components/SearchForm.tsx:1024:                         onClick={handleClearAllFilters}
3811| NOTE: Implementation detail supporting search page behavior.
3812| src/components/SearchForm.tsx:1025:                         className="text-sm text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white"
3813| NOTE: Tailwind classes define layout and styling.
3814| src/components/SearchForm.tsx:1026:                       >
3815| NOTE: Implementation detail supporting search page behavior.
3816| src/components/SearchForm.tsx:1027:                         Clear all
3817| NOTE: Implementation detail supporting search page behavior.
3818| src/components/SearchForm.tsx:1028:                       </Button>
3819| NOTE: JSX markup for search UI.
3820| src/components/SearchForm.tsx:1029:                     )}
3821| NOTE: Implementation detail supporting search page behavior.
3822| src/components/SearchForm.tsx:1030:                     <Button
3823| NOTE: JSX markup for search UI.
3824| src/components/SearchForm.tsx:1031:                       variant="ghost"
3825| NOTE: Implementation detail supporting search page behavior.
3826| src/components/SearchForm.tsx:1032:                       size="icon"
3827| NOTE: Implementation detail supporting search page behavior.
3828| src/components/SearchForm.tsx:1033:                       onClick={() => setShowFilters(false)}
3829| NOTE: Implementation detail supporting search page behavior.
3830| src/components/SearchForm.tsx:1034:                       className="rounded-full w-11 h-11 p-0 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"
3831| NOTE: Tailwind classes define layout and styling.
3832| src/components/SearchForm.tsx:1035:                       aria-label="Close filters"
3833| NOTE: Accessibility attribute for screen readers.
3834| src/components/SearchForm.tsx:1036:                     >
3835| NOTE: Implementation detail supporting search page behavior.
3836| src/components/SearchForm.tsx:1037:                       <X className="w-5 h-5 text-zinc-500 dark:text-zinc-400" />
3837| NOTE: Tailwind classes define layout and styling.
3838| src/components/SearchForm.tsx:1038:                     </Button>
3839| NOTE: JSX markup for search UI.
3840| src/components/SearchForm.tsx:1039:                   </div>
3841| NOTE: JSX markup for search UI.
3842| src/components/SearchForm.tsx:1040:                 </div>
3843| NOTE: JSX markup for search UI.
3844| src/components/SearchForm.tsx:1041: 
3845| NOTE: Blank line for visual separation.
3846| src/components/SearchForm.tsx:1042:                 {/* Scrollable Filter Content */}
3847| NOTE: Implementation detail supporting search page behavior.
3848| src/components/SearchForm.tsx:1043:                 <div className="flex-1 overflow-y-auto p-6 space-y-6 scrollbar-hide">
3849| NOTE: Tailwind classes define layout and styling.
3850| src/components/SearchForm.tsx:1044:                   {/* Sort By (Mobile only - instant apply like desktop) */}
3851| NOTE: Implementation detail supporting search page behavior.
3852| src/components/SearchForm.tsx:1045:                   <fieldset className="space-y-3">
3853| NOTE: Tailwind classes define layout and styling.
3854| src/components/SearchForm.tsx:1046:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
3855| NOTE: Tailwind classes define layout and styling.
3856| src/components/SearchForm.tsx:1047:                       Sort by
3857| NOTE: Implementation detail supporting search page behavior.
3858| src/components/SearchForm.tsx:1048:                     </legend>
3859| NOTE: JSX markup for search UI.
3860| src/components/SearchForm.tsx:1049:                     <div
3861| NOTE: JSX markup for search UI.
3862| src/components/SearchForm.tsx:1050:                       className="flex flex-col gap-2"
3863| NOTE: Tailwind classes define layout and styling.
3864| src/components/SearchForm.tsx:1051:                       role="radiogroup"
3865| NOTE: Implementation detail supporting search page behavior.
3866| src/components/SearchForm.tsx:1052:                       aria-label="Sort options"
3867| NOTE: Accessibility attribute for screen readers.
3868| src/components/SearchForm.tsx:1053:                     >
3869| NOTE: Implementation detail supporting search page behavior.
3870| src/components/SearchForm.tsx:1054:                       {sortOptions.map((option) => (
3871| NOTE: Implementation detail supporting search page behavior.
3872| src/components/SearchForm.tsx:1055:                         <label
3873| NOTE: JSX markup for search UI.
3874| src/components/SearchForm.tsx:1056:                           key={option.value}
3875| NOTE: Implementation detail supporting search page behavior.
3876| src/components/SearchForm.tsx:1057:                           className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${
3877| NOTE: Tailwind classes define layout and styling.
3878| src/components/SearchForm.tsx:1058:                             currentSort === option.value
3879| NOTE: Implementation detail supporting search page behavior.
3880| src/components/SearchForm.tsx:1059:                               ? "border-zinc-900 dark:border-white bg-zinc-50 dark:bg-zinc-800"
3881| NOTE: Implementation detail supporting search page behavior.
3882| src/components/SearchForm.tsx:1060:                               : "border-zinc-200 dark:border-zinc-700 hover:border-zinc-300 dark:hover:border-zinc-600"
3883| NOTE: Implementation detail supporting search page behavior.
3884| src/components/SearchForm.tsx:1061:                           }`}
3885| NOTE: Implementation detail supporting search page behavior.
3886| src/components/SearchForm.tsx:1062:                         >
3887| NOTE: Implementation detail supporting search page behavior.
3888| src/components/SearchForm.tsx:1063:                           <input
3889| NOTE: JSX markup for search UI.
3890| src/components/SearchForm.tsx:1064:                             type="radio"
3891| NOTE: Implementation detail supporting search page behavior.
3892| src/components/SearchForm.tsx:1065:                             name="sort"
3893| NOTE: Implementation detail supporting search page behavior.
3894| src/components/SearchForm.tsx:1066:                             value={option.value}
3895| NOTE: Implementation detail supporting search page behavior.
3896| src/components/SearchForm.tsx:1067:                             checked={currentSort === option.value}
3897| NOTE: Implementation detail supporting search page behavior.
3898| src/components/SearchForm.tsx:1068:                             onChange={() =>
3899| NOTE: Implementation detail supporting search page behavior.
3900| src/components/SearchForm.tsx:1069:                               handleSortChange(option.value as SortOption)
3901| NOTE: Implementation detail supporting search page behavior.
3902| src/components/SearchForm.tsx:1070:                             }
3903| NOTE: Implementation detail supporting search page behavior.
3904| src/components/SearchForm.tsx:1071:                             className="w-4 h-4 text-zinc-900 dark:text-white border-zinc-300 dark:border-zinc-600 focus:ring-zinc-500"
3905| NOTE: Tailwind classes define layout and styling.
3906| src/components/SearchForm.tsx:1072:                           />
3907| NOTE: Implementation detail supporting search page behavior.
3908| src/components/SearchForm.tsx:1073:                           <span className="text-sm font-medium text-zinc-900 dark:text-white">
3909| NOTE: Tailwind classes define layout and styling.
3910| src/components/SearchForm.tsx:1074:                             {option.label}
3911| NOTE: Implementation detail supporting search page behavior.
3912| src/components/SearchForm.tsx:1075:                           </span>
3913| NOTE: JSX markup for search UI.
3914| src/components/SearchForm.tsx:1076:                         </label>
3915| NOTE: JSX markup for search UI.
3916| src/components/SearchForm.tsx:1077:                       ))}
3917| NOTE: Implementation detail supporting search page behavior.
3918| src/components/SearchForm.tsx:1078:                     </div>
3919| NOTE: JSX markup for search UI.
3920| src/components/SearchForm.tsx:1079:                   </fieldset>
3921| NOTE: JSX markup for search UI.
3922| src/components/SearchForm.tsx:1080: 
3923| NOTE: Blank line for visual separation.
3924| src/components/SearchForm.tsx:1081:                   {/* Move-in Date */}
3925| NOTE: Implementation detail supporting search page behavior.
3926| src/components/SearchForm.tsx:1082:                   <div className="space-y-2">
3927| NOTE: Tailwind classes define layout and styling.
3928| src/components/SearchForm.tsx:1083:                     <label
3929| NOTE: JSX markup for search UI.
3930| src/components/SearchForm.tsx:1084:                       htmlFor="filter-move-in"
3931| NOTE: Implementation detail supporting search page behavior.
3932| src/components/SearchForm.tsx:1085:                       className="text-sm font-semibold text-zinc-900 dark:text-white"
3933| NOTE: Tailwind classes define layout and styling.
3934| src/components/SearchForm.tsx:1086:                     >
3935| NOTE: Implementation detail supporting search page behavior.
3936| src/components/SearchForm.tsx:1087:                       Move-in Date
3937| NOTE: Implementation detail supporting search page behavior.
3938| src/components/SearchForm.tsx:1088:                     </label>
3939| NOTE: JSX markup for search UI.
3940| src/components/SearchForm.tsx:1089:                     <DatePicker
3941| NOTE: JSX markup for search UI.
3942| src/components/SearchForm.tsx:1090:                       id="filter-move-in"
3943| NOTE: Implementation detail supporting search page behavior.
3944| src/components/SearchForm.tsx:1091:                       value={batchedFilters.moveInDate}
3945| NOTE: Implementation detail supporting search page behavior.
3946| src/components/SearchForm.tsx:1092:                       onChange={(value) =>
3947| NOTE: Implementation detail supporting search page behavior.
3948| src/components/SearchForm.tsx:1093:                         updateBatchedField("moveInDate", value)
3949| NOTE: Implementation detail supporting search page behavior.
3950| src/components/SearchForm.tsx:1094:                       }
3951| NOTE: Implementation detail supporting search page behavior.
3952| src/components/SearchForm.tsx:1095:                       placeholder="Select move-in date"
3953| NOTE: Implementation detail supporting search page behavior.
3954| src/components/SearchForm.tsx:1096:                       minDate={minMoveInDate}
3955| NOTE: Implementation detail supporting search page behavior.
3956| src/components/SearchForm.tsx:1097:                     />
3957| NOTE: Implementation detail supporting search page behavior.
3958| src/components/SearchForm.tsx:1098:                   </div>
3959| NOTE: JSX markup for search UI.
3960| src/components/SearchForm.tsx:1099: 
3961| NOTE: Blank line for visual separation.
3962| src/components/SearchForm.tsx:1100:                   {/* Lease Duration */}
3963| NOTE: Implementation detail supporting search page behavior.
3964| src/components/SearchForm.tsx:1101:                   <div className="space-y-2">
3965| NOTE: Tailwind classes define layout and styling.
3966| src/components/SearchForm.tsx:1102:                     <label
3967| NOTE: JSX markup for search UI.
3968| src/components/SearchForm.tsx:1103:                       htmlFor="filter-lease"
3969| NOTE: Implementation detail supporting search page behavior.
3970| src/components/SearchForm.tsx:1104:                       className="text-sm font-semibold text-zinc-900 dark:text-white"
3971| NOTE: Tailwind classes define layout and styling.
3972| src/components/SearchForm.tsx:1105:                     >
3973| NOTE: Implementation detail supporting search page behavior.
3974| src/components/SearchForm.tsx:1106:                       Lease Duration
3975| NOTE: Implementation detail supporting search page behavior.
3976| src/components/SearchForm.tsx:1107:                     </label>
3977| NOTE: JSX markup for search UI.
3978| src/components/SearchForm.tsx:1108:                     <Select
3979| NOTE: JSX markup for search UI.
3980| src/components/SearchForm.tsx:1109:                       value={batchedFilters.leaseDuration || "any"}
3981| NOTE: Implementation detail supporting search page behavior.
3982| src/components/SearchForm.tsx:1110:                       onValueChange={(value) =>
3983| NOTE: Implementation detail supporting search page behavior.
3984| src/components/SearchForm.tsx:1111:                         updateBatchedField(
3985| NOTE: Implementation detail supporting search page behavior.
3986| src/components/SearchForm.tsx:1112:                           "leaseDuration",
3987| NOTE: Implementation detail supporting search page behavior.
3988| src/components/SearchForm.tsx:1113:                           value === "any" ? "" : value,
3989| NOTE: Implementation detail supporting search page behavior.
3990| src/components/SearchForm.tsx:1114:                         )
3991| NOTE: Implementation detail supporting search page behavior.
3992| src/components/SearchForm.tsx:1115:                       }
3993| NOTE: Implementation detail supporting search page behavior.
3994| src/components/SearchForm.tsx:1116:                     >
3995| NOTE: Implementation detail supporting search page behavior.
3996| src/components/SearchForm.tsx:1117:                       <SelectTrigger id="filter-lease">
3997| NOTE: JSX markup for search UI.
3998| src/components/SearchForm.tsx:1118:                         <SelectValue placeholder="Any" />
3999| NOTE: JSX markup for search UI.
4000| src/components/SearchForm.tsx:1119:                       </SelectTrigger>
4001| NOTE: JSX markup for search UI.
4002| src/components/SearchForm.tsx:1120:                       <SelectContent>
4003| NOTE: JSX markup for search UI.
4004| src/components/SearchForm.tsx:1121:                         <SelectItem value="any">Any</SelectItem>
4005| NOTE: JSX markup for search UI.
4006| src/components/SearchForm.tsx:1122:                         <SelectItem value="Month-to-month">
4007| NOTE: JSX markup for search UI.
4008| src/components/SearchForm.tsx:1123:                           Month-to-month
4009| NOTE: Implementation detail supporting search page behavior.
4010| src/components/SearchForm.tsx:1124:                         </SelectItem>
4011| NOTE: JSX markup for search UI.
4012| src/components/SearchForm.tsx:1125:                         <SelectItem value="3 months">3 months</SelectItem>
4013| NOTE: JSX markup for search UI.
4014| src/components/SearchForm.tsx:1126:                         <SelectItem value="6 months">6 months</SelectItem>
4015| NOTE: JSX markup for search UI.
4016| src/components/SearchForm.tsx:1127:                         <SelectItem value="12 months">12 months</SelectItem>
4017| NOTE: JSX markup for search UI.
4018| src/components/SearchForm.tsx:1128:                         <SelectItem value="Flexible">Flexible</SelectItem>
4019| NOTE: JSX markup for search UI.
4020| src/components/SearchForm.tsx:1129:                       </SelectContent>
4021| NOTE: JSX markup for search UI.
4022| src/components/SearchForm.tsx:1130:                     </Select>
4023| NOTE: JSX markup for search UI.
4024| src/components/SearchForm.tsx:1131:                   </div>
4025| NOTE: JSX markup for search UI.
4026| src/components/SearchForm.tsx:1132: 
4027| NOTE: Blank line for visual separation.
4028| src/components/SearchForm.tsx:1133:                   {/* Room Type */}
4029| NOTE: Implementation detail supporting search page behavior.
4030| src/components/SearchForm.tsx:1134:                   <div className="space-y-2">
4031| NOTE: Tailwind classes define layout and styling.
4032| src/components/SearchForm.tsx:1135:                     <label
4033| NOTE: JSX markup for search UI.
4034| src/components/SearchForm.tsx:1136:                       htmlFor="filter-room-type"
4035| NOTE: Implementation detail supporting search page behavior.
4036| src/components/SearchForm.tsx:1137:                       className="text-sm font-semibold text-zinc-900 dark:text-white"
4037| NOTE: Tailwind classes define layout and styling.
4038| src/components/SearchForm.tsx:1138:                     >
4039| NOTE: Implementation detail supporting search page behavior.
4040| src/components/SearchForm.tsx:1139:                       Room Type
4041| NOTE: Implementation detail supporting search page behavior.
4042| src/components/SearchForm.tsx:1140:                     </label>
4043| NOTE: JSX markup for search UI.
4044| src/components/SearchForm.tsx:1141:                     <Select
4045| NOTE: JSX markup for search UI.
4046| src/components/SearchForm.tsx:1142:                       value={batchedFilters.roomType || "any"}
4047| NOTE: Implementation detail supporting search page behavior.
4048| src/components/SearchForm.tsx:1143:                       onValueChange={(value) =>
4049| NOTE: Implementation detail supporting search page behavior.
4050| src/components/SearchForm.tsx:1144:                         updateBatchedField(
4051| NOTE: Implementation detail supporting search page behavior.
4052| src/components/SearchForm.tsx:1145:                           "roomType",
4053| NOTE: Implementation detail supporting search page behavior.
4054| src/components/SearchForm.tsx:1146:                           value === "any" ? "" : value,
4055| NOTE: Implementation detail supporting search page behavior.
4056| src/components/SearchForm.tsx:1147:                         )
4057| NOTE: Implementation detail supporting search page behavior.
4058| src/components/SearchForm.tsx:1148:                       }
4059| NOTE: Implementation detail supporting search page behavior.
4060| src/components/SearchForm.tsx:1149:                     >
4061| NOTE: Implementation detail supporting search page behavior.
4062| src/components/SearchForm.tsx:1150:                       <SelectTrigger id="filter-room-type">
4063| NOTE: JSX markup for search UI.
4064| src/components/SearchForm.tsx:1151:                         <SelectValue placeholder="Any" />
4065| NOTE: JSX markup for search UI.
4066| src/components/SearchForm.tsx:1152:                       </SelectTrigger>
4067| NOTE: JSX markup for search UI.
4068| src/components/SearchForm.tsx:1153:                       <SelectContent>
4069| NOTE: JSX markup for search UI.
4070| src/components/SearchForm.tsx:1154:                         <SelectItem value="any">Any</SelectItem>
4071| NOTE: JSX markup for search UI.
4072| src/components/SearchForm.tsx:1155:                         <SelectItem value="Private Room">
4073| NOTE: JSX markup for search UI.
4074| src/components/SearchForm.tsx:1156:                           Private Room
4075| NOTE: Implementation detail supporting search page behavior.
4076| src/components/SearchForm.tsx:1157:                         </SelectItem>
4077| NOTE: JSX markup for search UI.
4078| src/components/SearchForm.tsx:1158:                         <SelectItem value="Shared Room">Shared Room</SelectItem>
4079| NOTE: JSX markup for search UI.
4080| src/components/SearchForm.tsx:1159:                         <SelectItem value="Entire Place">
4081| NOTE: JSX markup for search UI.
4082| src/components/SearchForm.tsx:1160:                           Entire Place
4083| NOTE: Implementation detail supporting search page behavior.
4084| src/components/SearchForm.tsx:1161:                         </SelectItem>
4085| NOTE: JSX markup for search UI.
4086| src/components/SearchForm.tsx:1162:                       </SelectContent>
4087| NOTE: JSX markup for search UI.
4088| src/components/SearchForm.tsx:1163:                     </Select>
4089| NOTE: JSX markup for search UI.
4090| src/components/SearchForm.tsx:1164:                   </div>
4091| NOTE: JSX markup for search UI.
4092| src/components/SearchForm.tsx:1165: 
4093| NOTE: Blank line for visual separation.
4094| src/components/SearchForm.tsx:1166:                   {/* Amenities */}
4095| NOTE: Implementation detail supporting search page behavior.
4096| src/components/SearchForm.tsx:1167:                   <fieldset className="space-y-3">
4097| NOTE: Tailwind classes define layout and styling.
4098| src/components/SearchForm.tsx:1168:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
4099| NOTE: Tailwind classes define layout and styling.
4100| src/components/SearchForm.tsx:1169:                       Amenities
4101| NOTE: Implementation detail supporting search page behavior.
4102| src/components/SearchForm.tsx:1170:                     </legend>
4103| NOTE: JSX markup for search UI.
4104| src/components/SearchForm.tsx:1171:                     <div
4105| NOTE: JSX markup for search UI.
4106| src/components/SearchForm.tsx:1172:                       className="flex flex-wrap gap-2"
4107| NOTE: Tailwind classes define layout and styling.
4108| src/components/SearchForm.tsx:1173:                       role="group"
4109| NOTE: Implementation detail supporting search page behavior.
4110| src/components/SearchForm.tsx:1174:                       aria-label="Select amenities"
4111| NOTE: Accessibility attribute for screen readers.
4112| src/components/SearchForm.tsx:1175:                     >
4113| NOTE: Implementation detail supporting search page behavior.
4114| src/components/SearchForm.tsx:1176:                       {AMENITY_OPTIONS.map((amenity) => (
4115| NOTE: Implementation detail supporting search page behavior.
4116| src/components/SearchForm.tsx:1177:                         <Button
4117| NOTE: JSX markup for search UI.
4118| src/components/SearchForm.tsx:1178:                           key={amenity}
4119| NOTE: Implementation detail supporting search page behavior.
4120| src/components/SearchForm.tsx:1179:                           type="button"
4121| NOTE: Implementation detail supporting search page behavior.
4122| src/components/SearchForm.tsx:1180:                           variant="filter"
4123| NOTE: Implementation detail supporting search page behavior.
4124| src/components/SearchForm.tsx:1181:                           onClick={() => toggleAmenity(amenity)}
4125| NOTE: Implementation detail supporting search page behavior.
4126| src/components/SearchForm.tsx:1182:                           data-active={batchedFilters.amenities.includes(
4127| NOTE: Implementation detail supporting search page behavior.
4128| src/components/SearchForm.tsx:1183:                             amenity,
4129| NOTE: Implementation detail supporting search page behavior.
4130| src/components/SearchForm.tsx:1184:                           )}
4131| NOTE: Implementation detail supporting search page behavior.
4132| src/components/SearchForm.tsx:1185:                           aria-pressed={batchedFilters.amenities.includes(
4133| NOTE: Accessibility attribute for screen readers.
4134| src/components/SearchForm.tsx:1186:                             amenity,
4135| NOTE: Implementation detail supporting search page behavior.
4136| src/components/SearchForm.tsx:1187:                           )}
4137| NOTE: Implementation detail supporting search page behavior.
4138| src/components/SearchForm.tsx:1188:                           className={`rounded-full h-auto py-2 px-3 text-sm font-medium transition-all duration-200 ${batchedFilters.amenities.includes(amenity) ? "scale-[1.02]" : "hover:scale-[1.02]"}`}
4139| NOTE: Tailwind classes define layout and styling.
4140| src/components/SearchForm.tsx:1189:                         >
4141| NOTE: Implementation detail supporting search page behavior.
4142| src/components/SearchForm.tsx:1190:                           {amenity}
4143| NOTE: Implementation detail supporting search page behavior.
4144| src/components/SearchForm.tsx:1191:                           {batchedFilters.amenities.includes(amenity) && (
4145| NOTE: Implementation detail supporting search page behavior.
4146| src/components/SearchForm.tsx:1192:                             <X className="w-3.5 h-3.5 ml-1.5" />
4147| NOTE: Tailwind classes define layout and styling.
4148| src/components/SearchForm.tsx:1193:                           )}
4149| NOTE: Implementation detail supporting search page behavior.
4150| src/components/SearchForm.tsx:1194:                         </Button>
4151| NOTE: JSX markup for search UI.
4152| src/components/SearchForm.tsx:1195:                       ))}
4153| NOTE: Implementation detail supporting search page behavior.
4154| src/components/SearchForm.tsx:1196:                     </div>
4155| NOTE: JSX markup for search UI.
4156| src/components/SearchForm.tsx:1197:                   </fieldset>
4157| NOTE: JSX markup for search UI.
4158| src/components/SearchForm.tsx:1198: 
4159| NOTE: Blank line for visual separation.
4160| src/components/SearchForm.tsx:1199:                   {/* House Rules */}
4161| NOTE: Implementation detail supporting search page behavior.
4162| src/components/SearchForm.tsx:1200:                   <fieldset className="space-y-3">
4163| NOTE: Tailwind classes define layout and styling.
4164| src/components/SearchForm.tsx:1201:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
4165| NOTE: Tailwind classes define layout and styling.
4166| src/components/SearchForm.tsx:1202:                       House Rules
4167| NOTE: Implementation detail supporting search page behavior.
4168| src/components/SearchForm.tsx:1203:                     </legend>
4169| NOTE: JSX markup for search UI.
4170| src/components/SearchForm.tsx:1204:                     <div
4171| NOTE: JSX markup for search UI.
4172| src/components/SearchForm.tsx:1205:                       className="flex flex-wrap gap-2"
4173| NOTE: Tailwind classes define layout and styling.
4174| src/components/SearchForm.tsx:1206:                       role="group"
4175| NOTE: Implementation detail supporting search page behavior.
4176| src/components/SearchForm.tsx:1207:                       aria-label="Select house rules"
4177| NOTE: Accessibility attribute for screen readers.
4178| src/components/SearchForm.tsx:1208:                     >
4179| NOTE: Implementation detail supporting search page behavior.
4180| src/components/SearchForm.tsx:1209:                       {HOUSE_RULE_OPTIONS.map((rule) => (
4181| NOTE: Implementation detail supporting search page behavior.
4182| src/components/SearchForm.tsx:1210:                         <Button
4183| NOTE: JSX markup for search UI.
4184| src/components/SearchForm.tsx:1211:                           key={rule}
4185| NOTE: Implementation detail supporting search page behavior.
4186| src/components/SearchForm.tsx:1212:                           type="button"
4187| NOTE: Implementation detail supporting search page behavior.
4188| src/components/SearchForm.tsx:1213:                           variant="filter"
4189| NOTE: Implementation detail supporting search page behavior.
4190| src/components/SearchForm.tsx:1214:                           onClick={() => toggleHouseRule(rule)}
4191| NOTE: Implementation detail supporting search page behavior.
4192| src/components/SearchForm.tsx:1215:                           data-active={batchedFilters.houseRules.includes(rule)}
4193| NOTE: Implementation detail supporting search page behavior.
4194| src/components/SearchForm.tsx:1216:                           aria-pressed={batchedFilters.houseRules.includes(
4195| NOTE: Accessibility attribute for screen readers.
4196| src/components/SearchForm.tsx:1217:                             rule,
4197| NOTE: Implementation detail supporting search page behavior.
4198| src/components/SearchForm.tsx:1218:                           )}
4199| NOTE: Implementation detail supporting search page behavior.
4200| src/components/SearchForm.tsx:1219:                           className={`rounded-full h-auto py-2 px-3 text-sm font-medium transition-all duration-200 ${batchedFilters.houseRules.includes(rule) ? "scale-[1.02]" : "hover:scale-[1.02]"}`}
4201| NOTE: Tailwind classes define layout and styling.
4202| src/components/SearchForm.tsx:1220:                         >
4203| NOTE: Implementation detail supporting search page behavior.
4204| src/components/SearchForm.tsx:1221:                           {rule}
4205| NOTE: Implementation detail supporting search page behavior.
4206| src/components/SearchForm.tsx:1222:                           {batchedFilters.houseRules.includes(rule) && (
4207| NOTE: Implementation detail supporting search page behavior.
4208| src/components/SearchForm.tsx:1223:                             <X className="w-3.5 h-3.5 ml-1.5" />
4209| NOTE: Tailwind classes define layout and styling.
4210| src/components/SearchForm.tsx:1224:                           )}
4211| NOTE: Implementation detail supporting search page behavior.
4212| src/components/SearchForm.tsx:1225:                         </Button>
4213| NOTE: JSX markup for search UI.
4214| src/components/SearchForm.tsx:1226:                       ))}
4215| NOTE: Implementation detail supporting search page behavior.
4216| src/components/SearchForm.tsx:1227:                     </div>
4217| NOTE: JSX markup for search UI.
4218| src/components/SearchForm.tsx:1228:                   </fieldset>
4219| NOTE: JSX markup for search UI.
4220| src/components/SearchForm.tsx:1229: 
4221| NOTE: Blank line for visual separation.
4222| src/components/SearchForm.tsx:1230:                   {/* Languages */}
4223| NOTE: Implementation detail supporting search page behavior.
4224| src/components/SearchForm.tsx:1231:                   <fieldset className="space-y-3">
4225| NOTE: Tailwind classes define layout and styling.
4226| src/components/SearchForm.tsx:1232:                     <legend className="text-sm font-semibold text-zinc-900 dark:text-white">
4227| NOTE: Tailwind classes define layout and styling.
4228| src/components/SearchForm.tsx:1233:                       Can Communicate In
4229| NOTE: Implementation detail supporting search page behavior.
4230| src/components/SearchForm.tsx:1234:                     </legend>
4231| NOTE: JSX markup for search UI.
4232| src/components/SearchForm.tsx:1235:                     <p className="text-xs text-zinc-500 dark:text-zinc-400 -mt-1">
4233| NOTE: Tailwind classes define layout and styling.
4234| src/components/SearchForm.tsx:1236:                       Show listings where household speaks any of these
4235| NOTE: Implementation detail supporting search page behavior.
4236| src/components/SearchForm.tsx:1237:                     </p>
4237| NOTE: JSX markup for search UI.
4238| src/components/SearchForm.tsx:1238: 
4239| NOTE: Blank line for visual separation.
4240| src/components/SearchForm.tsx:1239:                     {/* Selected languages shown at top */}
4241| NOTE: Implementation detail supporting search page behavior.
4242| src/components/SearchForm.tsx:1240:                     {batchedFilters.languages.length > 0 && (
4243| NOTE: Implementation detail supporting search page behavior.
4244| src/components/SearchForm.tsx:1241:                       <div
4245| NOTE: JSX markup for search UI.
4246| src/components/SearchForm.tsx:1242:                         className="flex flex-wrap gap-2 pb-2 border-b border-zinc-200 dark:border-zinc-700"
4247| NOTE: Tailwind classes define layout and styling.
4248| src/components/SearchForm.tsx:1243:                         role="group"
4249| NOTE: Implementation detail supporting search page behavior.
4250| src/components/SearchForm.tsx:1244:                         aria-label="Selected languages"
4251| NOTE: Accessibility attribute for screen readers.
4252| src/components/SearchForm.tsx:1245:                       >
4253| NOTE: Implementation detail supporting search page behavior.
4254| src/components/SearchForm.tsx:1246:                         {batchedFilters.languages.map((code) => (
4255| NOTE: Implementation detail supporting search page behavior.
4256| src/components/SearchForm.tsx:1247:                           <Button
4257| NOTE: JSX markup for search UI.
4258| src/components/SearchForm.tsx:1248:                             key={code}
4259| NOTE: Implementation detail supporting search page behavior.
4260| src/components/SearchForm.tsx:1249:                             type="button"
4261| NOTE: Implementation detail supporting search page behavior.
4262| src/components/SearchForm.tsx:1250:                             variant="filter"
4263| NOTE: Implementation detail supporting search page behavior.
4264| src/components/SearchForm.tsx:1251:                             onClick={() => toggleLanguage(code)}
4265| NOTE: Implementation detail supporting search page behavior.
4266| src/components/SearchForm.tsx:1252:                             data-active={true}
4267| NOTE: Implementation detail supporting search page behavior.
4268| src/components/SearchForm.tsx:1253:                             aria-pressed={true}
4269| NOTE: Accessibility attribute for screen readers.
4270| src/components/SearchForm.tsx:1254:                             className="rounded-full h-auto py-2 px-3 text-sm font-medium"
4271| NOTE: Tailwind classes define layout and styling.
4272| src/components/SearchForm.tsx:1255:                           >
4273| NOTE: Implementation detail supporting search page behavior.
4274| src/components/SearchForm.tsx:1256:                             {getLanguageName(code)}
4275| NOTE: Implementation detail supporting search page behavior.
4276| src/components/SearchForm.tsx:1257:                             <X className="w-3.5 h-3.5 ml-1.5" />
4277| NOTE: Tailwind classes define layout and styling.
4278| src/components/SearchForm.tsx:1258:                           </Button>
4279| NOTE: JSX markup for search UI.
4280| src/components/SearchForm.tsx:1259:                         ))}
4281| NOTE: Implementation detail supporting search page behavior.
4282| src/components/SearchForm.tsx:1260:                       </div>
4283| NOTE: JSX markup for search UI.
4284| src/components/SearchForm.tsx:1261:                     )}
4285| NOTE: Implementation detail supporting search page behavior.
4286| src/components/SearchForm.tsx:1262: 
4287| NOTE: Blank line for visual separation.
4288| src/components/SearchForm.tsx:1263:                     {/* Search input */}
4289| NOTE: Implementation detail supporting search page behavior.
4290| src/components/SearchForm.tsx:1264:                     <Input
4291| NOTE: JSX markup for search UI.
4292| src/components/SearchForm.tsx:1265:                       type="text"
4293| NOTE: Implementation detail supporting search page behavior.
4294| src/components/SearchForm.tsx:1266:                       placeholder="Search languages..."
4295| NOTE: Implementation detail supporting search page behavior.
4296| src/components/SearchForm.tsx:1267:                       value={languageSearch}
4297| NOTE: Implementation detail supporting search page behavior.
4298| src/components/SearchForm.tsx:1268:                       onChange={(e) => setLanguageSearch(e.target.value)}
4299| NOTE: Implementation detail supporting search page behavior.
4300| src/components/SearchForm.tsx:1269:                       className="h-9"
4301| NOTE: Tailwind classes define layout and styling.
4302| src/components/SearchForm.tsx:1270:                     />
4303| NOTE: Implementation detail supporting search page behavior.
4304| src/components/SearchForm.tsx:1271: 
4305| NOTE: Blank line for visual separation.
4306| src/components/SearchForm.tsx:1272:                     {/* Language chips */}
4307| NOTE: Implementation detail supporting search page behavior.
4308| src/components/SearchForm.tsx:1273:                     <div
4309| NOTE: JSX markup for search UI.
4310| src/components/SearchForm.tsx:1274:                       className="flex flex-wrap gap-2 max-h-36 overflow-y-auto"
4311| NOTE: Tailwind classes define layout and styling.
4312| src/components/SearchForm.tsx:1275:                       role="group"
4313| NOTE: Implementation detail supporting search page behavior.
4314| src/components/SearchForm.tsx:1276:                       aria-label="Available languages"
4315| NOTE: Accessibility attribute for screen readers.
4316| src/components/SearchForm.tsx:1277:                     >
4317| NOTE: Implementation detail supporting search page behavior.
4318| src/components/SearchForm.tsx:1278:                       {filteredLanguages
4319| NOTE: Implementation detail supporting search page behavior.
4320| src/components/SearchForm.tsx:1279:                         .filter(
4321| NOTE: Implementation detail supporting search page behavior.
4322| src/components/SearchForm.tsx:1280:                           (code) => !batchedFilters.languages.includes(code),
4323| NOTE: Implementation detail supporting search page behavior.
4324| src/components/SearchForm.tsx:1281:                         )
4325| NOTE: Implementation detail supporting search page behavior.
4326| src/components/SearchForm.tsx:1282:                         .map((code) => (
4327| NOTE: Implementation detail supporting search page behavior.
4328| src/components/SearchForm.tsx:1283:                           <Button
4329| NOTE: JSX markup for search UI.
4330| src/components/SearchForm.tsx:1284:                             key={code}
4331| NOTE: Implementation detail supporting search page behavior.
4332| src/components/SearchForm.tsx:1285:                             type="button"
4333| NOTE: Implementation detail supporting search page behavior.
4334| src/components/SearchForm.tsx:1286:                             variant="filter"
4335| NOTE: Implementation detail supporting search page behavior.
4336| src/components/SearchForm.tsx:1287:                             onClick={() => toggleLanguage(code)}
4337| NOTE: Implementation detail supporting search page behavior.
4338| src/components/SearchForm.tsx:1288:                             data-active={false}
4339| NOTE: Implementation detail supporting search page behavior.
4340| src/components/SearchForm.tsx:1289:                             aria-pressed={false}
4341| NOTE: Accessibility attribute for screen readers.
4342| src/components/SearchForm.tsx:1290:                             className="rounded-full h-auto py-2 px-3 text-sm font-medium transition-all duration-200 hover:scale-[1.02]"
4343| NOTE: Tailwind classes define layout and styling.
4344| src/components/SearchForm.tsx:1291:                           >
4345| NOTE: Implementation detail supporting search page behavior.
4346| src/components/SearchForm.tsx:1292:                             {getLanguageName(code)}
4347| NOTE: Implementation detail supporting search page behavior.
4348| src/components/SearchForm.tsx:1293:                           </Button>
4349| NOTE: JSX markup for search UI.
4350| src/components/SearchForm.tsx:1294:                         ))}
4351| NOTE: Implementation detail supporting search page behavior.
4352| src/components/SearchForm.tsx:1295:                       {filteredLanguages.filter(
4353| NOTE: Implementation detail supporting search page behavior.
4354| src/components/SearchForm.tsx:1296:                         (code) => !batchedFilters.languages.includes(code),
4355| NOTE: Implementation detail supporting search page behavior.
4356| src/components/SearchForm.tsx:1297:                       ).length === 0 && (
4357| NOTE: Implementation detail supporting search page behavior.
4358| src/components/SearchForm.tsx:1298:                         <p className="text-sm text-zinc-500 dark:text-zinc-400">
4359| NOTE: Tailwind classes define layout and styling.
4360| src/components/SearchForm.tsx:1299:                           {languageSearch
4361| NOTE: Implementation detail supporting search page behavior.
4362| src/components/SearchForm.tsx:1300:                             ? "No languages found"
4363| NOTE: Implementation detail supporting search page behavior.
4364| src/components/SearchForm.tsx:1301:                             : "All languages selected"}
4365| NOTE: Implementation detail supporting search page behavior.
4366| src/components/SearchForm.tsx:1302:                         </p>
4367| NOTE: JSX markup for search UI.
4368| src/components/SearchForm.tsx:1303:                       )}
4369| NOTE: Implementation detail supporting search page behavior.
4370| src/components/SearchForm.tsx:1304:                     </div>
4371| NOTE: JSX markup for search UI.
4372| src/components/SearchForm.tsx:1305:                   </fieldset>
4373| NOTE: JSX markup for search UI.
4374| src/components/SearchForm.tsx:1306:                 </div>
4375| NOTE: JSX markup for search UI.
4376| src/components/SearchForm.tsx:1307: 
4377| NOTE: Blank line for visual separation.
4378| src/components/SearchForm.tsx:1308:                 {/* Drawer Footer with Apply/Reset */}
4379| NOTE: Implementation detail supporting search page behavior.
4380| src/components/SearchForm.tsx:1309:                 <FilterStickyFooter
4381| NOTE: JSX markup for search UI.
4382| src/components/SearchForm.tsx:1310:                   isDirty={filtersDirty}
4383| NOTE: Implementation detail supporting search page behavior.
4384| src/components/SearchForm.tsx:1311:                   changeCount={filtersChangeCount}
4385| NOTE: Implementation detail supporting search page behavior.
4386| src/components/SearchForm.tsx:1312:                   onApply={handleApplyFilters}
4387| NOTE: Implementation detail supporting search page behavior.
4388| src/components/SearchForm.tsx:1313:                   onReset={handleResetFilters}
4389| NOTE: Implementation detail supporting search page behavior.
4390| src/components/SearchForm.tsx:1314:                   pendingCount={pendingCount}
4391| NOTE: Implementation detail supporting search page behavior.
4392| src/components/SearchForm.tsx:1315:                   previousCount={previousCount}
4393| NOTE: Implementation detail supporting search page behavior.
4394| src/components/SearchForm.tsx:1316:                   baselineCount={baselineCount}
4395| NOTE: Implementation detail supporting search page behavior.
4396| src/components/SearchForm.tsx:1317:                   isCountLoading={isCountLoading}
4397| NOTE: Implementation detail supporting search page behavior.
4398| src/components/SearchForm.tsx:1318:                 />
4399| NOTE: Implementation detail supporting search page behavior.
4400| src/components/SearchForm.tsx:1319:               </div>
4401| NOTE: JSX markup for search UI.
4402| src/components/SearchForm.tsx:1320:             </FocusTrap>
4403| NOTE: JSX markup for search UI.
4404| src/components/SearchForm.tsx:1321:           </div>,
4405| NOTE: JSX markup for search UI.
4406| src/components/SearchForm.tsx:1322:           document.body,
4407| NOTE: Implementation detail supporting search page behavior.
4408| src/components/SearchForm.tsx:1323:         )}
4409| NOTE: Implementation detail supporting search page behavior.
4410| src/components/SearchForm.tsx:1324:     </div>
4411| NOTE: JSX markup for search UI.
4412| src/components/SearchForm.tsx:1325:   );
4413| NOTE: Implementation detail supporting search page behavior.
4414| src/components/SearchForm.tsx:1326: }
4415| NOTE: Implementation detail supporting search page behavior.
4416| FILE END: src/components/SearchForm.tsx
4417| 
4418| FILE START: src/components/PersistentMapWrapper.tsx
4419| FILE ROLE: Lazy-loaded map wrapper with map data fetching and v2 context support.
4420| src/components/PersistentMapWrapper.tsx:1: "use client";
4421| NOTE: Implementation detail supporting search page behavior.
4422| src/components/PersistentMapWrapper.tsx:2: 
4423| NOTE: Blank line for visual separation.
4424| src/components/PersistentMapWrapper.tsx:3: /**
4425| NOTE: Block comment line describing behavior or context.
4426| src/components/PersistentMapWrapper.tsx:4:  * PersistentMapWrapper - A wrapper component for the map that fetches its own data.
4427| NOTE: Block comment line describing behavior or context.
4428| src/components/PersistentMapWrapper.tsx:5:  *
4429| NOTE: Block comment line describing behavior or context.
4430| src/components/PersistentMapWrapper.tsx:6:  * This component is designed to live in the layout.tsx so it persists across
4431| NOTE: Block comment line describing behavior or context.
4432| src/components/PersistentMapWrapper.tsx:7:  * page navigations (router.replace/push). It reads URL search params and fetches
4433| NOTE: Block comment line describing behavior or context.
4434| src/components/PersistentMapWrapper.tsx:8:  * map listings data via the /api/map-listings endpoint.
4435| NOTE: Block comment line describing behavior or context.
4436| src/components/PersistentMapWrapper.tsx:9:  *
4437| NOTE: Block comment line describing behavior or context.
4438| src/components/PersistentMapWrapper.tsx:10:  * Key benefits:
4439| NOTE: Block comment line describing behavior or context.
4440| src/components/PersistentMapWrapper.tsx:11:  * - Map stays mounted across /search navigations (no Mapbox re-init = no extra billing)
4441| NOTE: Block comment line describing behavior or context.
4442| src/components/PersistentMapWrapper.tsx:12:  * - Uses useSearchParams() to react to URL changes
4443| NOTE: Block comment line describing behavior or context.
4444| src/components/PersistentMapWrapper.tsx:13:  * - Fetches data independently of the server component page
4445| NOTE: Block comment line describing behavior or context.
4446| src/components/PersistentMapWrapper.tsx:14:  *
4447| NOTE: Block comment line describing behavior or context.
4448| src/components/PersistentMapWrapper.tsx:15:  * Cost optimization (Phase 1):
4449| NOTE: Block comment line describing behavior or context.
4450| src/components/PersistentMapWrapper.tsx:16:  * - DynamicMap is NOT imported at module scope
4451| NOTE: Block comment line describing behavior or context.
4452| src/components/PersistentMapWrapper.tsx:17:  * - Only loads Mapbox bundle when shouldRenderMap is true
4453| NOTE: Block comment line describing behavior or context.
4454| src/components/PersistentMapWrapper.tsx:18:  * - Unmounts entirely when hidden (not CSS display:none)
4455| NOTE: Block comment line describing behavior or context.
4456| src/components/PersistentMapWrapper.tsx:19:  */
4457| NOTE: Block comment line describing behavior or context.
4458| src/components/PersistentMapWrapper.tsx:20: 
4459| NOTE: Blank line for visual separation.
4460| src/components/PersistentMapWrapper.tsx:21: import { useSearchParams } from "next/navigation";
4461| NOTE: Imports dependency for this module.
4462| src/components/PersistentMapWrapper.tsx:22: import {
4463| NOTE: Imports dependency for this module.
4464| src/components/PersistentMapWrapper.tsx:23:   useEffect,
4465| NOTE: Defines side effect for syncing with external state.
4466| src/components/PersistentMapWrapper.tsx:24:   useState,
4467| NOTE: Initializes local state for search UI behavior.
4468| src/components/PersistentMapWrapper.tsx:25:   useRef,
4469| NOTE: Uses ref for stable mutable storage between renders.
4470| src/components/PersistentMapWrapper.tsx:26:   useCallback,
4471| NOTE: Memoizes callback to preserve references across renders.
4472| src/components/PersistentMapWrapper.tsx:27:   lazy,
4473| NOTE: Implementation detail supporting search page behavior.
4474| src/components/PersistentMapWrapper.tsx:28:   Suspense,
4475| NOTE: Suspense boundary for async rendering.
4476| src/components/PersistentMapWrapper.tsx:29: } from "react";
4477| NOTE: Implementation detail supporting search page behavior.
4478| src/components/PersistentMapWrapper.tsx:30: import type { MapListingData } from "@/lib/data";
4479| NOTE: Imports dependency for this module.
4480| src/components/PersistentMapWrapper.tsx:31: import { useSearchV2Data } from "@/contexts/SearchV2DataContext";
4481| NOTE: Imports dependency for this module.
4482| src/components/PersistentMapWrapper.tsx:32: import { useSearchTransitionSafe } from "@/contexts/SearchTransitionContext";
4483| NOTE: Imports dependency for this module.
4484| src/components/PersistentMapWrapper.tsx:33: 
4485| NOTE: Blank line for visual separation.
4486| src/components/PersistentMapWrapper.tsx:34: // CRITICAL: Lazy import - only loads when component renders
4487| NOTE: Line comment documents intent or constraints.
4488| src/components/PersistentMapWrapper.tsx:35: // This defers the 944KB mapbox-gl bundle until user opts to see map
4489| NOTE: Line comment documents intent or constraints.
4490| src/components/PersistentMapWrapper.tsx:36: const LazyDynamicMap = lazy(() => import("./DynamicMap"));
4491| NOTE: Local declaration used by search logic or UI.
4492| src/components/PersistentMapWrapper.tsx:37: 
4493| NOTE: Blank line for visual separation.
4494| src/components/PersistentMapWrapper.tsx:38: // Maximum viewport span (matches server-side validation)
4495| NOTE: Line comment documents intent or constraints.
4496| src/components/PersistentMapWrapper.tsx:39: // Increased from 2 to 5 (~550km) to allow regional zoom-out views
4497| NOTE: Line comment documents intent or constraints.
4498| src/components/PersistentMapWrapper.tsx:40: // with Mapbox native clustering handling dense markers at wide viewports
4499| NOTE: Line comment documents intent or constraints.
4500| src/components/PersistentMapWrapper.tsx:41: const MAX_LAT_SPAN = 5;
4501| NOTE: Local declaration used by search logic or UI.
4502| src/components/PersistentMapWrapper.tsx:42: const MAX_LNG_SPAN = 5;
4503| NOTE: Local declaration used by search logic or UI.
4504| src/components/PersistentMapWrapper.tsx:43: 
4505| NOTE: Blank line for visual separation.
4506| src/components/PersistentMapWrapper.tsx:44: /**
4507| NOTE: Block comment line describing behavior or context.
4508| src/components/PersistentMapWrapper.tsx:45:  * Get user-friendly error message based on HTTP status
4509| NOTE: Block comment line describing behavior or context.
4510| src/components/PersistentMapWrapper.tsx:46:  */
4511| NOTE: Block comment line describing behavior or context.
4512| src/components/PersistentMapWrapper.tsx:47: function getStatusErrorMessage(status: number, serverMessage?: string): string {
4513| NOTE: Defines a helper or component function.
4514| src/components/PersistentMapWrapper.tsx:48:   switch (status) {
4515| NOTE: Implementation detail supporting search page behavior.
4516| src/components/PersistentMapWrapper.tsx:49:     case 400:
4517| NOTE: Implementation detail supporting search page behavior.
4518| src/components/PersistentMapWrapper.tsx:50:       return serverMessage || "Invalid map area. Try zooming in.";
4519| NOTE: Return statement for component or helper output.
4520| src/components/PersistentMapWrapper.tsx:51:     case 429:
4521| NOTE: Implementation detail supporting search page behavior.
4522| src/components/PersistentMapWrapper.tsx:52:       return "Too many requests. Please wait a moment.";
4523| NOTE: Return statement for component or helper output.
4524| src/components/PersistentMapWrapper.tsx:53:     case 500:
4525| NOTE: Implementation detail supporting search page behavior.
4526| src/components/PersistentMapWrapper.tsx:54:       return "Server error. Please try again.";
4527| NOTE: Return statement for component or helper output.
4528| src/components/PersistentMapWrapper.tsx:55:     default:
4529| NOTE: Implementation detail supporting search page behavior.
4530| src/components/PersistentMapWrapper.tsx:56:       return serverMessage || "Failed to load map data";
4531| NOTE: Return statement for component or helper output.
4532| src/components/PersistentMapWrapper.tsx:57:   }
4533| NOTE: Implementation detail supporting search page behavior.
4534| src/components/PersistentMapWrapper.tsx:58: }
4535| NOTE: Implementation detail supporting search page behavior.
4536| src/components/PersistentMapWrapper.tsx:59: 
4537| NOTE: Blank line for visual separation.
4538| src/components/PersistentMapWrapper.tsx:60: /**
4539| NOTE: Block comment line describing behavior or context.
4540| src/components/PersistentMapWrapper.tsx:61:  * Validate viewport bounds before making API request
4541| NOTE: Block comment line describing behavior or context.
4542| src/components/PersistentMapWrapper.tsx:62:  * Mirrors server-side validation to prevent unnecessary requests
4543| NOTE: Block comment line describing behavior or context.
4544| src/components/PersistentMapWrapper.tsx:63:  */
4545| NOTE: Block comment line describing behavior or context.
4546| src/components/PersistentMapWrapper.tsx:64: function isValidViewport(params: URLSearchParams): {
4547| NOTE: Defines a helper or component function.
4548| src/components/PersistentMapWrapper.tsx:65:   valid: boolean;
4549| NOTE: Implementation detail supporting search page behavior.
4550| src/components/PersistentMapWrapper.tsx:66:   error?: string;
4551| NOTE: Implementation detail supporting search page behavior.
4552| src/components/PersistentMapWrapper.tsx:67: } {
4553| NOTE: Implementation detail supporting search page behavior.
4554| src/components/PersistentMapWrapper.tsx:68:   const minLng = parseFloat(params.get("minLng") || "");
4555| NOTE: Local declaration used by search logic or UI.
4556| src/components/PersistentMapWrapper.tsx:69:   const maxLng = parseFloat(params.get("maxLng") || "");
4557| NOTE: Local declaration used by search logic or UI.
4558| src/components/PersistentMapWrapper.tsx:70:   const minLat = parseFloat(params.get("minLat") || "");
4559| NOTE: Local declaration used by search logic or UI.
4560| src/components/PersistentMapWrapper.tsx:71:   const maxLat = parseFloat(params.get("maxLat") || "");
4561| NOTE: Local declaration used by search logic or UI.
4562| src/components/PersistentMapWrapper.tsx:72: 
4563| NOTE: Blank line for visual separation.
4564| src/components/PersistentMapWrapper.tsx:73:   // NaN/Infinity check
4565| NOTE: Line comment documents intent or constraints.
4566| src/components/PersistentMapWrapper.tsx:74:   if (
4567| NOTE: Conditional logic controlling rendering or flow.
4568| src/components/PersistentMapWrapper.tsx:75:     !Number.isFinite(minLng) ||
4569| NOTE: Implementation detail supporting search page behavior.
4570| src/components/PersistentMapWrapper.tsx:76:     !Number.isFinite(maxLng) ||
4571| NOTE: Implementation detail supporting search page behavior.
4572| src/components/PersistentMapWrapper.tsx:77:     !Number.isFinite(minLat) ||
4573| NOTE: Implementation detail supporting search page behavior.
4574| src/components/PersistentMapWrapper.tsx:78:     !Number.isFinite(maxLat)
4575| NOTE: Implementation detail supporting search page behavior.
4576| src/components/PersistentMapWrapper.tsx:79:   ) {
4577| NOTE: Implementation detail supporting search page behavior.
4578| src/components/PersistentMapWrapper.tsx:80:     return { valid: false, error: "Invalid coordinates" };
4579| NOTE: Return statement for component or helper output.
4580| src/components/PersistentMapWrapper.tsx:81:   }
4581| NOTE: Implementation detail supporting search page behavior.
4582| src/components/PersistentMapWrapper.tsx:82: 
4583| NOTE: Blank line for visual separation.
4584| src/components/PersistentMapWrapper.tsx:83:   // Viewport size check (handle antimeridian crossing like server does)
4585| NOTE: Line comment documents intent or constraints.
4586| src/components/PersistentMapWrapper.tsx:84:   const latSpan = maxLat - minLat;
4587| NOTE: Local declaration used by search logic or UI.
4588| src/components/PersistentMapWrapper.tsx:85:   const crossesAntimeridian = minLng > maxLng;
4589| NOTE: Local declaration used by search logic or UI.
4590| src/components/PersistentMapWrapper.tsx:86:   const lngSpan = crossesAntimeridian
4591| NOTE: Local declaration used by search logic or UI.
4592| src/components/PersistentMapWrapper.tsx:87:     ? 180 - minLng + (maxLng + 180)
4593| NOTE: Implementation detail supporting search page behavior.
4594| src/components/PersistentMapWrapper.tsx:88:     : maxLng - minLng;
4595| NOTE: Implementation detail supporting search page behavior.
4596| src/components/PersistentMapWrapper.tsx:89: 
4597| NOTE: Blank line for visual separation.
4598| src/components/PersistentMapWrapper.tsx:90:   if (latSpan > MAX_LAT_SPAN || lngSpan > MAX_LNG_SPAN) {
4599| NOTE: Conditional logic controlling rendering or flow.
4600| src/components/PersistentMapWrapper.tsx:91:     return { valid: false, error: "Zoom in further to see listings" };
4601| NOTE: Return statement for component or helper output.
4602| src/components/PersistentMapWrapper.tsx:92:   }
4603| NOTE: Implementation detail supporting search page behavior.
4604| src/components/PersistentMapWrapper.tsx:93: 
4605| NOTE: Blank line for visual separation.
4606| src/components/PersistentMapWrapper.tsx:94:   return { valid: true };
4607| NOTE: Return statement for component or helper output.
4608| src/components/PersistentMapWrapper.tsx:95: }
4609| NOTE: Implementation detail supporting search page behavior.
4610| src/components/PersistentMapWrapper.tsx:96: 
4611| NOTE: Blank line for visual separation.
4612| src/components/PersistentMapWrapper.tsx:97: // Error banner component for map data fetch errors
4613| NOTE: Line comment documents intent or constraints.
4614| src/components/PersistentMapWrapper.tsx:98: function MapErrorBanner({
4615| NOTE: Defines a helper or component function.
4616| src/components/PersistentMapWrapper.tsx:99:   message,
4617| NOTE: Implementation detail supporting search page behavior.
4618| src/components/PersistentMapWrapper.tsx:100:   onRetry,
4619| NOTE: Implementation detail supporting search page behavior.
4620| src/components/PersistentMapWrapper.tsx:101: }: {
4621| NOTE: Implementation detail supporting search page behavior.
4622| src/components/PersistentMapWrapper.tsx:102:   message: string;
4623| NOTE: Implementation detail supporting search page behavior.
4624| src/components/PersistentMapWrapper.tsx:103:   onRetry: () => void;
4625| NOTE: Implementation detail supporting search page behavior.
4626| src/components/PersistentMapWrapper.tsx:104: }) {
4627| NOTE: Implementation detail supporting search page behavior.
4628| src/components/PersistentMapWrapper.tsx:105:   return (
4629| NOTE: Return statement for component or helper output.
4630| src/components/PersistentMapWrapper.tsx:106:     <div className="absolute top-4 left-4 right-4 z-10 bg-amber-50 dark:bg-amber-950/50 border border-amber-200 dark:border-amber-800 rounded-lg p-3 flex items-center justify-between gap-2">
4631| NOTE: Tailwind classes define layout and styling.
4632| src/components/PersistentMapWrapper.tsx:107:       <span className="text-sm text-amber-700 dark:text-amber-300">
4633| NOTE: Tailwind classes define layout and styling.
4634| src/components/PersistentMapWrapper.tsx:108:         {message}
4635| NOTE: Implementation detail supporting search page behavior.
4636| src/components/PersistentMapWrapper.tsx:109:       </span>
4637| NOTE: JSX markup for search UI.
4638| src/components/PersistentMapWrapper.tsx:110:       <button
4639| NOTE: JSX markup for search UI.
4640| src/components/PersistentMapWrapper.tsx:111:         onClick={onRetry}
4641| NOTE: Implementation detail supporting search page behavior.
4642| src/components/PersistentMapWrapper.tsx:112:         className="text-sm font-medium text-amber-800 dark:text-amber-200 hover:underline"
4643| NOTE: Tailwind classes define layout and styling.
4644| src/components/PersistentMapWrapper.tsx:113:       >
4645| NOTE: Implementation detail supporting search page behavior.
4646| src/components/PersistentMapWrapper.tsx:114:         Retry
4647| NOTE: Implementation detail supporting search page behavior.
4648| src/components/PersistentMapWrapper.tsx:115:       </button>
4649| NOTE: JSX markup for search UI.
4650| src/components/PersistentMapWrapper.tsx:116:     </div>
4651| NOTE: JSX markup for search UI.
4652| src/components/PersistentMapWrapper.tsx:117:   );
4653| NOTE: Implementation detail supporting search page behavior.
4654| src/components/PersistentMapWrapper.tsx:118: }
4655| NOTE: Implementation detail supporting search page behavior.
4656| src/components/PersistentMapWrapper.tsx:119: 
4657| NOTE: Blank line for visual separation.
4658| src/components/PersistentMapWrapper.tsx:120: // Loading placeholder for lazy map component
4659| NOTE: Line comment documents intent or constraints.
4660| src/components/PersistentMapWrapper.tsx:121: function MapLoadingPlaceholder() {
4661| NOTE: Defines a helper or component function.
4662| src/components/PersistentMapWrapper.tsx:122:   return (
4663| NOTE: Return statement for component or helper output.
4664| src/components/PersistentMapWrapper.tsx:123:     <div className="w-full h-full bg-zinc-100 dark:bg-zinc-800 animate-pulse flex items-center justify-center">
4665| NOTE: Tailwind classes define layout and styling.
4666| src/components/PersistentMapWrapper.tsx:124:       <div className="text-zinc-400 dark:text-zinc-500 text-sm">
4667| NOTE: Tailwind classes define layout and styling.
4668| src/components/PersistentMapWrapper.tsx:125:         Loading map...
4669| NOTE: Implementation detail supporting search page behavior.
4670| src/components/PersistentMapWrapper.tsx:126:       </div>
4671| NOTE: JSX markup for search UI.
4672| src/components/PersistentMapWrapper.tsx:127:     </div>
4673| NOTE: JSX markup for search UI.
4674| src/components/PersistentMapWrapper.tsx:128:   );
4675| NOTE: Implementation detail supporting search page behavior.
4676| src/components/PersistentMapWrapper.tsx:129: }
4677| NOTE: Implementation detail supporting search page behavior.
4678| src/components/PersistentMapWrapper.tsx:130: 
4679| NOTE: Blank line for visual separation.
4680| src/components/PersistentMapWrapper.tsx:131: // Subtle loading overlay shown when list is transitioning (filter change)
4681| NOTE: Line comment documents intent or constraints.
4682| src/components/PersistentMapWrapper.tsx:132: // This coordinates visual feedback between map and list
4683| NOTE: Line comment documents intent or constraints.
4684| src/components/PersistentMapWrapper.tsx:133: function MapTransitionOverlay() {
4685| NOTE: Defines a helper or component function.
4686| src/components/PersistentMapWrapper.tsx:134:   return (
4687| NOTE: Return statement for component or helper output.
4688| src/components/PersistentMapWrapper.tsx:135:     <div
4689| NOTE: JSX markup for search UI.
4690| src/components/PersistentMapWrapper.tsx:136:       className="absolute inset-0 z-10 bg-white/30 dark:bg-zinc-950/30 pointer-events-none flex items-start justify-center pt-20"
4691| NOTE: Tailwind classes define layout and styling.
4692| src/components/PersistentMapWrapper.tsx:137:       role="status"
4693| NOTE: Implementation detail supporting search page behavior.
4694| src/components/PersistentMapWrapper.tsx:138:       aria-label="Updating map results"
4695| NOTE: Accessibility attribute for screen readers.
4696| src/components/PersistentMapWrapper.tsx:139:     >
4697| NOTE: Implementation detail supporting search page behavior.
4698| src/components/PersistentMapWrapper.tsx:140:       <span className="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white dark:bg-zinc-800 rounded-full shadow-md border border-zinc-200 dark:border-zinc-700 text-xs font-medium text-zinc-500 dark:text-zinc-400">
4699| NOTE: Tailwind classes define layout and styling.
4700| src/components/PersistentMapWrapper.tsx:141:         <span className="w-1.5 h-1.5 rounded-full bg-zinc-400 dark:bg-zinc-500 animate-pulse" />
4701| NOTE: Tailwind classes define layout and styling.
4702| src/components/PersistentMapWrapper.tsx:142:         Updating...
4703| NOTE: Implementation detail supporting search page behavior.
4704| src/components/PersistentMapWrapper.tsx:143:       </span>
4705| NOTE: JSX markup for search UI.
4706| src/components/PersistentMapWrapper.tsx:144:     </div>
4707| NOTE: JSX markup for search UI.
4708| src/components/PersistentMapWrapper.tsx:145:   );
4709| NOTE: Implementation detail supporting search page behavior.
4710| src/components/PersistentMapWrapper.tsx:146: }
4711| NOTE: Implementation detail supporting search page behavior.
4712| src/components/PersistentMapWrapper.tsx:147: 
4713| NOTE: Blank line for visual separation.
4714| src/components/PersistentMapWrapper.tsx:148: interface PersistentMapWrapperProps {
4715| NOTE: Type declaration for search data contracts.
4716| src/components/PersistentMapWrapper.tsx:149:   /**
4717| NOTE: Block comment line describing behavior or context.
4718| src/components/PersistentMapWrapper.tsx:150:    * Whether to render the map. When false, map bundle is not loaded.
4719| NOTE: Block comment line describing behavior or context.
4720| src/components/PersistentMapWrapper.tsx:151:    * Used for lazy map initialization (cost optimization).
4721| NOTE: Block comment line describing behavior or context.
4722| src/components/PersistentMapWrapper.tsx:152:    */
4723| NOTE: Block comment line describing behavior or context.
4724| src/components/PersistentMapWrapper.tsx:153:   shouldRenderMap: boolean;
4725| NOTE: Implementation detail supporting search page behavior.
4726| src/components/PersistentMapWrapper.tsx:154: }
4727| NOTE: Implementation detail supporting search page behavior.
4728| src/components/PersistentMapWrapper.tsx:155: 
4729| NOTE: Blank line for visual separation.
4730| src/components/PersistentMapWrapper.tsx:156: export default function PersistentMapWrapper({
4731| NOTE: Exports main component for this module.
4732| src/components/PersistentMapWrapper.tsx:157:   shouldRenderMap,
4733| NOTE: Implementation detail supporting search page behavior.
4734| src/components/PersistentMapWrapper.tsx:158: }: PersistentMapWrapperProps) {
4735| NOTE: Implementation detail supporting search page behavior.
4736| src/components/PersistentMapWrapper.tsx:159:   const searchParams = useSearchParams();
4737| NOTE: Local declaration used by search logic or UI.
4738| src/components/PersistentMapWrapper.tsx:160:   const [listings, setListings] = useState<MapListingData[]>([]);
4739| NOTE: Initializes local state for search UI behavior.
4740| src/components/PersistentMapWrapper.tsx:161:   const [isFetchingMapData, setIsFetchingMapData] = useState(false);
4741| NOTE: Initializes local state for search UI behavior.
4742| src/components/PersistentMapWrapper.tsx:162:   const [error, setError] = useState<string | null>(null);
4743| NOTE: Initializes local state for search UI behavior.
4744| src/components/PersistentMapWrapper.tsx:163: 
4745| NOTE: Blank line for visual separation.
4746| src/components/PersistentMapWrapper.tsx:164:   // Check for v2 data from context (injected by page.tsx via V2MapDataSetter)
4747| NOTE: Line comment documents intent or constraints.
4748| src/components/PersistentMapWrapper.tsx:165:   const { v2MapData, isV2Enabled } = useSearchV2Data();
4749| NOTE: Local declaration used by search logic or UI.
4750| src/components/PersistentMapWrapper.tsx:166: 
4751| NOTE: Blank line for visual separation.
4752| src/components/PersistentMapWrapper.tsx:167:   // Coordinate with list transitions - show overlay when list is loading
4753| NOTE: Line comment documents intent or constraints.
4754| src/components/PersistentMapWrapper.tsx:168:   const transitionContext = useSearchTransitionSafe();
4755| NOTE: Local declaration used by search logic or UI.
4756| src/components/PersistentMapWrapper.tsx:169:   const isListTransitioning = transitionContext?.isPending ?? false;
4757| NOTE: Local declaration used by search logic or UI.
4758| src/components/PersistentMapWrapper.tsx:170:   const hasV2Data = v2MapData !== null;
4759| NOTE: Local declaration used by search logic or UI.
4760| src/components/PersistentMapWrapper.tsx:171: 
4761| NOTE: Blank line for visual separation.
4762| src/components/PersistentMapWrapper.tsx:172:   // Track current params to detect changes for debouncing
4763| NOTE: Line comment documents intent or constraints.
4764| src/components/PersistentMapWrapper.tsx:173:   const lastFetchedParamsRef = useRef<string | null>(null);
4765| NOTE: Uses ref for stable mutable storage between renders.
4766| src/components/PersistentMapWrapper.tsx:174:   const fetchTimeoutRef = useRef<NodeJS.Timeout | null>(null);
4767| NOTE: Uses ref for stable mutable storage between renders.
4768| src/components/PersistentMapWrapper.tsx:175: 
4769| NOTE: Blank line for visual separation.
4770| src/components/PersistentMapWrapper.tsx:176:   const fetchListings = useCallback(
4771| NOTE: Memoizes callback to preserve references across renders.
4772| src/components/PersistentMapWrapper.tsx:177:     async (paramsString: string, signal?: AbortSignal) => {
4773| NOTE: Implementation detail supporting search page behavior.
4774| src/components/PersistentMapWrapper.tsx:178:       setIsFetchingMapData(true);
4775| NOTE: Implementation detail supporting search page behavior.
4776| src/components/PersistentMapWrapper.tsx:179:       setError(null);
4777| NOTE: Implementation detail supporting search page behavior.
4778| src/components/PersistentMapWrapper.tsx:180: 
4779| NOTE: Blank line for visual separation.
4780| src/components/PersistentMapWrapper.tsx:181:       try {
4781| NOTE: Implementation detail supporting search page behavior.
4782| src/components/PersistentMapWrapper.tsx:182:         const response = await fetch(`/api/map-listings?${paramsString}`, {
4783| NOTE: Local declaration used by search logic or UI.
4784| src/components/PersistentMapWrapper.tsx:183:           signal,
4785| NOTE: Implementation detail supporting search page behavior.
4786| src/components/PersistentMapWrapper.tsx:184:         });
4787| NOTE: Implementation detail supporting search page behavior.
4788| src/components/PersistentMapWrapper.tsx:185: 
4789| NOTE: Blank line for visual separation.
4790| src/components/PersistentMapWrapper.tsx:186:         if (!response.ok) {
4791| NOTE: Conditional logic controlling rendering or flow.
4792| src/components/PersistentMapWrapper.tsx:187:           // Extract detailed error from response body
4793| NOTE: Line comment documents intent or constraints.
4794| src/components/PersistentMapWrapper.tsx:188:           let serverMessage: string | undefined;
4795| NOTE: Local declaration used by search logic or UI.
4796| src/components/PersistentMapWrapper.tsx:189:           let requestId: string | undefined;
4797| NOTE: Local declaration used by search logic or UI.
4798| src/components/PersistentMapWrapper.tsx:190: 
4799| NOTE: Blank line for visual separation.
4800| src/components/PersistentMapWrapper.tsx:191:           try {
4801| NOTE: Implementation detail supporting search page behavior.
4802| src/components/PersistentMapWrapper.tsx:192:             const errorData = await response.json();
4803| NOTE: Local declaration used by search logic or UI.
4804| src/components/PersistentMapWrapper.tsx:193:             serverMessage = errorData.error;
4805| NOTE: Implementation detail supporting search page behavior.
4806| src/components/PersistentMapWrapper.tsx:194:             requestId = response.headers.get("x-request-id") || undefined;
4807| NOTE: Implementation detail supporting search page behavior.
4808| src/components/PersistentMapWrapper.tsx:195:           } catch {
4809| NOTE: Implementation detail supporting search page behavior.
4810| src/components/PersistentMapWrapper.tsx:196:             // JSON parsing failed, use status-based message
4811| NOTE: Line comment documents intent or constraints.
4812| src/components/PersistentMapWrapper.tsx:197:           }
4813| NOTE: Implementation detail supporting search page behavior.
4814| src/components/PersistentMapWrapper.tsx:198: 
4815| NOTE: Blank line for visual separation.
4816| src/components/PersistentMapWrapper.tsx:199:           // Log error for debugging (PII-safe - no raw params)
4817| NOTE: Line comment documents intent or constraints.
4818| src/components/PersistentMapWrapper.tsx:200:           // Use warn for 400 (expected validation failures) to avoid polluting error overlay
4819| NOTE: Line comment documents intent or constraints.
4820| src/components/PersistentMapWrapper.tsx:201:           if (response.status === 400) {
4821| NOTE: Conditional logic controlling rendering or flow.
4822| src/components/PersistentMapWrapper.tsx:202:             console.warn("Map viewport validation failed:", {
4823| NOTE: Implementation detail supporting search page behavior.
4824| src/components/PersistentMapWrapper.tsx:203:               status: response.status,
4825| NOTE: Implementation detail supporting search page behavior.
4826| src/components/PersistentMapWrapper.tsx:204:               error: serverMessage,
4827| NOTE: Implementation detail supporting search page behavior.
4828| src/components/PersistentMapWrapper.tsx:205:             });
4829| NOTE: Implementation detail supporting search page behavior.
4830| src/components/PersistentMapWrapper.tsx:206:           } else {
4831| NOTE: Implementation detail supporting search page behavior.
4832| src/components/PersistentMapWrapper.tsx:207:             console.error("Map listings fetch failed:", {
4833| NOTE: Implementation detail supporting search page behavior.
4834| src/components/PersistentMapWrapper.tsx:208:               status: response.status,
4835| NOTE: Implementation detail supporting search page behavior.
4836| src/components/PersistentMapWrapper.tsx:209:               statusText: response.statusText,
4837| NOTE: Implementation detail supporting search page behavior.
4838| src/components/PersistentMapWrapper.tsx:210:               error: serverMessage,
4839| NOTE: Implementation detail supporting search page behavior.
4840| src/components/PersistentMapWrapper.tsx:211:               requestId,
4841| NOTE: Implementation detail supporting search page behavior.
4842| src/components/PersistentMapWrapper.tsx:212:             });
4843| NOTE: Implementation detail supporting search page behavior.
4844| src/components/PersistentMapWrapper.tsx:213:           }
4845| NOTE: Implementation detail supporting search page behavior.
4846| src/components/PersistentMapWrapper.tsx:214: 
4847| NOTE: Blank line for visual separation.
4848| src/components/PersistentMapWrapper.tsx:215:           const errorMessage = getStatusErrorMessage(
4849| NOTE: Local declaration used by search logic or UI.
4850| src/components/PersistentMapWrapper.tsx:216:             response.status,
4851| NOTE: Implementation detail supporting search page behavior.
4852| src/components/PersistentMapWrapper.tsx:217:             serverMessage,
4853| NOTE: Implementation detail supporting search page behavior.
4854| src/components/PersistentMapWrapper.tsx:218:           );
4855| NOTE: Implementation detail supporting search page behavior.
4856| src/components/PersistentMapWrapper.tsx:219:           throw new Error(errorMessage);
4857| NOTE: Implementation detail supporting search page behavior.
4858| src/components/PersistentMapWrapper.tsx:220:         }
4859| NOTE: Implementation detail supporting search page behavior.
4860| src/components/PersistentMapWrapper.tsx:221: 
4861| NOTE: Blank line for visual separation.
4862| src/components/PersistentMapWrapper.tsx:222:         const data = await response.json();
4863| NOTE: Local declaration used by search logic or UI.
4864| src/components/PersistentMapWrapper.tsx:223:         setListings(data.listings || []);
4865| NOTE: Implementation detail supporting search page behavior.
4866| src/components/PersistentMapWrapper.tsx:224:       } catch (err) {
4867| NOTE: Implementation detail supporting search page behavior.
4868| src/components/PersistentMapWrapper.tsx:225:         if ((err as Error).name !== "AbortError") {
4869| NOTE: Conditional logic controlling rendering or flow.
4870| src/components/PersistentMapWrapper.tsx:226:           console.error("Failed to fetch map listings:", err);
4871| NOTE: Implementation detail supporting search page behavior.
4872| src/components/PersistentMapWrapper.tsx:227:           setError((err as Error).message || "Failed to load map data");
4873| NOTE: Implementation detail supporting search page behavior.
4874| src/components/PersistentMapWrapper.tsx:228:         }
4875| NOTE: Implementation detail supporting search page behavior.
4876| src/components/PersistentMapWrapper.tsx:229:       } finally {
4877| NOTE: Implementation detail supporting search page behavior.
4878| src/components/PersistentMapWrapper.tsx:230:         setIsFetchingMapData(false);
4879| NOTE: Implementation detail supporting search page behavior.
4880| src/components/PersistentMapWrapper.tsx:231:       }
4881| NOTE: Implementation detail supporting search page behavior.
4882| src/components/PersistentMapWrapper.tsx:232:     },
4883| NOTE: Implementation detail supporting search page behavior.
4884| src/components/PersistentMapWrapper.tsx:233:     [],
4885| NOTE: Implementation detail supporting search page behavior.
4886| src/components/PersistentMapWrapper.tsx:234:   );
4887| NOTE: Implementation detail supporting search page behavior.
4888| src/components/PersistentMapWrapper.tsx:235: 
4889| NOTE: Blank line for visual separation.
4890| src/components/PersistentMapWrapper.tsx:236:   // Single effect that handles both initial fetch and param changes
4891| NOTE: Line comment documents intent or constraints.
4892| src/components/PersistentMapWrapper.tsx:237:   // Only fetches when map is rendered to avoid unnecessary API calls
4893| NOTE: Line comment documents intent or constraints.
4894| src/components/PersistentMapWrapper.tsx:238:   // V2 mode: Skip fetch entirely when v2MapData is provided via context
4895| NOTE: Line comment documents intent or constraints.
4896| src/components/PersistentMapWrapper.tsx:239:   useEffect(() => {
4897| NOTE: Defines side effect for syncing with external state.
4898| src/components/PersistentMapWrapper.tsx:240:     // Don't fetch if map isn't being rendered
4899| NOTE: Line comment documents intent or constraints.
4900| src/components/PersistentMapWrapper.tsx:241:     if (!shouldRenderMap) {
4901| NOTE: Conditional logic controlling rendering or flow.
4902| src/components/PersistentMapWrapper.tsx:242:       return;
4903| NOTE: Implementation detail supporting search page behavior.
4904| src/components/PersistentMapWrapper.tsx:243:     }
4905| NOTE: Implementation detail supporting search page behavior.
4906| src/components/PersistentMapWrapper.tsx:244: 
4907| NOTE: Blank line for visual separation.
4908| src/components/PersistentMapWrapper.tsx:245:     // RACE GUARD: If v2 mode is signaled but data hasn't arrived yet,
4909| NOTE: Line comment documents intent or constraints.
4910| src/components/PersistentMapWrapper.tsx:246:     // delay the v1 fetch to give the setter time to run.
4911| NOTE: Line comment documents intent or constraints.
4912| src/components/PersistentMapWrapper.tsx:247:     // This prevents double-fetch and flicker.
4913| NOTE: Line comment documents intent or constraints.
4914| src/components/PersistentMapWrapper.tsx:248:     if (isV2Enabled && !hasV2Data) {
4915| NOTE: Conditional logic controlling rendering or flow.
4916| src/components/PersistentMapWrapper.tsx:249:       const raceGuardTimeout = setTimeout(() => {
4917| NOTE: Local declaration used by search logic or UI.
4918| src/components/PersistentMapWrapper.tsx:250:         // After delay, if still no v2 data, the component will re-render
4919| NOTE: Line comment documents intent or constraints.
4920| src/components/PersistentMapWrapper.tsx:251:         // and this effect will run again. If v2 data still hasn't arrived,
4921| NOTE: Line comment documents intent or constraints.
4922| src/components/PersistentMapWrapper.tsx:252:         // it means v2 failed and we should fall back to v1 (done on next effect run).
4923| NOTE: Line comment documents intent or constraints.
4924| src/components/PersistentMapWrapper.tsx:253:       }, 100); // 100ms is enough for React to flush the setter
4925| NOTE: Implementation detail supporting search page behavior.
4926| src/components/PersistentMapWrapper.tsx:254:       return () => clearTimeout(raceGuardTimeout);
4927| NOTE: Return statement for component or helper output.
4928| src/components/PersistentMapWrapper.tsx:255:     }
4929| NOTE: Implementation detail supporting search page behavior.
4930| src/components/PersistentMapWrapper.tsx:256: 
4931| NOTE: Blank line for visual separation.
4932| src/components/PersistentMapWrapper.tsx:257:     // Skip v1 fetch entirely if v2 data is provided via context
4933| NOTE: Line comment documents intent or constraints.
4934| src/components/PersistentMapWrapper.tsx:258:     if (hasV2Data) {
4935| NOTE: Conditional logic controlling rendering or flow.
4936| src/components/PersistentMapWrapper.tsx:259:       // Clear any stale v1 state
4937| NOTE: Line comment documents intent or constraints.
4938| src/components/PersistentMapWrapper.tsx:260:       setError(null);
4939| NOTE: Implementation detail supporting search page behavior.
4940| src/components/PersistentMapWrapper.tsx:261:       return;
4941| NOTE: Implementation detail supporting search page behavior.
4942| src/components/PersistentMapWrapper.tsx:262:     }
4943| NOTE: Implementation detail supporting search page behavior.
4944| src/components/PersistentMapWrapper.tsx:263: 
4945| NOTE: Blank line for visual separation.
4946| src/components/PersistentMapWrapper.tsx:264:     const paramsString = searchParams.toString();
4947| NOTE: Local declaration used by search logic or UI.
4948| src/components/PersistentMapWrapper.tsx:265: 
4949| NOTE: Blank line for visual separation.
4950| src/components/PersistentMapWrapper.tsx:266:     // Skip if we've already fetched for these exact params
4951| NOTE: Line comment documents intent or constraints.
4952| src/components/PersistentMapWrapper.tsx:267:     if (paramsString === lastFetchedParamsRef.current) {
4953| NOTE: Conditional logic controlling rendering or flow.
4954| src/components/PersistentMapWrapper.tsx:268:       return;
4955| NOTE: Implementation detail supporting search page behavior.
4956| src/components/PersistentMapWrapper.tsx:269:     }
4957| NOTE: Implementation detail supporting search page behavior.
4958| src/components/PersistentMapWrapper.tsx:270: 
4959| NOTE: Blank line for visual separation.
4960| src/components/PersistentMapWrapper.tsx:271:     // Skip if bounds are missing - wait for map to set them
4961| NOTE: Line comment documents intent or constraints.
4962| src/components/PersistentMapWrapper.tsx:272:     const hasBounds =
4963| NOTE: Local declaration used by search logic or UI.
4964| src/components/PersistentMapWrapper.tsx:273:       searchParams.has("minLng") &&
4965| NOTE: Implementation detail supporting search page behavior.
4966| src/components/PersistentMapWrapper.tsx:274:       searchParams.has("maxLng") &&
4967| NOTE: Implementation detail supporting search page behavior.
4968| src/components/PersistentMapWrapper.tsx:275:       searchParams.has("minLat") &&
4969| NOTE: Implementation detail supporting search page behavior.
4970| src/components/PersistentMapWrapper.tsx:276:       searchParams.has("maxLat");
4971| NOTE: Implementation detail supporting search page behavior.
4972| src/components/PersistentMapWrapper.tsx:277: 
4973| NOTE: Blank line for visual separation.
4974| src/components/PersistentMapWrapper.tsx:278:     if (!hasBounds) {
4975| NOTE: Conditional logic controlling rendering or flow.
4976| src/components/PersistentMapWrapper.tsx:279:       // Don't fetch without bounds - map will set them after load
4977| NOTE: Line comment documents intent or constraints.
4978| src/components/PersistentMapWrapper.tsx:280:       // Clear loading state so map is interactive
4979| NOTE: Line comment documents intent or constraints.
4980| src/components/PersistentMapWrapper.tsx:281:       setIsFetchingMapData(false);
4981| NOTE: Implementation detail supporting search page behavior.
4982| src/components/PersistentMapWrapper.tsx:282:       return;
4983| NOTE: Implementation detail supporting search page behavior.
4984| src/components/PersistentMapWrapper.tsx:283:     }
4985| NOTE: Implementation detail supporting search page behavior.
4986| src/components/PersistentMapWrapper.tsx:284: 
4987| NOTE: Blank line for visual separation.
4988| src/components/PersistentMapWrapper.tsx:285:     // Client-side bounds validation to prevent unnecessary API requests
4989| NOTE: Line comment documents intent or constraints.
4990| src/components/PersistentMapWrapper.tsx:286:     const validation = isValidViewport(searchParams);
4991| NOTE: Local declaration used by search logic or UI.
4992| src/components/PersistentMapWrapper.tsx:287:     if (!validation.valid) {
4993| NOTE: Conditional logic controlling rendering or flow.
4994| src/components/PersistentMapWrapper.tsx:288:       setError(validation.error || "Invalid viewport");
4995| NOTE: Implementation detail supporting search page behavior.
4996| src/components/PersistentMapWrapper.tsx:289:       setIsFetchingMapData(false);
4997| NOTE: Implementation detail supporting search page behavior.
4998| src/components/PersistentMapWrapper.tsx:290:       lastFetchedParamsRef.current = paramsString; // Prevent re-validation spam
4999| NOTE: Implementation detail supporting search page behavior.
5000| TRUNCATED: Report trimmed to exactly 5000 lines as requested.
